[
    {
        "content": "<p>Just bumping mathlib on a private project and I get this warning:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"o\">(</span>my_venv<span class=\"o\">)</span><span class=\"w\"> </span>buzzard@IC-HWDXTW69VR<span class=\"w\"> </span>ClassFieldTheory<span class=\"w\"> </span>%<span class=\"w\"> </span>lake<span class=\"w\"> </span>update<span class=\"w\"> </span>mathlib\ninfo:<span class=\"w\"> </span>mathlib:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'edf2cbec036cbc703268107faad1b6b16f216c3f'</span>\ninfo:<span class=\"w\"> </span>toolchain<span class=\"w\"> </span>not<span class=\"w\"> </span>updated<span class=\"p\">;</span><span class=\"w\"> </span>already<span class=\"w\"> </span>up-to-date\ninfo:<span class=\"w\"> </span>aesop:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'1b1abe64060b3e3250218646023e47950d8cd396'</span>\ninfo:<span class=\"w\"> </span>Qq:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'d6afe6744246a799a3564dc84a878dab0c4a56d8'</span>\ninfo:<span class=\"w\"> </span>batteries:<span class=\"w\"> </span>checking<span class=\"w\"> </span>out<span class=\"w\"> </span>revision<span class=\"w\"> </span><span class=\"s1\">'d12fdadd81cb96980327cc02587fc14dea65a6e0'</span>\ninfo:<span class=\"w\"> </span>mathlib:<span class=\"w\"> </span>running<span class=\"w\"> </span>post-update<span class=\"w\"> </span>hooks\nWarning:<span class=\"w\"> </span>Some<span class=\"w\"> </span>Mathlib<span class=\"w\"> </span>ecosystem<span class=\"w\"> </span>tools<span class=\"w\"> </span>assume<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>git<span class=\"w\"> </span>remote<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"sb\">`</span>leanprover-community/mathlib4<span class=\"sb\">`</span><span class=\"w\"> </span>is<span class=\"w\"> </span>named<span class=\"w\"> </span><span class=\"sb\">`</span>upstream<span class=\"sb\">`</span>.<span class=\"w\"> </span>You<span class=\"w\"> </span>have<span class=\"w\"> </span>named<span class=\"w\"> </span>it<span class=\"w\"> </span><span class=\"sb\">`</span>origin<span class=\"sb\">`</span><span class=\"w\"> </span>instead.<span class=\"w\"> </span>We<span class=\"w\"> </span>recommend<span class=\"w\"> </span>changing<span class=\"w\"> </span>the<span class=\"w\"> </span>name<span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"sb\">`</span>upstream<span class=\"sb\">`</span>.<span class=\"w\"> </span>Moreover,<span class=\"w\"> </span><span class=\"sb\">`</span>origin<span class=\"sb\">`</span><span class=\"w\"> </span>should<span class=\"w\"> </span>point<span class=\"w\"> </span>to<span class=\"w\"> </span>your<span class=\"w\"> </span>own<span class=\"w\"> </span>fork<span class=\"w\"> </span>of<span class=\"w\"> </span>the<span class=\"w\"> </span>mathlib4<span class=\"w\"> </span>repository.<span class=\"w\"> </span>You<span class=\"w\"> </span>can<span class=\"w\"> </span><span class=\"nb\">set</span><span class=\"w\"> </span>this<span class=\"w\"> </span>up<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>git<span class=\"w\"> </span>remote<span class=\"w\"> </span>add<span class=\"w\"> </span>upstream<span class=\"w\"> </span>https://github.com/leanprover-community/mathlib4.git<span class=\"sb\">`</span>.\nUsing<span class=\"w\"> </span>cache<span class=\"w\"> </span>from<span class=\"w\"> </span>origin:<span class=\"w\"> </span>leanprover-community/mathlib4\nAttempting<span class=\"w\"> </span>to<span class=\"w\"> </span>download<span class=\"w\"> </span><span class=\"m\">6876</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span><span class=\"w\"> </span>from<span class=\"w\"> </span>leanprover-community/mathlib4<span class=\"w\"> </span>cache\nDownloaded:<span class=\"w\"> </span><span class=\"m\">6876</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span>attempted<span class=\"w\"> </span><span class=\"m\">6876</span>/6876<span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">100</span>%<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">100</span>%<span class=\"w\"> </span>success<span class=\"o\">)</span>\nDecompressing<span class=\"w\"> </span><span class=\"m\">6876</span><span class=\"w\"> </span>file<span class=\"o\">(</span>s<span class=\"o\">)</span>\nUnpacked<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">17976</span><span class=\"w\"> </span>ms\nCompleted<span class=\"w\"> </span>successfully!\n<span class=\"o\">(</span>my_venv<span class=\"o\">)</span><span class=\"w\"> </span>buzzard@IC-HWDXTW69VR<span class=\"w\"> </span>ClassFieldTheory<span class=\"w\"> </span>%\n</code></pre></div>\n<p>In particular something is telling me that I named something \"origin\". But I'm not sure I named mathlib anything. My <code>lakefile.toml</code> is</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>name = \"ClassFieldTheory\"\ndefaultTargets = [\"ClassFieldTheory\"]\n\n[leanOptions]\npp.unicode.fun = true\nautoImplicit = false\nrelaxedAutoImplicit = false\n\n[[require]]\nname = \"mathlib\"\ngit = \"https://github.com/leanprover-community/mathlib4.git\"\n\n\n[[require]]\nname = \"checkdecls\"\ngit = \"https://github.com/PatrickMassot/checkdecls.git\"\n\n[[require]]\nname = \"«doc-gen4»\"\ngit = \"https://github.com/leanprover/doc-gen4\"\nrev = \"main\"\n[[lean_lib]]\nname = \"ClassFieldTheory\"\n</code></pre></div>\n<p>Do I need to change my setup or is the warning incorrect?</p>",
        "id": 525488150,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750761477
    },
    {
        "content": "<p>This is maybe related to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Failing.20CI/with/525466176\">#mathlib4 &gt; Failing CI</a>, the same message appears in some warning during CI.</p>",
        "id": 525488637,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1750761654
    },
    {
        "content": "<p>this is your git remote that is named origin, you can rename it to upstream by running <code>git remote rename origin upstream</code>.</p>",
        "id": 525489195,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750761874
    },
    {
        "content": "<p>What is the output of <code>git remote -v</code> in the root directory?</p>",
        "id": 525489389,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750761955
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">IC</span><span class=\"bp\">-</span><span class=\"n\">HWDXTW69VR</span><span class=\"w\"> </span><span class=\"n\">ClassFieldTheory</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span>\n<span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">git</span><span class=\"bp\">@</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"o\">:</span><span class=\"n\">kbuzzard</span><span class=\"bp\">/</span><span class=\"n\">ClassFieldTheory</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fetch</span><span class=\"o\">)</span>\n<span class=\"n\">origin</span><span class=\"w\">  </span><span class=\"n\">git</span><span class=\"bp\">@</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"o\">:</span><span class=\"n\">kbuzzard</span><span class=\"bp\">/</span><span class=\"n\">ClassFieldTheory</span><span class=\"bp\">.</span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">push</span><span class=\"o\">)</span>\n<span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">IC</span><span class=\"bp\">-</span><span class=\"n\">HWDXTW69VR</span><span class=\"w\"> </span><span class=\"n\">ClassFieldTheory</span><span class=\"w\"> </span><span class=\"bp\">%</span>\n</code></pre></div>",
        "id": 525492054,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750762996
    },
    {
        "content": "<p>What I'm pointing out is that this is my own project with mathlib as a dependency and I don't know how to silence the warning because I haven't named mathlib anything.</p>",
        "id": 525492438,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750763158
    },
    {
        "content": "<p>I saw a guess it was coming from the git remotes in <code>.lake</code>. I can try to tease it out in a few hours</p>",
        "id": 525492874,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750763317
    },
    {
        "content": "<p>GPT says that this warning is safe to ignore, and that you can also try <code>cd lake-packages/mathlib</code> and then <code>git remote -v</code></p>",
        "id": 525493105,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750763403
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>buzzard@IC-HWDXTW69VR<span class=\"w\"> </span>ClassFieldTheory<span class=\"w\"> </span>%<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>.lake/packages\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>packages<span class=\"w\"> </span>%<span class=\"w\"> </span><span class=\"nb\">cd</span><span class=\"w\"> </span>mathlib\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>mathlib<span class=\"w\"> </span>%<span class=\"w\"> </span>git<span class=\"w\"> </span>remote<span class=\"w\"> </span>--v\norigin<span class=\"w\">  </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span><span class=\"o\">(</span>fetch<span class=\"o\">)</span>\norigin<span class=\"w\">  </span>https://github.com/leanprover-community/mathlib4.git<span class=\"w\"> </span><span class=\"o\">(</span>push<span class=\"o\">)</span>\nbuzzard@IC-HWDXTW69VR<span class=\"w\"> </span>mathlib<span class=\"w\"> </span>%\n</code></pre></div>\n<p>Should I really be messing with stuff inside <code>.lake</code>??</p>",
        "id": 525498928,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750765447
    },
    {
        "content": "<p>Nothing you need to do at the moment. Just ignore for now unless you can’t and then complain.</p>",
        "id": 525499568,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750765662
    },
    {
        "content": "<p>Why name it <code>upstream</code>? I am planning on keeping it named <code>origin</code> and have my fork named <code>YaelDillies</code>, so that it doesn't have a preferred name compared to other forks</p>",
        "id": 525503905,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750767208
    },
    {
        "content": "<p>It seems reasonable for the \"Mathlib ecosystem tools\" to assume <em>something</em>. I guess a reasonable solution is to allow the warning to be disabled, for users with their own name preferences who will have to be aware of the potential problem when they run said tools, and have Lake disable the warning whenever it clones Mathlib as a dependency.</p>",
        "id": 525511925,
        "sender_full_name": "Raghuram",
        "timestamp": 1750769741
    },
    {
        "content": "<p>If I rename something within <code>.lake</code> then every time everything goes wrong and I fix it by deleting <code>.lake</code> the problem will come back, right?</p>",
        "id": 525515102,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750770623
    },
    {
        "content": "<p>At least for this problem (if I am right about the cause of it), yes.</p>",
        "id": 525515840,
        "sender_full_name": "Raghuram",
        "timestamp": 1750770823
    },
    {
        "content": "<p>What’s the specific problem? I see the warning. Is it blocking something? Please be pedantic with me, I’m doing three different things for most of the day.</p>",
        "id": 525516063,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750770881
    },
    {
        "content": "<p>There is no problem. I'm just reporting that I'm forever getting a warning on my project which depends on mathlib (and so probably everyone is). I'm happy to ignore it, I reported it because I thought someone might say \"oops yes this is a mistake at our end here's a fix\". I am happy to live with the warnings!</p>",
        "id": 525517383,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750771264
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/287929-mathlib4/topic/.22You.20have.20named.20it.20.60origin.60.20instead.2E.22/near/525503905\">said</a>:</p>\n<blockquote>\n<p>Why name it <code>upstream</code>? I am planning on keeping it named <code>origin</code> and have my fork named <code>YaelDillies</code>, so that it doesn't have a preferred name compared to other forks</p>\n</blockquote>\n<p>A rock solid heuristic for determining if we are in a fork would be great but checking upstream is all I’ve seen.</p>",
        "id": 525517441,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750771284
    },
    {
        "content": "<p>I actually get an error if the remote is called <code>upstream</code>, as far as I can tell <code>lake exe cache get</code> only works if it's called <code>origin</code> (in which case I get the warning telling me to rename it to <code>upstream</code> but it works).</p>",
        "id": 525626226,
        "sender_full_name": "Frédéric Dupuis",
        "timestamp": 1750819401
    },
    {
        "content": "<p>Based on my reading of <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Cache/Requests.lean\">Cache/Requests.lean</a>, it seems like</p>\n<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Cache/Requests.lean#L88\">findMathlibRemote</a> is responsible for the warning.</li>\n<li>This is called by <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Cache/Requests.lean#L102\">getRemoteRepo</a> which is called by <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Cache/Requests.lean#L416\">getFiles</a>.</li>\n<li>The latter has already computed something called <code>IO.isMathlibRoot</code>, which I think (but I'm not sure about this part) is true iff <code>lake exe cache get</code> is run in a mathlib repo directly rather than a project with mathlib as a dependency.</li>\n</ul>\n<p>If my understanding is correct (especially the last part), the following patch should make the warning go away when mathlib is a dependency:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/Cache/Requests.lean b/Cache/Requests.lean</span>\n<span class=\"gh\">index d17b3bbf76..4ac3c1900a 100644</span>\n<span class=\"gd\">--- a/Cache/Requests.lean</span>\n<span class=\"gi\">+++ b/Cache/Requests.lean</span>\n<span class=\"gu\">@@ -50,9 +50,9 @@ def getRepoFromRemote (mathlibDepPath : FilePath) (remoteName : String) (errorCo</span>\n\n<span class=\"w\"> </span>/--\n<span class=\"w\"> </span>Finds the remote name that points to `leanprover-community/mathlib4` repository.\n<span class=\"gd\">-Returns the remote name and prints warnings if the setup doesn't follow conventions.</span>\n<span class=\"gi\">+Returns the remote name and optionally prints warnings if the setup doesn't follow conventions.</span>\n<span class=\"w\"> </span>-/\n<span class=\"gd\">-def findMathlibRemote (mathlibDepPath : FilePath) : IO String := do</span>\n<span class=\"gi\">+def findMathlibRemote (mathlibDepPath : FilePath) (warn : Bool := true) : IO String := do</span>\n<span class=\"w\"> </span>  let remotesInfo ← IO.Process.output\n<span class=\"w\"> </span>    {cmd := \"git\", args := #[\"remote\", \"-v\"], cwd := mathlibDepPath}\n\n<span class=\"gu\">@@ -84,7 +84,7 @@ def findMathlibRemote (mathlibDepPath : FilePath) : IO String := do</span>\n<span class=\"w\"> </span>  | none =&gt;\n<span class=\"w\"> </span>    throw &lt;| IO.userError \"Could not find a remote pointing to leanprover-community/mathlib4\"\n<span class=\"w\"> </span>  | some remoteName =&gt;\n<span class=\"gd\">-    if remoteName != \"upstream\" then</span>\n<span class=\"gi\">+    if warn &amp;&amp; remoteName != \"upstream\" then</span>\n<span class=\"w\"> </span>      let mut warning := s!\"Some Mathlib ecosystem tools assume that the git remote for `leanprover-community/mathlib4` is named `upstream`. You have named it `{remoteName}` instead. We recommend changing the name to `upstream`.\"\n<span class=\"w\"> </span>      if originPointsToMathlib then\n<span class=\"w\"> </span>        warning := warning ++ \" Moreover, `origin` should point to your own fork of the mathlib4 repository.\"\n<span class=\"gu\">@@ -97,9 +97,9 @@ Attempts to determine the GitHub repository of a version of Mathlib from its Git</span>\n<span class=\"w\"> </span>If the current branch is tracking a PR (upstream/pr/NNNN), it will determine the source fork\n<span class=\"w\"> </span>of that PR rather than just using the origin remote.\n<span class=\"w\"> </span>-/\n<span class=\"gd\">-def getRemoteRepo (mathlibDepPath : FilePath) : IO RepoInfo := do</span>\n<span class=\"gi\">+def getRemoteRepo (mathlibDepPath : FilePath) (warnAboutRemoteNames : Bool := true) : IO RepoInfo := do</span>\n<span class=\"w\"> </span>  -- Find the actual remote name for mathlib4\n<span class=\"gd\">-  let mathlibRemoteName ← findMathlibRemote mathlibDepPath</span>\n<span class=\"gi\">+  let mathlibRemoteName ← findMathlibRemote mathlibDepPath warnAboutRemoteNames</span>\n\n<span class=\"w\"> </span>  -- Check if current branch is tracking {remoteName}/pr/NNNN\n<span class=\"w\"> </span>  let trackingInfo ← IO.Process.output\n<span class=\"gu\">@@ -413,7 +413,8 @@ def getFiles</span>\n<span class=\"w\"> </span>  if let some repo := repo? then\n<span class=\"w\"> </span>    downloadFiles repo hashMap forceDownload parallel (warnOnMissing := true)\n<span class=\"w\"> </span>  else\n<span class=\"gd\">-    let repoInfo ← getRemoteRepo (← read).mathlibDepPath</span>\n<span class=\"gi\">+    -- Note: by modifying `isMathlibRoot`, this could include logic for users to disable the remote-name warning.</span>\n<span class=\"gi\">+    let repoInfo ← getRemoteRepo (← read).mathlibDepPath isMathlibRoot</span>\n\n<span class=\"w\"> </span>    -- Build list of repositories to download from in order\n<span class=\"w\"> </span>    let repos : List String :=\n</code></pre></div>\n<p>But I'm not sure about this, so I'm just leaving this here for someone more knowledgeable about the code to apply it if correct.</p>",
        "id": 525739573,
        "sender_full_name": "Raghuram",
        "timestamp": 1750865641
    },
    {
        "content": "<p>If you are having issues, please merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/26047\">#26047</a> into your branch and report back. Before merging, I want to make sure we are not missing edge cases.</p>",
        "id": 525742835,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750866686
    },
    {
        "content": "<p>I don’t think this is the PR number you meant <span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span></p>",
        "id": 525745659,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1750867364
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26407\">#26407</a></p>",
        "id": 525745945,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1750867463
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.22You.20have.20named.20it.20.60origin.60.20instead.2E.22/near/525742835\">said</a>:</p>\n<blockquote>\n<p>If you are having issues, please merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/26047\">#26047</a> into your branch and report back.</p>\n</blockquote>\n<p>I can confirm the warning is gone on a new Lake project depending on (<a href=\"https://github.com/leanprover-community/mathlib4/commit/325f8d7afbfdc36f2507b508872111b11c4eea2a\">this commit</a> of) Mathlib.</p>",
        "id": 525775223,
        "sender_full_name": "Raghuram",
        "timestamp": 1750879306
    },
    {
        "content": "<p>The warning that triggered this thread shows up multiple times in the CI for a PR...</p>",
        "id": 526263267,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1751196126
    }
]