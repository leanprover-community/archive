[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/24095\">#24095</a> I'm adding <code>fun_prop</code> attribute to <code>IsLinearMap</code> and <code>IsBoundedLinearMap</code>. This is probably fine an all accounts except it seems that using <code>IsLinearMap</code> seems to be discouraged and one should use <code>LinearMap</code> instead so I'm not sure.</p>\n<p>Apart from this, I also added support for the notation <code>fun x â†¦L[ğ•œ] f x</code> and <code>fun x â†¦â‚—[ğ•œ] f x</code> for writing bundles maps <code>LinearMap</code> and <code>ContinuousLinearMap</code> with familiar lambda like notation. I believe that this can significantly improve readability of certain theorems statement. For example, instead of stating</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fderiv_clm_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableAt</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableAt</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">compL</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">        </span><span class=\"o\">((</span><span class=\"n\">compL</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flip</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>one can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fderiv_clm_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableAt</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DifferentiableAt</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">       </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">..</span>\n</code></pre></div>\n<p>I would like to get an opinion whether this is desirable and I should finish finish the PR.</p>",
        "id": 512409566,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744749581
    },
    {
        "content": "<p>Does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLinearMap#doc\">docs#IsLinearMap</a> still exist?!</p>",
        "id": 512409737,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744749651
    },
    {
        "content": "<p>Seems like it :)</p>",
        "id": 512409779,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744749669
    },
    {
        "content": "<p>Yeah! Is it ever used in mathlib?</p>",
        "id": 512409879,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744749702
    },
    {
        "content": "<p>Not sure, I use it in SciLean</p>",
        "id": 512409997,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744749736
    },
    {
        "content": "<p>We also have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearMapClass#doc\">docs#LinearMapClass</a> so that's three ways of doing linear maps. Why did you go with the deprecated one?</p>",
        "id": 512410291,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744749864
    },
    {
        "content": "<p>Because this is the only one that is a predicate on <code>X â†’ Y</code> that is how <code>fun_prop</code> works</p>",
        "id": 512410394,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744749909
    },
    {
        "content": "<p>You don't need a <code>islinearmap</code> tactic if you stick with the bundled version because you make linear maps by applying functions which eat linear maps and spit out linear maps</p>",
        "id": 512410652,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750006
    },
    {
        "content": "<p>I really do not like the pointfree style of writing boundled morphisms, I find it incomprehensible for mildly complicated functions.</p>",
        "id": 512410691,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750023
    },
    {
        "content": "<p>There was a reason we moved away from it with linear maps back in the lean 3 days, something to do with the fact that typeclass inference wouldn't reliably prove <code>IsLinearMap (f \\circ g)</code> given <code>IslinearMap f</code> and <code>IsLinearMap g</code> and this was kind of crucial for algebra</p>",
        "id": 512411013,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750160
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512410652\">said</a>:</p>\n<blockquote>\n<p>You don't need a <code>islinearmap</code> tactic if you stick with the bundled version because you make linear maps by applying functions which eat linear maps and spit out linear maps</p>\n</blockquote>\n<p>That is why I'm asking if this is desirable as is seems that mathlib got used to the pointfree style. But you won't convince me that the  current statement of <code>fderiv_clm_comp</code> is comprehensible to a beginner. On other hand this is very clear:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">       </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">..</span>\n</code></pre></div>",
        "id": 512411051,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750176
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512411013\">said</a>:</p>\n<blockquote>\n<p>There was a reason we moved away from it with linear maps back in the lean 3 days, something to do with the fact that typeclass inference wouldn't reliably prove <code>IsLinearMap (f \\circ g)</code> given <code>IslinearMap f</code> and <code>IsLinearMap g</code> and this was kind of crucial for algebra</p>\n</blockquote>\n<p>Well <code>fun_prop</code> is designed to do exactly that, so it might be worth to revisit that decision.</p>",
        "id": 512411177,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750218
    },
    {
        "content": "<p>But with the bundled approach you don't need <em>anything</em> to do it, you just use <code>âˆ˜â‚—</code> to compose two linear maps</p>",
        "id": 512411411,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750317
    },
    {
        "content": "<p>And <code>â‰ªâ‰«â‚—</code> to compose two linear isomorphisms</p>",
        "id": 512411531,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750352
    },
    {
        "content": "<p>So you find  this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">compL</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">        </span><span class=\"o\">((</span><span class=\"n\">compL</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flip</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>more or no more readable than this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">fderiv</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">dx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 512411633,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750385
    },
    {
        "content": "<p>My honest answer is that I don't have a clue what either of them say :-) I don't ever use <code>fderiv</code>. Can you write them in LaTeX?</p>",
        "id": 512411926,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750497
    },
    {
        "content": "<p>that would be cheating :)</p>",
        "id": 512412216,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744750620
    },
    {
        "content": "<p>What is <code>compL</code>? I don't see it in the docs yet.</p>",
        "id": 512412237,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750629
    },
    {
        "content": "<p>I am quite a long way from finding anything in Tomas' post readable.</p>",
        "id": 512412297,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750656
    },
    {
        "content": "<p>aah <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousLinearMap.compL#doc\">docs#ContinuousLinearMap.compL</a></p>",
        "id": 512412467,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750725
    },
    {
        "content": "<p>If the analysts don't have notation for that, that's their problem, not mine.</p>",
        "id": 512412556,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750782
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512412237\">said</a>:</p>\n<blockquote>\n<p>What is <code>compL</code>? I don't see it in the docs yet.</p>\n</blockquote>\n<p>Haha, this is what I'm talking about :) Once you start writing mildly complicated bundled morphisms you have to use all kinds of weird combinators like <code>compL</code></p>",
        "id": 512412583,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750794
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512411926\">said</a>:</p>\n<blockquote>\n<p>My honest answer is that I don't have a clue what either of them say :-) I don't ever use <code>fderiv</code>. Can you write them in LaTeX?</p>\n</blockquote>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mi>d</mi><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>f</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mfrac><mrow><mi>d</mi><mi>g</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\frac{d}{dx} (f(x,g(x)) = \\frac{\\partial f}{\\partial x}(x, g(x)) + f(x,\\frac{d g}{dx}(x))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">))</span></span></span></span></span></p>\n<p>for <code>f</code> linear in its second argument</p>",
        "id": 512412791,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744750867
    },
    {
        "content": "<p>Oh that I understand!</p>",
        "id": 512412849,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744750899
    },
    {
        "content": "<p>Tomas, one nice thing about the bundled approach is that it gives you something (i.e., a declaration) to hang your hat on. Otherwise you're constantly looking at <code>ContinuousLinearMap.mk</code> as your head symbol.</p>",
        "id": 512412973,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744750945
    },
    {
        "content": "<p>That said, I certainly wouldn't mind have this notation to use when <em>constructing</em> linear maps (either for definitions or on the fly).</p>",
        "id": 512413030,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744750972
    },
    {
        "content": "<p>Ohh I think it actually says:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mi>d</mi><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>y</mi><mo>â†¦</mo><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>=</mo><mi>y</mi><mo>â†¦</mo><mo stretchy=\"false\">(</mo><mfrac><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>f</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mfrac><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>g</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ‚</mi><mi>x</mi></mrow></mfrac><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\frac{d}{dx} (y \\mapsto (f(x,g(x,y)) = y \\mapsto (\\frac{\\partial f}{\\partial x}(x, g(x,y)) + f(x,\\frac{\\partial g}{\\partial x}(x,y)))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">â†¦</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7054em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">â†¦</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\" style=\"margin-right:0.05556em;\">âˆ‚</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)))</span></span></span></span></span></p>\n<p>(how do I write <code>\\mapsto</code> in <code>math</code> mode on Zulip)</p>\n<p>and <code>g</code> is linear in its second argument too</p>",
        "id": 512413500,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744751162
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512412973\">said</a>:</p>\n<blockquote>\n<p>Tomas, one nice thing about the bundled approach is that it gives you something (i.e., a declaration) to hang your hat on. Otherwise you're constantly looking at <code>ContinuousLinearMap.mk</code> as your head symbol.</p>\n</blockquote>\n<p>When is that a problem? Can you give me an example?</p>",
        "id": 512413600,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744751211
    },
    {
        "content": "<blockquote>\n<p>(how do I write <code>\\mapsto</code> in <code>math</code> mode on Zulip)</p>\n</blockquote>\n<p>I would assume it just works like that: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>â†¦</mo></mrow><annotation encoding=\"application/x-tex\">\\mapsto</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.522em;vertical-align:-0.011em;\"></span><span class=\"mrel\">â†¦</span></span></span></span></p>",
        "id": 512413726,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744751261
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512413726\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>(how do I write <code>\\mapsto</code> in <code>math</code> mode on Zulip)</p>\n</blockquote>\n<p>I would assume it just works like that: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>â†¦</mo></mrow><annotation encoding=\"application/x-tex\">\\mapsto</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.522em;vertical-align:-0.011em;\"></span><span class=\"mrel\">â†¦</span></span></span></span></p>\n</blockquote>\n<p>Duh, I swear it didn't work for me before. Not sure what went wrong</p>",
        "id": 512413904,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744751334
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60fun_prop.60.20for.20Is.28Bounded.29LinearMap.20.2B.20.60fun.20x.20.E2.86.A6L.5B.F0.9D.95.9C.5D.20f.20x.60/near/512413600\">said</a>:</p>\n<blockquote>\n<p>When is that a problem? Can you give me an example?</p>\n</blockquote>\n<p>I just mean for <code>simp</code> and related things that use <code>DiscrTree</code>. It would lead to far worse indexing because <code>simp</code> would just see <code>ContinuousLinearMap.mk</code> everywhere.</p>",
        "id": 512962042,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744946416
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span></p>",
        "id": 512962061,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744946429
    },
    {
        "content": "<p>I see, fair point. </p>\n<p>The counter argument would be that it is true for normal lambdas too and we manage. We could also switch to <code>RefinedDiscrTree</code> that can index lambdas.</p>",
        "id": 512966543,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1744949495
    },
    {
        "content": "<p>In general I think we don't have tons of lambdas running around in simp lemmas (I'm not saying none, of course). </p>\n<p>It depends on what you mean by \"we\" when you say we can switch. That's a decision for Lean core, not Mathlib.</p>",
        "id": 513133497,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1745037582
    }
]