[
    {
        "content": "<p>I want (a topologically sorted) import graph for mathlib, which I know <code>importGraph</code> basically generates. I see Mathlib's CI runs generate this, but it appears just to confirm the command works, then they immediately throw the data away. Unless I'm missing somewhere else which does this, is there any objection to preserving the graph on build? <a href=\"https://github.com/leanprover-community/mathlib4/pull/19162\">#19162</a> is a PR which does so if not.</p>",
        "id": 482876021,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731860888
    },
    {
        "content": "<p>I guess now that I see it in the comment, this I think means scripts/count-trans-deps.py could operate on the import graph file rather than custom-parsing Lean code, though if it works at the minute of course who cares.</p>",
        "id": 482876220,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731861061
    },
    {
        "content": "<p>(CC <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> )</p>",
        "id": 482876247,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731861093
    },
    {
        "content": "<p>I do not know how the GitHub API quota works, but I know that Mathlib is often running out.  Does this step add extra burden on this?</p>",
        "id": 482883327,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731866735
    },
    {
        "content": "<p>Alternatives could be to run it on a schedule, maybe once a day on master?</p>",
        "id": 482883345,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731866754
    },
    {
        "content": "<p>Or rather than saving it as an artifact, just printing the resulting <code>dot</code> file and store it in the CI logs?</p>",
        "id": 482883409,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731866785
    },
    {
        "content": "<p>As I mentioned, my main concern is the API quota, and I'm not sure of what is \"lighter\" from this perspective.</p>",
        "id": 482883444,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731866815
    },
    {
        "content": "<p>Do you know which quota Mathlib tends to use up? I suspect it's the minutes quota maybe? I don't think I can see that data, but will double check. (If that's the one, this wouldn't put more pressure on it -- it does use up a bit of the storage quota, but AFAIK the \"real stuff\" stored, i.e. oleans, are not using GH Actions storage, they are in some cloud bucket?) But it's definitely a good thing to double check.</p>",
        "id": 482883735,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867087
    },
    {
        "content": "<p>Oh fun, I can indeed see <a href=\"https://github.com/leanprover-community/mathlib4/actions/metrics/usage\">https://github.com/leanprover-community/mathlib4/actions/metrics/usage</a>, that's new.</p>",
        "id": 482883797,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867125
    },
    {
        "content": "<p>We don't use any \"minutes\", I don't think. It's mainly the GitHub API quota in e.g. the <code>GITHUB_TOKEN</code> provided to github actions that we've been concerned about lately.</p>",
        "id": 482883827,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1731867159
    },
    {
        "content": "<p>Aha.</p>",
        "id": 482883876,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867195
    },
    {
        "content": "<p>From rate limiting? Or literally hitting the limit in some period?</p>",
        "id": 482883975,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867270
    },
    {
        "content": "<p>Yeah, we've had issues with hitting the limit before so we have been using personal tokens from various \"bot\" accounts.</p>",
        "id": 482884017,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1731867313
    },
    {
        "content": "<p>Got it. OK, that does sound like a concern then. Hm.</p>",
        "id": 482884128,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867387
    },
    {
        "content": "<p>I just found this discussion about upload-artifact, which suggests that it might be using a separate quota: <a href=\"https://github.com/actions/upload-artifact/issues/197\">https://github.com/actions/upload-artifact/issues/197</a></p>\n<p>If that's true then I see no objection to your PR.</p>",
        "id": 482884131,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1731867387
    },
    {
        "content": "<p>Fun, I didn't know that myself.</p>",
        "id": 482884247,
        "sender_full_name": "Julian Berman",
        "timestamp": 1731867483
    },
    {
        "content": "<p>Ok, I'm glad that we checked!  I'm happy to try it out and, potentially, revert it if it causes problems and think of alternatives!</p>",
        "id": 482884482,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731867683
    },
    {
        "content": "<p>Bryan, are you happy with this as well?</p>",
        "id": 482884563,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731867730
    },
    {
        "content": "<p>Sure, let's go for it.</p>",
        "id": 482885098,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1731868109
    },
    {
        "content": "<p>I just put it on the queue!</p>",
        "id": 482885149,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731868166
    }
]