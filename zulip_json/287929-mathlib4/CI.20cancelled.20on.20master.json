[
    {
        "content": "<p>I'm not sure why, but mathlib master currently is apparently not passing CI because of <a href=\"https://github.com/leanprover-community/mathlib4/pull/20412\">#20412</a> ? Maybe the red x is a red herring though?</p>\n<p><a href=\"/user_uploads/3121/ueTvob6B-w73ZgV0hqv4aP0D/Screenshot-from-2025-01-03-11-06-09.png\">Screenshot from 2025-01-03 11-06-09.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ueTvob6B-w73ZgV0hqv4aP0D/Screenshot-from-2025-01-03-11-06-09.png\" title=\"Screenshot from 2025-01-03 11-06-09.png\"><img data-original-dimensions=\"1033x149\" src=\"/user_uploads/thumbnail/3121/ueTvob6B-w73ZgV0hqv4aP0D/Screenshot-from-2025-01-03-11-06-09.png/840x560.webp\"></a></div>",
        "id": 491740884,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735902395
    },
    {
        "content": "<p>If you click on the <code>x</code> you can see that its red because some checks were skipped or cancelled, none actually failed (though of course something might fail if they do not get cancelled, who knows!). Why that happened I cannot tell you though.</p>",
        "id": 491741260,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1735902559
    },
    {
        "content": "<p>The PR itself got a green tick.</p>",
        "id": 491741413,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735902665
    },
    {
        "content": "<p>We have <a href=\"https://github.com/leanprover-community/mathlib4/blob/9082fa7b9f7bcad5b4b6052a629eb9347580073a/.github/workflows/build.yml#L34\">a step</a> which cancels CI runs on a commit if another commit is pushed to a branch containing it, which looks like it's the culprit here (it uses <a href=\"https://github.com/styfle/cancel-workflow-action\">this action</a>). I don't immediately see an easy way to exclude jobs being run on commits in <code>master</code>, though.</p>",
        "id": 491751955,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1735907944
    },
    {
        "content": "<p>I had seen a red cross on master already, but had not tracked it down to the \"cancel previous workflows!\" action: thanks for the explanation, Bryan!</p>",
        "id": 491754249,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735909093
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Persistent.20.23allow_unused_tactic/near/491751955\">said</a>:</p>\n<blockquote>\n<p>We have <a href=\"https://github.com/leanprover-community/mathlib4/blob/9082fa7b9f7bcad5b4b6052a629eb9347580073a/.github/workflows/build.yml#L34\">a step</a> which cancels CI runs on a commit if another commit is pushed to a branch containing it, which looks like it's the culprit here (it uses <a href=\"https://github.com/styfle/cancel-workflow-action\">this action</a>). I don't immediately see an easy way to exclude jobs being run on commits in <code>master</code>, though.</p>\n</blockquote>\n<p>This <em>definitely</em> is something that is possible with github actions, let me see if i can find this...</p>",
        "id": 491755624,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735909695
    },
    {
        "content": "<p>Ah, re-reading my message, I may have worded it poorly. It's not that we want to exclude the job from being triggered from <code>master</code>, it's that we don't want the action which cancels CI jobs to cancel CI on commits that are on <code>master</code>...</p>",
        "id": 491755788,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1735909787
    },
    {
        "content": "<p>i see... i still think that's possible</p>",
        "id": 491755867,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735909815
    },
    {
        "content": "<p>let me look into it</p>",
        "id": 491755877,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735909821
    },
    {
        "content": "<p>I think that'll be the same in practice, no?</p>",
        "id": 491755981,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735909888
    },
    {
        "content": "<p>i hope <a href=\"https://github.com/leanprover-community/mathlib4/pull/20435\">#20435</a> should stop the cancelling of <code>master</code> building...</p>",
        "id": 491759340,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735911467
    },
    {
        "content": "<p>20 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Persistent.20.23allow_unused_tactic\">#mathlib4 &gt; Persistent #allow_unused_tactic</a> by <span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span>.</p>",
        "id": 491759711,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735911658
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/CI.20cancelled.20on.20master/near/491755981\">said</a>:</p>\n<blockquote>\n<p>I think that'll be the same in practice, no?</p>\n</blockquote>\n<p>I'm probably still not explaining this well, but see <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/12596405362/job/35107437031#step:2:24\">this log</a> where pushing to <a href=\"https://github.com/leanprover-community/mathlib4/tree/refs/heads/RD_compProdApply\">a different branch</a> caused the CI on <a href=\"https://github.com/leanprover-community/mathlib4/commit/9082fa7b9f7bcad5b4b6052a629eb9347580073a\">this commit</a> on <code>master</code> to get canceled.</p>",
        "id": 491760452,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1735912043
    },
    {
        "content": "<p>Huh, that surprises me</p>",
        "id": 491760810,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735912241
    },
    {
        "content": "<p>from what i can tell, the cancelled CI is on a different branch, no?</p>",
        "id": 491760815,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735912245
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/H3IMJBdEB6dJGPqTBTtUqebG/image.png\">image.png</a><br>\nthis seems to suggest the cancelled run belongs to <code>RD_compProdApply</code>?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/H3IMJBdEB6dJGPqTBTtUqebG/image.png\" title=\"image.png\"><img data-original-dimensions=\"1207x197\" src=\"/user_uploads/thumbnail/3121/H3IMJBdEB6dJGPqTBTtUqebG/image.png/840x560.webp\"></a></div>",
        "id": 491760913,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735912296
    },
    {
        "content": "<p>apparently, github GUI is not as intuitive as i thought</p>",
        "id": 491761188,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735912426
    },
    {
        "content": "<p>it does make sense that the <code>cancel previous CI</code> step gets triggered in that case, it just doesn't <em>exactly</em> make sense that the step cancels the CI for a different branch</p>",
        "id": 491761635,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735912620
    },
    {
        "content": "<p>this seems like an issue with the implementation of the action...</p>\n<p>We could switch to using githubs <code>concurrency</code> option... specifically, we can have each workflow get put into the concurrency group of <code>$${{format('{1}.{2}',github.ref, (github.ref == 'refs/heads/master' &amp;&amp; github.run_id) || '')}}</code>? i <em>think</em> that might work</p>",
        "id": 491763285,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735913393
    },
    {
        "content": "<p>(and forego the current <code>cancel CI</code> job)</p>",
        "id": 491763509,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735913511
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/CI.20cancelled.20on.20master/near/491761188\">said</a>:</p>\n<blockquote>\n<p>apparently, github GUI is not as intuitive as i thought</p>\n</blockquote>\n<p>This summarizes <em>every</em> use that I made of github GUI.</p>",
        "id": 491765082,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735914317
    },
    {
        "content": "<p>Ah, I wasn't aware of the <code>concurrency</code> option. <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>",
        "id": 491765983,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1735914804
    },
    {
        "content": "<p>i'm guessing it got added at some point after we already were using the current action.</p>",
        "id": 491766438,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735915065
    },
    {
        "content": "<p>the page for the current action suggests to rather use the <code>concurrency</code> option, which is where i found out about it</p>",
        "id": 491766539,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735915101
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20435\">#20435</a> now contains an implementation using <code>concurrency</code></p>",
        "id": 491766842,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735915277
    }
]