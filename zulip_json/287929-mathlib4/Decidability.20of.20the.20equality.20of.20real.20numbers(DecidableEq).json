[
    {
        "content": "<p>The equality of real numbers is well known to be undecidable<br>\nBut in the mathlib, there is an instance Real.decidableEq.<br>\nAs far as I know, if it is not based on the axiom, existence of this instance means that there is a function taking 2 real numbers and computing  whether they are same or not.<br>\nHow could this instance be defined in mathlib?</p>\n<p>Following the definition of the Real.decidableEq, it is defined as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">decidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n</code></pre></div>\n<p>And it seems to be defined by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">LinearOrder</span><span class=\"bp\">.</span><span class=\"n\">decidableEq</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>And Real.linearOrder is defined by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">linearOrder</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lattice</span><span class=\"bp\">.</span><span class=\"n\">toLinearOrder</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n</code></pre></div>\n<p>However the function toLinearOrder is defined by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Lattice</span><span class=\"bp\">.</span><span class=\"n\">toLinearOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Lattice</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">DecidableLE</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableLT</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTotal</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toDecidableLE</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span>\n<span class=\"w\">  </span><span class=\"n\">toDecidableEq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span>\n<span class=\"w\">  </span><span class=\"n\">toDecidableLT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span>\n<span class=\"w\">  </span><span class=\"n\">le_total</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">total_of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">max_def</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">congr_fun₂</span><span class=\"w\"> </span><span class=\"n\">sup_eq_maxDefault</span>\n<span class=\"w\">  </span><span class=\"n\">min_def</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">congr_fun₂</span><span class=\"w\"> </span><span class=\"n\">inf_eq_minDefault</span>\n</code></pre></div>\n<p>Which requires the DecidableEq α as an instance.<br>\nCan someone explain how could Lean accept this definition?</p>",
        "id": 517588176,
        "sender_full_name": "Sehun Kim",
        "timestamp": 1747064447
    },
    {
        "content": "<p>It uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Classical.propDecidable#doc\">docs#Classical.propDecidable</a></p>",
        "id": 517588986,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747064612
    },
    {
        "content": "<p>Probably we should reorder those instances to be a bit clearer</p>",
        "id": 517589327,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747064676
    },
    {
        "content": "<p>in particular, it uses it at the definition of <code>Real.toLinearOrder</code></p>",
        "id": 517589351,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747064679
    },
    {
        "content": "<p>(see <a href=\"https://github.com/leanprover-community/mathlib4/blob/c7566386009c3d84ece0d34dbcaa816001b35e0d/Mathlib/Data/Real/Basic.lean#L468-L469\">here</a>)</p>",
        "id": 517589639,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747064738
    },
    {
        "content": "<p>Aha, it uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Classical.propDecidable#doc\">Classical.propDecidable</a> in somewhere, and it seems to be based on the axiom of excluded middle, if I understood correctly.</p>",
        "id": 517591569,
        "sender_full_name": "Sehun Kim",
        "timestamp": 1747065128
    }
]