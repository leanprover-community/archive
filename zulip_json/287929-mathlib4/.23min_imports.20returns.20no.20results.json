[
    {
        "content": "<p>I just stumbled across a case where #min_imports returns no results. Is this expected? MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">Limits</span>\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pushout</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span>\n</code></pre></div>",
        "id": 451844651,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721158545
    },
    {
        "content": "<p><code>example</code> leaves no trace in the environment, so there is nothing for <code>#min_imports</code> to see here.</p>",
        "id": 451845185,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721158703
    },
    {
        "content": "<p>Can this be added to the docstring of #min_imports?</p>",
        "id": 451845469,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721158788
    },
    {
        "content": "<p>Yes please! :-)</p>",
        "id": 451845833,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721158879
    },
    {
        "content": "<p>I decided to test the new \"linter\" <code>#min_imports</code> and it fails, but something strange happens.</p>\n<p>It suggests to import</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">Shapes</span><span class=\"bp\">.</span><span class=\"n\">Pullback</span><span class=\"bp\">.</span><span class=\"n\">HasPullback</span>\n</code></pre></div>\n<p>but then <code>pushout f g</code> complains that it could not find an instance <code>HasPushout f g</code>.  So, <code>#synth</code> tells me that the instance is defined in <code>Mathlib.CategoryTheory.Limits.HasLimits</code>, but adding that to the imports is still not enough for the instance!</p>",
        "id": 451863855,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721164146
    },
    {
        "content": "<p>Oh, sorry, I (and the linter) fell in the same trap!  The linter can use the <em><code>Syntax</code></em> information also for <code>example</code>s, but not the <code>Expr</code> information!  This is what it reports for <code>def</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">Shapes</span><span class=\"bp\">.</span><span class=\"n\">Countable</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n</code></pre></div>",
        "id": 451865176,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721164766
    },
    {
        "content": "<p>Maybe there should be a flag to <code>#min_imports</code> that makes it work also for <code>example</code>s...</p>",
        "id": 451865576,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721164928
    },
    {
        "content": "<p>Maybe it should alert if a file needs more imports when including examples than when excluding them</p>",
        "id": 451868709,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721166046
    },
    {
        "content": "<p>The current version of the linter is incremental: if flags every time that the \"imports so far\" are not sufficient for the next command.  This is close, but not exactly, what you are saying (assuming that I make it actually look at the <code>Expr</code> information on <code>example</code>s).</p>",
        "id": 451935871,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721193093
    },
    {
        "content": "<p>Is this good enough? I.e. an example should compile with whatever imports are sufficient for what precedes it?</p>",
        "id": 451935985,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721193137
    },
    {
        "content": "<p>(In any case, implementing this may be a separate, follow up PR, just to simplify reviewing.)</p>",
        "id": 451935993,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721193143
    }
]