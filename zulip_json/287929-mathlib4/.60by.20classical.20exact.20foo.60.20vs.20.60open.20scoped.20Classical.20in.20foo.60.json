[
    {
        "content": "<p>Do we have a preference between these spellings?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">classical</span><span class=\"w\"> </span><span class=\"n\">exact</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>\n<p>(context: <a href=\"https://github.com/leanprover-community/mathlib4/pull/23750#discussion_r2030328104\">https://github.com/leanprover-community/mathlib4/pull/23750#discussion_r2030328104</a>)</p>",
        "id": 510632814,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744023900
    },
    {
        "content": "<p><em>technically</em> don't use classical in a def, instead just put the decidability as an assumption</p>",
        "id": 510634437,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744024280
    },
    {
        "content": "<p>other than that, i don't think so?</p>",
        "id": 510634761,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744024359
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510634437\">said</a>:</p>\n<blockquote>\n<p><em>technically</em> don't use classical in a def, instead just put the decidability as an assumption</p>\n</blockquote>\n<p>I guess my example is bad, but there are plenty of cases where doing so would amount to assuming global LEM as an assumption, which seems pointless</p>",
        "id": 510636119,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744024697
    },
    {
        "content": "<p>Don't we have a convention to avoid tactic mode in definitions?</p>",
        "id": 510638455,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1744025289
    },
    {
        "content": "<p>Yes, that's a nice argument for avoiding <code>by exact classical</code>, but I don't know if in practice that convention has been applied in that way. Certainly I don't think tactic mode does any harm here, but I guess avoiding it is consistent</p>",
        "id": 510638783,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744025372
    },
    {
        "content": "<p><code>by classical; exact</code> (or similar) was not uncommon in defs in mathlib3</p>",
        "id": 510638804,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744025381
    },
    {
        "content": "<p>We didn't have the other spelling as an option in lean3 though</p>",
        "id": 510638887,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744025401
    },
    {
        "content": "<p>I would even prefer</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>\n<p>if the rest of the definition doesn't mind.</p>",
        "id": 510679348,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744034279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510638455\">said</a>:</p>\n<blockquote>\n<p>Don't we have a convention to avoid tactic mode in definitions?</p>\n</blockquote>\n<p>It isn't so much a convention rather than a rule we tell beginners to avoid them doing silly things</p>",
        "id": 510682877,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1744035007
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510679348\">said</a>:</p>\n<blockquote>\n<p>I would even prefer</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>\n<p>if the rest of the definition doesn't mind.</p>\n</blockquote>\n<p>I think this is worse as a general pattern, because it makes it much easier to accidentally use <code>Classical</code> in one of the assumptions by accident.</p>",
        "id": 510685217,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744035489
    },
    {
        "content": "<p>If we're worried about accidentally using the <code>Classical</code> stuff in another part, then what about introducing a notation <code>cif FermatsLastTheorem then 0 else 37</code>. Here <code>cif</code> stands for classical if, just like <code>bif</code> stands for boolean if.</p>",
        "id": 510686274,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1744035692
    },
    {
        "content": "<p>Or even <code>if classical FLT then ...</code> where <code>classical P</code> turns a prop classically into a boolean.</p>",
        "id": 510688233,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744036121
    },
    {
        "content": "<p>Maybe <code>classical</code> is not the right name for that <code>Prop -&gt; Bool</code>. Treat it as a placeholder...</p>",
        "id": 510688386,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744036148
    },
    {
        "content": "<p>That's going to create a much  nastier term than <code>cif</code> would</p>",
        "id": 510688424,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036159
    },
    {
        "content": "<p>So <code>if classical% FLT then ...</code>?</p>",
        "id": 510688535,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744036181
    },
    {
        "content": "<p>Oh, here's an idea:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">decidable</span>\n</code></pre></div>\n<p>then use <code>if Classical p</code></p>",
        "id": 510688899,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036259
    },
    {
        "content": "<p>But I think there are other situations where this isn't useful, and we're trying to solve a problem that doesn't really exist.</p>",
        "id": 510689029,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036291
    },
    {
        "content": "<p>The problem is not \"you wanted <code>Classical</code> in the condition but accidentally ended up with it in the branches too\", it's \"you wanted Classical in the definition but accidentally used it in the statement\"</p>",
        "id": 510689160,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036320
    },
    {
        "content": "<p>And we already have a solution to that problem, it's \"write <code>open scoped Classical</code> in the definition not the statement\"</p>",
        "id": 510689312,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036345
    },
    {
        "content": "<p>Maybe this</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical.propDecidable</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">FermatsLastTheorem</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>",
        "id": 510689679,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744036425
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510688386\">said</a>:</p>\n<blockquote>\n<p>Maybe <code>classical</code> is not the right name for that <code>Prop -&gt; Bool</code>. Treat it as a placeholder...</p>\n</blockquote>\n<p>We aren't trying to construct a term with <code>Bool</code>. We are trying to custruct an application of <code>ite</code> where the instance of <code>Decidable p</code> is <code>Classical.decidable</code>.</p>",
        "id": 510689797,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1744036444
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span>, That's a reasonable pattern too, but sometimes there are multiple instances needed and it's unreasonable to ask the user to write them out</p>",
        "id": 510689863,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036464
    },
    {
        "content": "<p>I think I see this <code>letI</code> thing many times in mathlib</p>",
        "id": 510689884,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744036469
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510689863\">said</a>:</p>\n<blockquote>\n<p>sometimes there are multiple instances needed and it's unreasonable to ask the user to write them out</p>\n</blockquote>\n<p>Yes, you're right. I just use <code>open scoped Classical in noncomputable def XXX := XXX</code></p>",
        "id": 510690034,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744036503
    },
    {
        "content": "<p>yes, and I claim you should not write that, you should write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">XXX</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">YYY</span>\n</code></pre></div>",
        "id": 510690127,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036526
    },
    {
        "content": "<p>Because otherwise you might accidentally pull in <code>Classical.decidable</code> into the <em>type</em> of <code>XXX</code></p>",
        "id": 510690181,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036541
    },
    {
        "content": "<blockquote>\n<p>sometimes there are multiple instances needed and it's unreasonable to ask the user to write them out</p>\n</blockquote>\n<p>But yes I see some definitions in mathlib with explicit listed <code>letI := ...</code> several lines.</p>",
        "id": 510690455,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744036594
    },
    {
        "content": "<p>I think most mathematicians will get very frustrated if asked to write that</p>",
        "id": 510690515,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744036611
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510690455\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>sometimes there are multiple instances needed and it's unreasonable to ask the user to write them out</p>\n</blockquote>\n<p>But yes I see some definitions in mathlib with explicit listed <code>letI := ...</code> several lines.</p>\n</blockquote>\n<p>Next time you see one, can you flag it on Zulip? I bet most of these are bad porting decisions due to confusion between <code>letI</code> in Lean 3 vs. Lean 4.</p>",
        "id": 510704946,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744040120
    },
    {
        "content": "<p>I don't think so, we use <code>letI</code> because it doesn't force us to choose a name</p>",
        "id": 510705361,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744040215
    },
    {
        "content": "<p>I'm not saying there aren't valid uses of <code>letI</code>; I'm saying that I bet most uses of <code>letI</code> in Mathlib currently are porting failures (but maybe I'm wrong).</p>",
        "id": 510706177,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744040424
    },
    {
        "content": "<p>I don't think the <em>majority</em> is anymore, although it certainly was at some point</p>",
        "id": 510706410,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1744040486
    },
    {
        "content": "<p>maybe it's <code>let _ := ...</code></p>",
        "id": 510706633,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744040546
    },
    {
        "content": "<p>I think I saw <code>let __ := ...</code> somewhere</p>",
        "id": 510719542,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744043967
    },
    {
        "content": "<p>What is double underscore means?</p>",
        "id": 510721979,
        "sender_full_name": "Jz Pan",
        "timestamp": 1744044750
    },
    {
        "content": "<p>It's an identifier, like <code>_a</code> or <code>foo</code> but it's <code>__</code></p>",
        "id": 510727594,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744046485
    },
    {
        "content": "<p>double underscore identifiers are hidden from the tactic state</p>",
        "id": 510745854,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744052439
    },
    {
        "content": "<p>i.e. <code>assumption</code> will not pick it up; but direct uses of the identifier by name work</p>",
        "id": 510746087,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744052500
    },
    {
        "content": "<p>I use <code>letI</code> mostly when I expect to be unfolding a <code>def</code> in a later proof and want to reduce how much infoview space it takes up...</p>",
        "id": 510779532,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1744065958
    },
    {
        "content": "<p>This has drifted away from the original topic, which is holding up <a href=\"https://github.com/leanprover-community/mathlib4/pull/23750\">#23750</a></p>",
        "id": 511528715,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744328798
    },
    {
        "content": "<p>/poll What's the preferred spelling for turning on classical logic in a term?</p>\n<ul>\n<li><code>by classical exact foo</code></li>\n<li><code>open scoped Classical in foo</code></li>\n<li>Author's choice<br>\n*</li>\n</ul>",
        "id": 511528790,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744328874
    },
    {
        "content": "<p>why <code>scoped</code>?</p>",
        "id": 511528877,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744328915
    },
    {
        "content": "<p>when it's a single if statement I see no advantage to the extra typing</p>",
        "id": 511528923,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744328948
    },
    {
        "content": "<p>Because opening the namespace as well is orthogonal, and more likely to cause harm than good</p>",
        "id": 511528939,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744328960
    },
    {
        "content": "<p>it's unlikely to do anything in extremely small scopes</p>",
        "id": 511528953,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744328976
    },
    {
        "content": "<p>I would optimize for making it easy to write here</p>",
        "id": 511528975,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744328990
    },
    {
        "content": "<p>should there be a <code>classical%</code> term constructor, if <code>by classical exact</code> is considered problematic?</p>",
        "id": 511529057,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329025
    },
    {
        "content": "<p>I don't even see where this \"don't use <code>by exact</code>\" rule came from</p>",
        "id": 511529073,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329040
    },
    {
        "content": "<p>For what it's worth, it about 40:60 between <code>open Classical in</code> and <code>open scoped Classical in</code> in mathlib</p>",
        "id": 511529092,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744329057
    },
    {
        "content": "<p>but the <code>classical</code> tactic was designed expressly for this purpose, so it seems wrong not to use it</p>",
        "id": 511529162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329114
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/511529073\">said</a>:</p>\n<blockquote>\n<p>I don't even see where this \"don't use <code>by exact</code>\" rule came from</p>\n</blockquote>\n<p>I think there are two parts to this:</p>\n<ul>\n<li><code>by</code> in data is often a trap for new users, so it's nicer to not have an exception for this</li>\n<li><code>by exact</code> delays elaboration in a way that can be surprising</li>\n</ul>",
        "id": 511529233,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744329151
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/511529162\">said</a>:</p>\n<blockquote>\n<p>but the <code>classical</code> tactic was designed expressly for this purpose, so it seems wrong not to use it</p>\n</blockquote>\n<p>Interestingly <code>classical</code> is slightly different; <code>open scoped Classical</code> opens everything, while <code>classical</code> only touches one instance and nothing else. I'm not sure how to list all the other things in the classical scope to tell if these are the same, but certainly only the former allows user extension</p>",
        "id": 511529314,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744329216
    },
    {
        "content": "<p>I definitely use <code>by</code> in data when it makes formatting easier. It's the tactics that are problematic (e.g. <code>rw</code>, <code>simp</code>), not the usage of <code>by</code></p>",
        "id": 511529325,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329223
    },
    {
        "content": "<p>if you are just using <code>refine</code> and <code>exact</code> I would say it is completely harmless</p>",
        "id": 511529392,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329246
    },
    {
        "content": "<p>I don't consider you an easily trapped new user :)</p>",
        "id": 511529401,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744329250
    },
    {
        "content": "<p>Regarding the difference between the two spellings, we could consider just redefining the <code>classical</code> tactic as a macro for <code>open scoped Classical in</code></p>",
        "id": 511529488,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744329303
    },
    {
        "content": "<p>I think it's okay even if the behavior is not user extensible, that means contrarily that people know what to expect and don't have to worry about contextual things when reading it in a proof</p>",
        "id": 511529792,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744329432
    },
    {
        "content": "<p>That sounds like an argument to not ever use <code>open scoped Classical</code></p>",
        "id": 511532702,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744330991
    },
    {
        "content": "<p>Which in turns suggests that perhaps the scope should just not do anything, to leave only the <code>by classical</code> (and perhaps <code>classical%</code>) spelling available.</p>",
        "id": 511532723,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744331010
    },
    {
        "content": "<p>Well I wouldn't go that far, <code>open Classical</code> works like <code>open Topology</code> or anything else, it puts a large and probably-not-in-local-cache list of things into the scope to be usable directly. It's a minor readability issue in exchange for fixing another readability issue that the names of theorems are too long</p>",
        "id": 511534167,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744331826
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60by.20classical.20exact.20foo.60.20vs.20.60open.20scoped.20Classical.20in.20foo.60/near/510719542\">said</a>:</p>\n<blockquote>\n<p>I think I saw <code>let __ := ...</code> somewhere</p>\n</blockquote>\n<p>I'm pretty sure that <code>__</code> causes it to not be picked up as an instance either.</p>\n<p>(We're planning on adding <code>let := ...</code> notation by the way, assuming it doesn't cause any difficulties. However, this would create a <code>this</code> variable that might conflict with an existing <code>have</code>'s variable; <code>let _ := ...</code> currently works and uses a fresh hygienic name at least.)</p>",
        "id": 511841568,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744489173
    },
    {
        "content": "<p>So it turns out that <code>classical</code> is <em>less</em> classical than <code>open scoped Classical</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"how_classical_am_i\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Priority: {‚Üê Lean.Meta.getInstancePriority? ``Classical.propDecidable}\"</span>\n\n<span class=\"sd\">/-- info: Priority: none -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">how_classical_am_i</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n\n<span class=\"sd\">/-- info: Priority: some (10) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">classical</span>\n<span class=\"w\">  </span><span class=\"n\">how_classical_am_i</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n\n<span class=\"sd\">/-- info: Priority: some (100) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"n\">how_classical_am_i</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">dont_do_this</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">propDecidable</span>\n\n<span class=\"sd\">/-- info: Priority: some (1000) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">how_classical_am_i</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n\n<span class=\"sd\">/-- info: Priority: some (10) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">classical</span><span class=\"w\"> </span><span class=\"c1\">-- this means \"make this less classical\" now!</span>\n<span class=\"w\">  </span><span class=\"n\">how_classical_am_i</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">dont_do_this</span>\n</code></pre></div>",
        "id": 511854510,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744501770
    },
    {
        "content": "<p>(where by \"less\" I mean \"even less willing to let the instance be chosen\")</p>",
        "id": 511854521,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744501797
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>, what do you think of replacing <code>classical</code> with something along the lines of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">classical</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>to make this difference (and the one I mention above about extendability) go away?</p>",
        "id": 511854588,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744501863
    },
    {
        "content": "<p>Interesting. Do I remember that you introduced <code>classical</code> to Lean 3 <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>? The fact we have <code>open scoped</code> now and it's able to create a low-priority instance makes having such a simple tactic implementation seem like a good idea.</p>\n<p>If I understand it correctly, <code>open scoped Classical in ...</code> is the pretty much the same as <code>classical ...</code> except for the priority (100 vs 10).</p>\n<p>Side note: I wish local instances could have priorities so that <code>classical</code> could be a tactic on its own, without having the following tacticSeq be part of its syntax.</p>",
        "id": 511867986,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744514224
    },
    {
        "content": "<p>What you're remembering is that I rewrote the lean3 tactic to behave more similarly to <code>open_locale classical</code>, but it was a bit of a hack</p>",
        "id": 511891110,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744536027
    },
    {
        "content": "<p>Yeah, so you can confirm that the specification for the version of <code>classical</code> that was ported was to mimic doing <code>open_locale classical</code> from within a proof, and the equivalent of <code>open_locale classical</code> in Lean 4 is <code>open scoped Classical</code>. So, now that <code>open scoped Classical</code> can actually appear within proofs now, perhaps we should work toward having <code>classical</code> have the ideal <code>open scoped Classical</code> implementation.</p>\n<p>I saw in another thread that using <code>open scoped Classical</code> doesn't work. Is core's priority for the classical decidability instances too high? Can we justify needing to change it?</p>",
        "id": 511928989,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744567318
    },
    {
        "content": "<p>(I also wonder if we could one day support <code>open scoped</code> from within proofs without any need for <code>in</code>. It's a little awkward how <code>classical</code> doesn't need a semicolon after it for one-liners.)</p>",
        "id": 511929277,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744567519
    },
    {
        "content": "<p>Can you link the thread? I would guess it is indeed too high</p>",
        "id": 511929936,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744567951
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Technical.20Debt.20Counters/near/511884103\">#mathlib4 &gt; Technical Debt Counters @ üí¨</a></p>",
        "id": 511931279,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744569164
    }
]