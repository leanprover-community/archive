[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> stumbled across some somewhat surprising behaviour today --- this might be called a feature, but the error messages are really ... not ideal. This behaviour has two parts.</p>\n<p>Part one is a <strong>hidden scratch file feature</strong> (which I had not seen before; is this new, e.g. a side effect of the new module system? is it intentional?). Basically,</p>\n<ul>\n<li>create a new file (in my case, <code>Mathlib/Geometry/Manifold/VectorField/Test.lean</code>)</li>\n<li>do not add this file to Mathlib.lean</li>\n<li>\n<p>add some basic content, but not copyright or module doc-strin<br>\n(example output: <code>\nimport Mathlib.Geometry.Manifold.VectorBundle.Basic\nopen scoped Manifold\n</code>)</p>\n</li>\n<li>\n<p>observe that there are <em>no linter errors</em></p>\n</li>\n<li>add the new file to Mathlib.lean</li>\n<li>reload, and see linter errors appearing</li>\n</ul>",
        "id": 527183482,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751636415
    },
    {
        "content": "<p>I have a theory why this happens: while the header linter is transitively imported in my test file, the configuration enabling it by default is set in the lakefile, which looks at Mathlib.lean, which does not include this file. (Is this correct?)<br>\nIs this desirable behaviour? (I can see an argument in favour, but am not sure yet.)</p>",
        "id": 527183772,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751636524
    },
    {
        "content": "<p>Part 2: you can only import files listed in <code>Mathlib.lean</code>. That one is definitely surprising to me, and I don't see it being a useful feature.</p>\n<ul>\n<li>remove your <code>Test.lean</code> file from <code>Mathlib.lean</code> again</li>\n<li>create a new file <code>Mathlib/Geometry/Manifold/VectorField/Test2.lean</code> with content <code>import Mathlib.Geometry.Manifold.VectorField.Test</code>; get an error:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">Manifold</span><span class=\"bp\">.</span><span class=\"n\">VectorBundle</span><span class=\"bp\">.</span><span class=\"n\">Test</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 527184112,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751636647
    },
    {
        "content": "<p>Doesn't the header linter use <code>Mathlib.lean</code> to decide what to lint?</p>",
        "id": 527194694,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751640639
    },
    {
        "content": "<p>I think that this was a response to make scratch files not annoyingly noisy.</p>",
        "id": 527194774,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751640664
    },
    {
        "content": "<p>I forget the details, but there is <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib%2FTactic%2FLinter%2FHeader.lean#L215\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib%2FTactic%2FLinter%2FHeader.lean#L215</a></p>",
        "id": 527195172,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751640801
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Linter.isInMathlib#doc\">docs#Mathlib.Linter.isInMathlib</a></p>",
        "id": 527195350,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751640865
    }
]