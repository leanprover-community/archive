[
    {
        "content": "<p>I'd like to use the mathlib instance that closed intervals are a smooth manifold, but everything I tried fails. Here's an MWE for just the <code>ChartedSpace</code> instance --- with three attempts which each throw different errors.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> uncommenting this line errors with</span>\n<span class=\"cm\">  tactic 'apply' failed, failed to unify</span>\n<span class=\"cm\">    ChartedSpace (EuclideanHalfSpace 1) ‚Üë(Set.Icc (@OfNat.ofNat ‚Ñù 0 Zero.toOfNat0) 1)</span>\n<span class=\"cm\">  with</span>\n<span class=\"cm\">    ChartedSpace (EuclideanHalfSpace 1) ‚Üë(Set.Icc (@OfNat.ofNat ‚Ñï 0 (instOfNatNat 0)) 1)</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- apply IccManifold 0 1</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- uncommenting this line errors with `failed to synthesize Fact (3 &lt; 4)`</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- apply IccManifold 3 4</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_add_one</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> uncommenting this line errors with</span>\n<span class=\"cm\">  application type mismatch</span>\n<span class=\"cm\">    @IccManifold 3 4 ‚ãØ</span>\n<span class=\"cm\">  argument</span>\n<span class=\"cm\">    h</span>\n<span class=\"cm\">  has type</span>\n<span class=\"cm\">    Fact (@OfNat.ofNat ‚Ñï 3 (instOfNatNat 3) &lt; 3 + 1) : Prop</span>\n<span class=\"cm\">  but is expected to have type</span>\n<span class=\"cm\">    Fact (@OfNat.ofNat ‚Ñù 3 instOfNatAtLeastTwo &lt; 4) : Prop -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- apply @IccManifold 3 4 h</span>\n</code></pre></div>",
        "id": 451837310,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721156463
    },
    {
        "content": "<p>Though, I'm more interested in this one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanHalfSpace</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Manifold</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SmoothManifoldWithCorners</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùì°</span><span class=\"bp\">‚àÇ</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> uncommenting this line errors with:</span>\n<span class=\"cm\">  tactic 'apply' failed, failed to unify</span>\n<span class=\"cm\">    SmoothManifoldWithCorners (modelWithCornersEuclideanHalfSpace 1) ‚Üë(Icc (@OfNat.ofNat ‚Ñù 0 Zero.toOfNat0) 1)</span>\n<span class=\"cm\">  with</span>\n<span class=\"cm\">    SmoothManifoldWithCorners (modelWithCornersEuclideanHalfSpace 1) ‚Üë(Icc (@OfNat.ofNat ‚Ñï 0 (instOfNatNat 0)) 1) -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- apply Icc_smooth_manifold 0 1</span>\n</code></pre></div>",
        "id": 451837339,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721156470
    },
    {
        "content": "<p>PS. I'm not sure if this should be <code>new members</code> or <code>mathlib4</code>. I'm putting it here on the grounds of \"I don't see anything obviously stupid, so can the mathlib instance be improved?\" --- please move it if the other location is better!</p>",
        "id": 451837418,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721156501
    },
    {
        "content": "<p>Context: I'm tinkering with defining (unoriented) bordism groups, to see how far mathlib is from the full definition. The most basic construction is the trivial cobordism $M\\times [0,1]$ (for a smooth closed $n$-manifold $M$); so I need to use that instance to even speak about it.</p>",
        "id": 451837744,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721156600
    },
    {
        "content": "<p>As the error message is trying to say, all the numbers you use are seen as natural numbers by Lean. So <code>Set.Icc 0 1</code> is an interval in natural numbers, definitely not a manifold. Use <code>(0 : </code>‚Ñù)` to help Lean understand what you mean, maybe.</p>",
        "id": 451843681,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1721158263
    },
    {
        "content": "<p>I swear I tried this at some point (when it didn't help). Trying it now worked like a charm... well, thanks for the help and sorry for the noise!</p>",
        "id": 451844873,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721158606
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> has marked this topic as resolved.</p>",
        "id": 451974437,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721202171
    }
]