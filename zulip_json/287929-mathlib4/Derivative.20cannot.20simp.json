[
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Calculus/Deriv/Basic.html\">Mathlib.Analysis.Calculus.Deriv.Basic</a> says that we can use \"simp\" to simplify the derviative of simple functions, but it's not the case.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 481635080,
        "sender_full_name": "Jiatong Yang",
        "timestamp": 1731302347
    },
    {
        "content": "<p>AFAICT, this was the case in Lean 3 but got lost during the port, I'm not sure why. It would be nice if someone investigates why this happens. E.g., you can try to prove <code>Differentiable</code> for both terms by <code>simp</code>, then find the simplest that fails.</p>",
        "id": 481637115,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1731303516
    },
    {
        "content": "<p>Yes, porting the differential calculus chapter of MIL was a pain because of this. I had to remove a lot of nice examples. But <span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span>’s tactics were meant to be a better replacement anyway.</p>",
        "id": 481690161,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731322732
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Derivative.20cannot.20simp/near/481690161\">said</a>:</p>\n<blockquote>\n<p>Yes, porting the differential calculus chapter of MIL was a pain because of this. I had to remove a lot of nice examples. But <span class=\"user-mention silent\" data-user-id=\"346070\">Tomas Skrivan</span>’s tactics were meant to be a better replacement anyway.</p>\n</blockquote>\n<p>I'm sorry, but where can I see Tomas Skrivan’s tactics?</p>",
        "id": 481713208,
        "sender_full_name": "Jiatong Yang",
        "timestamp": 1731329329
    },
    {
        "content": "<p>In the SciLean project.</p>",
        "id": 481722817,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731331963
    },
    {
        "content": "<p>We can easily get this behavior back by tagging a few more lemmas with <code>@[simp]</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">differentiableAt_sin</span><span class=\"w\"> </span><span class=\"n\">differentiableAt_cos</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 481734583,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1731335072
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18874\">#18874</a></p>",
        "id": 481739280,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1731336358
    },
    {
        "content": "<p>Yes, I wanted to say there is also hope that things got better with simp. The MIL port was very early and <code>simp</code> got a lot of work since then.</p>",
        "id": 481740680,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731336744
    }
]