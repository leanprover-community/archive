[
    {
        "content": "<p>I need quaternion algebras for FLT and people are looking for things to do, so I'm about to start on them. I'm stuck on the definition :-) If <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> is a field then a quaternion algebra over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> is a (non-commutative) <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>-algebra <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span> with centre <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>, 4-dimensional over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>, and having no nontrivial two-sided ideals. Everything else is fine, but are we able to talk about the lattice of two-sided ideals of a non-commutative ring yet?</p>",
        "id": 436665466,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714646965
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RingCon#doc\">docs#RingCon</a> has a lattice instance now <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 436666780,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1714647441
    },
    {
        "content": "<p>I assume <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=QuaternionAlgebra#doc\">docs#QuaternionAlgebra</a> doesn't work for you?</p>",
        "id": 436666893,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1714647481
    },
    {
        "content": "<p>That gives a construction, but Kevin wants a characteristic predicate, basically</p>",
        "id": 436667382,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714647641
    },
    {
        "content": "<p>Yes that's right, that's like asking if <code>iota -&gt; K</code> works for vector spaces over <code>K</code>. I am defining <code>IsQuaternionAlgebra</code></p>",
        "id": 436667416,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714647656
    },
    {
        "content": "<p>I'm guessing that asking for \"all the left-ideals of dimension different from two\" does not cut it, right?  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 436668416,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1714648049
    },
    {
        "content": "<p><code>IsSimpleOrder (RingCon K)</code> should capture \"no nontrivial two-sided ideals\" I think</p>",
        "id": 436668574,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1714648095
    },
    {
        "content": "<p>In a beautifully obscure way too :-)</p>",
        "id": 436668809,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714648179
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> your definition upstairs is for CSA's of degree 2, right? <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mi>K</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">M_2(K)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mclose\">)</span></span></span></span> is also an example.</p>",
        "id": 436669349,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714648352
    },
    {
        "content": "<p>(Not saying that is bad.)</p>",
        "id": 436669380,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714648369
    },
    {
        "content": "<p>But for me a quaternion algebra must be a division algebra...</p>",
        "id": 436669459,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714648398
    },
    {
        "content": "<p>Re: they're CSAs: Yes. I am in a slight quandary about all this. All I need is quaternion algebras over fields, and very quickly I will be needing things which are only true for quaternion algebras because I'll need assumptions about base extensions to the reals being the Hamiltonian quaternions. But I could do CSAs over fields or even Azumaya algebras over commutative rings.</p>\n<p>I think it's pretty standard to allow M_2(K) to be a quaternion algebra. It's just a division ring. I have two books on quaternion algebras in front of me and both allow M_2(K).</p>",
        "id": 436669693,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714648480
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/ciOssC7Dbl7GFDOOsnR8s7xA/Screenshot-from-2024-05-02-12-15-56.png\">Screenshot-from-2024-05-02-12-15-56.png</a><br>\nThat's Pierce \"Associative algebras\" which I think is the bible</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ciOssC7Dbl7GFDOOsnR8s7xA/Screenshot-from-2024-05-02-12-15-56.png\" title=\"Screenshot-from-2024-05-02-12-15-56.png\"><img src=\"/user_uploads/3121/ciOssC7Dbl7GFDOOsnR8s7xA/Screenshot-from-2024-05-02-12-15-56.png\"></a></div>",
        "id": 436669951,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714648582
    },
    {
        "content": "<p>Fair enough.</p>",
        "id": 436670109,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714648655
    },
    {
        "content": "<p>Also, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=QuaternionAlgebra#doc\">docs#QuaternionAlgebra</a> is wrong in characteristic 2 (in the sense that it doesn't agree with the literature, there are more examples than those), just like <code>EllipticCurve R</code> is wrong for a general commutative ring <code>R</code> (but also very useful)</p>",
        "id": 436674208,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1714650169
    },
    {
        "content": "<p>If you don't allow M_2(K) to be an example of a quaternion algebra, then it makes life difficult when you want to talk about tensoring with the completion of K at a prime, which is definitely going to be important for FLT. </p>\n<p>Lots of books / papers seem to square this circle by writing \"quaternion algebra\" for any deg 2 CSA, and \"quaternion <em>division</em> algebra\" when you really want to exclude M_2(K).</p>",
        "id": 436679313,
        "sender_full_name": "David Loeffler",
        "timestamp": 1714651916
    },
    {
        "content": "<p>Yeah, my opinion shouldn't be taken too seriously. I've never worked extensively with specifically quaternion algebras.</p>",
        "id": 436679729,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714652066
    },
    {
        "content": "<p>I would have said \"deg 2 CSA\". But I can understand why people prefer to call them \"quaternion algebra\". The name is much nicer.</p>",
        "id": 436679832,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714652102
    },
    {
        "content": "<p>And reserving \"quaternion division algebra\" for the division case seems like a good solution!</p>",
        "id": 436679910,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1714652129
    },
    {
        "content": "<p>I'm currently travelling with very little free time so I cannot finish the below but I believe it is correct and I think it is worth bearing in mind regarding the headline question:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Algebra.Module.Bimodule</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">MulOpposite</span> <span class=\"n\">TensorProduct</span>\n\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">local</span> <span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">TensorProduct.Algebra.module</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">D</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Ring</span> <span class=\"n\">D</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n    <span class=\"n\">Submodule</span> <span class=\"o\">(</span><span class=\"n\">D</span> <span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">ℤ</span><span class=\"o\">]</span> <span class=\"n\">D</span><span class=\"bp\">ᵐᵒᵖ</span><span class=\"o\">)</span> <span class=\"n\">D</span> <span class=\"bp\">≃</span><span class=\"n\">o</span> <span class=\"n\">RingCon</span> <span class=\"n\">D</span> <span class=\"n\">where</span>\n  <span class=\"n\">toFun</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n    <span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">↦</span> <span class=\"n\">x</span> <span class=\"bp\">-</span> <span class=\"n\">y</span> <span class=\"bp\">∈</span> <span class=\"n\">p</span>\n      <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"k\">fun</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">}</span> <span class=\"n\">h</span> <span class=\"bp\">↦</span> <span class=\"kd\">by</span> <span class=\"n\">simpa</span> <span class=\"n\">using</span> <span class=\"n\">p.neg_mem</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n        <span class=\"k\">fun</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">}</span> <span class=\"n\">hxy</span> <span class=\"n\">hyz</span> <span class=\"bp\">↦</span> <span class=\"kd\">by</span> <span class=\"n\">simpa</span> <span class=\"n\">using</span> <span class=\"n\">p.add_mem</span> <span class=\"n\">hxy</span> <span class=\"n\">hyz</span><span class=\"o\">⟩</span>\n      <span class=\"n\">mul'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">intro</span> <span class=\"n\">w</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span> <span class=\"n\">hwx</span> <span class=\"n\">hyz</span>\n        <span class=\"n\">replace</span> <span class=\"n\">hwx</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"bp\">-</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">∈</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"n\">Subbimodule.smul_mem'</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">op</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"n\">hwx</span>\n        <span class=\"n\">replace</span> <span class=\"n\">hyz</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"bp\">-</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"bp\">∈</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"n\">Subbimodule.smul_mem</span> <span class=\"n\">p</span> <span class=\"n\">x</span> <span class=\"n\">hyz</span>\n        <span class=\"n\">simpa</span> <span class=\"o\">[</span><span class=\"n\">sub_mul</span><span class=\"o\">,</span> <span class=\"n\">mul_sub</span><span class=\"o\">]</span> <span class=\"n\">using</span> <span class=\"n\">p.add_mem</span> <span class=\"n\">hwx</span> <span class=\"n\">hyz</span>\n      <span class=\"n\">add'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">intro</span> <span class=\"n\">w</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span>\n        <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">add_sub_add_comm</span><span class=\"o\">]</span>\n        <span class=\"n\">exact</span> <span class=\"n\">p.add_mem</span> <span class=\"o\">}</span>\n  <span class=\"n\">invFun</span> <span class=\"n\">r</span> <span class=\"o\">:=</span>\n    <span class=\"n\">Subbimodule.mk</span>\n      <span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"bp\">|</span> <span class=\"n\">r</span> <span class=\"n\">x</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n        <span class=\"n\">add_mem'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n          <span class=\"n\">intro</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span>\n          <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">Set.mem_setOf_eq</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span> <span class=\"bp\">⊢</span>\n          <span class=\"n\">simpa</span> <span class=\"n\">using</span> <span class=\"n\">r.add</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span>\n        <span class=\"n\">zero_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">r.refl</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n      <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">intro</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">h</span><span class=\"bp\">;</span> <span class=\"n\">simpa</span> <span class=\"n\">using</span> <span class=\"n\">r.mul</span> <span class=\"o\">(</span><span class=\"n\">r.refl</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n      <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">intro</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">h</span><span class=\"bp\">;</span> <span class=\"n\">simpa</span> <span class=\"n\">using</span> <span class=\"n\">r.mul</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"n\">r.refl</span> <span class=\"o\">(</span><span class=\"n\">unop</span> <span class=\"n\">a</span><span class=\"o\">)))</span>\n  <span class=\"n\">left_inv</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"c1\">-- This proof is sloooow for some reason</span>\n    <span class=\"n\">intro</span> <span class=\"n\">p</span>\n    <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">Set.mem_setOf_eq</span><span class=\"o\">,</span> <span class=\"n\">eq_mp_eq_cast</span><span class=\"o\">,</span> <span class=\"n\">id_eq</span><span class=\"o\">,</span> <span class=\"n\">smul_eq_mul</span><span class=\"o\">,</span> <span class=\"n\">eq_mpr_eq_cast</span><span class=\"o\">,</span> <span class=\"n\">cast_eq</span><span class=\"o\">,</span>\n      <span class=\"n\">smul_eq_mul_unop</span><span class=\"o\">]</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">RingCon.rel_mk</span><span class=\"o\">,</span> <span class=\"n\">Con.rel_mk</span><span class=\"o\">,</span> <span class=\"n\">sub_zero</span><span class=\"o\">]</span>\n    <span class=\"n\">rfl</span>\n  <span class=\"n\">right_inv</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"gr\">sorry</span>\n  <span class=\"n\">map_rel_iff'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">intro</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">Equiv.coe_fn_mk</span><span class=\"o\">,</span> <span class=\"n\">RingCon.le_def</span><span class=\"o\">,</span> <span class=\"n\">RingCon.rel_mk</span><span class=\"o\">,</span> <span class=\"n\">Con.rel_mk</span><span class=\"o\">]</span>\n    <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"k\">fun</span> <span class=\"n\">h</span> <span class=\"n\">x</span> <span class=\"n\">hx</span> <span class=\"bp\">↦</span> <span class=\"bp\">?</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"k\">fun</span> <span class=\"n\">h</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">}</span> <span class=\"bp\">↦</span> <span class=\"bp\">@</span><span class=\"n\">h</span> <span class=\"n\">_</span><span class=\"o\">⟩</span>\n    <span class=\"n\">specialize</span> <span class=\"bp\">@</span><span class=\"n\">h</span> <span class=\"n\">x</span> <span class=\"mi\">0</span>\n    <span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 436920306,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1714754256
    },
    {
        "content": "<p>I suspect RingCon is much faster in terms of elaboration, but that equivalence is certainly something we should have.</p>",
        "id": 436944284,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1714763721
    },
    {
        "content": "<p>Has there been any update on this?</p>",
        "id": 441261045,
        "sender_full_name": "Steven Rossi",
        "timestamp": 1716995383
    },
    {
        "content": "<p>+1. I have some undergraduate students working on central simple algebras and they're working around this for now. Jujian Zhang suggested making an instance of type <code>SetLike (RingCon R) R</code> :-) I have no idea what people like <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> will think of that!</p>",
        "id": 441270579,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1716998234
    },
    {
        "content": "<p>I'm about two weeks away from having some time to devote to ideals, but I don't see any immediate problem with having that instance.</p>",
        "id": 441271861,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1716998643
    },
    {
        "content": "<p>Can we somehow use the contents of this file? <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Bimodule.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Bimodule.html</a></p>",
        "id": 441271956,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1716998675
    },
    {
        "content": "<p>This has been discussed at length before (although it's understandable you haven't seen it). The issue is that we need ideals in <em>non-unital</em> rings too, which that approach doesn't allow for.</p>",
        "id": 441272104,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1716998724
    },
    {
        "content": "<p>Is there a reason that we haven't just introduced right and two sided ideals in the context of rings with identities just for the sake of users? Then we prove RingCon equivalence and introduce the non unital case later</p>",
        "id": 441285387,
        "sender_full_name": "Steven Rossi",
        "timestamp": 1717003857
    },
    {
        "content": "<p>Just asking because it seems like it was intended when Mathlib.RingTheory.Ideal.Basic was written based off the Todo</p>",
        "id": 441285476,
        "sender_full_name": "Steven Rossi",
        "timestamp": 1717003900
    },
    {
        "content": "<p>I'm certain that the general theory of ideals in mathlib was written by an undergraduate under my supervision in 2018 without any thought whatsoever going into how to deal with the non-commutative case. We needed them for schemes, which are built on the theory of commutative rings.</p>",
        "id": 441288990,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717005445
    },
    {
        "content": "<p>I have a summer student with the goal of contributing to mathlib.  The student is interested in algebra so I proposed looking into CSAs.</p>",
        "id": 441373949,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717042246
    },
    {
        "content": "<p>I think Azumaya algebras would be too much.</p>",
        "id": 441374262,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717042454
    },
    {
        "content": "<p>Is anyone working on implementing Wedderburn--Artin?  My student can start with that.</p>",
        "id": 441374269,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717042465
    },
    {
        "content": "<p>I agree that CSA/Quaternion algebra should include the split algebra M_n(K).</p>",
        "id": 441374452,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717042590
    },
    {
        "content": "<p>There's a bit of code in the flt repo that I believe relates to this, btw</p>",
        "id": 441381813,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1717046255
    },
    {
        "content": "<p>I have a working full proof the statement that every CSA is a matrix ring over a division ring, written last week by some students at Imperial. I'm seeing them today and I'll talk about PRing.</p>",
        "id": 441388072,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717049572
    },
    {
        "content": "<p>They also proved that the centre of the CSA and the division ring coincide. One of the people involved is currently in China for a short visit and this has held things up a bit</p>",
        "id": 441388242,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717049655
    },
    {
        "content": "<p>Happy to figure out how to collaborate here! We're only doing what I need for FLT, which is some concrete consequences regarding base change of quaternion algebras. We're following Bourbaki algebra chapter 8</p>",
        "id": 441388479,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717049774
    },
    {
        "content": "<p>I have stated Wedderburn--Artin (existence, not uniqueness) as a <code>proof_wanted</code> <a href=\"https://github.com/leanprover-community/mathlib4/blob/36a9da67e9f7d861837f652aba6820e33328a0df/Mathlib/RingTheory/SimpleModule.lean#L342-L347\">here</a>, but haven't got around to work on it (working on elliptic curves lately). I intended to follow <a href=\"https://en.wikipedia.org/wiki/Wedderburn%E2%80%93Artin_theorem#Proof\">the Wikipedia proof</a> and I'd be curious to see what the Imperial students came up with. Tackling the simple case first could be a way to structure the proof for the general (semisimple) case; it would be better to talk about simple artinian rings (without specifying a base field) instead of CSAs for this purpose, though. It's pretty easy to show a simple artinian ring is semisimple, and that a semisimple ring R that is isogeneous as an R-module (e.g. the matrix ring over a division ring) is simple:</p>\n<p><a href=\"/user_uploads/3121/T-pi-gcvQk-h-IWE2uPSTwFR/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/0a_F_IIUEdp0yaqpWC60ErTW/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/T-pi-gcvQk-h-IWE2uPSTwFR/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/T-pi-gcvQk-h-IWE2uPSTwFR/image.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/0a_F_IIUEdp0yaqpWC60ErTW/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/0a_F_IIUEdp0yaqpWC60ErTW/image.png\"></a></div><p>(from Lorenz's <a href=\"https://link.springer.com/book/10.1007/978-0-387-72488-1\">Algebra II</a>)</p>\n<p>I also have a <a href=\"#narrow/stream/287929-mathlib4/topic/Bases.20of.20topologies/near/423923141\">list of TODOs</a> once an IsTwoSided predicate (typeclass) is introduced.</p>",
        "id": 441520649,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717091992
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"252627\">@Jujian Zhang</span> or <span class=\"user-mention\" data-user-id=\"699016\">@Edison Xie</span> can you PR your proof that a CSA is a matrix ring over a division ring? And also the <code>SetLike (RingCon R) R</code> API?</p>",
        "id": 441530074,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1717095003
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> so does it make sense for me and my student to work on proving Wedderburn--Artin?</p>",
        "id": 441569769,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717107248
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/13401\">#13401</a> This is a PR about interpreting <code>RingCon</code> as two-sided ideals</p>",
        "id": 441580877,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1717112294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"716077\">Lior Silberman</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/441569769\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> so does it make sense for me and my student to work on proving Wedderburn--Artin?</p>\n</blockquote>\n<p><a href=\"https://github.com/ImperialCollegeLondon/FLT/blob/0ee1a45987dda283d6210c398dc17c9a9dd96eeb/FLT/for_mathlib/CrazySimple.lean#L573\">Here</a> is a version of Wedderburn--Artin (sorry free) `. The statement is the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">Wedderburn_Artin'</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsArtinianRing</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">simple</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSimpleOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingCon</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DivisionRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">≃+*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n</code></pre></div>\n<p><a href=\"https://github.com/ImperialCollegeLondon/FLT/blob/0ee1a45987dda283d6210c398dc17c9a9dd96eeb/FLT/for_mathlib/CrazySimple.lean#L746\">Here</a> is a version of Wedderburn--Artin (sorry-free as well). The statement is the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">--- the variables are not completely shown in the statement</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">Wedderburn_Artin_algebra_version</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">sim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSimpleOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingCon</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)]:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">div_ring</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DivisionRing</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n</code></pre></div>\n<p>Here <code>K</code> is a field, <code>B</code> a ring. <code>IsSimpleOrder (RingCon B)</code> is a weird way of saying <code>B</code> is a simple ring (in the sense that it has no non-trivial proper two-sided-ideals) and <code>M[Fin n, S]</code> is the n-by-n matrix with entries in <code>S</code>.</p>\n<p>But we <strong>don't</strong> have anything to say about <code>SemiSimple</code> rings</p>",
        "id": 441581301,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1717112509
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/441272104\">said</a>:</p>\n<blockquote>\n<p>This has been discussed at length before (although it's understandable you haven't seen it). The issue is that we need ideals in <em>non-unital</em> rings too, which that approach doesn't allow for.</p>\n</blockquote>\n<p>Disclaimer : I unfortunately did not read the discussion on two-sided-ideals. But the approach in <a href=\"https://github.com/leanprover-community/mathlib4/pull/13401\">#13401</a> works for nonunital rings in the sense that the following compiles</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonUnitalNonAssocRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SetLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingCon</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">coe_injective'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p><code>SetLike (RingCon R) R</code> works for any <code>NonUnitalNonAssocRing R</code>, and any <code>I : RingCon R</code> is an abelian group as well.<br>\nI am not sure if it works for a semiring though (because in the proof of <code>coe_injective'</code>, I used subtraction).</p>",
        "id": 441583954,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1717113787
    },
    {
        "content": "<p>I'm pretty sure the ideal model fails for semirings anyway; certainly you can't quotient by them any more (unlike <code>RingCon</code>, which you can).</p>",
        "id": 441584340,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1717113960
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"716077\">Lior Silberman</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/441569769\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> so does it make sense for me and my student to work on proving Wedderburn--Artin?</p>\n</blockquote>\n<p>I thinks we already have the proof in our file</p>",
        "id": 441600060,
        "sender_full_name": "Edison Xie",
        "timestamp": 1717122961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/441530074\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"252627\">Jujian Zhang</span> or <span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> can you PR your proof that a CSA is a matrix ring over a division ring? And also the <code>SetLike (RingCon R) R</code> API?</p>\n</blockquote>\n<p>I think Jujian made the SetLike theorem and the fact that CSA is a matrix ring over division ring follows from wedderburn?</p>",
        "id": 441600245,
        "sender_full_name": "Edison Xie",
        "timestamp": 1717123046
    },
    {
        "content": "<p>It appears that you proved Wedderburn--Artin for simple artinian rings but not for general semisimple rings. Here's an outline of the approach I have in mind:</p>\n<ul>\n<li>\n<p>First we want to decompose a semisimple module into a <strong>direct</strong> sum of simple submodules. To state this we should use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompleteLattice.Independent#doc\">docs#CompleteLattice.Independent</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompleteLattice.SetIndependent#doc\">docs#CompleteLattice.SetIndependent</a>: see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompleteLattice.independent_iff_dfinsupp_lsum_injective#doc\">docs#CompleteLattice.independent_iff_dfinsupp_lsum_injective</a>. We can show more generally that any submodule of a semisimple module is the supremum of an independent set of submodules, and the proof is by Zorn's lemma: there exists a maximal independent set contained in the submodule, whose supremum must equal the submodule, otherwise we can take a simple submodule in a complement of the supremum and add it to the independent set. This part is similar to the existence of a basis of a vector space.</p>\n</li>\n<li>\n<p>The number of summands isomorphic to a simple R-module (irreducible representation) S in a direct sum decomposition of a semisimple R-module M is an invariant (called multiplicity) and <a href=\"#narrow/stream/116395-maths/topic/Covolume.20of.20a.20Z-lattice/near/426275150\">can be defined</a> as the dimension (Module.rank) of <code>S →ₗ[R] M</code> over the division ring <code>(Module.End R S)ᵐᵒᵖ</code>. We may not need to define the multiplicity if we only care about existence of a decomposition into a product of matrix rings, not uniqueness.</p>\n</li>\n<li>\n<p>We can group together isomorphic summands to form isotypic components. This doesn't actually require a direct sum decomposition; you can simply take the sum (supremum) of all submodules isomorphic to a particular simple module, and no other simple module can appear as a submodule of this supremum (otherwise the projection of some summand to this submodule is nonzero, but there's no nonzero linear map between two different simple modules).</p>\n</li>\n<li>\n<p>If the semisimple module is finitely generated (Submodule.FG) then any direct sum decomposition can only have finitely many nonzero summands (in particular simple summands). (Proof: the generators only have nonzero components in finitely many summands; the other direct summands must be zero.) Any ring considered as a module over itself is generated by one element, 1. So a semisimple ring decomposes into a direct sum of finitely many simple modules over itself. </p>\n</li>\n<li>\n<p>From the proof in one of the pictures above, in a simple artinian ring we can take a minimal (nonzero) left ideal, which is a simple module, and the ring is a sum of isomorphic copies of this module, and therefore isotypic. Its direct sum decomposition into simples also consists solely of this simple module, and so it's isomorphic to a Finsupp module <code>ι →₀ S</code> (also isomorphic to <code>ι → S</code> since <code>ι </code> is finite), not just a DFinsupp/DirectSum. We have <code>Module.End R (ι →₀ S) ≃+* Matrix ι ι (Module.End R S)</code>, which together with <a href=\"https://github.com/ImperialCollegeLondon/FLT/blob/0ee1a45987dda283d6210c398dc17c9a9dd96eeb/FLT/for_mathlib/CrazySimple.lean#L212\">this isomorphism</a> concludes the proof of Wedderburn--Artin for simple artinian rings. For general semisimple rings there can be multiple isotypic components, and the whole endomorphism ring is the direct product of the endomorphism rings of the isotypic components.</p>\n</li>\n<li>\n<p>A CSA is by definition a finite dimensional algebra over a field, which is artinian by <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsArtinianRing.of_finite#doc\">docs#IsArtinianRing.of_finite</a>, and we can get rid of <a href=\"https://github.com/ImperialCollegeLondon/FLT/blob/0ee1a45987dda283d6210c398dc17c9a9dd96eeb/FLT/for_mathlib/CrazySimple.lean#L592\">this proof</a>.</p>\n</li>\n</ul>\n<p><span class=\"user-mention\" data-user-id=\"716077\">@Lior Silberman</span> If your student want to pursue this I can certainly review drafts and PR(s).</p>",
        "id": 441875026,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717230320
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> thanks! -- I'll have my student follow this approach.</p>",
        "id": 441959111,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717273577
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> the student is <span class=\"user-mention\" data-user-id=\"724854\">@Jiang Xu Wan</span></p>",
        "id": 442381919,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717451932
    },
    {
        "content": "<p>We'll follow the following outline</p>\n<ol start=\"0\">\n<li>Fix a (possibly non-commutative) ring <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> and an <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-module <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span>.</li>\n<li>For a simple <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-module <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> define the isotypic component <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> as the lattice join of the homomorphic images of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span>.</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is the direct sum of an independent set of homomorphic images; their number well-defined. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mrow><mi mathvariant=\"normal\">E</mi><mi mathvariant=\"normal\">n</mi><mi mathvariant=\"normal\">d</mi></mrow><mo stretchy=\"false\">(</mo><msub><mi>M</mi><mi>S</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathrm{End}(M_S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">End</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> is the matrix ring over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">E</mi><mi mathvariant=\"normal\">n</mi><mi mathvariant=\"normal\">d</mi></mrow><mi>R</mi></msub><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathrm{End}_R(S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">End</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span></span></span>.</li>\n<li>Any <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>-module homomorphism <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo>→</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">M\\to N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">N_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>.</li>\n<li>The <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mi>M</mi><mi>S</mi></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{M_S\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> are independent (i.e. their sum is direct).</li>\n<li>If <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> is semisimple and artinian, the sum of the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>M</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">M_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> (the complement would contain a simple module).</li>\n<li>If, further, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> is finitely generated only finitely many isotypic components are nonzero and each is of finite dimension.</li>\n<li>With these hypotheses <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">E</mi><mi mathvariant=\"normal\">n</mi><mi mathvariant=\"normal\">d</mi></mrow><mi>R</mi></msub><mo stretchy=\"false\">(</mo><mi>M</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathrm{End}_R(M)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">End</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mclose\">)</span></span></span></span>  is a finite product of matrix rings.</li>\n<li>If <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> is a semisimple artinian ring then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mtext>opp</mtext></msup><mo>≅</mo><msub><mrow><mi mathvariant=\"normal\">E</mi><mi mathvariant=\"normal\">n</mi><mi mathvariant=\"normal\">d</mi></mrow><mi>R</mi></msub><mo stretchy=\"false\">(</mo><mi>R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R^{\\textrm{opp}} \\cong \\mathrm{End}_R(R)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord textrm mtight\">opp</span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≅</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">End</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span></span></span></span>.</li>\n<li>Either (1) the opposite of a semisimple artinian ring is semisimple and artinian; or (2) the opposite of a product of matrix rings over division rings is a matrix ring over division rings.</li>\n</ol>",
        "id": 442400192,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717458340
    },
    {
        "content": "<p>Thanks for the outline; I just realized I was confusing \"isotypic\" with \"isogeneous\" <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> </p>\n<ul>\n<li>\n<ol start=\"2\">\n<li>if the number of simple direct summands is infinite, then it's not isomorphic to mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix#doc\">docs#Matrix</a>, which is simply the type of two-dimensional arrays without the restriction that each row only has finitely many nonzero elements, and which doesn't have a ring structure when the index type is infinite.</li>\n</ol>\n</li>\n<li>\n<ol start=\"5\">\n<li>doesn't need <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> to be artinian: mathlib knows a submodule (in particular the complement) of a semisimple module is semisimple, so if it's nonzero then it contains a simple submodule, because mathlib also knows a semisimple module is the supremum of all simple submodules.</li>\n</ol>\n</li>\n<li>\n<ol start=\"8\">\n<li>holds for any semiring, not necessary semisimple artinian. It's already shown in the CrazySimple branch, but <a href=\"https://live.lean-lang.org/#code=import%20Mathlib.Algebra.Module.LinearMap.End%0A%0Adef%20equivEndMop%20%7BR%7D%20%5BSemiring%20R%5D%20%3A%20R%20%E2%89%83%2B*%20(Module.End%20R%20R)%E1%B5%90%E1%B5%92%E1%B5%96%20where%0A%20%20toFun%20r%20%3A%3D%20.op%0A%20%20%20%20%7B%20toFun%20%3A%3D%20fun%20r'%20%E2%86%A6%20r'%20*%20r%0A%20%20%20%20%20%20map_add'%20%3A%3D%20fun%20_%20_%20%E2%86%A6%20right_distrib%20_%20_%20_%0A%20%20%20%20%20%20map_smul'%20%3A%3D%20fun%20_%20_%20%E2%86%A6%20mul_assoc%20_%20_%20_%20%7D%0A%20%20invFun%20f%20%3A%3D%20f.unop%201%0A%20%20left_inv%20%3A%3D%20one_mul%0A%20%20right_inv%20%3A%3D%20by%0A%20%20%20%20rintro%20%E2%9F%A8_%E2%9F%A9%3B%20apply%20MulOpposite.unop_injective%3B%20ext%3B%20exact%20one_mul%20_%0A%20%20map_mul'%20_%20_%20%3A%3D%20congr_arg%20MulOpposite.op%20%3C%7C%20by%20ext%3B%20symm%3B%20apply%20mul_assoc%0A%20%20map_add'%20_%20_%20%3A%3D%20congr_arg%20MulOpposite.op%20%3C%7C%20by%20ext%3B%20apply%20left_distrib\">here</a> is a computable construction.</li>\n</ol>\n</li>\n<li>\n<ol start=\"9\">\n<li>I think we need to show (2) to deduce Wedderburn--Artin and (1) will be a consequence of W--A. Semisimplicity of a ring is currently defined to mean the ring as a left module over itself is semisimple, and it's a nontrivial fact that it's equivalent to it being semisimple as a right module. It will also be a consequence that a semisimple ring is artinian (the <code>proof_wanted</code> <a href=\"https://github.com/leanprover-community/mathlib4/blob/ae0be75669055ab0f6b13dc09730cf5d263dc6de/Mathlib/RingTheory/Artinian.lean#L575\">here</a>) (but a simple ring might not be!). (Alternatively, the direct sum decomposition into finitely many simples shows it's of finite length, hence artinian.)</li>\n</ol>\n</li>\n</ul>",
        "id": 442434910,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717474814
    },
    {
        "content": "<p>Re: 9. Yes, I already realized that.  We'll prove (2) using the fact that the opposite of a division ring is also a division ring, and deduce (1) from the theorem</p>",
        "id": 442435279,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717475000
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Matrix, MulOpposite<br>\nhelped me find <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.transposeRingEquiv#doc\">docs#Matrix.transposeRingEquiv</a></p>",
        "id": 442435728,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717475240
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Basic.html#Matrix.isCentralScalar\">Matrix.isCentralScalar</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Basic.html#Matrix.transposeRingEquiv\">Matrix.transposeRingEquiv</a>, and <a href=\"https://loogle.lean-lang.org/?q=Matrix%2C%20MulOpposite\">27 more</a></p>",
        "id": 442435729,
        "sender_full_name": "loogle",
        "timestamp": 1717475241
    },
    {
        "content": "<p>Re: 3/5.  I would define a module to be semisimple if every submodule has a complement.  This would include an infinite direct sum of simple modules, among other things. </p>\n<p>Adding the artinian assumption means every submodule contains a simple one. </p>\n<p>If \"semisimple\" means \"finite direct sum of simple modules\" then you're right.</p>",
        "id": 442435745,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717475253
    },
    {
        "content": "<p>Yeah, I think the current mathlib definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsSemisimpleModule#doc\">docs#IsSemisimpleModule</a> is that the lattice of submodule is a complemented lattice.</p>",
        "id": 442435891,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717475331
    },
    {
        "content": "<p>But we do know a semisimple module is the supremum of its simple submodules: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsSemisimpleModule.sSup_simples_eq_top#doc\">docs#IsSemisimpleModule.sSup_simples_eq_top</a><br>\nas well as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsSemisimpleModule.submodule#doc\">docs#IsSemisimpleModule.submodule</a></p>",
        "id": 442436124,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717475462
    },
    {
        "content": "<p>Sorry, after my previous edit of <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/442434910\">the post</a> I didn't notice the wrong numbering produced by the way Zulip handles markdown ...</p>",
        "id": 442436368,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717475621
    },
    {
        "content": "<p>An infinite direct sum of simple modules is complemented but not artinian</p>",
        "id": 442436474,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717475670
    },
    {
        "content": "<p>I agree, I am only claiming that any semisimple module (not necessarily artinian) is the direct sum of its isotypic components.<br>\nIf the module is the ring itself, then it's f.g. and can't be an infinite direct sum, so it's a finite direct sum of simples and therefore of finite length and artinian.</p>",
        "id": 442436802,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717475868
    },
    {
        "content": "<p>Got it.  In 5,6 we'll assume f.g. = artinian (best add a proof of the equivalence), and then at step 8 will argue that a semisimple ring is f.g.</p>",
        "id": 442437026,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717476002
    },
    {
        "content": "<p>Regarding the opposite: it's not true that the opposite of a matrix ring is the same matrix ring -- it's the matrix ring over the opposite coefficient ring.  Is the proof you found for commutative coefficient rings?</p>",
        "id": 442437218,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717476111
    },
    {
        "content": "<p>Checked: it is</p>",
        "id": 442437406,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717476213
    },
    {
        "content": "<p>Yeah, commutativity comes from the CommSemigroup instance, so mathlib doesn't have the desired RingEquiv apparently ... I also found nothing with <code>Pi.semiring, MulOpposite</code>.</p>",
        "id": 442437788,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717476430
    },
    {
        "content": "<p>We can write one</p>",
        "id": 442437924,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717476499
    },
    {
        "content": "<p>At least we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulOpposite.instDivisionRing#doc\">docs#MulOpposite.instDivisionRing</a> ...</p>",
        "id": 442437978,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717476537
    },
    {
        "content": "<p>For 5 I'm claiming the following is true and I don't think you need to assume anything:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">SimpleModule</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSemisimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsSemisimpleModule</span><span class=\"bp\">.</span><span class=\"n\">sSup_simples_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">sSup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">le_antisymm</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">sSup_le</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">subtype</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"n\">IsSemisimpleModule</span><span class=\"bp\">.</span><span class=\"n\">sSup_simples_eq_top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">map_top</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">range_subtype</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">conv_lhs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">map_le_iff_le_comap</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">sSup_le</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">hS</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">map_le_iff_le_comap</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">le_sSup</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">map_le_iff_le_comap</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">comap_subtype_self</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">le_top</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_setOf</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hS</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"bp\">.</span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">equivMapOfInjective</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">injective_subtype</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hN</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">by_contra!</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hN</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IsSemisimpleModule</span><span class=\"bp\">.</span><span class=\"n\">sSup_simples_eq</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">sSup_empty</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">eq_empty_of_forall_not_mem</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n</code></pre></div>",
        "id": 442438315,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717476664
    },
    {
        "content": "<p>I'm not sure: I don't think a complemented lattice need have minimal elements.</p>",
        "id": 442438897,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1717476901
    },
    {
        "content": "<p>Hmm, it looks like <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/CompactlyGenerated/Basic.html#exists_setIndependent_of_sSup_atoms_eq_top\">exists_setIndependent_of_sSup_atoms_eq_top</a> directly gives a direct sum decomposition into simples, given <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsSemisimpleModule.sSup_simples_eq_top#doc\">docs#IsSemisimpleModule.sSup_simples_eq_top</a> (which is proved using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=isAtomistic_of_complementedLattice#doc\">docs#isAtomistic_of_complementedLattice</a>, which uses the fact that the lattice of submodules is a compactly generated complete modular lattice).</p>",
        "id": 442440293,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717477452
    },
    {
        "content": "<p>Okay, it's a bit cumbersome to convert between sSup of submodules of a submodule and sSup in the original module, but I've worked out a proof and updated my post above.</p>",
        "id": 442444902,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717479654
    },
    {
        "content": "<p><a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/442438315\">The proofs</a> can be simplified a lot using the atom(ist)ic API, and I opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/13636\">#13636</a>.</p>\n<p>Here's an easy way to see the submodule lattice of a semisimple R-module is atomic: every nonzero element generates a cyclic submodule isomorphic to R/I for some ideal I. Take a maximal ideal M containing I, then the submodule M/I of R/I has a complement, which must be isomorphic to (R/I)/(M/I)=R/M, a simple R-module.</p>",
        "id": 443484573,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1717862440
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> I'm running into an issue involving the definition of an isotypic component; in particular, I'm struggling to get the clauses to work properly. </p>\n<p>Here is one definition of isotypic component I've written: (I've written out multiple definitions of isotypic component and been playing around to see which one will lead to the easiest proofs later on, but the exact contents of the definitions are likely not creating the issue)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isotypic</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">sSup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>I am using this definition in the sum of all isotypic components of M:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isotypic_sup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSemisimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">sSup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">isotypic</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>The definition of isotypic component isn't perfect as we it only makes sense to talk about isotypic components when $S$ is a simple $R$-module, but when I add the clause [IsSimpleModule R S] to the definition of isotypic component and get: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isotypic</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">sSup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>then the above definition of isotypic_sup has an error, where the part I = isotypic S is labelled with the error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"kn\">instance</span>\n<span class=\"w\">  </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">↥</span><span class=\"n\">S</span>\n</code></pre></div>\n<p>In the end, I want to have the definition of isotypic component include the clause  [IsSimpleModule R S], so is there a way to resolve the above issue?</p>",
        "id": 446708748,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1719260450
    },
    {
        "content": "<p>Another independent issue concerning specific definition of isotypic is how to induce an instance of Module R N if we have (N : Submodule R M). I have found the instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Submodule/Basic.html#SubmoduleClass.module\">SubmoduleClass.module</a>, but I'm not quite sure how to use it.</p>\n<p>Edit: I might be able to work around this issue?</p>",
        "id": 446713265,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1719261456
    },
    {
        "content": "<blockquote>\n<p>when I add the clause [IsSimpleModule R S] to the definition of isotypic component and get: ... then the above definition of isotypic_sup has an error, where the part I = isotypic S is labelled with the error</p>\n</blockquote>\n<p>I think if you change <code>∃ (S : Submodule R M), IsSimpleModule R S ∧ I = isotypic S</code> to <code>∃ (S : Submodule R M) (_ : IsSimpleModule R S) : I = isotypic S</code> then the error should disappear. However, I don't recommend you add the clause [IsSimpleModule R S] to the definition of isotypic component.</p>\n<p>Comments on the definition of <code>isotypic</code>:</p>\n<ul>\n<li>It seems strange to make <code>R</code> and <code>M</code> implicit arguments</li>\n<li><code>Function.Bijective</code> is unnecessary (you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearEquiv.toEquiv#doc\">docs#LinearEquiv.toEquiv</a> + <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.bijective#doc\">docs#Equiv.bijective</a>)</li>\n<li>In mathlib you don't add assumptions to a def that isn't absolutely necessary, so for example here I wouldn't include [IsSimpleModule] in the def <code>isotypic</code>, nor include [IsSemisimpleModule] in <code>isotypic_sup</code>, to avoid creating unnecessary goals like the <code>IsSimpleModule R ↥S</code> that you encountered. In fact the unused_argument linter would probably complain if you do include them. When proving theorems about the defs, you are of course free to add whatever conditions needed.</li>\n</ul>\n<blockquote>\n<p>Another independent issue concerning specific definition of isotypic is how to induce an instance of Module R N if we have (N : Submodule R M). I have found the instance <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/Submodule/Basic.html#SubmoduleClass.module\">SubmoduleClass.module</a>, but I'm not quite sure how to use it.</p>\n</blockquote>\n<p>I don't think you need to explicit invoke the instance; it automatically endows <code>↥N</code> with an <code>R</code>-module structure given <code>N : Submodule R M</code>.</p>",
        "id": 446727999,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1719266610
    },
    {
        "content": "<p>The reason for restricting <code>isotypic(S)</code> to simple modules is that otherwise the two natural definitions<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∑</mo><mo stretchy=\"false\">{</mo><mi>N</mi><mo>⊂</mo><mi>M</mi><mo>:</mo><mi>N</mi><mo>≅</mo><mi>S</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\sum \\{ N\\subset M: N\\cong S\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"mopen\">{</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊂</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≅</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">}</span></span></span></span><br>\nand<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∑</mo><mo stretchy=\"false\">{</mo><mtext>Im</mtext><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo><msub><mo stretchy=\"false\">}</mo><mrow><mi>f</mi><mo>∈</mo><msub><mtext>Hom</mtext><mi>R</mi></msub><mo stretchy=\"false\">(</mo><mi>S</mi><mo separator=\"true\">,</mo><mi>M</mi><mo stretchy=\"false\">)</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\sum \\{ \\textrm{Im} (f) \\}_{f\\in\\textrm{Hom}_R(S,M)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1052em;vertical-align:-0.3552em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord textrm\">Im</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">}</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord textrm mtight\">Hom</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1433em;\"><span></span></span></span></span></span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span><br>\ndisagree</p>",
        "id": 446738544,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1719270536
    },
    {
        "content": "<p>Even worse, the theorem \"the sum of the isotypic components is direct\" would be false.</p>",
        "id": 446738770,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1719270675
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> I am aware that the <code>Function.Bijective</code> is unnecessary from the perspective that $f$ being a linear equivalence already means that it is bijective; the issue is that since I'm using an existential quantitier on $f$, I need to follow up with some proposition. Do you have any suggestions on how to fix this? i.e. is there a better way to write out that $S$ and $N$ need to be isomorphic to each other</p>",
        "id": 446739602,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1719271201
    },
    {
        "content": "<p>How about <code>Nonempty (S \\equiv N)</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Prelude.html#Nonempty\">https://leanprover-community.github.io/mathlib4_docs/Init/Prelude.html#Nonempty</a>)</p>",
        "id": 446740575,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1719271800
    },
    {
        "content": "<p>Then <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Logic/Nonempty.html#Nonempty.some\">Nonempty.some</a> gives you the linear equiv (via axiom of choice if you don't mind)</p>",
        "id": 446740682,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1719271853
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"716077\">Lior Silberman</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/446738770\">said</a>:</p>\n<blockquote>\n<p>Even worse, the theorem \"the sum of the isotypic components is direct\" would be false.</p>\n</blockquote>\n<p>Junyan's point above is that the theorem would not be false, because that theorem would have an <code>[IsSimpleModule]</code> argument!</p>",
        "id": 446753070,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719278877
    },
    {
        "content": "<p>The theorem would be true, but it would not match how mathematicians think here.  Instead of defining the notion from the literature we</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/446753070\">said</a>:</p>\n<blockquote>\n<p>Junyan's point above is that the theorem would not be false, because that theorem would have an <code>[IsSimpleModule]</code> argument!</p>\n</blockquote>\n<p>I understand that -- but this isn't the theorem the reader would expect.  I'm new here, so I'm happy to follow your lead, but that means first making an arbitrary generalization of a standard notion (which therefore should not be called \"isotypical component\" but something else), and then in every application adding an extra condition to return to the notion that is in use.</p>\n<p>We'll do as you say.</p>\n<p>If you are aware of any point in the literature where either generalization is used this would be different of course.</p>",
        "id": 446760251,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1719282021
    },
    {
        "content": "<p>It's the same principle as defining division without the requirement that the denominator must be nonzero, because we don't want to supply the nonzeroness condition every time we write <code>a/b</code>. When <code>b</code> is zero we just assign the junk value 0 to <code>a/b</code>. And we still call it division even though it doesn't satisfy what you expect of a division (e.g. <code>a/(a/b)=b</code> may not be true if <code>a=0</code>) outside of its intended domain, so I see no reason why we can't call the definition <code>isotypic</code> without the <code>IsSimpleModule</code> assumption. In <code>isotypic</code> we don't even need to assign any junk value using <code>if then else</code>, which is nice.</p>\n<p>Sometimes people choose junk values to make certain lemmas hold outside of the intended domain (e.g. 0⁻¹=0 makes <code>a⁻¹⁻¹=a</code> universally true, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=minpoly#doc\">docs#minpoly</a> is defined to make <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=minpoly.aeval#doc\">docs#minpoly.aeval</a> universally true but not <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=minpoly.monic#doc\">docs#minpoly.monic</a>), but that's not a requirement.</p>",
        "id": 446770946,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1719287982
    },
    {
        "content": "<p>One of my first lean experiences was defining the square root of a nonnegative real number as a sup and then being told that I should delete \"nonnegative\" in the definition because why make a function which demands an input and then never uses it? Turns out the sup of the empty set was defined to be 0. It's a very common phenomenon in lean formalisation to define things in more generality than makes mathematical sense. The hypotheses go in the theorems, not the definitions, in the model of formalisation which mathlib uses</p>",
        "id": 446780038,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719293095
    },
    {
        "content": "<p>Also, for example, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cfc#doc\">docs#cfc</a>. The fact that it doesn't take proposition arguments or bundled functions is a very important feature, in sharp contrast to the (mainly not for user consumption) <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cfcHom#doc\">docs#cfcHom</a></p>",
        "id": 446948530,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1719336430
    },
    {
        "content": "<p>So does any of you have the proof of uniqueness of wedderburn theorem yet?</p>",
        "id": 448022059,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719691188
    },
    {
        "content": "<p>We really need that :((</p>",
        "id": 448022067,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719691197
    },
    {
        "content": "<p>Can you formalise the statement?</p>",
        "id": 448026992,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719692691
    },
    {
        "content": "<p>of course we do we had it for decades no one can solve this</p>",
        "id": 448027556,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719692898
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">IsDiag</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"M[\"</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"s2\">\",\"</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Wedderburn_Artin_divisionRing_unique_algebra_version</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DivisionRing</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DivisionRing</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">iso</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 448027706,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719692975
    },
    {
        "content": "<p>This doesn't compile :-(</p>",
        "id": 448031304,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719694882
    },
    {
        "content": "<p>Our version of the theorem will have uniqueness</p>",
        "id": 448033440,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1719696169
    },
    {
        "content": "<p>good to know :)</p>",
        "id": 448034047,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696388
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/448027556\">said</a>:</p>\n<blockquote>\n<p>of course we do we had it for decades no one can solve this</p>\n</blockquote>\n<p>You mean \"I can't solve this\", right? :-)</p>",
        "id": 448034148,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719696433
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/448034148\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/448027556\">said</a>:</p>\n<blockquote>\n<p>of course we do we had it for decades no one can solve this</p>\n</blockquote>\n<p>You mean \"I can't solve this\", right? :-)</p>\n</blockquote>\n<p>I mean no one in our group could :((</p>",
        "id": 448034257,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696478
    },
    {
        "content": "<p>Do you have a maths proof?</p>",
        "id": 448034361,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719696501
    },
    {
        "content": "<p>Yes but we somehow just stuck at the simple module part I sent u earlier</p>",
        "id": 448034416,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696526
    },
    {
        "content": "<p>All the other parts are working now</p>",
        "id": 448034465,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696543
    },
    {
        "content": "<p>What's the simple module part?</p>",
        "id": 448034519,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719696562
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"M[\"</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"s2\">\",\"</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">R</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">](</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\">  </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">map_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id_apply</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">commutes</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id_apply</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">commutes</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">map_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_smul</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mul_apply</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">LinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">map_smul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">commutes</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mul_smul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_smul</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">add_apply</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">commutes'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OneHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mul_apply</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMapClass</span><span class=\"bp\">.</span><span class=\"n\">map_smul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">smul_def'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">map_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MonoidHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OneHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mul_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AddHom</span><span class=\"bp\">.</span><span class=\"n\">coe_mk</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DivisionRing</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Wdb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">ᵐᵒᵖ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>this</p>",
        "id": 448034680,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696611
    },
    {
        "content": "<p>Do you have a maths proof?</p>",
        "id": 448034796,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1719696661
    },
    {
        "content": "<p>and the proof is in <a href=\"https://stacks.math.columbia.edu/tag/074E\">https://stacks.math.columbia.edu/tag/074E</a> here, lemma 11.4.6 (4)</p>",
        "id": 448034821,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696669
    },
    {
        "content": "<p>and the equivalence in the</p>\n<p><span class=\"user-mention silent\" data-user-id=\"699016\">Edison Xie</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/448034821\">said</a>:</p>\n<blockquote>\n<p>and the proof is in <a href=\"https://stacks.math.columbia.edu/tag/074E\">https://stacks.math.columbia.edu/tag/074E</a> here, lemma 11.4.6 (4)</p>\n</blockquote>\n<p>and the equivalence setup in this is the file MoritaEquivalence in the repository I invited u in</p>",
        "id": 448035211,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696789
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span></p>",
        "id": 448035218,
        "sender_full_name": "Edison Xie",
        "timestamp": 1719696795
    },
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/14456\">#14456</a>, I tried to set up the lattice structure on two-sided ideal; however this results in a instance diamond: <code>TwoSidedIdeal</code> has two <code>PartialOrder</code> on it: one from <code>SetLike</code> instance, the other from <code>CompleteLattice</code> structure. Is there anyway to avoid this? Should I just <code>attribute [-instance] SetLike.partialOrder</code> or something?</p>",
        "id": 449360242,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720199786
    },
    {
        "content": "<p>But they have the same data, right? So can you spread the <code>SetLike.partialOrder</code> instance into the complete lattice instance?</p>",
        "id": 449360585,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720199900
    },
    {
        "content": "<p>Thanks! Let me try.</p>",
        "id": 449360685,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720199942
    },
    {
        "content": "<p>I was using <code>Function.Injective.completeLattice</code> to get a lattice structure almost for free which resulted in the diamond. I think I will just hand-write the lattice structure instead.</p>",
        "id": 449361453,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720200148
    },
    {
        "content": "<p>Writing the instances by hand makes <code>SetLike.instPartialOrder</code> and <code>CompleteLattice.partialOrder</code> equal definitionally, thanks!</p>",
        "id": 449365395,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720201661
    },
    {
        "content": "<p>I'm surprised the setlike and pulled back definitions differ. What are they defeq to?</p>",
        "id": 449394341,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720212098
    },
    {
        "content": "<p>Using <code>Function.Injective.CompleteLattice</code> the partial order is given by <code>RingCon</code>’s order (ie propositional implication) since I am trying to pullback RingCon’s order; writing the instances by hand gives you the order by set inclusion. So defeq to SetLike.instPartialOrder.</p>",
        "id": 449394652,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720212292
    },
    {
        "content": "<p>Yeah I get that, and I would expect those to be the same</p>",
        "id": 449396864,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720212841
    },
    {
        "content": "<p>Ah no, I see</p>",
        "id": 449397635,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720213050
    },
    {
        "content": "<p>For any ring con I the set are the elements related to 0</p>",
        "id": 449397658,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720213062
    },
    {
        "content": "<p>So set inclusion is not literally propositional implication sadly.</p>",
        "id": 449397722,
        "sender_full_name": "Jujian Zhang",
        "timestamp": 1720213085
    },
    {
        "content": "<p>The ringcon version of <code>I &lt;= J</code> reduces to <code>forall a b, a ~_I b =&gt; a ~_J b</code> while the setlike version is <code>forall a, a ~_I 0 =&gt; a ~_J 0</code></p>",
        "id": 449397814,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720213158
    },
    {
        "content": "<p>Anyway I really think we should yeet <code>SetLike.instPartialOrder</code> out of existence</p>",
        "id": 449397854,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720213190
    },
    {
        "content": "<p>You mean write all the instances manually? Does it cause at least one more diamond? My impression is that the reason things are problematic here is that this is an innovative use of <code>SetLike</code>.</p>",
        "id": 449401751,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720215709
    },
    {
        "content": "<p>We also get issues with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UpperSet#doc\">docs#UpperSet</a> which is endowed with the order of reverse inclusion</p>",
        "id": 449403150,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720216623
    },
    {
        "content": "<p><code>SetLike.instPartialOrder</code> is like one of the original sins, since it creates data out of a prop</p>",
        "id": 449403208,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720216668
    },
    {
        "content": "<p>The docstring for UpperSet is the hugely unhelpful <code>The type of upper sets of an order.</code> BTW :-) (I have no idea what an upper set is, I thought that was the point of the docstring :-) )</p>",
        "id": 449403318,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720216714
    },
    {
        "content": "<p>Uh sorry <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> Will fix</p>",
        "id": 449403406,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720216802
    },
    {
        "content": "<p>Aha, having clicked through to IsUpperSet I now see the point. You want to model a as {x : a &lt;= x} or something, so smaller upper sets correspond to bigger elements of the order.</p>",
        "id": 449403450,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720216806
    },
    {
        "content": "<p>I thought you were busy for a week, I'll fix it if you like :-) I am currently on a war against bad documentation.</p>",
        "id": 449403506,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720216840
    },
    {
        "content": "<p>Yes, I am in the Baltic sea for another week, but apparently the Swedes are so modern that even the sea has 4G</p>",
        "id": 449403592,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720216901
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/two-sided.20ideals/near/449403506\">said</a>:</p>\n<blockquote>\n<p>I thought you were busy for a week, I'll fix it if you like :-) I am currently on a war against bad documentation.</p>\n</blockquote>\n<p>Please do!</p>",
        "id": 449403619,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720216922
    },
    {
        "content": "<p>So much for a break from lean :)</p>",
        "id": 449403658,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720216932
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/14467\">#14467</a></p>",
        "id": 449419420,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720227184
    },
    {
        "content": "<p>2 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/independent.20submodules\">#mathlib4 &gt; independent submodules</a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 449436390,
        "sender_full_name": "Notification Bot",
        "timestamp": 1720240017
    },
    {
        "content": "<p>I am also in favor of removing the partial order instance from <code>SetLike</code>. We just leave it as a reducible def and then use it in most places, but it shouldn't be forced.</p>",
        "id": 449493421,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1720271382
    },
    {
        "content": "<p>I'd argue it's a feature here, as it means you have the defeq that lets you write <code>hle hI : x \\mem J</code> where <code>hI : x \\mem I</code> and <code>hle : I ≤ J</code></p>",
        "id": 449579909,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720311032
    },
    {
        "content": "<p>This is arguably a big part of the API of ≤ across mathlib, whereas defeq with ringcon is more of an implementation detail</p>",
        "id": 449580399,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1720311178
    },
    {
        "content": "<p>Yeah, that's a good argument</p>",
        "id": 449584345,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1720315017
    },
    {
        "content": "<p>Hello. I have run into issues with two-sided ideals just now when trying to prove something about <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Ideals.20in.20a.20matrix.20ring\">matrix rings</a>. Currently the Jacobson radical of an ideal <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span> is defined only as a left ideal, but mathlib doesn't know that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span> is two-sided then so is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>J</mi><mo stretchy=\"false\">(</mo><mi>I</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">J(I)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span></span></span></span>. I just proved this, but I don't know how to <em>state</em> it in a non-awkward way: doing this needs some way of relating left and two-sided ideals. The two concepts are defined in quite different ways, and I couldn't find any way to relate them. Am I missing something? Is there any consensus on how this API should look?</p>\n<p>What I have proved is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">jacobson_mem_mul_right</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">I_mem_mul_right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I.jacobson</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I.jacobson</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n</code></pre></div>\n<p>Since there is no <code>IsTwoSided</code> predicate, I had to state right-absorption explicitly. If <a href=\"https://github.com/leanprover-community/mathlib4/pull/14460\">#14460</a> were merged, should I use <code>(I : TwoSidedIdeal R).asIdeal.jacobson</code> here?</p>",
        "id": 473616764,
        "sender_full_name": "𝚠𝚘𝚓𝚌𝚒𝚎𝚌𝚑 𝚗𝚊𝚠𝚛𝚘𝚌𝚔𝚒",
        "timestamp": 1727680135
    },
    {
        "content": "<p>I think you should just make the Jacobson radical into a <code>TwoSidedIdeal</code>. That being said, you probably can't do this yet, as the API isn't sufficiently developed.</p>",
        "id": 473712372,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1727699373
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> the problem is that it's not always two-sided, afaict (but do correct me if that's wrong); you need the base ideal to also be two sided. So such a change would make the definition less general.</p>",
        "id": 473767233,
        "sender_full_name": "𝚠𝚘𝚓𝚌𝚒𝚎𝚌𝚑 𝚗𝚊𝚠𝚛𝚘𝚌𝚔𝚒",
        "timestamp": 1727709276
    },
    {
        "content": "<p>Sorry, I tried to be quick because I was walking in to teach a class. What I mean is this: you can create a <code>TwoSidedIdeal.jacobson</code> whose argument and conclusion are <code>TwoSidedIdeal</code>s, and then you can prove for <code>I : TwoSidedIdeal R</code>, that <code>I.jacobson.asIdeal = I.asIdeal.jacobson</code>.</p>\n<p>Also, we should probably have a constructor that takes an <code>I : Ideal R</code> and a proof that <code>∀ x y, x ∈ I → x * y ∈ I</code> and produces a <code>TwoSidedIdeal</code>, but I don't think that appears in <a href=\"https://github.com/leanprover-community/mathlib4/pull/14460\">#14460</a>.</p>",
        "id": 473781343,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1727712166
    },
    {
        "content": "<p>I see. Would it also make sense to have a predicate <code>IsTwoSided (I : Ideal R) := ∃ (J : TwoSidedIdeal R), I = J.asIdeal</code>?</p>",
        "id": 473805762,
        "sender_full_name": "𝚠𝚘𝚓𝚌𝚒𝚎𝚌𝚑 𝚗𝚊𝚠𝚛𝚘𝚌𝚔𝚒",
        "timestamp": 1727717366
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> I doubt it. However, a <code>CanLift</code> instance would definitely make sense.</p>",
        "id": 473810994,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1727719001
    },
    {
        "content": "<p>Ok, I did this in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17341\">#17341</a>.</p>",
        "id": 474123468,
        "sender_full_name": "𝚠𝚘𝚓𝚌𝚒𝚎𝚌𝚑 𝚗𝚊𝚠𝚛𝚘𝚌𝚔𝚒",
        "timestamp": 1727815169
    },
    {
        "content": "<p>I've proved <a href=\"https://en.wikipedia.org/wiki/Hopkins%E2%80%93Levitzki_theorem\">Hopkins–Levitzki</a> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17908\">#17908</a> and introduced the typeclass <code>Ideal.IsTwoSided</code> along the way (following <a href=\"#narrow/channel/287929-mathlib4/topic/Bases.20of.20topologies/near/423923141\">this outline</a>), which I'll probably extract as a dependent PR.</p>\n<p>How's it going with the development of <code>Isotypic</code> APIs? I plan to return to this soon.</p>",
        "id": 477651563,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1729256742
    },
    {
        "content": "<p>Oh, I didn't realize <span class=\"user-mention\" data-user-id=\"724854\">@Jiang Xu Wan</span>'s PR has been open since two months ago: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16216\">#16216</a></p>",
        "id": 479630180,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1730277465
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"724854\">@Jiang Xu Wan</span>, sincere apologies that your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16216\">#16216</a> has not been reviewed. Unfortunately our CI setup requires that PRs are made from branches of the main repository, rather than from forks.</p>",
        "id": 480550474,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730765860
    },
    {
        "content": "<p>I've just sent an invitation for write access to the repository for your github account <code>jxjwan</code>. Would you mind accepting that, and then pushing the branch to the main repo and recreating the PR? If you post here, hopefully it will then get some prompt review.</p>",
        "id": 480550661,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730765992
    },
    {
        "content": "<p>Sorry, I've been back in school since September, so I've been very busy. <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I have accepted your invitation. I am not entirely sure what to do next.</p>",
        "id": 480579424,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730784183
    },
    {
        "content": "<p>Do you have a copy of mathlib on your computer?</p>",
        "id": 480579550,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730784274
    },
    {
        "content": "<p>In that copy, please do the following:</p>\n<ul>\n<li><code>git checkout master</code> -- to make sure you are on the main branch</li>\n<li><code>git pull</code> -- to get the latest updates to mathlib</li>\n<li><code>git checkout -b jxjwan-isotopic</code> -- to create your own branch</li>\n<li>Now copy your changes from <a href=\"https://github.com/leanprover-community/mathlib4/pull/16216\">#16216</a> to this new branch</li>\n<li><code>git add &lt;filenames&gt;</code></li>\n<li><code>git commit</code></li>\n<li><code>git push</code></li>\n<li>and follow the instructions to create a pull request.</li>\n</ul>",
        "id": 480579759,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730784406
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/contribute/index.html\">https://leanprover-community.github.io/contribute/index.html</a> contains many more details on this process</p>",
        "id": 480579779,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730784420
    },
    {
        "content": "<p>It's all a bit difficult, but that's because we want to run a bunch of checks on every pull request, and that's currently a lot harder if they're made from a fork.</p>",
        "id": 480579885,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730784478
    },
    {
        "content": "<p>Thanks.  One lesson from our summer project is that it's best for the students to work directly off mathlib and not with a local fork</p>",
        "id": 480579965,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1730784490
    },
    {
        "content": "<p>My bad for making the wrong choice back in May</p>",
        "id": 480579991,
        "sender_full_name": "Lior Silberman",
        "timestamp": 1730784512
    },
    {
        "content": "<p>To be fair, our workflow is very non-standard.</p>",
        "id": 480580064,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730784572
    },
    {
        "content": "<p>I don't think I know how to get my changes into the new branch; I'm trying out a few things but it all doesn't seem to be affecting the branch.</p>",
        "id": 480584435,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730787366
    },
    {
        "content": "<p>If you have two separate directories on your computer, one with your own <em>fork</em> of mathlib, and the other with the new copy with the new branch, then you can just copy-paste changes.</p>",
        "id": 480585663,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730788142
    },
    {
        "content": "<p>I don't think I have separate directories on my computer? I'm confused as to how the stuff on my computer is connected to branches on github. How I made my fork originally was that I played with code on my computer, then put those changes on the github editor.</p>",
        "id": 480586137,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730788424
    },
    {
        "content": "<p>Aha, I see.</p>",
        "id": 480586314,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730788558
    },
    {
        "content": "<p>If you want, you could do the same thing, but on <a href=\"https://github.com/leanprover-community/mathlib4\">https://github.com/leanprover-community/mathlib4</a></p>",
        "id": 480586437,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730788618
    },
    {
        "content": "<p>But you can also use some git commands on your computer. Which will be easier in the long run.</p>",
        "id": 480586484,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730788651
    },
    {
        "content": "<p>Are you happy to run commands in a terminal? Or would you prefer to avoid using a terminal?</p>",
        "id": 480586525,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730788675
    },
    {
        "content": "<p>I could run commands in my terminal, but I don't really understand what I'm doing when I use commands in my terminal, so I can never tell when I do something wrong or when something worked.</p>",
        "id": 480586717,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730788775
    },
    {
        "content": "<p>Okay, I've now made <a href=\"https://github.com/leanprover-community/mathlib4/pull/18646\">https://github.com/leanprover-community/mathlib4/pull/18646</a>; can you check that this is proper?</p>",
        "id": 480595018,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730789672
    },
    {
        "content": "<p>Oh I see some of the effects of this kind of pull request now; review dog is finding some styling issues automatically!</p>",
        "id": 480607507,
        "sender_full_name": "Jiang Xu Wan",
        "timestamp": 1730790163
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"724854\">@Jiang Xu Wan</span> Yes, this is a PR from a mathlib branch. That looks alright!</p>",
        "id": 480619904,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730790652
    },
    {
        "content": "<p>We're (or probably it's just me) still suffering from the fact that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ideal#doc\">docs#Ideal</a> is an <code>abbrev</code> for <code>Submodule R R</code> because it means that in non-unital rings we can still only talk about <code>TwoSidedIdeal</code>s and not <code>Ideal</code>s.</p>",
        "id": 482086481,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731471811
    },
    {
        "content": "<p>This came up because I'm trying to define the hereditary C⋆-subalgebra generated by a given set <code>s</code>, and the natural way to do it is to make its carrier <code>(Ideal.span s).topologicalClosure ∩ star (Ideal.span s).topologicalClosure</code>.</p>",
        "id": 482086497,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731471816
    },
    {
        "content": "<p>I made a PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/18969\">#18969</a> to generalize only the definition of <code>Module</code> and <code>Submodule</code> to <code>NonUnitalSemiring</code>s, and it <a href=\"https://github.com/leanprover-community/mathlib4/pull/18969#issuecomment-2474441463\">slows down Mathlib by 2.55%</a>.<br>\nIt might get better or worse after we generalize all the lemmas ... Feel free to push to generalize whatever decls you want.</p>",
        "id": 482237813,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731523470
    },
    {
        "content": "<p>Thanks for starting this attempt! I really hope it ends up going the \"might get better\" path</p>",
        "id": 482250297,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731528096
    },
    {
        "content": "<p>Can we start with adding <code>SemigroupAction</code> alone?</p>",
        "id": 482252764,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731528943
    },
    {
        "content": "<p>Do you mainly want to test the performance impact of introducing SemigroupAction?</p>\n<p>I forgot that the main target is to generalize <code>Ideal</code>. I made the generalization and there are a few more breakages (most look like instance synthesis failure), but all are fixed by specifying certain arguments (or bumping maxHeartbeats to 400000 in one occasion).</p>",
        "id": 482263388,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731532808
    },
    {
        "content": "<p>I think <code>SemigroupAction</code> </p>\n<ul>\n<li>is something we need itself as a natural notion </li>\n<li>won't be a source of much if any regression (untested)</li>\n</ul>\n<p>It would be nice to tease out the most problematic instance synthesis chains by breaking things into smaller steps.</p>",
        "id": 482264388,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731533206
    },
    {
        "content": "<p>Ugh, I've been dreading adding all these non-unital actions. <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span> </p>\n<p>Thanks for starting to work on this though <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span></p>",
        "id": 482438297,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731603147
    },
    {
        "content": "<p>Actually I only added two (or three) non-unital actions ((Add)SemigroupAction and NonUnitalModule). I don't think there's anything else that is natural to add. If this looks promising please take over, because I'm not planning to spend much more time on this.</p>\n<p>In the meantime I'm still diagnosing the <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2468973201\">0.45/0.56%</a> slowdown in <strong>the actual two-sided ideal PR</strong> (see <a href=\"#narrow/channel/144837-PR-reviews/topic/.2317908.20Hopkins.E2.80.93Levitzki.20theorem/near/481508937\">this thread</a> for my experiments), e.g. I'm still not sure why RingTheory.AdjoinRoot got 52.34% slower. I tried to use the profiler to identify which decls get slower, but the outputs are irregular (sometimes longer with more items, sometimes shorter, making them hard to align) and results fluctuate. I'm now trying to use #count_heartbeats but it applies to one decl a time only, which is inconvenient if you want the data for all decls. Is there a convenient way to get heartbeat data, e.g. by extracting it from the !bench results? (Are \"instructions\" in the !bench results the same as heartbeats?)</p>",
        "id": 482454265,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731608113
    },
    {
        "content": "<p>Can you  (very briefly) remind me why we should want <code>Ideal.IsTwoSided</code> in addition to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TwoSidedIdeal#doc\">docs#TwoSidedIdeal</a> ? It seems like one of those situations where we're again asking type class synthesis to do something that should be baked into the type (e.g., <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsClosed#doc\">docs#IsClosed</a>).</p>",
        "id": 482456323,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731608887
    },
    {
        "content": "<p>I wonder if some of the performance hit in <a href=\"https://github.com/leanprover-community/mathlib4/pull/18969\">#18969</a> comes from changing <code>DistribMulAction</code> to extend <code>DistribSMul</code> instead of the existing (<code>priority := 100</code>) instance.</p>",
        "id": 482459374,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731610080
    },
    {
        "content": "<p>I'm working on extracting only the <code>SemigroupAction</code> material from <a href=\"https://github.com/leanprover-community/mathlib4/pull/18969\">#18969</a> into <a href=\"https://github.com/leanprover-community/mathlib4/pull/19046\">#19046</a></p>",
        "id": 482459460,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731610104
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482264388\">said</a>:</p>\n<blockquote>\n<ul>\n<li>won't be a source of much if any regression (untested)</li>\n</ul>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19046#issuecomment-2477408304\">https://github.com/leanprover-community/mathlib4/pull/19046#issuecomment-2477408304</a> <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 482486814,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731620030
    },
    {
        "content": "<p>It's not the worst I've ever seen, but given that we didn't generalize any lemmas here, it's a bit depressing.</p>",
        "id": 482486936,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731620082
    },
    {
        "content": "<p>Very interesting. In my mind, we only took a node in the instance graph and expanded it to two nodes joined by a single edge. Am I wrong?</p>",
        "id": 482488978,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731620955
    },
    {
        "content": "<p>I would guess that without <a href=\"https://github.com/leanprover/lean4/pull/2905\">lean4#2905</a> having landed, the cost includes some extra edges too</p>",
        "id": 482490078,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731621468
    },
    {
        "content": "<p>Then it should disappear on nightly-testing?</p>",
        "id": 482490260,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731621555
    },
    {
        "content": "<p>Yes, I think we should also profile the effect of this PR there.</p>",
        "id": 482490297,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731621580
    },
    {
        "content": "<blockquote>\n<p>...  I don't think there's anything else that is natural to add. ...</p>\n</blockquote>\n<p>Actually it would be natural to introduce DistribSemigroupAction too ...</p>",
        "id": 482522229,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731638960
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482456323\">said</a>:</p>\n<blockquote>\n<p>Can you  (very briefly) remind me why we should want <code>Ideal.IsTwoSided</code> in addition to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TwoSidedIdeal#doc\">docs#TwoSidedIdeal</a> ? It seems like one of those situations where we're again asking type class synthesis to do something that should be baked into the type (e.g., <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsClosed#doc\">docs#IsClosed</a>).</p>\n</blockquote>\n<p>Here are some reasons why TwoSidedIdeal would be a more cumbersome approach and not necessarily better performance-wise:</p>\n<p>To avoid duplication, if a declaration about quotient rings that currently assumes CommRing+Ideal can be generalized to the noncommutative setting, you'd like to change the assumptions to Ring+TwoSidedIdeal without keeping the original version. But there will be certain results in later files that don't generalize or you don't want to touch, and in order for the declarations in earlier files you generalized to continue to apply, you have to introduce a coercion that automatically converts an Ideal over a CommRing to a TwoSidedIdeal. However, if <code>I : Ideal R</code> then <code>R⧸I</code> makes sense (from <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Quotient/Defs.html#Submodule.hasQuotient\">Submodule.hasQuotient</a>) without the coercion (it's an AddCommGroup with a (left) R-Module structure), and I don't think it's possible to tell Lean to insert the coercion only when you want to consider the ring structure. The two quotients (with or without the coercion) are defeq but either you need to explicitly convert between them (with a LinearEquiv or else) or it can be another source of slowness (it's similar to (ab?)using the defeq between <code>↥E</code>, <code>↥E.toSubalgebra</code>, <code>↥E.toSubalgebra.toSubmodule</code> for an intermediate field E, for example).</p>\n<p>As of now, there have been no results about commutative quotient rings that have been generalized using TwoSidedIdeal as far as I know, while my PR does many generalizations. (Apparently you can't write <code>R⧸I</code> for <code>I : TwoSidedIdeal R</code> yet and have to write <code>I.ringCon.Quotient</code>.)</p>\n<p>Also, operations like <code>sup</code>, <code>inf</code>, <code>add</code>, <code>mul</code>, <code>pow</code> etc. are the same on TwoSidedIdeal as on Ideal, and it would be cumbersome to define them again for TwoSidedIdeal and awkward to coerce to the same type in order to perform the operations.</p>",
        "id": 482522231,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731638962
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482522231\">said</a>:</p>\n<blockquote>\n<p>Also, operations like <code>sup</code>, <code>inf</code>, <code>add</code>, <code>mul</code>, <code>pow</code> etc. are the same on TwoSidedIdeal as on Ideal, and it would be cumbersome to define them again for TwoSidedIdeal and awkward to coerce to the same type in order to perform the operations.</p>\n</blockquote>\n<p>I think we already have the first two of these on <code>TwoSidedIdeal</code> via <code>RingCon</code></p>",
        "id": 482617944,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731678772
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482490297\">said</a>:</p>\n<blockquote>\n<p>Yes, I think we should also profile the effect of this PR there.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> what do I need to do in order to accomplish that? I assume I just rebase this PR on top of nightly testing, and create a new PR, but I assume there won't be any run to bench against?</p>",
        "id": 482626516,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731681298
    },
    {
        "content": "<p>I would recommend merging rather than rebasing. I don't know for sure how the benchmarking tools work</p>",
        "id": 482626784,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731681369
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> Is there a way to benchmark something against nightly testing?</p>",
        "id": 482683360,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731699652
    },
    {
        "content": "<p>Benchmark the previous commit?</p>",
        "id": 482683448,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731699686
    },
    {
        "content": "<p>So, branch nightly testing, make a PR, <code>!bench</code>, then merge in the changes and <code>!bench</code> again?</p>",
        "id": 482683798,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731699839
    },
    {
        "content": "<p>I think you can just make a PR from nightly-testing itself, <code>!bench</code>, then merge the changes and do it again. You have to go into the speedcenter and select the two runs to compare after that</p>",
        "id": 482684009,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731699922
    },
    {
        "content": "<p>I have a script that will run the benchmark comparing two arbitrary commits. I'm not at a computer until Monday, but if someone asks again then I'll post it.</p>",
        "id": 482684160,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731699972
    },
    {
        "content": "<p>I adapted this from the <code>bench_summary</code> action: save this file</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Copyright (c) 2024 Damiano Testa. All rights reserved.</span>\n<span class=\"cm\">Released under Apache 2.0 license as described in the file LICENSE.</span>\n<span class=\"cm\">Authors: Damiano Testa</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Summary of `!bench` results</span>\n\n<span class=\"cm\">This file contains a script that converts data retrieved from the speed-center into a</span>\n<span class=\"cm\">shorter, more accessible format, and post a comment with this summary on github.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">BenchAction</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"sd\">/-- `Bench` is a structure with the data used to compute the `!bench` summary.</span>\n<span class=\"sd\">It contains</span>\n<span class=\"sd\">* a string `file` (that could be `build`, `lint` or `~Mathlib.Path.To.File`);</span>\n<span class=\"sd\">* an integer `diff` representing the change in number of instructions for `file`;</span>\n<span class=\"sd\">* a float `reldiff` representing the percentage change in number of instructions for `file`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Bench</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">file</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">diff</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"w\">  </span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">FromJson</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ToJson</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span>\n\n<span class=\"sd\">/-- `intDecs z exp prec` is a \"generic\" formatting of an integer `z`.</span>\n<span class=\"sd\">It writes `z` in the form `x.y * 10 ^ exp` (for non-negative integers `x`, `y` and `z`),</span>\n<span class=\"sd\">such that `y` has `prec` digits and returns</span>\n<span class=\"sd\">* the sign of `z` as a string (in fact, just either `+` or `-`);</span>\n<span class=\"sd\">* the integer `x`;</span>\n<span class=\"sd\">* the natural number `y` (that has `prec` digits).</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">intDecs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">prec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sgn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">sign</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sgn</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p10</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">prec</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">idec</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">p10</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">sgn</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"s2\">\"-\"</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"s2\">\"+\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">idec</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">prec</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">idec</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">prec</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- `formatDiff z` uses `intDecs` to format an integer `z` as `±x.y⬝10⁹`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">formatDiff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sgn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">intDigs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">decDigs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">intDecs</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"n\">s!</span><span class=\"s2\">\"{sgn}{intDigs}.{decDigs}⬝10⁹\"</span>\n\n<span class=\"sd\">/-- Convert a `Float` into a formatted string of the form `±z.w%`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">formatPercent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- shift by `2` twice: once to get a percentage, again for two decimal digits of precision</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sgn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">reldiff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">ofInt</span><span class=\"w\"> </span><span class=\"n\">sgn</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">reldiff</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sgn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">intDigs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">decDigs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">intDecs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sgn</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">reldiff</span><span class=\"bp\">.</span><span class=\"n\">toUInt32</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"c1\">-- the `if ... then ... else ...` makes sure that the output includes leading `0`s</span>\n<span class=\"w\">  </span><span class=\"n\">s!</span><span class=\"s2\">\"({sgn}{intDigs}.{if decDigs &lt; 10 then \"</span><span class=\"mi\">0</span><span class=\"s2\">\" else \"\"}{decDigs}%)\"</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: [(+0.00%), (+14.28%), (+0.20%), (-0.60%), (-0.08%), (+1.02%)]</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: [+0.0⬝10⁹, +1.0⬝10⁹, +30.200⬝10⁹, -0.460⬝10⁹]</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">floats</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mf\">0.002</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mf\">0.006</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mf\">8.253600406145226E-4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mf\">0.0102</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{floats.map formatPercent}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ints</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"bp\">^</span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">302</span><span class=\"bp\">*</span><span class=\"mi\">10</span><span class=\"bp\">^</span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">460000000</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{ints.map formatDiff}\"</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">`formatFile file` converts a `String` into a formatted string of the form `` `file` ``,</span>\n<span class=\"sd\">removing leading non-letters. It is expected that `~` is the only leading non-letter.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">formatFile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"`{file.dropWhile (!·.isAlpha)}`\"</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">`summary bc` converts a `Bench` into a formatted string of the form</span>\n<span class=\"sd\">``| `file` | ±x.y⬝10⁹ | ±z.w% |`` (technically, without the spaces).</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">summary</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bench</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">middle</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">formatFile</span><span class=\"w\"> </span><span class=\"n\">bc</span><span class=\"bp\">.</span><span class=\"n\">file</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">formatDiff</span><span class=\"w\"> </span><span class=\"n\">bc</span><span class=\"bp\">.</span><span class=\"n\">diff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">formatPercent</span><span class=\"w\"> </span><span class=\"n\">bc</span><span class=\"bp\">.</span><span class=\"n\">reldiff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"s2\">\"|\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"\"</span><span class=\"bp\">::</span><span class=\"n\">middle</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"\"</span><span class=\"o\">])</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">`toTable bcs` formats an array of `Bench`es into a markdown table whose columns are</span>\n<span class=\"sd\">the file name, the absolute change in instruction counts and the relative change as a percentage.</span>\n<span class=\"sd\">A typical entry may look like ``|`Mathlib.Analysis.Seminorm`|+2.509⬝10⁹|(+1.41%)|``.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toTable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bcs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Bench</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"|File|Instructions|%|</span><span class=\"se\">\\n</span><span class=\"s2\">|-|-:|:-:|\"</span>\n<span class=\"w\">  </span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bcs</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">summary</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">`toCollapsibleTable bcs roundDiff` is similar to `toTable bcs`, except that it returns</span>\n<span class=\"sd\">output enclosed in a `&lt;details&gt;&lt;summary&gt;` html-block.</span>\n<span class=\"sd\">The `&lt;summary&gt;` part tallies the number of entries in `bcs` whose instructions increased</span>\n<span class=\"sd\">resp. decreased by at least the amount `roundDiff`.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toCollapsibleTable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bcs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Bench</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">roundDiff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">s!</span><span class=\"s2\">\"&lt;details&gt;&lt;summary&gt;{bcs.size} files, Instructions {formatDiff &lt;| roundDiff * 10 ^ 9}</span><span class=\"se\">\\</span>\n<span class=\"s2\">    &lt;/summary&gt;</span><span class=\"se\">\\n\\n</span><span class=\"s2\">{toTable (bcs.qsort (·.diff &gt; ·.diff))}</span><span class=\"se\">\\n</span><span class=\"s2\">&lt;/details&gt;</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n\n<span class=\"sd\">/-- Assuming that the input is a `json`-string formatted to produce an array of `Bench`,</span>\n<span class=\"sd\">`benchOutput` returns the \"significant\" changes in numbers of instructions as a string. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">benchOutput</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">jsonInput</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">ofExcept</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Json</span><span class=\"bp\">.</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">jsonInput</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">fromJson?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Bench</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `head` contains the changes for `build` and `lint`,</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `data` contains the instruction changes for individual files:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- each filename is prefixed by `~`.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">head</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">partition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">file</span><span class=\"bp\">.</span><span class=\"n\">take</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"~\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Partition the `Bench`es into \"bins\", i.e. the subsets of all `Bench`es whose difference</span>\n<span class=\"w\">  </span><span class=\"c1\">-- in instructions lies in an interval `[n·10⁹, (n+1)·10⁹)`.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- The values `n` need not be consecutive: we only retain non-empty bins.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">grouped</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">groupByKey</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">diff</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"bp\">.</span><span class=\"n\">qsort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"m\">1</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toList</span>\n<span class=\"w\">  </span><span class=\"c1\">-- We consider `build` and `lint` as their own groups, in this order.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sortHead</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">head</span><span class=\"bp\">.</span><span class=\"n\">qsort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"n\">file</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">·</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">togetherSorted</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sortHead</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">grouped</span>\n<span class=\"w\">  </span><span class=\"c1\">-- For better formatting, we merge consecutive bins with just a single *file* into one.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- This covers the two steps `ts1` and `ts2`.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- For example, `[..., (bound₁, #[a₁]), (bound₂, #[a₂]), (bound₃, #[a₃]), ...]` gets collapsed to</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `[..., (none, #[a₁, a₂, a₃]), ...]`.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- The `boundᵢ` entry becomes `none` for the collapsed entries, so that we know that these</span>\n<span class=\"w\">  </span><span class=\"c1\">-- should be printed individually instead of inside a `&lt;details&gt;&lt;summary&gt;`-block.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- A single bin with just a single file is also marked with `none`, for the same reason.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ts1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">togetherSorted</span><span class=\"bp\">.</span><span class=\"n\">splitBy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ts2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">flatten</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">ts1</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"o\">[(</span><span class=\"n\">none</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">foldl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[])]</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ar</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ar</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">overall</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bound</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">gs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">ts2</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">overall</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">overall</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">bound</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"c1\">-- These entries are from \"singleton\" files in their range; we print them individually.</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">toTable</span><span class=\"w\"> </span><span class=\"n\">gs</span>\n<span class=\"w\">        </span><span class=\"c1\">-- These get a collapsible summary instead.</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">roundedDiff</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">toCollapsibleTable</span><span class=\"w\"> </span><span class=\"n\">gs</span><span class=\"w\"> </span><span class=\"n\">roundedDiff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"n\">overall</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- `addBenchSummaryComment PR repo tempFile` adds a summary of benchmarking results</span>\n<span class=\"sd\">as a comment to a pull request.  It takes as input</span>\n<span class=\"sd\">* the number `PR` and the name `repo` as a `String` containing the relevant pull-request</span>\n<span class=\"sd\">  (it reads and posts comments there)</span>\n<span class=\"sd\">* the `String` `tempFile` of a temporary file where the command stores transient information.</span>\n\n<span class=\"sd\">The code itself interfaces with the shell to retrieve and process json data and eventually</span>\n<span class=\"sd\">uses `benchOutput`.</span>\n<span class=\"sd\">Here is a summary of the steps:</span>\n<span class=\"sd\">* retrieve the last comment to the PR (using `gh pr view ...`),</span>\n<span class=\"sd\">* check if it was posted by `leanprover-bot`,</span>\n<span class=\"sd\">* try to retrieve the source and target commits from the url that the bot posts</span>\n<span class=\"sd\">  and store them in `source` and `target`,</span>\n<span class=\"sd\">* query the speed center for the benchmarking data (using `curl url`),</span>\n<span class=\"sd\">* format and filter the returned JSON data (various times),</span>\n<span class=\"sd\">  saving intermediate steps into `tempFile` (using `jq` multiple times),</span>\n<span class=\"sd\">* process the final string to produce a summary (using `benchOutput`),</span>\n<span class=\"sd\">* finally post the resulting output to the PR (using `gh pr comment ...`).</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">addBenchSummaryComment</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">source</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tempFile</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"benchOutput.json\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">CommandElabM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">source</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Found</span><span class=\"se\">\\n</span><span class=\"s2\">source: '{source}'</span><span class=\"se\">\\n</span><span class=\"s2\">target: '{target}'</span><span class=\"se\">\\n</span><span class=\"s2\">instead of two commit hashes.\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- retrieve the data from the speed-center</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">curlSpeedCenter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">SpawnArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"curl\"</span>\n<span class=\"w\">      </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">s!</span><span class=\"s2\">\"http://speed.lean-fro.org/mathlib4/api/compare/{source}/to/{target}?all_values=true\"</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">bench</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">curlSpeedCenter</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">writeFile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tempFile</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\".src\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">bench</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Extract all instruction changes whose magnitude is larger than `threshold`.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">threshold</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{10 ^ 9}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jq1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">SpawnArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"jq\"</span>\n<span class=\"w\">      </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-r\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--arg\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"thr\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">threshold</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"s2\">\".differences | .[] | ($thr|tonumber) as $th |</span>\n<span class=\"s2\">        select(.dimension.metric == </span><span class=\"se\">\\\"</span><span class=\"s2\">instructions</span><span class=\"se\">\\\"</span><span class=\"s2\"> and ((.diff &gt;= $th) or (.diff &lt;= -$th)))\"</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">tempFile</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\".src\"</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">firstFilter</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">jq1</span>\n<span class=\"w\">  </span><span class=\"c1\">-- we leave `tempFile.src` unchanged and we switch to updating `tempfile`: this is useful for</span>\n<span class=\"w\">  </span><span class=\"c1\">-- debugging, as it preserves the original data downloaded from the speed-center</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">writeFile</span><span class=\"w\"> </span><span class=\"n\">tempFile</span><span class=\"w\"> </span><span class=\"n\">firstFilter</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Write these in compact form, in the format suitable for `benchOutput`.</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jq2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">SpawnArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"jq\"</span>\n<span class=\"w\">      </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-c\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"[{file: .dimension.benchmark, diff: .diff, reldiff: .reldiff}]\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">tempFile</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">secondFilter</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">jq2</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">writeFile</span><span class=\"w\"> </span><span class=\"n\">tempFile</span><span class=\"w\"> </span><span class=\"n\">secondFilter</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jq3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">SpawnArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"jq\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-n\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"reduce inputs as $in (null; . + $in)\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">tempFile</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">thirdFilter</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">jq3</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">report</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">benchOutput</span><span class=\"w\"> </span><span class=\"n\">thirdFilter</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">report</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">BenchAction</span>\n\n<span class=\"c1\">-- run_cmd BenchAction.addBenchSummaryComment \"6d0e3011-c591-42e4-9ef6-5c94a9211134\" \"7a3268cc-0fa1-4bc2-bab4-4fdc6bd381f0\"</span>\n</code></pre></div>",
        "id": 482698316,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731706666
    },
    {
        "content": "<p>If you then replace in the last line (the one that is commented) the \"source\" and \"target\" that bench wants, it will print the report.</p>",
        "id": 482698410,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731706706
    },
    {
        "content": "<p>Note that it will create files called <code>benchOutput.json</code> with a few variations on your computer.</p>",
        "id": 482698489,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731706750
    },
    {
        "content": "<p>If it is useful to run this kind of command by inputting the commits to compare manually, I can restructure the action and expose this function.</p>",
        "id": 482698597,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731706807
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482684160\">said</a>:</p>\n<blockquote>\n<p>I have a script that will run the benchmark comparing two arbitrary commits. I'm not at a computer until Monday, but if someone asks again then I'll post it.</p>\n</blockquote>\n<p>Oh, oops, my script relies on admin privileges, sorry.</p>",
        "id": 482910542,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731890886
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> I tried to use the code above, but I didn't succeed. The commits I want to compare are:<br>\n<code>14ad97c5b4e4cfe6121add2d07614583fbf8d6ea</code> and <code>d4bfe2bbbe1c94de513d8813c1619953e00e230e</code></p>\n<p>If I substitute these strings directly in your <code>run_cmd</code> line, then I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Found</span>\n<span class=\"cm\">source: '14ad97c5b4e4cfe6121add2d07614583fbf8d6ea'</span>\n<span class=\"cm\">target: 'd4bfe2bbbe1c94de513d8813c1619953e00e230e'</span>\n<span class=\"cm\">instead of two commit hashes.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">BenchAction</span><span class=\"bp\">.</span><span class=\"n\">addBenchSummaryComment</span><span class=\"w\"> </span><span class=\"s2\">\"14ad97c5b4e4cfe6121add2d07614583fbf8d6ea\"</span><span class=\"w\"> </span><span class=\"s2\">\"d4bfe2bbbe1c94de513d8813c1619953e00e230e\"</span>\n</code></pre></div>\n<p>and if I try to format the commit hashes by inserting dashes and deleting the tails, I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">process 'jq' exited with code 5</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">BenchAction</span><span class=\"bp\">.</span><span class=\"n\">addBenchSummaryComment</span><span class=\"w\"> </span><span class=\"s2\">\"14ad97c5-b4e4-cfe6-121a-dd2d07614583\"</span><span class=\"w\"> </span><span class=\"s2\">\"d4bfe2bb-be1c-94de-513d-8813c1619953\"</span>\n</code></pre></div>\n<p>What have I done wrong?</p>",
        "id": 483359283,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1732052892
    },
    {
        "content": "<p>I have had a similar experience with the commits that you suggested in the \"header perf\" PR.  I am not sure what is going on, because the bot uses that information and succeeds on PRs...</p>",
        "id": 483359471,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732052971
    },
    {
        "content": "<p>Let me try to investigate some more.  I was also not able to get the URL that the script uses in the other case to work, so there may be an issue with the speed-center in these cases.</p>",
        "id": 483359545,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053001
    },
    {
        "content": "<p>(Btw, I think that it is the hashes with the dashes that should be used.)</p>",
        "id": 483359634,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053025
    },
    {
        "content": "<p>In your case, it seems that at least the target PR was not benchmarked:</p>\n<p><a href=\"/user_uploads/3121/Objg7UQjDkRP0d9J6Hpu1TGr/WhatsApp-Image-2024-11-19-at-21.52.02.jpeg\">WhatsApp Image 2024-11-19 at 21.52.02.jpeg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Objg7UQjDkRP0d9J6Hpu1TGr/WhatsApp-Image-2024-11-19-at-21.52.02.jpeg\" title=\"WhatsApp Image 2024-11-19 at 21.52.02.jpeg\"><img data-original-dimensions=\"1441x77\" src=\"/user_uploads/thumbnail/3121/Objg7UQjDkRP0d9J6Hpu1TGr/WhatsApp-Image-2024-11-19-at-21.52.02.jpeg/840x560.webp\"></a></div>",
        "id": 483359942,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053166
    },
    {
        "content": "<p>no, they both were, but I just figured out part of the problem. The hash that the speed center uses is <em>not</em> the commit hash.</p>",
        "id": 483360097,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1732053239
    },
    {
        "content": "<p>Ah, then I do not know why it is telling me that the target hash in your example is not available...</p>",
        "id": 483360215,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053280
    },
    {
        "content": "<p>Here is the <a href=\"http://speed.lean-fro.org/mathlib4/run-detail/27af5825-fff1-4911-a47e-59dfbed48db3\">first run</a> and the <a href=\"http://speed.lean-fro.org/mathlib4/run-detail/c2b490ed-aca1-4d0b-bdbf-c9d263020915\">second run</a></p>",
        "id": 483360277,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1732053317
    },
    {
        "content": "<p><a href=\"http://speed.lean-fro.org/mathlib4/compare/27af5825-fff1-4911-a47e-59dfbed48db3/to/e7b27246-a3e6-496a-b552-ff4b45c7236e?hash2=d4bfe2bbbe1c94de513d8813c1619953e00e230e\">http://speed.lean-fro.org/mathlib4/compare/27af5825-fff1-4911-a47e-59dfbed48db3/to/e7b27246-a3e6-496a-b552-ff4b45c7236e?hash2=d4bfe2bbbe1c94de513d8813c1619953e00e230e</a></p>",
        "id": 483360486,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1732053406
    },
    {
        "content": "<p>Ok, let me investigate.</p>",
        "id": 483360497,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053412
    },
    {
        "content": "<p>but</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">BenchAction</span><span class=\"bp\">.</span><span class=\"n\">addBenchSummaryComment</span><span class=\"w\"> </span><span class=\"s2\">\"27af5825-fff1-4911-a47e-59dfbed48db3\"</span><span class=\"w\"> </span><span class=\"s2\">\"c2b490ed-aca1-4d0b-bdbf-c9d263020915\"</span>\n</code></pre></div>\n<p>still fails for me (I pulled these strings from the URLs in the links above, because they had the correct format of dashes).</p>",
        "id": 483360509,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1732053417
    },
    {
        "content": "<p>The link that Matt sent has an extra <code>hash2=d4bfe2bbbe1c94de513d8813c1619953e00e230e</code> ending that confuses the script.</p>",
        "id": 483360593,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732053457
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/sq_4qlYvWsACtSxtFEojT2-s/Screenshot-2024-11-19-at-4.58.44PM.png\">Screenshot 2024-11-19 at 4.58.44 PM.png</a><br>\nYou need to click on the little scales icon and then search for the other commit.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/sq_4qlYvWsACtSxtFEojT2-s/Screenshot-2024-11-19-at-4.58.44PM.png\" title=\"Screenshot 2024-11-19 at 4.58.44 PM.png\"><img data-original-dimensions=\"2822x408\" src=\"/user_uploads/thumbnail/3121/sq_4qlYvWsACtSxtFEojT2-s/Screenshot-2024-11-19-at-4.58.44PM.png/840x560.webp\"></a></div>",
        "id": 483360844,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1732053586
    },
    {
        "content": "<p>okay, so the answer is that nightly testing essentially does nothing for us on <a href=\"https://github.com/leanprover-community/mathlib4/pull/19046\">#19046</a>: <a href=\"http://speed.lean-fro.org/mathlib4/compare/834c1088-3287-4592-b43e-fa9de6b15953/to/1b20f007-0679-4aaf-ba07-cf8168c2af15\">without nightly testing</a> and <a href=\"http://speed.lean-fro.org/mathlib4/compare/27af5825-fff1-4911-a47e-59dfbed48db3/to/e7b27246-a3e6-496a-b552-ff4b45c7236e?hash2=d4bfe2bbbe1c94de513d8813c1619953e00e230e\">with nightly testing</a></p>",
        "id": 483361163,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1732053698
    },
    {
        "content": "<p>You will get multiple hits but hopefully there is only one with whose little scale is not grayed out</p>",
        "id": 483361182,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1732053713
    },
    {
        "content": "<p>I think we have to dig into a bad file and step through the instance synthesis. I've run out of time for the day though.</p>",
        "id": 483361575,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1732053893
    },
    {
        "content": "<p>For the link that did not have the <code>hash2</code> ending, the script above works and gives</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>build</code></td>\n<td style=\"text-align: right;\">+515.897⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.32%)</td>\n</tr>\n<tr>\n<td><code>lint</code></td>\n<td style=\"text-align: right;\">+106.593⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.48%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.ChangeOfRings</code></td>\n<td style=\"text-align: right;\">+69.400⬝10⁹</td>\n<td style=\"text-align: center;\">(+19.32%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Presheaf.Pushforward</code></td>\n<td style=\"text-align: right;\">+42.799⬝10⁹</td>\n<td style=\"text-align: center;\">(+45.87%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Fourier.FourierTransformDeriv</code></td>\n<td style=\"text-align: right;\">+19.542⬝10⁹</td>\n<td style=\"text-align: center;\">(+4.62%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.FundamentalDomain</code></td>\n<td style=\"text-align: right;\">+10.875⬝10⁹</td>\n<td style=\"text-align: center;\">(+6.96%)</td>\n</tr>\n<tr>\n<td>&lt;details&gt;&lt;summary&gt;2 files, Instructions +7.0⬝10⁹&lt;/summary&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.Algebra.Module.LocalizedModule.Basic</code></td>\n<td style=\"text-align: right;\">+7.708⬝10⁹</td>\n<td style=\"text-align: center;\">(+4.03%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.GeometryOfNumbers</code></td>\n<td style=\"text-align: right;\">+7.294⬝10⁹</td>\n<td style=\"text-align: center;\">(+19.81%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<p>&lt;details&gt;&lt;summary&gt;3 files, Instructions +5.0⬝10⁹&lt;/summary&gt;</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.Analysis.Convex.Between</code></td>\n<td style=\"text-align: right;\">+5.586⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.DedekindDomain.Different</code></td>\n<td style=\"text-align: right;\">+5.584⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.38%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Module.FinitePresentation</code></td>\n<td style=\"text-align: right;\">+5.266⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.58%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<p>&lt;details&gt;&lt;summary&gt;7 files, Instructions +4.0⬝10⁹&lt;/summary&gt;</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Instances</code></td>\n<td style=\"text-align: right;\">+4.980⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.37%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Presheaf.Sheafify</code></td>\n<td style=\"text-align: right;\">+4.920⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Topology.MetricSpace.IsometricSMul</code></td>\n<td style=\"text-align: right;\">+4.414⬝10⁹</td>\n<td style=\"text-align: center;\">(+8.40%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.TensorProduct.Basic</code></td>\n<td style=\"text-align: right;\">+4.389⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.37%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.CategoryTheory.Linear.Basic</code></td>\n<td style=\"text-align: right;\">+4.341⬝10⁹</td>\n<td style=\"text-align: center;\">(+24.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.IntegralClosure.IntegralRestrict</code></td>\n<td style=\"text-align: right;\">+4.330⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Order</code></td>\n<td style=\"text-align: right;\">+4.176⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.70%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<p>&lt;details&gt;&lt;summary&gt;7 files, Instructions +3.0⬝10⁹&lt;/summary&gt;</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.CategoryTheory.Quotient.Linear</code></td>\n<td style=\"text-align: right;\">+3.916⬝10⁹</td>\n<td style=\"text-align: center;\">(+21.81%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.BallAction</code></td>\n<td style=\"text-align: right;\">+3.654⬝10⁹</td>\n<td style=\"text-align: center;\">(+4.90%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Homology.ShortComplex.Linear</code></td>\n<td style=\"text-align: right;\">+3.567⬝10⁹</td>\n<td style=\"text-align: center;\">(+6.15%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Normed.Algebra.TrivSqZeroExt</code></td>\n<td style=\"text-align: right;\">+3.448⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.66%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.ContDiff.Basic</code></td>\n<td style=\"text-align: right;\">+3.444⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Flat.Equalizer</code></td>\n<td style=\"text-align: right;\">+3.408⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.50%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.FDeriv.Symmetric</code></td>\n<td style=\"text-align: right;\">+3.309⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.91%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<p>&lt;details&gt;&lt;summary&gt;22 files, Instructions +2.0⬝10⁹&lt;/summary&gt;</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.Analysis.Convolution</code></td>\n<td style=\"text-align: right;\">+2.955⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.71%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.GroupAction.Blocks</code></td>\n<td style=\"text-align: right;\">+2.947⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.88%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Measure.Hausdorff</code></td>\n<td style=\"text-align: right;\">+2.871⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.41%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.InnerProductSpace.Adjoint</code></td>\n<td style=\"text-align: right;\">+2.816⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.27%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.OperatorNorm.Bilinear</code></td>\n<td style=\"text-align: right;\">+2.613⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.51%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.AlgebraicGeometry.EllipticCurve.Group</code></td>\n<td style=\"text-align: right;\">+2.588⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.35%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.PushoutI</code></td>\n<td style=\"text-align: right;\">+2.576⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.84%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.TensorProduct.Tower</code></td>\n<td style=\"text-align: right;\">+2.487⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.20%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Homology.Linear</code></td>\n<td style=\"text-align: right;\">+2.313⬝10⁹</td>\n<td style=\"text-align: center;\">(+9.65%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Topology.Algebra.ConstMulAction</code></td>\n<td style=\"text-align: right;\">+2.294⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.49%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.ContDiff.FTaylorSeries</code></td>\n<td style=\"text-align: right;\">+2.272⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.16%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.FDeriv.Mul</code></td>\n<td style=\"text-align: right;\">+2.265⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.58%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.Pointwise</code></td>\n<td style=\"text-align: right;\">+2.217⬝10⁹</td>\n<td style=\"text-align: center;\">(+4.36%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.Multilinear.Basic</code></td>\n<td style=\"text-align: right;\">+2.176⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.73%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Convex.Combination</code></td>\n<td style=\"text-align: right;\">+2.167⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.74%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Integral.Bochner</code></td>\n<td style=\"text-align: right;\">+2.165⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.05%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Geometry.Euclidean.Angle.Oriented.Rotation</code></td>\n<td style=\"text-align: right;\">+2.127⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.97%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.RingHom.Locally</code></td>\n<td style=\"text-align: right;\">+2.116⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.83%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Algebra</code></td>\n<td style=\"text-align: right;\">+2.75⬝10⁹</td>\n<td style=\"text-align: center;\">(+14.87%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.MeasurableEquiv</code></td>\n<td style=\"text-align: right;\">+2.13⬝10⁹</td>\n<td style=\"text-align: center;\">(+6.53%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.Complement</code></td>\n<td style=\"text-align: right;\">+2.13⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.02%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Geometry.Manifold.ContMDiff.NormedSpace</code></td>\n<td style=\"text-align: right;\">+2.3⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.18%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<p>&lt;details&gt;&lt;summary&gt;74 files, Instructions +1.0⬝10⁹&lt;/summary&gt;</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.LinearAlgebra.CliffordAlgebra.Equivs</code></td>\n<td style=\"text-align: right;\">+1.935⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.34%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.Multilinear.Curry</code></td>\n<td style=\"text-align: right;\">+1.920⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.88%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.Action</code></td>\n<td style=\"text-align: right;\">+1.873⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.42%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.ExteriorAlgebra.Grading</code></td>\n<td style=\"text-align: right;\">+1.856⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.57%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.DedekindDomain.Ideal</code></td>\n<td style=\"text-align: right;\">+1.852⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.FDeriv.Analytic</code></td>\n<td style=\"text-align: right;\">+1.842⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.69%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Basic</code></td>\n<td style=\"text-align: right;\">+1.822⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.17%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Convex.Side</code></td>\n<td style=\"text-align: right;\">+1.817⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.97%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ApproximateUnit</code></td>\n<td style=\"text-align: right;\">+1.776⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.80%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.CosetCover</code></td>\n<td style=\"text-align: right;\">+1.750⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.32%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Function.LpSeminorm.Basic</code></td>\n<td style=\"text-align: right;\">+1.748⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.AffineSpace.AffineMap</code></td>\n<td style=\"text-align: right;\">+1.712⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.37%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousMap</code></td>\n<td style=\"text-align: right;\">+1.705⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.AdicCompletion.Algebra</code></td>\n<td style=\"text-align: right;\">+1.678⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.41%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.PiTensorProduct</code></td>\n<td style=\"text-align: right;\">+1.671⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.05%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.TensorProduct.Basic</code></td>\n<td style=\"text-align: right;\">+1.670⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.75%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Isometric</code></td>\n<td style=\"text-align: right;\">+1.627⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.87%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.ExteriorAlgebra.OfAlternating</code></td>\n<td style=\"text-align: right;\">+1.605⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.15%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.Multilinear.Basic</code></td>\n<td style=\"text-align: right;\">+1.602⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.15%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Topology.ContinuousMap.Algebra</code></td>\n<td style=\"text-align: right;\">+1.591⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.42%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.GroupAction.Quotient</code></td>\n<td style=\"text-align: right;\">+1.499⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.23%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Group.Pointwise.Finset.Basic</code></td>\n<td style=\"text-align: right;\">+1.498⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.28%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.HNNExtension</code></td>\n<td style=\"text-align: right;\">+1.487⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Topology.ContinuousMap.Bounded</code></td>\n<td style=\"text-align: right;\">+1.477⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.12%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.QuadraticForm.Basic</code></td>\n<td style=\"text-align: right;\">+1.464⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.71%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Order.Module.Defs</code></td>\n<td style=\"text-align: right;\">+1.464⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.38%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Complex.Conformal</code></td>\n<td style=\"text-align: right;\">+1.446⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.82%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Geometry.Manifold.Algebra.LeftInvariantDerivation</code></td>\n<td style=\"text-align: right;\">+1.428⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.AlgebraicGeometry.AffineScheme</code></td>\n<td style=\"text-align: right;\">+1.426⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.54%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.ContDiff.Bounds</code></td>\n<td style=\"text-align: right;\">+1.399⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.92%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Topology.Algebra.Group.Basic</code></td>\n<td style=\"text-align: right;\">+1.380⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.20%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Kaehler.TensorProduct</code></td>\n<td style=\"text-align: right;\">+1.371⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.71%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Localization.Free</code></td>\n<td style=\"text-align: right;\">+1.368⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.73%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Fourier.FourierTransform</code></td>\n<td style=\"text-align: right;\">+1.366⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.44%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.ClassGroup</code></td>\n<td style=\"text-align: right;\">+1.365⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.HahnSeries.Multiplication</code></td>\n<td style=\"text-align: right;\">+1.361⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.40%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.AffineSpace.AffineSubspace</code></td>\n<td style=\"text-align: right;\">+1.358⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.91%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.Measure</code></td>\n<td style=\"text-align: right;\">+1.351⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.97%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.SpecialFunctions.ContinuousFunctionalCalculus.Rpow</code></td>\n<td style=\"text-align: right;\">+1.330⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.67%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Group.Arithmetic</code></td>\n<td style=\"text-align: right;\">+1.314⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.DualNumber</code></td>\n<td style=\"text-align: right;\">+1.290⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.66%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RepresentationTheory.Rep</code></td>\n<td style=\"text-align: right;\">+1.287⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.04%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Group.Action.Defs</code></td>\n<td style=\"text-align: right;\">+1.287⬝10⁹</td>\n<td style=\"text-align: center;\">(+7.14%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.CliffordAlgebra.SpinGroup</code></td>\n<td style=\"text-align: right;\">+1.264⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.13%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.NonUnital</code></td>\n<td style=\"text-align: right;\">+1.258⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.54%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.Semisimple</code></td>\n<td style=\"text-align: right;\">+1.252⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.15%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.TensorProduct.Graded.External</code></td>\n<td style=\"text-align: right;\">+1.252⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Geometry.Manifold.Instances.Sphere</code></td>\n<td style=\"text-align: right;\">+1.232⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.75%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Generators</code></td>\n<td style=\"text-align: right;\">+1.220⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.85%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.Matrix.SesquilinearForm</code></td>\n<td style=\"text-align: right;\">+1.211⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.87%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.NormedSpace.OperatorNorm.Prod</code></td>\n<td style=\"text-align: right;\">+1.210⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.61%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.CategoryTheory.Monoidal.Internal.Module</code></td>\n<td style=\"text-align: right;\">+1.200⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Module.Torsion</code></td>\n<td style=\"text-align: right;\">+1.198⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Module.LocalizedModule.Submodule</code></td>\n<td style=\"text-align: right;\">+1.196⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.00%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.Sylow</code></td>\n<td style=\"text-align: right;\">+1.191⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.10%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.TrivSqZeroExt</code></td>\n<td style=\"text-align: right;\">+1.189⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.87%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Data.Set.Pointwise.SMul</code></td>\n<td style=\"text-align: right;\">+1.178⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.39%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Kaehler.Basic</code></td>\n<td style=\"text-align: right;\">+1.164⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.31%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Complex.UpperHalfPlane.Basic</code></td>\n<td style=\"text-align: right;\">+1.155⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.47%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Lie.Weights.Killing</code></td>\n<td style=\"text-align: right;\">+1.150⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.54%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Order.BigOperators.Expect</code></td>\n<td style=\"text-align: right;\">+1.149⬝10⁹</td>\n<td style=\"text-align: center;\">(+3.11%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.CategoryTheory.Galois.IsFundamentalgroup</code></td>\n<td style=\"text-align: right;\">+1.148⬝10⁹</td>\n<td style=\"text-align: center;\">(+4.54%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Calculus.ContDiff.FaaDiBruno</code></td>\n<td style=\"text-align: right;\">+1.124⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.60%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.MeasureTheory.Measure.Lebesgue.EqHaar</code></td>\n<td style=\"text-align: right;\">+1.120⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.97%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.HahnSeries.Summable</code></td>\n<td style=\"text-align: right;\">+1.102⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.53%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Analytic.Basic</code></td>\n<td style=\"text-align: right;\">+1.100⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.44%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.NumberTheory.NumberField.Embeddings</code></td>\n<td style=\"text-align: right;\">+1.87⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.86%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.GroupTheory.OreLocalization.Basic</code></td>\n<td style=\"text-align: right;\">+1.81⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.84%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.LinearAlgebra.Eigenspace.Basic</code></td>\n<td style=\"text-align: right;\">+1.59⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.77%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RepresentationTheory.Basic</code></td>\n<td style=\"text-align: right;\">+1.56⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.74%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Sheaf.Colimits</code></td>\n<td style=\"text-align: right;\">+1.46⬝10⁹</td>\n<td style=\"text-align: center;\">(+5.24%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.WittVector.Isocrystal</code></td>\n<td style=\"text-align: right;\">+1.35⬝10⁹</td>\n<td style=\"text-align: center;\">(+1.69%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.Analytic.CPolynomial</code></td>\n<td style=\"text-align: right;\">+1.7⬝10⁹</td>\n<td style=\"text-align: center;\">(+0.71%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.Filtration</code></td>\n<td style=\"text-align: right;\">+1.7⬝10⁹</td>\n<td style=\"text-align: center;\">(+2.39%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.LinearAlgebra.Dual</code></td>\n<td style=\"text-align: right;\">-1.27⬝10⁹</td>\n<td style=\"text-align: center;\">(-0.22%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.FiniteType</code></td>\n<td style=\"text-align: right;\">-2.716⬝10⁹</td>\n<td style=\"text-align: center;\">(-2.84%)</td>\n</tr>\n<tr>\n<td>&lt;details&gt;&lt;summary&gt;3 files, Instructions -5.0⬝10⁹&lt;/summary&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.RingTheory.LittleWedderburn</code></td>\n<td style=\"text-align: right;\">-4.162⬝10⁹</td>\n<td style=\"text-align: center;\">(-12.43%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RingTheory.LinearDisjoint</code></td>\n<td style=\"text-align: right;\">-4.269⬝10⁹</td>\n<td style=\"text-align: center;\">(-2.14%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Analysis.CStarAlgebra.ContinuousFunctionalCalculus.Restrict</code></td>\n<td style=\"text-align: right;\">-4.856⬝10⁹</td>\n<td style=\"text-align: center;\">(-3.68%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.FieldTheory.Galois.Profinite</code></td>\n<td style=\"text-align: right;\">-6.313⬝10⁹</td>\n<td style=\"text-align: center;\">(-9.97%)</td>\n</tr>\n<tr>\n<td>&lt;details&gt;&lt;summary&gt;2 files, Instructions -8.0⬝10⁹&lt;/summary&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.FieldTheory.Relrank</code></td>\n<td style=\"text-align: right;\">-7.549⬝10⁹</td>\n<td style=\"text-align: center;\">(-2.93%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.RepresentationTheory.GroupCohomology.Resolution</code></td>\n<td style=\"text-align: right;\">-7.718⬝10⁹</td>\n<td style=\"text-align: center;\">(-4.97%)</td>\n</tr>\n<tr>\n<td>&lt;/details&gt;</td>\n<td style=\"text-align: right;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th style=\"text-align: right;\">Instructions</th>\n<th style=\"text-align: center;\">%</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Mathlib.Algebra.Algebra.Subalgebra.Rank</code></td>\n<td style=\"text-align: right;\">-11.508⬝10⁹</td>\n<td style=\"text-align: center;\">(-10.52%)</td>\n</tr>\n<tr>\n<td><code>Mathlib.Algebra.Category.ModuleCat.Presheaf</code></td>\n<td style=\"text-align: right;\">-24.941⬝10⁹</td>\n<td style=\"text-align: center;\">(-9.24%)</td>\n</tr>\n</tbody>\n</table>",
        "id": 483361864,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732054024
    },
    {
        "content": "<p>I've bumped <a href=\"https://github.com/leanprover-community/mathlib4/pull/19046\">#19046</a> to the latest Mathlib. It's certainly on my agenda to try and understand the problems, but for the most part they are outside my area of Mathlib, so someone familiar with this might be able to provide more insight. In particular, 3 of the worst offending files all live in <code>Algebra.Category.ModuleCat</code>.</p>",
        "id": 487348508,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733868116
    },
    {
        "content": "<p>There are also two places that needed a heartbeat bump (unless we find better changes). One was to <code>maxHeartbeats</code> (and it was <em>very</em> slow) and the other was for <code>synthInstance</code>, and it's only <em>just</em> above the threshold.</p>",
        "id": 487348811,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733868267
    },
    {
        "content": "<p>I think we need to stop abusing defeq with <code>restrictScalars</code> in <code>PresheafOfModules</code>.</p>",
        "id": 488015959,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733893244
    },
    {
        "content": "<p>Oh it's <a href=\"https://github.com/leanprover-community/mathlib4/pull/19711#issuecomment-2515844084\">this problem</a> again?</p>",
        "id": 488048499,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733908078
    },
    {
        "content": "<p>If either of you have a quick fix, please feel free to push to the PR. (although I understand if the defeq abuse runs deeper.)</p>",
        "id": 488148562,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733937513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/two-sided.20ideals/near/482488978\">said</a>:</p>\n<blockquote>\n<p>Very interesting. In my mind, we only took a node in the instance graph and expanded it to two nodes joined by a single edge. Am I wrong?</p>\n</blockquote>\n<p>I think the reason it's more costly than this is two-fold:</p>\n<ol>\n<li>When we need <code>one_smul</code> we need to synthesize <code>MulAction α</code>, but if we also need <code>mul_smul</code>, then we now need to synthesize <code>SemigroupAction</code>, and so we don't get the payoff of having done the search already with the cached results.</li>\n<li>Same applies for the arguments: in one case we synthesize <code>Monoid α</code>, and in the other we need <code>Semigroup α</code>.</li>\n</ol>\n<p>That being said, this seems an unreasonably high price for such a small change.</p>",
        "id": 488149654,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733937880
    },
    {
        "content": "<p>Coming back to this after many months. I've just bumped Mathlib and benched the results on <a href=\"https://github.com/leanprover-community/mathlib4/pull/19046\">#19046</a>.</p>\n<p>I just spent an hour playing with <code>Mathlib.RingTheory.Kaehler.Polynomial</code>, as this file is by far the worst offender, but to be perfectly honest, this file sucks on master too, so I was just playing with it on master trying to make it faster. In fact, I only managed to play with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=KaehlerDifferential.mvPolynomialEquiv#doc\">docs#KaehlerDifferential.mvPolynomialEquiv</a>. And here I found that the <code>invFun</code> was slowing things down a bit because Lean was having trouble unifying some of the arguments.</p>\n<p>In particular, changing <code>invFun</code> from:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">linearCombination</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MvPolynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">linearCombination</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MvPolynomial</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MvPolynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>decreases the heartbeat count from 146597 to 62671 (<span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span>). However, the declaration is still abominably slow in terms of total time expended. I think it has to do with the kernel verifying the proof term, because the <code>where</code> block finishes (i.e., the yellow bar goes away) but it sticks around on the top line of the statement. This is not just that it's having trouble elaborating the statement (which you can check by <code>sorry</code>ing the term).</p>\n<p>It seems that the <code>single</code> pieces of each <code>induction</code> are also extremely slow. If anyone else wants to take a shot here, I'd be grateful. Out of 457B increased instructions, this file is responsible for 69B.</p>",
        "id": 536691225,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756419987
    },
    {
        "content": "<p>Seems like most of the discussion above are not about two-sided ideals? But I have a question on the design choice of two-sided ideals and this thread seems the most fitting place to ask.</p>\n<p>So why do we have both <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TwoSidedIdeal#doc\">docs#TwoSidedIdeal</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RingCon#doc\">docs#RingCon</a> (the former is a one field structure of the latter)? When should we use which? This is in the context of reviewing <a href=\"https://github.com/leanprover-community/mathlib4/pull/26277\">#26277</a> by <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> and I would like to at least know if working with <code>RingCon</code> instead of <code>TwoSidedIdeal</code> is the correct choice there. </p>\n<p>cc <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> and <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> who are the reviewers of the original PR adding <code>TwoSidedIdeal</code> and seems to have had a discussion on this design decision there already.</p>",
        "id": 556615498,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1763222553
    },
    {
        "content": "<p>RingCon (or rather, avoiding <code>mem</code> notation) is more general as it works for semi rings</p>",
        "id": 556641283,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763246935
    },
    {
        "content": "<p>Hmmm why does <code>TwoSidedIdeal</code> not work for semirings? Why does it require <code>NonUnitalNonAssocRing</code>?</p>",
        "id": 556641326,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1763247001
    },
    {
        "content": "<p><code>TwoSidedIdeal</code> is supposed to only be used with mem notation rather than relation application. The former doesn't exist without subtraction.</p>",
        "id": 556641445,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763247135
    },
    {
        "content": "<p>The PR you link is generally the right design, I think the main thing to review is consistency with the API for <code>Con</code></p>",
        "id": 556641907,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763247581
    },
    {
        "content": "<p>(possibly after first trying to clean the <code>Con</code> API up some more)</p>",
        "id": 556641937,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763247610
    }
]