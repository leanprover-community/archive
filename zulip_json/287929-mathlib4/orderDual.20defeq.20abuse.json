[
    {
        "content": "<p>We still have quite a number of places in Mathlib where we are abusing the defeq of <code>OrderDual</code>.</p>\n<p>One that I ran into today was <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Dense.borel_eq_generateFrom_Ioc_mem_aux#doc\">docs#Dense.borel_eq_generateFrom_Ioc_mem_aux</a>. Would anyone be interested in taking a look?</p>",
        "id": 506852093,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742430345
    },
    {
        "content": "<p>The first convert can be improved to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">hd</span><span class=\"bp\">.</span><span class=\"n\">orderDual</span><span class=\"bp\">.</span><span class=\"n\">borel_eq_generateFrom_Ico_mem_aux</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hbot</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hIoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ofDual</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ofDual</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>but this is still not right.</p>\n<p>One can put <code>seal OrderDual in</code> above the declaration to ensure that defeq abuse is avoided! :-)</p>",
        "id": 506852200,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742430392
    },
    {
        "content": "<p>I kept hitting this today. OrderDual is just very annoying to work with.</p>",
        "id": 528441272,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752307695
    },
    {
        "content": "<p>What does \"seal\" do?</p>",
        "id": 528441278,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752307703
    },
    {
        "content": "<p>One issue is tbf I constantly find myself wishing for a type that represents order-reversing homomorphisms (and isomorphisms).</p>",
        "id": 528441648,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308144
    },
    {
        "content": "<p>We generally define these using OrderDual but it somewhat funnels you into accidentally defeq abusing.</p>",
        "id": 528441699,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308199
    },
    {
        "content": "<p>I thought defeq abusing OrderDual in proofs is a feature not a bug ...</p>",
        "id": 528441852,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1752308395
    },
    {
        "content": "<p>I just had an issue with using PartialOrder.lift where even when putting in ofDual explicitly it lifted the wrong order.</p>",
        "id": 528441859,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308403
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/stream/287929-mathlib4/topic/orderDual.20defeq.20abuse/near/528441852\">said</a>:</p>\n<blockquote>\n<p>I thought defeq abusing OrderDual in proofs is a feature not a bug ...</p>\n</blockquote>\n<p>I think of it as a cowboy era thing in some ways.</p>",
        "id": 528441887,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308430
    },
    {
        "content": "<p>I think in an ideal world OrderDual would be a one-element structure.</p>",
        "id": 528441943,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308510
    },
    {
        "content": "<p>The issue is it encourages things like (OrderDual (OrderDual (a)) = a. And that's inherently a bit evil.</p>",
        "id": 528441987,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752308547
    },
    {
        "content": "<p>Yeah the instances on <code>αᵒᵈᵒᵈ</code> are the same as (I mean defeq to) those on <code>α</code>. Is there an example of abusing this in defs in mathlib?</p>",
        "id": 528442213,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1752308828
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/orderDual.20defeq.20abuse/near/528442213\">said</a>:</p>\n<blockquote>\n<p>the instances on <code>αᵒᵈᵒᵈ</code> are the same as those on <code>α</code></p>\n</blockquote>\n<p>This is unfortunately wishful thinking, and <em>some</em> operations disagree, but there are so few that I can't even remember a single one off the top of my head</p>",
        "id": 528442561,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1752309234
    },
    {
        "content": "<p>how can they disagree if Xdd is isomorphic to X</p>",
        "id": 528448990,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752316714
    },
    {
        "content": "<p>Isomorphism is not equality.</p>",
        "id": 528449083,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752316815
    },
    {
        "content": "<p>Equality is not definitional equality</p>",
        "id": 528449115,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1752316857
    },
    {
        "content": "<p>We will need to use <code>OrderDual</code> a lot less once the <code>to_dual</code> attribute makes it to mathlib.</p>",
        "id": 528544293,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752427505
    },
    {
        "content": "<p>What will that attribute do?</p>",
        "id": 528614186,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752483307
    },
    {
        "content": "<p>It is very similar to <code>@[to_additive]</code>, which takes a theorem, replaces every * with a + where appropriate, and produces a proof of the translates version by translating the original proof. Instead, <code>@[to_dual]</code> will replace every <code>a ≤ b</code> with <code>b ≤ a</code> where appropriate, and dualize whatever can be dualized, e.g. <code>max</code> → <code>min</code>.</p>",
        "id": 528627513,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752487723
    },
    {
        "content": "<p>Right. But that wouldn't let you avoid the use of it for e.g. defining an order-reversing map.</p>",
        "id": 528651569,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752496336
    },
    {
        "content": "<p>Exactly, but I would expect that those kind of uses don't do much defeq abuse.</p>",
        "id": 528652329,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752496636
    }
]