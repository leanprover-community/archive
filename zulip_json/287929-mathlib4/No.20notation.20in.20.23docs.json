[
    {
        "content": "<p>It looks like the docs currently have absolutely no notation in them! <span aria-label=\"scream\" class=\"emoji emoji-1f631\" role=\"img\" title=\"scream\">:scream:</span> eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=add_zero#doc\">docs#add_zero</a> looks like <code>Eq (HAdd.hAdd a 0) a</code> to me right now.</p>",
        "id": 509882147,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743670940
    },
    {
        "content": "<p>Look at this: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Moments/SubGaussian.html#ProbabilityTheory.HasSubgaussianMGF.measure_sum_range_ge_le_of_iIndepFun\">ProbabilityTheory.HasSubgaussianMGF.measure_sum_range_ge_le_of_iIndepFun</a><br>\nThe Mathlib docs are full of <code>HMul.hMul</code> instead of simply <code>*</code>. Same for all other operations, and we get things like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">setOf</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ω</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ω</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">toReal</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HDiv</span><span class=\"bp\">.</span><span class=\"n\">hDiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Neg</span><span class=\"bp\">.</span><span class=\"n\">neg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HPow</span><span class=\"bp\">.</span><span class=\"n\">hPow</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HMul</span><span class=\"bp\">.</span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HMul</span><span class=\"bp\">.</span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">cast</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"o\">)))</span>\n</code></pre></div>\n<p>instead of </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ω</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"o\">})</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 509882150,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1743670941
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, is this related to the v4.19.0-rc2 bump by any chance?</p>",
        "id": 509882313,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743670996
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> are there recent changes to the pretty printer that could affect doc-gen here?</p>",
        "id": 509884066,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743671488
    },
    {
        "content": "<p>IIRC when I was deciding between theorem provers years ago I found that some of the other communities regarded notation with suspicion (especially unicode notation!) because \"it obscured what was really going on and had no real benefit\" or something. Maybe we're trying this idea ourselves now? :-)</p>",
        "id": 509884738,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743671695
    },
    {
        "content": "<p>I am seeing at <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/Nat/Lemmas.html#Nat.mul_eq_zero\">https://leanprover-community.github.io/mathlib4_docs/Init/Data/Nat/Lemmas.html#Nat.mul_eq_zero</a> the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_zero</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"n\">Iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HMul</span><span class=\"bp\">.</span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Or</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>I remember seeing it in the past as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_zero</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>Does the documentation no longer use notation for <code>Iff</code>, <code>Or</code>, <code>HMul</code> etc.?</p>",
        "id": 509894356,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1743674423
    },
    {
        "content": "<p>See <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/No.20notation.20in.20.23docs/with/509882147\">#mathlib4 &gt; No notation in #docs</a></p>",
        "id": 509894431,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743674444
    },
    {
        "content": "<p>Thanks.</p>",
        "id": 509894499,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1743674466
    },
    {
        "content": "<p>Note: as a workaround, people can temporarily use<br>\n<a href=\"https://florisvandoorn.com/carleson/docs/\">https://florisvandoorn.com/carleson/docs/</a><br>\n(or the docs from any other repo).<br>\nThat uses Mathlib from yesterday (and Lean v4.18.0)</p>",
        "id": 509926339,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743683539
    },
    {
        "content": "<p>Looks like a bug, presumably a problem in doc-gen4 after the upgrade. I noticed the same problem in lean4checker actually, and should have been more suspicious about it being a widespread problem.</p>",
        "id": 509930710,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684566
    },
    {
        "content": "<p>I think this must be a consequence of <a href=\"https://github.com/leanprover/lean4/pull/6325\">lean#6325</a> somehow.</p>",
        "id": 509931122,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684672
    },
    {
        "content": "<p>My wild guess is that </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">envOfImports</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Environment</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- needed for modules which use syntax registered with `initialize add_parser_alias ..`</span>\n<span class=\"w\">  </span><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">enableInitializersExecution</span>\n<span class=\"w\">  </span><span class=\"n\">importModules</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Import</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">Options</span><span class=\"bp\">.</span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">leakEnv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>in <code>doc-gen4</code> needs a <code>(loadExts := true)</code> at the end.</p>",
        "id": 509931713,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684821
    },
    {
        "content": "<p>I would like there to be some test in doc-gen4 CI that detects this issue!</p>",
        "id": 509931775,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684840
    },
    {
        "content": "<p>I guess we don't have any test there that actually inspects the output closely enough...</p>",
        "id": 509931883,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684859
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20notation.20in.20.23docs/near/509931713\">said</a>:</p>\n<blockquote>\n<p>in <code>doc-gen4</code> needs a <code>(loadExts := true)</code> at the end.</p>\n</blockquote>\n<p>I guess a corollary here is that if you want to load an environment <em>and pretty-print from it</em>, then you need to load extensions?</p>",
        "id": 509932061,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743684909
    },
    {
        "content": "<p>I'm out of time to investigate tonight, but if someone could try to reproduce the problem locally in doc-gen4, and then try that fix?</p>",
        "id": 509932078,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743684914
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20notation.20in.20.23docs/near/509926339\">said</a>:</p>\n<blockquote>\n<p>Note: as a workaround, people can temporarily use<br>\n<a href=\"https://florisvandoorn.com/carleson/docs/\">https://florisvandoorn.com/carleson/docs/</a><br>\n(or the docs from any other repo).<br>\nThat uses Mathlib from yesterday (and Lean v4.18.0)</p>\n</blockquote>\n<p>do note that this only shows the parts of mathlib that the project uses!</p>",
        "id": 509932923,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743685144
    },
    {
        "content": "<p>e.g. things like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Partrec#doc\">docs#Partrec</a> don't show up</p>",
        "id": 509933279,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743685221
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/No.20notation.20in.20.23docs/near/509931713\">said</a>:</p>\n<blockquote>\n<p>My wild guess is that </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">envOfImports</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Environment</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- needed for modules which use syntax registered with `initialize add_parser_alias ..`</span>\n<span class=\"w\">  </span><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">enableInitializersExecution</span>\n<span class=\"w\">  </span><span class=\"n\">importModules</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Import</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">Options</span><span class=\"bp\">.</span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">leakEnv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>in <code>doc-gen4</code> needs a <code>(loadExts := true)</code> at the end.</p>\n</blockquote>\n<p>Oh I did have this on my radar but this was merged after 4.19 wasn't it? Or did you backport that change?</p>",
        "id": 509937407,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743686187
    },
    {
        "content": "<p>I'm surprised anything works at all in doc-gen without loading the extensions, I would've expected it to crash hard</p>",
        "id": 509937507,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743686214
    },
    {
        "content": "<p>Also, any <code>class</code> now shows up as a <code>structure</code> in the docs</p>",
        "id": 509940521,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1743686919
    },
    {
        "content": "<p>That's all caused by the same effect</p>",
        "id": 509940603,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743686940
    },
    {
        "content": "<p>Will be fixed in 15</p>",
        "id": 509941255,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743687093
    },
    {
        "content": "<p>fixed</p>",
        "id": 509946009,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743688132
    },
    {
        "content": "<p>I think this is a good illustration of the dangers of default arguments: they tend to break code without compilation errors. That also makes them convenient (and probably as a result, core is very fond of them), but I just want to flag the tradeoff in case it hasn't been considered yet.</p>",
        "id": 509946742,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1743688298
    },
    {
        "content": "<p>In this situation by just setting the default to <code>true</code> we would've maintained full backwards compatability so I think in this situation it's not the default arguments themselves but the value that we choose.</p>",
        "id": 509947125,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743688375
    },
    {
        "content": "<p>Even then, I'd prefer it to be a non-default argument. As a downstream user, this alerts me to a potentially relevant change, in this case a potential optimisation opportunity.</p>\n<p>Although I guess the tradeoff is different if you're maintaining a project that seeks to be compatible with multiple Lean versions, e.g. Subverso. Then you'd appreciate maximum compatibility.</p>",
        "id": 509949704,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1743688859
    },
    {
        "content": "<p>Apologies here. I initially didn't include <a href=\"https://github.com/leanprover/lean4/pull/6325\">lean#6325</a> in v4.19.0-rc1 precisely because I was worried about the possibility of problems like this. Then I realised that there was going to be no way to get lean4checker running on v4.19.0-rc1, and somewhat hurriedly backported it into v4.19.0-rc2, and stepped on this landmine...</p>",
        "id": 509958565,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743690738
    },
    {
        "content": "<p>Happily because of the slightly indirect dependency structure for doc-gen4, we don't actually need to retag  any of the v4.19.0-rc2 tags of the repositories.</p>",
        "id": 509958731,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743690781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>, is there something that we could add to doc-gen4 CI so I would have seen this problem before merging the mistake?</p>",
        "id": 510052945,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743722502
    },
    {
        "content": "<p>4 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/docgen.20scoped.20notations/with/481956588\">#general &gt; docgen scoped notations</a> by <span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span>.</p>",
        "id": 510058882,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743725830
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/No.20notation.20in.20.23docs/near/510052945\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span>, is there something that we could add to doc-gen4 CI so I would have seen this problem before merging the mistake?</p>\n</blockquote>\n<p>We can in principle run a full integration test and assert that the produced HTML is of some shape I guess? Though I'm not sure how beneficial that is in the long run</p>",
        "id": 510092703,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1743746507
    }
]