[
    {
        "content": "<p>I'm trying to review a PR which has an <code>@[reassoc]</code> in, and if I hover over it I get the useless <code>Syntax for the `reassoc` attribute</code>. I can figure out what <code>@[reassoc]</code> does by adding <code>whatsnew in</code> and then seeing what the attribute did, and I've just done this, so at this point I know what reassoc does. Within a week I will have forgotten again. Can I change this \"Syntax for...\" message to an explanation of what <code>@[reassoc]</code> does, or should this information go elsewhere?</p>\n<p>I had this issue with another attribute the other day, but I've forgotten which attribute it was; once I understand what I'm allowed to do here I'll document other attributes as I come across them.</p>",
        "id": 449091367,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720100745
    },
    {
        "content": "<p>I suspect that what you are seeing is the doc-string for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.reassoc#doc\">docs#CategoryTheory.reassoc</a>, so maybe editing that doc-string will help!</p>",
        "id": 449095971,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720101959
    },
    {
        "content": "<p>For a lot of the declarations in <code>Mathlib.Tactic</code> I find that it would be <em>very</em> useful to make the module-docs also be the doc-string for the \"main\" declaration.  I wonder if we could have an attribute <code>@[inherit_doc \"module-docs\"]</code> that would allow that.</p>",
        "id": 449097412,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720102374
    },
    {
        "content": "<p>Or some polished version of this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">DeclarationRange</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Reassoc</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"c1\">-- copy-pasted from `Lean.Elab.Command.elabAddDeclDoc`</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"add_docs \"</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">&amp;</span><span class=\"s2\">\"to\"</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">declName</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">liftCoreM</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">realizeGlobalConstNoOverloadWithInfo</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">unless</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getModuleIdxFor?</span><span class=\"w\"> </span><span class=\"n\">declName</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isNone</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"invalid 'add_module_doc', declaration is in an imported module\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">dc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">getModuleDoc?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"bp\">.</span><span class=\"n\">getId</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">dc</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">docs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"No doc-module strings in {mod}!\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">findDeclarationRangesCore?</span><span class=\"w\"> </span><span class=\"n\">declName</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"c1\">-- this is only relevant for declarations added without a declaration range</span>\n<span class=\"w\">    </span><span class=\"c1\">-- in particular `Quot.mk` et al which are added by `init_quot`</span>\n<span class=\"w\">    </span><span class=\"n\">addAuxDeclarationRanges</span><span class=\"w\"> </span><span class=\"n\">declName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">addDocString</span><span class=\"w\"> </span><span class=\"n\">declName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">docs</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">doc</span><span class=\"bp\">.</span><span class=\"n\">dropWhile</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"bp\">'\\</span><span class=\"n\">n'</span><span class=\"o\">))</span>\n\n<span class=\"c1\">-- hover, no docs</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"n\">add_docs</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Reassoc</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">hello</span>\n\n<span class=\"c1\">-- hover to see the `Mathlib.Tactic.CategoryTheory.Reassoc` module doc-string!</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">hello</span>\n</code></pre></div>",
        "id": 449101316,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720103297
    },
    {
        "content": "<p>I like the idea of an <code>@[inherit_module_doc]</code> attribute.</p>",
        "id": 449963554,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1720466674
    },
    {
        "content": "<p>Ok, I've found myself wanting it a few times.  I think that by being a little structured about how the \"header\" of the module docs looks like, the attribute can be relatively straightforward.</p>",
        "id": 449975871,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720470623
    },
    {
        "content": "<p>For some extra context, Kevin added a docstring to reassoc at <a href=\"https://github.com/leanprover-community/mathlib4/pull/14447\">#14447</a></p>",
        "id": 449981175,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720472621
    },
    {
        "content": "<p>I'm not sure about <code>inherit_module_doc</code>... I feel like a lot of module docstrings are not good tactic documentation. At least the ones I write explain some of the implementation.</p>",
        "id": 449981486,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720472685
    },
    {
        "content": "<p>I wouldn't want people to write module docstrings that are sub-par just to make them be good tactic docstrings, and vice versa.</p>",
        "id": 449981761,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720472749
    },
    {
        "content": "<p>If the implementation is in a \"second\" module doc, this could work, though.</p>",
        "id": 449981892,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720472769
    },
    {
        "content": "<p>Anyway, I often find that I mention in the module docs to look at the tactic doc for more details, in order to avoid having to keep in sync the information.</p>",
        "id": 449982142,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720472827
    },
    {
        "content": "<p>But to be fair, I also thought that <code>extend_docs</code> was very useful and honestly it is very niche!</p>",
        "id": 449982532,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720472917
    },
    {
        "content": "<p>It would be nice to be able to reuse text somehow to avoid copy-pasting as much as possible! One idea is to allow inheriting specific markdown sections as the docstring; e.g. given</p>\n<div class=\"codehilite\" data-code-language=\"null\"><pre><span></span><code>/-! # The `foo` tactic\n\n## Description\n\n`foo` fooifies the goal state.\n\n## Implementation\n\nThis tactic is implemented in an extremely complicated way.\nThe story begins in 1800 B.C., when the first known fooification algorithm\nwas inscribed onto a clay tablet in cuneiform...\n-/\n</code></pre></div>\n<p>you could write something like <code>@[inherit_module_doc (section := ##Description)]</code>.</p>",
        "id": 449985543,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1720473938
    },
    {
        "content": "<p>I think that if you segment the doc-module, then you can use the segment that you want:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">Segment 1</span>\n<span class=\"cm\">-/</span>\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">Segment 2</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>Then you could make <code>inherit_module_doc</code> take a numeral input.</p>",
        "id": 449985862,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720474097
    },
    {
        "content": "<p>(In general it would be nice to be able to declare \"blurbs\" which could be interpolated easily into docstrings, which is a task in service of the same goal, but is much more difficult to implement.)</p>",
        "id": 449985885,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1720474110
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/287929-mathlib4/topic/documenting.20attributes/near/449985862\">said</a>:</p>\n<blockquote>\n<p>I think that if you segment the doc-module, then you can use the segment that you want:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">Segment 1</span>\n<span class=\"cm\">-/</span>\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">Segment 2</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>Then you could make <code>inherit_module_doc</code> take a numeral input.</p>\n</blockquote>\n<p>I'd worry this would be a little fragile and awkward-looking in source; also doing something like <code>section := ##Description</code> is more reflective of purpose than referring to a numerical index! :)</p>",
        "id": 449986452,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1720474386
    }
]