[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> Did you recently change <code>simps</code> config? It looks like it needs <code>toFun -&gt; apply</code> instead of, e.g., <code>toLinearMap_toFun -&gt; apply</code></p>",
        "id": 362615178,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685588286
    },
    {
        "content": "<p>Should we change these?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Analysis</span><span class=\"bp\">/</span><span class=\"n\">NormedSpace</span><span class=\"bp\">/</span><span class=\"n\">LinearIsometry.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">LinearIsometry</span> <span class=\"o\">(</span><span class=\"n\">toLinearMap_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Analysis</span><span class=\"bp\">/</span><span class=\"n\">NormedSpace</span><span class=\"bp\">/</span><span class=\"n\">LinearIsometry.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">LinearIsometryEquiv</span> <span class=\"o\">(</span><span class=\"n\">toLinearEquiv_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">/</span><span class=\"n\">AffineSpace</span><span class=\"bp\">/</span><span class=\"n\">AffineEquiv.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">AffineEquiv</span> <span class=\"o\">(</span><span class=\"n\">toEquiv_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"n\">toEquiv_invFun</span> <span class=\"bp\">→</span> <span class=\"n\">symm_apply</span><span class=\"o\">,</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">NumberTheory</span><span class=\"bp\">/</span><span class=\"n\">LegendreSymbol</span><span class=\"bp\">/</span><span class=\"n\">MulCharacter.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">MulChar</span> <span class=\"o\">(</span><span class=\"n\">toMonoidHom_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">toMonoidHom</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Module</span><span class=\"bp\">/</span><span class=\"n\">Basic.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">ContinuousLinearMap</span> <span class=\"o\">(</span><span class=\"n\">toLinearMap_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"n\">toLinearMap</span> <span class=\"bp\">→</span> <span class=\"n\">coe</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">ContinuousFunction</span><span class=\"bp\">/</span><span class=\"n\">Bounded.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">BoundedContinuousFunction</span> <span class=\"o\">(</span><span class=\"n\">toContinuousMap_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">Homotopy</span><span class=\"bp\">/</span><span class=\"n\">Basic.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">Homotopy</span> <span class=\"o\">(</span><span class=\"n\">toContinuousMap_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">toContinuousMap</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">Homotopy</span><span class=\"bp\">/</span><span class=\"n\">Basic.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">HomotopyWith</span> <span class=\"o\">(</span><span class=\"n\">toHomotopy_toContinuousMap_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">Homotopy</span><span class=\"bp\">/</span><span class=\"n\">Equiv.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">HomotopyEquiv</span> <span class=\"o\">(</span><span class=\"n\">toFun_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"n\">invFun_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">symm_apply</span><span class=\"o\">,</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">/</span><span class=\"n\">MetricSpace</span><span class=\"bp\">/</span><span class=\"n\">Isometry.lean</span><span class=\"o\">:</span><span class=\"n\">initialize_simps_projections</span> <span class=\"n\">IsometryEquiv</span> <span class=\"o\">(</span><span class=\"n\">toEquiv_toFun</span> <span class=\"bp\">→</span> <span class=\"n\">apply</span><span class=\"o\">,</span> <span class=\"n\">toEquiv_invFun</span> <span class=\"bp\">→</span> <span class=\"n\">symm_apply</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 362615214,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685588320
    },
    {
        "content": "<p>Also, sometimes <code>simp</code> fails to use lemmas generated by <code>simps</code>. I can't make an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> yet. I'll open an issue once I hit this bug again.</p>",
        "id": 362615337,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685588403
    },
    {
        "content": "<p>Not recently, but yeah, that changed in Lean 4. The short version does exactly the same as the long version though. It was changed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/2042\">!4#2042</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/2561\">!4#2561</a> changed some existing <code>initialize_simps_projections</code>.</p>",
        "id": 362717647,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1685618537
    },
    {
        "content": "<p>Note that projections to parent structures are now disabled by default. So the <code>-toContinuousMap</code> and friends are also not needed anymore, since they're the default behavior. You have to now do <code>+toContinuousMap</code> explicitly if you want it, which is done in some category theory structures.</p>",
        "id": 362717663,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1685618542
    },
    {
        "content": "<p>When <code>simp</code> cannot apply the lemmas generated by <code>simps</code>, can you look at whether the output <code>simps?</code> produces looks reasonable?<br>\nAnother thing I would check is whether <code>Funlike.coe</code> is the default coercion / simp-normal form in the case you're looking at.</p>",
        "id": 362717990,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1685618631
    },
    {
        "content": "<p>Unfortunately, after <code>toLinearMap_toFun -&gt; apply</code> it generates lemmas named <code>*_toFun</code>. I'll try to fix these <code>initialize_simps_projections</code></p>",
        "id": 362738443,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685622914
    },
    {
        "content": "<p>AFAIR, <code>simps?</code> output looked good and <code>rw</code> was able to use them. I'll try to reproduce it later today.</p>",
        "id": 362738869,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685623007
    },
    {
        "content": "<p>(though fixing <code>ContDiff</code> is higher on my priority list)</p>",
        "id": 362738959,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1685623028
    },
    {
        "content": "<p>Oh I see, it's generating both <code>_apply</code> and <code>_toFun</code> lemmas? That sounds like a bug.</p>",
        "id": 362739752,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1685623216
    },
    {
        "content": "<p>I complained in my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/19860\">#19860</a> about <code>simps</code> never doing exactly what I want it to do, then <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> opened issue <a href=\"https://github.com/leanprover-community/mathlib4/pull/19895\">#19895</a>, and now <span class=\"user-mention\" data-user-id=\"676310\">@Frederick Pu</span> just opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/20029\">#20029</a> to address that issue. I suggest we discuss here our expectations from the <code>simps</code> configuration syntax</p>",
        "id": 489836056,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734553635
    },
    {
        "content": "<p>hi</p>",
        "id": 489840247,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555560
    },
    {
        "content": "<p>wait there's like two different discussions for simps config</p>",
        "id": 489840296,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555579
    },
    {
        "content": "<p>What do you mean?</p>",
        "id": 489840420,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734555613
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/ahMNGbLx5hRyujG6kaNi04kk/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ahMNGbLx5hRyujG6kaNi04kk/image.png\" title=\"image.png\"><img data-original-dimensions=\"1192x735\" src=\"/user_uploads/thumbnail/3121/ahMNGbLx5hRyujG6kaNi04kk/image.png/840x560.webp\"></a></div>",
        "id": 489840508,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555644
    },
    {
        "content": "<p>or are they jhust grouped by days</p>",
        "id": 489840548,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555660
    },
    {
        "content": "<p>Oh! I see. Not sure what to do, I really want to talk about \"simps config\" <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 489840657,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734555710
    },
    {
        "content": "<p>so fpvandoorn mentioned that he wanted to have the ability to have a config tuple before and after the projections tuple to indicate precedence</p>",
        "id": 489840759,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555739
    },
    {
        "content": "<p>but a think a better approach would just be to always have the config tuple take precedence when there is a contradiction with projections or throw a warning when that occurs</p>",
        "id": 489840838,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555777
    },
    {
        "content": "<p>also, we should probably consider having a separate NameMapExt for the config data since it'll give us more information for error logging (knowing if a conflict is between projection and config vs between projection and projection) as well as making it easier to enforce precendence of config options over projections</p>",
        "id": 489841092,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734555876
    },
    {
        "content": "<p>Could we drop the <code>initialize_simps_projections</code> notation entirely? It's antiquated, hard to guess and unlike any other notation in lean/mathlib.</p>",
        "id": 489841251,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734555957
    },
    {
        "content": "<p>what is initialize_simps_projections even used for? is it just called by the <code>@[simps ...]</code></p>",
        "id": 489841675,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734556140
    },
    {
        "content": "<p>so to be clear, initizlie_simps_projections is used for autogenerating simp lemmas from all of the projections (aka structure fields)</p>",
        "id": 489865669,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734568229
    },
    {
        "content": "<p>im still a bit confused about what the arrow notation for custom names is:<br>\n<code>initialize_simps_projections AddConstMap (toFun → coe, as_prefix coe)</code> is this saying that anytime you see AddConstMap.toFun you should rewrite it as Coe.coe, or coe just a temporary name. If coe comes from Coe.coe then how is lean able to infer it?</p>",
        "id": 489865881,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734568352
    },
    {
        "content": "<p>also what's the difference between @simp and @simps?</p>",
        "id": 489867016,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734569140
    },
    {
        "content": "<p>im thinking you should be able to just put <code>@[simps (rules, ....) (configs, ...)]</code> above any structure and using something similar to <code>attribute [simp]</code> otherwise</p>",
        "id": 489867268,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1734569286
    },
    {
        "content": "<p>Weird thing I just noticed: applying <code>@[simps]</code> to <code>foo : Subsemiring R</code> generates a lemma <code>foo_coe</code>, but applying the same attribute to <code>foo : Submonoid R</code> generates <code>coe_foo</code>.</p>",
        "id": 491779860,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735921493
    },
    {
        "content": "<p>Why does this happen? Surely it is not intended behaviour.</p>",
        "id": 491779911,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735921521
    },
    {
        "content": "<p>OK I found the issue, see <a href=\"https://github.com/leanprover-community/mathlib4/pull/20451\">#20451</a></p>",
        "id": 491781662,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735922392
    },
    {
        "content": "<p>I am surprised about this because mathlib has both</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">initialize_simps_projections</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">as_prefix</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">initialize_simps_projections</span><span class=\"w\"> </span><span class=\"n\">Subsemiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">carrier</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">as_prefix</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 491789156,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735926208
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I meant <code>Subsemigroup</code>, mb! (As can be seen in the actual PR oops)</p>",
        "id": 491791500,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1735927341
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/287929-mathlib4/topic/simps.20config/near/489836056\">said</a>:</p>\n<blockquote>\n<p>I complained in my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/19860\">#19860</a> about <code>simps</code> never doing exactly what I want it to do, then <span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> opened issue <a href=\"https://github.com/leanprover-community/mathlib4/pull/19895\">#19895</a>, and now <span class=\"user-mention silent\" data-user-id=\"676310\">Frederick Pu</span> just opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/20029\">#20029</a> to address that issue. I suggest we discuss here our expectations from the <code>simps</code> configuration syntax</p>\n</blockquote>\n<p>is this PR still relevant or are we getting rid of <code>initialize_simps_config</code> altogether</p>",
        "id": 499565652,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1739475417
    }
]