[
    {
        "content": "<p>This is the announcement of a new linter acting on Mathlib: the multiGoal linter.</p>\n<p>The linter will flag missing focusing dots (<code>·</code>, typed <code>\\.</code>).  It highlights the lines that should be indented (the first should have an <code>· </code> added, the remaining just <code>  </code> -- 2 spaces), until it reaches either the end of the proof, or a tactic that \"stops\" the linter.</p>",
        "id": 477978021,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729495025
    },
    {
        "content": "<p>As usual, bug reports and usability issues are welcome!</p>",
        "id": 477978042,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729495034
    },
    {
        "content": "<p>Very nice! Hopefully after maturing in mathlib this can become standard for lean.</p>\n<p>A future step is maybe that at the end of a tactic line at the end of a block, there is a tab-able completion that adds the right amount of bullets (or <code>case</code> tactics), so that one immediately sees the effect of the current tactic, and doesn't have to write the bullets manually. Of course that's easier said than done, with dependent sub goals that will disappear after solving others etc.</p>",
        "id": 477983128,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1729496717
    },
    {
        "content": "<p>I got two questions regarding this:</p>\n<ol>\n<li>It appears you have a couple of unextensible whitelists in the linter. That means everyone downstream of mathlib can now only work with these whitelists and nobody can flag their own tactics as whitelisted anymore. I feel like making these whitelists extensible, e.g. through some attribute, would make sense to fix this.</li>\n<li>Is this one of the linters that run live in the editor or is this only executed in CI? If it runs live in the editor, have you benchmarked this at all? Going over every info tree node sounds like a good recipe for slowdown in big proofs.</li>\n</ol>",
        "id": 477983225,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1729496753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/287929-mathlib4/topic/MultiGoal.20linter/near/477983128\">said</a>:</p>\n<blockquote>\n<p>Very nice! Hopefully after maturing in mathlib this can become standard for lean.</p>\n<p>A future step is maybe that at the end of a tactic line at the end of a block, there is a tab-able completion that adds the right amount of bullets (or <code>case</code> tactics), so that one immediately sees the effect of the current tactic, and doesn't have to write the bullets manually. Of course that's easier said than done, with dependent sub goals that will disappear after solving others etc.</p>\n</blockquote>\n<p>I had thought of an post-completion code-action that would add the relevant indentations/<code>·</code>, but having an \"auto-structuring\" would also be nice!  I agree that it is somewhat tricky with disappearing goals, but I found that those were relatively rare.  Anyway, I'll keep this in mind!</p>",
        "id": 477983800,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729496920
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/287929-mathlib4/topic/MultiGoal.20linter/near/477983225\">said</a>:</p>\n<blockquote>\n<p>I got two questions regarding this:</p>\n<ol>\n<li>It appears you have a couple of unextensible whitelists in the linter. That means everyone downstream of mathlib can now only work with these whitelists and nobody can flag their own tactics as whitelisted anymore. I feel like making these whitelists extensible, e.g. through some attribute, would make sense to fix this.</li>\n</ol>\n</blockquote>\n<p>That is a good point, although for the moment the linter is off by default outside of mathlib.  I agree that it is sub-optimal that you have to live with the given exemptions, so I'll look into extensibility, although I would first wait to see how it works as is: adding new tactics to mathlib is pretty rare, so I'll wait a bit for that.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/287929-mathlib4/topic/MultiGoal.20linter/near/477983225\">said</a>:</p>\n<blockquote>\n<ol start=\"2\">\n<li>Is this one of the linters that run live in the editor or is this only executed in CI? If it runs live in the editor, have you benchmarked this at all? Going over every info tree node sounds like a good recipe for slowdown in big proofs.</li>\n</ol>\n</blockquote>\n<p>The linter actually runs live in the editor as well.  I find it very hard to know what can be slow, but I would like to learn: if you have the patience to give me some guidance, I am happy to use this linter as an excuse to learn!</p>",
        "id": 477984726,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729497221
    },
    {
        "content": "<p>(Also, my experience \"fixing\" the linter warnings did not make it appear <em>visibly</em> slow, but that is a very subjective measure.  Note also that the linter only looks at completed proofs, not partial ones -- that probably mitigates its slow-down.)</p>",
        "id": 477985040,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729497311
    },
    {
        "content": "<p>Henrik, I'm thinking about ways to speed up the linter.  Before I start to write some code, do you think it that it is worthwhile to scan the command syntax looking for \"tactic\" nodes, recording their positions and then recursing into the infotree, but only acting when the position of the node is one of the \"tactic\" ones?</p>",
        "id": 478024258,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729508754
    }
]