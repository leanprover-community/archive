[
    {
        "content": "<p>Given <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter.generate_eq_biInf#doc\">docs#Filter.generate_eq_biInf</a> do we really need <code>Filter.generate</code>? Most of the library uses <code>‚®Ö i, ùìü (s i)</code>, not <code>generate (Set.range s)</code>. I know that it's used to define the complete lattice instance, but it's easy to rewrite it using the \"complete lattice from <code>SetSup</code>\" constructor. <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span></p>",
        "id": 475436273,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728350835
    },
    {
        "content": "<p>I think it's nice because it gives it in terms of the inductive <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter.GenerateSets#doc\">docs#Filter.GenerateSets</a>.</p>",
        "id": 475444952,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1728354613
    },
    {
        "content": "<p>The theory is definitely cleaner without <code>Filter.generate</code>. You can do everything without ever knowing what the elements of an inf look like. The way we get a complete lattice instance here and elsewhere is actually a bit ridiculous. We could use instead that fact that, in an ordered set, if every set has a sup then every set has inf (and vice-versa).</p>",
        "id": 475612239,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1728405012
    },
    {
        "content": "<p>But sometimes don't we <em>want</em> to know what the elements of an <code>inf</code> look like? And in that case, why not prefer <code>Filter.GenerateSets</code>?</p>",
        "id": 475620632,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1728407461
    },
    {
        "content": "<p>My main argument is that it's better to have 1 normal form.</p>",
        "id": 475646650,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728414428
    },
    {
        "content": "<p>Otherwise we either (almost) ignore one of the forms or have random parts of API build around different forms.</p>",
        "id": 475647168,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728414562
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Filter.generate</p>",
        "id": 475647183,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728414568
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/Filter/Basic.html#Filter.generate\">Filter.generate</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/Filter/Basic.html#Filter.mkOfClosure\">Filter.mkOfClosure</a>, and <a href=\"https://loogle.lean-lang.org/?q=Filter.generate\">25 more</a></p>",
        "id": 475647188,
        "sender_full_name": "loogle",
        "timestamp": 1728414568
    },
    {
        "content": "<p>As you can see, <code>Filter.generate</code> is mentioned less than 30 times in <code>def</code>s/<code>theorem</code>s.</p>",
        "id": 475647316,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728414603
    },
    {
        "content": "<p>For the other outcome see <a href=\"#narrow/stream/287929-mathlib4/topic/.28simp.29.20normal.20forms.20for.20expressions.20about.20.60Filter.60s\">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/.28simp.29.20normal.20forms.20for.20expressions.20about.20.60Filter.60s</a></p>",
        "id": 475647485,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728414651
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475620632\">said</a>:</p>\n<blockquote>\n<p>But sometimes don't we <em>want</em> to know what the elements of an <code>inf</code> look like? And in that case, why not prefer <code>Filter.GenerateSets</code>?</p>\n</blockquote>\n<p>My claim is that we actually don‚Äôt want to know.‚ÄØSometimes we think we want it, but this is an illusion.</p>",
        "id": 475660095,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1728417928
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475660095\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475620632\">said</a>:</p>\n<blockquote>\n<p>But sometimes don't we <em>want</em> to know what the elements of an <code>inf</code> look like? And in that case, why not prefer <code>Filter.GenerateSets</code>?</p>\n</blockquote>\n<p>My claim is that we actually don‚Äôt want to know.‚ÄØSometimes we think we want it, but this is an illusion.</p>\n</blockquote>\n<p>Do we actually just want the induction principle it provides?</p>",
        "id": 475666352,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728419617
    },
    {
        "content": "<p>Please don't start any refactors here until <a href=\"https://github.com/leanprover-community/mathlib4/pull/17552\">#17552</a> is merged or rejected (moving many defs to a new file).</p>",
        "id": 475679801,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728424044
    },
    {
        "content": "<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 475743069,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1728449022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475612239\">said</a>:</p>\n<blockquote>\n<p>The way we get a complete lattice instance here and elsewhere is actually a bit ridiculous. We could use instead that fact that, in an ordered set, if every set has a sup then every set has inf (and vice-versa).</p>\n</blockquote>\n<p>That's why I PRd this construction (one of two) in <a href=\"https://github.com/leanprover-community/mathlib/pull/2359\">!3#2359</a> 4.5 years ago (the other one was added a year later by <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> ).</p>",
        "id": 475746197,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728450673
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> See <a href=\"https://github.com/leanprover-community/mathlib4/pull/17799\">#17799</a> for an experiment. One side effect is that <code>sInf</code> (e.g., <code>atTop</code> or <code>cocompact</code>) is now something Lean can try to unfold while unifying expressions, so I had to add type hints here and there.</p>",
        "id": 477116016,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729050996
    },
    {
        "content": "<p><code>!bench</code> reports slowdowns here and there and a speedup in a file that failed to compile with the new definitions, then I fixed it.</p>",
        "id": 477299416,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729112320
    },
    {
        "content": "<p>What should I do? Make it irreducible? Something else?</p>",
        "id": 477299482,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729112352
    },
    {
        "content": "<p>I would try irreducibility, yes.</p>",
        "id": 477643249,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1729254063
    },
    {
        "content": "<p>What's the difference between <code>@[irreducible] def</code> and <code>irreducible_def</code>?</p>",
        "id": 477676916,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729264257
    },
    {
        "content": "<p>My understanding:</p>\n<ul>\n<li>The former is built into core. </li>\n<li>The latter is irreducible to the kernel also.</li>\n</ul>",
        "id": 477677283,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729264367
    },
    {
        "content": "<p>Do we prefer one of them to the other in Mathlib?</p>",
        "id": 477677734,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729264489
    },
    {
        "content": "<p>I would prefer the former unless there is a demonstrated problem with the kernel unfolding it.</p>",
        "id": 477679105,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1729264884
    },
    {
        "content": "<p>Unless I'm mistaken, <code>irreducible_def</code> <em>also</em> provides a rewrite lemma giving you access to the underlying un<code>Wrapped</code> definition.</p>",
        "id": 477689200,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1729268120
    },
    {
        "content": "<p>I used <code>@[irreducible] def</code>, it works. <a href=\"https://github.com/leanprover-community/mathlib4/pull/17799\">#17799</a> is ready for review!</p>",
        "id": 477703925,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729274079
    },
    {
        "content": "<p>0.5% speed-up on overall instruction in mathlib <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 477708694,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1729276044
    },
    {
        "content": "<p>Should we make more complicated definitions irreducible?</p>",
        "id": 477708758,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729276077
    },
    {
        "content": "<p>E.g., <code>sInf</code> on <code>TopologicalSpace</code>.</p>",
        "id": 477708823,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729276093
    },
    {
        "content": "<p>I'll try this once <a href=\"https://github.com/leanprover-community/mathlib4/pull/17799\">#17799</a> is merged.</p>",
        "id": 477710001,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729276589
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475746197\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Filter.2Egenerate/near/475612239\">said</a>:</p>\n<blockquote>\n<p>The way we get a complete lattice instance here and elsewhere is actually a bit ridiculous. We could use instead that fact that, in an ordered set, if every set has a sup then every set has inf (and vice-versa).</p>\n</blockquote>\n<p>That's why I PRd this construction (one of two) in <a href=\"https://github.com/leanprover-community/mathlib/pull/2359\">!3#2359</a> 4.5 years ago (the other one was added a year later by <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> ).</p>\n</blockquote>\n<p>Perhaps we should make the Inf field of this construction irreducible too? That is, extract it to a def and make it irreducible.</p>",
        "id": 477801583,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729340681
    },
    {
        "content": "<p>We should split this construction into <code>*.ofCompleteSemilatticeSup</code>, with some of them using irreducible <code>def</code>s, so that we can cherry-pick parts of the construction.</p>",
        "id": 477815609,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729351326
    },
    {
        "content": "<p>I won't have time for this for at least a week.</p>",
        "id": 477815654,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729351373
    }
]