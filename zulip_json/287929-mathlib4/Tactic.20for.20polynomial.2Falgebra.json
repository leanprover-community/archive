[
    {
        "content": "<p>From my mini experiment it looks like actually the <code>C</code> form is better for tactics:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"bp\">.</span><span class=\"n\">useHeartbeats</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">module</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">module</span>\n</code></pre></div>",
        "id": 533673744,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754856538
    },
    {
        "content": "<p>the smul form even times out!</p>",
        "id": 533673751,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754856543
    },
    {
        "content": "<p>it should be relatively easy to interpolate from this example a <code>macro polynomial</code> to deal with such equalities</p>",
        "id": 533673869,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754856691
    },
    {
        "content": "<p>there's actually some sort of instance slowdown that i don't know where it's coming from whenever i deal with smul polynomials</p>",
        "id": 533674056,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754856959
    },
    {
        "content": "<p>500000 heatbeats are sufficient to make the smul version work; <code>simp?</code> says</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Try</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">smul_mul_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">mul_smul_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">smul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sq</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533674351,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1754857331
    },
    {
        "content": "<p>for the smul version I currently have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">smul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">smul_mul_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_smul_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_smul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pow_zero</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">module</span>\n</code></pre></div>",
        "id": 533674394,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857372
    },
    {
        "content": "<p>I guess we can still have <code>C a * X ^ n</code> be the simpNF, and then for the polynomial tactic it will just use one step to convert that to <code>a • X ^ n</code></p>",
        "id": 533674456,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857444
    },
    {
        "content": "<p>I actually have a dilemma now, because if we take <code>C a * X ^ n</code> as the simp NF then that means <code>C (a + 1) * X ^ n</code> should also be the simp NF</p>",
        "id": 533674509,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857503
    },
    {
        "content": "<p>Poll: What is (X+a+1)^2?</p>",
        "id": 533674632,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857628
    },
    {
        "content": "<p>actually, consider now the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_pow</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">ring</span>\n</code></pre></div>",
        "id": 533674844,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857884
    },
    {
        "content": "<p>maybe we should just make this a macro</p>",
        "id": 533674858,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857902
    },
    {
        "content": "<p>does anyone see a case where this would fail on?</p>",
        "id": 533674868,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754857914
    },
    {
        "content": "<p>yeah ok this easily fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">Complex</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mf\">0.5</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">I</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">ω</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ω</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_pow</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n</code></pre></div>",
        "id": 533674990,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754858064
    },
    {
        "content": "<p><code>ring</code> basically has no idea that it should group powers of X</p>",
        "id": 533675009,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754858083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> would there be enough interest if i were to try to write a <code>polynomial</code> tactic? I assume maybe you might already have some thoughts on this? I thought it might be better to first consult you before I dedicate time to writing this tactic.</p>",
        "id": 533675062,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754858136
    },
    {
        "content": "<p>I think a tactic for a configurable set of (free) generators would be more useful</p>",
        "id": 533676163,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754859470
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> i.e. <code>algebra</code>?</p>",
        "id": 533676213,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859536
    },
    {
        "content": "<p>but the problem with generalising the tactic is that there is no way to generalise <code>C</code> as well?</p>",
        "id": 533676249,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859555
    },
    {
        "content": "<p>or i guess we would just group everything that is not listed as a generator?</p>",
        "id": 533676269,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859578
    },
    {
        "content": "<p>so calling <code>algebra [x,y]</code> on <code>ax+by+cz+z^2+zx</code> would give <code>(a+z)x + by + (cz+z^2)</code>?</p>",
        "id": 533676347,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859656
    },
    {
        "content": "<p>I think I see a way to do that</p>",
        "id": 533676383,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859691
    },
    {
        "content": "<p>I mean, finsupps are nice when you don't have to quotient by zero <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 533676515,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754859894
    },
    {
        "content": "<p>I think I'm gonna do the following (the algebra is <code>A</code>):</p>\n<ol>\n<li>if fed in a specific ring hom (e.g. <code>C</code>), then normalise stuff into the form <code>C (term) * x ^ m * y ^ n</code>.</li>\n<li>if fed in a ring <code>R</code>, then use <code>algebraMap</code> as the ring hom and go to step 1</li>\n<li>if fed nothing, look at the smuls and try to infer R</li>\n<li>if fed nothing and there are no smuls, then just use <code>A</code> itself</li>\n</ol>",
        "id": 533836132,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754932576
    },
    {
        "content": "<p>does this look like a good algorithm?</p>",
        "id": 533836151,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754932588
    },
    {
        "content": "<p>there will also be special support for nsmul and zsmul</p>",
        "id": 533836182,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754932601
    },
    {
        "content": "<p>examples in <code>R[x,y,z]</code>:</p>\n<ol>\n<li><code>algebra C [x, y]</code> turns <code>(x + C r * y)^2</code> into <code>x ^ 2 + C (2 * r) * (x * y) + C (r ^ 2) * y ^ 2</code></li>\n<li><code>algebra R [x, y]</code> is the above with <code>C</code> replaced with <code>algebraMap R R[x, y, z]</code></li>\n<li><code>algebra [x, y]</code> turns <code>(x + r • y)^2</code> into <code>x^2 + (2*r)•(x*y) + (r^2)•(y^2)</code></li>\n<li><code>algebra [x, y]</code> turns <code>(x + z * y)^2</code> into <code>x^2 + (2*z)*(x*y) + (z^2)*(y^2)</code></li>\n</ol>",
        "id": 533836639,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754932786
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>",
        "id": 533836781,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754932847
    },
    {
        "content": "<p>Sounds reasonable. Maybe <code>algebra</code> without parameters on a goal involving polynomials (in one or several variables) can default to <code>algebra C [X]</code> etc.?<br>\nBut this is for after the basic setup works, I guess.</p>",
        "id": 533843716,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1754935954
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span> I intended to call it <code>polynomial</code></p>",
        "id": 533853060,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754940062
    },
    {
        "content": "<p>29 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/How.20to.20write.20a.20polynomial.3F/with/525003564\">#mathlib4 &gt; How to write a polynomial?</a> by <span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span>.</p>",
        "id": 533855753,
        "sender_full_name": "Notification Bot",
        "timestamp": 1754941198
    },
    {
        "content": "<p>In the long run I'd prefer it if we could just drop C altogether</p>",
        "id": 533891657,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754961982
    },
    {
        "content": "<p>for 1 now i'm not so sure what the use of specifying <code>[x, y]</code> is... we could just assume that every atom not in the form <code>C r</code> is a generator right?</p>",
        "id": 533944654,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754992093
    },
    {
        "content": "<p>CC <span class=\"user-mention\" data-user-id=\"585783\">@Arend Mellendijk</span>: in the rare event you're not aware yet, I bet you're interested.</p>",
        "id": 533944796,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754992150
    },
    {
        "content": "<p>I'll note this topic: <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/tactic.20for.20polynomial.20equality/with/502107773\">#mathlib4 &gt; tactic for polynomial equality</a> ; I have a working (if brittle) tactic for proving <code>Polynomial</code> equalities. </p>\n<p>I've also already been working on a tactic for normalizing expressions in <code>Algebra</code>s more generally, focussing also on recursively normalizing expressions in the base ring.</p>",
        "id": 533945781,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1754992509
    },
    {
        "content": "<p>that discussion is 6 months old, are you still working on it?</p>",
        "id": 533945929,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754992558
    },
    {
        "content": "<p>I am, but I've been caught up with other things in the meantime.</p>",
        "id": 533946247,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1754992691
    },
    {
        "content": "<p>is there somewhere where I can see your code?</p>",
        "id": 533946288,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754992709
    },
    {
        "content": "<p>The bulk of it is here: <a href=\"https://github.com/FLDutchmann/mathlib4/blob/arend/algebra/Mathlib/Tactic/Algebra.lean\">https://github.com/FLDutchmann/mathlib4/blob/arend/algebra/Mathlib/Tactic/Algebra.lean</a></p>\n<p>It's basically an attempt to generalize <code>ring</code> with some inspiration from the <code>module</code> tactic. It's rather broken at the moment (lots of stack overflows) and I'm not quite sure how to normalize constants properly.</p>",
        "id": 533947141,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1754993027
    },
    {
        "content": "<p>71 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Notation.20for.20polynomial.20variables/with/534483649\">#mathlib4 &gt; Notation for polynomial variables</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 534483653,
        "sender_full_name": "Notification Bot",
        "timestamp": 1755178034
    },
    {
        "content": "<p>I have written a suite of tactics for normalizing expressions for commutative rings (like <code>ring</code>), but which support <code>algebraMap</code> and scalar multiplication over a fixed base ring. I also used these to implemented tactics for proving equality of <code>(Mv)Polynomial</code>s. </p>\n<p>You can try them out yourself at <a href=\"https://github.com/leanprover-community/mathlib4/pull/30374\">#30374</a>. The work is almost done, but I'd like some input on what people might expect to be able to do with these tactics before I get it ready for a mathlib PR. If you have any examples where polynomial equations are harder to prove than they should be or you would want <code>ring</code> to close a goal but it doesn't, I would love to see them.</p>\n<p>More specifically,</p>\n<ul>\n<li><code>algebra</code> proves equality of expressions in an algebra over a ring, like <code>ring1</code></li>\n<li><code>algebra_nf</code> puts expressions in an algebra into a normal form, like <code>ring_nf</code></li>\n<li>\n<p><code>match_scalars_alg</code> (name pending) closes an equality goal by calling <code>algebra_nf</code> and creating side goals equating matching coefficients in the base ring. Like <code>match_scalars</code>.</p>\n</li>\n<li>\n<p><code>polynomial</code> proves equality of (mv)polynomials</p>\n</li>\n<li><code>polynomial_nf</code> expands polynomials into a sum-of-monomials form, combining coefficients in the base ring (e.g. <code>C a * X + C b * X</code> normalizes to <code>C(a+b) * X</code></li>\n<li><code>match_coefficients</code> expands polynomials and produces side goals equating matching coefficients.</li>\n</ul>\n<p>For some simple examples:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ring does not close the goal</span>\n<span class=\"w\">  </span><span class=\"n\">polynomial</span>\n\n<span class=\"c1\">-- Supports natural number exponents like `ring`</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">polynomial_nf</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> ⊢ C (a * b) + C b * X ^ n + C a * X ^ (n * 2) + X ^ (n * 3) = 0 -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">match_coefficients</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  ⊢ a ^ 2 = b</span>\n<span class=\"cm\">  ⊢ a * 2 = c</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">algebra</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">algebra_nf</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  ⊢ (a * b * 4 + a ^ 2 * 2 + b ^ 2 * 2) • (x * y) + (a * b * 2 + a ^ 2 + b ^ 2) • x ^ 2 +</span>\n<span class=\"cm\">    (a * b * 2 + a ^ 2 + b ^ 2) • y ^ 2 = 0</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>For the <code>algebra</code> tactics you can also explicitly specify the base ring as <code>algebra with R</code> if the automatic inference doesn't work as expected.</p>",
        "id": 544162751,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760100791
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"585783\">@Arend Mellendijk</span> Thanks! Since you said you're looking for examples, could you please try the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring</span>\n</code></pre></div>",
        "id": 544163553,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760101027
    },
    {
        "content": "<p>Here's where it gets you:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">match_coefficients</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> 1 = 1 / 4 + (√3 • I) ^ 2 * (-1 / 4) -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 544164044,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760101184
    },
    {
        "content": "<p>nice!</p>",
        "id": 544164346,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760101258
    },
    {
        "content": "<p>I'm a bit confused why there are 5 names for what seems like the same tactic</p>",
        "id": 544164456,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760101289
    },
    {
        "content": "<p>The same reason <code>ring</code>, <code>ring_nf</code> and <code>match_scalars</code> are separate tactics, surely? And I separated out <code>polynomial</code> because it needs separate pre/post processing to put it into forms involving <code>Polynomial.C</code>, and because it's easier and less error prone to find the base ring. I know some people want to get away from <code>Polynomial.C</code>, but I think that's a discussion for another thread.</p>",
        "id": 544165059,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760101480
    },
    {
        "content": "<p>I wonder if we can e.g. make <code>algebra</code> more configurable on usage, so that e.g. <code>polynomial</code> can be just a macro for <code>algebra [Polynomial.X] Polynomial.C</code></p>",
        "id": 544165871,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760101734
    },
    {
        "content": "<p>I'm not sure that's worth the effort without a concrete application. The polynomial tactics are only like 100 lines of code combined. Also <code>polynomial</code> actually doesn't  treat <code>Polynomial.X</code> specially in any way - it's just another variable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">polynomial</span>\n</code></pre></div>",
        "id": 544167795,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760102246
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"585783\">Arend Mellendijk</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Tactic.20for.20polynomial.2Falgebra/near/544167795\">said</a>:</p>\n<blockquote>\n<p>a concrete application</p>\n</blockquote>\n<p>I thought the goal is to treat <code>algebraMap </code>etc as a special map from the base ring to the algebra</p>",
        "id": 544168110,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760102331
    },
    {
        "content": "<p>so it would be useful to specify what <code>algebraMap</code> is in the case that it does not syntactically appear as <code>algebraMap</code></p>",
        "id": 544168183,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760102351
    },
    {
        "content": "<p>Do you have any examples other than <code>Polynomial</code> and <code>MvPolynomial</code>? This probably wouldn't be too hard to implement, but the tactic would need some way of knowing that <code>C x = algebraMap x</code>.</p>",
        "id": 544168926,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760102562
    },
    {
        "content": "<p>power series</p>",
        "id": 544169032,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760102598
    },
    {
        "content": "<p>I also do a bit of processing for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.map#doc\">docs#Polynomial.map</a>, but I don't know how much that will come up in practise.</p>",
        "id": 544169062,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760102608
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"585783\">Arend Mellendijk</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Tactic.20for.20polynomial.2Falgebra/near/544168926\">said</a>:</p>\n<blockquote>\n<p>the tactic would need some way of knowing that <code>C x = algebraMap x</code>.</p>\n</blockquote>\n<p>I think we should assume that <code>rfl</code> would solve this</p>",
        "id": 544169097,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760102623
    },
    {
        "content": "<p>I'm a bit worried that there are too many edge cases here - <code>polynomial</code>supports both <code>Polynomial</code> and <code>MvPolynomial</code> so it can't be as simple as <code>algebra Polynomial.C</code>, and by generalizing too much we lose the ability to do more processing specific to polynomials. Also <code>Polynomial.C</code> and <code>MvPolynomial.C</code> don't actually take the same arguments (there's an index type in there), so you'd have to very careful handling everything. </p>\n<p>And for power series specifically, it would actually be very easy to make <code>polynomial</code> support them.</p>",
        "id": 544173620,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760103916
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"585783\">Arend Mellendijk</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Tactic.20for.20polynomial.2Falgebra/near/544173620\">said</a>:</p>\n<blockquote>\n<p>And for power series specifically, it would actually be very easy to make <code>polynomial</code> support them.</p>\n</blockquote>\n<p>I'm concerned that this case-by-case approach would be a bit difficult to maintain, is there a way to make it more \"extensible\"? e.g. afaik norm_num can be extended to cover C without rewriting the whole tactic</p>",
        "id": 544174267,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760104086
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"585783\">Arend Mellendijk</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Tactic.20for.20polynomial.2Falgebra/near/544173620\">said</a>:</p>\n<blockquote>\n<p><code>Polynomial.C</code> and <code>MvPolynomial.C</code> don't actually take the same arguments</p>\n</blockquote>\n<p>I think they can be both elaborated to an expr with type <code>R →+* A</code> where <code>R</code> is the base ring and <code>A</code> is the algebra</p>",
        "id": 544174472,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760104138
    },
    {
        "content": "<p>Maybe just an extensible simp set? You tag some lemmas saying <code>C = algebraMap</code> and the tactic figures the rest out?</p>",
        "id": 544174616,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760104172
    },
    {
        "content": "<p>that's probably one approach</p>",
        "id": 544174677,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760104188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Tactic.20for.20polynomial.2Falgebra/near/544174472\">said</a>:</p>\n<blockquote>\n<p>I think they can be both elaborated to an expr with type <code>R →+* A</code> where <code>R</code> is the base ring and <code>A</code> is the algebra</p>\n</blockquote>\n<p>I think I can see how you'd do this now but there are some subtle issues. You wouldn't yet know the base ring because <code>algebra</code> attempts to infer it from any <code>smul</code>s and <code>algebraMap</code>s in the expression, so you'd have to find any occurrences of <code>C</code> and consider them as well. Annoying but doable. I'll add this to the TODOs list.</p>",
        "id": 544176783,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760104769
    },
    {
        "content": "<p>thanks!</p>",
        "id": 544176951,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760104818
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"585783\">@Arend Mellendijk</span> Great work! Do you think <code>algebra</code> would eventually subsume <code>ring</code>?</p>",
        "id": 544188682,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1760107975
    },
    {
        "content": "<p>Probably not, because (a) it uses the ring normal form internally for expressions in the base ring and (b) it's an extra layer of indirection on top of <code>ring</code> which would reduce performance. I haven't tested the performance claim in practise.</p>\n<p>That said, in theory it should be able to do anything <code>ring</code> does. It's missing one or two features at the moment but I can see how you would implement them.</p>",
        "id": 544189991,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760108326
    },
    {
        "content": "<p>This is probably not in scope of your tactics, but how does your work relate to a potential tactic that supports rings where some specific elements are a root of a polynomial? This would subsume <a href=\"https://github.com/leanprover-community/mathlib4/pull/26975\">#26975</a>. But the example above which faces the goal <code>1 = 1 / 4 + (√3 • I) ^ 2 * (-1 / 4)</code>, would also be finishsed by such a tactic, since both <code>√3</code> and <code>I</code> are square roots.</p>",
        "id": 544221179,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1760118463
    },
    {
        "content": "<p>Well expressions in the base ring are put into ring normal form, so if <code>ring</code> is somehow updated to work modulo some polynomial relations, I would guess <code>algebra</code>immediately closes <code>1 = 1 / 4 + (√3 • I) ^ 2 * (-1 / 4)</code>. </p>\n<p>The implementation of <code>algebra</code> is pretty similar to <code>ring</code> so to get polynomial relations to work in the algebra rather than the base ring you would have to duplicate some work, but it sounds doable to implement.</p>",
        "id": 544223592,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760119513
    },
    {
        "content": "<p>That said this is not something I put any thought into while writing the tactic.</p>",
        "id": 544223863,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1760119637
    },
    {
        "content": "<p>Why do we even use things like <code>Polynomial.C</code> instead of just using <code>algebraMap</code>? If we refactor usage away, we don't need a custom simpset.</p>",
        "id": 544356688,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1760224550
    },
    {
        "content": "<p>One argument is that <code>algebraMap</code> doesn't work for non-commutative rings.</p>",
        "id": 544356853,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1760224808
    },
    {
        "content": "<p>To spell out the downside, every time you do something like this, you have to duplicate the <code>algebraMap</code> API if you want to do computation</p>",
        "id": 544356929,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1760224941
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400289\">@Artie Khovanov</span> i did address this recently, in <a href=\"#narrow/channel/287929-mathlib4/topic/A.20quadratic.20scaling.20problem/near/544233068\">this proposal</a></p>",
        "id": 544378014,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760253268
    },
    {
        "content": "<p>Discussion/review seems to have stalled here. But I think this is a useful tactic!<br>\nCould some meta reviewers take this on please?</p>",
        "id": 557001997,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763453280
    },
    {
        "content": "<p>I made the suggestion that it may be better to keep constant factors/offsets (number literals) in the main ring instead of in the base ring. E.g if the main ring has characteristic 2 but the base ring has characteristic 0, we would like to be able to cancel out any twos. And it is always possible to lift constants from the base ring to the main ring, but not always veice versa (e.g. any ring can be given the base ring ℕ). However this would require refactoring the NurmNum IsRat machinery to use weaker type class assumptions.</p>",
        "id": 557877490,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763458041
    },
    {
        "content": "<p>So can that be a v2 of this tactic, and we first get the current one?</p>",
        "id": 557888498,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763461293
    }
]