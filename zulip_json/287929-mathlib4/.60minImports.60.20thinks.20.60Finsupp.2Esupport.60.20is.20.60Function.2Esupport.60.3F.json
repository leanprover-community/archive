[
    {
        "content": "<p>I'm working on splitting the Finsupp area of the library into neat definition files, and I found something surprising: enabling <code>linter.minImports</code> in <code>Data.Finsupp.Defs</code> claims that <code>Algebra.Group.Support</code> is needed to define the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finsupp#doc\">docs#Finsupp</a>. But if I remove the import, then the structure declaration works without issue. (commit <code>5f98fda3</code>)</p>\n<p>I suspect the issue is caused by <code>Finsupp</code> mentioning the name <code>support</code>, but this is the field <code>Finsupp.support</code> from the structure itself, not <code>Function.support</code>.</p>",
        "id": 480421622,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1730718955
    },
    {
        "content": "<p>I'll look into this: it is likely the syntax part of the linter trying too hard to be helpful.</p>",
        "id": 480422928,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730719508
    },
    {
        "content": "<p>There is also a remote chance that the import is not actually unneeded, but removing it causes type class to find a different path to a needed instance avoiding the import.  I've been confused by something like this before.</p>",
        "id": 480423737,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730719850
    },
    {
        "content": "<p>Anyway, I'll take a look when I'm back at a computer.</p>",
        "id": 480423792,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730719869
    },
    {
        "content": "<p>Personally I sometimes replace each file by its imports in between <code>#min_imports</code> runs, to avoid this kind of issue</p>",
        "id": 480425825,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1730720701
    },
    {
        "content": "<p>Anne, you were right: the culprit seems to be <code>support</code> that gets <em>also</em> resolved as <code>Finsupp.support</code>.</p>\n<p>I remember adding the extra <code>resolveGlobalName</code> that creates this in an attempt to catch more dependencies, but looking back at it, I do not think that this is necessary.  I am going to remove it, but please let me know if after the removal <code>minImports</code> fails to acknowledge some imports!</p>",
        "id": 480441420,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730726068
    },
    {
        "content": "<p>Thank you for the quick diagnosis! I'll have a lot of opportunities to test out the change :)</p>",
        "id": 480441563,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1730726120
    },
    {
        "content": "<p>Btw, I think that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Environment.findRedundantImports#doc\">docs#Lean.Environment.findRedundantImports</a> does not detect dependencies outside of mathlib.<br>\nEDIT: or maybe I am confused about differences...</p>",
        "id": 480441600,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730726130
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18609\">#18609</a></p>\n<p>However, there are some further issues: the <code>minImports</code> linter on <code>Mathlib/Data/Finsupp/Defs.lean</code> says that <code>Init.Data.List.Nat.Pairwise</code> is a missing import, but it is transitively imported.</p>\n<p>I need to investigate this further.</p>",
        "id": 480462205,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730732056
    },
    {
        "content": "<p>Oh, that error has been occurring a few times for me before (I don't think in <code>Finsupp/Defs.lean</code> specifically but certainly in some other files).</p>",
        "id": 480661068,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1730793854
    },
    {
        "content": "<p>Yes, I agree and it has also been reported <a href=\"#narrow/channel/287929-mathlib4/topic/minImports.20missing.20imports.20from.20Init\">here</a>.</p>",
        "id": 480661146,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730793891
    },
    {
        "content": "<p>I suspect that with the <code>Init</code> files there is an issue in the tools that <code>minImports</code> uses, not actually with <code>minImports</code> itself, but I have not yet found the root cause.</p>",
        "id": 480661231,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730793926
    },
    {
        "content": "<p>I see, thanks!</p>",
        "id": 480661265,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1730793942
    },
    {
        "content": "<p>I am tempted to remove <code>awaiting-author</code> on <a href=\"https://github.com/leanprover-community/mathlib4/pull/18609\">#18609</a> and work separately on finding the cause of this issue.</p>",
        "id": 480661400,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730793981
    },
    {
        "content": "<p>They seem completely unrelated, after all.</p>",
        "id": 480661431,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730793990
    },
    {
        "content": "<p>Done!</p>",
        "id": 480661467,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730794006
    }
]