[
    {
        "content": "<p>Should there <em>ever</em> be <del><code>Prop</code>-valued</del> EDIT: <code>Prop</code>-typed <code>def</code>s?</p>\n<p>I can imagine \"sometimes <code>Prop</code>\" <code>def</code>s (i.e. whose type is a <code>Sort u</code>), but I'm not sure why we would ever want to avoid (or be unable to use) <code>theorem</code> if the type of the decl was a <code>Prop</code>.</p>\n<p>I'm asking to see if (1) I ought to consider this edge case in a particular setting (2) to see if we ought to lint against <code>Prop</code>-typed <code>def</code>s. :)</p>",
        "id": 561977542,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764883830
    },
    {
        "content": "<p>Just to be clear, you mean <code>def</code>s whose type is itself a <code>Prop</code>, rather than a <code>def</code> whose type is <code>Prop</code>, right?</p>",
        "id": 561979063,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1764884460
    },
    {
        "content": "<p>like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RiemannHypothesis#doc\">docs#RiemannHypothesis</a> ? (edit: apparently not!)</p>",
        "id": 561979102,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764884475
    },
    {
        "content": "<p>you means <code>def</code>s whose value is a proof?</p>",
        "id": 561979118,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764884484
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Prop-valued.20defs.3F/near/561979063\">said</a>:</p>\n<blockquote>\n<p>Just to be clear, you mean <code>def</code>s whose type is itself a <code>Prop</code>, rather than a <code>def</code> whose type is <code>Prop</code>, right?</p>\n</blockquote>\n<p>Correct! <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> <code>def</code>s which you could, presumably, replace with <code>theorem</code>.</p>",
        "id": 561979163,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764884502
    },
    {
        "content": "<p>(I should, in fact, not have said \"<code>Prop</code>-valued\"; I think all readings of that are not what I wanted to mean. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>)</p>",
        "id": 561979637,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764884616
    },
    {
        "content": "<p>Currently, <code>instance</code>s are <code>def</code>s even if they can be theorems.</p>",
        "id": 561980754,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1764885131
    },
    {
        "content": "<p>I don't believe that's true (anymore?): :)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Environment</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findAsync?</span><span class=\"w\"> </span><span class=\"ss\">``foo</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"no foo\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findAsync?</span><span class=\"w\"> </span><span class=\"ss\">``bar</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"no bar\"</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"foo kind: {repr foo.kind}</span><span class=\"se\">\\n</span><span class=\"s2\">bar kind: {repr bar.kind}\"</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  foo kind: Lean.ConstantKind.thm</span>\n<span class=\"cm\">  bar kind: Lean.ConstantKind.defn</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>",
        "id": 561981700,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764885570
    },
    {
        "content": "<p><code>theorem</code>s can't be match patterns, so you get things like <code>def rfl</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=rfl#doc\">docs#rfl</a>) and <code>def HEq.rfl</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HEq.rfl#doc\">docs#HEq.rfl</a>). Actually, I don't think there's a single other declaration where there's a reason for it being a def and not a theorem, although there are still some others, e.g. from aliases using <code>abbrev</code>s in core (since core doesn't have the <code>alias</code> command), or from instances using delta deriving. In total there are actually 256 such <code>def</code>s that could be theorems:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">reports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">isBlackListed</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">continue</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">defnInfo</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">continue</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">isProp</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">reports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">reports</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">reports</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">reports</span><span class=\"bp\">.</span><span class=\"n\">qsort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{.joinSep (reports.map MessageData.ofConstName).toList (.ofFormat .line)}\"</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{reports.size} reports\"</span>\n</code></pre></div>",
        "id": 561983535,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1764886385
    },
    {
        "content": "<p>Ah, okay! So <em>some</em> instances are indeed defs when they could be theorems. :)</p>\n<p>I suppose it might be reasonable to exclude declarations marked with <code>match_pattern</code> on principle, even if it's basically just the two; out of curiosity, filtering by declarations marked <code>@[match_pattern]</code> reveals this other family of <code>match_pattern</code> proofs:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FP</span><span class=\"bp\">.</span><span class=\"n\">cons</span>\n<span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FP</span><span class=\"bp\">.</span><span class=\"n\">head</span>\n<span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FP</span><span class=\"bp\">.</span><span class=\"n\">tail</span>\n<span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">cons</span>\n<span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">head</span>\n<span class=\"n\">Hindman</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">tail</span>\n</code></pre></div>",
        "id": 561985241,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764887161
    },
    {
        "content": "<p>About those instances: \"should\" they be theorems, or is there a reason why delta-deriving somehow means that making them defs is the right choice...? (I can't think of anything, but just in case...)</p>",
        "id": 561985334,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764887219
    },
    {
        "content": "<p>I may be missing a subtlety of what you want to lint against, is this different from the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Batteries.Tactic.Lint.defLemma#doc\">docs#Batteries.Tactic.Lint.defLemma</a> environment linter?</p>",
        "id": 561988308,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764888686
    },
    {
        "content": "<p>Nope, that's what I was looking for, great (at least by semantics)! :) </p>\n<p>But, do we run it in CI? Seems as though we don't if there are all these exceptions, right? It seems like it was last touched a couple of years ago, when some things were different (e.g. <a href=\"https://github.com/leanprover/lean4/pull/2575\">lean4#2575</a> is fixed now, and instances are (sometimes) handled differently.)</p>",
        "id": 561988750,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1764888906
    }
]