[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"452587\">@Cuma Kökmen</span> / <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span>, there is a comment in <a href=\"https://tqft.net/mathlib4files/Mathlib/MeasureTheory/Integral/TorusIntegral\">file#Mathlib/MeasureTheory/Integral/TorusIntegral</a> saying</p>\n<blockquote>\n<p>TODO: restore notation; <code>neg</code>, <code>add</code> etc fail if I use notation here</p>\n</blockquote>\n<p>Could you do one of:</p>\n<ul>\n<li>work how to fix this and do so,</li>\n<li>explain what the desired notation actually is</li>\n<li>or confirm that it's okay to simply delete this porting note</li>\n</ul>",
        "id": 504502229,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741594911
    },
    {
        "content": "<p>Let me have a look what it used in mathlib3</p>",
        "id": 505016896,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741749708
    },
    {
        "content": "<p>It used superscript <code>n</code> etc.</p>",
        "id": 505017016,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741749755
    },
    {
        "content": "<p>I'll have a look now</p>",
        "id": 505017138,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741749818
    },
    {
        "content": "<p>The example from the module docstring of <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> 's <code>Util/Superscript</code> doesn't work. I added <code>noWs</code> but I'm getting the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">elaboration</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">term___</span><span class=\"bp\">._@.</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Integral</span><span class=\"bp\">.</span><span class=\"n\">TorusIntegral</span><span class=\"bp\">._</span><span class=\"n\">hyg</span><span class=\"bp\">.</span><span class=\"m\">21</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">implemented</span>\n<span class=\"w\">  </span><span class=\"n\">ℂⁿ</span>\n</code></pre></div>\n<p>with this notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">syntax</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">noWs</span><span class=\"w\"> </span><span class=\"n\">superscript</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">macro_rules</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">noWs</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">superscript</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 505019503,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741750806
    },
    {
        "content": "<p>What am I doing wrong?</p>",
        "id": 505019600,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741750851
    },
    {
        "content": "<p>not sure if this is the issue, but <code>noWs</code> should not be in the match pattern</p>",
        "id": 505019674,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1741750879
    },
    {
        "content": "<p>Removed, same error.</p>",
        "id": 505019816,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741750930
    },
    {
        "content": "<p>have you tried not putting space between them?</p>",
        "id": 505019842,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1741750947
    },
    {
        "content": "<p>It works! Why?</p>",
        "id": 505019886,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741750972
    },
    {
        "content": "<p>well, that's what <code>noWs</code> does :)</p>",
        "id": 505019923,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1741750987
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22864\">#22864</a></p>",
        "id": 505020604,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741751277
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 505020654,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741751284
    },
    {
        "content": "<p>I think we concluded that it is not safe to use <code>subscript(term)</code> and <code>subscriptTerm</code> has to be used instead?</p>",
        "id": 505066415,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741769799
    },
    {
        "content": "<p>Then the module docstring should be updated.</p>",
        "id": 505308742,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741836929
    },
    {
        "content": "<p>(by someone who understand the difference between <code>subscript(term)</code> and <code>subscriptTerm</code>, thus not me)</p>",
        "id": 505308877,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1741836975
    },
    {
        "content": "<p>that was a workaround for a bug in lean, has it been fixed perhaps?</p>",
        "id": 505309074,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1741837066
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/6325\">https://github.com/leanprover/lean4/pull/6325</a> is still open</p>",
        "id": 505375520,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741860444
    },
    {
        "content": "<p>Maybe we should just comment out registering the <code>subscript()</code> alias</p>",
        "id": 505375698,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741860485
    }
]