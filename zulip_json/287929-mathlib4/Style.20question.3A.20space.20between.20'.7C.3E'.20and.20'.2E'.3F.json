[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/18923\">#18923</a>, <span class=\"user-mention\" data-user-id=\"481963\">@David Loeffler</span> just asked me to change <code>... |&gt;.false</code> into <code>... |&gt; .false</code>. I think I like the version without space better when dot notation follows. Is there a convention/consensus on how this should be formatted in Mathlib?</p>",
        "id": 482358766,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731580762
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>mstoll:~/lean4/mathlib4$ git grep '|&gt;\\.' | wc -l\n983\nmstoll:~/lean4/mathlib4$ git grep '|&gt; \\.' | wc -l\n3\n</code></pre></div>",
        "id": 482360689,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581370
    },
    {
        "content": "<p>Statistics seem to be in favor of no space...</p>",
        "id": 482360850,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581413
    },
    {
        "content": "<p>These are different syntaxes!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">fieldNotation</span><span class=\"bp\">.</span><span class=\"n\">generalized</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"sd\">/-- info: B.f a : B -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- info: A.f a : B -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Without space uses the namespace of the argument coming from the left, with space uses the namespace of the expected type.</p>",
        "id": 482361308,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1731581550
    },
    {
        "content": "<p>Should I know this?</p>",
        "id": 482361463,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581598
    },
    {
        "content": "<p>Probably? Lean has a large language surface.<br>\nEventually we‚Äôll be able to point to <a href=\"https://lean-lang.org/doc/reference/latest/Terms/#terms\">https://lean-lang.org/doc/reference/latest/Terms/#terms</a></p>",
        "id": 482361836,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1731581717
    },
    {
        "content": "<p>So <code>a |&gt;.f</code> is equivalent to <code>a.f</code>, but <code>a .f</code> is illegal...</p>",
        "id": 482362058,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482361836\">said</a>:</p>\n<blockquote>\n<p>Probably? Lean has a large language surface.<br>\nEventually we‚Äôll be able to point to <a href=\"https://lean-lang.org/doc/reference/latest/Terms/#terms\">https://lean-lang.org/doc/reference/latest/Terms/#terms</a></p>\n</blockquote>\n<p>I guess the point is that one has to realize first that there <em>might</em> be a difference...</p>",
        "id": 482362186,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581822
    },
    {
        "content": "<p>I think that is written <code>.f a</code>.</p>",
        "id": 482362203,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731581826
    },
    {
        "content": "<p>and <code>.f |&gt; a</code> is also illegal...</p>",
        "id": 482362351,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731581877
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Term.dotIdent#doc\">docs#Lean.Parser.Term.dotIdent</a> does not have a doc-string...</p>",
        "id": 482362684,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731581969
    },
    {
        "content": "<p>In the original PR, I believe \"the namespace of the argument coming from the left\" and \"the namespace of the expected type\" were the same ‚Äì¬†presumably this is not such an uncommon situation.</p>",
        "id": 482362829,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731582004
    },
    {
        "content": "<p>I wonder if there is a difference at the three places where Mathlib uses a space.</p>",
        "id": 482362971,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731582053
    },
    {
        "content": "<p>Or at the 983 where it doesn't!  <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 482363090,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731582090
    },
    {
        "content": "<p>Anyway, my impression is that the inofficial convention is to not use a space (except perhaps when it makes a difference and you want the other syntax?).</p>",
        "id": 482363366,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731582190
    },
    {
        "content": "<p>I'd propose using <code>a |&gt;.f</code> where you would have otherwise written <code>a.f</code>, and <code>a |&gt; .f</code> where you would have otherwise written <code>.f a</code>. I would guess the latter is quite rare.</p>",
        "id": 482363629,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731582273
    },
    {
        "content": "<p>Does mathlib use <code>|&gt;</code> at all besides as <code>|&gt;.</code> and the three cases above?</p>",
        "id": 482363778,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731582327
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>$ git grep '|&gt; [^\\.]' | wc -l\n119\n</code></pre></div>\n<p>if this is an indication...</p>",
        "id": 482363948,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731582373
    },
    {
        "content": "<p>I suspect the relative rarity of <code>|&gt; .f</code> is probably because \"anonymous\" dot-notation (dot-notating off the expected type) is a fairly recent introduction, and there are a lot of places in mathlib where it could be used but isn't.</p>",
        "id": 482364156,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731582449
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482362351\">said</a>:</p>\n<blockquote>\n<p>and <code>.f |&gt; a</code> is also illegal...</p>\n</blockquote>\n<p>Not illegal. If lean can infer the expected type of <code>.f</code> it will use it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- info: !true : Bool -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"n\">not</span>\n</code></pre></div>",
        "id": 482364498,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1731582534
    },
    {
        "content": "<p><code>.f &lt;| a</code> does work <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> (in the earlier example).</p>",
        "id": 482364815,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731582613
    },
    {
        "content": "<p>Are there any subtleties around <code>&lt;|</code> as well?</p>",
        "id": 482364885,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731582637
    },
    {
        "content": "<p>Both <code>&lt;|</code> and <code>|&gt;</code> are rather simple, and are orthogonal to the <code>.f</code> notation, so one can understand them separately.</p>\n<p>It‚Äôs <code>e |&gt;.f x y</code> that‚Äôs a bit unexpected, but if you think of <code>|&gt;.</code> as it‚Äôs own thing, separate from <code>|&gt;</code>, it‚Äôs not too confusing I‚Äôd say.</p>",
        "id": 482365409,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1731582800
    },
    {
        "content": "<blockquote>\n<p>Both¬†<code>&lt;|</code>¬†and¬†<code>|&gt;</code>¬†are rather simple</p>\n</blockquote>\n<p>I'm actually not a fan of them myself, particularly <code>|&gt;</code>: I find it disturbs reading the code because you have to back-track to work out where the implicit left-parenthesis should go. Is there any chance we could make VSCode indicate this visually (like it does with coloured parentheses)?</p>",
        "id": 482370361,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731584447
    },
    {
        "content": "<p>Does hovering over <code>&lt;|</code> not already show what you want?</p>",
        "id": 482372485,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731585145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482372485\">said</a>:</p>\n<blockquote>\n<p>Does hovering over <code>&lt;|</code> not already show what you want?</p>\n</blockquote>\n<p>No, it doesn't. Is it supposed to?</p>\n<p>(It shows a box with a general docstring about <code>&lt;|</code> and <code>|&gt;</code>, and the type of the expression in which it occurs, but it doesn't make any attempt to show you where the hidden opposite parenthesis goes.)</p>",
        "id": 482373239,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731585404
    },
    {
        "content": "<p>I get a dark blue highlight around the extent of the <code>&lt;|</code>: <br>\n<a href=\"/user_uploads/3121/T4QEMkNkiCC7d7Mk9fPXlmPk/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/T4QEMkNkiCC7d7Mk9fPXlmPk/image.png\" title=\"image.png\"><img data-original-dimensions=\"679x125\" src=\"/user_uploads/thumbnail/3121/T4QEMkNkiCC7d7Mk9fPXlmPk/image.png/840x560.webp\"></a></div>",
        "id": 482374057,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731585672
    },
    {
        "content": "<p>Here are the three lines using <code>|&gt; .</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"bp\">'|&gt;</span><span class=\"w\"> </span><span class=\"bp\">\\.'</span>\n<span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Hashing</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">imps</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">imports</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">module</span><span class=\"bp\">.</span><span class=\"n\">components</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Analysis</span><span class=\"bp\">/</span><span class=\"n\">Complex</span><span class=\"bp\">/</span><span class=\"n\">Tietze</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">Basis</span><span class=\"bp\">.</span><span class=\"n\">ofVectorSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">equivFun</span><span class=\"bp\">.</span><span class=\"n\">toContinuousLinearEquiv</span><span class=\"bp\">.</span><span class=\"n\">toHomeomorph</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of_homeo</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">/</span><span class=\"n\">MeasurableSpace</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">setOf_finite</span><span class=\"w\"> </span><span class=\"bp\">|&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">compl</span>\n</code></pre></div>\n<p>The middle one even uses both versions!</p>",
        "id": 482377763,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731586773
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482374057\">said</a>:</p>\n<blockquote>\n<p>I get a dark blue highlight around the extent of the <code>&lt;|</code>: <br>\n<a href=\"/user_uploads/3121/T4QEMkNkiCC7d7Mk9fPXlmPk/image.png\">image.png</a></p>\n</blockquote>\n<p>Sorry, you're right: the highlight is there, it's just so faint that it's almost invisible to my middle-aged eyesight so I had never noticed it before. (I'll have to see if I can tinker with the VSCode settings to turn the contrast up.)</p>",
        "id": 482378524,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731587027
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"481963\">David Loeffler</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482364156\">said</a>:</p>\n<blockquote>\n<p>I suspect the relative rarity of <code>|&gt; .f</code> is probably because \"anonymous\" dot-notation (dot-notating off the expected type) is a fairly recent introduction, and there are a lot of places in mathlib where it could be used but isn't.</p>\n</blockquote>\n<p>I agree that in lot of places  \"it could be used\", but I would argue that short of a proper doc (perhaps on the community website) it is perhaps better to refrain from using it. It makes the code harder to understand and harder to review for people who are not comfortable with it, creating a barrier that does not seem justified by limited the number of characters saved by using the anonymous dot notation.</p>",
        "id": 482450106,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1731606747
    },
    {
        "content": "<p>Anonymous dot notation can save quite a lot of characters for things like <code>.add (.mul _ _) (.mul _ _)</code> vs <code>Foo.add (Bar.mul  _ _) (Baz.mul _ _)</code></p>",
        "id": 482450476,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731606862
    },
    {
        "content": "<p>characters and <em>thinking time</em> to find the right namespace</p>",
        "id": 482451421,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731607162
    },
    {
        "content": "<p>It's never occurred to me that one could write <code>x |&gt; .f</code> before. I've used <code>x |&gt;.f</code> occasionally, but in programming contexts, not math ones. It's useful for chaining operations on a single object, like <code>d |&gt;.insert key1 val1 |&gt;.insert key2 val2</code>.</p>\n<p>I see mathlib has been using <code>|&gt;.</code> notation in math. First I found was <code>subset_tsupport _ |&gt;.trans (tsupport_subset f)</code>, instead of <code>(subset_tsupport _).trans (tsupport_subset f)</code>. It saves parentheses at the cost of an extra space character :-)</p>",
        "id": 482451476,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731607181
    },
    {
        "content": "<p>I find it useful when <code>(...).something</code> would exceed the line length limit; instead I can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"w\">  </span><span class=\"bp\">|&gt;.</span><span class=\"n\">something</span>\n</code></pre></div>\n<p>which I usually find easier to read than breaking the long <code>...</code> somewhere in the middle.</p>",
        "id": 482451913,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731607306
    },
    {
        "content": "<p><code>|&gt;.trans &lt;|</code> is a very handy pattern for chaining term mode equalities without having to back to the start of the line and add another <code>(</code></p>",
        "id": 482451957,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731607317
    },
    {
        "content": "<p>I use <code>|&gt;.comp &lt;|</code> and <code>|&gt;.trans &lt;|</code> a lot, and <code>|&gt;.</code> in general.</p>",
        "id": 482453990,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1731608011
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Style.20question.3A.20space.20between.20'.7C.3E'.20and.20'.2E'.3F/near/482451476\">said</a>:</p>\n<blockquote>\n<p>It's never occurred to me that one could write <code>x |&gt; .f</code> before</p>\n</blockquote>\n<p>Me neither, and I'm to be blamed for both notations!</p>",
        "id": 482754912,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1731749798
    }
]