[
    {
        "content": "<p>Consider this snippet:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>Here <code>ring</code> closes the goal, succesfully, but it gives the <code>Try this: ring_nf</code> message which it typically does when it fails to close the goal. This feels like a spurious suggestion.</p>\n<p>Even more oddly, <code>ring1</code> actually <em>does</em> fail to close the goal. I don't know what <code>ring1</code> is <em>supposed</em> to do, but the docstring is clearly missing something: <code>ring1 fails if the target is not an equality.</code>. The target is an equality, and <code>ring</code> can close it, but <code>ring1</code> rejects it.</p>",
        "id": 525217403,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750604224
    },
    {
        "content": "<p>this is expected behavior. When <code>ring1</code> fails to close the goal, it suggests that you call <code>ring_nf</code> and then it calls <code>ring_nf</code> itself. So if you have no goals after then that means <code>ring_nf</code> will close the goal</p>",
        "id": 525218080,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750604914
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60ring.60.20suggests.20.60ring_nf.60.20although.20it.20closes.20goal/near/525217403\">said</a>:</p>\n<blockquote>\n<p>Even more oddly, <code>ring1</code> actually <em>does</em> fail to close the goal. I don't know what <code>ring1</code> is <em>supposed</em> to do, but the docstring is clearly missing something: <code>ring1 fails if the target is not an equality.</code>. The target is an equality, and <code>ring</code> can close it, but <code>ring1</code> rejects it.</p>\n</blockquote>\n<p>That's not an exhaustive list. <code>ring1</code> also fails to close the goal if it's an equality but it's not true, or not in the language of rings.</p>",
        "id": 525218178,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750605017
    },
    {
        "content": "<p>This case is exactly one where we expect <code>ring1</code> not to work but <code>ring_nf</code> does. It has the form <code>f(x) = f(x')</code> where <code>x = x'</code> is a ring equality and <code>f</code> is an opaque function. <code>x ^ -</code> is an opaque function here because this is the real power function, not the monoid power function.</p>",
        "id": 525218275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750605158
    },
    {
        "content": "<p>Ah... well, both of those felt pretty unclear from the docstring (to me)</p>",
        "id": 525218759,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750605773
    },
    {
        "content": "<p>Thanks though</p>",
        "id": 525218769,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750605780
    },
    {
        "content": "<p>Maybe you can suggest better wording <span aria-label=\"innocent\" class=\"emoji emoji-1f607\" role=\"img\" title=\"innocent\">:innocent:</span></p>",
        "id": 525218837,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750605844
    },
    {
        "content": "<p>I would but since I'm not (still) not very clear on the difference, I hesitate to <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 525219641,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1750606824
    },
    {
        "content": "<p>Previously I was asked to file an issue for this: <a href=\"https://github.com/leanprover-community/mathlib4/pull/24910\">#24910</a></p>",
        "id": 525260359,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1750658955
    },
    {
        "content": "<p>So <code>congr 1; ring</code> works?</p>",
        "id": 525264214,
        "sender_full_name": "Jz Pan",
        "timestamp": 1750661157
    },
    {
        "content": "<p>Mario always says \"works as intended\" when this comes up but the fact remains that it confuses a lot of people. Maybe the error message should somehow be changed?</p>",
        "id": 525270581,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750663965
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60ring.60.20suggests.20.60ring_nf.60.20although.20it.20closes.20goal/near/525218837\">said</a>:</p>\n<blockquote>\n<p>Maybe you can suggest better wording <span aria-label=\"innocent\" class=\"emoji emoji-1f607\" role=\"img\" title=\"innocent\">:innocent:</span></p>\n</blockquote>",
        "id": 525280017,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750667562
    },
    {
        "content": "<p>My suggestion is that the warning be removed in this case because users find it confusing.</p>",
        "id": 525283183,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750668644
    },
    {
        "content": "<p>it could be demoted to a linter warning</p>",
        "id": 525284765,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750669110
    }
]