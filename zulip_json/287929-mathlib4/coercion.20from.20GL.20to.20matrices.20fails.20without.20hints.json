[
    {
        "content": "<p>It's well-known that things like this fail:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">GeneralLinearGroup</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsFoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsFoo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GL</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsFoo</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"c1\">-- application type mismatch</span>\n</code></pre></div>\n<p>with error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>application type mismatch\n  IsFoo M\nargument\n  M\nhas type\n  GL Unit ℤ : Type\nbut is expected to have type\n  Matrix ?m.101 ?m.101 ?m.102 : Type (max ?u.100 ?u.99)\n</code></pre></div>\n<p>The usual explanation is something like \"When Lean is given <code>M : GL Unit ℤ</code> and it wants a matrix, it knows the coercion from <code>GL Unit ℤ</code> to <code>Matrix Unit Unit ℤ</code> but doesn't apply it because there might be other coercions to <code>Matrix n n R</code>\". But can we just make Lean choose the obvious one automatically somehow?</p>",
        "id": 463654770,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724148040
    },
    {
        "content": "<p>This same issue happens <em>all the time</em> with the coercion <code>Finset α → Set α</code>. We really really need a solution here</p>",
        "id": 463655047,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724148089
    },
    {
        "content": "<p>I was hoping default instances could fix it, but I am not sure of the performance impact of making <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.instCoeTCSet#doc\">docs#Finset.instCoeTCSet</a> a default instance, as there are many <code>CoeTC</code> instances out there</p>",
        "id": 463655241,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724148146
    },
    {
        "content": "<p>An RFC for cut rules for synthesis would be great</p>",
        "id": 463655338,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724148186
    },
    {
        "content": "<p>This came up recently elsewhere (and has a few times before)</p>",
        "id": 463655432,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724148211
    },
    {
        "content": "<p>What's the status of unification hints?</p>",
        "id": 463655766,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724148281
    },
    {
        "content": "<p>Has their status changed recently?</p>",
        "id": 463655922,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724148335
    },
    {
        "content": "<p>Well, there's a risk they're transitioning from \"unused\" to \"not supported\"</p>",
        "id": 463659605,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724149903
    },
    {
        "content": "<p>If I step through this, I get a problem with metavariable depth (probably) making it unassignable.</p>",
        "id": 463798696,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724184069
    }
]