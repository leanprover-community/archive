[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">ProbabilityTheory</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ofDigits</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- syntax error</span>\n</code></pre></div>",
        "id": 504149983,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741369710
    },
    {
        "content": "<p>This is caused by notations like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The conditional probability measure of measure `μ` on set `{ω | X ω = x}`.</span>\n\n<span class=\"sd\">It is `μ` restricted to `{ω | X ω = x}` and scaled by the inverse of `μ {ω | X ω = x}`</span>\n<span class=\"sd\">(to make it a probability measure): `(μ {ω | X ω = x})⁻¹ • μ.restrict {ω | X ω = x}`. -/</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"s2\">\"[\"</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"s2\">\" | \"</span><span class=\"w\">  </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"s2\">\" in \"</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"o\">[</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⁻¹'</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 504150078,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741369743
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22699\">#22699</a> has a fix, but it loses all the delaborators</p>",
        "id": 504151057,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741370103
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>, could <code>notation</code> or <code>notation3</code> be taught to accept <code>noWs</code>?</p>",
        "id": 504151096,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741370116
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 504156809,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741371853
    },
    {
        "content": "<p><del>cc <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  for <a href=\"https://github.com/leanprover-community/mathlib4/pull/18663\">#18663</a></del></p>",
        "id": 504157364,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741372035
    },
    {
        "content": "<p>Oh whoops, I forgot to open the scope for that one, sorry</p>",
        "id": 504157735,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741372151
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/List.20notation.20is.20broken.20by.20conditional.20probability/near/504151057\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22699\">#22699</a> has a fix, but it loses all the delaborators</p>\n</blockquote>\n<p>I've added back the delaborators now.</p>",
        "id": 504161385,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741373267
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/List.20notation.20is.20broken.20by.20conditional.20probability/near/504151096\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span>, could <code>notation</code> or <code>notation3</code> be taught to accept <code>noWs</code>?</p>\n</blockquote>\n<p>I think so, but it might take re-imagining how they work to some degree.</p>\n<p>By the way, in your PR, it looks like you can use an app unexpander for everything but <code>DFunLike.coe</code>. App unexpanders are nice because they look like the inverse of the macro. (<code>notation</code> defines app unexpanders)</p>",
        "id": 504163616,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741374000
    },
    {
        "content": "<p>Done, thanks for the reminder than unexpanders exist</p>",
        "id": 504165013,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741374329
    },
    {
        "content": "<p>Would it be possible for errors like \"expected |\" to appear as \"expected | (from parser <a href=\"http://Foo.bar\">Foo.bar</a> and Bar.baz)\" to make this kind of trap easier to track down in future</p>",
        "id": 504436744,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741558039
    },
    {
        "content": "<p>or at least an option to enable this kind of debug message</p>",
        "id": 504562494,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741609279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/List.20notation.20is.20broken.20by.20conditional.20probability/near/504436744\">said</a>:</p>\n<blockquote>\n<p>Would it be possible for errors like \"expected |\" to appear as \"expected | (from parser <a href=\"http://Foo.bar\">Foo.bar</a> and Bar.baz)\" to make this kind of trap easier to track down in future</p>\n</blockquote>\n<p>the code is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Error.toString#doc\">docs#Lean.Parser.Error.toString</a></p>",
        "id": 504564572,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741609749
    }
]