[
    {
        "content": "<p>I am not well-versed in abstract algebra, so I want to ask if there can be two R-algebras with different structure maps?</p>\n<p>I am asking to see if there are multiple instances, how does mathlib4 know which one to use?</p>",
        "id": 485519946,
        "sender_full_name": "The-Anh Vu-Le",
        "timestamp": 1733092611
    },
    {
        "content": "<p>It uses the last one that it saw. You can have two maps <code>f g : R →+* S</code> but you cannot use the <code>[Algebra R S]</code> typeclass for both of them; the typeclass inference system works under the assumption that there's at most one term of a typeclass type, and if there is more than one then code is likely to break in obscure ways -- this is called a \"diamond\" by the community here.</p>",
        "id": 485520118,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733092801
    },
    {
        "content": "<p>The notation <code>R →+* S</code> is notation for <code>RingHom R S</code> and this is a structure, not a class, so it's fine to have more than one term of that type.</p>",
        "id": 485520195,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733092865
    },
    {
        "content": "<p>Of course you can have <code>[Algebra R A]</code> and <code>[Algebra R B]</code>, that's fine.</p>",
        "id": 485520282,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733092962
    },
    {
        "content": "<p>Correct me if I'm wrong, I think \"diamonds\" refer to the issue where depending on which way you go through the class hierarchy you might get different equal-but-not-defeq definitions.</p>\n<p>I think the word \"canonicity\" is used for the assumption that there's at most one instance.</p>",
        "id": 485521520,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733094236
    },
    {
        "content": "<p>Oh I see, a diamond is more general than \"two instances of one class\", it's \"two unequal paths through the typeclass system\" (possibly of larger length than one)</p>",
        "id": 485521969,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733094629
    },
    {
        "content": "<p>I think \"diamond\" is also used for not-equal-at-all, such as the conflict caused by <code>Algebra R A[X]</code> and <code>Algebra R[X] A[X]</code> (both assuming <code>Algebra R A</code>) for <code>Algebra R[X] R[X][X]</code></p>",
        "id": 485522874,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733095472
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Can.20there.20be.20two.20instances.20of.20.60Algebra.20R.20A.60.3F/near/485521520\">said</a>:</p>\n<blockquote>\n<p>I think the word \"canonicity\" is used for the assumption that there's at most one instance.</p>\n</blockquote>\n<p>Wait, are you claiming there is a definition of \"canonical\"? <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 485649400,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1733153130
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">canonical</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>",
        "id": 485649684,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1733153200
    },
    {
        "content": "<p>That's my working definition of canonical in lean!</p>",
        "id": 485657754,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733155311
    },
    {
        "content": "<p>a bit late, but just to note: If you do have a statement about two algebra structures, you could still formulate it as <code>theorem xyz (h1 : Algebra R S) (h2 : Algebra R S) ... : ... := ...</code> instead of using <code>[]</code>. Then the user has to provide the algebras manually when using the theorem, but could still use <code>inferInstance</code> to canonically fill in one of the two arguments.</p>",
        "id": 488026568,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1733899623
    },
    {
        "content": "<p>This is still going to be a nightmare because Lean will automatically pick between the two in the theorem statement in a probably-surprising way.</p>",
        "id": 488027369,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733899963
    }
]