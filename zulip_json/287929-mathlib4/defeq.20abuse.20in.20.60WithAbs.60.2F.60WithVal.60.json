[
    {
        "content": "<p>In some recent PRs I noticed some defeq abuse (of my own making) in the type synonyms <code>WithAbs</code> and <code>WithVal</code>. Specifically, instances of the form <code>Algebra (WithVal v) S</code> were inferred through defeq, so I propose a fix in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34049\">#34049</a> to compose with the canonical isomorphism between <code>WithVal</code> and the original type as <code>Algebra.compHom S (WithVal.equiv v).toRingHom</code>. In a review <span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span>  suggested we might use a 1-field structure as the definition instead to avoid this happening in the first place and I then saw that precisely that had occurred for <code>WithLp</code> (see <a href=\"#narrow/channel/287929-mathlib4/topic/defeq.20abuse.20in.20.60WithLp.60/near/526234806\">Zulip thread</a>).</p>\n<p>Is the general consensus that type synonyms should now be 1-field structures as is done in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithLp#doc\">docs#WithLp</a> ? Or is it case-by-case?</p>",
        "id": 569663323,
        "sender_full_name": "Salvatore Mercuri",
        "timestamp": 1769158424
    },
    {
        "content": "<p>I think there's some consensus that we want to do this, but it would be too difficult in some situations such as with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OrderDual#doc\">docs#OrderDual</a>, where we abuse the def-eq all over the place.</p>",
        "id": 569685649,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769165308
    },
    {
        "content": "<p>I think we should do it with <code>OrderDual</code> as well, I'd happily do the work, I am just waiting to be encouraged to do it.</p>",
        "id": 569703927,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1769171624
    },
    {
        "content": "<p>I think we should wait for most of the library to be tagged with <code>to_dual</code>, which should get rid of most of the def-eq abuse.</p>",
        "id": 569948621,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769341249
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/287929-mathlib4/topic/defeq.20abuse.20in.20.60WithAbs.60.2F.60WithVal.60/near/569703927\">said</a>:</p>\n<blockquote>\n<p>I think we should do it with <code>OrderDual</code> as well, I'd happily do the work, I am just waiting to be encouraged to do it.</p>\n</blockquote>\n<p>Don't forget my enthusiasm for getting <code>WithTop</code> and <code>WithBot</code> sorted asap! :-)</p>",
        "id": 570301684,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769515322
    }
]