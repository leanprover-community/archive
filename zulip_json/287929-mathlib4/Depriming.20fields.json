[
    {
        "content": "<p>The new Lean release has a feature where you can override the binder kinds for the type's parameters in structure/class fields. For example, I just made <a href=\"https://github.com/leanprover-community/mathlib4/pull/23656\">mathlib#23656</a> to deprime the field for <code>CharP</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">CharP</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddMonoidWithOne</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">cast_eq_zero_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â†”</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ£</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>This makes <code>R</code> and <code>p</code> explicit in <code>CharP.cast_eq_zero_iff</code>. They would normally be implicit since they appear in the return type.</p>\n<p>The rule is that you can only override the binder kinds for parameters that actually appear in the declaration. There's an error if you try overriding binder kinds for parameters from <code>variables</code>.</p>\n<p>(<code>CharP</code> is the class that <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> mentioned in <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/RFC.3A.20adjust.20argument.20explicitness.20on.20typeclass.20projections/near/423072202\">#lean4 &gt; RFC: adjust argument explicitness on typeclass projections @ ðŸ’¬</a>)</p>",
        "id": 510093978,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743747160
    },
    {
        "content": "<p>Do we want to lint for places that could/should use this? Do we want to add these cases to the technical debt counter?</p>",
        "id": 510102727,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743748814
    },
    {
        "content": "<p>Is this also possible for constructors? That would let us merge <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ModuleCat.of#doc\">docs#ModuleCat.of</a> and <a href=\"http://ModuleCat.mk\">ModuleCat.mk</a></p>",
        "id": 510111453,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743752253
    },
    {
        "content": "<p>No, that feature doesn't exist, and I think that would require a change to the kernel (!)</p>",
        "id": 510111831,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1743752399
    },
    {
        "content": "<p>Just generating a list of all primed field names would be a great start.</p>",
        "id": 510554593,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743998386
    },
    {
        "content": "<p>Note that fields like <code>*.map_add'</code> shouldn't be unprimed.</p>",
        "id": 510554935,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743998558
    },
    {
        "content": "<p>Yes, one way of finding an approximate list of targets is to search the mathlib3 source code for the <code>[]</code> pattern in structures (I wrote a regex in the lean 4 issue which seemed to be doing the trick)</p>",
        "id": 510569482,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744006509
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Depriming.20fields/near/510111831\">said</a>:</p>\n<blockquote>\n<p>No, that feature doesn't exist, and I think that would require a change to the kernel (!)</p>\n</blockquote>\n<p>I assume the same applies to <code>inductive</code> arms?</p>",
        "id": 515585411,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1746135039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"359992\">@Robert Maxton</span> Correct, you can't change the implicitness of a type's parameters in a constructor. The next best thing is to define your own pattern using <code>@[match_pattern]</code> to sort of override the constructor.</p>",
        "id": 515586243,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1746135397
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Depriming.20fields/near/510569482\">said</a>:</p>\n<blockquote>\n<p>Yes, one way of finding an approximate list of targets is to search the mathlib3 source code for the <code>[]</code> pattern in structures (I wrote a regex in the lean 4 issue which seemed to be doing the trick)</p>\n</blockquote>\n<p>There is an open issue now with a list produced in this way</p>",
        "id": 515626576,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746154840
    }
]