[
    {
        "content": "<p>I made <a href=\"https://github.com/leanprover-community/mathlib4/pull/24997\">#24997</a> to remove a duplicate lemma that I spotted. This made me wonder if this is a more general problem that can be tackled with automation, so I wrote a program to find pairs of lemmas that are duplicated of eachother. It takes into account that arguments can have different orders. Of course there are many cases where we want multiple names for the same lemma, but many cases also look accidental. In particular we can restrict it to just instances, since those don't have good reasons to be duplicates, and we can still find many duplicates.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\"><pre><span></span><code>import Mathlib\n\nopen Lean Meta\n\ndef sortHyps (fvars : Array Expr) (e : Expr) : MetaM (Array (Expr × BinderInfo) × Expr) := do\n  let n := fvars.size\n  let fvars : Vector Expr n := fvars.toVector\n  let mut types ← fvars.mapM (some &lt;$&gt; inferType ·)\n  let mut e := e\n  let mut result := #[]\n  for h : j in [:n] do\n    let mut ominIdx : Option (Fin n) := none\n    let mut minType : Expr := default\n    for h : i in [:n] do\n      if let some type := types[i] then\n        if !type.hasFVar then\n          if ominIdx.isNone || type.quickLt minType then\n            ominIdx := some ⟨i, by get_elem_tactic⟩\n            minType := type\n    let some minIdx := ominIdx | throwError &quot;{types.toArray}&quot;\n    let fvar := fvars[minIdx]\n    result := result.push (minType, ← fvar.fvarId!.getBinderInfo)\n    types := types.set minIdx none\n    let abst (e : Expr) := e.liftLooseBVars 0 1 |&gt;.abstract #[fvar]\n    types := types.map (Option.map abst)\n    e := abst e\n  return (result, e)\n\ndef runLinter : MetaM Unit := do\n  _ ← (← getEnv).constants.map₁.foldM (init := ({} : Std.HashMap _ (Name × Expr))) fun (s : Std.HashMap (Array (Expr × BinderInfo) × Expr) (Name × Expr)) (name:Name) cinfo =&gt; do\n    if name.isInternalDetail then return s\n    -- let .thmInfo _ := cinfo | return s\n    unless ← Option.isSome &lt;$&gt; isClass? cinfo.type do return s -- only considder type class instances\n    if Linter.isDeprecated (← getEnv) name then return s\n    if LazyDiscrTree.blacklistInsertion (← getEnv) name then return s\n    let type ← instantiateTypeLevelParams cinfo.toConstantVal (cinfo.levelParams.map fun _ =&gt; 0)\n    forallTelescope type fun fvars e =&gt; do\n      let result ← sortHyps fvars e\n      if let some (name&#39;, type&#39;) := s[result]? then\n        logInfo m! &quot;{name} : {cinfo.type}\\n{name&#39;} : {type&#39;}&quot;\n        return s\n      else\n        return s.insert result (name, type)\n\nrun_meta runLinter\n</code></pre></div>\n</div></div>",
        "id": 518941841,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747590503
    },
    {
        "content": "<p>Here's the duplicate instances in lean core:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">instLTUInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n<span class=\"n\">instLTUInt32_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">instToFormatValue</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToFormat</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span><span class=\"bp\">.</span><span class=\"n\">instToFormat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToFormat</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">leTrans</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">leTrans</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">float32DecLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Float32</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtInt8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Int8</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeUInt64</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">leTotal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">leTotal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">leRefl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Refl</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">leRefl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Refl</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">ByteArray</span><span class=\"bp\">.</span><span class=\"n\">instHashable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Hashable</span><span class=\"w\"> </span><span class=\"n\">ByteArray</span>\n<span class=\"n\">instHashableByteArray</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Hashable</span><span class=\"w\"> </span><span class=\"n\">ByteArray</span>\n\n<span class=\"n\">Int16</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeInt16</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Int32</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtUInt64</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">UInt64</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">instBEqOrigin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">Origin</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">instBEqOrigin_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">Origin</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">ltAsymm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Asymm</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">ltAsymm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Asymm</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">instDecidableLeInt8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Int8</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instLEUInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n<span class=\"n\">instLEUInt32_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">UInt32</span>\n\n<span class=\"n\">ISize</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ISize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeISize</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ISize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">ltIrrefl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Irrefl</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">ltIrrefl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Irrefl</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">leAntisymm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Antisymm</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"n\">Char</span><span class=\"bp\">.</span><span class=\"n\">leAntisymm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Antisymm</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n\n<span class=\"n\">instDecidableLeUInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">UInt32</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">instToStringValue</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span><span class=\"bp\">.</span><span class=\"n\">instToString</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span>\n\n<span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">lex</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">rprod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtUInt16</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">UInt16</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAssociativeNatMax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Associative</span><span class=\"w\"> </span><span class=\"n\">max</span>\n<span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instAssociativeMax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Associative</span><span class=\"w\"> </span><span class=\"n\">max</span>\n\n<span class=\"n\">Int16</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLtInt16</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">ToLevel</span><span class=\"bp\">.</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToLevel</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToLevel</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ToLevel</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">ToLevel</span><span class=\"bp\">.</span><span class=\"n\">imax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToLevel</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToLevel</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ToLevel</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">BVDecide</span><span class=\"bp\">.</span><span class=\"n\">BVExpr</span><span class=\"bp\">.</span><span class=\"n\">decEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">BVDecide</span><span class=\"bp\">.</span><span class=\"n\">BVExpr</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">BVDecide</span><span class=\"bp\">.</span><span class=\"n\">BVExpr</span><span class=\"bp\">.</span><span class=\"n\">instDecidableEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">BVDecide</span><span class=\"bp\">.</span><span class=\"n\">BVExpr</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">instReprMVarId_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">MVarId</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">instReprMVarId</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">MVarId</span>\n\n<span class=\"n\">floatDecLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">UInt16</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeUInt16</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Ord</span><span class=\"bp\">.</span><span class=\"n\">arrayOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">instOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableEqVector</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">instDecidableEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtUInt8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">instReprPower</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">Power</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">Arith</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">instReprPower_lean</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">Power</span>\n\n<span class=\"n\">instInhabitedProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"n\">instInhabitedSort</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"n\">instWellFoundedRelationOfSizeOf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SizeOf</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">sizeOfWFRel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SizeOf</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"n\">Int64</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLtInt64</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeUInt8</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">Arith</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">instReprMon_lean</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">Mon</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">instReprMon</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Grind</span><span class=\"bp\">.</span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">Mon</span>\n\n<span class=\"n\">instDecidableLeInt64</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Int64</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">JsonNumber</span><span class=\"bp\">.</span><span class=\"n\">instLT</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">JsonNumber</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">JsonNumber</span><span class=\"bp\">.</span><span class=\"n\">ltProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">JsonNumber</span>\n\n<span class=\"n\">Int32</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLeInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableEqSum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"n\">Sum</span><span class=\"bp\">.</span><span class=\"n\">instDecidableEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"n\">USize</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">USize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLtUSize</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">USize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Widget</span><span class=\"bp\">.</span><span class=\"n\">instTypeNameMessageData</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TypeName</span><span class=\"w\"> </span><span class=\"n\">MessageData</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">instTypeNameMessageData</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TypeName</span><span class=\"w\"> </span><span class=\"n\">MessageData</span>\n\n<span class=\"n\">instInhabitedForInStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ForInStep</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"n\">instInhabitedForInStep_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ForInStep</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">instAssociativeNatMin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Associative</span><span class=\"w\"> </span><span class=\"n\">min</span>\n<span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instAssociativeMin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Associative</span><span class=\"w\"> </span><span class=\"n\">min</span>\n\n<span class=\"n\">float32DecLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">Float32</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">Exists</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">nonempty_of_exists</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">floatDecLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">UInt32</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">instDecidableLtUInt32</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLtISize</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ISize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">ISize</span><span class=\"bp\">.</span><span class=\"n\">decLt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ISize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"n\">instDecidableLeUSize</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">USize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"n\">USize</span><span class=\"bp\">.</span><span class=\"n\">decLe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">USize</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 518941916,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747590579
    },
    {
        "content": "<p>But it also flags some other suspicious lemmas, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Int8</span><span class=\"bp\">.</span><span class=\"n\">not_eq_neg_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int8</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">~~~</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">not_lt_iff_ge</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">l₁</span>\n</code></pre></div>",
        "id": 518942094,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747590702
    },
    {
        "content": "<p>Nice find! If you post a list of duplicate mathlib lemmas (that are not aliasses for discoverability --- is that easy to automate or do we just need to check by hand), I'm sure people with be happy to take a look!</p>",
        "id": 518947343,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747594707
    },
    {
        "content": "<p>And also not cases where we switched argument type from explicit to implicit, like after defining a structure.</p>",
        "id": 518948505,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1747595541
    },
    {
        "content": "<p>I noticed a lot of rfl/refl variations were flagged as the same theorem, so I made it be aware of argument implicitness.</p>\n<p>Which kind of changing implicitness do you mean?</p>",
        "id": 518950589,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747597030
    },
    {
        "content": "<p>I've sent a PR for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array.not_lt_iff_ge#doc\">docs#Array.not_lt_iff_ge</a> in <a href=\"https://github.com/leanprover/lean4/pull/8392\">lean4#8392</a></p>",
        "id": 518954379,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747599366
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.instAssociativeNatMin#doc\">docs#Int.instAssociativeNatMin</a> (and Max) looks like a typo too</p>",
        "id": 518975834,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747617427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span>, thanks for this list! I've cleaned up nearly all of it in <a href=\"https://github.com/leanprover/lean4/pull/8397\">lean#8397</a></p>",
        "id": 518976708,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1747618163
    },
    {
        "content": "<p>I'll note three false positives:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">instInhabitedProp</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">instInhabitedSort</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">lex</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">rprod</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">ToLevel</span><span class=\"bp\">.</span><span class=\"n\">max</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">ToLevel</span><span class=\"bp\">.</span><span class=\"n\">imax</span>\n</code></pre></div>",
        "id": 518976718,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1747618172
    },
    {
        "content": "<p>Finally, <span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span> it seems the following pairs are genuinely different implementations: could I ask you to look at these and decide if anything needs cleaning up?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">instToFormatValue</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span><span class=\"bp\">.</span><span class=\"n\">instToFormat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">instToStringValue</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">IR</span><span class=\"bp\">.</span><span class=\"n\">UnreachableBranches</span><span class=\"bp\">.</span><span class=\"n\">Value</span><span class=\"bp\">.</span><span class=\"n\">instToString</span>\n</code></pre></div>",
        "id": 518976721,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1747618173
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I'll take a look and remove one of the pairs.</p>",
        "id": 518977634,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1747618889
    },
    {
        "content": "<p>This pair probably can't be found by automation, since it isn't an exact match, but we should deduplicate it: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MonoidHom.ofLeftInverse#doc\">docs#MonoidHom.ofLeftInverse</a> (I guess, it was accidentally moved to the <code>MonoidHom</code> namespace during some code move) and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MulEquiv.ofLeftInverse#doc\">docs#MulEquiv.ofLeftInverse</a></p>",
        "id": 518988187,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1747626775
    },
    {
        "content": "<p>For <code>instInhabitedProp</code> and <code>instInhabitedSort</code>, I'd say <code>instInhabitedProp</code> is redundant. Or do we want the default value in <code>Prop</code> to be <code>True</code> (and give that instance a higher priority)?</p>",
        "id": 519041011,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747644990
    },
    {
        "content": "<p>Here is a list of duplicate theorems that were found in lean core. I filtered out the type class instances, and theorems that are proved directly from another theorem.<br>\n<a href=\"/user_uploads/3121/6UIgmqh52xg0W6lAc61nFUnk/duplicate-theorems-Lean-core.txt\">duplicate theorems Lean core.txt</a></p>\n<p>A very suspicious lemma is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">UInt16</span><span class=\"bp\">.</span><span class=\"n\">toFin_mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFin</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">toFin</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toFin</span>\n</code></pre></div>",
        "id": 519049743,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747646965
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat_ne_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>also seems wrong, as it is about <code>Nat.cast</code> instead of <code>ofNat</code>, so it's the same as <code>Int.natCast_ne_zero</code></p>",
        "id": 519070672,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747652134
    },
    {
        "content": "<p>I think the answer there is delete the lemma, <code>Int.ofNat</code> isn't supposed to be mentioned in any lemmas besides the one that translates it to <code>Nat.cast</code> IMO</p>",
        "id": 519071142,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747652251
    },
    {
        "content": "<p>I think a lot of lemmas got left with the old wrong name when the coercion was changed</p>",
        "id": 519071218,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747652272
    },
    {
        "content": "<p>Here's a list of lemmas that appear duplicate in Mathlib:<br>\n<a href=\"/user_uploads/3121/RKsQRFDqEQkHoVI6Fkbg2Bcu/duplicate_theorems_mathlib.txt\">duplicate_theorems_mathlib.txt</a></p>\n<p>For example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Nimber</span><span class=\"bp\">.</span><span class=\"n\">bot_eq_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>is about <code>Nat</code> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 519075233,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747653263
    },
    {
        "content": "<p>Maybe we should have a linter that complains about <code>theorem Foo.bar : T</code> if <code>T</code> makes no mention of <code>Foo</code></p>",
        "id": 519075746,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747653388
    },
    {
        "content": "<p>And I presume it would ignore the case where the namespace isn't a type.</p>",
        "id": 519075994,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747653463
    },
    {
        "content": "<p>Or actually, if the namespace isn't a constant. I kind of assumed it would always be a type.</p>",
        "id": 519076477,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747653581
    },
    {
        "content": "<p>Here's a <a href=\"https://gist.github.com/kbuzzard/64f9d98d7379dc3c280b4ca4caa66966\">gist</a> with Jovan's list of hundreds of duplicated mathlib lemmas (it's less annoying to read that way on e.g. mobile)</p>",
        "id": 519082510,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747655057
    },
    {
        "content": "<p><code>Quotient.ind₂'</code> and <code>Quotient.inductionOn₂'</code> have argument inputs in different order and I suspect that the duplication here is intentional?</p>",
        "id": 519083125,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747655184
    },
    {
        "content": "<p>(off-topic: a regex expert might want to try and figure out why <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quotient#doc\">docs#Quotient</a>.ind₂' and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quotient#doc\">docs#Quotient</a>.inductionOn₂' still don't work)</p>",
        "id": 519083485,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747655270
    },
    {
        "content": "<p>Where are the linkifiers?</p>",
        "id": 519085641,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747655757
    },
    {
        "content": "<p>Settings (cog in top right) -&gt; Organization Settings -&gt; Linkifiers</p>",
        "id": 519085934,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747655822
    },
    {
        "content": "<p>For example <code>LinearOrder.max_def</code> and <code>max_def</code> are flagged as duplicate, because one is proved from the other by a <code>rw</code> tactic (instead of a literal application like in an <code>exact</code> tactic), so it doesn't get filtered out.</p>",
        "id": 519086140,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747655868
    },
    {
        "content": "<p>This thread should be called \"naming convention quiz\"!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val_prop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span>\n<span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">coe_prop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span>\n\n<span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">IsUnit</span><span class=\"bp\">.</span><span class=\"n\">natAbs_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">IsUnit</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">natAbs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">natAbs_of_isUnit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">IsUnit</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">natAbs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">sub_add_cancel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">add_sub_cancel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span>\n\n<span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">ext'_iff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"n\">mul_le_mul_of_nonneg_of_nonpos'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">ExistsAddOfLE</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PosMulMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulPosMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddRightMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddRightReflectLE</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">],</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">d</span>\n<span class=\"n\">mul_le_mul_of_nonpos_of_nonneg'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">ExistsAddOfLE</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PosMulMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulPosMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddRightMono</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddRightReflectLE</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">],</span>\n<span class=\"w\">  </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">d</span>\n</code></pre></div>\n<p>etc</p>",
        "id": 519086585,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747655976
    },
    {
        "content": "<ul>\n<li>I have no preference, and don't know if mathlib does</li>\n<li>i suspect that <code>Int.IsUnit.natAbs_eq</code> is better (<del>due to allowing dot notation</del> for that it should be <code>_root_.IsUnit.</code>, as yaël points out), modulo ending on <code>eq</code>. (i have no issues with this, but i recall reading some people do?)</li>\n<li>clearly <code>Multiset.add_sub_cancel</code> is wrong</li>\n<li><code>Multiset.ext</code> should be just the right to left implication.</li>\n<li><code>mul_le_mul_of_nonpos_of_nonneg'</code> is wrong, the \"of\" bits are supposed to be in the same order in the name as they are in the arguments.</li>\n</ul>",
        "id": 519090506,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1747656822
    },
    {
        "content": "<p>The first one is about membership in a set, so shouldn't it be called <code>Subtype.val_mem</code>? Or rather, it should be generalized to a general predicate <code>p : α → Prop</code>.</p>",
        "id": 519092111,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747657176
    },
    {
        "content": "<p>I think it is fine if lemmas are duplicated for discoverability reasons. As long as the proofs are not duplicated (one is an alias of the other) and they are Prop-valued.</p>",
        "id": 519092283,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1747657214
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/519090506\">said</a>:</p>\n<blockquote>\n<ul>\n<li>i suspect that <code>Int.IsUnit.natAbs_eq</code> is better (due to allowing dot notation), modulo ending on <code>eq</code>. (i have no issues with this, but i recall reading some people do?)</li>\n</ul>\n</blockquote>\n<p>I actually think the exact opposite. In fact, it looks like it got misported: mathport didn't record <code>_root_</code></p>",
        "id": 519092901,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1747657361
    },
    {
        "content": "<p>Indeed, but this list has filtered out all theorems that are proven by applying another theorem</p>",
        "id": 519092952,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1747657374
    },
    {
        "content": "<p>I got back to this and made a PR that makes a start at removing all duplicate instances in Mathlib: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25410\">#25410</a></p>",
        "id": 522228227,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1748990551
    },
    {
        "content": "<p>There's also the file <code>Mathlib.Algebra.Small.Ring</code>, which consists only of instances that already exist.</p>",
        "id": 522229478,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1748991121
    },
    {
        "content": "<p>Nice. Note that you have some lint errors</p>",
        "id": 522237672,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748995828
    },
    {
        "content": "<p>I've ran into quite a lot of duplicate declarations in mathlib recently, is it possible to run this somewhat more regularly so they can be spotted and resolved? Or even running it on PRs to detect duplicates?<br>\nThe one I just found is: <br>\n<a href=\"/user_uploads/3121/ATRPL0Ezz7xjfMOGwA3HysWx/image.png\">image.png</a><br>\nbut I think I've seen 3 or 4 duplicates in mathlib in the last week or so</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ATRPL0Ezz7xjfMOGwA3HysWx/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"630x122\" src=\"/user_uploads/thumbnail/3121/ATRPL0Ezz7xjfMOGwA3HysWx/image.png/840x560.webp\"></a></div>",
        "id": 535416424,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1755742323
    },
    {
        "content": "<p>Another example: <br>\n<a href=\"/user_uploads/3121/ZmdThnaMpX6gwHk2AefQELli/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ZmdThnaMpX6gwHk2AefQELli/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"460x117\" src=\"/user_uploads/thumbnail/3121/ZmdThnaMpX6gwHk2AefQELli/image.png/840x560.webp\"></a></div>",
        "id": 535416734,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1755742611
    },
    {
        "content": "<p>Seems hard for definitions</p>",
        "id": 535438071,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755758022
    },
    {
        "content": "<p>we would need to make expressions hashable to run  this in linear time</p>",
        "id": 535444263,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755760930
    },
    {
        "content": "<p>The program I wrote should do a reasonable job at this. Feel free to pick up this project where I left it :). The problem is that there are 100s of duplicates, and it's a lot of work going through all of them.</p>",
        "id": 535448686,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755762754
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.Embedding.oneEmbeddingEquiv#doc\">docs#Function.Embedding.oneEmbeddingEquiv</a> seems like a bad name (Edit: added in <a href=\"https://github.com/leanprover-community/mathlib4/pull/23386\">#23386</a>)</p>",
        "id": 535458445,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755766585
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/535416734\">said</a>:</p>\n<blockquote>\n<p>Another example: <br>\n<a href=\"/user_uploads/3121/ZmdThnaMpX6gwHk2AefQELli/image.png\">image.png</a></p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/28732\">#28732</a></p>",
        "id": 535487696,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755777187
    },
    {
        "content": "<p>Found another pair (which is my fault!) <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.deriv_eq_id_of_nfp_eq_id#doc\">docs#Ordinal.deriv_eq_id_of_nfp_eq_id</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.deriv_id_of_nfp_id#doc\">docs#Ordinal.deriv_id_of_nfp_id</a></p>",
        "id": 535860686,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755979019
    },
    {
        "content": "<p>I'll fix that as part of <a href=\"https://github.com/leanprover-community/mathlib4/pull/28743\">#28743</a></p>",
        "id": 535860712,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1755979051
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/535416424\">said</a>:</p>\n<blockquote>\n<p>I've ran into quite a lot of duplicate declarations in mathlib recently, is it possible to run this somewhat more regularly so they can be spotted and resolved? Or even running it on PRs to detect duplicates?</p>\n</blockquote>\n<p>Once we get rid of existing ones, we could just have automation loogle all new declarations as part of the PR process, right? (Presumably “directly”, using loogle’s backend, of course; modulo details to ensure matches have exactly the same set of arguments, allow for defs, etc.)</p>",
        "id": 535861128,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755979631
    },
    {
        "content": "<p>Here's an up to date list:<br>\n252 duplicate instances: <a href=\"https://gist.github.com/JovanGerb/66286dd2ec00a70acc8e302f5cb225fd\">https://gist.github.com/JovanGerb/66286dd2ec00a70acc8e302f5cb225fd</a><br>\n1441 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/f015b098102210136f25b94376924e05\">https://gist.github.com/JovanGerb/f015b098102210136f25b94376924e05</a></p>",
        "id": 546932191,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761321822
    },
    {
        "content": "<p>Just browsing randomly, I see</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">UInt16</span><span class=\"bp\">.</span><span class=\"n\">toFin_mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFin</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">toFin</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toFin</span>\n</code></pre></div>\n<p>How many bugs to uncover in there?</p>",
        "id": 546932611,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1761321935
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/546932191\">said</a>:</p>\n<blockquote>\n<p>Here's an up to date list:<br>\n252 duplicate instances: <a href=\"https://gist.github.com/JovanGerb/66286dd2ec00a70acc8e302f5cb225fd\">https://gist.github.com/JovanGerb/66286dd2ec00a70acc8e302f5cb225fd</a><br>\n1441 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/f015b098102210136f25b94376924e05\">https://gist.github.com/JovanGerb/f015b098102210136f25b94376924e05</a></p>\n</blockquote>\n<p>I think some of the ones in this list aren't correctly printing their universe variables,  eg the second of the pair in the first and third are printed as being in <code>Type</code> rather than being universe polymorphic</p>",
        "id": 546944134,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1761325605
    },
    {
        "content": "<p>One down: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30862\">#30862</a></p>",
        "id": 546958661,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761331190
    },
    {
        "content": "<p>Do these count?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">lift_uzero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">lift_id'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>",
        "id": 546959471,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761331527
    },
    {
        "content": "<p>No, <code>Ordinal.lift_id'</code> has more general universe variables and so it can't be simp, but <code>Ordinal.lift_uzero</code> is simp</p>",
        "id": 546959719,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1761331636
    },
    {
        "content": "<p>Another fun one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"bp\">.</span><span class=\"n\">offDiag_nonempty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">offDiag</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span>\n<span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Subsingleton</span><span class=\"bp\">.</span><span class=\"n\">offDiag_eq_empty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">offDiag</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span>\n</code></pre></div>",
        "id": 546959959,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761331779
    },
    {
        "content": "<p>Is it possible to filter out those which are aliases already? eg <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=le_antisymm#doc\">docs#le_antisymm</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LE.le.antisymm#doc\">docs#LE.le.antisymm</a> is an \"expected\" duplicate, since the latter is easy for dot notation whereas the former is easy when dot notation isn't available</p>",
        "id": 546960215,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1761331920
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30863\">#30863</a></p>",
        "id": 546960443,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761332016
    },
    {
        "content": "<p>Also, it would be nice to see or filter out the ones that are in core, as well as the ones in tactic-specific namespaces (like for <code>grind</code> or <code>linear_combination</code>)</p>",
        "id": 546960541,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761332058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/546959959\">said</a>:</p>\n<blockquote>\n<p>Another fun one:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"bp\">.</span><span class=\"n\">offDiag_nonempty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">offDiag</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span>\n<span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Subsingleton</span><span class=\"bp\">.</span><span class=\"n\">offDiag_eq_empty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">Nontrivial</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">offDiag</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>As the emoji reaction indicates, this one does date back to Yaël (three years ago, in <a href=\"https://github.com/leanprover-community/mathlib3/pull/16803\">mathlib3#16803</a>)</p>",
        "id": 546961024,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761332249
    },
    {
        "content": "<p>In</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">IsDenseInducing</span><span class=\"bp\">.</span><span class=\"n\">toIsInducing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">IsDenseInducing</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">IsInducing</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"n\">IsDenseInducing</span><span class=\"bp\">.</span><span class=\"n\">isInducing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">IsDenseInducing</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">IsInducing</span><span class=\"w\"> </span><span class=\"n\">i</span>\n</code></pre></div>\n<p>the first one is an auto-generated projection to the parent class</p>",
        "id": 546961275,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761332357
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30864\">#30864</a></p>",
        "id": 546962022,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761332652
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30865\">#30865</a></p>\n<p>(Might not be the most efficient approach, but more at once is too daunting for me :))</p>",
        "id": 546963153,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761333108
    },
    {
        "content": "<p>There's also </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→ₐ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"n\">IsScalarTower</span><span class=\"bp\">.</span><span class=\"n\">toAlgHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsScalarTower</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→ₐ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span>\n</code></pre></div>",
        "id": 546993574,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1761336924
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30868\">#30868</a></p>",
        "id": 547001292,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761340896
    },
    {
        "content": "<p>Here's an updated list of duplicate theorems: It filters out aliases and metaprogramming theorems.</p>\n<p>620 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/eda537d9748895a28bc0f8527618d293\">https://gist.github.com/JovanGerb/eda537d9748895a28bc0f8527618d293</a></p>",
        "id": 547059302,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761400381
    },
    {
        "content": "<p>how do you filter out metaprogramming theorems</p>",
        "id": 547059527,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400627
    },
    {
        "content": "<p>immediately I see</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">forall_congr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"n\">pi_congr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">β'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">β'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>so there's also something about universes</p>",
        "id": 547059556,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400653
    },
    {
        "content": "<p>I instantiate all the universes with 0 before comparing theorems</p>",
        "id": 547059629,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761400730
    },
    {
        "content": "<p>so something stated for <code>Sort u</code> and something stated for <code>Type u</code> won't be unified?</p>",
        "id": 547059658,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400758
    },
    {
        "content": "<p>Unfortunately not :(</p>",
        "id": 547059684,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761400797
    },
    {
        "content": "<p>Here is my current code</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\"><pre><span></span><code>import Mathlib\n\nopen Lean Meta\n\ndef sortHyps (fvars : Array Expr) (e : Expr) : MetaM (Array (Expr × BinderInfo) × Expr) := do\n  let n := fvars.size\n  let fvars : Vector Expr n := fvars.toVector\n  let mut types ← fvars.mapM (some &lt;$&gt; inferType ·)\n  let mut e := e\n  let mut result := #[]\n  for h : j in [:n] do\n    let mut ominIdx : Option (Fin n) := none\n    let mut minType : Expr := default\n    for h : i in [:n] do\n      if let some type := types[i] then\n        if !type.hasFVar then\n          if ominIdx.isNone || type.quickLt minType then\n            ominIdx := some ⟨i, by get_elem_tactic⟩\n            minType := type\n    let some minIdx := ominIdx | throwError &quot;{types.toArray}&quot;\n    let fvar := fvars[minIdx]\n    result := result.push (minType, ← fvar.fvarId!.getBinderInfo)\n    types := types.set minIdx none\n    let abst (e : Expr) := e.liftLooseBVars 0 1 |&gt;.abstract #[fvar]\n    types := types.map (Option.map abst)\n    e := abst e\n  return (result, e)\n\ndef runLinter : MetaM (Array (Name × Name)) := do\n  let env ← getEnv\n  let mut s : Std.HashMap (Array (Expr × BinderInfo) × Expr) (Name × Expr) := {}\n  let mut dups := #[]\n  for (name, cinfo) in env.constants.map₁ do\n    if name.isInternalDetail || name.isMetaprogramming || !allowCompletion env name || Linter.isDeprecated env name then continue -- filter out bad constants\n    if let some v := cinfo.value? then if let .const .. := v.eta then continue -- filter out aliases\n    let .thmInfo _ := cinfo | continue -- only consider theorems\n    -- unless ← Option.isSome &lt;$&gt; isClass? cinfo.type do continue -- only considder type class instances\n    let type ← instantiateTypeLevelParams cinfo.toConstantVal (cinfo.levelParams.map fun _ =&gt; 0)\n    (s, dups) ← forallTelescope type fun fvars e =&gt; do\n      let result ← sortHyps fvars e\n      if let some (name&#39;, _) := s[result]? then\n        return (s, dups.push (name, name&#39;))\n      else\n        return (s.insert result (name, type), dups)\n  return dups\n\ndef printResults : MetaM MessageData := do\n  let dups ← runLinter\n  let mut m := m!&quot;Number of duplicates: {dups.size}&quot;\n  for (a, b) in dups do\n    m := m!&quot;{m}\\n\\n{a} : {(← getConstInfo a).type}\\n{b} : {(← getConstInfo b).type}&quot;\n  return m\n\nset_option maxHeartbeats 10000000000000\nrun_meta do\n  logInfo m!&quot;{← printResults}&quot;\n</code></pre></div>\n</div></div>",
        "id": 547059690,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761400801
    },
    {
        "content": "<p>what if you instantiate them with mvars</p>",
        "id": 547059809,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400890
    },
    {
        "content": "<p>or how does universes work</p>",
        "id": 547059817,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400898
    },
    {
        "content": "<p>universes seems a lot harder to work with than local hyps is from my experience</p>",
        "id": 547059859,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761400931
    },
    {
        "content": "<p>The current approach for comparison is by looking up in a <code>HashMap</code>. I don't think it is feasible to do pairwise unifications/comparisons of all mathlib theorems.</p>",
        "id": 547059906,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761400979
    },
    {
        "content": "<p>But it should be possible to go into the expressions and manually replace every single <code>Sort _</code> with <code>Sort 0</code>.</p>",
        "id": 547059956,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761401024
    },
    {
        "content": "<p>oh there aren't that many mathlib theorems surely</p>",
        "id": 547060294,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761401354
    },
    {
        "content": "<p>oh wait pairwise nvm</p>",
        "id": 547060313,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761401389
    },
    {
        "content": "<p>Ok, I've now added code for erasing universes from the theorems. It is quite a bit slower, but it found 8 extra duplicates. I've updated the above gist to have 628 duplicate theorems.</p>",
        "id": 547061794,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761402860
    },
    {
        "content": "<p>If it's something we want, it wouldn't be hard to add a workflow which runs this and posts a weekly report on Zulip; it might even be possible to adapt some of the deprecation auto-removal infrastructure to generate PRs automatically from this too? cc:  <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span></p>",
        "id": 547061986,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761403051
    },
    {
        "content": "<p>I'm using the infoview to run the code, but it has this stupid property that if I run <code>logInfo \"hello world\"</code>, and <code>ctrl+a</code> <code>ctrl+c</code> in the infoview, it copies the content three times over?? Hence why the gists are 3x as long as they should be <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 547062053,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403116
    },
    {
        "content": "<p>You can write it to a file</p>",
        "id": 547062206,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403264
    },
    {
        "content": "<p>Ah sorry, I meant to say that I use Lean web.</p>",
        "id": 547062236,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403298
    },
    {
        "content": "<p>This is how I was able to handle 6000 lines of output without crashing the infoview</p>",
        "id": 547062245,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403305
    },
    {
        "content": "<p>oh</p>",
        "id": 547062266,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403327
    },
    {
        "content": "<p>The bug doesn't appear locally</p>",
        "id": 547062271,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403332
    },
    {
        "content": "<p>yeah that makes more sense</p>",
        "id": 547062280,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403345
    },
    {
        "content": "<p>I guess it's just because the message appears in \"Messages\" and \"All messages\" as well?</p>",
        "id": 547062317,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761403384
    },
    {
        "content": "<p>Even when my cursor is somewhere else (so that the messages can only come from \"All messages\") I get the 3x duplicate copying</p>",
        "id": 547062413,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403451
    },
    {
        "content": "<p>I get this on my clip-board:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">MathlibDemo</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">0</span>\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"bp\">.</span>\n<span class=\"n\">MathlibDemo</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"mi\">0</span>\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"bp\">.</span>\n<span class=\"n\">All</span><span class=\"w\"> </span><span class=\"n\">Messages</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"n\">MathlibDemo</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">0</span>\n\n<span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"n\">world</span>\n\n<span class=\"n\">MathlibDemo</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">0</span>\n\n<span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"n\">world</span>\n\n<span class=\"n\">All</span><span class=\"w\"> </span><span class=\"n\">Messages</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"n\">MathlibDemo</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">0</span>\n\n<span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"n\">world</span>\n</code></pre></div>",
        "id": 547062474,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403510
    },
    {
        "content": "<p>It could be nice to have a weekly report on the duplicate declarations. What do you think the report should include? The amount of duplicates is maybe still a bit too large to show in a Zulip message.</p>\n<p>But I don't think a bot should make PRs to remove duplicates automatically.</p>",
        "id": 547062498,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403534
    },
    {
        "content": "<p>Ah, right. A bot is probably infeasible since we'd have to decide which to keep.</p>",
        "id": 547062530,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761403571
    },
    {
        "content": "<p>Unless we get a bot that fully knows the naming conventions :)</p>",
        "id": 547062587,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403633
    },
    {
        "content": "<p>It should be possible for bots to post gists, so we could post a summary (number of duplicates? what else?) and then link to the full report.</p>",
        "id": 547062641,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761403685
    },
    {
        "content": "<p>Btw the universe-erasing version found this one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">}},</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a2</span>\n<span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">}},</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a2</span>\n</code></pre></div>",
        "id": 547062738,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761403781
    },
    {
        "content": "<p>one of these is not maximally universe general</p>",
        "id": 547062807,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403857
    },
    {
        "content": "<p>but I wonder if in specific cases it could sometimes be useful to not be maximally universe general</p>",
        "id": 547062903,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403967
    },
    {
        "content": "<p>like to help unification</p>",
        "id": 547062911,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761403975
    },
    {
        "content": "<p>I would hope not <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 547062967,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761404034
    },
    {
        "content": "<p>well, theoretically most of the things stated for <code>Sort (u + 1)</code> (like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List#doc\">docs#List</a>) could also be stated for <code>Sort (max 1 u)</code></p>",
        "id": 547063216,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761404279
    },
    {
        "content": "<p>this is technically more universe general</p>",
        "id": 547063242,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761404302
    },
    {
        "content": "<p>Oh I forgot that <code>Subtype.{u}</code> has type <code>Sort (max 1 u)</code></p>",
        "id": 547063572,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761404659
    },
    {
        "content": "<p>That is so silly</p>",
        "id": 547063597,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761404688
    },
    {
        "content": "<p>oh that's so silly</p>",
        "id": 547063623,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761404712
    },
    {
        "content": "<p>the other option is also kind of silly though</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">genInjectivity</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">genSizeOf</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">bootstrap</span><span class=\"bp\">.</span><span class=\"n\">inductiveCheckResultingUniverse</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MySubtype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MySubtype</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>\n<p>you can still get the value out and you can still prove injectivity</p>",
        "id": 547063873,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761404947
    },
    {
        "content": "<p>Nice!</p>",
        "id": 547063967,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761405013
    },
    {
        "content": "<p>but it's really a pain to set it all up manually</p>",
        "id": 547063993,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405032
    },
    {
        "content": "<p>Sure, but this only needs to be done once in core</p>",
        "id": 547064011,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761405051
    },
    {
        "content": "<p>there's like 12 things here</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">WhatsNew</span>\n\n<span class=\"n\">whatsnew</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MySubtype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">val</span>\n</code></pre></div>\n<p>and we also need to overwrite the default recursors so that we can eliminate into <code>Sort</code> instead of <code>Prop</code></p>",
        "id": 547064136,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405167
    },
    {
        "content": "<p>and all the environment extensions</p>",
        "id": 547064160,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405189
    },
    {
        "content": "<p>oh and the same trick works for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PProd#doc\">docs#PProd</a></p>",
        "id": 547064237,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405262
    },
    {
        "content": "<p>and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PSigma#doc\">docs#PSigma</a></p>",
        "id": 547064246,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405278
    },
    {
        "content": "<p>Here's the list of 353 duplicate theorems in just Mathlib</p>\n<p><a href=\"https://gist.github.com/JovanGerb/9167b17b8a2a588cc83e0e397d37b562\">https://gist.github.com/JovanGerb/9167b17b8a2a588cc83e0e397d37b562</a></p>",
        "id": 547066087,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761407111
    },
    {
        "content": "<p>Let me join in on the fun: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30883\">#30883</a></p>",
        "id": 547066721,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761407848
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30884\">#30884</a></p>",
        "id": 547067199,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761408417
    },
    {
        "content": "<p>It seems Mathlib can't decide whether to spell it as <code>LeOne</code> or <code>LEOne</code>:</p>\n<p><code>RankLeOneStruct</code>, <code>NormLeOne</code>, <code>LeOnePart</code> VS <code>ZeroLEOneClass</code>, <code>Ring.DimensionLEOne</code></p>",
        "id": 547068550,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761409928
    },
    {
        "content": "<p>New style guide addition, after coming to consensus?</p>",
        "id": 547068614,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1761410011
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.Walk.mapLe#doc\">docs#SimpleGraph.Walk.mapLe</a> vs <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OrderEmbedding.ofMapLEIff#doc\">docs#OrderEmbedding.ofMapLEIff</a></p>",
        "id": 547070469,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761412329
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547062498\">said</a>:</p>\n<blockquote>\n<p>It could be nice to have a weekly report on the duplicate declarations. What do you think the report should include? The amount of duplicates is maybe still a bit too large to show in a Zulip message.</p>\n</blockquote>\n<p>We could also help prevent new duplicates by checking declarations added in a PR. Seems related to making the declarations diff a metaprogram that respects namespaces. (Which I am still planning to work on soon...)</p>",
        "id": 547083346,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761427320
    },
    {
        "content": "<p>One nice thing about the declarations diff in its current form is that it works even when CI hasn't passed yet. But I agree it would be better if it ran in Lean, and had direct access to the environments before and after. Then we could also check if there are any new duplicate declarations.</p>",
        "id": 547085234,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761429779
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> (or anyone else up to speed on running this code), could I please have a list of duplicates where one or more of the theorems is defined in <code>lean4</code> itself?</p>",
        "id": 547087882,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761433964
    },
    {
        "content": "<p>Here's 158 duplicate theorems where both duplicates are in <code>lean4</code></p>\n<p><a href=\"https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231\">https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231</a></p>",
        "id": 547088072,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761434244
    },
    {
        "content": "<p>And here are 27 duplicate non-theorem instances</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">duplicates</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">27</span>\n\n<span class=\"n\">instInhabitedProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"n\">instInhabitedSort</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">instMaxSubtypeOfMaxEqOr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">MaxEqOr</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subtype</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">instMax</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">MaxEqOr</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subtype</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">instAppend</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Append</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"n\">instAppendString</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Append</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">instInhabited_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">instInhabited</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">rprod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">lex</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">WellFoundedRelation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Impl</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Impl</span><span class=\"bp\">.</span><span class=\"n\">Const</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Impl</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_std</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Impl</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">ExtDTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">ExtDTreeMap</span><span class=\"bp\">.</span><span class=\"n\">instCoeTypeForall_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">EAsync</span><span class=\"bp\">.</span><span class=\"n\">instMonadLiftEIO</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MonadLift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EIO</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">EAsync</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">EAsync</span><span class=\"bp\">.</span><span class=\"n\">instMonadLiftEIO_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MonadLift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EIO</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">EAsync</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">instMonadAwaitStateTOfMonad_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">MonadAwait</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">MonadAwait</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StateT</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">instMonadAwaitStateTOfMonad</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">MonadAwait</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Async</span><span class=\"bp\">.</span><span class=\"n\">MonadAwait</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StateT</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instInhabitedPlainDate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span><span class=\"bp\">.</span><span class=\"n\">instInhabited</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprPlainDate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span><span class=\"bp\">.</span><span class=\"n\">instRepr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprPlainDateTime</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDateTime</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDateTime</span><span class=\"bp\">.</span><span class=\"n\">instRepr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDateTime</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprTimestamp_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Timestamp</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprTimestamp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Timestamp</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprDuration</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Duration</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprDuration_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Duration</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainTime</span><span class=\"bp\">.</span><span class=\"n\">instRepr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainTime</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">instReprPlainTime</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainTime</span>\n\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">UnitVal</span><span class=\"bp\">.</span><span class=\"n\">instLE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">UnitVal</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">instLEUnitVal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">UnitVal</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 547088245,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761434485
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547088072\">said</a>:</p>\n<blockquote>\n<p>Here's 158 duplicate theorems where both duplicates are in <code>lean4</code></p>\n<p><a href=\"https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231\">https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231</a></p>\n</blockquote>\n<p>Outside of the <code>Int</code> and <code>Nat</code> namespaces, I've now mostly taken care of these. (And delegated a few parts to others.) We should re-run this in a while and do a second round.</p>",
        "id": 547108705,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761461753
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30922\">#30922</a></p>",
        "id": 547121755,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761476649
    },
    {
        "content": "<p>And <a href=\"https://github.com/leanprover-community/mathlib4/pull/30923\">#30923</a></p>",
        "id": 547122338,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761477201
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30924\">#30924</a> golfs a proof in order to convince the linter that <code>max_def</code> and <code>LinearOrder.max_def</code> are aliases.</p>",
        "id": 547123195,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761478120
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547088072\">said</a>:</p>\n<blockquote>\n<p>Here's 158 duplicate theorems where both duplicates are in <code>lean4</code></p>\n<p><a href=\"https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231\">https://gist.github.com/JovanGerb/99daa102ec8648707e15156fb05ec231</a></p>\n</blockquote>\n<p>There's a duplicate that differs by an <code>Eq.symm</code>: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.le.dest#doc\">docs#Nat.le.dest</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.exists_eq_add_of_le#doc\">docs#Nat.exists_eq_add_of_le</a></p>",
        "id": 547174175,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761528663
    },
    {
        "content": "<p>Mathlib duplicate of a lean4 theorem with different variable order/optionality: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getD_eq_getD_getElem%3F#doc\">docs#List.getD_eq_getD_getElem?</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getD_eq_getElem%3F_getD#doc\">docs#List.getD_eq_getElem?_getD</a><br>\nI haven't found this duplicate in any list linked above, but I might've missed it somewhere</p>",
        "id": 547174411,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761528871
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547174411\">said</a>:</p>\n<blockquote>\n<p>Mathlib duplicate of a lean4 theorem with different variable order/optionality: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getD_eq_getD_getElem%3F#doc\">docs#List.getD_eq_getD_getElem?</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getD_eq_getElem%3F_getD#doc\">docs#List.getD_eq_getElem?_getD</a><br>\nI haven't found this duplicate in any list linked above, but I might've missed it somewhere</p>\n</blockquote>\n<p>Oh right, my algorithm only flags things as duplicate if the binder info is the same. In these two, one has an explicit and one an implicit argument. I don't think there is any good reason for comparing the binder infos <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>. So I guess there will be more that I missed.</p>",
        "id": 547177395,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761531700
    },
    {
        "content": "<p>There's a number where both exist intentionally, like le_refl and le_rfl. But maybe your explicit alias detection would catch those</p>",
        "id": 547204976,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761549828
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> I think it would be great to have a weekly report for this. Instead of posting the list in a zulip message, I think it's best if the report could link to a gist.<br>\nWe could include the length of the list in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Technical.20Debt.20Counters/with/547274027\">#mathlib4 &gt; Technical Debt Counters</a> .</p>",
        "id": 547281351,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1761572967
    },
    {
        "content": "<p>I'm happy to help with this -- if Jovan or anyone else can get the script in a form where it can be run from the command line and outputs the list of duplicates to stdout or a file; I can do the rest of the actions wrangling.</p>",
        "id": 547282536,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761573285
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30986\">#30986</a></p>",
        "id": 547390166,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761609595
    },
    {
        "content": "<p>By the way, while this algorithm will catch the vast majority of duplicates (which is awesome!), note that there is a small class of declarations which might be missed by this algorithm! Namely, theorems which have arguments of the <em>same</em> type in a different order.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>example</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sortHyps</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">BinderInfo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">toVector</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">ominIdx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">minType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">default</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">hasFVar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ominIdx</span><span class=\"bp\">.</span><span class=\"n\">isNone</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">quickLt</span><span class=\"w\"> </span><span class=\"n\">minType</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"n\">ominIdx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">get_elem_tactic</span><span class=\"bp\">⟩</span>\n<span class=\"w\">            </span><span class=\"n\">minType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">minIdx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ominIdx</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"{types.toArray}\"</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"o\">[</span><span class=\"n\">minIdx</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minType</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">fvar</span><span class=\"bp\">.</span><span class=\"n\">fvarId!</span><span class=\"bp\">.</span><span class=\"n\">getBinderInfo</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">minIdx</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">abst</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">liftLooseBVars</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">fvar</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">abst</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">abst</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">result</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"c1\">-- #1 &lt; #0 with [ℕ, ℕ]</span>\n<span class=\"c1\">-- #0 &lt; #1 with [ℕ, ℕ]</span>\n<span class=\"n\">run_meta</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type₀</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type₁</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">forallTelescope</span><span class=\"w\"> </span><span class=\"n\">type₀</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sorted</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abst</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">sortHyps</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{abst} with {sorted.map (·.1)}\"</span>\n<span class=\"w\">  </span><span class=\"n\">forallTelescope</span><span class=\"w\"> </span><span class=\"n\">type₁</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sorted</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abst</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">sortHyps</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{abst} with {sorted.map (·.1)}\"</span>\n</code></pre></div>\n</div></div>\n<p>Canonicalizing the local context is actually quite a nontrivial problem! <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> It's related to certain graph isomorphism problems, but obviously a lot less general.</p>\n<p>However, canonicalizing the local context is not our only option here: we can also try to <em>match</em> types to other types, as Loogle does.</p>\n<p>The Loogle backend is insensitive to the order of arguments when matching, and so e.g. searching for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>will still successfully match</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_comm</span><span class=\"w\"> </span><span class=\"bp\">📋</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>If we want to be thorough but still efficient, we can possibly get the best of both worlds with a hybrid strategy; perhaps something like:</p>\n<ul>\n<li>collapse free variables of equal type into a single free variable, and remember that we did this</li>\n<li>match them against the recorded expressions; if we have a match, put them in a \"maybe duplicate\" set with the match(es) (we're being overzealous in such a duplicate designation)</li>\n<li>After creating all duplicate sets, use the loogle backend to match entries in the sets of maybe-duplicates against (only) other entries in the set, to see which are truly duplicates</li>\n</ul>",
        "id": 547403846,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761621517
    },
    {
        "content": "<p>Thanks for pointing that out! I think an easier fix could be to make the assumption that in such cases, the variables will appear in the goal. And then we can check in which order they appear in the goal, sorting them based on that. This solution will also not be complete, but I can't think of any real-world cases where it would fail.</p>",
        "id": 547431835,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761639530
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, Here are the duplicate declarations that my algorithm had missed due to requiring that the binder info is the same in both declarations:</p>\n<p>42 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/030f4f4f50c83239b150ccb2eb6221d2\">https://gist.github.com/JovanGerb/030f4f4f50c83239b150ccb2eb6221d2</a></p>\n<p>3 duplicate instances:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">beqOfOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">BEq</span><span class=\"bp\">.</span><span class=\"n\">ofOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"n\">leOfOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"n\">ltOfOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">LT</span><span class=\"bp\">.</span><span class=\"n\">ofOrd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">α</span>\n</code></pre></div>",
        "id": 547434277,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761640399
    },
    {
        "content": "<p>Here's the complete list of 284 duplicate theorems where the binderinfo is different: <a href=\"https://gist.github.com/JovanGerb/eeba89354b53597da94c5a873645e449\">https://gist.github.com/JovanGerb/eeba89354b53597da94c5a873645e449</a></p>\n<p>And 22 duplicate instances: <a href=\"https://gist.github.com/JovanGerb/2ebdcc7431f228690be8c8a470d1af21\">https://gist.github.com/JovanGerb/2ebdcc7431f228690be8c8a470d1af21</a></p>\n<p>All of these duplicates have not been in any of the above gists, so feel free to have a look.</p>",
        "id": 547437588,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761641495
    },
    {
        "content": "<p>What is the best way to sort the  entries in the list of duplicate theorems? It probably would be good to have a clear separation between Mathlib, Batteries, Lean and Std. But if the two declarations are defined in different places, which List should it be in? I guess it should be in the further downstream repository, since that is where the duplication actually exists.</p>",
        "id": 547438077,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761641672
    },
    {
        "content": "<p>Yep, in the downstream list.</p>",
        "id": 547442769,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1761643162
    },
    {
        "content": "<p>If we make this into a regular report, I think we also want to have a little bit of functionality to exclude known cases that we wish to ignore.</p>",
        "id": 547442866,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1761643192
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/30999\">#30999</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/31000\">#31000</a></p>",
        "id": 547458395,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761647989
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547431835\">said</a>:</p>\n<blockquote>\n<p>Thanks for pointing that out! I think an easier fix could be to make the assumption that in such cases, the variables will appear in the goal. And then we can check in which order they appear in the goal, sorting them based on that. This solution will also not be complete, but I can't think of any real-world cases where it would fail.</p>\n</blockquote>\n<p>I was curious if there were any real-world cases where this had the potential to fail (i.e. where free variables of the same type did not appear in the goal), because I also couldn't think of any! Turns out there are 2110 such cases; the pattern seems to be \"we use these variables to construct a necessary hypothesis for the goal\".</p>\n<p>Simple examples on the list include e.g. <code>And.imp {a c b d : Prop} (f : a → c) (g : b → d) (h : a ∧ b) : c ∧ d</code> and <code>Ne.elim : ∀ {α : Sort u} {a b : α}, a ≠ b → a = b → False</code> (though many are more complicated).</p>\n<p>(Note: just to be clear, these are not duplicate theorems, just theorems which would not be caught as duplicates if certain arguments were swapped, even if sorting by appearance in the goal.)</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getConstsWithNonGoalDupHyps</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">ConstantInfo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- code from the duplicate-catching linter!</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">ConstantInfo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"bp\">.</span><span class=\"n\">map₁</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">isInternalDetail</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">isMetaprogramming</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">allowCompletion</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">isDeprecated</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">continue</span><span class=\"w\"> </span><span class=\"c1\">-- filter out bad constants</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"bp\">.</span><span class=\"n\">value?</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">eta</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">continue</span><span class=\"w\"> </span><span class=\"c1\">-- filter out aliases</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">thmInfo</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">continue</span><span class=\"w\"> </span><span class=\"c1\">-- only consider theorems</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">instantiateTypeLevelParams</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"bp\">.</span><span class=\"n\">toConstantVal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cinfo</span><span class=\"bp\">.</span><span class=\"n\">levelParams</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"c1\">-- check if any two fvars in the type that are not in the goal have the same type</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">hasDups</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">forallTelescope</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">fvarSet</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">liftMetaM</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">collectFVars</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">!</span><span class=\"n\">fvarSet</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">fvar</span><span class=\"bp\">.</span><span class=\"n\">fvarId!</span>\n<span class=\"w\">      </span><span class=\"c1\">-- quadratic, but fine for demo purposes</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.</span><span class=\"bp\">..</span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">...</span><span class=\"n\">fvars</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hasDups</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">cs</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">5000000</span>\n\n<span class=\"n\">run_meta</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getConstsWithNonGoalDupHyps</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{cs.size} declarations:</span><span class=\"se\">\\n</span><span class=\"s2\">{cs.map (MessageData.ofConstName ·.1)}\"</span>\n</code></pre></div>\n</div></div>\n<p>Maybe doing something recursive would work? But at that point it might not be significantly simpler than the loogle-esque matching approach I outlined before.</p>\n<p>Either way, this is definitely a future refinement (2110 is really not a huge pool in which to find duplicates, given the fraction of all declarations which are likely to be duplicates), and let's not let it get in the way of creating a technical debt report. :)</p>",
        "id": 547523125,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761664978
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/31040\">#31040</a> deprecates a lean4/Mathlib duplicated instance from the above list.</p>",
        "id": 547621291,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761707188
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span>, could these reports include the module name in which each definition appears? That would be helpful both for triaging and fixing these duplications.</p>",
        "id": 547621393,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761707276
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">inhabited_of_nonempty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">inhabited_of_nonempty'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">α</span>\n</code></pre></div>\n<p>is an intentional duplication, per the doc-string. I guess we need some way to remove such cases from the reports?</p>",
        "id": 547621462,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761707338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547434277\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span>, Here are the duplicate declarations that my algorithm had missed due to requiring that the binder info is the same in both declarations:</p>\n<p>42 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/030f4f4f50c83239b150ccb2eb6221d2\">https://gist.github.com/JovanGerb/030f4f4f50c83239b150ccb2eb6221d2</a></p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover/lean4/pull/11004\">lean#11004</a> deals with most of these.</p>",
        "id": 547623150,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761708784
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547621393\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span>, could these reports include the module name in which each definition appears? That would be helpful both for triaging and fixing these duplications.</p>\n</blockquote>\n<p>What would be the most convenient representation of the results? Something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">One</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Two</span>\n<span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">inhabited_of_nonempty</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">inhabited_of_nonempty'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">α</span>\n</code></pre></div>",
        "id": 547625948,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761711227
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/547621462\">said</a>:</p>\n<blockquote>\n<p>I guess we need some way to remove such cases from the reports?</p>\n</blockquote>\n<p>In this case, one of the two is not actually tagged as an <code>instance</code>. If we want the algorithm to not have false positives, then we can make it only look at type class instances that are actually tagged as an <code>instance</code>.</p>",
        "id": 547626255,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761711503
    },
    {
        "content": "<p>If the number of actually-we-do-want-both-of-these duplicates is small then we could just have an <code>[@yes-we-know-this-is-duplicated]</code> attribute.</p>",
        "id": 547659337,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761728387
    },
    {
        "content": "<p>The doc-prime linter has a file somewhere listing all of the exceptions, so we could do the same here I guess?</p>",
        "id": 547659738,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761728475
    },
    {
        "content": "<p>The file for the doc-prime needed some more work, though, since modifying the file does not corrupt the oleans.  This means that after you add an exception, you still have to rebuild, instead of using the cached build.</p>",
        "id": 547660202,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761728588
    },
    {
        "content": "<p>Not in the list, but: <a href=\"https://github.com/leanprover-community/mathlib4/pull/31106\">#31106</a></p>",
        "id": 548097781,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761898342
    },
    {
        "content": "<p><code>Init.Data.Nat.Basic</code> contains a lot of duplicates which are intentional according to their docstring, but why? and since <code>alias</code> is in Batteries they're defined manually.<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.lt_asymm#doc\">docs#Nat.lt_asymm</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.not_lt_of_gt#doc\">docs#Nat.not_lt_of_gt</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.not_lt_of_lt#doc\">docs#Nat.not_lt_of_lt</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.le_total#doc\">docs#Nat.le_total</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.le_or_ge#doc\">docs#Nat.le_or_ge</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.le_or_le#doc\">docs#Nat.le_or_le</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.lt_iff_le_not_le#doc\">docs#Nat.lt_iff_le_not_le</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.lt_iff_le_and_not_ge#doc\">docs#Nat.lt_iff_le_and_not_ge</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.ne_iff_lt_or_gt#doc\">docs#Nat.ne_iff_lt_or_gt</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.lt_or_gt#doc\">docs#Nat.lt_or_gt</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.zero_lt_one#doc\">docs#Nat.zero_lt_one</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.one_pos#doc\">docs#Nat.one_pos</a></p>",
        "id": 548233911,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761939716
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.pos_of_ne_zero#doc\">docs#Nat.pos_of_ne_zero</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.zero_lt_of_ne_zero#doc\">docs#Nat.zero_lt_of_ne_zero</a> are in the list, but maybe it should also flag duplicates of half an iff, as they're both sides of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.pos_iff_ne_zero#doc\">docs#Nat.pos_iff_ne_zero</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.ne_zero_iff_zero_lt#doc\">docs#Nat.ne_zero_iff_zero_lt</a> which are themselves duplicates up to <code>Iff.symm</code></p>",
        "id": 548234423,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761939906
    },
    {
        "content": "<p>I believe most of the aliases about <code>Nat</code> are for discoverability purposes. For example, if you didn't know the formal term \"asymm\" you could still find <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.not_lt_of_gt#doc\">docs#Nat.not_lt_of_gt</a> using the usual naming scheme.</p>",
        "id": 548299209,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761996260
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getElem_zero#doc\">docs#List.getElem_zero</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.getElem_zero_eq_head#doc\">docs#List.getElem_zero_eq_head</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.head_eq_getElem#doc\">docs#List.head_eq_getElem</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.get_mk_zero#doc\">docs#List.get_mk_zero</a><br>\nSo many variants of <code>l.head = l[0]</code> <span aria-label=\"cold sweat\" class=\"emoji emoji-1f630\" role=\"img\" title=\"cold sweat\">:cold_sweat:</span></p>",
        "id": 558839044,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1763840498
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_div_cancel#doc\">docs#div_div_cancel</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_div_self%27#doc\">docs#div_div_self'</a> are identical; with the Nat version being named <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.div_div_self#doc\">docs#Nat.div_div_self</a> and the group with zero version being <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_div_cancel%E2%82%80#doc\">docs#div_div_cancel₀</a></p>",
        "id": 558866229,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1763874203
    },
    {
        "content": "<p>Here are some more which don't seem to be in the above lists: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.div_lt_div_iff_of_dvd_of_pos#doc\">docs#Int.div_lt_div_iff_of_dvd_of_pos</a> is an exact match to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.ediv_lt_ediv_iff_of_dvd_of_pos#doc\">docs#Int.ediv_lt_ediv_iff_of_dvd_of_pos</a>, as are the <em>emph</em> three lemmas immediately after.</p>",
        "id": 558917169,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1763926464
    },
    {
        "content": "<p>Those last ones sound like a consequence of the fact that <code>div</code> in core used to be different.</p>",
        "id": 558943926,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1763954222
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27887\">#27887</a> recently added <code>@[to_dual]</code>, similar to <code>@[to_additive]</code>, and there are a few recent PRs that delete existing theorems and instead autogenerate them using this attribute.<br>\nIs it perhaps possible to modify the script that finds duplicates to first transform every declaration using either of these automatic translation attributes and then find matches, to generate a list of theorems which are actually dual?</p>",
        "id": 562386670,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765169281
    },
    {
        "content": "<p>Yes, that sounds like it could be helpful for tagging more things with <code>@[to_dual]</code>.</p>",
        "id": 562467889,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1765200930
    },
    {
        "content": "<p>Sorry for taking so long to get back to this. I've now put the updated code in a PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/33640\">#33640</a>. This version ignores binder info. It also sorts the results better, so it starts with entries in <code>Init</code>, then <code>Lean</code>, then <code>Std</code>, etc. I've made 3 categories: theorems (things in Prop), instances that aren't Props, and other definitions (where we also need to index the body, not just the type).</p>\n<p>The one searching for theorems is somewhat slow, taking multiple minutes when run on all of mathlib.</p>\n<p>The filter that ignores <code>alias</code> entries doesn't work for theorems in a <code>module</code> because the theorem body isn't imported. So instead, the program should be run in a non-module.</p>\n<p>I've ran the code on current mathlib:</p>\n<ul>\n<li>728 duplicate theorems: <a href=\"https://gist.github.com/JovanGerb/da914d9201bff759f84631d925817519\">https://gist.github.com/JovanGerb/da914d9201bff759f84631d925817519</a></li>\n<li>123 duplicate instances: <a href=\"https://gist.github.com/JovanGerb/0c93a1467006ed0583999e559ec05390\">https://gist.github.com/JovanGerb/0c93a1467006ed0583999e559ec05390</a></li>\n<li>180 duplicate definitions (most of which are intentional): <a href=\"https://gist.github.com/JovanGerb/e4015fb5837065baa95e7a991c010896\">https://gist.github.com/JovanGerb/e4015fb5837065baa95e7a991c010896</a></li>\n</ul>",
        "id": 566464009,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1767662382
    },
    {
        "content": "<p>Thanks a lot! I'm scouring for easy PRs and I've already opened three of them.</p>",
        "id": 566486664,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767680912
    },
    {
        "content": "<p>Honorary mention to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SemimoduleCat.hom_zsmul#doc\">docs#SemimoduleCat.hom_zsmul</a> which is a duplicate of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SemimoduleCat.hom_nsmul#doc\">docs#SemimoduleCat.hom_nsmul</a>, because a semimodule doesn't have a <code>zsmul</code> operation! Just because the lakefile builds doesn't mean it's \"correct\".</p>",
        "id": 566486758,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1767680961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/566486664\">said</a>:</p>\n<blockquote>\n<p>Thanks a lot! I'm scouring for easy PRs and I've already opened three of them.</p>\n</blockquote>\n<p>Could you link them here, please? One PR per message, to help the emoji-bot.</p>",
        "id": 566501403,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1767689544
    },
    {
        "content": "<p>If this is a tad slow to always run in CI, can it be included in maybe the weekly linting or technical debt metrics? (With a way to exempt declarations)</p>",
        "id": 566534630,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767702469
    },
    {
        "content": "<p>Yes, that is the idea, to have it run periodically (e.g. weekly), and then report the status here on Zulip. It could be it's own weekly message, although I guess it could also be integrated with the new weekly linter report.</p>",
        "id": 566535025,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1767702642
    },
    {
        "content": "<p>The weekly linting set would be nice for downstream reuse, though maybe it's awkward to include something that has the flavor of an environment linter.</p>",
        "id": 566536423,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767703216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/duplicate.20declarations/near/566464009\">said</a>:</p>\n<blockquote>\n<p>The filter that ignores <code>alias</code> entries doesn't work for theorems in a <code>module</code> because the theorem body isn't imported. So instead, the program should be run in a non-module.</p>\n</blockquote>\n<p>Does this mean we should be recording alias information in an environment extension?</p>",
        "id": 566538476,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767704096
    },
    {
        "content": "<p>Alternatively, perhaps you can detect the alias docstring for now?</p>",
        "id": 566538516,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767704112
    },
    {
        "content": "<p>My filter also includes the case where something isn't defined using the <code>alias</code> command, but it is defined directly from another constant.</p>\n<p>That's because in such a case someone usually made the conscious decision of having multiple of the same constant.</p>",
        "id": 566538851,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1767704251
    },
    {
        "content": "<p>I think if we want to auto-detect duplicate declarations, we need an explicit marker that indicates where duplication is intentional</p>",
        "id": 566539380,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1767704477
    }
]