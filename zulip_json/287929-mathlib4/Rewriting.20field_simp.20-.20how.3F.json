[
    {
        "content": "<p>It's been said many times that the current implementation of <code>field_simp</code> is slow and in need of a rewrite. I'm considering to try this (but may only get to this in October - if <em>you</em> have time for this now, go ahead!). Can somebody describe <em>what</em> needs changing and why? <em>I</em> would find that really helpful, and perhaps not just me.</p>",
        "id": 456323853,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1722779982
    },
    {
        "content": "<p>I think that a quick win would be to at least give the tactic the option of creating side-goals asserting that all denominators (or factors of denominators) are non-zero.</p>",
        "id": 456324788,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722780128
    },
    {
        "content": "<p>This was discussed several times, and I think that it was never implemented.</p>",
        "id": 456324890,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722780144
    },
    {
        "content": "<p>It would be nice to turn it into a <code>ring</code>-style tactic with an option to choose whether to assume that all denominators are nonzero.</p>",
        "id": 456335970,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1722784137
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> I just saw you had plans to rewrite field_simp \"in October\" <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span>.  In case this is still on your to-do list, here are a few things I'd love to see:</p>\n<ul>\n<li><code>conv</code> version of <code>field_simp</code></li>\n<li>handle inequalities: <code>field_simp</code>-ify LHS and RHS separately and then cross-multiply</li>\n<li>handle cases when only some denominators are known to be nonzero, but those ones are enough to solve the goal at hand.</li>\n</ul>\n<p>For a test case for the third one: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">linear_combination</span><span class=\"w\"> </span><span class=\"n\">mul_inv_cancel₀</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">field_simp</span><span class=\"w\"> </span><span class=\"c1\">-- fails, \"simp made no progress\"</span>\n</code></pre></div>",
        "id": 475141667,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1728247939
    },
    {
        "content": "<p>I also think it would be good to disable the current possibility of accessing and modifying the <code>simp</code> inside the <code>field_simp</code> implementation.  This means that all the proofs in which people sneak other lemmas into a <code>field_simp</code>, like (choosing a random library example)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">field_simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">norm_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">smul_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sq_abs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sq_sqrt</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\">  </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt_div</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>would have to be decoupled into a <code>simp only</code> step and a true <code>field_simp</code> step.</p>\n<p>(In fact, I suspect that a sufficiently flexible <code>field_simp</code> implementation will not actually be a wrapper for <code>simp</code> any more, but a true custom-written tactic.  If so, the above request will be fulfilled by default.)</p>",
        "id": 475142000,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1728248244
    },
    {
        "content": "<p>Thanks for reminding me! This is actually still on my \"distant ideas\" list - but looks like a nice metaprogramming project. I may actually take this on (in the second half of October, or perhaps November, as I want to wind down some other Lean work I took up in the meantime...) Thanks for the ideas!</p>",
        "id": 475506894,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1728375893
    },
    {
        "content": "<p>Adding my take on this here, since the issue came up again in another thread.</p>\n<p>In my personal view, the main problem with <code>field_simp</code> at the moment isn't lack of features, but slowness: whenever I try to use it, it ends up being so sluggish that I usually end up losing patience and falling back on manual rewrites instead. I would much rather see speed improvements within the existing spec, than new features that don't solve the slowness problem.</p>",
        "id": 479845600,
        "sender_full_name": "David Loeffler",
        "timestamp": 1730370258
    },
    {
        "content": "<p>Is anybody currently working on this?</p>",
        "id": 499987240,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739690224
    },
    {
        "content": "<p>I've been thinking about this recently. My motivation has been Heather's third point above: I got annoyed when it couldn't prove <code>Real.log x / (x * (Real.log x)^2) = 1 / (x * Real.log x)</code> using just <code>Real.log x != 0</code></p>\n<p>I think the right thing to do is to write an extension to <code>ring</code> (<code>field</code> perhaps?) that keeps more careful track of the nonzero atoms. Having skimmed the internals of <code>ring</code> we can mostly just build on top of the existing infrastructure. It probably wouldn't be too difficult to get something that works better than <code>field_simp</code>. I also think this could be quite a bit faster if we keep more careful track of the nonzero proofs. </p>\n<p>One would definitely run into challenges with having to keep track of normal forms of expressions like <code>a/(a+a*b)</code>, but that's also true of <code>field_simp</code>.</p>",
        "id": 500058046,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1739751159
    },
    {
        "content": "<p>Note that since 3 days ago (<a href=\"https://github.com/leanprover-community/mathlib4/pull/21326\">#21326</a>) <code>field_simp</code> is faster. I disabled it from trying to apply lemmas that aren't applicable to fields (and cost time to fail).</p>",
        "id": 500082386,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1739768315
    },
    {
        "content": "<p>My opinion is that <code>field_simp</code> should be given the (default?) option to assume all (factors of) denominators <del>are</del> aren't 0. I have almost never encountered a case where I need to call <code>field_simp</code> but a denominator can be 0. It can try a discharger like <code>positivity</code> and then fall back to leaving an extra subgoal for proving nonzero to the user.</p>",
        "id": 500093404,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1739773645
    },
    {
        "content": "<p>Do you mean aren't zero?</p>",
        "id": 500094154,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739773980
    },
    {
        "content": "<p>What would also be nice (perhaps activated by a config option because it might be expensive) is for the <code>field</code> tactic to check if the statement still holds when one of the denominators it could not prove to be nonzero is in fact zero. E.g., <code>x * x / x = x</code> holds even when <code>x = 0</code>.</p>\n<p>In any case, I definitely support the idea that <code>field</code> assumes that all relevant denominators are nonzero and leaves these as side goals when it cannot prove them. (Possibly also via a config option.)</p>",
        "id": 500117489,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739781989
    },
    {
        "content": "<p>I'm interesting in implementing this, and based on these suggestions I'm thinking of the following draft:</p>\n<ul>\n<li>This will be implemented as <code>field</code> normalization tactic, like <code>ring</code> (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/4837\">#4837</a>)</li>\n<li>There will be a <code>nonzeroness</code> discharging tactic (like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=finiteness#doc\">docs#finiteness</a>), I'm unsure about the details of it but it should fail quickly</li>\n<li>A default <code>field</code> will:<ul>\n<li>Try to use <code>nonzeroness</code> on all denominators to prove they're nonzero</li>\n<li>Simplify all denominators recursively</li>\n<li>Factor denominators, and try to use <code>nonzeroness</code> on factors it couldn't prove previously were nonzero</li>\n</ul>\n</li>\n<li>You can use <code>field [a, b, c]</code> to make it assume <code>a, b, c</code> are nonzero, <code>field [*]</code> to make it assume all denominators are nonzero, or <code>field [*, -a, -b]</code> to make it assume all denominators except <code>a, b</code> are nonzero. It will attempt to use <code>nonzeroness</code> to prove they are nonzero, and when that fails it will leave that as a subgoal.</li>\n<li>After it has the nonzero denominators, it will bring all fractions to a common denominator, and cancel whatever it can. Possibly-zero divisors will remain in the numerator</li>\n<li>In the numerator, we will cancel <code>(a * x^n) / (b * x^m)</code> to <code>a / b * x^(n - m)</code> for <code>n != m</code>, and to <code>(a * x) / (b * x)</code> for <code>n = m</code>, even for possibly-zero <code>x</code></li>\n</ul>\n<p>If anybody has any comments/suggestions/concerns I'd be glad to hear them</p>",
        "id": 500144963,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739788579
    },
    {
        "content": "<p>It may be an option to outsource factorization to a CAS (the validity can be checked by <code>ring</code>). Since <code>field</code> will not be a self-replacing tactic like <code>polyrith</code>, this would work best with a locally installed CAS. Of course, it would also be good to have a Lean implementation (there is some discussion on implementing a CAS in Lean, I think), but this would be quite a lot of work and should not hold up getting a reasonable first version of <code>field</code> into Mathlib.</p>",
        "id": 500158437,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739791865
    },
    {
        "content": "<p><del>I think getting something basic in Lean hopefully shouldn't be too hard</del>, and outsourcing this computation to a CAS could be slower (due to the costs of calling it) and less portable</p>",
        "id": 500159662,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739792181
    },
    {
        "content": "<p>In my experience, not worrying about CAS for now and just worrying about the case where the denominator is e.g. <code>a * b * c^n</code> and picking up a!=0, b!=0, c!=0 will already be very useful.</p>",
        "id": 500164055,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739793349
    },
    {
        "content": "<p>Sounds like a good idea, so I'll start with that. Any suggestions for behavior of the <code>nonzeroness</code> tactic? I think just trying <code>assumption</code> and if that fails trying to show <code>0 &lt; x</code> using <code>positivity</code> would be a good start</p>",
        "id": 500164414,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739793434
    },
    {
        "content": "<p>As a first implementation, I would leave <code>try assumption</code>.</p>",
        "id": 500164992,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739793601
    },
    {
        "content": "<p>Or even <code>skip</code>.</p>",
        "id": 500165068,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739793611
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500164414\">said</a>:</p>\n<blockquote>\n<p><code>nonzeroness</code></p>\n</blockquote>\n<p>Maybe call it <code>nonvanishing</code>? \"Nonzeroness\" looks a bit clumsy language-wise. (Disclaimer: not a native <span aria-label=\"flag united kingdom\" class=\"emoji emoji-1f1ec-1f1e7\" role=\"img\" title=\"flag united kingdom\">:flag_united_kingdom:</span> <span aria-label=\"flag united states\" class=\"emoji emoji-1f1fa-1f1f8\" role=\"img\" title=\"flag united states\">:flag_united_states:</span> speaker.)</p>",
        "id": 500170545,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739794989
    },
    {
        "content": "<p><code>positivity</code> already proves nonzeroness, btw</p>",
        "id": 500171895,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739795333
    },
    {
        "content": "<p>But <code>positivity</code> wants a partial order:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">failed to synthesize</span>\n<span class=\"cm\">  PartialOrder (ZMod 5)</span>\n<span class=\"cm\">Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>and <code>field</code> should also work in positive characteristic, for example.</p>",
        "id": 500174991,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739796136
    },
    {
        "content": "<p>Can we make <code>positivity</code> work rather than having two tactics doing nearly the same thing?</p>",
        "id": 500185434,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739798567
    },
    {
        "content": "<p>There's always just the <code>field_simp</code> <a href=\"https://github.com/leanprover-community/mathlib4/blob/53815d4e7dfe51eef5f197cc28f93404bd97893d/Mathlib/Tactic/FieldSimp.lean#L36-L84\">discharger</a>, which roughly tries <code>assumption</code>, <code>norm_num</code>, <code>positivity</code> and finally <code>simp</code> with a custom simp-set</p>",
        "id": 500195957,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1739800949
    },
    {
        "content": "<p>That sounds good for now, and it could be changed later</p>",
        "id": 500197228,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739801231
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500164055\">said</a>:</p>\n<blockquote>\n<p>In my experience, not worrying about CAS for now and just worrying about the case where the denominator is e.g. <code>a * b * c^n</code> and picking up a!=0, b!=0, c!=0 will already be very useful.</p>\n</blockquote>\n<p>Do you think supporting a variable <code>n</code> here is important, or is that relatively uncommon?</p>",
        "id": 500198229,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739801464
    },
    {
        "content": "<p>Is there a way to simplify <code>x^n / x^m</code> for general <code>x, n, m</code>?</p>",
        "id": 500199070,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739801656
    },
    {
        "content": "<p>The only reason I mentioned powers was that I'd seen them before in explicit examples where I wanted <code>field_simp</code> to do better</p>",
        "id": 500199347,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739801724
    },
    {
        "content": "<p>I'm asking if the exponent was variable or a constant integer in those cases</p>",
        "id": 500199738,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739801811
    },
    {
        "content": "<p>I can't remember</p>",
        "id": 500200657,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739802023
    },
    {
        "content": "<p>No doubt if you implement it for constants then at some point someone will complain that they have a variable nat power and it didn't work (historically the same thing happened for <code>ring</code>)</p>",
        "id": 500200853,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739802066
    },
    {
        "content": "<p>Even ignoring factoring, I think polynomial GCD might be fairly necessary</p>",
        "id": 500206245,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739803242
    },
    {
        "content": "<p>What I'm saying is that in practice denominators are often already factored.</p>",
        "id": 500207940,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739803609
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500207940\">said</a>:</p>\n<blockquote>\n<p>What I'm saying is that in practice denominators are often already factored.</p>\n</blockquote>\n<p>Hmm. Taking advantage of that might be a bit tricky with <code>ring</code>'s architecture of immediately distributing products, I'll think about how to do that</p>",
        "id": 500210561,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739804242
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500199070\">said</a>:</p>\n<blockquote>\n<p>Is there a way to simplify <code>x^n / x^m</code> for general <code>x, n, m</code>?</p>\n</blockquote>\n<p>Here's an idea:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">GroupWithZero</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">zpow'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"n\">n</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">zpow'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">zpow'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">zpow'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zpow'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_zpow_eq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">split_ifs</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">zpow_add₀</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n</code></pre></div>\n<p>If you can show any naturally-occurring exponents are nonzero you can rewrite them into <code>zpow'</code> and normalise everything in terms of that.</p>",
        "id": 500215748,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1739805420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500206245\">said</a>:</p>\n<blockquote>\n<p>Even ignoring factoring, I think polynomial GCD might be fairly necessary</p>\n</blockquote>\n<p>Polynomial GCD should indeed be all that is necessary. But to do this reasonably efficiently for multivariate polynomials (that are noncomputable in Mathlib...) is still a serious task (and will necessitate to decide whether fairly random field elements are zero or not during the algorithm, I would think).</p>\n<p>I guess a first reasonable step is to just rewrite as a quotient of polynomials on both sides of the equality, then cross-multiply and let <code>ring</code> do its work. Once this works reliably and is reasonably efficient, we can think of adding more bells and whistles.</p>",
        "id": 500225390,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739807623
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500225390\">said</a>:</p>\n<blockquote>\n<p>and will necessitate to decide whether fairly random field elements are zero or not during the algorithm, I would think</p>\n</blockquote>\n<p>If everything except constant integers are atoms than this shouldn't be a problem, I think</p>\n<blockquote>\n<p>I guess a first reasonable step is to just rewrite as a quotient of polynomials on both sides of the equality, then cross-multiply and let <code>ring</code> do its work. Once this works reliably and is reasonably efficient, we can think of adding more bells and whistles.</p>\n</blockquote>\n<p>This wouldn't as a normalization tactic, but I guess as a start it works. It might be easier to convert <code>a = b</code> to <code>a - b = 0</code>, simplify <code>a - b</code>, and if that's <code>c / d</code> with nonzero <code>d</code> you can turn the goal to <code>c = 0</code></p>",
        "id": 500227293,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739808090
    },
    {
        "content": "<p>That should be more or less the same (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi mathvariant=\"normal\">/</mi><mi>b</mi><mo>−</mo><mi>c</mi><mi mathvariant=\"normal\">/</mi><mi>d</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mi>d</mi><mo>−</mo><mi>b</mi><mi>c</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a/b - c/d = (ad - bc)/(bd)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span>, so we get the same effect as first changing <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi mathvariant=\"normal\">/</mi><mi>b</mi><mo>=</mo><mi>c</mi><mi mathvariant=\"normal\">/</mi><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">a/b = c/d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">d</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi>d</mi><mo>=</mo><mi>b</mi><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">ad = bc</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">c</span></span></span></span> assuming <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo separator=\"true\">,</mo><mi>d</mi><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">b, d \\neq 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>). Whatever is easier to implement.</p>",
        "id": 500227950,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739808241
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Rewriting.20field_simp.20-.20how.3F/near/500225390\">said</a>:</p>\n<blockquote>\n<p>Polynomial GCD should indeed be all that is necessary. But to do this reasonably efficiently for multivariate polynomials (that are noncomputable in Mathlib...) is still a serious task (and will necessitate to decide whether fairly random field elements are zero or not during the algorithm, I would think).<br>\n</p>\n</blockquote>\n<p>I agree this is a serious task and out of scope for an initial tactic but I think the coefficients in <code>ring</code> are just rational literals, so equality checks wouldn't be an issue (in characteristic 0 at least).</p>",
        "id": 500231613,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1739809106
    },
    {
        "content": "<p>To figure out <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\gcd(y^2-x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span style=\"margin-right:0.01389em;\">g</span>cd</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>, you'll need to know whether <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> is zero or not.</p>\n<p>But it would already be helpful to determine \"generic\" gcds (i.e., assuming that all nontrivial polynomials are nonzero) to get at least some normalization of quotients.</p>",
        "id": 500233604,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1739809638
    },
    {
        "content": "<p>Just to reiterate -- my recollections of the complaints about <code>field_simp</code> were usually of the form \"it's too slow\" or \"I had A/x + B/x^2 + C/x^3 and it multiplied everything by x*x^2*x^3 instead of x^3\" or \"why did it not spot that the denominator was obviously non-zero\" and were basically never of the form \"the denominator is x^2-y^2 and I had hypotheses that x+y and x-y were nonzero, why did the machine not factor x^2-y^2\" or any other complaint related to factorization in any kind of nontrivial way.</p>",
        "id": 500241149,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739811600
    },
    {
        "content": "<p>I agree with Kevin: anything that can be factored \"syntactically\", probably should be, clear that out and then worry about the \"syntactic factors\" being non-zero later.</p>",
        "id": 500245794,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739813039
    },
    {
        "content": "<p>You needs to take care that such factorisations are not expanded greedily by the ring tactic. Perhaps a field tactic needs to hold back a bit on the normalisation it does.</p>",
        "id": 500246568,
        "sender_full_name": "Arend Mellendijk",
        "timestamp": 1739813348
    },
    {
        "content": "<p>I've thought about this, and after looking at the implementation of <code>ring</code>, I'm thinking:</p>\n<p>A monomial is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mo>∏</mo><mrow><mi>j</mi><mo>∈</mo><mi>C</mi></mrow></msub><mfrac><msub><mi>a</mi><mi>j</mi></msub><msub><mi>a</mi><mi>j</mi></msub></mfrac><mo stretchy=\"false\">)</mo><mo>∏</mo><msubsup><mi>a</mi><mi>i</mi><msub><mi>b</mi><mi>i</mi></msub></msubsup></mrow><annotation encoding=\"application/x-tex\">(\\prod_{j \\in C} \\frac{a_j}{a_j})\\prod a_i ^ {b_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.4733em;vertical-align:-0.5423em;\"></span><span class=\"mopen\">(</span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1786em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8087em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.5073em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.931em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.1449em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are the atoms and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are integers. If we can prove <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">b_i \\ne 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> then we can remove <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span>. (This is <code>ring</code>'s <code>ExBase</code> and <code>ExProd</code>)<br>\nWe have sums of monomials, analogous to <code>ring</code>'s <code>ExSum</code>.</p>\n<p>We also have a new <code>ExDiv</code>, which is the quotient of an <code>ExSum</code> by an <code>ExProd</code>, together with a proof that the denominator is nonzero (and as a consequence <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi><mo>=</mo><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">C = \\emptyset</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">∅</span></span></span></span>).</p>\n<p>When we want to add or multiply <code>ExDiv</code>s we take a common denominator.</p>\n<p>If we want to invert an <code>ExDiv</code> we attempt to prove that the numerator is nonzero. If that fails we construct an atom from the numerator and use <code>ExProd</code> with a power of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>, otherwise we can just swap the numerator and denominator</p>",
        "id": 500247169,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739813631
    },
    {
        "content": "<p>Regarding distributing I think only distributing things inside a sum inside a product should work fairly well</p>",
        "id": 500247385,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739813723
    },
    {
        "content": "<p>Is that supposed to say <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><msub><mi>a</mi><mi>j</mi></msub><msub><mi>a</mi><mi>j</mi></msub></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{a_j}{a_j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.351em;vertical-align:-0.5423em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8087em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.5073em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>?</p>",
        "id": 500293209,
        "sender_full_name": "Timo Carlin-Burns",
        "timestamp": 1739837335
    },
    {
        "content": "<p>Yes - it's 1 if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> is nonzero and 0 if it is zero</p>",
        "id": 500574357,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739947998
    }
]