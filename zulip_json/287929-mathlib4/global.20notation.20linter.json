[
    {
        "content": "<p>Should we have a linter against global notation? Of course it could be deactivated when needed. I just found <a href=\"https://github.com/leanprover-community/mathlib4/pull/10043\">#10043</a> that introduced an extremely generic notation (the infix operator <code>^*</code>) to use it exactly twice in Mathlib if I’m not mistaken. Clearly this is a failure of the reviewing process but linters should be here to help reviewers.</p>",
        "id": 442616403,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717531782
    },
    {
        "content": "<p>We’ll see in <a href=\"https://github.com/leanprover-community/mathlib4/pull/13518\">#13518</a> whether CI agrees this notation was not used elsewhere.</p>",
        "id": 442616838,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717531935
    },
    {
        "content": "<p>I mean surely global notation is usually fine?</p>",
        "id": 442623753,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1717534227
    },
    {
        "content": "<p>Maybe there would be too many nolints. I’m really not sure what to do. Maybe we need some GitHub bot to detect that word notation and post a message reminding reviewers to check whether the notation is global and reasonable.</p>",
        "id": 442624111,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717534339
    },
    {
        "content": "<p>In the mean time CI confirmed that global <code>^*</code> was used exactly twice in Mathlib. I would appreciate a quick merge of <a href=\"https://github.com/leanprover-community/mathlib4/pull/13518\">#13518</a> so that I can finish updating GlimpseOfLean.</p>",
        "id": 442625897,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717534902
    },
    {
        "content": "<p>I do think in general it would be nice for CI to post a summary of a PR. A list of theorems added and/or deleted, notations added, change in the import graph, etc... Basically, anything that would make it easier for reviewers to spot suspicious changes.</p>",
        "id": 442658341,
        "sender_full_name": "Richard Osborn",
        "timestamp": 1717546328
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"127136\">@Alex J. Best</span> had a nice prototype in January.</p>",
        "id": 442672368,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717552050
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"560559\">Richard Osborn</span> <a href=\"#narrow/stream/287929-mathlib4/topic/global.20notation.20linter/near/442658341\">said</a>:</p>\n<blockquote>\n<p>I do think in general it would be nice for CI to post a summary of a PR. A list of theorems added and/or deleted, notations added, change in the import graph, etc... Basically, anything that would make it easier for reviewers to spot suspicious changes.</p>\n</blockquote>\n<p>Each PR has a CI step called <code>summarize-declarations</code> that does a part of that.</p>\n<p>A more verbose output, such as <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/9371348866/attempts/1#summary-25800435635\">this</a> and a more compact one that you can get by adding the label <code>move-decls</code> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/13034#issuecomment-2130310118\">the same PR as an example</a>).</p>",
        "id": 442696511,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1717564272
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/global.20notation.20linter/near/442672368\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"127136\">Alex J. Best</span> had a nice prototype in January.</p>\n</blockquote>\n<p>I would even say that it was progressing beyond the prototype stage. But I no longer have time to work on it. If anyone, or the community wants to adopt <a href=\"http://github.com/alexjbest/leaff\">github.com/alexjbest/leaff</a> that would make me very happy</p>",
        "id": 442737981,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1717580120
    },
    {
        "content": "<p>Speaking of PRs introducing global notation... <a href=\"https://github.com/leanprover-community/mathlib4/pull/11142\">#11142</a></p>",
        "id": 443098902,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1717689602
    },
    {
        "content": "<p>Thanks for noticing. All those notations should definitely be scoped.</p>",
        "id": 443104113,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1717691058
    },
    {
        "content": "<p>Once again, I suffering because of <em>crazy</em> global notations introduced in super low-level files. Today it’s <a href=\"https://github.com/leanprover-community/mathlib4/blob/d4a7b67c52e526f04082b832d2f3d298b17bd29e/Mathlib/Logic/Function/Defs.lean#L46-L47\">https://github.com/leanprover-community/mathlib4/blob/d4a7b67c52e526f04082b832d2f3d298b17bd29e/Mathlib/Logic/Function/Defs.lean#L46-L47</a>. <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> is there anything I can do to deactivate this notation in a downstream project? Or should I stick to Lean 4.15.0 because of this?</p>",
        "id": 492266984,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736240046
    },
    {
        "content": "<p>I don't understand why 4.15.0 vs 4.16.0-rc1 would change anything. This notation has been around forever (and is quite useless, I agree)</p>",
        "id": 492271112,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736241632
    },
    {
        "content": "<p>My understanding is that you can't disable syntaxes.</p>\n<p>I don't understand why 4.15-&gt;4.16 would change anything either.</p>\n<p>Given that this is a mathlib notation, could we scope it (or delete it?)</p>",
        "id": 492277863,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736244162
    },
    {
        "content": "<p>Happy to see it go to <span aria-label=\"wastebasket\" class=\"emoji emoji-1f5d1\" role=\"img\" title=\"wastebasket\">:wastebasket:</span></p>",
        "id": 492278108,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736244248
    },
    {
        "content": "<p>I think it's used fairly heavily with <code>Disjoint (f on tuple)</code> and <code>Pairwise (Disjoint on tuple)</code>; but maybe <code>f.on tuple</code> would be fine instead</p>",
        "id": 492280471,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736245172
    },
    {
        "content": "<p>Yaël, the reason why 4.15.0 vs 4.16.0-rc1 changes everything has been discussed at length already, it’s  <a href=\"https://github.com/leanprover/lean4/pull/6012\">lean4#6012</a>.</p>",
        "id": 492280672,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245257
    },
    {
        "content": "<p>Ah! not because the mathlib <code>on</code> notation but because your <code>on</code> notation changed.</p>",
        "id": 492280785,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736245313
    },
    {
        "content": "<p>This major change in parsing makes it much harder to avoid hitting this <code>on</code> notation bug.</p>",
        "id": 492280795,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245316
    },
    {
        "content": "<p>What prevents you using the same token?</p>",
        "id": 492282010,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736245739
    },
    {
        "content": "<p>(we have many notations in mathlib that use a <code>]</code> token, for instance)</p>",
        "id": 492282250,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736245809
    },
    {
        "content": "<p>I guess it creates a grammar ambiguity.</p>",
        "id": 492282691,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736245951
    },
    {
        "content": "<p>By the way, I wrote the wrong number. This issue prevents bumping from 4.14.0 to 4.15.0, it has nothing to do with 4.16</p>",
        "id": 492282849,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736246003
    },
    {
        "content": "<p>If anyone wants to play with this, it’s at <a href=\"https://github.com/PatrickMassot/verbose-lean4/tree/bump\">https://github.com/PatrickMassot/verbose-lean4/tree/bump</a></p>",
        "id": 492283827,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736246336
    },
    {
        "content": "<p><a href=\"https://github.com/PatrickMassot/verbose-lean4/blob/bump/Verbose/French/By.lean#L8\">https://github.com/PatrickMassot/verbose-lean4/blob/bump/Verbose/French/By.lean#L8</a> does not work because of Mathlib’s <code>on</code> notation.</p>",
        "id": 492283960,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736246386
    },
    {
        "content": "<p>It creates tons of <code>unexpected token 'obtient'; expected term</code>.</p>",
        "id": 492284058,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736246405
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>, I'm preparing a PR to scope <code>on</code>. Will scoping be enough for your purposes? The <code>Function</code> namespace gets opened pretty frequently.</p>\n<p>I'm also happy to require people to write <code>f.on tuple</code> as Eric suggested above.</p>",
        "id": 492414951,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736297503
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20562/files#top\">chore: scope 'on' notation to Function</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/20562\">#20562</a></p>",
        "id": 492418054,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736299495
    }
]