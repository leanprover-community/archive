[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span>, could you give me a quick tutorial sometime on how to use the DirectoryDependency linter?</p>\n<p>On my <code>hammer</code> branch on my <code>kim-em</code> fork, I'm getting messages:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Logic</span><span class=\"bp\">/</span><span class=\"n\">Encodable</span><span class=\"bp\">/</span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Encodable</span><span class=\"bp\">.</span><span class=\"n\">Pi</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">Hammer</span><span class=\"o\">,</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">modules</span><span class=\"w\"> </span><span class=\"n\">starting</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Batteries</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">NeZero</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Notation</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Control</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"o\">]</span><span class=\"bp\">.</span>\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"n\">Hammer</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span><span class=\"o\">,</span>\n<span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"o\">,</span>\n<span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">,</span>\n<span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">Exceptions</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">added</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`allowedImportDirs</span><span class=\"bp\">`.</span><span class=\"o\">)</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">directoryDependency</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>but looking at the definition of <code>allowedImportDirs</code> I'm not sure what change I should make to achieve the desired effect (everything is allowed to import <code>Hammer</code>!).</p>",
        "id": 524395059,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1750147880
    },
    {
        "content": "<p>If you want to disable all checks involving imports of <code>Hammer</code>, you can add it to the <code>let exclude</code> list in <code>directoryDependencyCheck</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">exclude</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">      </span><span class=\"ss\">`Init</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Std</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Lean</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"ss\">`Aesop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Qq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Plausible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`ImportGraph</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`ProofWidgets</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`LeanSearchClient</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Hammer</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"o\">]</span>\n</code></pre></div>\n<p>To be more specific and allow importing <code>Hammer</code> from <code>Mathlib.Logic</code> (but not necessarily elsewhere), you can add <code>Mathlib.Logic</code> paired with <code>Hammer</code> to the <code>allowedImportDirs</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">allowedImportDirs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NamePrefixRel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofArray</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Any file in the directory `Mathlib.Logic` is allowed to import `Hammer`.</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"ss\">`Mathlib.Logic</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Hammer</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span><span class=\"o\">,</span>\n<span class=\"o\">]</span>\n</code></pre></div>",
        "id": 524397517,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1750148733
    }
]