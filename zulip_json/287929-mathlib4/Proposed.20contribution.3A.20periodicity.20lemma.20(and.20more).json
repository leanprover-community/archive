[
    {
        "content": "<p>Hello, </p>\n<p>I have done some work in Lean on periods of lists. I have a pretty large library about related stuff in Isabelle, but have no contribution in mathlib so far. </p>\n<p>I do not think the period of List is defined in mathlib at the moment, and I propose a definition using self-overlap as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">hasPeriod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">&lt;+</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">take</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>I have a proof that this is equivalent to the other natural definiton:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hasPeriod_iff_getElem?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hasPeriod</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>One of the first nontrivial results about periods of lists is the Periodicity Lemma, also known as the \"Fine and Wilf Theorem\". I have a proof of it. The claim reads as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">periodicity_lemma</span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">per_p</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hasPeriod</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">per_q</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hasPeriod</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">hasPeriod</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">gcd</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The module with Periodicity Lemma starting with the definition has about 200 lines.</p>\n<p>I also have a much larger module which generalizes the periodicity lemma to a Finset of periods, including generation of the most \"free\" word with given periods, and proofs of its optimality.</p>\n<p>Is anything of this suitable for mathlib?</p>\n<p>P.S.: All this is part of a prepared publication about multiperiodic words, and their formalization in both Isabelle and Lean.</p>",
        "id": 537720769,
        "sender_full_name": "Stepan Holub",
        "timestamp": 1757006966
    },
    {
        "content": "<p>Do you need <code>w ≠ []</code> in the definition? Won't most results still be true without that assumption?</p>",
        "id": 537727597,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757009831
    },
    {
        "content": "<p>There is a trade off. Both options would work somehow. The basic idea is that <code>w</code> should be a <em>proper</em> prefix of <code>take p w ++ w</code></p>",
        "id": 537727968,
        "sender_full_name": "Stepan Holub",
        "timestamp": 1757010003
    },
    {
        "content": "<p>I would push for dropping that, and <code>p ≠ 0</code>! Both of your other facts (<code>hasPeriod_iff_getElem?</code>  and <code>periodicity_lemma</code>) work without it</p>",
        "id": 537735631,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757013201
    },
    {
        "content": "<p>You'll get other nice things, like that <code>hasPeriod</code> is monotonic under taking prefixes / suffixes</p>",
        "id": 537735936,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757013348
    },
    {
        "content": "<p>A crucial part of thinking about periods is the  \"periodic root\" which is the <code>r</code> for which <code>w &lt;+: r ++ w</code>. For example, <code>w</code> is a prefix of the infinite word <code>r^\\omega</code>. The case <code>r = []</code> is pathologic in many respects, for example, it has no primitve root. That said, the property <code>w &lt;+: r ++ w</code> with no further condition is also  useful, but it is so simple to state that it is not necessary to give it a special name. On the contrary, omitting the nonemptyness from the definition of <code>hasPeriod</code> would create the necessity to often deal with the empty case seperately. In the proposed way, the assumption <code>hasPeriod w p</code> naturaly eliminates unwanted trivial cases.</p>",
        "id": 537737334,
        "sender_full_name": "Stepan Holub",
        "timestamp": 1757013974
    },
    {
        "content": "<p>Okay, that could be! It just wasn't how it looked based on your results -- but, if you say so.</p>\n<p>I think the Fine and Wilf theorem would be mathlib suitable, and a cool thing to include! You should make a PR with the code you have, and then probably people can start pointing at how to clean it up in one way or another to get it suitable to merge. If it's a large PR (a subjective measure, but if it's substantially modifying several files), then the PR might need to be split up, and people can give pointers there too.</p>",
        "id": 537781735,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757037596
    },
    {
        "content": "<p>After further reflection, I have removed the nonemptiness from the definition as you suggested. It is probably overall more convenient to deal with the empty case separately. Thanls.</p>",
        "id": 537820756,
        "sender_full_name": "Stepan Holub",
        "timestamp": 1757061574
    },
    {
        "content": "<p>...and the <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329362.20.20periods.20of.20lists.20and.20the.20Periodicity.20Lemma/with/537846588\">PR</a> is made</p>",
        "id": 537841292,
        "sender_full_name": "Stepan Holub",
        "timestamp": 1757068860
    }
]