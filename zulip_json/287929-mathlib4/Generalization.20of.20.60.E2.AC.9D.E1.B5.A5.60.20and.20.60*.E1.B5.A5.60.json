[
    {
        "content": "<p>In a recent review, we were asked (anonymously) whether our generalized version of <code>⬝ᵥ</code> and <code>*ᵥ</code> defined <a href=\"https://github.com/madvorak/duality/blob/92143f0ae8bc6dbd72b261e5e00f6a4a7edebc0d/Duality/FarkasSpecial.lean#L184\">here</a> could be integrated into Mathlib.</p>\n<p>What is your opinion?</p>",
        "id": 524680981,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750244602
    },
    {
        "content": "<p>What does it do? What does it generalise?</p>",
        "id": 524681237,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750244708
    },
    {
        "content": "<p>I tried to write it as readably as possible:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">dotWeig</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\">    </span><span class=\"c1\">-- generalizes `⬝ᵥ`</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mulWeig</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">ᵥ⬝</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\">    </span><span class=\"c1\">-- `*ᵥ`</span>\n</code></pre></div>",
        "id": 524681632,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750244870
    },
    {
        "content": "<p>What are the corresponding Lean declarations?</p>",
        "id": 524681751,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750244910
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=dotProduct#doc\">docs#dotProduct</a><br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.mulVec#doc\">docs#Matrix.mulVec</a></p>",
        "id": 524681821,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750244939
    },
    {
        "content": "<p>Ah, so the generalisation is that you replace <code>*</code> with <code>•</code> inside the definition of <code>dotProduct</code>? Sounds reasonable yes, although I suspect making that generalisation might make elaboration more brittle</p>",
        "id": 524682142,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750245085
    },
    {
        "content": "<p>There is a long-winded explanation in Section 2.3.1 <a href=\"https://github.com/madvorak/duality/blob/main/nonLean/duality.pdf\">here</a> on page 8, but I doubt anybody wants to read it. The code should speak for itself.</p>",
        "id": 524682232,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750245125
    },
    {
        "content": "<p>Well of course, you could generalise to the point where you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum#doc\">docs#Finset.sum</a> directly <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 524682547,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750245250
    }
]