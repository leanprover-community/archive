[
    {
        "content": "<p>I find the new <code>linter.hashCommand</code> really unfortunate. When running <code>#min_imports</code>, I now see<br>\n<a href=\"/user_uploads/3121/yZUuDF6ol_n7EM9qYmLjnnlr/image.png\">after</a><br>\n compared to<br>\n<a href=\"/user_uploads/3121/g1USDCRBOzXIJOBJw4nd16tY/image.png\">before</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/yZUuDF6ol_n7EM9qYmLjnnlr/image.png\" title=\"after\"><img data-original-dimensions=\"1409x115\" src=\"/user_uploads/thumbnail/3121/yZUuDF6ol_n7EM9qYmLjnnlr/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/g1USDCRBOzXIJOBJw4nd16tY/image.png\" title=\"before\"><img data-original-dimensions=\"1230x48\" src=\"/user_uploads/thumbnail/3121/g1USDCRBOzXIJOBJw4nd16tY/image.png/840x560.webp\"></a></div>",
        "id": 492165679,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736190395
    },
    {
        "content": "<p>Since <code>#</code> commands are noisy already, can we scrap the linter entirely?</p>",
        "id": 492165747,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736190426
    },
    {
        "content": "<p>I thought that the linter was already silent on <code>#</code>-commands that were noisy.</p>",
        "id": 492166046,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736190539
    },
    {
        "content": "<p>it also hits on <code>#check</code>, i believe</p>",
        "id": 492166076,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1736190556
    },
    {
        "content": "<p>Clearly not silent here <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 492166127,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736190577
    },
    {
        "content": "<p>Ok, something broke then, let me investigate.</p>",
        "id": 492166254,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736190616
    },
    {
        "content": "<p>Btw,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">return</span>\n</code></pre></div>\n<p>is a \"silent\" <code>#</code>-command.</p>",
        "id": 492166361,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736190661
    },
    {
        "content": "<p>And the linter is meant to catch <em>these</em>, not the ones that already emit some message.</p>",
        "id": 492166424,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736190685
    },
    {
        "content": "<p>It seems that the linter is no longer aware of the messages that have been printed.</p>",
        "id": 492167502,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191077
    },
    {
        "content": "<p>The linter works under these constraints:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">getLinterValue</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">hashCommand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getOptions</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">messages</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">warningAsError</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getOptions</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- we check that the module is either not in `test` or, is `test.HashCommandLinter`</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mod</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"ss\">`test</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"ss\">`test</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`HashCommandLinter</span><span class=\"o\">]))</span>\n<span class=\"w\">    </span><span class=\"k\">then</span>\n</code></pre></div>",
        "id": 492167592,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191103
    },
    {
        "content": "<p>The first, checks that the option is true -- good.<br>\nThe second checks that there are no emitted message -- this is the one that fails.<br>\nThe third makes sure that the linter always runs, if <code>warningAsError</code> is true -- irrelevant here, I think.<br>\nThe last makes the linter active outside of <code>test</code> (which should change to <code>MathlibTest</code> I think), but does work on the tests of the linter itself.</p>",
        "id": 492167888,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191209
    },
    {
        "content": "<p><a href=\"#narrow/channel/428973-nightly-testing/topic/Mathlib.20status.20updates/near/486087335\">This</a> is why the conversation here seemed already familiar.</p>",
        "id": 492168239,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191350
    },
    {
        "content": "<p>Ok, I have a fix, then!</p>",
        "id": 492168438,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191431
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20525\">#20525</a></p>",
        "id": 492168889,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736191589
    },
    {
        "content": "<p>The PR has been merged, so this issue should have been resolved: let me know if you still experience issues!</p>",
        "id": 492179497,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736195499
    },
    {
        "content": "<p>As a follow up, <a href=\"https://github.com/leanprover-community/mathlib4/pull/20529\">#20529</a> removes the doubly unnecessary workaround for the test files in the hashCommand linter.</p>",
        "id": 492179583,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736195523
    }
]