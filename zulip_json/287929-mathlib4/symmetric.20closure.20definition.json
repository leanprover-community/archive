[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> recently pointed out to me that the symmetric closure of a relation appears as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CompRel#doc\">docs#CompRel</a>. This is a leaf file with respect to Mathlib, but is used in the CGT repo (cc <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> ).</p>\n<p>This definition seems to be an outlier with respect to <code>TransGen</code> in core and other closures in <code>Mathlib.Logic.Relation</code> in terms of naming and its being a <code>Prop</code>-valued def versus an <code>inductive</code>. Especially if one were inclined to define the transitive symmetric closure, this is a bit awkward.</p>\n<p>My question is if adding  an inductive <code>SymmGen</code> to <code>Mathlib.Logic.Relation</code> makes sense, and if so should <code>CompRel</code> be deprecated in favor of this or just proven to be equivalent? There is also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IncompRel#doc\">docs#IncompRel</a> to consider here.</p>",
        "id": 569893353,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769279194
    },
    {
        "content": "<p>TransGen and ReflTransGen can (essentially) only really be defined as inductives, but the symmetric closure of a relation has a much simpler definition, so I think it's reasonable to use the simpler definition here (and doing induction on it is just the eliminator for Or!). The symmetric transitive closure should be the same as <code>TransGen (CompRel r)</code>. In particular, the transitive closure of a symmetric relation should be symmetric, with proof looking similar to <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Logic/Relation.html#Relation.ReflTransGen.symmetric\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Logic/Relation.html#Relation.ReflTransGen.symmetric</a></p>",
        "id": 569897089,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769282524
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Relation</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Relation</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">TransGen</span><span class=\"bp\">.</span><span class=\"n\">symmetric</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Symmetric</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Symmetric</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TransGen</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h3</span>\n</code></pre></div>\n<p>(<a href=\"https://github.com/leanprover-community/mathlib3/pull/2115\">the person who added</a> the ReflTransGen version to mathlib really should've done the TransGen one too...)</p>",
        "id": 569897383,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769282810
    },
    {
        "content": "<p>Added in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34382\">#34382</a></p>",
        "id": 569898207,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769283504
    },
    {
        "content": "<p>My primary concern here is with naming. Given <code>CompRel</code> is in a different module and doesn't follow the naming pattern, it's a bit hard to discover.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/287929-mathlib4/topic/symmetric.20closure.20definition/near/569897089\">said</a>:</p>\n<blockquote>\n<p>TransGen and ReflTransGen can (essentially) only really be defined as inductives, but the symmetric closure of a relation has a much simpler definition, so I think it's reasonable to use the simpler definition here (and doing induction on it is just the eliminator for Or!). </p>\n</blockquote>\n<p>This is true, I just wondered if this is consistent with how for instance <code>ReflGen</code> is an inductive and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.reflGen_iff#doc\">docs#Relation.reflGen_iff</a> is generated by <code>mk_iff</code>. I think it is nice when the constructor names are consistent.</p>\n<blockquote>\n<p>The symmetric transitive closure should be the same as <code>TransGen (CompRel r)</code>?</p>\n</blockquote>\n<p>Yes. I was wondering if this should follow the same pattern as the <code>simp</code> theorems <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.reflGen_transGen#doc\">docs#Relation.reflGen_transGen</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.transGen_reflGen#doc\">docs#Relation.transGen_reflGen</a>.</p>",
        "id": 569898376,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769283635
    },
    {
        "content": "<p>Yeah I agree the naming is a little weird in that context, though the other factor is that CompRel makes sense as the name in the context of order theory, in which case <code>CompRel (· ≤ ·)</code> gives the comparability relation, and calling that the symmetric closure feels a little strange? Perhaps it's not as bad though.</p>",
        "id": 569898662,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769283923
    },
    {
        "content": "<p>If it were just <code>CompRel</code> I'd be more confident in arguing to rename it, but stranding <code>IncompRel</code> would be awkward too...</p>",
        "id": 569898968,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769284189
    },
    {
        "content": "<p>Note there's also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AntisymmRel#doc\">docs#AntisymmRel</a></p>",
        "id": 569899038,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769284268
    },
    {
        "content": "<p>Yes, and there is API connecting them in <code>Mathlib.Order.Comparable</code>. If it is sufficient to just use <code>AntisymmRel</code> (which I guess is a question for CGT since <code>IncompRel</code> is not used elsewhere in Mathlib) then I would confidently argue to deprecate the module and rename <code>CompRel</code> to <code>Relation.SymmGen</code>.</p>",
        "id": 569899385,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769284619
    },
    {
        "content": "<p>I don't think it's sufficient to just use AntisymmRel, and in particular I think the TODO in the CompRel file should be applied and CompRel should be used to define IsChain</p>",
        "id": 569900010,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769285068
    },
    {
        "content": "<p>Hmm, I hadn't seen that. I can't think of a nice way (i.e. not involving duplicate definitions) to resolve the naming incongruity given these overlapping but distinct uses.</p>",
        "id": 569900842,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769285825
    },
    {
        "content": "<p>It seems that the conclusion here is that <code>CompRel</code> should be left as is. So if we want theorems like <code>ReflTransGen (CompRel r) = EqvGen r</code> (this is in CSLib at the moment) relating it to the other closures, it seems these should go into <code>Mathlib.Logic.Relation</code>? Maybe that helps a bit with discovery.</p>",
        "id": 569906384,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769292165
    },
    {
        "content": "<p>Yeah I think it's reasonable for that theorem to be in mathlib. I'm warming to the idea of renaming CompRel to SymmGen to be honest</p>",
        "id": 569906750,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769292572
    },
    {
        "content": "<p>Is the proposal to rename <code>CompRel</code> to <code>SymmGen</code>?</p>",
        "id": 569907043,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769292855
    },
    {
        "content": "<p>I don't really mind. At the moment this is not used anywhere, I mostly just added it for parity with <code>IncompRel</code>.</p>",
        "id": 569907069,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769292878
    },
    {
        "content": "<p>I have opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/34428\">#34428</a>, just renaming <code>CompRel</code>.</p>",
        "id": 570007328,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769401152
    },
    {
        "content": "<p>What's the purpose of the <code>Gen</code>(erator) token in these names? Should they instead be <code>ReflClosure</code>, <code>SymmClosure</code>, etc? Or are we willing to use <code>Gen</code> to mean <code>Closure</code> for brevity?</p>",
        "id": 570014096,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769406389
    },
    {
        "content": "<p>(to me Gen seems to be pointing out the definition happens to be inductive, but that's largely an implementation detail!)</p>",
        "id": 570014176,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769406446
    },
    {
        "content": "<p>I assume it was a decision made for consistency with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.TransGen#doc\">docs#Relation.TransGen</a>, which is in core.</p>",
        "id": 570014182,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769406456
    },
    {
        "content": "<p>Ah, I missed that core made the decision; though I suspect it was made long ago in Lean 3</p>",
        "id": 570014222,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769406499
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/287929-mathlib4/topic/symmetric.20closure.20definition/near/569907043\">said</a>:</p>\n<blockquote>\n<p>Is the proposal to rename <code>CompRel</code> to <code>Relation.SymmGen</code>?</p>\n</blockquote>\n<p>Given the PR seems to indicate yes, can interested parties <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span>/<span aria-label=\"minus\" class=\"emoji emoji-2796\" role=\"img\" title=\"minus\">:minus:</span>/<span aria-label=\"-1\" class=\"emoji emoji-1f44e\" role=\"img\" title=\"-1\">:-1:</span> this message to indicate if you are in favor?</p>",
        "id": 570014326,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769406574
    },
    {
        "content": "<p>So it looks like of those responding at this point, opinion ranges from neutral to in favor.</p>",
        "id": 570205450,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769469163
    },
    {
        "content": "<p>Again, I have no use for <code>CompRel</code>, so I don't mind what it's called.</p>",
        "id": 570207898,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769470520
    },
    {
        "content": "<p>I'm happy to go ahead with the rename given the above, hence removing the awaiting-zulip label from the PR</p>",
        "id": 570210839,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769472242
    },
    {
        "content": "<p>So is the thought that we rename <code>IncompRel</code> to <code>Relation.AsymmGen</code>? or similar?</p>",
        "id": 570409121,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769543381
    },
    {
        "content": "<p>that's not</p>",
        "id": 570409610,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769543536
    },
    {
        "content": "<p>no</p>",
        "id": 570409614,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769543537
    },
    {
        "content": "<p><code>r a b</code> doesn't imply <code>IncompRel r a b</code></p>",
        "id": 570409707,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769543568
    },
    {
        "content": "<p>so it's not anything <code>Gen</code></p>",
        "id": 570409733,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769543577
    },
    {
        "content": "<p>It would be consistent naming-wise, but odd mathematically. If you interpret it as a closure, it's saying to discard the relation, not something we usually give a name.</p>",
        "id": 570413054,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769544653
    },
    {
        "content": "<p>I guess the point here is that there are two concepts (symmetric closure and comparability) that happen to coincide definitionally but is awkward for the negation.</p>",
        "id": 570413640,
        "sender_full_name": "Chris Henson",
        "timestamp": 1769544842
    },
    {
        "content": "<p>Yes I agree with Chris, no further renames are necessary: \"symmetric closure\" and \"comparability relation\" happen to be the same informal name for the same concept used in different areas. But <code>IncompRel</code>/<code>AntisymmRel</code> and <code>TransGen</code>/<code>ReflTransGen</code> don't really have analogues on the other side. So we have this slightly odd inconsistency between <code>SymmGen</code> and <code>IncompRel</code>, but it's less odd than the old <code>CompRel</code>/<code>TransGen</code>, and Chris' change makes all of these concepts more discoverable and more closely linked, and so imo no further action is needed</p>",
        "id": 570443299,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1769557296
    }
]