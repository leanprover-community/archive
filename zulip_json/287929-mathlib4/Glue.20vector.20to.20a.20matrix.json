[
    {
        "content": "<p>What is the idiomatic way to glue a vector <code>v</code> to a matrix <code>A</code> please?<br>\nOriginally I used</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">fromRows</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">row</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but it turned out to be hard to work with.</p>\n<p>I hope there is something like <code>​Matrix.of (Matrix.vecCons v A)</code> but in one definition.<br>\nDid I overlook it?</p>",
        "id": 482120833,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731488428
    },
    {
        "content": "<p>Can you give a mwe of the function you want to exist? Are you using <code>Fin</code>-indexed or <code>Type</code>-indexed matrices?</p>",
        "id": 482122855,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489069
    },
    {
        "content": "<p>I'm not sure. I'd prefer <code>Type</code>-indexed matrices, but I will use what Mathlib has better support for.</p>",
        "id": 482123017,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489123
    },
    {
        "content": "<p>For example, is there a more idiomatic way to write the following?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 482123466,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489252
    },
    {
        "content": "<p>I think that's the preferred spelling for <code>Fin m.succ</code>, and the one above is the preferred spelling for <code>Sum m Unit</code></p>",
        "id": 482123582,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489300
    },
    {
        "content": "<p>I suppose you could ask for an <code>Option m</code>-valued version</p>",
        "id": 482123614,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489313
    },
    {
        "content": "<p>Which of those three choices is appropriate depends on what you want to do with the matrix</p>",
        "id": 482123726,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489352
    },
    {
        "content": "<p>I guess I shouldn't have literally <code>Matrix.of (Matrix.vecCons v A)</code> in my theorem statement, right?</p>",
        "id": 482123820,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489368
    },
    {
        "content": "<p>Or <code>Matrix.fromRows A (Matrix.row Unit v)</code></p>",
        "id": 482123946,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489405
    },
    {
        "content": "<p>I want to work with determinants, but I also want to use the resulting matrix in other block matrices.</p>",
        "id": 482123994,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489416
    },
    {
        "content": "<p>I guess the <code>Fin m.succ</code> version will be best for me because I can do the Laplacian expansion of the determinant then.</p>",
        "id": 482124178,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489479
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.det_succ_row#doc\">docs#Matrix.det_succ_row</a></p>",
        "id": 482124255,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489494
    },
    {
        "content": "<p>And perhaps it is best to first have the extra row and then the original matrix because:<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.det_succ_row_zero#doc\">docs#Matrix.det_succ_row_zero</a></p>",
        "id": 482124504,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489578
    },
    {
        "content": "<p>My question is what can I use in place of <code>Matrix.of (Matrix.vecCons v A)</code> so that it preserves the intention but has nicer API.</p>",
        "id": 482124779,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731489657
    },
    {
        "content": "<p>I think the answer in mathlib is \"use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.updateColumn#doc\">docs#Matrix.updateColumn</a> instead\"</p>",
        "id": 482125352,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489841
    },
    {
        "content": "<p>Eg, see how we define the cramer matrix by replacing a column/row with zeros and 1s, instead of removing it entirely</p>",
        "id": 482125504,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489882
    },
    {
        "content": "<p>So I think this is an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> problem, where you're asking how to do some pen-and-paper maths in a generic way (type indices) with a nice API, and the answer is possibly \"don't do it the pen and paper way\"</p>",
        "id": 482125685,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489946
    },
    {
        "content": "<p>Presumably the glueing is an intermediate construction in a larger proof, and not part of your final statement?</p>",
        "id": 482125835,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731489987
    },
    {
        "content": "<p>Yes and no.<br>\nMost of the time, it is indeed just an intermediate construction in a larger proof.<br>\nHowever, there will be a place where something like that will appear in the final theorem, because we will be proving things about a binary matroid defined via this matrix:<br>\n<a href=\"https://github.com/Ivan-Sergeyev/seymour/blob/0c8aa3de8a0cf14112e7154a8e853415e63642b5/Seymour/EasyDirection.lean#L118\">https://github.com/Ivan-Sergeyev/seymour/blob/0c8aa3de8a0cf14112e7154a8e853415e63642b5/Seymour/EasyDirection.lean#L118</a></p>",
        "id": 482127254,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731490397
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Glue.20vector.20to.20a.20matrix/near/482123614\">said</a>:</p>\n<blockquote>\n<p>I suppose you could ask for an <code>Option m</code>-valued version</p>\n</blockquote>\n<p>Indexing rows by <code>Option</code> would be nice, but would then Laplacian expansion of a determinant even make sense in such a setting?</p>",
        "id": 482429730,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1731600804
    }
]