[
    {
        "content": "<p>Do we have something like the following <code>#in_module</code> to simulate being within Mathlib when testing Mathlib-only behavior in MathlibTest? (If not, should we?)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#in_module \"</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"n\">cmd</span><span class=\"o\">:</span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">withEnv</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">setMainModule</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">elabCommandTopLevel</span><span class=\"w\"> </span><span class=\"n\">cmd</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#command_which_violates_mathlib_style\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainModule</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getRoot</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"I shouldn't be used in Mathlib!\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">in_module</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Foo</span>\n<span class=\"sd\">/-- warning: I shouldn't be used in Mathlib! -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">command_which_violates_mathlib_style</span>\n</code></pre></div>\n<p>I could have sworn there was a thread about this very thing at one point, but I can no longer find it.</p>",
        "id": 533604873,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1754778147
    },
    {
        "content": "<p>The only mathlib specific thing I think is the <code>linter.style.header</code> linter. Everything else is <code>linter.mathlibStandardSet</code> and other options in the lakefile.</p>",
        "id": 533606647,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754780596
    },
    {
        "content": "<p>So I don't think there's a reason to change the module name (just set the relevant options)</p>",
        "id": 533606694,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754780662
    },
    {
        "content": "<p>Ah, okay. I’m deprecating some syntax (only) within mathlib by modifying its elaboration, and I suppose the real takeaway here is that metaprograms generally should not check if they are in Mathlib (unless necessary to the actual function of the program), and should instead check or introduce a mathlib-specific option in case downstream projects want to maintain mathlib standards.</p>",
        "id": 533606927,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1754780962
    }
]