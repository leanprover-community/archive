[
    {
        "content": "<p>What is the best way to express that a <code>LinearMap</code> (or in my case, a <code>ContinuousLinearMap</code>) has finite rank? Options include:</p>\n<ul>\n<li><code>Module.rank R â†¥(LinearMap.range T) &lt; Cardinal.aleph0</code></li>\n<li><code>FiniteDimensional â†¥(LinearMap.range T)</code></li>\n<li><code>LinearMap.rank T &lt; Cardinal.aleph0</code></li>\n</ul>\n<p>As a second question, what's the best way to actually get that rank as a natural number, if it exists? Options include:</p>\n<ul>\n<li><code>T.rank.toNat</code></li>\n<li><code>Module.finrank R â†¥(LinearMap.range T)</code></li>\n</ul>",
        "id": 536880530,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756518778
    },
    {
        "content": "<p>What I would do: <code>FiniteDimensional</code> and <code>Module.finrank</code> (and I'd avoid cardinals in general)</p>",
        "id": 536897659,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756539688
    },
    {
        "content": "<p>The main disadvantage of that is it depends on a CoeSort</p>",
        "id": 536897704,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756539763
    },
    {
        "content": "<p>I did implicitly use cardinals here <a class=\"message-link\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/Singular.20Value.20Decomposition/near/536295632\">#Is there code for X? &gt; Singular Value Decomposition @ ðŸ’¬</a> . Would you recommend replacing <code>S.rank â‰¤ â†‘n</code> with the conjunction of <code>FiniteDimensional R (LinearMap.range S)</code> and <code>Module.finrank R (LinearMap.range S) â‰¤ n</code>?</p>",
        "id": 536897838,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756539943
    },
    {
        "content": "<p>I guess what's unclear to me is that if we aren't supposed to use Cardinal for non set-theory-heavy things, then what's the use of <code>LinearMap.rank</code> at all?</p>",
        "id": 536898026,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756540150
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/channel/287929-mathlib4/topic/How.20to.20express.20a.20linear.20map.20has.20finite.20rank.3F/near/536897704\">said</a>:</p>\n<blockquote>\n<p>The main disadvantage of that is it depends on a CoeSort</p>\n</blockquote>\n<p>I've been wanting to add <code>Submodule.finrank</code> to dodge this precise issue. Feel free to do so!</p>",
        "id": 536900236,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1756542712
    },
    {
        "content": "<p>I have no idea what the point of LinearMap.rank is and to be quite honest I'm not that clear about what the point of cardinals are at least in the area of maths I work in. There's the naturals, countably infinite (typically used for counting, not dimension), and \"other\" as far as I'm concerned.</p>",
        "id": 536908478,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756553959
    },
    {
        "content": "<p>Now that we have more API for <code>ENat</code> it could make sense to have <code>Module.erank</code> too.</p>",
        "id": 536912980,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756558320
    },
    {
        "content": "<p>This is always my instinct, but with cyclotomic fields people were saying \"oh we have API for PNat now, let's use that\" and two years later it all got refactored back to Nat.</p>",
        "id": 536917316,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756563084
    },
    {
        "content": "<p>I think having a spurious value is less of an issue than missing a value and overusing an existing one in its place.</p>",
        "id": 536920202,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756566077
    },
    {
        "content": "<p>As far as I understand, so far, we have:</p>\n<ul>\n<li><code>Module.rank</code> Module -&gt; Cardinal</li>\n<li><code>Module.finrank</code> Module -&gt; Nat</li>\n<li><code>FiniteDimensional</code> (aka <code>Module.Finite</code>) Module -&gt; Prop</li>\n<li><code>LinearMap.rank</code> LinearMap -&gt; Cardinal</li>\n<li><code>Submodule.FG</code> Submodule -&gt; Prop</li>\n</ul>\n<p>And in this thread the following have been proposed:</p>\n<ul>\n<li><code>Submodule.finrank</code> Submodule -&gt; Nat</li>\n<li><code>Module.erank</code> Module -&gt; ENat</li>\n</ul>\n<p>It seems to me that there's 12 possible combinations: <code>[Module|Submodule|LinearMap].[rank|nrank|enrank|FiniteDimensional]</code>. How do we decide which ones we want? Plus, I think <code>Module.finrank</code> is inconsistent with the <code>Set.card</code>/<code>Set.ncard</code>/<code>Set.encard</code> naming convention.</p>",
        "id": 536930135,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756576290
    },
    {
        "content": "<p>Is it fine if I do developments with <code>Module.rank</code> for now until there's a good enough alternative to express things like \"Linear map T is finite dimensional and has rank &lt;= n\" without a conjunction?</p>",
        "id": 536930266,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756576435
    },
    {
        "content": "<p>One option would be to make <code>rank</code> generic by adding something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nrank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">enrank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">toENat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FiniteRank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">aleph0</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nrank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">enrank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">toENat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FiniteRank</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">aleph0</span>\n</code></pre></div>\n<p>(maybe only for <code>Submodule</code> and <code>LinearMap</code>, because I don't know if this can be set up for <code>Module</code>)</p>",
        "id": 536930682,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756576876
    },
    {
        "content": "<p>I'm worried this might make things more complicated, or not interact properly with Modules that aren't vector spaces or for which the field needs to be specified explicitly. I'm also not sure the benefit is really that great.</p>",
        "id": 536930878,
        "sender_full_name": "Niels Voss",
        "timestamp": 1756577031
    },
    {
        "content": "<p>I find that using the <code>Nat</code>-valued quantities is easier in practice, even though it makes the generic theory a bit messier to state</p>",
        "id": 536936354,
        "sender_full_name": "Artie Khovanov",
        "timestamp": 1756583232
    },
    {
        "content": "<p>I think that attempting to make <code>Cardinal</code> usable will inevitably run into the same issues as making PNat and ENat usable -- you might make 100 lemmas for them but Nat has thousands of lemmas and <code>omega</code> so you will never compete.</p>",
        "id": 536971790,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756634308
    }
]