[
    {
        "content": "<p>I was on my way to prove Bezout's Lemma for Positive Naturals (PNat):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Bézout's lemma: given x y : ℕ, gcd x y = x * a + y * b, where a = gcd_a x y and</span>\n<span class=\"c1\">-- b = gcd_b x y are computed by the extended Euclidean algorithm</span>\n\n<span class=\"kn\">example</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"bp\">+</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsCoprime</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">*</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>But then I get:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>failed to synthesize\n  CommSemiring ℕ+\nAdditional diagnostic information may be available using the `set_option diagnostics true` command.\n</code></pre></div>\n<p>Now, trying to show that this holds, I opened this block from the implementation for Nat:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">PNat</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instCommSemiring</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"bp\">+</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- instSemiring</span>\n<span class=\"w\">  </span><span class=\"bp\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- instCommMonoid</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">PNat</span>\n</code></pre></div>\n<p>But before starting I only get the error:<br>\n<code>expected structure</code><br>\nWhat does this mean?<br>\nIs is feasible to create this instance somehow?</p>",
        "id": 487347735,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1733867723
    },
    {
        "content": "<p>It means that <code>sorry</code> is not a structure</p>",
        "id": 487348324,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868017
    },
    {
        "content": "<p>The <code>__</code> notation only works if you already know what type it is going to be</p>",
        "id": 487348367,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868033
    },
    {
        "content": "<p>So <code>__  : Semiring  ℕ+  := sorry</code> would avoid the error...</p>",
        "id": 487348453,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868076
    },
    {
        "content": "<p>... but you're going to be stuck anyway, because there is no <code>0 : ℕ+</code></p>",
        "id": 487348494,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868104
    },
    {
        "content": "<p>I suspect the right answer here is to weaken <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCoprime#doc\">docs#IsCoprime</a> to require <code>[AddSemigroup R] [Monoid R]</code> or something</p>",
        "id": 487348688,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868205
    },
    {
        "content": "<p>Ok, but then we could argue that another definition of being coprime could be created for PNat without the need of CommSemiring right</p>",
        "id": 487348704,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1733868214
    },
    {
        "content": "<p>Right, but usually it's better to generalize an existing definition to work for more situations than just duplicate the definition</p>",
        "id": 487348980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868344
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Create.20instance.20.60CommSemiring.20.E2.84.95.2B.60.2C.20.20err.20.60expected.20structure.60/near/487348688\">said</a>:</p>\n<blockquote>\n<p>I suspect the right answer here is to weaken <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCoprime#doc\">docs#IsCoprime</a> to require <code>[AddSemigroup R] [Monoid R]</code> or something</p>\n</blockquote>\n<p>Do you have any examples of such process of weakening that I can take a look at? It'd help a lot!</p>",
        "id": 487349108,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1733868392
    },
    {
        "content": "<p>I talked a little bit about this <a href=\"https://eric-wieser.github.io/brown-2024/seminar.html#/generalization-easy\">last week</a>, the slides after that have some examples</p>",
        "id": 487349229,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733868462
    },
    {
        "content": "<p>FYI, this is the proof I'm trying to formalize:<br>\n<a href=\"/user_uploads/3121/9HPdXJ_NLbY4leM4KF_UUhYt/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/9HPdXJ_NLbY4leM4KF_UUhYt/image.png\" title=\"image.png\"><img data-original-dimensions=\"1241x750\" src=\"/user_uploads/thumbnail/3121/9HPdXJ_NLbY4leM4KF_UUhYt/image.png/840x560.webp\"></a></div><p>Taken from the book <a href=\"https://www.cambridge.org/core/books/type-theory-and-formal-proof/0472640AAD34E045C7F140B46A57A67C\">Type Theory and Formal Proof</a></p>",
        "id": 487349430,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1733868550
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Create.20instance.20.60CommSemiring.20.E2.84.95.2B.60.2C.20.20err.20.60expected.20structure.60/near/487349229\">said</a>:</p>\n<blockquote>\n<p>I talked a little bit about this <a href=\"https://eric-wieser.github.io/brown-2024/seminar.html#/generalization-easy\">last week</a>, the slides after that have some examples</p>\n</blockquote>\n<p>Oh wow, fancy slides <span aria-label=\"star struck\" class=\"emoji emoji-1f929\" role=\"img\" title=\"star struck\">:star_struck:</span></p>",
        "id": 487349615,
        "sender_full_name": "Bernardo Borges",
        "timestamp": 1733868650
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671510\">@Bernardo Borges</span> just work in integers and add the hypothesis that they're positive. Surely you believe that if m and n are positive integers then the statements \"m and n are coprime, when regarded as positive integers\" and \"m and n are coprime, when regarded as integers\" are mathematically equivalent. But mathlib has a stupid definition of coprime in the sense that it make sense in far more generality than is mathematically meaningful. For example the natural numbers 2 and 3 are <em>not</em> coprime when regarded as natural numbers, as far as mathlib is concerned (go to the source code for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCoprime#doc\">docs#IsCoprime</a> and see why). So either avoid <code>IsCoprime</code> or avoid natural numbers. If you use both then you will get pathologies.</p>",
        "id": 487350776,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733869348
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Coprime</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsCoprime</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">    </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">    </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">    </span><span class=\"n\">cases'</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">    </span><span class=\"n\">ring_nf</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_right_eq_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_eq_zero</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">one_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false_and</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">one_add_one_eq_two</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"bp\">|</span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">exacts</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">⟩</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 487351085,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1733869509
    },
    {
        "content": "<p>[told you]</p>",
        "id": 487351126,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733869540
    },
    {
        "content": "<p>The above should be in Mathlib and <code>@[simp]</code></p>",
        "id": 487352220,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733870138
    },
    {
        "content": "<p><code>isCoprime_one_left</code> and <code>isCoprime_one_right</code> make the second branch idealogically shorter</p>",
        "id": 487352372,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733870206
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Create.20instance.20.60CommSemiring.20.E2.84.95.2B.60.2C.20.20err.20.60expected.20structure.60/near/487352220\">said</a>:</p>\n<blockquote>\n<p>The above should be in Mathlib and <code>@[simp]</code></p>\n</blockquote>\n<p>So people discover more quickly that <code>IsCoprime</code> and <code>Nat</code> combine badly?</p>",
        "id": 488016303,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733893350
    },
    {
        "content": "<p>Yes, exactly</p>",
        "id": 488020222,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733895947
    },
    {
        "content": "<p>But also, the RHS seems obviously simpler than the LHS to me, which seems like the metric that matters.</p>",
        "id": 488020453,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733896047
    },
    {
        "content": "<p><code>swap(LHS,RHS)</code> in <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span> ?</p>",
        "id": 488042226,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1733906135
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Create.20instance.20.60CommSemiring.20.E2.84.95.2B.60.2C.20.20err.20.60expected.20structure.60/near/487350776\">said</a>:</p>\n<blockquote>\n<p>For example the natural numbers 2 and 3 are <em>not</em> coprime when regarded as natural numbers, as far as mathlib is concerned (go to the source code for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCoprime#doc\">docs#IsCoprime</a> and see why).</p>\n</blockquote>\n<p>Fun fact: 2 and 3 generate the unique maximal ideal of ℕ, and you can show ℕ is a <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/LocalRing/Defs.html#LocalRing\">LocalRing</a> according to mathlib.</p>",
        "id": 488050017,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733908613
    },
    {
        "content": "<p>Funnily enough I was just concluding that in <a href=\"#narrow/channel/345428-mathlib-reviewers/topic/maintainer.20merge.3A.20t-algebra/near/487356716\">another thread</a>...</p>",
        "id": 488052362,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733909337
    },
    {
        "content": "<p>I first mentioned this <a href=\"https://github.com/leanprover-community/mathlib4/pull/18891#issuecomment-2498482329\">here</a>. I didn't realize so many stuff (including structure sheaf) generalizes to commutative semirings. I have a question about noncommutative local semirings <a href=\"https://math.stackexchange.com/questions/5004383/semiring-with-a-unique-left-ideal\">here</a> if anyone is interested :)</p>",
        "id": 488054762,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1733910105
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Create.20instance.20.60CommSemiring.20.E2.84.95.2B.60.2C.20.20err.20.60expected.20structure.60/near/487352220\">said</a>:</p>\n<blockquote>\n<p>The above should be in Mathlib and <code>@[simp]</code></p>\n</blockquote>\n<p>PR'd as <a href=\"https://github.com/leanprover-community/mathlib4/pull/20569\">#20569</a></p>",
        "id": 492540313,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736353916
    }
]