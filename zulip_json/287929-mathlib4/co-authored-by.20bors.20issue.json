[
    {
        "content": "<p>It seems that <code>Co-authored-by:</code> lines in the main PR text are not being placed in the right spot in the commits created by bors <span aria-label=\"frustration\" class=\"emoji emoji-1fae4\" role=\"img\" title=\"frustration\">:frustration:</span> either that, or I'm missing something about how this works in GitHub?</p>\n<p>The context is the following merged PRs which have me as coauthor: <a href=\"https://github.com/leanprover-community/mathlib4/pull/26853\">#26853</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/26852\">#26852</a> <a href=\"https://github.com/leanprover-community/mathlib4/pull/26807\">#26807</a></p>\n<p>as you can see Oliver did write the \"Co-authored-by\" line, but the commits pushed to master do not show me as coauthor (like, nicely with the two profile pictures in the interface <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span>). It seems to be working for other PRs when the coauthor sends some message in the PR thread like a review</p>",
        "id": 531454363,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753734007
    },
    {
        "content": "<p>That's odd, because it does seem to be in the right spot on the commit: <a href=\"https://github.com/leanprover-community/mathlib4/commit/737d0422c5185dd0fa7f37adbf178b493b037099\">https://github.com/leanprover-community/mathlib4/commit/737d0422c5185dd0fa7f37adbf178b493b037099</a></p>",
        "id": 531460635,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753736207
    },
    {
        "content": "<p>I hope it's not github being weird about the number of empty lines</p>",
        "id": 531460839,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753736285
    },
    {
        "content": "<p>Is the email shown there the same as your email in GitHub?</p>",
        "id": 531460853,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753736294
    },
    {
        "content": "<p>I saw that, and I double checked that my email is verified (in fact, it's the one shown in my profile there)</p>",
        "id": 531460885,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753736304
    },
    {
        "content": "<p><a href=\"https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors#creating-co-authored-commits-on-the-command-line\">Here's GitHub's help page on the co-authored lines</a>. They do warn against putting in blank lines, though they don't explicitly say that that will cause some coauthors to be dropped:</p>\n<blockquote>\n<p>If you're adding multiple co-authors, give each co-author their own line and <code>Co-authored-by:</code> commit trailer. Do not add blank lines between each co-author line.</p>\n</blockquote>",
        "id": 531461332,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753736454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/co-authored-by.20bors.20issue/near/531460839\">said</a>:</p>\n<blockquote>\n<p>I hope it's not github being weird about the number of empty lines</p>\n</blockquote>\n<p>it's very odd, because this one <a href=\"https://github.com/leanprover-community/mathlib4/commit/bca1e1d88a213e8d3ee33b1742f136dc232659cc\">https://github.com/leanprover-community/mathlib4/commit/bca1e1d88a213e8d3ee33b1742f136dc232659cc</a> looks no different from <a href=\"https://github.com/leanprover-community/mathlib4/commit/2a234c6631d737f8d8ab5886b9599016c97d1b62\">https://github.com/leanprover-community/mathlib4/commit/2a234c6631d737f8d8ab5886b9599016c97d1b62</a> and yet it doesn't work</p>",
        "id": 531461416,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753736484
    },
    {
        "content": "<p>That is indeed strange. I can't think of anything else. Maybe you can try GitHub's \"noreply\" email next time just in case there's still some issue with the email?</p>\n<p>Otherwise I would try writing to GitHub support - it may take a few weeks for them to respond though.</p>",
        "id": 531462435,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753736839
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span>  one possibility: <code>git show -s --format=%B bca1e1d88</code> locally shows that in Oliver's commit, there are a lot of trailing whitespace, and in the one that works, there is just one newline at the end</p>",
        "id": 531462528,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753736869
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/5IZhI3U2GvFfyEEdQu_C98QS/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5IZhI3U2GvFfyEEdQu_C98QS/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2487x1105\" src=\"/user_uploads/thumbnail/3121/5IZhI3U2GvFfyEEdQu_C98QS/image.png/840x560.webp\"></a></div>",
        "id": 531462736,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753736940
    },
    {
        "content": "<p>this may be it</p>",
        "id": 531462776,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753736954
    },
    {
        "content": "<p>the other commits that don't work also have a lot of whitespace before other \"co-authored-by\" automatically inserted by bors</p>",
        "id": 531463045,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753737060
    },
    {
        "content": "<p>bors is supposed to take everything above the <code>---</code> in the PR comment and turn it into the commit message. It looks like there are only two newlines before <code>---</code> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26848\">#26848</a> though, so it's possible there's something wrong with that functionality. I guess you could also try deleting <code>---</code> and everything below in the PR comment next time, maybe that will make a difference? </p>\n<p>Unfortunately bors itself is no longer under development, so if there is some bug, we may have to figure out how to fix it ourselves in <a href=\"https://github.com/robertylewis/bors-ng\">our fork</a>.</p>",
        "id": 531463780,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753737342
    },
    {
        "content": "<p>perhaps bors could be made to strip the whitespace, <del>but it still can insert some \"Used by: <a href=\"https://github.com/leanprover-community/mathlib4/pull/26810\">#26810</a>\" after the coauthored line and I'm not sure if this also breaks it</del> oops, sorry, it was Oliver who wrote this line</p>",
        "id": 531464396,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753737630
    },
    {
        "content": "<p>Ok, it seems that stripping the whitespace could be a solution then. If I find how to do it, perhaps I can send a pr to <code>bors-ng</code>?</p>",
        "id": 531464866,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753737820
    },
    {
        "content": "<p>well, I'm not sure if this bothers me to the point that it prompts me to install elixir and fix it</p>",
        "id": 531466145,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753738354
    },
    {
        "content": "<p>I will ask oliver to create some empty commit with me as author next time instead of using the PR text. but mathlib's PR instructions should be updated because what it instructs does not work</p>\n<p><a href=\"https://raw.githubusercontent.com/leanprover-community/mathlib4/refs/heads/master/.github/PULL_REQUEST_TEMPLATE.md\">https://raw.githubusercontent.com/leanprover-community/mathlib4/refs/heads/master/.github/PULL_REQUEST_TEMPLATE.md</a></p>",
        "id": 531466394,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753738460
    },
    {
        "content": "<p>I did some digging in mathlib4's commits and it looks like the issue has been with us since at least 2022: cf. <a href=\"https://github.com/leanprover-community/mathlib4/pull/237\">#237</a> and <a href=\"https://github.com/leanprover-community/mathlib4/commit/6f904dee0871b8534da7ebe89e613892721adb05\">associated commit</a>. This also proves that my various suggestions above are wrong -- to fix this we will unfortunately need to look more closely at what bors is doing.</p>",
        "id": 531473374,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753741751
    },
    {
        "content": "<p>Would it help if meanwhile the template instructed to add an empty commit instead of using the commit message? like this:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">- To indicate co-authors, include lines at the bottom of the commit message</span>\n<span class=\"gd\">- (that is, before the `---`) using the following format:</span>\n\n<span class=\"gd\">- Co-authored-by: Author Name &lt;author@email.com&gt;</span>\n\n<span class=\"gi\">+ To indicate co-authors, include at least one commit authored by each co-author</span>\n<span class=\"gi\">+ among the commits in the pull request. If necessary, create empty commits to</span>\n<span class=\"gi\">+ indicate co-authorship, like so:</span>\n\n<span class=\"gi\">+ git commit --author=\"Author Name &lt;author@email.com&gt;\" --allow-empty -m \"add Author Name as coauthor\"</span>\n\n<span class=\"gi\">+ When merging, all the commits will be squashed into a single commit listing all co-authors.</span>\n</code></pre></div>",
        "id": 531479378,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753744974
    },
    {
        "content": "<p>relevant <code>bors-ng</code> source:</p>\n<p><a href=\"https://github.com/robertylewis/bors-ng/blob/7c57469b9d8588cb3bb3d53c1d7a76057b7f8107/lib/worker/batcher/message.ex#L195-L200\">https://github.com/robertylewis/bors-ng/blob/7c57469b9d8588cb3bb3d53c1d7a76057b7f8107/lib/worker/batcher/message.ex#L195-L200</a></p>",
        "id": 531482629,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753746777
    },
    {
        "content": "<p>Sure, feel free to open a PR to the <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.github/PULL_REQUEST_TEMPLATE.md?plain=1\">pull request template</a> and I'll merge it.</p>",
        "id": 531492194,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753752660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span>: <a href=\"https://github.com/leanprover-community/mathlib4/pull/27618\">#27618</a></p>",
        "id": 531493255,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753753392
    },
    {
        "content": "<p>Did we determine if GitHub is behaving to-spec by ignoring these trailers in the presence of whitespace?</p>",
        "id": 531683771,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1753817228
    },
    {
        "content": "<p>I don't know that there's a spec, but <a href=\"https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors#creating-co-authored-commits-on-the-command-line\">GitHub's help page</a> doesn't say anything about empty lines after the \"Co-authored-by\" lines. Lua's commits and the example from <a href=\"https://github.com/leanprover-community/mathlib4/pull/237\">#237</a> seem to show that GitHub won't show the icon if extra lines are present though.</p>",
        "id": 531684701,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1753817560
    },
    {
        "content": "<p>From what I could find there is no official Git spec for the <code>Co-authored-by</code>, it seems to be a convention made by GitHub</p>",
        "id": 531684722,
        "sender_full_name": "Lua Viana Reis",
        "timestamp": 1753817566
    },
    {
        "content": "<p>It would be easy to have CI check that a PR description has the right form. Can somebody summarise for me what the exact requirements are, then I can try to write one.</p>",
        "id": 531766695,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753859941
    },
    {
        "content": "<p>(If you want to write that check yourself, be my guest - I'm also happy to review that!)</p>",
        "id": 531766854,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1753859990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/co-authored-by.20bors.20issue/near/531766695\">said</a>:</p>\n<blockquote>\n<p>It would be easy to have CI check that a PR description has the right form. </p>\n</blockquote>\n<p>In the context of coauthors, the issue is that bors doesn't take notice of coauthors listed in the commit message, as seen in the <a href=\"https://github.com/robertylewis/bors-ng/blob/7c57469b9d8588cb3bb3d53c1d7a76057b7f8107/lib/worker/batcher/message.ex#L195-L200\">code linked above</a>, coauthors are sourced from the commits and then listed in the new commit message.</p>",
        "id": 531768793,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1753860637
    },
    {
        "content": "<p>If there is a CI check for PR description, this is an issue that I encountered previously:<br>\n<code>- [ ] depends on: </code> works but <code>* [ ] depends on: </code> doesn't work even thought both display identically in markdown (and so took a while for me to figure out the issue).</p>",
        "id": 531769821,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1753860973
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/channel/287929-mathlib4/topic/co-authored-by.20bors.20issue/near/531768793\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/287929-mathlib4/topic/co-authored-by.20bors.20issue/near/531766695\">said</a>:</p>\n<blockquote>\n<p>It would be easy to have CI check that a PR description has the right form. </p>\n</blockquote>\n<p>In the context of coauthors, the issue is that bors doesn't take notice of coauthors listed in the commit message, as seen in the <a href=\"https://github.com/robertylewis/bors-ng/blob/7c57469b9d8588cb3bb3d53c1d7a76057b7f8107/lib/worker/batcher/message.ex#L195-L200\">code linked above</a>, coauthors are sourced from the commits and then listed in the new commit message.</p>\n</blockquote>\n<p>No, that's not the issue here. The Co-authored-by lines were in the PR description, and did end up in the final commit message, but github is ignoring them</p>",
        "id": 531783420,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753864889
    },
    {
        "content": "<p>I've just deployed a potential fix for this issue in our fork of bors. Here's the relevant code, which should strip out all the unnecessary extra empty lines that were confusing GitHub:</p>\n<p><a href=\"https://github.com/robertylewis/bors-ng/blob/6ddf68711c86c2e33e8c5daaedd024527ba5bf5b/lib/worker/batcher/message.ex#L201-L208\">https://github.com/robertylewis/bors-ng/blob/6ddf68711c86c2e33e8c5daaedd024527ba5bf5b/lib/worker/batcher/message.ex#L201-L208</a></p>\n<p>(See also <a href=\"https://github.com/robertylewis/bors-ng/blob/6ddf68711c86c2e33e8c5daaedd024527ba5bf5b/test/batcher/message_test.exs#L318\">test case</a>).</p>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"571941\">@Lua Viana Reis</span>  for the report and for tracking down the broken function in the source!</p>",
        "id": 536137752,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1756172819
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/31030\">#31030</a> adding back the instructions for adding co-authors via \"Co-authored-by\" lines in the PR message.</p>",
        "id": 547576178,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761680680
    }
]