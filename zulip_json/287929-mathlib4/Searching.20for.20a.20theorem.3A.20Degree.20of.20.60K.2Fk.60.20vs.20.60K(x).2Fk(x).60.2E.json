[
    {
        "content": "<p>Hi everyone,</p>\n<p>I wanted to know if the following theorem is in Mathlib in some form :<br>\nIf <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mi mathvariant=\"normal\">/</mi><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">K/k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> is a finite extension of degree <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> then so is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mi>k</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">K(x)/k(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>. <br>\nSee <a href=\"https://math.stackexchange.com/questions/4581/why-does-k-leadsto-kx-preserve-the-degree-of-field-extensions/\">here</a> for example.</p>\n<p>I could not find it after searching for a little while.<br>\nThanks!<br>\nXavier</p>",
        "id": 498335490,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1738933244
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> FiniteDimensional, RatFunc</p>",
        "id": 498371877,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1738943720
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/FunctionField.html#functionField_iff\">functionField_iff</a></p>",
        "id": 498371881,
        "sender_full_name": "loogle",
        "timestamp": 1738943721
    },
    {
        "content": "<p>Probably not there?</p>",
        "id": 498372121,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1738943792
    },
    {
        "content": "<p>This is also known as <a href=\"https://stacks.math.columbia.edu/tag/0G1M\">stacks#0G1M</a> and it's essentially saying that k(x) and K are linearly disjoint over k in K(x), see e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IntermediateField.LinearDisjoint.linearIndependent_left#doc\">docs#IntermediateField.LinearDisjoint.linearIndependent_left</a>. <br>\nI think it's true and (it would be interesting to prove) that K(x) is in fact isomorphic to the tensor product of k(x) and K over k. (For this you only need that K/k is algebraic; it's interesting to think how this works under the bases of the rational function fields given by partial fractions.) Since K(x) is a field this would imply k(x) and K are \"absolutely\" linearly disjoint over k (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IntermediateField.LinearDisjoint.of_isField%27#doc\">docs#IntermediateField.LinearDisjoint.of_isField'</a>).<br>\ncc <span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span></p>",
        "id": 498372437,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738943898
    },
    {
        "content": "<p>We know that <code>k[X] ⊗[k] K ≃ K[X]</code> and therefore <code>k(X) ⊗[k] K ≃ (k[X]\\0)⁻¹k(X) ⊗[k] K ≃ (k[X]\\0)⁻¹K[X]</code>. But the RHS is just <code>K(X)</code> because every nonzero polynomial in K[X] divides a nonzero polynomial in k[X] if K/k is algebraic: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Irreducible.exists_dvd_monic_irreducible_of_isIntegral#doc\">docs#Irreducible.exists_dvd_monic_irreducible_of_isIntegral</a> (just needs to remove replace Irreducible by nonzero)</p>",
        "id": 498375115,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738944671
    },
    {
        "content": "<p>Thank you yes I was looking at this kind of theorem!</p>",
        "id": 498379866,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1738946032
    },
    {
        "content": "<p>But there didn't seem to be something that would give me what I wanted for free.</p>",
        "id": 498380865,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1738946333
    },
    {
        "content": "<p>Here's a complete proof with a sorry that I'm going to PR soon:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">TensorProduct</span><span class=\"w\"> </span><span class=\"n\">nonZeroDivisors</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">exists_dvd_map_of_isAlgebraic</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">algebraMap</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsPushout</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalization</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algebraMapSubmonoid</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">IsLocalization</span><span class=\"bp\">.</span><span class=\"n\">iff_of_le_of_exists_dvd</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">map_le_nonZeroDivisors_of_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">map_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"bp\">.</span><span class=\"n\">algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">le_rfl</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_dvd_map_of_isAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ne_zero</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_nonZeroDivisors_of_ne_zero</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">inferInstance</span>\n\n<span class=\"c1\">-- TODO: upgrade to AlgEquiv</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ratFuncLinearEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">IsLocalizedModule</span><span class=\"bp\">.</span><span class=\"n\">linearEquiv</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">IsScalarTower</span><span class=\"bp\">.</span><span class=\"n\">toAlgHom</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ratFuncLinearEquiv'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">AlgebraTensorModule</span><span class=\"bp\">.</span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">rid</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span>\n<span class=\"w\">    </span><span class=\"n\">AlgebraTensorModule</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsPushout</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span><span class=\"w\"> </span><span class=\"n\">ratFuncLinearEquiv</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">faithfulSMul_iff_algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">IsFractionRing</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">map_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"bp\">.</span><span class=\"n\">algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"bp\">.</span><span class=\"n\">liftAlgebra</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ratFunc_rank_eq</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsLocalization</span><span class=\"bp\">.</span><span class=\"n\">linearMap_compatibleSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ratFuncLinearEquiv'</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">restrictScalars</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">|&gt;.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">lift_rank_eq</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank_baseChange</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">eq</span>\n</code></pre></div>",
        "id": 498437013,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738967341
    },
    {
        "content": "<p>Maybe in this case <code>IsFractionRing</code> is more convenient?</p>",
        "id": 498462748,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738984856
    },
    {
        "content": "<p>Do you know <code>k(X) ⊗[k] K</code> is a domain? If yes, then it's automatically a field by <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.TensorProduct.isField_of_isAlgebraic#doc\">docs#Algebra.TensorProduct.isField_of_isAlgebraic</a>.</p>",
        "id": 498463097,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738985208
    },
    {
        "content": "<blockquote>\n<p>a sorry that I'm going to PR soon</p>\n</blockquote>\n<p>The PR is <a href=\"https://github.com/leanprover-community/mathlib4/pull/21566\">#21566</a> but I'm still working to remove more injectivity hypotheses ...</p>\n<blockquote>\n<p>Do you know <code>k(X) ⊗[k] K</code> is a domain?</p>\n</blockquote>\n<p>That's basically equivalent to linear disjointness right? There isn't a very slick proof for this in <a href=\"https://math.stackexchange.com/questions/4581/why-does-k-leadsto-kx-preserve-the-degree-of-field-extensions/\">the question</a> other than the one by Martin Brandenburg, which is basically my proof.</p>\n<blockquote>\n<p>Maybe in this case <code>IsFractionRing</code> is more convenient?</p>\n</blockquote>\n<p>It could be but I'm not sure I want to try ... I find RatFunc is missing some instances so I'm not using it. (It's defined as a structure possibly originally for performance reasons (mathlib3 <a href=\"https://github.com/leanprover-community/mathlib3/commit/e20af15914ad2912e42aa9ccdabed2c8ec79a439\">commit</a>), but probably this is no longer needed now and we can just make RatFunc an abbrev for <code>FractionRing (Polynomial _)</code>.)</p>",
        "id": 498464194,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738986279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/498464194\">said</a>:</p>\n<blockquote>\n<p>I find RatFunc is missing some instances so I'm not using it. (It's defined as a structure possibly originally for performance reasons (mathlib3 <a href=\"https://github.com/leanprover-community/mathlib3/commit/e20af15914ad2912e42aa9ccdabed2c8ec79a439\">commit</a>), but probably this is no longer needed now and we can just make RatFunc an abbrev for <code>FractionRing (Polynomial _)</code>.)</p>\n</blockquote>\n<p>I have already noticed it in here <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.60MvRatFunc.60.3F\">#Is there code for X? &gt; &#96;MvRatFunc&#96;?</a></p>",
        "id": 498464460,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738986544
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/498464194\">said</a>:</p>\n<blockquote>\n<p>That's basically equivalent to linear disjointness right?</p>\n</blockquote>\n<p>Yes, that is \"relative\" linearly disjoint. I'm just wondering if its proof does not required your sorried proof.</p>",
        "id": 498464760,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738986837
    },
    {
        "content": "<p>I think your sorried result is closely related to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Irreducible.exists_dvd_monic_irreducible_of_isIntegral#doc\">docs#Irreducible.exists_dvd_monic_irreducible_of_isIntegral</a> which is introduced in <a href=\"https://github.com/leanprover-community/mathlib4/pull/9522\">#9522</a>.</p>",
        "id": 498464997,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738987079
    },
    {
        "content": "<p>Yes, I've put it <a href=\"https://github.com/leanprover-community/mathlib4/pull/21566/files#diff-dcc75e519ef3f737599e97cf0fe09428d3046c98ddd9202e8b905e6ac5a8a5c6\">right under that lemma</a>.</p>",
        "id": 498466131,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738988102
    },
    {
        "content": "<p>We should generalize to \"MvRatFunc\" (FractionRing of MvPolynomial) to get the full Stacks result but I'm not sure what the shortest route to that is ... by induction and take direct limit? Hmm maybe I can show that any nonzero MvPolynomial in K divides a nonzero MvPolynomial in k too ...</p>",
        "id": 498514899,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739031651
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/498514899\">said</a>:</p>\n<blockquote>\n<p>Hmm maybe I can show that any nonzero MvPolynomial in K divides a nonzero MvPolynomial in k too ...</p>\n</blockquote>\n<p>I think this is better as one can describe explicitly the isomorphism <code>k(X_i) ⊗[k] K ≃ K(X_i)</code>.</p>",
        "id": 498518719,
        "sender_full_name": "Jz Pan",
        "timestamp": 1739034912
    },
    {
        "content": "<p>By the way this is an interesting question that came up that both DeepSeek-r1 and OpenAI o3-mini (free) are able to provide correct proofs; given existing mathlib it can be proven in four lines in RingTheory/Algebraic/Basic.</p>\n<blockquote>\n<p>Let A be an S-algebra and let S be an R-algebra, such that S is a domain, the composition R-&gt;S-&gt;A is injective, and S is algebraic over R (meaning every element of S is a root of a nonzero polynomial with coefficients in R). Clearly R-&gt;S must be injective and therefore R is also a domain. Does it follow that S-&gt;A is also injective?</p>\n</blockquote>",
        "id": 498519193,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739035305
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21566\">#21566</a> ready for review</p>",
        "id": 498521678,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739037301
    },
    {
        "content": "<p>Here's a question they're unable to solve, not even coming close; I can prove them if either R or S is a domain, but am not sure about the general case. r1 thinks there's a counterexample with R=Z and S=Z[1/2], which doesn't work because Z is a domain; o3 thinks S[X] is an algebraic R[X]-algebra iff S is a finite R-<del>algebra</del>module, which is clearly too strong (it knows finite -&gt; integral).</p>\n<blockquote>\n<p>Let S be an algebraic algebra over a commutative ring R, meaning that every element of S is a root of some nonzero polynomial with coefficients in R. Does it follow that the polynomial ring S[X] is also an algebraic algebra over R[X]?</p>\n</blockquote>",
        "id": 498549288,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739060454
    },
    {
        "content": "<p>I think you only need to show the case that <code>S/R</code> is finite? For any <code>g</code> of <code>S[X]</code>, let <code>S'</code> be the subalgebra of <code>S/R</code> generated by coefficients of <code>g</code>, then <code>S'/R</code> is finite and <code>g</code> is in <code>S'[X]</code>.</p>",
        "id": 498565493,
        "sender_full_name": "Jz Pan",
        "timestamp": 1739076316
    },
    {
        "content": "<p>o3's answer actually says finite R-module, not finite type R-algebra (corrected above). Not sure how to do this case either. A more general question (whose positve answer implies a positive answer for the previous question) is:</p>\n<blockquote>\n<p>If A is an R-algebra and there exists an injective R-algebra homomorphism R[X,Y]-&gt;A[X], does it follow that there exists an injective R-algebra homomorphism R[X]-&gt;A?</p>\n</blockquote>",
        "id": 498592544,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739101083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/498549288\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Let S be an algebraic algebra over a commutative ring R, meaning that every element of S is a root of some nonzero polynomial with coefficients in R. Does it follow that the polynomial ring S[X] is also an algebraic algebra over R[X]?</p>\n</blockquote>\n</blockquote>\n<p>Does this not follow from the fact that the algebraic elements are a subalgebra and they contain S?</p>",
        "id": 498595977,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739103975
    },
    {
        "content": "<p>That's basically how I prove the domain case. The subalgebra is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Algebraic/Integral.html#Subalgebra.algebraicClosure\">Subalgebra.algebraicClosure</a>.</p>",
        "id": 498596517,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739104465
    },
    {
        "content": "<p>Are you saying this doesn't work in the general case? What is the counterexample?</p>",
        "id": 498598911,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739106614
    },
    {
        "content": "<p>Algebraic elements don't necessarily form a subalgebra in general, see <a href=\"https://mathoverflow.net/questions/482944/when-do-algebraic-elements-form-a-subalgebra\">https://mathoverflow.net/questions/482944/when-do-algebraic-elements-form-a-subalgebra</a><br>\n(In fact it can happen that the square of an algebraic element is transcendental.)</p>",
        "id": 498599673,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739107387
    },
    {
        "content": "<p>Oh the polynomial needn't be monic? Is this a sensible notion?</p>",
        "id": 498606056,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739112812
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/498606056\">said</a>:</p>\n<blockquote>\n<p>Oh the polynomial needn't be monic? Is this a sensible notion?</p>\n</blockquote>\n<p>It's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsIntegral#doc\">docs#IsIntegral</a> if the polynomial in question is required to be monic.</p>",
        "id": 498608934,
        "sender_full_name": "Jz Pan",
        "timestamp": 1739115143
    },
    {
        "content": "<p>It's natural from the point of view of transcendence/algebraic independence which are about injectivity of maps from (Mv)Polynomial to an algebra (while algebraicity means non-injectivity), and there were at least two <a href=\"https://mathoverflow.net/questions/132174/are-roots-of-transcendental-elements-transcendental\">MO</a> <a href=\"https://mathoverflow.net/questions/266298/algebraic-independence-in-polynomial-rings-over-mathbbz-n\">questions</a> asked under this definition of algebraic (independence), and <a href=\"https://link.springer.com/chapter/10.1007/978-1-4612-3660-3_13\">work</a> of Hamann in the 1980s that studies these notions.</p>\n<p>The notion involving monic polynomials is called <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsIntegral#doc\">docs#IsIntegral</a>, and for injective algebra maps between domains, algebraicity is equivalent to integrality of the extension of fraction fields, but it's convenient to work on the level of domains rather than constantly passing to the fraction fields and dealing with the commutative diagrams. Integrality enjoys better properties in general, for example transitivity in a tower A/S/R holds in full generality, but for algebraicity it needs S to be a domain (an unnecessary injectivity assumption is removed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/21566\">#21566</a>). In general, it's natural to ask whether theorems continue to hold without the IsDomain hypothesis.</p>",
        "id": 498609737,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739115821
    },
    {
        "content": "<blockquote>\n<p>In general, it's natural to ask whether theorems continue to hold without the IsDomain hypothesis.</p>\n</blockquote>\n<p>I personally would disagree with this. Given all the counterexamples above it seems to me that the pragmatic conclusion is that algebraicity does not behave well away from domains and it's not worth spending time trying to work out which fragments of the theory hold more generally as these results are unlikely to ever be wanted for any real applications.</p>",
        "id": 498622158,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739125596
    },
    {
        "content": "<p>I agree that figuring out the most general conditions shouldn't block development, but these are certainly legitimate questions which I personally find interesting, especially questions not obviously connected to any known counterexamples after having seen many.</p>\n<p>Extra assumptions do mean that the user has to supply it or Lean has to search for the instance. In this case they also mean we now have two versions of the same result with different assumptions which could potentially be unified in the future, and I do not find this aesthetically pleasing. Future people (at least some of them) reading the code will definitely be tempted to remove the conditions. I have made an effort to record counterexamples in the docstrings by e.g. adding link to MO quesitons so that people won't make vain attempts.<br>\n<a href=\"/user_uploads/3121/eXEOdgVQ_-We5WRyNX4V9Z7h/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/eXEOdgVQ_-We5WRyNX4V9Z7h/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"939x833\" src=\"/user_uploads/thumbnail/3121/eXEOdgVQ_-We5WRyNX4V9Z7h/image.png/840x560.webp\"></a></div>",
        "id": 498636773,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739137215
    },
    {
        "content": "<p>I have extracted a general statement from my proof above: if S is an algebraic R-algebra with injective algebra map where R is an integral domain, and if R' and S' are fraction rings of R and S respectively, then S' is the pushout of the R-algebras S and R' (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.IsPushout#doc\">docs#Algebra.IsPushout</a>). Here we take R=k[X], S=K[X], R'=k(X) and S'=K(X). If we compose this with the pushout square with vertices k, K, k[X] and K[X], we get that K(X) is the pushout of the k-algebras K and k(X), and hence the equality of dimensions.</p>",
        "id": 498637316,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739137648
    },
    {
        "content": "<p>Thanks a lot for this <span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span>, that is exactly what I needed.</p>\n<p>A question I have is on your <code>TODO: upgrade to AlgEquiv</code>, how would you go about that? I think it would be nice to have.</p>",
        "id": 499681817,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1739524654
    },
    {
        "content": "<p>We can get it from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Algebra.IsPushout.equiv#doc\">docs#Algebra.IsPushout.equiv</a> if we follow my suggested new approach using IsPushout.</p>",
        "id": 499684464,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739525367
    },
    {
        "content": "<p>In fact this works</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"w\"> </span><span class=\"n\">TensorProduct</span><span class=\"w\"> </span><span class=\"n\">nonZeroDivisors</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsPushout</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsLocalization</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">algebraMapSubmonoid</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">IsLocalization</span><span class=\"bp\">.</span><span class=\"n\">iff_of_le_of_exists_dvd</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">map_le_nonZeroDivisors_of_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">map_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"bp\">.</span><span class=\"n\">algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">le_rfl</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_dvd_map_of_isAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ne_zero</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_nonZeroDivisors_of_ne_zero</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">faithfulSMul_iff_algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">IsFractionRing</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">map_injective</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FaithfulSMul</span><span class=\"bp\">.</span><span class=\"n\">algebraMap_injective</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"bp\">.</span><span class=\"n\">liftAlgebra</span>\n\n<span class=\"c1\">-- upgraded to AlgEquiv</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ratFuncAlgEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">isPushout_of_isLocalization</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]))</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsPushout</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">restrictScalars</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ratFuncLinearEquiv'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">⊗</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">≃ₗ</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]]</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">AlgebraTensorModule</span><span class=\"bp\">.</span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TensorProduct</span><span class=\"bp\">.</span><span class=\"n\">rid</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span>\n<span class=\"w\">    </span><span class=\"n\">AlgebraTensorModule</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span><span class=\"w\"> </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsPushout</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">≪≫ₗ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ratFuncLinearEquiv</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toLinearEquiv</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">algebra</span><span class=\"w\"> </span><span class=\"n\">FractionRing</span><span class=\"bp\">.</span><span class=\"n\">liftAlgebra</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ratFunc_rank_eq</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsDomain</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">IsAlgebraic</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IsLocalization</span><span class=\"bp\">.</span><span class=\"n\">linearMap_compatibleSMul</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"bp\">⁰</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ratFuncLinearEquiv'</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">restrictScalars</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FractionRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">|&gt;.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">lift_rank_eq</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">rank_baseChange</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">eq</span>\n</code></pre></div>",
        "id": 499686869,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739525964
    },
    {
        "content": "<p>Opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/22966\">#22966</a> for this</p>",
        "id": 505880759,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1742068943
    },
    {
        "content": "<p>The proof eventually decomposes into the following facts:</p>\n<ul>\n<li>\n<p><code>IsAlgebraic/IsIntegral R S</code> + <code>IsPushout R S R' S'</code> ⇒ <code>IsAlgebraic/IsIntegral R' S'</code> (for the \"IsAlgebraic\" version we currently need to assume <code>NoZeroDivisor R'</code> and <code>FaithfulSMul R R'</code> (i.e. <code>Injective (algebraMap R R')</code>)</p>\n</li>\n<li>\n<p><code>IsAlgebraic R S</code> + <code>IsFractionRing R R'</code> + <code>IsFractionRing S S'</code> ⇒ <code>IsPushout R S R' S'</code> (need to assume <code>FaithfulSMul R S</code> + <code>NonZeroDivisors S</code>)</p>\n</li>\n<li>\n<p>Base change along an injective map of domains preserves rank. (When proving this I've split results like <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Dimension/Localization.html#IsLocalizedModule.rank_eq\">IsLocalizedModule.rank_eq</a> into two parts (IsLocalizedModule and <a href=\"https://github.com/leanprover-community/mathlib4/pull/22966/files#diff-b9a7b8aa577f748668cf6f5b5400637204196fd4545095b857fa1b43f348f5abR61\">IsLocalization</a>), even though this isn't necessary. These results were added by <span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/9412\">#9412</a>.)</p>\n</li>\n</ul>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22966/files#diff-b9a7b8aa577f748668cf6f5b5400637204196fd4545095b857fa1b43f348f5abR114-R130\">One of the proofs</a> exhibits substantial universe yoga; the chained rewrites using <code>lift_id'</code>, <code>lift_lift</code>, <code>lift_umax</code> etc. could potentially benefit from some tactic (\"convert_to_univs/lifts\"?) that auto-generates such rewrites given a goal expression involving iterated lifts.</p>",
        "id": 506242610,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1742239568
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Searching.20for.20a.20theorem.3A.20Degree.20of.20.60K.2Fk.60.20vs.20.60K.28x.29.2Fk.28x.29.60.2E/near/506242610\">said</a>:</p>\n<blockquote>\n<p>... could potentially benefit from some tactic (\"convert_to_univs/lifts\"?) that auto-generates such rewrites given a goal expression involving iterated lifts.</p>\n</blockquote>\n<p>It was discussed here <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Universe-heterogeneous.20ordinal.20and.20cardinal.20relations/with/495430305\">#mathlib4 &gt; Universe-heterogeneous ordinal and cardinal relations</a></p>",
        "id": 506383473,
        "sender_full_name": "Jz Pan",
        "timestamp": 1742277689
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23095\">#23095</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/23096\">#23096</a> have been split off the PR.</p>",
        "id": 506939979,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1742468488
    }
]