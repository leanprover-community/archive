[
    {
        "content": "<p>I think we should deprecate and replace all equality lemmas that could be iff lemmas instead. For example</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.mem_setOf_eq#doc\">docs#Set.mem_setOf_eq</a></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.setOf_mem_eq#doc\">docs#Set.setOf_mem_eq</a></li>\n<li><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.mem_prod_eq#doc\">docs#Set.mem_prod_eq</a></li>\n</ul>\n<p>Is there any reason this hasn't been done? Also it shouldn't be too hard to find all such lemmas using a metaprogram. This could even become a linter. See also <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Set.2Emem_setOf_eq/with/323069620\">#mathlib4 &gt; Set.mem_setOf_eq</a></p>",
        "id": 535213826,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755644452
    },
    {
        "content": "<p>I think it's a historical thing because <code>simp</code> actually secretly eats equalities</p>",
        "id": 535214192,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755644764
    },
    {
        "content": "<p>I suspect there are also many such occurrences in core</p>",
        "id": 535214215,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755644775
    },
    {
        "content": "<p>I think we're still waiting for <code>dsimp</code> to lean to use <code>Iff.rfl</code> lemmas, like it did in Lean 3</p>",
        "id": 535214570,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755645120
    },
    {
        "content": "<p>Until then, to make a lemma work with <code>dsimp</code>, it has to be stated with <code>Eq</code></p>",
        "id": 535214599,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755645143
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535214570\">said</a>:</p>\n<blockquote>\n<p>I think we're still waiting for <code>dsimp</code> to lean to use <code>Iff.rfl</code> lemmas, like it did in Lean 3</p>\n</blockquote>\n<p>Does it not do this already?</p>",
        "id": 535214698,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755645231
    },
    {
        "content": "<p>I think there was a PR some time ago but it doesn't do it currently at least</p>",
        "id": 535215695,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1755646099
    },
    {
        "content": "<p>But apparently <code>mem_prod_eq</code> isn't even tagged with <code>@[simp]</code>; and <code>mem_prod</code> is?</p>",
        "id": 535215781,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755646188
    },
    {
        "content": "<p>Getting <code>Iff.rfl</code> proofs working in <code>dsimp</code> is a bit of a white whale for me—I made the PR mentioned here (a couple of different PRs, from different attempts, in fact!). However, in part because <code>dsimp</code> is called internally during <code>simp</code> on different parts of the expression than <code>simp</code> is, many, many extant proofs using <code>simp</code> break due to this change (and not usually in a beneficial way). We e.g. find ourselves <code>dsimp</code>ing away crucial parts of the expression that further simplification/indexing relies on.</p>\n<p>This means that we’d need to either (1) carefully tweak our (d)simp set on making this change so that the situation is not so bad (2) exclude Iff.rfl proofs from “internal” <code>dsimp</code> but not from “user-requested” <code>dsimp</code> (i.e. from tactic syntax), which seems ad-hoc and less powerful, or (3) somehow carefully change how <code>simp</code> internals work, e.g. by modifying what gets called where or by somehow retaining the form of subexpressions prior to <code>dsimp</code> for indexing purposes (which seems either finicky or not performant).</p>\n<p>I have a table of dozens of adaptations I needed to make to Mathlib when attempting to get it to build, each recorded along with the cause of the error, relevant expressions, and so forth, which might be of some relevance. If someone wants to work on this with me, I’d be open to re-engaging with the problem sooner rather than later. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 535225488,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755654566
    },
    {
        "content": "<p>Wouldn't it simply work to go through all <code>@[simp]</code> lemmas that are proved by <code>Iff.rfl</code>, and replace their proof with <code>by rfl</code>, so that they aren't in the <code>dsimp</code> set?</p>\n<p>And then once we merge this we can start thinking about if we want some of these lemmas to actually be in the <code>dsimp</code> set, and replace their proofs back to <code>Iff.rfl</code>.</p>",
        "id": 535324838,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755699537
    },
    {
        "content": "<p>Or with <code>(Iff.rfl)</code>, since core has defined that a proof of <code>(rfl)</code> no longer counts for dsimp</p>",
        "id": 535325446,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755699709
    },
    {
        "content": "<p>Sure, if that’s desired as an interim fix, I’m happy to do that! Though I would kind of fear that we’d be papering over a deeper problem in doing so, and would be introducing behavior that we might have to change again once we understood that problem better.</p>",
        "id": 535326789,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755700025
    },
    {
        "content": "<p>I don't understand how this fix would be papering over the deeper problem more than that status quo is doing.</p>\n<p>I think that explicitly marking what is and what isn't <code>dsimp</code> by writing <code>(Iff.rfl)</code> instead of <code>Iff.rfl</code> is much better than this obscure feature that <code>Iff.rfl</code> lemmas aren't <code>dsimp</code>.</p>",
        "id": 535328152,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755700357
    },
    {
        "content": "<p>That’s fair, but given the ubiquity of <code>simp</code>, downstream proofs are currently built based on the current behavior (even if we mark all our proofs with <code>()</code>, we’re not the only ones with <code>Iff.rfl</code> proofs), and if it turns out we need to change the behavior twice, that would be more painful than changing it once. (My point here rests on the fact that tweaking the simp set may be but is not necessarily the way we want to solve this problem. It’s possible—though I’d guess less likely, admittedly—that simplifying propositions in certain ways is systematically dangerous due to where and how they appear in common expressions like Subtype arguments.)</p>",
        "id": 535329094,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755700642
    },
    {
        "content": "<p>Interesting, so you're saying that there may actually be a reason for <code>Prop</code> valued reflexive rewrites to be treated differently.</p>",
        "id": 535330154,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755700936
    },
    {
        "content": "<p>Right, even if it’s just “emergently” based on where and how Props tend to be used in expressions.</p>",
        "id": 535330338,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755700985
    },
    {
        "content": "<p>(It’s been a little while, but iirc, there were some examples that suggested this, where no simp lemmas seemed directly “at fault”, but we ended up in a useless modified state nonetheless. I’d have to revisit it to be sure though; my impression could have been wrong.)</p>",
        "id": 535330883,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755701139
    },
    {
        "content": "<p>We could e.g. wind up with a rule like “don’t dsimp with Iff.rfl lemmas under binders when the return type is <code>Prop</code>”, as an example of a possible change to internals (I’m pulling this out of thin air for the sake of example, but it is loosely based on my experiences here).</p>",
        "id": 535331916,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755701444
    },
    {
        "content": "<p>So my preference would be to understand the problem a little more deeply before making a change! I would be interested in starting up <em>that</em> process again, though. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 535332598,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755701642
    },
    {
        "content": "<p>But, you know what? No harm in trying. Let’s see if it <em>is</em> just a simp set issue by experiment! (This will give me a good chance to try out the new tactic analysis framework…)</p>",
        "id": 535334095,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1755702082
    },
    {
        "content": "<p>I still don't have a good grasp on how the dsimp set is meant to be designed, or whether or not dsimp itself has any design deficiencies.</p>\n<p>My loose understanding of the primary problem with dsimp is that it does not take dependence into account. Let's say we have <code>f : (a : Type) -&gt; (b : a) -&gt; c</code> and dsimp rewrites <code>f x y</code> to <code>f x' y</code>, which is something that simp itself normally cannot do. The type of <code>y</code> is definitionally equal to both <code>x</code> and <code>x'</code>, but possibly it's not the case that <code>y</code> has type <code>x'</code> at reducible transparency. Preserving defeq at reducible transparency is important, since that's what <code>simp</code> uses to select rewrite lemmas, and that's what typeclass inference uses to select potential instances.</p>\n<p>This suggests to me that dsimp should be \"reducibility-aware\", rather than simply use <code>Meta.transform</code>. What this could look like is it would analyze expressions and determine what kind of \"defeq congruence\" is allowed. E.g., for <code>f</code> the <code>a</code> parameter can be rewritten with a defeq at reducible transparency, and <code>b</code> can be rewritten with a defeq at default transparency. Maybe the way this is respected is that when selecting dsimp lemmas, it checks that the LHS and RHS are defeq at the required transparency. Or, dsimp lemmas can be tagged with whether they work at reducible transparency — that saves defeqs in the rewriting, at the cost of some lemmas not applying even if they could with the given arguments.</p>",
        "id": 535357993,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755709640
    },
    {
        "content": "<p>I guess this could come to a head with something like <code>(x : Fin (1 + 1)) : f (1 + 1) x = 0</code> being dsimped to <code>f 2 x = 0</code></p>",
        "id": 535373534,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755716463
    },
    {
        "content": "<p>Here I think <code>dsimp</code> should instead convert to <code>f 2 (cast _ x) = 0</code></p>",
        "id": 535373607,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755716492
    },
    {
        "content": "<p>(since the proof is <code>rfl</code>, we know that <code>cast _ x = x</code> is also rfl)</p>",
        "id": 535373675,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755716523
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535373534\">said</a>:</p>\n<blockquote>\n<p>I guess this could come to a head with something like <code>(x : Fin (1 + 1)) : f (1 + 1) x = 0</code> being dsimped to <code>f 2 x = 0</code></p>\n</blockquote>\n<p>I've been running into a similar problem in graded rings without solution</p>",
        "id": 535373966,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755716649
    },
    {
        "content": "<p>I think simproc might be the solution (when I ran into this problem 2 months ago, I didn't know what simprocs are)</p>",
        "id": 535374013,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755716666
    },
    {
        "content": "<p>You're running into things simplifying too far (without a cast), or not going far enough?</p>",
        "id": 535374450,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755716839
    },
    {
        "content": "<p>If the former, then this sounds like something that needs to be fixed in congruence lemma generation, and if the latter, this sounds like a feature to add to congruence lemma generation. I don't think <code>simproc</code>s are a great solution here.</p>",
        "id": 535374580,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755716880
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> let's say i have a map of graded rings f : A_n -&gt; B_n, and i have x, y in A_1, then f(x^3+y^3) should be f(x)^3+f(y)^3</p>",
        "id": 535375045,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717035
    },
    {
        "content": "<p>sorry, by <code>.^3</code> i mean <code>.*.*.</code></p>",
        "id": 535375118,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717059
    },
    {
        "content": "<p>then the simp machine looks at <code>f_3 ((x * x) * x)</code> and says, wait 3 isn't 2+1, i only know that <code>f_(m+n) a*b = f_m a * f_n b</code></p>",
        "id": 535375253,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717112
    },
    {
        "content": "<p>oh i haven't totalised btw, this is happening in A_3 and B_3, not the total A and B</p>",
        "id": 535375339,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717150
    },
    {
        "content": "<p>Maybe the simp lemma should have the hypothesis <code>m + n = k</code>, and rewrite <code>f_k a*b = f_m a + f_n b</code>?</p>",
        "id": 535375814,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755717354
    },
    {
        "content": "<p>then the simp lemma won't type check</p>",
        "id": 535376035,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717436
    },
    {
        "content": "<p>because a*b has type A (m+n)</p>",
        "id": 535376064,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717445
    },
    {
        "content": "<p><code>f_3 (x * x * x)</code> is already arguably ill-typed</p>",
        "id": 535376106,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755717460
    },
    {
        "content": "<p>let's move this to a separate thread</p>",
        "id": 535376163,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717484
    },
    {
        "content": "<p>You should pretend you're playing this game with an index type that has no defeqs, and ask what simp should do there</p>",
        "id": 535376204,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755717503
    },
    {
        "content": "<p>Have you tried to make the argument <code>n</code> in <code>f</code> implicit? I think that could help the unification. Or is it already implicit?</p>",
        "id": 535376655,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755717689
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\"✰A\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\"✰B\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 535376853,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717768
    },
    {
        "content": "<p>this is the MWE</p>",
        "id": 535376864,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717771
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535376204\">said</a>:</p>\n<blockquote>\n<p>You should pretend you're playing this game with an index type that has no defeqs, and ask what simp should do there</p>\n</blockquote>\n<p>well i guess we could indeed make the grading arguments implicit so lean will automatically make it 1+1+1, and turn off the reduceAdd simproc</p>",
        "id": 535377147,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717887
    },
    {
        "content": "<p>yeah that seems to actually work lol</p>",
        "id": 535377238,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717923
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\" ✰A \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A_mul</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\" ✰B \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">B_mul</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">reduceAdd</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 535377242,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755717925
    },
    {
        "content": "<p>If we make all of the <code>n</code> implicit everywhere, it just works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f_map_mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_mul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">B_mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\" ✰A \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">A_mul</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"s2\">\" ✰B \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">B_mul</span>\n\n<span class=\"c1\">-- even if I explicitly set `n := 3`, it still works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">✰</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- f x ✰B f x ✰B f x + f y ✰B f y ✰B f y = sorry</span>\n</code></pre></div>",
        "id": 535381938,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755719979
    },
    {
        "content": "<p>what is this magic, how does it work??</p>",
        "id": 535382352,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755720166
    },
    {
        "content": "<p>i thought lean doesn't know about implicit arguments</p>",
        "id": 535382387,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755720181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535382387\">said</a>:</p>\n<blockquote>\n<p>i thought lean doesn't know about implicit arguments</p>\n</blockquote>\n<p>what is this supposed to mean</p>",
        "id": 535382439,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755720208
    },
    {
        "content": "<p>During unification, lean switches to the <code>default</code> transparency on implicit arguments. I think it also unifies the explicit arguments before the implicit arguments. So in this case, it then it ends up unifying <code>2 + 1 =?= 3</code> in the <code>default</code> transparency, instead of getting stuck at the <code>reducible</code> transparency.</p>",
        "id": 535382715,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1755720358
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535382439\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535382387\">said</a>:</p>\n<blockquote>\n<p>i thought lean doesn't know about implicit arguments</p>\n</blockquote>\n<p>what is this supposed to mean</p>\n</blockquote>\n<p>it means when you make an argument implicit, Lean doesn't suddenly forget about it</p>",
        "id": 535383366,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755720724
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.60.3D.60.20vs.20.60.E2.86.94.60/near/535382715\">said</a>:</p>\n<blockquote>\n<p>During unification, lean switches to the <code>default</code> transparency on implicit arguments. I think it also unifies the explicit arguments before the implicit arguments. So in this case, it then it ends up unifying <code>2 + 1 =?= 3</code> in the <code>default</code> transparency, instead of getting stuck at the <code>reducible</code> transparency.</p>\n</blockquote>\n<p>interesting</p>",
        "id": 535383402,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755720747
    },
    {
        "content": "<p>oh no the kernel doesn't care about implicits</p>",
        "id": 535383407,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755720753
    },
    {
        "content": "<p>the elaborator does a lot with them</p>",
        "id": 535383423,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755720759
    },
    {
        "content": "<p>i see</p>",
        "id": 535383658,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755720887
    }
]