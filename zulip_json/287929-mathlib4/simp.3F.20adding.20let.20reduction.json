[
    {
        "content": "<p>In the following example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">e</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>the line  <code>simp [e]</code> changes to <code>d x = x</code>, i.e., it does not reduce <code>d</code>, which is perfect. But <code>simp? [e]</code> suggests <code>simp only [e, d]</code>, pulling <code>d</code> into the simpset for no reason. Is that a known behavior?</p>",
        "id": 493985664,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1736963857
    },
    {
        "content": "<p>That's odd. The diagnostics show that only <code>e</code> was used, so I'm not sure how <code>d</code> is being included in the <code>simp only</code> syntax.</p>",
        "id": 493988086,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736964613
    },
    {
        "content": "<p>In previous Lean versions, <code>simp</code> was reducing <code>let</code>s by default. Maybe the behavior has been changed for <code>simp</code>, but not perfectly cleaned up for <code>simp?</code> ?</p>",
        "id": 493988664,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1736964828
    },
    {
        "content": "<p>Something really weird is going on here. In</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"c1\">-- simp [d]</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp?</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>the <code>simp?</code> reduces to <code>simp only</code>, but if you uncomment the line <code>simp [d]</code> then the <code>simp?</code> reduced to <code>simp only [d]</code>.</p>",
        "id": 493990232,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1736965363
    },
    {
        "content": "<p>I've observed this too, and I also find it confusing behaviour - my example was similar to your original one</p>",
        "id": 493990563,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736965481
    },
    {
        "content": "<p>I was reading through the <code>simp?</code> code, and it looks like it does exactly what <code>simp</code> does. It'd be worth double checking, but it seems like the bug could be in how the <code>simp only</code> syntax is generated.</p>",
        "id": 493990964,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736965633
    },
    {
        "content": "<p>Reported at <a href=\"https://github.com/leanprover/lean4/pull/6655\">lean4#6655</a>.</p>",
        "id": 493999695,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1736968826
    }
]