[
    {
        "content": "<p>Almost a year ago I asked <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/.E2.9C.94.20Topos.20theory/near/434218473\">this question</a> about whether there was any topos theory in mathlib4. Last summer I spent some time working on formaliziing some results, and have just recently made <a href=\"https://github.com/CharredLee/topos\">the repo</a> public after updating the code for the recent Lean 4.15 update. My hope is to make this code good enough to PR to mathlib4, but I haven't had much time until now to do that. If there is any interest, I would love any collaboration, suggestions, or critiques of the existing code.</p>",
        "id": 495151730,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1737496682
    },
    {
        "content": "<p>Nice! From a very first skimming through the code, I can say that this looks ready to for entering the PR/review process.<br>\nWell done!</p>",
        "id": 495209019,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1737527907
    },
    {
        "content": "<p>How close are you to proving that a grothendieck topos (or just sheaves on a topological space) is a topos in your sense?</p>",
        "id": 495214676,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737530693
    },
    {
        "content": "<p>well done <span class=\"user-mention\" data-user-id=\"218940\">@Charlie Conneen</span>! I have been myself working on a formalization of subobject classifiers lately (available <a href=\"https://github.com/LMCRC/Topos-Theory/blob/subobject-classifier/ToposTheory/Mathlib/CategoryTheory/Subobject/Classifier.lean\">here</a>), and I noticed your repo includes one. There are some subtle differences in the choices of names and formulations, especially for the property you call <code>classifying</code> that corresponds to <code>IsClassifier</code> in my formalization. My choices were aimed at the proof of Proposition 1 in Section I.3 of Sheaves in Geometry and Logic, which is completed at around 40% I would say. I think your development does not include this theorem (nor the definition of the subobject presheaf <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">S</mi><mi mathvariant=\"normal\">u</mi><mi mathvariant=\"normal\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\mathrm{Sub}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">Sub</span></span></span></span></span>), so those parts are not overlapping at least.</p>\n<p>Naturally if we are to incorporate one of our developments into mathlib, we will need to settle on a canonical definition for the subobject classifier, and adapt our proofs consequently. Thus I would be interested in discussing our respective formalization choices so that we can converge on something :)</p>",
        "id": 495315920,
        "sender_full_name": "Pablo Donato",
        "timestamp": 1737561233
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> It hasn't been a current priority (there are at present no instances of <code>Topos C</code>), but it shouldn't be too far afield.</p>",
        "id": 495319187,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1737562098
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"494544\">@Pablo Donato</span> Ah, very nice! It seems there is indeed little overlap in our code's content. My results are focused on the content of chapter 4 of the text.</p>\n<p>I'm not overly attached to the existing formalism. The implementation is an adaptation of <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>'s implementation in the Lean 3 library. If you have some concrete reason why you think a different formalism makes proving results easier, I'm all ears. Although, your <code>IsClassifier</code> definition seems to be equivalent to the <code>IsSubobjectClassifier</code> structure in my code; <code>classifying</code> is just a helper struct which contains the data that the associated diagram is a pullback, and says nothing about the uniqueness.</p>",
        "id": 495321648,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1737562795
    },
    {
        "content": "<p>ah yes sorry I meant <code>IsSubobjectClassifier</code> instead of <code>classifying</code></p>",
        "id": 495322955,
        "sender_full_name": "Pablo Donato",
        "timestamp": 1737563130
    },
    {
        "content": "<p>so let me list the differences I've noticed one-by-one:</p>\n<ol>\n<li>My naming scheme is to avoid expliciting <code>Subobject</code> in the name of definitions (e.g. <code>IsClassifier</code> instead of <code>IsSubobjectClassifier</code>), since I put them in the <code>CategoryTheory.Subobject</code> namespace</li>\n<li><code>IsClassifier</code> is defined as a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Π</mi></mrow><annotation encoding=\"application/x-tex\">\\Pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Π</span></span></span></span>-type rather than a structure, by bundling the classifier and its properties in a subtype endowed with the <code>Unique</code> class. Also the helper <code>classifying</code> is avoided by reusing <code>CategoryTheory.IsPullback</code></li>\n<li>the canonical subobject classifier (that you call <code>t</code> and I call <code>true!</code>) being a mono is an assumption in my formalization, but a proved fact in yours</li>\n<li>your <code>HasSubobjectClassifier</code> I call <code>Classifier</code>, because I reserve the name <code>HasClassifier</code> for the idiomatic construction using <code>Nonempty</code></li>\n</ol>\n<p>I am no expert in mathlib (this is my first tentative contribution), but I would say 1. and 4. are more idiomatic in my formalization, 2. is more compact in mine but maybe less idiomatic (although it reuses more existing definitions), 3. is obviously better in yours</p>\n<p>But maybe I am getting ahead of myself, and these considerations should be kept for the PR review :)</p>",
        "id": 495327852,
        "sender_full_name": "Pablo Donato",
        "timestamp": 1737564513
    },
    {
        "content": "<p>These seem reasonable. I will probably toy with refactoring in some of these respects at some point. It would mostly be a matter of editing the convenience lemmas, since the data is the same either way.</p>",
        "id": 495332484,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1737565937
    },
    {
        "content": "<p>Following up on this -- I am preparing to make a PR, but need write access to non-<code>master</code> branches of mathlib4 (as suggested in <a href=\"https://leanprover-community.github.io/contribute/index.html#working-on-mathlib\">this document</a>). My github username is CharredLee (linked <a href=\"https://github.com/CharredLee/\">here</a>).</p>",
        "id": 496614409,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738174091
    },
    {
        "content": "<p>Can you add your github username to your Zulip profile? Sorry, this extra instruction is <a href=\"https://github.com/leanprover-community/leanprover-community.github.io/pull/588\">on the way</a>!</p>",
        "id": 496622363,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738176802
    },
    {
        "content": "<p>Absolutely. I just did this.</p>",
        "id": 496622754,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738176937
    },
    {
        "content": "<p>Invitation sent!</p>",
        "id": 496633055,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738180690
    },
    {
        "content": "<p>I have made a pull request. It is located <a href=\"https://github.com/leanprover-community/mathlib4/pull/21269\">here</a>. I followed the instructions located <a href=\"https://leanprover-community.github.io/contribute/index.html\">here</a>. Hopefully my PR formatting is acceptable; I followed <a href=\"https://leanprover-community.github.io/contribute/commit.html\">this guide</a> as closely as possible. It took a bit to figure out how to make the linter happy, but the process for doing that is more clear now.</p>",
        "id": 496832183,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738258561
    },
    {
        "content": "<p>I'll have to configure my LSP to remove whitespace at the end of lines <span aria-label=\"lol\" class=\"emoji emoji-1f606\" role=\"img\" title=\"lol\">:lol:</span> that was one of the build issues I ran into because I use neovim. In any case, please let me know what the next steps are.</p>",
        "id": 496832777,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738258751
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"218940\">@Charlie Conneen</span> you may find some help on the lean.nvim channel! Also, a more conventional PR title would be exactly what you have written in the description (<code>feat(CategoryTheory/Topos): topos theory content</code>)</p>",
        "id": 496869715,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738271665
    },
    {
        "content": "<p>Ah, thanks. I clearly misunderstood which fields corresponded to which data.</p>",
        "id": 496870750,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738272081
    },
    {
        "content": "<p>It's helpful if you link to PRs using the linkifer, i.e. as <a href=\"https://github.com/leanprover-community/mathlib4/pull/21269\">#21269</a>. Then you get automatic emoji status updates from a bot!</p>",
        "id": 496878948,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738275491
    },
    {
        "content": "<p>Oh neat, thank you!</p>",
        "id": 496899672,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738286178
    },
    {
        "content": "<p>I've edited the PR title. At the suggestion of one of the reviewers, I'll be editing the PR to be just the content of <code>Classifier.lean</code>. That should be up in a bit, after I finish adapting everything to fit the naming conventions.</p>",
        "id": 496899760,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738286271
    },
    {
        "content": "<p>I think what Joël suggested is that you keep the PR as it is, make a new PR with just the contents of <code>Classifier.lean</code> and then return to this PR once the smaller one is merged :)</p>",
        "id": 496899971,
        "sender_full_name": "Ben Eltschig",
        "timestamp": 1738286392
    },
    {
        "content": "<p>Ah, that makes more sense. Thanks.</p>",
        "id": 496900488,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738286709
    },
    {
        "content": "<p>OK, I've made a new PR which can be found here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/21281\">#21281</a>. Hopefully everything matches the standard naming conventions in <code>CategoryTheory/Topos/Classifier.lean</code> now.</p>",
        "id": 496906611,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738290470
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"218940\">Charlie Conneen</span> <a href=\"#narrow/channel/287929-mathlib4/topic/topos.20theory.20repository/near/495321648\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"494544\">Pablo Donato</span> Ah, very nice! It seems there is indeed little overlap in our code's content. My results are focused on the content of chapter 4 of the text.</p>\n<p>I'm not overly attached to the existing formalism. The implementation is an adaptation of <span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span>'s implementation in the Lean 3 library. If you have some concrete reason why you think a different formalism makes proving results easier, I'm all ears. Although, your <code>IsClassifier</code> definition seems to be equivalent to the <code>IsSubobjectClassifier</code> structure in my code; <code>classifying</code> is just a helper struct which contains the data that the associated diagram is a pullback, and says nothing about the uniqueness.</p>\n</blockquote>\n<p>Feel free to request my review on these PRs: I'm sure it is no surprise that I think my implementation was a pretty good one, but there are still certainly things which should be updated from it!</p>",
        "id": 497014520,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738332405
    },
    {
        "content": "<p>Thank you Bhavik for your additional comments on the new PR. I have made the suggested first round of changes. I also renamed the namespace to <code>MonoClassifier</code> to distinguish it from the potential <code>Subobject.Classifier</code> to come later (as well as to resolve name duplication conflicts with the newly renamed <code>MonoClassifier.Classifier</code>). The only thing I'm not sure about is that the linter is angry that the autogenerated lemma <code>MonoClassifier.comm_assoc</code> from the <code>@[reassoc]</code> tag. Is this something to worry about?</p>",
        "id": 497028990,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738336501
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"218940\">@Charlie Conneen</span> not ordinarily, but I'm not sure how the linter usually avoids flagging <code>@[reassoc]</code> lemmas. Did CI give you a linter error, or just running the linter locally?</p>",
        "id": 497082916,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738355254
    },
    {
        "content": "<p>It looks to me like the CI error was just caused by <code>#lint docBlameThm</code> printing to stdout. Maybe try pushing with <code>@[reassoc]</code> but deleting the linter invocation and see what CI says.</p>",
        "id": 497083960,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738355712
    },
    {
        "content": "<p>I hadn't checked what was causing the CI error, I was just noticing the error locally. Thanks, you're right, the build doesn't mind an auto-generated lemma not having a docstring.</p>",
        "id": 497087794,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1738357286
    },
    {
        "content": "<p>Hi all <span class=\"topic-mention\">@topic</span>,</p>\n<p>I wanted to notify you that I have successfully formalized the (proof of) the representation theorem for subobject classifiers (Proposition 1 p.33 of SGL), and that I now intend to make a pull request to mathlib. You can take a look at the code <a href=\"https://github.com/LMCRC/Topos-Theory/blob/subobject-classifier/ToposTheory/Mathlib/CategoryTheory/Subobject/Classifier.lean\">here</a> (theorem <code>CategoryTheory.Subobject.hasClassifier_isRepresentable_iff</code>), although I am going to refine it a little bit with comments and probably corrections with respect to naming conventions before making the PR. I am also going to ask immediately for branch access in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/github.20permission/with/307746755\">#mathlib4 &gt; github permission</a>, as up to now I have worked on a separate repo.</p>\n<p>I have already discussed with <span class=\"user-mention\" data-user-id=\"218940\">@Charlie Conneen</span> about some formalization choices, and I am aware of their definition of <code>MonoClassifier.Classifier</code>. In the end I chose to stick with my initial definition of <code>Subobject.Classifier</code>. Here are some reasons why (long explanations ahead, beware):</p>\n<ul>\n<li><strong>Extensionality:</strong> the main reason is that I absolutely need the <em>extensional</em> version of subobject classifiers, i.e. the one that sends subobjects to their characteristic map, <strong>not</strong> monomorphisms. I have spent some time tinkering with the <em>intensional</em> definition that maps monos, which corresponds to Charlie's <code>MonoClassifier.Classifier</code> (and the definition in SGL I believe); I choose to call it <em>\"monomorphism classifier\"</em> to avoid ambiguity. I recorded the experiments in the file <a href=\"https://github.com/LMCRC/Topos-Theory/blob/subobject-classifier/ToposTheory/Mathlib/CategoryTheory/Subobject/MonoClassifier.lean\">MonoClassifier.lean</a>. My conclusion is that there is one big hurdle with that definition that makes it impossible to prove any representation theorem for it: there is no way to define a <code>Mono X</code> presheaf of monomorphisms over <code>X</code> that would be analogous to the <code>Sub X</code> presheaf of subobjects of <code>X</code>, because the <code>MonoOver.pullback</code> functor only preserves identities and compositions <em>up to isomorphism</em> (see <code>MonoOver.pullbackId</code> and <code>MonoOver.pullbackComp</code>). This is precisely why one needs the notion of subobject to \"strictify\" the category of monos into a skeletal one. I find it very confusing and unfortunate that in SGL they freely interchange monos and subobjects \"by a familiar abuse of language\", as this makes the statements of definitions and theorems unclear, and hides a lot of the complexity of proofs under the rug.</li>\n<li><strong>Terminal object:</strong> I chose to incorporate the existence (and choice of a) terminal object as an assumption <code>[HasTerminal C]</code>, instead of deducing that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"normal\">Ω</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\Omega_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\">Ω</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is terminal from the definition of <code>Classifier</code> (as is done in <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>'s formalization in Lean 3; it looks like it has now changed in Charlie's port). This makes definitions more concise by avoiding to carry around the extra <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"normal\">Ω</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\Omega_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\">Ω</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and does not complicate the proof of <code>hasClassifier_isRepresentable_iff</code>, although it is arguably less elegant.</li>\n<li><strong>Data types and notations:</strong> I have a slightly different way to package the data, which should be easily refactorable if required. For instance, I define <code>IsClassifier</code> as a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Π</mi></mrow><annotation encoding=\"application/x-tex\">\\Pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Π</span></span></span></span>-type rather than a structure since it has just one field, and I note the truth morphism <code>true!</code> instead of <code>t</code>. I have no problem aligning with Charlie's presentation, I guess we just need to settle on unified conventions.</li>\n</ul>\n<p>Sorry if this discussion was too detailed and should have been kept for the PR, but now it's off my mind :)</p>",
        "id": 500942994,
        "sender_full_name": "Pablo Donato",
        "timestamp": 1740075588
    },
    {
        "content": "<p>There has been much discussion about naming conventions in <a href=\"https://github.com/leanprover-community/mathlib4/pull/21281\">#21281</a>. A lot has been changed since our last discussion. You might have a look at that code. It will probably not take much to align our definitions, but at some point our results will definitely overlap.</p>",
        "id": 500948628,
        "sender_full_name": "Charlie Conneen",
        "timestamp": 1740077522
    }
]