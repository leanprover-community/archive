[
    {
        "content": "<p>The following error messages are displayed on Windows 11 when \"lake exe cache get\" in mathematics_in_lean folder according to the instruction in \"<a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a>\".</p>\n<hr>\n<p>installing leantar 0.1.14<br>\nuncaught exception: Tried to read from handle containing non UTF-8 data.</p>\n<hr>\n<p>Is there any idea to solve above?</p>",
        "id": 495527550,
        "sender_full_name": "Kenji Fujita",
        "timestamp": 1737646545
    },
    {
        "content": "<p>Are there any special characters in the target directory path or your home directory?</p>",
        "id": 495527919,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737646633
    },
    {
        "content": "<p>Hi Sebastian. Thank you for your advice. Therefore, no special characters are in target directory path or my home directory(as below). I tried \"lake exe cache get\" both in \"Git Bash\" and \"Git CMD\" but the results were same. I'm using Japanese version of Windows 11 which can be the reason?</p>\n<hr>\n<p>$ pwd<br>\n/c/Users/kenji/lean4/mathematics_in_lean</p>\n<p>kenji@Fujita MINGW64 ~/lean4/mathematics_in_lean (master)<br>\n$ cd</p>\n<p>kenji@Fujita MINGW64 ~<br>\n$ pwd<br>\n/c/Users/kenji</p>",
        "id": 495534876,
        "sender_full_name": "Kenji Fujita",
        "timestamp": 1737648383
    },
    {
        "content": "<p>I tried \"lake --verbose exe cache get\" as below and curious characters \"ÈÇÉÔΩπ\" which  cannot be read by Japanese people are displayed. This can be the reason.<br>\nIs there any solution?</p>\n<hr>\n<p>$ lake --verbose exe cache get<br>\nÈÇÉÔΩπ [2/10] Replayed Cache.IO<br>\ntrace: .&gt; LEAN_PATH=.\\.\\.lake/packages\\batteries\\.lake\\build\\lib;.\\.\\.lake/packages\\Qq\\.lake\\build\\lib;.\\.\\.lake/packages\\aesop\\.lake\\build\\lib;.\\.\\.lake/packages\\proofwidgets\\.lake\\build\\lib;.\\.\\.lake/packages\\Cli\\.lake\\build\\lib;.\\.\\.lake/packages\\importGraph\\.lake\\build\\lib;.\\.\\.lake/packages\\LeanSearchClient\\.lake\\build\\lib;.\\.\\.lake/packages\\plausible\\.lake\\build\\lib;.\\.\\.lake/packages\\mathlib\\.lake\\build\\lib;.\\.\\.lake\\build\\lib PATH c:\\Users\\kenji\\.elan\\toolchains\\leanprover--lean4---v4.13.0\\bin\\lean.exe -Dpp.unicode.fun=true -DautoImplicit=false -Dweak.linter.docPrime=true -Dweak.linter.hashCommand=true -Dweak.linter.oldObtain=true -Dweak.linter.refine=true -Dweak.linter.style.cdot=true -Dweak.linter.style.dollarSyntax=true -Dweak.linter.style.header=true -Dweak.linter.style.lambdaSyntax=true -Dweak.linter.style.longLine=true -Dweak.linter.style.longFile=1500 -Dweak.linter.style.missingEnd=true -Dweak.linter.style.multiGoal=true -Dweak.linter.style.setOption=true .\\.\\.lake/packages\\mathlib\\.\\.\\Cache\\IO.lean -R .\\.\\.lake/packages\\mathlib\\.\\. -o .\\.\\.lake/packages\\mathlib\\.lake\\build\\lib\\Cache\\IO.olean -i .\\.\\.lake/packages\\mathlib\\.lake\\build\\lib\\Cache\\IO.ilean -c .\\.\\.lake/packages\\mathlib\\.lake\\build\\ir\\Cache\\IO.c --json<br>\n---- (omittied)-----<br>\nÈÇÉÔΩπ [10/10] Replayed cache<br>\ntrace: .&gt; c:\\Users\\kenji\\.elan\\toolchains\\leanprover--lean4---v4.13.0\\bin\\leanc.exe -o .\\.\\.lake/packages\\mathlib\\.lake\\build\\bin\\cache.exe .\\.\\.lake/packages\\mathlib\\.lake\\build\\ir\\Cache\\Main.c.o.noexport .\\.\\.lake/packages\\mathlib\\.lake\\build\\ir\\Cache\\IO.c.o.noexport .\\.\\.lake/packages\\mathlib\\.lake\\build\\ir\\Cache\\Hashing.c.o.noexport .\\.\\.lake/packages\\mathlib\\.lake\\build\\ir\\Cache\\Requests.c.o.noexport<br>\ninstalling leantar 0.1.14<br>\nuncaught exception: Tried to read from handle containing non UTF-8 data.</p>",
        "id": 495538218,
        "sender_full_name": "Kenji Fujita",
        "timestamp": 1737649340
    },
    {
        "content": "<p>I don't think so, that is your terminal misinterpreting Lake's output while the exception is internal to some Lean program</p>",
        "id": 495549995,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737652733
    },
    {
        "content": "<p>Can you tell us what's the output of <code>echo $HOMEPATH</code>, <code>echo $HOMEDRIVE</code> and <code>echo $USERPROFILE</code>?</p>",
        "id": 495558153,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737655451
    },
    {
        "content": "<p>Also, do you have any files whose name start with <code>leantar</code> in <code>$HOMEDRIVE\\$HOMEPATH\\.cache\\mathlib</code>?</p>",
        "id": 495558316,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737655510
    },
    {
        "content": "<p>If the answer to the last question is \"yes\", the problem is likely from curl's json output. To simulate what Cache is doing, please run <code>curl --request GET --fail --silent --write-out \"%{json}\\n\" https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar -o b9a8c5908014b028.ltar</code> and paste the output here. It should be a single very long line, with about 19k characters. You can also paste the output on <a href=\"http://pastebin.com\">pastebin.com</a> if you prefer.</p>",
        "id": 495559493,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737655921
    },
    {
        "content": "<p>See also <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/lake.20cache.20on.20Windows.20with.20Chinese.20locale\">#lean4 &gt; lake cache on Windows with Chinese locale</a>, where it is claimed that <a href=\"https://stackoverflow.com/questions/57131654/using-utf-8-encoding-chcp-65001-in-command-prompt-windows-powershell-window\">changing the system locale to UTF-8</a> is a workaround (but please run the above commands before trying this, since the data will be valuable!)</p>",
        "id": 495560977,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737656477
    },
    {
        "content": "<p>The followings are the result. curl's output were only \"test.json\" and I tried curl with \"-v\" option again.</p>\n<hr>\n<p>$ echo $HOMEPATH<br>\n\\Users\\kenji</p>\n<p>kenji@Fujita202212 MINGW64 ~/.cache/mathlib<br>\n$ echo $HOMEDRIVE<br>\nC:</p>\n<p>kenji@Fujita202212 MINGW64 ~/.cache/mathlib<br>\n$ echo $USERPROFILE<br>\nC:\\Users\\kenji</p>\n<p>kenji@Fujita202212 MINGW64 ~/.cache/mathlib<br>\n$ ls -la<br>\ntotal 0<br>\ndrwxr-xr-x 1 kenji 197121 0 Dec  3 21:43 ./<br>\ndrwxr-xr-x 1 kenji 197121 0 Dec  3 21:43 ../</p>\n<p>kenji@Fujita202212 MINGW64 ~/.cache/mathlib<br>\n$ curl --request GET --fail --silent --write-out test.json <a href=\"https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar\">https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar</a> -o b9a8c5908014b028.ltar<br>\ntest.json<br>\nkenji@Fujita202212 MINGW64 ~/.cache/mathlib<br>\n$ curl -v --request GET --fail --silent --write-out test.json <a href=\"https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar\">https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar</a> -o b9a8c5908014b028.ltar</p>\n<ul>\n<li>Host lakecache.blob.core.windows.net:443 was resolved.</li>\n<li>IPv6: (none)</li>\n<li>IPv4: 20.209.19.193</li>\n<li>Trying 20.209.19.193:443...</li>\n<li>schannel: disabled automatic use of client certificate</li>\n<li>schannel: next InitializeSecurityContext failed: CRYPT_E_NO_REVOCATION_CHECK (0x80092012) - Â§±Âäπ„ÅÆÈñ¢Êï∞„ÅØË®ºÊòéÊõ∏„ÅÆÂ§±Âäπ„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</li>\n<li>closing connection <a href=\"https://github.com/leanprover-community/mathlib4/pull/0\">#0</a><br>\ntest.json<br>\nkenji@Fujita202212 MINGW64 ~/.cache/mathlib</li>\n</ul>",
        "id": 495688567,
        "sender_full_name": "Kenji Fujita",
        "timestamp": 1737716733
    },
    {
        "content": "<p>Sorry, I messed up the command! It should have been <code>curl --request GET --fail --silent --write-out \"%{json}\\n\" https://lakecache.blob.core.windows.net/mathlib4/f/b9a8c5908014b028.ltar -o b9a8c5908014b028.ltar</code>. But I think the output with <code>-v</code> already gives us enough information to figure out what went wrong.</p>",
        "id": 495705652,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737722620
    },
    {
        "content": "<p>Basically, curl failed to verify the SSL certificate, and part of the error message is in (non-UTF8) Japanese. In other words, the encoding error is just masking a SSL certificate error. The most common reason for SSL certificate issues is antivirus software intercepting the connection with self-signed certificates; you can read <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/lake.20exe.20cache.20get.20errors/near/389019448\">#mathlib4 &gt; lake exe cache get errors @ üí¨</a> to see workarounds for most popular antivirus software. If you do use another antivirus software, let me know how it names the equivalent of \"encrypted connection scanning\" (or let me know what's the antivirus so we can figure it out together).</p>",
        "id": 495706572,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737722916
    },
    {
        "content": "<p>Thanks for good advice. Finally,  I succeeded \"lake exe cache get\" after disabling AVAST anti virus temporally.</p>",
        "id": 495715509,
        "sender_full_name": "Kenji Fujita",
        "timestamp": 1737725687
    }
]