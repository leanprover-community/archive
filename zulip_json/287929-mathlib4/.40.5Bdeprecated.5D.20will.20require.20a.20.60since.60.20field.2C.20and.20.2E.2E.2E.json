[
    {
        "content": "<p>I would like to merge <a href=\"https://github.com/leanprover/lean4/pull/6112\">lean#6112</a> \"<code>@[deprecated]</code> requires a replacement identifier or message, and a since field\"</p>",
        "id": 484048925,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732354383
    },
    {
        "content": "<p>This will</p>\n<ol>\n<li>prevent people accidentally leaving off a <code>since</code> field</li>\n<li>prevent people either accidentally not specifying a replacement, or intentional then giving no explanation of either what to do, or why it was removed.</li>\n</ol>\n<p>However this will require some fixes in Mathlib.</p>",
        "id": 484048960,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732354440
    },
    {
        "content": "<p>Proposal:</p>\n<blockquote>\n<p>For every deprecation in Mathlib with no replacement or explanation, we add something like \"Deprecation without replacement.\" or \"No deprecation message available.\", so I can merge <a href=\"https://github.com/leanprover/lean4/pull/6112\">lean#6112</a>, and then going forward things will naturally get better as we sweep out old deprecations.</p>\n</blockquote>",
        "id": 484049056,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732354516
    },
    {
        "content": "<p>I would like to get this done with minimum of fuss, so unless there is objection to merging <a href=\"https://github.com/leanprover/lean4/pull/6112\">lean#6112</a> in the first place, counter-proposals will hopefully come with offers to implement. :-)</p>",
        "id": 484049094,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732354551
    },
    {
        "content": "<p>I thought since was already required</p>",
        "id": 484052160,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732357096
    },
    {
        "content": "<p>Can we have a code action that prints the <code>since</code> field? I am one of those people that has to think for 5 seconds to know what date it is today.</p>",
        "id": 484060782,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732364779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.40.5Bdeprecated.5D.20will.20require.20a.20.60since.60.20field.2C.20and.20.2E.2E.2E/near/484052160\">said</a>:</p>\n<blockquote>\n<p>I thought since was already required</p>\n</blockquote>\n<p>I think only as mathlib linter. <code>deprecated</code> will not currently warn/error if you omit <code>since</code>.</p>",
        "id": 484060836,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732364833
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.40.5Bdeprecated.5D.20will.20require.20a.20.60since.60.20field.2C.20and.20.2E.2E.2E/near/484060782\">said</a>:</p>\n<blockquote>\n<p>Can we have a code action that prints the <code>since</code> field? I am one of those people that has to think for 5 seconds to know what date it is today.</p>\n</blockquote>\n<p>Do you know about the two autocompletes <code>deprecated</code> and <code>deprecated alias</code> I have added a few months ago already?</p>",
        "id": 484060937,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732364916
    },
    {
        "content": "<p>No, I don't!</p>",
        "id": 484062566,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732366423
    },
    {
        "content": "<p>Please tell me more <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 484062573,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732366432
    },
    {
        "content": "<p>Say I want to rename <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.nonempty_of_nonempty_subtype#doc\">docs#Set.nonempty_of_nonempty_subtype</a> to <code>Set.Nonempty.of_subtype</code>. First I rename the lemma the usual way. Then under the newly renamed <code>Set.Nonempty.of_subtype</code> I type <code>deprecated alias</code> (or some keysmash approximation of it) to get <a href=\"/user_uploads/3121/K8V2nJVXg0G-Ce2PpaEOrQmt/image.png\">this autocompletion</a>. I hit TAB, <br>\n<a href=\"/user_uploads/3121/w8Nelyroa3C3KuMeamslEWRQ/image.png\">enter the deprecated name</a>, hit TAB again to navigate to the next field and <a href=\"/user_uploads/3121/4TgtSRDCvWt5YvpyypYjip99/image.png\">enter the new name</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/K8V2nJVXg0G-Ce2PpaEOrQmt/image.png\" title=\"this autocompletion\"><img data-original-dimensions=\"909x147\" src=\"/user_uploads/thumbnail/3121/K8V2nJVXg0G-Ce2PpaEOrQmt/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/w8Nelyroa3C3KuMeamslEWRQ/image.png\" title=\"enter the deprecated name\"><img data-original-dimensions=\"863x109\" src=\"/user_uploads/thumbnail/3121/w8Nelyroa3C3KuMeamslEWRQ/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/4TgtSRDCvWt5YvpyypYjip99/image.png\" title=\"enter the new name\"><img data-original-dimensions=\"946x111\" src=\"/user_uploads/thumbnail/3121/4TgtSRDCvWt5YvpyypYjip99/image.png/840x560.webp\"></a></div>",
        "id": 484062996,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732366801
    },
    {
        "content": "<p>(btw this is <a href=\"https://github.com/leanprover-community/mathlib4/pull/19408\">#19408</a>)</p>",
        "id": 484063192,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732366955
    },
    {
        "content": "<p>I swear I used a command like \"deprecate from\" or similar that also did the rename this week, and now I can't find it anymore</p>",
        "id": 484064502,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732368095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>  has a <code>deprecateTo</code> command, right?</p>",
        "id": 484064575,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732368129
    },
    {
        "content": "<p>Ruben, Johan: is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">deprecate</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">new_name</span><span class=\"w\"> </span><span class=\"n\">new_name₂</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"n\">new_nameₙ</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">old_name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n</code></pre></div>\n<p>what you are thinking about?</p>",
        "id": 484065714,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732369057
    },
    {
        "content": "<p>I think so, yeah. Funnily it fails in the web editor with process 'date' exited with code 255</p>",
        "id": 484067146,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732370348
    },
    {
        "content": "<p>Yes, since the date is \"computed\" via a shell call.  Maybe now that there is a Lean date package (I think), I could update the command.  I simply was not too sure if people were actually using it or not.</p>",
        "id": 484067298,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732370479
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/287929-mathlib4/topic/.40.5Bdeprecated.5D.20will.20require.20a.20.60since.60.20field.2C.20and.20.2E.2E.2E/near/484060782\">said</a>:</p>\n<blockquote>\n<p>Can we have a code action that prints the <code>since</code> field? I am one of those people that has to think for 5 seconds to know what date it is today.</p>\n</blockquote>\n<p>A code action will always be better (in that it'll be more portable across editors), but I'll also mention that you always have the possibility of:</p>\n<div class=\"codehilite\" data-code-language=\"Lua\"><pre><span></span><code><span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">keymap</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s1\">'n'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;LocalLeader&gt;D'</span><span class=\"p\">,</span> <span class=\"kr\">function</span><span class=\"p\">()</span>\n  <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"s1\">'telescope.builtin'</span><span class=\"p\">).</span><span class=\"n\">lsp_document_symbols</span> <span class=\"p\">{</span>\n    <span class=\"n\">attach_mappings</span> <span class=\"o\">=</span> <span class=\"kr\">function</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">map</span><span class=\"p\">)</span>\n      <span class=\"n\">map</span><span class=\"p\">(</span><span class=\"s1\">'i'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;CR&gt;'</span><span class=\"p\">,</span> <span class=\"kr\">function</span><span class=\"p\">(</span><span class=\"n\">prompt_bufnr</span><span class=\"p\">)</span>\n        <span class=\"kd\">local</span> <span class=\"n\">selected</span> <span class=\"o\">=</span> <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"s1\">'telescope.actions.state'</span><span class=\"p\">).</span><span class=\"n\">get_selected_entry</span><span class=\"p\">()</span>\n        <span class=\"nb\">require</span><span class=\"p\">(</span><span class=\"s1\">'telescope.actions'</span><span class=\"p\">).</span><span class=\"n\">close</span><span class=\"p\">(</span><span class=\"n\">prompt_bufnr</span><span class=\"p\">)</span>\n        <span class=\"kd\">local</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">selected</span><span class=\"p\">.</span><span class=\"n\">symbol_name</span>\n        <span class=\"kd\">local</span> <span class=\"n\">linenr</span> <span class=\"o\">=</span> <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">api</span><span class=\"p\">.</span><span class=\"n\">nvim_win_get_cursor</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"kd\">local</span> <span class=\"n\">date</span> <span class=\"o\">=</span> <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">fn</span><span class=\"p\">.</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s1\">'%Y-%m-%d'</span><span class=\"p\">)</span>\n        <span class=\"kd\">local</span> <span class=\"n\">attribute</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">'@[deprecated %s (since := \"%s\")]'</span><span class=\"p\">):</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">date</span><span class=\"p\">)</span>\n        <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">api</span><span class=\"p\">.</span><span class=\"n\">nvim_buf_set_lines</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">linenr</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">linenr</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"n\">attribute</span> <span class=\"p\">})</span>\n      <span class=\"kr\">end</span><span class=\"p\">)</span>\n      <span class=\"kr\">return</span> <span class=\"kc\">true</span>\n    <span class=\"kr\">end</span>\n  <span class=\"p\">}</span>\n<span class=\"kr\">end</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"n\">buffer</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"n\">desc</span> <span class=\"o\">=</span> <span class=\"s1\">'Insert a deprecation attribute using another declaration from the current file as the replacement'</span> <span class=\"p\">})</span>\n</code></pre></div>\n<p>I'll also also mention it seems someone added a <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.vscode/deprecated.code-snippets\">code snippet to the mathlib repo that does this</a> which you also could use (including in Neovim. Though it would be even better if this snippet were an LSP snippet).</p>",
        "id": 484067715,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732370820
    },
    {
        "content": "<p>There is also a shell script that you can run via <code>./scripts/add_deprecations.sh</code>.  If the git diff with master consists just of the renames of declarations, it should automatically add the deprecations with today's date.</p>",
        "id": 484067882,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732370953
    },
    {
        "content": "<p>If the git diff is bigger... well you may get lucky!</p>",
        "id": 484067903,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732370976
    },
    {
        "content": "<p>Okay, <a href=\"https://github.com/leanprover-community/mathlib4/pull/19426\">#19426</a> is the fixup for Mathlib</p>",
        "id": 484105283,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732405260
    },
    {
        "content": "<p>(and <a href=\"https://github.com/leanprover-community/ProofWidgets4/pull/89\">https://github.com/leanprover-community/ProofWidgets4/pull/89</a> for ProofWidgets)</p>",
        "id": 484105296,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732405278
    },
    {
        "content": "<p>I'll merge <a href=\"https://github.com/leanprover/lean4/pull/6112\">lean#6112</a> once this is in.</p>",
        "id": 484105301,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732405286
    }
]