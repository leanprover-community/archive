[
    {
        "content": "<p>In the past few days, something changed so that when I do <code>lake update</code> on <a href=\"https://github.com/dwrensha/compfiles\">compfiles</a>, there is a new step that takes a long time (a minute or two) and does not seem to accomplish anything:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">6748</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">dwrensha</span><span class=\"bp\">/</span><span class=\"n\">compfiles</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">6748</span><span class=\"bp\">/</span><span class=\"mi\">6748</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">success</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I believe this comes from <a href=\"https://github.com/leanprover-community/mathlib4/pull/25137\">mathlib4#25137</a>.</p>\n<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> is there any way to turn this behavior off?</p>",
        "id": 520419731,
        "sender_full_name": "David Renshaw",
        "timestamp": 1748257076
    },
    {
        "content": "<p>This is a result of that change and the Mathlib's post-update hook. You could turn off the hook by running <code>MATHLIB_NO_CACHE_ON_UPDATE=1 lake update</code> instead.</p>",
        "id": 520470630,
        "sender_full_name": "Mac Malone",
        "timestamp": 1748270469
    },
    {
        "content": "<p>Worse: on <a href=\"https://github.com/dwrensha/Rupert.lean\">this project</a> when I have my default git remote named to <code>github</code> instead of <code>origin</code>, I get this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"w\"> </span><span class=\"n\">post</span><span class=\"bp\">-</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">hooks</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">determine</span><span class=\"w\"> </span><span class=\"n\">project</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Ensure</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`origin</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"n\">points</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">project's</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"bp\">.</span>\n<span class=\"n\">Stdout</span><span class=\"o\">:</span>\n\n<span class=\"n\">Stderr</span><span class=\"o\">:</span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">origin'</span>\n\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n</code></pre></div>",
        "id": 520473254,
        "sender_full_name": "David Renshaw",
        "timestamp": 1748271239
    },
    {
        "content": "<p>same error on <code>lake exe cache get</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">determine</span><span class=\"w\"> </span><span class=\"n\">project</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Ensure</span><span class=\"w\"> </span><span class=\"n\">Git</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`origin</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"n\">points</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">project's</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"bp\">.</span>\n<span class=\"n\">Stdout</span><span class=\"o\">:</span>\n\n<span class=\"n\">Stderr</span><span class=\"o\">:</span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">origin'</span>\n</code></pre></div>",
        "id": 520473733,
        "sender_full_name": "David Renshaw",
        "timestamp": 1748271368
    },
    {
        "content": "<p>Should be fixed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25211\">mathlib4#25211</a>.</p>",
        "id": 520474229,
        "sender_full_name": "Mac Malone",
        "timestamp": 1748271525
    },
    {
        "content": "<p>I will second this. I'm a very novice Lean user so the following could be incompetence on my part, but I have a local project that's never been pushed to GitHub. It was working perfectly well for several months until I recently tried to change the imports and now I can't download any cached Mathlib files without pushing the whole project to GitHub. Of course I could just push to a private repository but this feels morally unnecessary.</p>",
        "id": 520474551,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748271618
    },
    {
        "content": "<p>Yep, this is a bug. The issue is that the new cache update should be detecting the repository of Mathlib not downstream dependents. There should be no need to push your projects to GitHub (notably, that wouldn't actually fix this bug anyway).</p>",
        "id": 520477624,
        "sender_full_name": "Mac Malone",
        "timestamp": 1748272496
    }
]