[
    {
        "content": "<p>Hi,<br>\nI think it would be beneficial to have two lemmas that connect <code>Nat.bodd</code> and <code>Odd</code>/<code>Even</code>.<br>\nOne of them I already have below:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Parity</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bits</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bodd_eq_true_iff_odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">odd_add_one</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"n\">by_contra</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"n\">by_contra</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">not_even_iff_odd</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">      </span><span class=\"n\">contradiction</span>\n</code></pre></div>\n<p>The other lemma would combine this with Even in the false case.</p>\n<hr>\n<p>Why would that be useful? I wanted to formally prove the correctness of the multiplication algorithm below: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)(</span><span class=\"n\">y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">z</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"n\">rename_i</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">bitwise_rec_lemma</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p><code>Nat.bodd</code> was needed as I wanted to use the <code>Nat.div2_succ</code> lemma and I used <code>Nat.odd_iff</code> to rewrite the modulo. I used the lemma above to combine it .</p>\n<hr>\n<p>If I am not overlooking something, I would like to have write access to add this to mathlib. If there are further useful lemmas connected to this, I am also open to add them to it. If that would be the case, which file would be more appropriate of the two I currently import?</p>\n<p>Or is there another different way to do this?</p>",
        "id": 488604875,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1734001045
    },
    {
        "content": "<p>This can be proven using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.bodd_eq_one_and_ne_zero#doc\">docs#Nat.bodd_eq_one_and_ne_zero</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Parity</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Bits</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bodd_eq_true_iff_odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">bodd_eq_one_and_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">odd_iff</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bodd_eq_false_iff_even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">bodd</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">bodd_eq_one_and_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">even_iff</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 488711359,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1734034725
    },
    {
        "content": "<p>Okay, that is simpler. Is it still useful to have it directly?</p>",
        "id": 488713133,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1734035491
    },
    {
        "content": "<p>I guess mathlib doesn't really use <code>Nat.bodd</code>, but it seems fine to add</p>",
        "id": 488718866,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734037879
    },
    {
        "content": "<p>How is <code>Nat.bodd</code> being used? Could we remove it instead?</p>",
        "id": 488738023,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734046782
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/13649\">#13649</a> might be relevant here</p>",
        "id": 488738136,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734046849
    },
    {
        "content": "<p>I left a comment on <a href=\"https://github.com/leanprover-community/mathlib4/pull/19666\">#19666</a>, which <a href=\"https://github.com/leanprover-community/mathlib4/pull/13649\">#13649</a> is waiting on.</p>",
        "id": 488739520,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734047778
    },
    {
        "content": "<p>But redefining <code>bodd</code> doesn't seem relevant to whether we want/need it in the first place. :-)</p>",
        "id": 488739554,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734047802
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/287929-mathlib4/topic/Connecting.20.60Nat.2Ebodd.60.20and.20.60Odd.60/near/488738023\">schrieb</a>:</p>\n<blockquote>\n<p>How is <code>Nat.bodd</code> being used? Could we remove it instead?</p>\n</blockquote>\n<p>I required it to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.div2_succ#doc\">docs#Nat.div2_succ</a> . It would also be fine and simpler for me, if the lemma does directly use mod2. I guess that replacement would always be possible, but perhaps this implementation of testing for oddness is faster.</p>",
        "id": 488790078,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1734078974
    },
    {
        "content": "<p>If the goal is to verify the multiplication algorithm, then I think it would be nice to do this in an arbitrary base, using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.digits#doc\">docs#Nat.digits</a></p>",
        "id": 488790748,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734079211
    },
    {
        "content": "<p>In principle yes, but adding this algorithm, which is essentially peasant multiplication, to mathlib wasn't my intent. It was an exercise in a course I teach the exercise sessions and one of my students was interested how we would be able to formalize the proof. One could also try to do it with digits, but this gets probably more complicated While doing the formal proof I noticed that such a lemma as on top might be helpful</p>",
        "id": 488792261,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1734079755
    },
    {
        "content": "<p>Aha, understood</p>",
        "id": 488792524,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734079843
    }
]