[
    {
        "content": "<p>This code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/-- `Finset.univ.sum` with better defeq for `Fin`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">attr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"`Finset.univ.prod` with better defeq for `Fin`.\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">One</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">castSucc</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>produces \"prod and sum do not generate the same number of equation lemmas.\".</p>",
        "id": 508910537,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743244988
    },
    {
        "content": "<p>I assume that lazy generation of these equations is to blame?</p>",
        "id": 508910554,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743245006
    },
    {
        "content": "<p>Is there a workaround besides defining the function twice?</p>",
        "id": 508910563,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743245018
    },
    {
        "content": "<p>I believe <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> tried to add support for <code>match</code>/equation compiler in <a href=\"https://github.com/leanprover-community/mathlib4/pull/16026\">#16026</a> <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive/Frontend.lean#L830-L835\">here</a>. Does the matcher info also affect the generated equational lemmas (which are generated <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive/Frontend.lean#L1254\">here</a>)?</p>",
        "id": 508914877,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743248706
    },
    {
        "content": "<p>Yes, matcherinfo is relevant, as the equations are split according to the matches on the RHS, and without the MatcherInfo they are not recognized as such</p>",
        "id": 511624205,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1744370077
    }
]