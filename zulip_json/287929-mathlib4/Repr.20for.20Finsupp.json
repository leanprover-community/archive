[
    {
        "content": "<p>I noticed that it is possible to print a <code>Finset</code> but not a <code>Finsupp</code>, which is a function with finite support.<br>\nI suggest the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Repr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finsupp</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">reprPrec</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Format</span><span class=\"bp\">.</span><span class=\"n\">paren</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Format</span><span class=\"bp\">.</span><span class=\"n\">joinSep</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">unquot</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\" ↦ \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"_ ↦ \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)])</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"s2\">\";\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Format</span><span class=\"bp\">.</span><span class=\"n\">line</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>As an example, here's how the prime factorization of a number looks like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorization</span><span class=\"w\"> </span><span class=\"mi\">5040</span>\n<span class=\"c1\">-- (2 ↦ 4; 3 ↦ 2; 5 ↦ 1; 7 ↦ 1; _ ↦ 0)</span>\n</code></pre></div>\n<p>The syntax is roughly based on notation from <a href=\"https://softwarefoundations.cis.upenn.edu/lf-current/Maps.html\">Rocq's Software Foundations</a>.</p>\n<p>I'm not sure which brackets (<code>(</code> or <code>[</code> or <code>{</code>) and separator (<code>;</code> or <code>,</code>) are the best for this.<br>\nWhat do you think?</p>\n<p>Also, should there be a corresponding notation for constructing <code>Finsupp</code>?</p>",
        "id": 535740754,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1755889709
    },
    {
        "content": "<p>Could we make this notation parsable back into a <code>Finsupp</code>?</p>",
        "id": 535741767,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755890100
    },
    {
        "content": "<p>I thought we had one, like <code>fin_0</code> or something</p>",
        "id": 535741963,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755890175
    },
    {
        "content": "<p>I'm not sure how to implement notation like this, do you know where the <code>Set</code> notation is implemented for reference?<br>\nI found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Insert#doc\">docs#Insert</a> which is somehow related to the notation</p>",
        "id": 535744034,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1755891044
    },
    {
        "content": "<p>This is the current syntax:<br>\n<code>fun n ↦ match n with | 2 =&gt; 4 | 3 =&gt; 2 | 5 =&gt; 1 | 7 =&gt; 1 | _ =&gt; 0</code><br>\nalthough it doesn't know that it's a <code>Finsupp ℕ ℕ</code>.<br>\nShould we use <code>|</code> for separators in the <code>Repr</code>?</p>",
        "id": 535745267,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1755891566
    },
    {
        "content": "<p>I think we already have a repr for Finsupp?</p>",
        "id": 535748376,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755893018
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finsupp.instRepr#doc\">docs#Finsupp.instRepr</a></p>",
        "id": 535748546,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755893098
    },
    {
        "content": "<p>Oh, I tried <code>#synth Repr (Finsupp α M)</code> and got nothing, because I didn't <code>import Mathlib.Data.Finsupp.Notation</code> <span aria-label=\"sweat\" class=\"emoji emoji-1f613\" role=\"img\" title=\"sweat\">:sweat:</span><br>\nSorry</p>",
        "id": 535749850,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1755893648
    },
    {
        "content": "<p>Generally it's better to import mathlib when trying to find out if something exists</p>",
        "id": 535789786,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755935563
    }
]