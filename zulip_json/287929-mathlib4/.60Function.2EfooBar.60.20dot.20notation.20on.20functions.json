[
    {
        "content": "<p>Something is wrong with how dot-notation for functions is elaborated<br>\nFor example, we have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Porting note: Dot notation on `Function.update` broke</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">update_sup</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">SemilatticeSup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ï€</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Ï€</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ï€</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">âŠ”</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">âŠ”</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\"> </span><span class=\"c1\">-- update f i (a âŠ” b) = update f i a âŠ” update f i b := -- this is what it is on `master`</span>\n</code></pre></div>\n<p>Swapping the comment on the last two lines gives an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">â–¼</span><span class=\"w\"> </span><span class=\"mi\">840</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"bp\">-</span><span class=\"mi\">840</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span>\n<span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">i</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">21538</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">21591</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imax</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">21530</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">21529</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Can someone help me understand where the elaboration happens? Because it seems to plug the codomain in the slot for the domain, and the function in the slot for the codomain...</p>",
        "id": 514788963,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1745839888
    },
    {
        "content": "<p>It plugs in <code>Function.update (Î² := f)</code></p>",
        "id": 514790904,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745840454
    },
    {
        "content": "<p>See <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/flip.20vs.20swap/near/500278066\">#mathlib4 &gt; flip vs swap @ ðŸ’¬</a></p>",
        "id": 514791187,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745840537
    },
    {
        "content": "<p>(cc <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>)</p>",
        "id": 514791269,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1745840566
    },
    {
        "content": "<p>see here for the implementation: <a href=\"https://github.com/leanprover/lean4/blob/6c9158b5b77bd50db06c242fcd411e11667daad1/src/Lean/Elab/App.lean#L1184-L1189\">https://github.com/leanprover/lean4/blob/6c9158b5b77bd50db06c242fcd411e11667daad1/src/Lean/Elab/App.lean#L1184-L1189</a></p>",
        "id": 514791683,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1745840694
    },
    {
        "content": "<p>not recommended, but <code>Ï€.update f i (a âŠ” b)</code> works</p>",
        "id": 514792423,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745840909
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Is the dotParam idea still on the table? Should I mark example like in OP with some github tracking issue?</p>",
        "id": 514802176,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1745843695
    },
    {
        "content": "<p>I glanced through the Function. namespace, also problematic are <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.dcomp#doc\">docs#Function.dcomp</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.eval#doc\">docs#Function.eval</a> (and theorems named after them)</p>",
        "id": 514946975,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1745898743
    }
]