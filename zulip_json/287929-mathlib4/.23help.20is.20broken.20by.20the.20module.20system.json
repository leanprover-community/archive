[
    {
        "content": "<p>In the process of creating such a test I found out that <code>#help</code> is broken even when importing all of Mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/-- error: no tactic declarations start with exact -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">help</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">exact</span>\n</code></pre></div>\n<p>Being in a module somehow causes <code>#help</code> to not see any syntax tokens.<br>\nSearching for <code>exact</code> in <code>#help tactic</code> shows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">exact</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"ss\">`exact</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">closes</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"ss\">`e</span><span class=\"bp\">`.</span>\n</code></pre></div>\n<p>and without the <code>module</code> it shows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"exact\"</span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">exact</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"ss\">`exact</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">closes</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"ss\">`e</span><span class=\"bp\">`.</span>\n</code></pre></div>",
        "id": 573348229,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770831061
    },
    {
        "content": "<p><a href=\"#narrow/channel/287929-mathlib4/topic/.23help.20is.20broken.20by.20the.20module.20system/near/573348229\">A message</a> was moved here from <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/.23lint.20is.20broken/with/573358540\">#mathlib4 &gt; #lint is broken</a> by <span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span>.</p>",
        "id": 573398011,
        "sender_full_name": "Notification Bot",
        "timestamp": 1770848408
    },
    {
        "content": "<p>Let me split this into its own topic - this deserves its own discussion and fix :-)</p>",
        "id": 573398054,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1770848429
    },
    {
        "content": "<p>Sorry forgot to link <a href=\"#narrow/channel/270676-lean4/topic/Accessing.20.60Expr.60.20of.20a.20def.20across.20modules\">#lean4 &gt; Accessing &#96;Expr&#96; of a def across modules</a>  <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 573398116,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770848458
    },
    {
        "content": "<p>Also <code>#help</code> is in Batteries</p>",
        "id": 573398169,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770848475
    },
    {
        "content": "<p>As far as I can tell, this is irremediably broken under the module system, the information simply isn't there. We could mark all parser declarations as <code>public</code>? I don't think this would be a good idea.</p>",
        "id": 573662250,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1770956337
    },
    {
        "content": "<p>Could we put all the parser declarations in the server oleans?</p>",
        "id": 573669747,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1770961624
    },
    {
        "content": "<p>Well, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.mkParserOfConstant#doc\">docs#Lean.Parser.mkParserOfConstant</a> still works under the module system (it's running the interpreter, after all), see <a href=\"#narrow/channel/270676-lean4/topic/Accessing.20.60Expr.60.20of.20a.20def.20across.20modules/near/573382515\">the other thread</a></p>",
        "id": 573690764,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770972065
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/1669\">batteries#1669</a></p>",
        "id": 573726861,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770984513
    }
]