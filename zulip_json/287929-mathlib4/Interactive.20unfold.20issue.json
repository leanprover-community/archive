[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> I wanted to advertise <code>unfold?</code> in MIL but the example I wanted actually doesn’t work.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkVectorSpace</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ρ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">AddMonoid</span><span class=\"bp\">.</span><span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ρ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">smul_zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">smul_add</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">add_smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">zero_smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>And try to start proving <code>one_smul</code>. This is a typical case where beginners are completely stuck because <code>ρ</code> does not appear in the goal. I wanted to say: type <code>unfold?</code>, shift-click on the bullet and select <code>ρ 1</code>. But it creates a <code>rw</code> that doesn’t work. Why not creating a <code>change</code> instead? Note that <code>one_smul x := by change ρ 1 x = _ ; sorry</code> does work.</p>",
        "id": 473440325,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727609238
    },
    {
        "content": "<p>I see, the problem is that the notation <code>1 • x</code> which is used in the goal, and put in the <code>rw</code> tactic, doesn't elaborate to the expression with <code>ρ</code> that we want. Emitting a <code>change</code> tactic instead of a <code>rw [show .. = .. from rfl]</code> seems reasonable too. However, I'm not sure how to make the underscores appear in the expression, such as in <code>ρ 1 x = _</code>.</p>",
        "id": 473622667,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1727680968
    },
    {
        "content": "<p>It would also be nice to be able to evaluate whether a pasted tactic will succeed, before actually pasting it.</p>",
        "id": 473622966,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1727681034
    },
    {
        "content": "<p>Yes, that’s an elaboration issue. About the <code>change</code> version, generating the underscore for parts that didn’t change isn’t essential, although it would be nice. And indeed evaluating whether the pasted tactic will succeed would be much more user-friendly.</p>",
        "id": 473656000,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1727687656
    },
    {
        "content": "<p>For <code>_</code>-insertion, you could annotate the unchanged subexpressions with some metadata and create a delaborator keyed to that metadata that returns <code>_</code></p>",
        "id": 473767999,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727709453
    }
]