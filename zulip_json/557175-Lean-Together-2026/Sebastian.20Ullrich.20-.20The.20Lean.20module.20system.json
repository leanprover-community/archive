[
    {
        "content": "<p>Discussion thread for the talk.</p>",
        "id": 569043794,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1768919877
    },
    {
        "content": "<p>What do <code>backward.proofsInPublic</code> and <code>backward.privateInPublic</code> do?<br>\nIf I remove a usage of one of them in Mathlib, what would break and how would I attempt to fix it?</p>",
        "id": 569050830,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1768921333
    },
    {
        "content": "<p>Does the hiding of def bodies mean that what is considered \"defeq abuse\" and what isn't should reduce eventually a bit towards whether the def is <code>@[expose]</code> or not? And/or someone communicates to others whether the def is meant to be unfolded outside of its API by explicitly preventing doing so / not having it be exposed?</p>",
        "id": 569050985,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768921366
    },
    {
        "content": "<p>I'll have to step away from Zulip for a bit but let me share my slides in the meantime!</p>\n<p><a href=\"/user_uploads/3121/Ab0rFqGqqj4_5e5Ek9fyU5QR/Module-System-Lean-Together-1.pdf\">Module System @ Lean Together-1.pdf</a></p>",
        "id": 569051531,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1768921487
    },
    {
        "content": "<p>I had two questions I didn't get a chance to ask:</p>\n<ul>\n<li>I have seen some PRs about the module system and reducibility, can you explain how they are related? (Thinking along the lines of Julian's defeq abuse question)</li>\n<li>For meta sections, is it now encouraged to isolate meta sections into their own files? I know the reference manual mentions a bit about this, but I don't quite understand the implications of files that were ported and currently have a mix of <code>meta</code> sections among other visibilities.</li>\n</ul>",
        "id": 569052453,
        "sender_full_name": "Chris Henson",
        "timestamp": 1768921689
    },
    {
        "content": "<p>On the question of whether the module system will eventually be compulsory, <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span>  indicated (paraphrasing): \"probably not, but we want to get to a place where it always makes sense to use it.\"</p>\n<p>I see a problem with this not <em>eventually</em> being compulsory. As use of the module system grows, it becomes increasingly important that its use is not just ubiquitous, but mandatory. Let's say I have a project X with several dependencies A, B, and C. The dependencies all use the module system, and, wanting to get its benefits, I adapt project X to the module system. Then later, I decide I would like to import a new project D. But, the author of D, out of not caring terribly much, or not wanting to bother, decided <em>not</em> to use the module system. Then I either can't import D into my project, or I am forced to downgrade away from the module system myself (and I can imagine cases in which project D is important enough to cause this downgrade to project X). Then you end up in a scenario in which the module system is not adopted widely solely because it's use is not mandatory, and a few important projects choose not to use it.</p>",
        "id": 569052847,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1768921772
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"687698\">Chris Henson</span> <a href=\"#narrow/channel/557175-Lean-Together-2026/topic/Sebastian.20Ullrich.20-.20The.20Lean.20module.20system/near/569052453\">schrieb</a>:</p>\n<blockquote>\n<p>I  have seen some PRs about the module system and reducibility, can you explain how they are related?</p>\n</blockquote>\n<p>If you have a <code>def</code> that is <code>public</code> but not <code>exposed</code>, then in downstream modules, it is <code>opaque</code>, so cannot be reduced (e.g. by <code>rfl</code>).</p>",
        "id": 569069458,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1768925329
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/557175-Lean-Together-2026/topic/Sebastian.20Ullrich.20-.20The.20Lean.20module.20system/near/569052847\">said</a>:</p>\n<blockquote>\n<p>I see a problem with this not <em>eventually</em> being compulsory.</p>\n</blockquote>\n<p>Your reasoning makes sense. When we have made the module system always desirable, I do think we will want to at the very least heavily encourage its use (such as by making it the default, but don't nail me down on that thought quite yet) at which point it may not be much different from make it obligatory in case we don't want to go that far - at that point opting out of it would just become one of many ways you can ensure people will not want to use your library. But we will get to that decision in time and see what approach makes most sense for the ecosystem as a whole.</p>",
        "id": 569071558,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1768925820
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/557175-Lean-Together-2026/topic/Sebastian.20Ullrich.20-.20The.20Lean.20module.20system/near/569050830\">said</a>:</p>\n<blockquote>\n<p>What do <code>backward.proofsInPublic</code> and <code>backward.privateInPublic</code> do?<br>\nIf I remove a usage of one of them in Mathlib, what would break and how would I attempt to fix it?</p>\n</blockquote>\n<p>Please see <a href=\"https://lean-lang.org/doc/reference/latest/Source-Files-and-Modules/#module-scopes\">ยง5.4</a> for a description and examples of these options. To eliminate <code>privateInPublic</code>, generally speaking you'll just have to think through whether you can restructure your file so that the private definition truly is used only in the private scope. To eliminate <code>proofsInPublic</code> uses that are still necessary even after resolving <code>privateInPublic</code>, it may be necessary to ensure the expected type of the <code>by</code> is fully known such as through additional type annotations.</p>",
        "id": 569074645,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1768926581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"687698\">Chris Henson</span> <a href=\"#narrow/channel/557175-Lean-Together-2026/topic/Sebastian.20Ullrich.20-.20The.20Lean.20module.20system/near/569052453\">said</a>:</p>\n<blockquote>\n<ul>\n<li>For meta sections, is it now encouraged to isolate meta sections into their own files? I know the reference manual mentions a bit about this, but I don't quite understand the implications of files that were ported and currently have a mix of <code>meta</code> sections among other visibilities.</li>\n</ul>\n</blockquote>\n<p>I would say that's a good suggestion for bigger meta sections. If you remove the section and instead <code>meta import</code> that code, you also open up the code to use in non-meta contexts, but depending on the specific case that might not be too relevant.</p>",
        "id": 569076481,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1768927024
    },
    {
        "content": "<p>I am hitting an error trying to use <code>Modulize.lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lean<span class=\"w\"> </span>--run<span class=\"w\"> </span>../lean4/script/Modulize.lean<span class=\"w\"> </span><span class=\"k\">$(</span>find<span class=\"w\"> </span>FltRegular<span class=\"w\"> </span>-name<span class=\"w\"> </span><span class=\"s1\">'*.lean'</span><span class=\"k\">)</span><span class=\"w\"> </span>FltRegular.lean\n\n../lean4/script/Modulize.lean:60:27:<span class=\"w\"> </span>error<span class=\"o\">(</span>lean.synthInstanceFailed<span class=\"o\">)</span>:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>synthesize<span class=\"w\"> </span>instance<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>class\n<span class=\"w\">  </span>OfNat<span class=\"w\"> </span>text.Pos<span class=\"w\"> </span><span class=\"m\">0</span>\nnumerals<span class=\"w\"> </span>are<span class=\"w\"> </span>polymorphic<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>Lean,<span class=\"w\"> </span>but<span class=\"w\"> </span>the<span class=\"w\"> </span>numeral<span class=\"w\"> </span><span class=\"sb\">`</span><span class=\"m\">0</span><span class=\"sb\">`</span><span class=\"w\"> </span>cannot<span class=\"w\"> </span>be<span class=\"w\"> </span>used<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>a<span class=\"w\"> </span>context<span class=\"w\"> </span>where<span class=\"w\"> </span>the<span class=\"w\"> </span>expected<span class=\"w\"> </span><span class=\"nb\">type</span><span class=\"w\"> </span>is\n<span class=\"w\">  </span>text.Pos\ndue<span class=\"w\"> </span>to<span class=\"w\"> </span>the<span class=\"w\"> </span>absence<span class=\"w\"> </span>of<span class=\"w\"> </span>the<span class=\"w\"> </span>instance<span class=\"w\"> </span>above\n</code></pre></div>\n<p>Am I doing something wrong?</p>",
        "id": 569248750,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1769000680
    },
    {
        "content": "<p>My bad, I noticed that breakage as well, now PRed at <a href=\"https://github.com/leanprover/lean4/pull/12079\">lean#12079</a></p>",
        "id": 569249535,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769000870
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 569249702,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1769000914
    },
    {
        "content": "<p>You might need <code>lean +nightly</code> to run it but as it only looks at syntax, that shouldn't create any further issues</p>",
        "id": 569249872,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769000962
    },
    {
        "content": "<p>It almost works perfectly for me. The only issue is that for some reason it didn't add <code>@[expose] public section</code> to the <a href=\"https://github.com/leanprover-community/flt-regular/blob/master/FltRegular/SmallNumbers/OrderOf.lean\">this file</a>. The file looks like any other file, but it contains only one declaration, without any <code>open</code> or <code>namespace</code> (and it only imports one single module from Mathlib, nothing else from the project).  If you want I can try to minimize, but I will not have time today.</p>",
        "id": 569251352,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1769001338
    },
    {
        "content": "<p>Ah... because the script does only work syntactically, it doesn't know about <code>lemma</code> and thinks the file is empty. <a href=\"https://github.com/leanprover/lean4/pull/12080\">lean#12080</a> disabuses it of that idea.</p>",
        "id": 569253634,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769001968
    }
]