[
    {
        "content": "<p>Here's the simplest example I could come up with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Â¬</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">contradiction</span>\n</code></pre></div>\n<p><code>set_option trace.Meta.Tactic.simp true</code> shows a trace for <code>simp</code> i.e what theorems <code>simp</code> used. </p>\n<p>I was expecting <code>set_option trace.Meta.Tactic.contradiction true</code> to do the same for <code>contradiction</code>.  I searched through <code>#help option</code> and this was the only <code>contradiction</code> related option I could find.</p>\n<p>I also tried <code>set_option trace.Meta.synthInstance true</code> which I read about in the docs somewhere.</p>\n<p>Any suggestions?</p>",
        "id": 527278917,
        "sender_full_name": "Jad Abou Hawili",
        "timestamp": 1751721381
    },
    {
        "content": "<p>I would suggest reading the source code for <code>contradiction</code>. You can get there with \"go to definition\" on <code>contradiction</code> and work your way through to see what it does.</p>",
        "id": 527285410,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751725997
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/trace.20for.20.60contradiction.60/near/527285410\">said</a>:</p>\n<blockquote>\n<p>I would suggest reading the source code for <code>contradiction</code>. You can get there with \"go to definition\" on <code>contradiction</code> and work your way through to see what it does.</p>\n</blockquote>\n<p>That's what I did before posting my question , but I didn't really know what I was looking at. </p>\n<p>Assuming this is what you mean,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">builtin_tactic</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">contradiction</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">evalContradiction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">liftMetaTactic</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">mvarId</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">mvarId</span><span class=\"bp\">.</span><span class=\"n\">contradiction</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>from Lean v4.17. Going further until i got to a Meta/Tactic/Contradiction.lean file but again I have no idea what I am looking at.</p>\n<p>In any case, if <code>trace.Meta.Tactic.contradiction</code> doesn't do what I expected then what is its purpose?</p>",
        "id": 527291556,
        "sender_full_name": "Jad Abou Hawili",
        "timestamp": 1751733110
    },
    {
        "content": "<p><code>Meta/Tactic/Contradiction.lean</code> is the implementation of the tactic</p>\n<p>If you search for <code>trace[Meta.Tactic.contradiction]</code> you can see a couple trace messages, which are for debugging.</p>",
        "id": 527291696,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751733274
    },
    {
        "content": "<p>It's relatively rare for tactics to explain exactly what they did through these trace classes, but at least all the source code is a couple clicks away, which makes learning the system's internals much easier than it could be.</p>",
        "id": 527291965,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751733627
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/trace.20for.20.60contradiction.60/near/527291696\">said</a>:</p>\n<blockquote>\n<p><code>Meta/Tactic/Contradiction.lean</code> is the implementation of the tactic</p>\n<p>If you search for <code>trace[Meta.Tactic.contradiction]</code> you can see a couple trace messages, which are for debugging.</p>\n</blockquote>\n<p>So <code>trace.Meta.Tactic.contradiction</code> would be working when contradiction fails.</p>\n<p>That's the impression I got from <code>trace[Meta.Tactic.contradiction] \"elimEmptyInductive out-of-fuel\"</code>.</p>\n<p>Is there anything that can be done to show the steps <code>contradiction</code> goes through to close a goal? I have a more complicated example where I don't understand why <code>contradiction</code> can close the goal.</p>",
        "id": 527292169,
        "sender_full_name": "Jad Abou Hawili",
        "timestamp": 1751733878
    },
    {
        "content": "<p>Maybe <code>show_term</code> will show you what is happening</p>",
        "id": 527292222,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751733913
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"714864\">Jad Abou Hawili</span> has marked this topic as resolved.</p>",
        "id": 527292860,
        "sender_full_name": "Notification Bot",
        "timestamp": 1751734802
    }
]