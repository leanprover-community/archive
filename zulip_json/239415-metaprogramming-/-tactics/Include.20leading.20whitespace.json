[
    {
        "content": "<p>I want to parse typst and distinguish between syntax such as <code>#box[] foo</code> and <code>#box[]foo</code>. The following code is self-contained:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span>\n\n<span class=\"sd\">/-- Plain text -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">withAntiquot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkAntiquot</span><span class=\"w\"> </span><span class=\"s2\">\"typText\"</span><span class=\"w\"> </span><span class=\"ss\">`typText</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">fn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">startPos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pos</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">takeWhile1Fn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"s2\">\"{}[]#$\"</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"expected Typst text\"</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">mkNodeToken</span><span class=\"w\"> </span><span class=\"ss\">`typText</span><span class=\"w\"> </span><span class=\"n\">startPos</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"kd\">@[</span><span class=\"n\">combinator_formatter</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"bp\">.</span><span class=\"n\">formatter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formatter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Formatter</span><span class=\"bp\">.</span><span class=\"n\">visitAtom</span><span class=\"w\"> </span><span class=\"ss\">``typText</span>\n<span class=\"kd\">@[</span><span class=\"n\">combinator_parenthesizer</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"bp\">.</span><span class=\"n\">parenthesizer</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parenthesizer</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Parenthesizer</span><span class=\"bp\">.</span><span class=\"n\">visitToken</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">typst</span>\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"#box[]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">typstPart</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typst</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#[\"</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"o\">:</span><span class=\"n\">typst</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{stx}\"</span>\n\n<span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">box</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>This prints</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">typst_</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">typstPart_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"s2\">\"foo \"</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">¬´</span><span class=\"n\">typstPart</span><span class=\"bp\">#</span><span class=\"n\">box</span><span class=\"o\">[]</span><span class=\"bp\">¬ª</span><span class=\"w\"> </span><span class=\"s2\">\"#box[]\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">typstPart_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"s2\">\"bar\"</span><span class=\"o\">))</span>\n<span class=\"o\">])</span>\n</code></pre></div>\n<p>which is missing the leading space. I want the third element to be <code>\" bar\"</code>. Can I do this?</p>",
        "id": 569017019,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1768913774
    },
    {
        "content": "<p>If you log <code>repr stx</code>, you can see the leading/trailing information in the SourceInfo, which is where whitespace is recorded.</p>\n<p>The whitespace is after <code>#box[]</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">                 </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">node</span>\n<span class=\"w\">                   </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">SourceInfo</span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"o\">)</span>\n<span class=\"w\">                   </span><span class=\"bp\">`¬´</span><span class=\"n\">typstPart</span><span class=\"bp\">#</span><span class=\"n\">box</span><span class=\"o\">[]</span><span class=\"bp\">¬ª</span>\n<span class=\"w\">                   </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">atom</span>\n<span class=\"w\">                       </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">SourceInfo</span><span class=\"bp\">.</span><span class=\"n\">original</span>\n<span class=\"w\">                         </span><span class=\"s2\">\"\"</span><span class=\"bp\">.</span><span class=\"n\">toRawSubstring</span>\n<span class=\"w\">                         </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">byteIdx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">721</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">                         </span><span class=\"s2\">\" \"</span><span class=\"bp\">.</span><span class=\"n\">toRawSubstring</span>\n<span class=\"w\">                         </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">byteIdx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">727</span><span class=\"w\"> </span><span class=\"o\">})</span>\n<span class=\"w\">                       </span><span class=\"s2\">\"#box[]\"</span><span class=\"o\">],</span>\n</code></pre></div>\n<p>Whitespace out of the parser is always trailing whitespace. It's possible to make a pass to move whitespace between nodes, to make it be leading, if that's what you want to do.</p>",
        "id": 569018869,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1768914234
    },
    {
        "content": "<blockquote>\n<p>It's possible to make a pass to move whitespace between nodes, to make it be leading, if that's what you want to do.</p>\n</blockquote>\n<p>Yeah that sounds like what I want to do! How do I do that?</p>",
        "id": 569019418,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1768914377
    },
    {
        "content": "<p>So far I've completely ignored SourceInfo.</p>",
        "id": 569019563,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1768914413
    },
    {
        "content": "<p>To show how you can work with trailing whitespace, here is an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span>\n\n<span class=\"sd\">/-- Plain text -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">withAntiquot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkAntiquot</span><span class=\"w\"> </span><span class=\"s2\">\"typText\"</span><span class=\"w\"> </span><span class=\"ss\">`typText</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">fn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">startPos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pos</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">takeWhile1Fn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"s2\">\"{}[]#$\"</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"expected Typst text\"</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">mkNodeToken</span><span class=\"w\"> </span><span class=\"ss\">`typText</span><span class=\"w\"> </span><span class=\"n\">startPos</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"kd\">@[</span><span class=\"n\">combinator_formatter</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"bp\">.</span><span class=\"n\">formatter</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formatter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Formatter</span><span class=\"bp\">.</span><span class=\"n\">visitAtom</span><span class=\"w\"> </span><span class=\"ss\">``typText</span>\n<span class=\"kd\">@[</span><span class=\"n\">combinator_parenthesizer</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"bp\">.</span><span class=\"n\">parenthesizer</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parenthesizer</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Parenthesizer</span><span class=\"bp\">.</span><span class=\"n\">visitToken</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">typst</span>\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">typText</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"#box[]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typstPart</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">typstPart</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">typst</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#[\"</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"o\">:</span><span class=\"n\">typst</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">‚ü®.</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">parts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntaxArray</span><span class=\"w\"> </span><span class=\"ss\">`typstPart</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">args</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">parts</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">trailing</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">getTrailing?</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">typstPart</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">text</span><span class=\"o\">:</span><span class=\"n\">typText</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">text</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">isLit?</span><span class=\"w\"> </span><span class=\"ss\">`typText</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">get!</span>\n<span class=\"w\">      </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{out}Text: {str.quote}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">typstPart</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">box</span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{out}Box</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">throwUnsupportedSyntax</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">trailing</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{out}Trailing whitespace: {trailing.quote}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">out</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Text: \"foo \"</span>\n<span class=\"sd\">Box</span>\n<span class=\"sd\">Trailing whitespace: \" \"</span>\n<span class=\"sd\">Text: \"bar\"</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">box</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 569024717,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1768915697
    },
    {
        "content": "<p>I would've preferred <code>let `(typst| $parts:typstPart*) := stx</code> but that doesn't work so I had to do a manual match</p>",
        "id": 569025189,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1768915810
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Include.20leading.20whitespace/near/569025189\">said</a>:</p>\n<blockquote>\n<p>I would've preferred <code>let `(typst| $parts:typstPart*) := stx</code> but that doesn't work so I had to do a manual match</p>\n</blockquote>\n<p>what about <code>(typst| $[$parts:typstPart]*)</code></p>",
        "id": 569026386,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768916083
    },
    {
        "content": "<p>Wonderful, that works! And it's a rather elegant solution too:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">parts</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span><span class=\"cm\"> match on part ... -/</span>\n<span class=\"w\">  </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">part</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">getTrailing?</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">toString</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Thank you so much ^^</p>",
        "id": 569026617,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1768916133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Include.20leading.20whitespace/near/569026386\">schrieb</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Include.20leading.20whitespace/near/569025189\">said</a>:</p>\n<blockquote>\n<p>I would've preferred <code>let `(typst| $parts:typstPart*) := stx</code> but that doesn't work so I had to do a manual match</p>\n</blockquote>\n<p>what about <code>(typst| $[$parts:typstPart]*)</code></p>\n</blockquote>\n<p>Doesn't work either. The problem is that <code>typText</code> also matches through the <code>)</code> of the quotation, so you end up with <code>typText</code> that extends until the next <code>{</code>.</p>",
        "id": 569032716,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1768917558
    }
]