[
    {
        "content": "<p>I'm going through <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/\">https://leanprover-community.github.io/lean4-metaprogramming-book/</a> and encountering the first \"Building a command\" example <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/#building-a-command\">https://leanprover-community.github.io/lean4-metaprogramming-book/#building-a-command</a></p>\n<p>With the <code>#assertType</code>example code there, I'm getting \"success\" return from my editor (neovim) regardless of whether I give a valid or invalid type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">assertType</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">failed to synthesize</span>\n<span class=\"sd\">  OfNat String 4</span>\n<span class=\"sd\">numerals are polymorphic in Lean, but the numeral `4` cannot be used in a context where the expected type is</span>\n<span class=\"sd\">  String</span>\n<span class=\"sd\">due to the absence of the instance above</span>\n\n<span class=\"sd\">Hint: Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n\n<span class=\"sd\">▼ 20:1-20:23: information:</span>\n<span class=\"sd\">success</span>\n<span class=\"sd\">-/</span>\n</code></pre></div>\n<p>Is this expected, or is something broken about my editor setup or the code in the example?</p>",
        "id": 560989770,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1764500601
    },
    {
        "content": "<p><code>#assertType \"s\" : Nat</code> also fails but logs the string \"success\", so this isn't just some weirdness with numeral polymorphism</p>",
        "id": 560989880,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1764500702
    },
    {
        "content": "<p>So far, I can confirm it is not an editor issue -- apparently <code>elabTermEnsuringType</code> doesn't throw an exception, only logs an error. I suppose it should be enclosed into a function that throws an exception in case of an error but I don't remember how it is called.</p>",
        "id": 561014530,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1764521444
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#assertType \"</span><span class=\"w\"> </span><span class=\"n\">termStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"s2\">\" : \"</span><span class=\"w\"> </span><span class=\"n\">typeStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"n\">liftTermElabM</span>\n<span class=\"w\">    </span><span class=\"n\">try</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">tp</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">elabType</span><span class=\"w\"> </span><span class=\"n\">typeStx</span>\n<span class=\"w\">      </span><span class=\"n\">withoutErrToSorry</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span>\n<span class=\"w\">        </span><span class=\"n\">discard</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">elabTermEnsuringType</span><span class=\"w\"> </span><span class=\"n\">termStx</span><span class=\"w\"> </span><span class=\"n\">tp</span>\n<span class=\"w\">      </span><span class=\"n\">synthesizeSyntheticMVarsNoPostponing</span>\n<span class=\"w\">      </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"success\"</span>\n<span class=\"w\">    </span><span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"failure\"</span>\n</code></pre></div>",
        "id": 561014929,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1764521797
    }
]