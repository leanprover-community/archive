[
    {
        "content": "<p>I have the following code</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abc</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xyz</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">test_cat</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"abc\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">test_cat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">xyz</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>In the example on the top it matches abc as expected but in the bottom one I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"n\">token</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">abc'</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"bp\">'_'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">identifier</span>\n</code></pre></div>\n<p>because of the syntax declaration<br>\nHowever, according to <a href=\"https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Defining-New-Syntax/#syntax-rules\">The Lean Language Reference</a></p>\n<blockquote>\n<p>When multiple syntax rules for a category can match the current input, the <a href=\"https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Custom-Operators/#--tech-term-local-longest-match-rule\">local longest-match rule</a> is used to select one of them. Like notations and operators, if there is a tie for the longest match then the declared priorities are used to determine which parse result applies. If this still does not resolve the ambiguity, then all the results that tied are saved. <strong>The elaborator is expected to attempt all of them, succeeding when exactly one can be elaborated.</strong></p>\n</blockquote>\n<p>Which should be the case here since there's no elaboration defined for abc, yet it still fails?</p>",
        "id": 569784783,
        "sender_full_name": "Syed Shaazib Tanvir",
        "timestamp": 1769194484
    },
    {
        "content": "<p>i believe the issue is that <code>abc</code> is no longer a valid identifier, since the <code>syntax</code> declaration makes it reserved</p>",
        "id": 569789032,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769196302
    },
    {
        "content": "<p>you can fix this by adding a <code>&amp;</code> before the string in the syntax declaration:<br>\n<code>syntax &amp;\"abc\" : test_cat</code></p>",
        "id": 569789123,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769196339
    },
    {
        "content": "<p>another (possibly more durable) option is to make your syntax <code>scoped</code> to some namespace. This way, <code>abc</code> will only be reserved in the namespace where you declare the syntax. If in that namespace you still want to refer to the identifier instead of the syntax, you can use french quotes: <code>«abc»</code></p>",
        "id": 569791985,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769197644
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Why.20does.20the.20elaborator.20fail.20with.20conflicting.20syntax.3F/near/569789032\">said</a>:</p>\n<blockquote>\n<p>i believe the issue is that <code>abc</code> is no longer a valid identifier, since the <code>syntax</code> declaration makes it reserved</p>\n</blockquote>\n<p>In addition, the quoted text would not apply here in any case as no category is being parsed at that point</p>",
        "id": 569792574,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1769197865
    },
    {
        "content": "<p>not the <code>ident</code> category?</p>",
        "id": 569793479,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769198190
    },
    {
        "content": "<p>or is that not a category? i'm guessing it's not a category then.</p>",
        "id": 569793508,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769198208
    },
    {
        "content": "<p>yup, <code>syntax \"fooo[]\":ident</code> indeed fails complaining that <code>ident</code> is not a parser category.</p>",
        "id": 569793800,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769198341
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Why.20does.20the.20elaborator.20fail.20with.20conflicting.20syntax.3F/near/569791985\">said</a>:</p>\n<blockquote>\n<p>another (possibly more durable) option is to make your syntax <code>scoped</code> to some namespace. This way, <code>abc</code> will only be reserved in the namespace where you declare the syntax. If in that namespace you still want to refer to the identifier instead of the syntax, you can use french quotes: <code>«abc»</code></p>\n</blockquote>\n<p>In my bigger program I had a DSL with a <code>skip</code> command and the corresponding AST with a <code>skip</code> type constructor. The DSL was only elaborated when it was in the form <code>⟪ skip ⟫</code> so I was confused on why I was getting the error but this makes sense.</p>\n<p>Thanks a lot for the help.</p>",
        "id": 569840574,
        "sender_full_name": "Syed Shaazib Tanvir",
        "timestamp": 1769235383
    }
]