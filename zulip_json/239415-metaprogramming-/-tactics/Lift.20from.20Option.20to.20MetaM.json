[
    {
        "content": "<p>There is a <a href=\"https://github.com/leanprover-community/mathlib4/blob/2e8dbf68904ffbccb7529f87a2207d6289e6a2e7/Mathlib/Tactic/NormNum/Basic.lean#L215-L218\">lift from Option to MetaM</a> implemented in the <code>norm_num</code> code, apparently dating from <a href=\"https://github.com/leanprover-community/mathlib4/pull/519\">#519</a> (<span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>).</p>\n<p>I want this elsewhere, so I was thinking of moving it to a standalone file in <code>Mathlib.Util</code>.  Does this sound ok?</p>\n<p>Is there any part of mathlib where this <em>shouldn't</em> be imported?  By the way, <code>Lake.Util.Lift</code> apparently contains a <code>MonadLiftT</code> for this: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lake.instMonadLiftTOptionOfAlternative_lake#doc\">docs#Lake.instMonadLiftTOptionOfAlternative_lake</a>.</p>",
        "id": 480264479,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730595928
    },
    {
        "content": "<p>There's at least <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Option.toMonad#doc\">docs#Option.toMonad</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Option.getDM#doc\">docs#Option.getDM</a> for turning Option into a monadic value</p>",
        "id": 480264714,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730596163
    },
    {
        "content": "<p>I often also write things like <code>let some x := v? | failure</code></p>",
        "id": 480264798,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730596225
    },
    {
        "content": "<p>OK, would it be better to delete the lift instance in the <code>norm_num</code> code and use one of those idioms instead?</p>",
        "id": 480264820,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730596259
    },
    {
        "content": "<p>Is using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OptionT#doc\">docs#OptionT</a> another helpful approach here?</p>",
        "id": 480266715,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730598152
    },
    {
        "content": "<p>Kyle's suggestions are fine for my purposes, now I'm just wondering about cleanup elsewhere.</p>",
        "id": 480266843,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730598294
    },
    {
        "content": "<p>I have a memory of some very confusing behaviour with the lift instance mentioned above.  Let me see if I can find the relevant thread.</p>",
        "id": 480289395,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730622053
    },
    {
        "content": "<p>I think that these were the threads that I had in mind:</p>\n<p><a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/MetaM.20and.20Option\">#mathlib4 &gt; MetaM and Option</a> </p>\n<p><a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/monad.20puzzle\">#mathlib4 &gt; monad puzzle</a></p>",
        "id": 480291202,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730624054
    },
    {
        "content": "<p>It seems not very user-friendly to have the presence/absence of the <code>norm_num</code> import determine whether this lift is present or not: this is an unpredictable criterion.  Maybe the instance in the <code>norm_num</code> file should be downgraded to a local instance?</p>",
        "id": 480320106,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730651568
    },
    {
        "content": "<p>Yes, that seems like a good idea to make it local (or to eliminate it)</p>",
        "id": 480320457,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730651808
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18680\">#18680</a></p>",
        "id": 480814114,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730848198
    },
    {
        "content": "<p>Oooh, that's why I got errors in my positivity extensions when bumping. What's the preferred fix? Adding the instance locally? Using the <code>let some x := v? | failure</code> idiom?</p>",
        "id": 481442180,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731141836
    },
    {
        "content": "<p>I've added the instance locally, but I'm happy to switch to something else</p>",
        "id": 481442482,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731142129
    },
    {
        "content": "<p>It depends on specifics, but <code>let some x := v? | failure</code> (or <code>throwError</code> instead of <code>failure</code>) is a reasonable choice I think.</p>",
        "id": 481474481,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731169889
    },
    {
        "content": "<p>I got a weird error doing that, because my <code>v?</code> contains some <code>← </code> themselves</p>",
        "id": 481488488,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731181218
    },
    {
        "content": "<p>Turns out I had simply forgotten the trailing <code>| failure</code></p>",
        "id": 481493381,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731185212
    }
]