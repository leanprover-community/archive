[
    {
        "content": "<p>I want to get the ast(abstract syntax tree) of the lean code, modify the ast, and translate it back to lean code. What is the best tool I can use?</p>",
        "id": 512718127,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744854480
    },
    {
        "content": "<p>Do you want something like the syntax tree or something like the proof expression?</p>",
        "id": 512718312,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744854589
    },
    {
        "content": "<p>I think I want syntax tree. For example, I want to do things like change all rw[a,b] to rw[a]; rw[b], so I want to use syntax tree to do this job (string pattern matching is too ugly and difficult to scale)</p>",
        "id": 512718559,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744854761
    },
    {
        "content": "<p>How do you have access to the code? You could take input as <code>Syntax</code>, for example</p>",
        "id": 512721166,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744856284
    },
    {
        "content": "<p>I have lean proof source code.</p>",
        "id": 512721260,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744856346
    },
    {
        "content": "<p>What do you mean by take input as <code>Syntax</code>?</p>",
        "id": 512721285,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744856368
    },
    {
        "content": "<p><code>def doStuff (stx : Syntax) : IO Unit := ...</code></p>",
        "id": 512722229,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744856994
    },
    {
        "content": "<p>Actually I want the ast form to be something like json or python object so I can use my more familiar python to process it. Whether the community have such kind of tools, or I can only use metaprogramming in lean language itself to change the ast?</p>",
        "id": 512723104,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744857508
    },
    {
        "content": "<p>Also, the proof is not necessarily correct, maybe use the wrong tactic or theorem or something else (that's why I want to change the proof).</p>",
        "id": 512723318,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744857653
    },
    {
        "content": "<p>I found a project <a href=\"https://github.com/digama0/ast_export/blob/master/AstExport.lean\">ast_export</a> that can transform lean to json by toJson in lean, but it has not implemented the other direction, fromJson, while this has an implementation in lean <a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Data/Json/FromToJson.lean\">https://github.com/leanprover/lean4/blob/master/src/Lean/Data/Json/FromToJson.lean</a><br>\nSo I believe this can be done and I don't know if we already has a tool to do this.</p>",
        "id": 512725110,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744858788
    },
    {
        "content": "<p>The first thing to note about Lean is that it has <em>two</em> forms of internal representations, i.e., analogues of ASTs. There is <code>Syntax</code> and there is <code>Expr</code>. The latter is in the foundations of Lean.</p>",
        "id": 512865700,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1744906586
    },
    {
        "content": "<p>It is quite straightforward to access both of them.</p>",
        "id": 512865843,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1744906628
    },
    {
        "content": "<p>Do note that <code>Expr</code> contains the actual code after the tactics have run. So if your plan is to modify tactics before they are run, then you can't use <code>Expr</code> and you have to use <code>Syntax</code></p>",
        "id": 512879542,
        "sender_full_name": "Niels Voss",
        "timestamp": 1744910936
    },
    {
        "content": "<p>How do you imagine the Lean&lt;-&gt;Python interface working? Are you planning on using Python to modify the Lean source code file, interact with the LSP, or just be a script that Lean will call and modify the tactics without actually changing the Lean source code?</p>",
        "id": 512880227,
        "sender_full_name": "Niels Voss",
        "timestamp": 1744911129
    },
    {
        "content": "<p>I want to fix a wrong lean proof, so what I imagine is that I want to first extract a syntax ast from lean code and export it in json format. (and if that tree have some runtime info that would be better (but maybe that should be another tree, like infotree)). Then I use python to work on that syntax tree and change and fix it (by syntax info and maybe some runtime info), then I translate the modified lean syntax tree back to lean code.</p>",
        "id": 512881376,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744911471
    },
    {
        "content": "<p>I think you might be looking for unexpanders or delaborators in #mpil</p>",
        "id": 512909222,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1744921696
    },
    {
        "content": "<p>But if you insist on using json, I think lean-repl takes you from lean code to json. I am not sure how the other way could be accomplished systematically</p>",
        "id": 512912025,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1744922823
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span>  Can you recommend me some material to learn the topic \"unexpanders or delaborators in #mpil\"?</p>",
        "id": 512917831,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744925008
    },
    {
        "content": "<p>Mpil is short for “metaprogramming in lean 4”</p>",
        "id": 512925823,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1744928381
    },
    {
        "content": "<p><span aria-label=\"rolling on the floor laughing\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rolling on the floor laughing\">:rolling_on_the_floor_laughing:</span> I see</p>",
        "id": 512925849,
        "sender_full_name": "Jiaming Shan",
        "timestamp": 1744928401
    },
    {
        "content": "<p>It’s a book that explains lean metaprogramming and it has chapters on delaborators and unexpanders</p>",
        "id": 512925907,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1744928414
    },
    {
        "content": "<p>well... it doesn't, really... it basically only mentions them in passing, imo.</p>",
        "id": 513092843,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1745007727
    }
]