[
    {
        "content": "<p>I have a widget that displays a simple progress bar:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">widget</span><span class=\"w\"> </span><span class=\"n\">printWidget</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">progress</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mf\">0.75</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PrintWidgetProps</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>displays:<br>\n<a href=\"/user_uploads/3121/KlkHszd4xXos1yblcKtC5P1E/image.png\">image.png</a><br>\nI'm trying to use it from within a custom command I defined. However it seems that I can't get it to display in much simpler scenarios:</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/KlkHszd4xXos1yblcKtC5P1E/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"182x59\" src=\"/user_uploads/thumbnail/3121/KlkHszd4xXos1yblcKtC5P1E/image.png/840x560.webp\"></a></div><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">widg'</span><span class=\"o\">)</span><span class=\"s2\">\"#widget'\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Widget</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">widg'</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">elabWidgCmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"n\">widget'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">widgetInstanceSpec</span><span class=\"bp\">|</span><span class=\"n\">printWidget</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">progress</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mf\">0.75</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PrintWidgetProps</span><span class=\"o\">})</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">wi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">elabWidgetInstanceSpec</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">wi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WidgetInstance</span><span class=\"w\"> </span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">evalWidgetInstance</span><span class=\"w\"> </span><span class=\"n\">wi</span>\n<span class=\"w\">    </span><span class=\"n\">savePanelWidgetInfo</span><span class=\"w\"> </span><span class=\"n\">wi</span><span class=\"bp\">.</span><span class=\"n\">javascriptHash</span><span class=\"w\"> </span><span class=\"n\">wi</span><span class=\"bp\">.</span><span class=\"n\">props</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n<span class=\"bp\">#</span><span class=\"n\">widget'</span>\n</code></pre></div>\n<p>This does not render anything. The code of <code>elabWidgCmd</code> is copy-pasted from <code>#widget</code>. Of course, I also tried just using <code>elabCommand</code> with the widget.<br>\nAm I doing something wrong? Thank you</p>",
        "id": 498273334,
        "sender_full_name": "Elad Kinsbruner",
        "timestamp": 1738912342
    },
    {
        "content": "<p>You are running into the issue described <a href=\"https://github.com/leanprover-community/ProofWidgets4/blob/main/ProofWidgets/Demos/Macro.lean\">here</a>. Upon applying <code>mkInfoCanonical</code> to your syntax, the widget shows up. This is a somewhat obscure issue that caught multiple people, so maybe the behaviour should be changed in core Lean.</p>",
        "id": 498437379,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1738967514
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"875487\">Elad Kinsbruner</span> has marked this topic as resolved.</p>",
        "id": 498457991,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738980679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/.E2.9C.94.20Render.20Widget.20from.20CommandElabM/near/498437379\">said</a>:</p>\n<blockquote>\n<p>You are running into the issue described <a href=\"https://github.com/leanprover-community/ProofWidgets4/blob/main/ProofWidgets/Demos/Macro.lean\">here</a>. Upon applying <code>mkInfoCanonical</code> to your syntax, the widget shows up. This is a somewhat obscure issue that caught multiple people, so maybe the behaviour should be changed in core Lean.</p>\n</blockquote>\n<p>This works, thank you!</p>",
        "id": 498458002,
        "sender_full_name": "Elad Kinsbruner",
        "timestamp": 1738980696
    }
]