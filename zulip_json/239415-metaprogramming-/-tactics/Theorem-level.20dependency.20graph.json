[
    {
        "content": "<p>I've just completed the proof of the main theorem in <a href=\"https://github.com/urkud/SardMoreira/\">https://github.com/urkud/SardMoreira/</a>. The repository has a bunch of theorems that I added because they seemed useful, then never used for the final proof. Is there something like <code>lake exe graph</code> for theorems? E.g., I would love to move those unused theorems to a new file <code>Unused.lean</code>, then go through the dependency graph of the rest and PR stuff to Mathlib.</p>",
        "id": 564066544,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765898106
    },
    {
        "content": "<p>I do not know of any automation, but I found <code>#show_unused</code> very helpful for this kind of process.</p>",
        "id": 564067726,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1765898400
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 564070003,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765898957
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span></p>",
        "id": 564081280,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1765901630
    },
    {
        "content": "<p>Btw, there are rumours of a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> producer, which could likely be repurposed into this kind of behaviour.</p>",
        "id": 564082544,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1765901953
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> I'm working on such things now, but nothing is ready yet. In the meantime, you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/ImportGraph/RequiredModules.html#Lean.Name.transitivelyUsedConstants\">Lean.Name.transitivelyUsedConstants</a> to get the transitive dependencies of some constant in the environment.</p>",
        "id": 564089579,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765903802
    },
    {
        "content": "<p>Give me about 5 mins and I'll tell you what your theorems in <code>MainTheorem.lean</code> depend on.</p>",
        "id": 564089963,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765903916
    },
    {
        "content": "<p>Here's the list of constants defined in your project which your main theorems depend on: <br>\n<a href=\"/user_uploads/3121/-nxsSFVLDpejm7KsUNgebCPB/data\">data</a></p>",
        "id": 564091470,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765904357
    },
    {
        "content": "<p>I got this by running the following script at the bottom of your <code>MainTheorem.lean</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NameSet</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"bp\">.</span><span class=\"n\">map₂</span><span class=\"bp\">.</span><span class=\"n\">foldl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{})</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">deps</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"bp\">.</span><span class=\"n\">transitivelyUsedConstants</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">filteredDeps</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NameSet</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">deps</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"bp\">.</span><span class=\"n\">isBlackListed</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">continue</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">getModuleFor?</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">continue</span>\n<span class=\"w\">    </span><span class=\"n\">unless</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"bp\">.</span><span class=\"n\">getRoot</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">`SardMoreira</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">continue</span>\n<span class=\"w\">    </span><span class=\"n\">filteredDeps</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">filteredDeps</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"n\">dep</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">FS</span><span class=\"bp\">.</span><span class=\"n\">withFile</span><span class=\"w\"> </span><span class=\"s2\">\"data\"</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">write</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">filteredDeps</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">handle</span><span class=\"bp\">.</span><span class=\"n\">putStrLn</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"bp\">.</span><span class=\"n\">toString</span>\n</code></pre></div>",
        "id": 564091599,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765904391
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 564093718,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765904979
    },
    {
        "content": "<p>I'm making a graph for you too :)</p>",
        "id": 564093757,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765904989
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/VJDwhD6ITNfXLBdtSYT47tIn/output.png\">output.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/VJDwhD6ITNfXLBdtSYT47tIn/output.png\" title=\"output.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"27545x1979\" src=\"/user_uploads/thumbnail/3121/VJDwhD6ITNfXLBdtSYT47tIn/output.png/840x560.webp\"></a></div>",
        "id": 564098516,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765906417
    },
    {
        "content": "<p>Oops! the arrows should go the other way, one sec.</p>",
        "id": 564098683,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765906472
    },
    {
        "content": "<p>also, there was a bug causing the graph to be diconnected.</p>",
        "id": 564099525,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765906747
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 564100250,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765906958
    },
    {
        "content": "<p>Could you please generate the list of unused declarations too? Thanks a lot!</p>",
        "id": 564101442,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765907373
    },
    {
        "content": "<p>Here's a better graph: <br>\n<a href=\"/user_uploads/3121/QFHH6Ifu7_pYCsFsA9SuJppe/output.png\">output.png</a><br>\n<a href=\"/user_uploads/3121/A_vgFxOktjKaN9msLIqzRQmh/graph.dot\">graph.dot</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/QFHH6Ifu7_pYCsFsA9SuJppe/output.png\" title=\"output.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"29711x2075\" src=\"/user_uploads/thumbnail/3121/QFHH6Ifu7_pYCsFsA9SuJppe/output.png/840x560.webp\"></a></div>",
        "id": 564101617,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765907426
    },
    {
        "content": "<p>Seems like you have 211 constants which are not used in <code>dimH_image_le_sardMoreiraBound_of_finrank_le</code>: <br>\n<a href=\"/user_uploads/3121/WbXw40UCuQKWphvskVN16Iw8/unused.txt\">unused.txt</a></p>",
        "id": 564102814,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765907843
    },
    {
        "content": "<p>This assumes everything in the project is imported in <code>SardMoreira.lean</code></p>",
        "id": 564103011,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765907909
    },
    {
        "content": "<p>Thanks a lot! I'll start cleaning up and opening mathlib prs tonight.</p>",
        "id": 564115008,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765912245
    },
    {
        "content": "<p>no problem! if you have some thoughts about what such commands would be useful to add to mathlib, let me know.</p>",
        "id": 564115225,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765912307
    },
    {
        "content": "<p>What command did you use to generate <code>unused.txt</code>?</p>",
        "id": 564127323,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1765916908
    },
    {
        "content": "<p>I wrote a bit of code myself, there isn’t any command as far as I know</p>",
        "id": 564127762,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1765917085
    }
]