[
    {
        "content": "<p>Suppose I have a (non-canonical, not-an-inductive-constructor) function that makes values of some type <code>τ</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">match_pattern</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myMk</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>And a proof/def that considering only elements that can be made by <code>myMk</code> is sufficient to prove/generate data for everything in <code>τ</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">elab_as_elim</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myRecOn</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkMk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myMk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>What's the cleanest way to turn <code>myMk</code> into something that can be matched against, used in destructuring assignment, and so on? I vaguely believe this is possible because there are notes to that effect in e.g. <code>Finset.sum</code>'s documentation, but I'm not entirely sure.</p>",
        "id": 495823630,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1737770766
    },
    {
        "content": "<p>I've started with the attributes already included above, but in my specific use case trying to do <code>fun (myMk a b) =&gt; ...</code> with just the above results in the compiler complaining <code>invalid patterns, `a` is an explicit pattern variable, but it only occurs in positions that are inaccessible to pattern matching</code>. Which doesn't exactly surprise me -- that's essentially why I had to write <code>myRecOn</code>, after all -- but I don't really know where to go from here.</p>",
        "id": 495824079,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1737771073
    },
    {
        "content": "<p><code>@[match_pattern]</code> is probably not going to work for anything complicated, but if <code>myMk</code> is simple enough, then you could do that.</p>",
        "id": 495825320,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1737772046
    },
    {
        "content": "<p>It's not terribly complicated, but it has a <code>Quot.mk</code> in it, so depending on where I put the attribute, either the pattern isn't recognized when I try to use it, or the parameter ends up in an inaccessible pattern and can't be used.</p>",
        "id": 495835346,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1737780729
    }
]