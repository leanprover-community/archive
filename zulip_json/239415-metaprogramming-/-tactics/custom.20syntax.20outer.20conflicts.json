[
    {
        "content": "<p>I got confused by the idea of a custom syntax category, with the examples such as<br>\n<a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/main/08_dsls.html\">in the metaprogramming book</a>, it looks like we are defining a local language only to be activated between <code>&gt;&gt;</code> and <code>&lt;&lt;</code> in that example. However, once we add the <code>true</code> token to our syntax, we cannot use the standard <code>Bool.true</code> outside anymore</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">   </span><span class=\"c1\">-- :-( unexpected token 'true'; expected term</span>\n</code></pre></div>\n<p>On the other hand, declaring tactic syntax does not collide with standard terms.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">   </span><span class=\"c1\">-- :-) Bool.true : Bool</span>\n</code></pre></div>\n<p>Could I make a custom syntax category work like <code>tactic</code> in the sense, that it only gets activated in a specific environment, and doesn't mess up with usual term elaboration?</p>",
        "id": 558807256,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763809961
    },
    {
        "content": "<p>I think it was something like <code>declare_syntax_cat (behavior := symbol) imp_lit</code></p>",
        "id": 558816132,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1763819193
    },
    {
        "content": "<p>Thanks,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>looks like doing something.<br>\nIt doesn't seem to work for binary operators, but for them, even tactics declare a new token. I mean something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"s2\">\"div\"</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span>\n</code></pre></div>\n<p>I suppose I could create a new category just for them...</p>",
        "id": 558817635,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763820627
    },
    {
        "content": "<p>Or use <code>&amp;\"div\"</code></p>",
        "id": 558829665,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1763831936
    },
    {
        "content": "<p>How does that work? I cannot match on it</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">)</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"bp\">&amp;</span><span class=\"s2\">\"div\"</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`imp_lit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">TermElabM</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">imp_lit</span><span class=\"bp\">|$</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"n\">div</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">imp_lit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">default</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">default</span>\n</code></pre></div>",
        "id": 558832529,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763834479
    },
    {
        "content": "<p>Huh, I guess there are some subtleties when you try to use it as a binary operator?</p>",
        "id": 558833456,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1763835298
    },
    {
        "content": "<p>This seems to work I guess</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Elab</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">imp_lit_parser</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">impDiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TrailingParser</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trailing_parser</span>\n<span class=\"w\">  </span><span class=\"n\">nonReservedSymbol</span><span class=\"w\"> </span><span class=\"s2\">\"div\"</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">categoryParser</span><span class=\"w\"> </span><span class=\"ss\">`imp_lit</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`imp_lit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">TermElabM</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">imp_lit</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">imp_lit</span><span class=\"w\"> </span><span class=\"n\">div</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">imp_lit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">default</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">default</span>\n</code></pre></div>",
        "id": 558833671,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1763835514
    },
    {
        "content": "<p>magic <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 558838682,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763840172
    }
]