[
    {
        "content": "<p>This one surprised me slightly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorial</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- (kernel) application type mismatch</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">by_elab</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"s2\">\"wat\"</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 535030050,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755556818
    },
    {
        "content": "<p>well <code>assumption</code> has a higher transparency</p>",
        "id": 535030294,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755557054
    },
    {
        "content": "<p>For my purposes, <code>by exact q(delta% inferInstance)</code> seems to behave better</p>",
        "id": 535030310,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755557074
    },
    {
        "content": "<p>what's <code>delta%</code>?</p>",
        "id": 535030334,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755557088
    },
    {
        "content": "<p>So I guess <code>by exact q(by assumption)</code> is probably correct</p>",
        "id": 535030338,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755557091
    },
    {
        "content": "<p><code>delta% inferInstance</code> is \"infer the instance and don't add a silly <code>inferInstance</code> term\"</p>",
        "id": 535030353,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755557105
    },
    {
        "content": "<p>(which is what <code>by apply_instance</code> did in Lean 3)</p>",
        "id": 535030391,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755557135
    },
    {
        "content": "<p>I'm wondering if there should be an <code>infer_instance%</code> term elaborator, which elaborates to the instance itself. The <code>infer_instance</code> tactic could be a macro for <code>exact infer_instance%</code>.</p>\n<p>Could someone come up with some case to be made for this? And also a justification for why the <code>inferInstance</code> term might be better in some cases, to balance it out?</p>",
        "id": 535762901,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755901187
    },
    {
        "content": "<p><code>inferInstance</code> gives you an expected type hint, like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.mkExpectedTypeHint#doc\">docs#Lean.Meta.mkExpectedTypeHint</a></p>",
        "id": 535763181,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755901390
    },
    {
        "content": "<p>I'll note that my code above doesn't actually work well with Qq after all, as the autoParam metavariable is not getting populated by Qq, and is instead left unassigned.</p>",
        "id": 535764073,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755901941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/A.20Qq.20gotcha/near/535762901\">said</a>:</p>\n<blockquote>\n<p>I'm wondering if there should be an <code>infer_instance%</code> term elaborator, which elaborates to the instance itself. The <code>infer_instance</code> tactic could be a macro for <code>exact infer_instance%</code>.</p>\n<p>Could someone come up with some case to be made for this? And also a justification for why the <code>inferInstance</code> term might be better in some cases, to balance it out?</p>\n</blockquote>\n<p>I would like this to exist! Primarily, I encounter it when working with <code>TopologicalSpace</code>s, where often the simplest way to, say, prove that a set is open is to unfold the typeclass instance and then reason about what's usually a (co)induced topology; if I'm doing this in the middle of a construction, though, then it's quite likely I'll end up with opaque <code>inferInstance</code>s and I won't know how to proceed without <code>simp [inferInstance]</code> or similarly cursed things.</p>",
        "id": 537177456,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1756765044
    },
    {
        "content": "<p>It's an extra step, but you should be able to hover over <code>inferInstance</code> in the infoview to see the instance. Is there a reason that doesn't work for you?</p>",
        "id": 537177783,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756765292
    }
]