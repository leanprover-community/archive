[
    {
        "content": "<p>I have two questions:</p>\n<p>1) What is the recommended method of locating a tactic?<br>\n2) What is the recommended method of then locating the elaborator for that tactic?</p>\n<p>For the first, I will somtimes do something like </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which for example would point me to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Tactic.decide#doc\">docs#Lean.Parser.Tactic.decide</a>. </p>\n<p>Continuing with the example, how would I then in turn find <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Tactic.evalDecide#doc\">docs#Lean.Elab.Tactic.evalDecide</a>, which is in a different file? Ideally the solution would be generally applicable, but maybe this is an unusal example because it is a builtin tactic?</p>",
        "id": 526215195,
        "sender_full_name": "Chris Henson",
        "timestamp": 1751129361
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n</code></pre></div>\n<p>and then ctrl+click on <code>decide</code></p>",
        "id": 526218970,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1751132998
    },
    {
        "content": "<p>I am not getting a go to definition link to click on <code>decide</code> (and am also interested in what this looks like programmatically)</p>",
        "id": 526222532,
        "sender_full_name": "Chris Henson",
        "timestamp": 1751136649
    },
    {
        "content": "<p>So just to clarify, if you copy the code Robin posted into VS Code, ignore the error, and ctrl+click on the word <code>decide</code> (or cmd+click on a mac) you don't jump to the definition of <code>Lean.Elab.Tactic.evalDecide</code> in core Lean?</p>",
        "id": 526223423,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751137693
    },
    {
        "content": "<p>To clarify: if I include <code>import Lean</code> it does work, but not otherwise. Is this the expected behavior?</p>",
        "id": 526224103,
        "sender_full_name": "Chris Henson",
        "timestamp": 1751138707
    },
    {
        "content": "<p>Yes, that's expected.</p>",
        "id": 526224178,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751138809
    },
    {
        "content": "<p>(Not ideal, but it's expected)</p>",
        "id": 526224185,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751138822
    },
    {
        "content": "<p>Both \"go to definition\" and \"go to declaration\" are useful for seeing the elaborator and the syntax definition.</p>",
        "id": 526224253,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751138893
    },
    {
        "content": "<p>I don't believe there's any resource for the programmatic solution except to read through source code for the LSP server. I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Server.FileWorker.locationLinksOfInfo#doc\">docs#Lean.Server.FileWorker.locationLinksOfInfo</a> is the entry point for all the go-to-* logic.</p>",
        "id": 526224370,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751139049
    },
    {
        "content": "<p>Thanks, that link is what I was about to ask for next! Is the reason that this doesn't work for <code>decide</code> until we <code>import Lean</code> because these definitions are in <code>Init</code>?</p>",
        "id": 526224539,
        "sender_full_name": "Chris Henson",
        "timestamp": 1751139248
    },
    {
        "content": "<p>I think it's specifically because source position information hasn't been loaded in, and the source position is not a \"builtin\" (data that is in the Lean executable itself), instead it's just in the olean files and needs to be loaded. I'm not completely sure, I'd have to read through the source code.</p>\n<p>Most projects will have enough of Lean imported for this data to be loaded.</p>",
        "id": 526224678,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751139465
    },
    {
        "content": "<p>Oh, it <em>does</em> work for <code>decide</code>. If you do \"go to declaration\" it goes to the syntax definition.</p>",
        "id": 526224871,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751139741
    },
    {
        "content": "<p>The issue you ran into is that \"go to definition\" goes to the elaborator that was invoked on the given syntax, but none of the Lean elaborator is in <code>Init</code>, so it hasn't been loaded, so there's no source position available for <code>Lean.Elab.Tactic.evalDecide</code>.</p>",
        "id": 526224914,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751139825
    },
    {
        "content": "<p>\"The elaborator that was invoked\" is important here: there's no direct mapping from syntax to an elaborator, and it's only resolved during tactic execution. There can be macros and multiple elaborators defined for a syntax, so you can't really know ahead of time what it will be. At least you can get the list of elaborators that it will try (maybe take a look at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Tactic.evalTactic#doc\">docs#Lean.Elab.Tactic.evalTactic</a> to see how tactic evaluation works; there's some complexity in there you'll want to skip that's for incremental elaboration).</p>\n<p>The reason \"go to definition\" works is that the LSP looks at data registered by <code>withTacticInfoContext</code> to determine which elaborator was executed for a given source syntax.</p>",
        "id": 526225031,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751140006
    }
]