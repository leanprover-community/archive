[
    {
        "content": "<p>I was curious why the kernel and <code>check</code> disagree on whether the following projection is allowed. I guess this is really two questions:<br>\nWhy disallow this in the kernel, and given that the kernel doesn't allow it, why let <code>check</code> allow it?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">3</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">3</span>\n</code></pre></div>",
        "id": 558868967,
        "sender_full_name": "Eric Paul",
        "timestamp": 1763877886
    },
    {
        "content": "<p><code>Lean.Meta.check</code> isn't meant to check everything that the kernel checks. Note also that <code>check</code> works even when there are metavariables, which the kernel cannot work with.</p>\n<p>More generally, ideally all invalid terms are caught before sending them to the kernel, but there are some checks (such as Prop projections) that only the kernel does, so that's when we get kernel errors.</p>\n<p>In you example though, I think that that particular projection should actually be valid, but it is enough of an edge case where I understand that this wasn't added to the kernel, since you can define this projection yourself using the recursor.</p>",
        "id": 559093716,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764001628
    },
    {
        "content": "<p>That makes sense, thanks. It does appear that <code>check</code> is looking at Prop projections, it just chooses to check them differently:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isProp</span><span class=\"w\"> </span><span class=\"n\">structType</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isProp</span><span class=\"w\"> </span><span class=\"n\">projType</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n</code></pre></div>\n<p>Would a PR making the way <code>check</code> works here align with the kernel be appreciated or would that be considered a waste of time as <code>check</code> and the kernel line up well enough? Just trying to get a better feel for the goals in the relationship between <code>check</code> and the kernel.</p>",
        "id": 559115307,
        "sender_full_name": "Eric Paul",
        "timestamp": 1764006973
    },
    {
        "content": "<p>What about making the kernel do what <code>check</code> does here? This is sound, right?</p>",
        "id": 559116672,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764007360
    },
    {
        "content": "<p>Interesting, it is curious then that the kernel and <code>check</code> have different behaviour here. It might be the most reasonable thing to fix the kernel to accept this. But people are generally extremely cautious about changes to the kernel, so I don't think this will actually happen.</p>\n<p>It seems that this is the relevant kernel code, in C++</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"nf\">type_checker::infer_proj</span><span class=\"p\">(</span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">infer_only</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">infer_type_core</span><span class=\"p\">(</span><span class=\"n\">proj_expr</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">infer_only</span><span class=\"p\">));</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">proj_idx</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">).</span><span class=\"n\">is_small</span><span class=\"p\">())</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">proj_idx</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">).</span><span class=\"n\">get_small_value</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"n\">buffer</span><span class=\"o\">&lt;</span><span class=\"n\">expr</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_app_args</span><span class=\"p\">(</span><span class=\"n\">type</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_constant</span><span class=\"p\">(</span><span class=\"n\">I</span><span class=\"p\">))</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">I_name</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">const_name</span><span class=\"p\">(</span><span class=\"n\">I</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">I_name</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">proj_sname</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">))</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">constant_info</span><span class=\"w\"> </span><span class=\"n\">I_info</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">().</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">I_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">I_info</span><span class=\"p\">.</span><span class=\"n\">is_inductive</span><span class=\"p\">())</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">inductive_val</span><span class=\"w\"> </span><span class=\"n\">I_val</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">I_info</span><span class=\"p\">.</span><span class=\"n\">to_inductive_val</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">I_val</span><span class=\"p\">.</span><span class=\"n\">get_cnstrs</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">size</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">I_val</span><span class=\"p\">.</span><span class=\"n\">get_nparams</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">I_val</span><span class=\"p\">.</span><span class=\"n\">get_nindices</span><span class=\"p\">())</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">constant_info</span><span class=\"w\"> </span><span class=\"n\">c_info</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">().</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"n\">I_val</span><span class=\"p\">.</span><span class=\"n\">get_cnstrs</span><span class=\"p\">()));</span>\n<span class=\"w\">    </span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instantiate_type_lparams</span><span class=\"p\">(</span><span class=\"n\">c_info</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">const_levels</span><span class=\"p\">(</span><span class=\"n\">I</span><span class=\"p\">));</span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">I_val</span><span class=\"p\">.</span><span class=\"n\">get_nparams</span><span class=\"p\">();</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">lean_assert</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">size</span><span class=\"p\">());</span>\n<span class=\"w\">        </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_pi</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">type</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">idx</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_pi</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">has_loose_bvars</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">binding_domain</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)))</span>\n<span class=\"w\">                </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">mk_proj</span><span class=\"p\">(</span><span class=\"n\">I_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">proj_expr</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)));</span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_pi</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">binding_domain</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 559117612,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764007639
    },
    {
        "content": "<p>Yes, that would make sense. My understanding is that it would change to the following:</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"nf\">type_checker::infer_proj</span><span class=\"p\">(</span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">infer_only</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">   </span><span class=\"p\">...</span>\n<span class=\"w\">    </span><span class=\"kt\">bool</span><span class=\"w\"> </span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">type</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">unsigned</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">idx</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_pi</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">has_loose_bvars</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"c1\">//if (is_prop_type &amp;&amp; !is_prop(binding_domain(r)))</span>\n<span class=\"w\">               </span><span class=\"c1\">// throw invalid_proj_exception(env(), m_lctx, e);</span>\n<span class=\"w\">            </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">mk_proj</span><span class=\"p\">(</span><span class=\"n\">I_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">proj_expr</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)));</span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">is_pi</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">binding_domain</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">))</span>\n<span class=\"w\">        </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>We get rid of the check inside of the for loop that throws if one of the arguments before the <code>idx</code> is not a Prop and then the line <code>if (is_prop_type &amp;&amp; !is_prop(r))</code> at the end does the sufficient check.</p>",
        "id": 559118027,
        "sender_full_name": "Eric Paul",
        "timestamp": 1764007760
    },
    {
        "content": "<p>The following commit has introduced this extra check in the kernel: <a href=\"https://github.com/leanprover/lean4/commit/3746005f5fc35d030d26ced2f7bcaabc295224c2\">https://github.com/leanprover/lean4/commit/3746005f5fc35d030d26ced2f7bcaabc295224c2</a></p>\n<p>It seems that specifically the following example is why this extra check was introduced:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">witness_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- kernel error</span>\n</code></pre></div>",
        "id": 559119524,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764008192
    },
    {
        "content": "<p>But that one is sound too</p>",
        "id": 559120012,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764008295
    },
    {
        "content": "<p>I don't know exactly</p>",
        "id": 559120235,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764008370
    },
    {
        "content": "<p>Nice find with that commit.<br>\nThis is my understanding:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">witness_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Here the type of <code>h.2</code> is <code>(h.1 = h.1)</code> and we're not allowed to have <code>h.1</code> appear anywhere in the type?</p>\n<p>This corresponds to the code</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">is_prop_type</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">is_prop</span><span class=\"p\">(</span><span class=\"n\">binding_domain</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)))</span>\n<span class=\"w\">                </span><span class=\"k\">throw</span><span class=\"w\"> </span><span class=\"n\">invalid_proj_exception</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">m_lctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"p\">);</span>\n<span class=\"w\">            </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"p\">(</span><span class=\"n\">binding_body</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">mk_proj</span><span class=\"p\">(</span><span class=\"n\">I_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">proj_expr</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)));</span>\n</code></pre></div>\n<p>Which is creating a projection <code>mk_proj(I_name, i, proj_expr(e))</code> at an index <code>i &lt; idx</code> which we're often not allowed to do and that's why the check is there above it.</p>",
        "id": 559121806,
        "sender_full_name": "Eric Paul",
        "timestamp": 1764008860
    },
    {
        "content": "<p>oh I thought <code>#check</code> wouldn't accept this</p>",
        "id": 559122168,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764008974
    },
    {
        "content": "<p>Indeed, this now just appears to be an issue where <code>check</code> allows terms with invalid types.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">projectedTerm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">⟨</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">projectedTerm</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n<span class=\"w\">  </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">projectedTerm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>The fix would be just adding that same if statement in this loop that was added to the kernel</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">*...</span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">ctorType</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">whnf</span><span class=\"w\"> </span><span class=\"n\">ctorType</span>\n<span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">ctorType</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">forallE</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">body</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">body</span><span class=\"bp\">.</span><span class=\"n\">hasLooseBVars</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"c1\">-- ADD: Ensure that `mkProj structName i e` is valid here</span>\n<span class=\"w\">            </span><span class=\"n\">ctorType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">body</span><span class=\"bp\">.</span><span class=\"n\">instantiate1</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">mkProj</span><span class=\"w\"> </span><span class=\"n\">structName</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">          </span><span class=\"k\">else</span>\n<span class=\"w\">            </span><span class=\"n\">ctorType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">body</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>Thanks for all the help, this makes a lot more sense now!</p>",
        "id": 559124022,
        "sender_full_name": "Eric Paul",
        "timestamp": 1764009534
    },
    {
        "content": "<p>Can't we just look at the type of the projection?</p>",
        "id": 559137271,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764013389
    },
    {
        "content": "<p>Why do we need to looks at the constructor?</p>",
        "id": 559137312,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764013405
    },
    {
        "content": "<p>I'm not exactly sure what you mean, this code is from <a href=\"https://github.com/leanprover/lean4/blob/2308e3a0a51086250aa02588499380e287245147/src/Lean/Meta/InferType.lean#L102\"><code>inferProjType</code></a></p>",
        "id": 559137924,
        "sender_full_name": "Eric Paul",
        "timestamp": 1764013594
    },
    {
        "content": "<p>I think the code was written in this ungeneral way for efficiency. It is easy to work around it by reordering your arguments:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">⟨</span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">3</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">3</span>\n</code></pre></div>",
        "id": 559140760,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1764014551
    },
    {
        "content": "<p>In a previous discussion, there was a suggestion to make the kernel more restrictive with its primitive projections and only allow those that can actually be implemented with a recursor. Related issue: <a href=\"https://github.com/leanprover/lean4/pull/7637\">lean4#7637</a></p>\n<p>It seems reasonable to me that the check for primitive projections could be simplified to whether the type supports large elimination. Proofs are usually not reduced, so I'm not sure that primitive projections are necessary in the <code>Prop</code>-elimination case. Plus, definitional proof irrelevance means structure eta doesn't need primitive projections</p>\n<p>(Side note: A sufficiently smart elaborator could 'allow' primitive projections on <code>Exists</code> in <code>Prop</code> contexts, constructively. The idea would be if <code>v.1</code> or <code>v.2</code> appears, you find all occurrences, abstract them out, and insert an <code>Exists.recOn</code>. Easier though would be to be able to register that <code>v.1</code> is <code>v.choose</code> and <code>v.2</code> is <code>v.choose_spec</code>.)</p>",
        "id": 560051982,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1764034362
    }
]