[
    {
        "content": "<p>Is there a way to execute <code>Expr.headBeta</code> on all local declarations?</p>\n<p>Sometimes I see a local declaration of this type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>\n<p>and I want to eliminate them. e.g. <code>b</code> would be typed <code>b : ...[x/y]</code> instead.</p>\n<p>The reason is the <code>apply</code> tactic seems to really struggle with applying <code>b</code> when its type of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">forall</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>\n<p>and it loses track of goals that it produces.</p>",
        "id": 496051063,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1737962709
    },
    {
        "content": "<p>Does the tactic <code>beta_reduce at *</code> work for you?</p>",
        "id": 496074406,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1737970835
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Execute.20.60headBeta.60.20on.20all.20local.20decl/near/496074406\">said</a>:</p>\n<blockquote>\n<p>Does the tactic <code>beta_reduce at *</code> work for you?</p>\n</blockquote>\n<p>I need a vanilla metaprogramming solution ):</p>",
        "id": 496155440,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1737993178
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Core.betaReduce#doc\">docs#Lean.Core.betaReduce</a> (which is the ultimate implementation of <code>beta_reduce</code>) is pretty vanilla.</p>",
        "id": 496175085,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1737998444
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Execute.20.60headBeta.60.20on.20all.20local.20decl/near/496175085\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Core.betaReduce#doc\">docs#Lean.Core.betaReduce</a> (which is the ultimate implementation of <code>beta_reduce</code>) is pretty vanilla.</p>\n</blockquote>\n<p>and I would have to execute this on every fvar of local declarations? Is there a way to run a function to modify local decls?</p>",
        "id": 496186396,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1738002147
    },
    {
        "content": "<p>Did you try to find a tactic doing something similar that you could use as inspiration?</p>",
        "id": 496195028,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1738005265
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Execute.20.60headBeta.60.20on.20all.20local.20decl/near/496195028\">said</a>:</p>\n<blockquote>\n<p>Did you try to find a tactic doing something similar that you could use as inspiration?</p>\n</blockquote>\n<p>Therei is <code>beta_reduce</code>. If there's no simpler infrastructure I'll just copy its implementation</p>",
        "id": 496195769,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1738005570
    },
    {
        "content": "<p>I was referring to your question about modifying every local declaration.</p>",
        "id": 496198835,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1738006771
    },
    {
        "content": "<p>[Quotingâ€¦]</p>\n<p><code>beta_reduce</code> does it, but it doesn't rely on vanilla Lean functions</p>",
        "id": 496199938,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1738007188
    },
    {
        "content": "<p>You can have a look in the metaprogramming book. <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/main/04_metam.html#local-contexts\">This section</a> describes how to loop through the local context, among other things.</p>",
        "id": 496204284,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1738008816
    }
]