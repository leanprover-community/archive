[
    {
        "content": "<p>How can I write a command to declare (simple) <code>inductive</code> types (and have them persist after the command is called)? For example,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#my_cmd\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ctx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LocalContext</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">liftTermElabM</span><span class=\"w\"> </span><span class=\"n\">getLCtx</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ctx</span><span class=\"bp\">.</span><span class=\"n\">getUnusedName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">mkSimple</span><span class=\"w\"> </span><span class=\"s2\">\"abcd\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- how to add `name` as a new, free variable?</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inductDecl</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">[{</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">ctors</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"n\">liftCoreM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">addDecl</span><span class=\"w\"> </span><span class=\"n\">fDecl</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- error: (kernel) unknown constant 'abcd' -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">my_cmd</span>\n</code></pre></div>\n<p>I am aware that this is possible with <code>elabCommand</code>, but  in my actual problem the number of constructors is passed in as an argument.</p>",
        "id": 519750334,
        "sender_full_name": "Will Bradley",
        "timestamp": 1747892095
    },
    {
        "content": "<p>I think you also have to compile and kernel check it</p>",
        "id": 519795209,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908171
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/How.20to.20programatically.20declare.20.60inductive.60s/near/519795209\">said</a>:</p>\n<blockquote>\n<p>I think you also have to compile and kernel check it</p>\n</blockquote>\n<p>Like calling <code>compileDecl</code> before <code>addDecl</code>? That doesn't seem to change things, the error happens at <code>addDecl</code>.</p>",
        "id": 519796469,
        "sender_full_name": "Will Bradley",
        "timestamp": 1747908539
    },
    {
        "content": "<p>I have no idea</p>",
        "id": 519797337,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908805
    },
    {
        "content": "<p>Wait are you trying to type it as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">abcd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">abcd</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>",
        "id": 519797594,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908896
    },
    {
        "content": "<p>I think that's the reason why it's failing</p>",
        "id": 519797718,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908944
    },
    {
        "content": "<p>You can't have an inductive be its own type</p>",
        "id": 519797808,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908965
    },
    {
        "content": "<p>If you make it <code>type := .sort 0</code> or something it will probably work</p>",
        "id": 519797882,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747908992
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/How.20to.20programatically.20declare.20.60inductive.60s/near/519797718\">said</a>:</p>\n<blockquote>\n<p>I think that's the reason why it's failing</p>\n</blockquote>\n<p>Oh my gosh tysm lol, I can't believe I thought the <code>type</code> part was the overall inductive type</p>",
        "id": 519799181,
        "sender_full_name": "Will Bradley",
        "timestamp": 1747909423
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"674953\">Will Bradley</span> has marked this topic as resolved.</p>",
        "id": 519799192,
        "sender_full_name": "Notification Bot",
        "timestamp": 1747909426
    }
]