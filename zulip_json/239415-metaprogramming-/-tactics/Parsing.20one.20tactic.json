[
    {
        "content": "<p>Why does Lean's parser consider <code>intro n\\ncases n</code> to be a single tactic?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"intro n</span><span class=\"se\">\\n</span><span class=\"s2\">cases n\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">result?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">runParserCategory</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"ss\">`tactic</span><span class=\"w\"> </span><span class=\"n\">input</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">result?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"One tactic!\"</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{s}\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Not one tactic!: {e}\"</span>\n</code></pre></div>\n<p>If we take this at face value and use <code>evalTactic</code> on this composite tactic, <code>cases n</code> would not run normally.</p>",
        "id": 531955929,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1753921872
    },
    {
        "content": "<p><code>intro n cases n</code> where <code>cases</code> is treated as the variable name to intro, I'm guessing</p>",
        "id": 531956351,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753922158
    },
    {
        "content": "<p>if you want a tactic seq then parse it as a <code>tacticSeq</code></p>",
        "id": 531956490,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753922253
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Parsing.20one.20tactic/near/531956351\">said</a>:</p>\n<blockquote>\n<p><code>intro n cases n</code> where <code>cases</code> is treated as the variable name to intro, I'm guessing</p>\n</blockquote>\n<p>but in this case, there is a newline between the two tactics. If I write the tactics down in <code>by</code>-block they would be considered separate tactics.</p>",
        "id": 531960264,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1753924869
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Parsing.20one.20tactic/near/531956490\">said</a>:</p>\n<blockquote>\n<p>if you want a tactic seq then parse it as a <code>tacticSeq</code></p>\n</blockquote>\n<p>If I set the category to <code>tacticSeq</code> it prints <code>&lt;input&gt;:1:0: unknown parser category 'tacticSeq'</code>.</p>",
        "id": 531960308,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1753924894
    },
    {
        "content": "<p>It's because there's no \"withPosition\" set and the tactics don't know which column they're supposed to align to, so, for example, <code>intro</code> doesn't know it shouldn't keep consuming identifiers</p>",
        "id": 531960387,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753924956
    },
    {
        "content": "<p>That's what the colGt in the tactic syntax is preventing, but it only works if this bit of the parser state is enabled.</p>",
        "id": 531960442,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753925011
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Parsing.20one.20tactic/near/531960308\">said</a>:</p>\n<blockquote>\n<p>If I set the category to <code>tacticSeq</code> it prints <code>&lt;input&gt;:1:0: unknown parser category 'tacticSeq'</code>.</p>\n</blockquote>\n<p>Yes, that's the expected error, since <code>tacticSeq</code> isn't a parser category, it's a parser.</p>",
        "id": 531960471,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753925041
    },
    {
        "content": "<p>You could make a new parser category and then give it one <code>syntax</code> definition, something like <code>withPosition(tactic)</code></p>",
        "id": 531960577,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753925109
    },
    {
        "content": "<p>or maybe I can define my own <code>runParserCategory</code> analog that calls into <code>withPosition</code>?</p>",
        "id": 531960790,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1753925259
    }
]