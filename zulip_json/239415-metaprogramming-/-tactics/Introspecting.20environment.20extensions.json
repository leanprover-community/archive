[
    {
        "content": "<p>Is it possible to introspect environment extensions from within <code>CoreM</code>? I know that environment extensions can only be registered during initialization, but is any of their data accessible from <code>CoreM</code>? Ultimately the goal is to check the environment extension for parsers to see how to modify it to replace the formatter used by a specific parser.</p>",
        "id": 494222518,
        "sender_full_name": "nrs",
        "timestamp": 1737057115
    },
    {
        "content": "<p>We can access values of type <code>EnvExtensionState</code> from <code>let env &lt;- getEnv</code> and  then considering <code>env.extensions</code>, but I'm not really sure how I could <code>dbg_trace</code> members of the resulting array</p>",
        "id": 494222796,
        "sender_full_name": "nrs",
        "timestamp": 1737057220
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">OpenPrivate</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">envExtensionsRef</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Environment</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">envExtensionsRef</span><span class=\"w\"> </span><span class=\"c1\">-- these are nameless but they are indexed, maybe it has more extensions than persistentEnvExtensionsRef?</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">persref</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">persistentEnvExtensionsRef</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">printPersExts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">elm</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">persref</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">println!</span><span class=\"w\"> </span><span class=\"n\">elm</span><span class=\"bp\">.</span><span class=\"n\">name</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">printPersExts</span>\n</code></pre></div>\n<p>use this to access the state of the extensions in the env</p>",
        "id": 494236146,
        "sender_full_name": "nrs",
        "timestamp": 1737063098
    }
]