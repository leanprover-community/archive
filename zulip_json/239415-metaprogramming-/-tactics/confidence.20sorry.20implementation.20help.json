[
    {
        "content": "<p>is that possible to implement a confidence associated sorry via meta programming? I would like to introduce confidence into sorry. and confidence_sorry would be able to propagate the confidence to the upper func with the confidence, and the confidence are then referenced for boolean logics. e.g. and logic would yield minimum confidence of all terms, or logic would yield confidence of weighted sum of each term activating freqs and corresponding term confidence, etc. then the top prove would searching for the highest confidence prove path. the path should be trackable with each chosen axiom, lemma proven by confidence_sorry.</p>",
        "id": 486117137,
        "sender_full_name": "David Liang",
        "timestamp": 1733325618
    },
    {
        "content": "<p><a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/confidence.20sorry.20implementation.20help/near/486117137\">A message</a> was moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/is.20that.20possible.20to.20implement.20sorry.20via.20meta.20programming.3F\">#lean4 &gt; is that possible to implement sorry via meta programming?</a> by <span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span>.</p>",
        "id": 486122411,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733326932
    },
    {
        "content": "<p>Please don't post duplicate messages to different channels.</p>",
        "id": 486122473,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733326948
    },
    {
        "content": "<p>is the idea even possible? or anything close to that?</p>",
        "id": 486123023,
        "sender_full_name": "David Liang",
        "timestamp": 1733327081
    },
    {
        "content": "<p><code>sorry</code> is just syntax which produces a call to <code>sorryAx</code>. You can define your own <code>sorryConfidenceAx (confidence : Rat)</code> (or use another type for confidence level), and have tactics that produce it and a command which calculates the minimum confidence sorry in a term, along the same lines as <code>#print axioms</code></p>",
        "id": 486123428,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733327182
    },
    {
        "content": "<p>from what i read, the sorryAx looks like invoking an internal func lean_sorry. The lean_sorry implementation looks weird. it panics directly. i might misunderstand the runtime. why it can panic and not disrupt the whole tactic? leave that alone, i still have little clue on implement the sorryConfidenceAx as you mentioned. if i'm not mistaken, it should also be something like:<br>\n@[extern \"lean_sorry\", never_extract]<br>\naxiom sorryConfidenceAx (α : Sort u) (synthetic := false)  : {confidence:Rat} → α<br>\nthe Sort u is a bit hard to understand. the universe level description in metaprogramming book is not easy to follow the concept. And how to make the confidence interact with boolean logic in the above mentioned ways? and does  it interact with existing tactics well?</p>",
        "id": 486128635,
        "sender_full_name": "David Liang",
        "timestamp": 1733328554
    },
    {
        "content": "<p>Make sure you're not misinterpreting the function of <code>implemented_by</code>. That's to give the runtime behavior of <code>sorryAx</code> in compiled code, and it makes sense to have the runtime panic if <code>sorryAx</code> is ever executed since <code>sorryAx</code> stands for a missing value.</p>",
        "id": 486145477,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733333613
    },
    {
        "content": "<p>It's probably better to take advantage of <code>sorry</code> and make a definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sorryConfidenceAx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">confidence</span>\n</code></pre></div>\n<p>(I wrote it this way so that sorries with different confidences are different. If you just write <code>sorry</code> on its own on the RHS then <code>sorryConfidenceAx Nat 0 = sorryConfidenceAx Nat 1</code> is true.)</p>",
        "id": 486145813,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733333757
    },
    {
        "content": "<p>i think meta programming is at least required to make the boolean logic work with the confidence level. <br>\nterm1 AND term2<br>\nthe confidence is determined by the minimum confidence of term1, term2.<br>\nterm1 OR term2<br>\nthe confidence is determined by the router ratio, and corresponding confidence. ratio term1<em>term1 confidence+ ratio term2</em>term2 confidence to estimate the overall confidence. possibly MVar is required from my limited lean4 understanding.</p>",
        "id": 486203865,
        "sender_full_name": "David Liang",
        "timestamp": 1733359132
    },
    {
        "content": "<p>I think that first you need to figure out what's your goal.</p>",
        "id": 486221217,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733370707
    },
    {
        "content": "<p>the goal is to define a confidence associated sorry. and it's capable of doing some boolean logical tactics?</p>",
        "id": 486221336,
        "sender_full_name": "David Liang",
        "timestamp": 1733370790
    },
    {
        "content": "<p>You can have \"sorry with confidence\" like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">sorryWithConfidence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>\n<p>then use</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">sorryWithConfidence</span><span class=\"w\"> </span><span class=\"mf\">0.5</span>\n</code></pre></div>\n<p>(or a <code>macro</code> that unfolds to it) to close goals and have a metaprogram that works like <code>#print axioms</code> but find the minimal confdence level used in <code>sorryWithConfidence</code> calls.</p>",
        "id": 486221532,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733370940
    },
    {
        "content": "<p>Or you can introduce a type of propositions that are true at a confidence level.</p>",
        "id": 486221634,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371010
    },
    {
        "content": "<p>In other words, use something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ConfidenceProp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UpperSet</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">TrueWithConfidence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ConfidenceProp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n</code></pre></div>",
        "id": 486221701,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371070
    },
    {
        "content": "<p>how about the boolean logic part, i would like to have a way of doing term statistics to yield the confidence for certain proving program?</p>",
        "id": 486221764,
        "sender_full_name": "David Liang",
        "timestamp": 1733371097
    },
    {
        "content": "<p>Read the paragraph about \"#print axioms\" above.</p>",
        "id": 486221809,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371148
    },
    {
        "content": "<p>i have an idea of integrating math provers into a neural system to solve general problems with confidence. and improve term confidence  as much as possible.</p>",
        "id": 486221947,
        "sender_full_name": "David Liang",
        "timestamp": 1733371229
    },
    {
        "content": "<p>If you want to have implications like \"if <code>p</code> is true with confidence <code>r</code> and <code>q</code> is true with confidence <code>s</code>, then <code>p ∨ q</code> is true with confidence <code>max r s</code>\", then you need a proper theory of propositions that are true at a given confidence level, not a \"sorry with confidence\".</p>",
        "id": 486222016,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371267
    },
    {
        "content": "<p>i proposed a way of calc such confidence in the above discussion. is that the theory you refer to?</p>",
        "id": 486222210,
        "sender_full_name": "David Liang",
        "timestamp": 1733371362
    },
    {
        "content": "<p>With \"sorry with confidence\", all you can do is to find the minimal <code>r</code> in all calls to <code>sorryWithConfidence r</code>in the proof.</p>",
        "id": 486222216,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371364
    },
    {
        "content": "<p>BTW, what's your background in math and in Lean?</p>",
        "id": 486222352,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733371461
    },
    {
        "content": "<p>i'm quite new to lean. major interest is to utilize the lean proving tactics into a progressively improving neural system. each term is a neural trainable program. with more data, the trainable program improves over time and the confidence feedback is more accurate.</p>",
        "id": 486222895,
        "sender_full_name": "David Liang",
        "timestamp": 1733371901
    },
    {
        "content": "<p>and incorporate some llm feature to decouple the neural program into smaller programs.</p>",
        "id": 486222966,
        "sender_full_name": "David Liang",
        "timestamp": 1733371934
    },
    {
        "content": "<p>If you want to use Lean, then you should first (a) learn Lean; (b) write Lean code that you want to make work.</p>",
        "id": 486228171,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733375777
    },
    {
        "content": "<p>Then it will be possible to help you.</p>",
        "id": 486228188,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733375789
    },
    {
        "content": "<p>E.g., it is possible to make this work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyGoal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">myAuxThm</span><span class=\"w\"> </span><span class=\"c1\">-- generates 2 subgoals</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_confidence</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"c1\">-- prints 5</span>\n</code></pre></div>",
        "id": 486228431,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733375994
    },
    {
        "content": "<p>But this doesn't help with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalLeft</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">GoalRight</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalLeft</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalRight</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n<span class=\"w\">  </span><span class=\"n\">my_magic</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_confidence</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"c1\">-- prints 7</span>\n</code></pre></div>\n<p>because you need to choose whether you use <code>left</code> or <code>right</code> to prove. Of course, if you generate proofs with LM, you can try both, so it will be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalLeft</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">GoalRight</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">left</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">myThm'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GoalLeft</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">GoalRight</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">right</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n\n<span class=\"bp\">#</span><span class=\"n\">print_confidence</span><span class=\"w\"> </span><span class=\"n\">myThm</span><span class=\"w\"> </span><span class=\"c1\">-- 5</span>\n<span class=\"bp\">#</span><span class=\"n\">print_confidence</span><span class=\"w\"> </span><span class=\"n\">myThm'</span><span class=\"w\"> </span><span class=\"c1\">-- 7, prefer this proof</span>\n</code></pre></div>",
        "id": 486228748,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733376187
    },
    {
        "content": "<p>it lies on the applicability. e.g. h1 applicability is 50%, h2 applicability is 30%, desired output would be something like: 50%<em>5+30%</em>7. just linear assumption. Can the problem to be solved via FFI, the interfacing program would log the applicability via routing network prob output, and the conf_sorry would also call the external function for fetching this info?</p>",
        "id": 486229058,
        "sender_full_name": "David Liang",
        "timestamp": 1733376428
    },
    {
        "content": "<p>Please, write an example code snippet with example expected output.</p>",
        "id": 486229193,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733376545
    },
    {
        "content": "<p>In other words, what would be a test file for the new feature?</p>",
        "id": 486229213,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733376568
    }
]