[
    {
        "content": "<p>Given a numeric literal <code>n: TSyntax `num</code>, is there a better way to construct the corresponding <code>Int</code> literal than converting to a <code>Nat</code> and back i.e.  <code>.app (.const ``Int.ofNat []) (mkNatLit n.getNat)</code>? I couldn't find a <code>mkIntLit</code> or similar in the prelude.</p>",
        "id": 554415778,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1762549573
    },
    {
        "content": "<p>probably the <code>Lean.ToExpr</code> instance for <code>Int</code>?</p>",
        "id": 554415842,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762549605
    },
    {
        "content": "<p>To get the expr for an int, you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.mkIntLit#doc\">docs#Lean.mkIntLit</a></p>",
        "id": 554515596,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762641255
    },
    {
        "content": "<p>I am trying to solve the opposite problem - to generate an <code>Int</code> from a parsed numeric literal, rather than getting an <code>Expr</code> from an <code>Int</code>. In fact, I think the thing I am missing is not <code>mkIntLit</code> but rather some <code>Int</code> version of <code>Lean.TSyntax.getNat : NumList -&gt; Nat</code>.</p>",
        "id": 554724907,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1762787395
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> note that <code>-37</code> is not a <code>num</code> so your question is not really well-formed</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">TSyntax</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getInt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">-$</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">TSyntax</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"mi\">37</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{s.getInt}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">67</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{s.getInt}\"</span>\n</code></pre></div>\n<p>Also your original problem <em>did</em> ask about getting an Expr... and you said <code>mkIntLit</code> which does exist and is Int -&gt; Expr...?</p>\n<p>I am a bit confused about what exactly you're asking for. It would help both of us greatly if you could include some code with a blank that we can fill in. (<a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>)</p>",
        "id": 554764646,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762798672
    },
    {
        "content": "<p>Sorry, I don't understand your comment. I didn't mention anything about <code>-37</code>, and every <code>num</code> should be parsable as an int, I would imagine. Here is a mwe:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">elabExpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Expr</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">-$</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkAppN</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``expr.const</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkAppN</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``expr.const</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>\n<p>I would like to be able to parse the <code>num</code> as <code>Int</code> here, and I am wondering if there is a better way than <code>getNat</code>, followed by <code>mkNatLit</code>, then <code>Int.ofNat</code>.</p>",
        "id": 554767843,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1762799771
    },
    {
        "content": "<p>But <code>-$n:num</code> is not a num, it's a minus sign (which is a unary operator) followed by a <code>$n:num</code></p>",
        "id": 554768103,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762799881
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> well, the better way is to not skip steps, and go from syntax to Int and then to Expr; then you wouldn't have to repeat code for the Int -&gt; Expr part!</p>",
        "id": 554768479,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762800043
    },
    {
        "content": "<p>did you see the function I wrote above?</p>",
        "id": 554768580,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1762800090
    }
]