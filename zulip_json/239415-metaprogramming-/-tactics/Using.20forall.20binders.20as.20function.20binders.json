[
    {
        "content": "<p>What's the best way to reuse forall binders as function binders in a macro? I'd like to implement a function like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- this is `(binderIdent &lt;|&gt; bracketedBinder)`</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">binderKinds</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SyntaxNodeKinds</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"ss\">`ident</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Parser.Term.hole</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Parser.Term.bracketedBinder</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- create a pair of type `Σ' (A : Sort _), A` with a hole `⟨(∀ binders, sig), (λ binders ↦ ?name)⟩`</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkPair</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`ident</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">binders</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntaxArray</span><span class=\"w\"> </span><span class=\"n\">binderKinds</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MacroM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">PSigma</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">binders</span><span class=\"bp\">*</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">sig</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">binders</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">?$</span><span class=\"n\">name</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>The parser for functions asks for <code>`Lean.Parser.Term.funBinder</code>, which I see includes all of the bracketed forms including implicit and instance arguments, so it should be possible to map my binders to funBinders. Is there some way to coerce this, or should I manually match on the binder syntax and reconstruct  them as funBinders?</p>",
        "id": 547362829,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1761595697
    },
    {
        "content": "<p>For reference, I used a coercion:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"n\">binderKinds</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Parser.Term.funBinder</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">stx</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>which feels like cheating, but I haven't encountered an unexpected parse error <em>yet</em>...</p>",
        "id": 547577421,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1761681188
    }
]