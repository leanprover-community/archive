[
    {
        "content": "<p>Am trying to make a delaborator that will print a top-level function as </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">someFunc</span>\n<span class=\"w\">  </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">arg1</span>\n<span class=\"w\">  </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">arg2</span>\n</code></pre></div>\n<p>Does anyone have examples of delaborators or unexpanders that control whitespace and indentation?</p>",
        "id": 494032715,
        "sender_full_name": "nrs",
        "timestamp": 1736982220
    },
    {
        "content": "<p>Delaborators don't control whitespace or indentation.</p>\n<p>Instead, you need to somehow encode whitespace handling in the syntax definition itself.</p>",
        "id": 494032845,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736982273
    },
    {
        "content": "<p>Hm I see. Any chance you could give me a vague idea of what it would mean to encode whitespace in <code>Syntax</code>? Do you mean e.g. using tab/space/whitespace characters in the <code>String</code> for e.g. <code>Syntax.atom</code>?</p>",
        "id": 494033094,
        "sender_full_name": "nrs",
        "timestamp": 1736982396
    },
    {
        "content": "<p>Wasn't there an example of exactly this in the early days of lean 4?</p>",
        "id": 494033128,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736982417
    },
    {
        "content": "<p>Maybe \"early days\" was not really correct, but <a href=\"#narrow/channel/270676-lean4/topic/Fun.20macro.20-.20bulleted.20argument.20lists\">this discussion</a> is what I had in mind.</p>",
        "id": 494033675,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736982718
    },
    {
        "content": "<p>How about you give your syntax definition as a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 494033814,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736982795
    },
    {
        "content": "<p>Oh, you want the arguments to be displayed in that format, not entered like that!</p>",
        "id": 494033834,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736982806
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> concretely I'm trying to make this for an arbitrary recursor. as a special case I'm working with the <code>Expr</code> from <code>List.permutationsAux.rec</code> (just so happened to be the example that made me start on ideas for making verbose <code>Expr</code>s easier to read)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">permutationsAux</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"n\">l₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">l₁</span><span class=\"w\"> </span><span class=\"n\">l₂</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">H0</span><span class=\"w\"> </span><span class=\"n\">is</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">permutationsAux</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">H0</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">permutationsAux</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">H0</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"o\">[])</span>\n<span class=\"w\">  </span><span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"n\">ts</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">decreasing_by</span><span class=\"w\"> </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">simp_wf</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> yeah, only pretty printing!</p>",
        "id": 494034178,
        "sender_full_name": "nrs",
        "timestamp": 1736982977
    },
    {
        "content": "<p>Maybe you could look at how <code>match</code> syntax is defined and look in Delaborators/Builtins for the builtin <code>match</code> delaborator.</p>",
        "id": 494035461,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736983692
    },
    {
        "content": "<p>will get started on that, thank you!</p>",
        "id": 494035584,
        "sender_full_name": "nrs",
        "timestamp": 1736983766
    },
    {
        "content": "<p>Note that since <code>match</code> syntax is builtin, it's using a lower-level parser description than <code>syntax</code>. For user-defined syntax, <code>syntax</code> is nicer.</p>",
        "id": 494035696,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736983811
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"w\"> </span><span class=\"n\">Format</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myFormat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Format</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">text</span><span class=\"w\"> </span><span class=\"s2\">\"theFunc\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">nest</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">text</span><span class=\"w\"> </span><span class=\"s2\">\"arg, the First\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">nest</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">text</span><span class=\"w\"> </span><span class=\"s2\">\"seconarg\"</span><span class=\"o\">))))</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">myFormat</span>\n</code></pre></div>",
        "id": 494213603,
        "sender_full_name": "nrs",
        "timestamp": 1737053579
    },
    {
        "content": "<p>more examples in the Wadler article mentioned at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Format#doc\">docs#Std.Format</a></p>",
        "id": 494214484,
        "sender_full_name": "nrs",
        "timestamp": 1737053907
    }
]