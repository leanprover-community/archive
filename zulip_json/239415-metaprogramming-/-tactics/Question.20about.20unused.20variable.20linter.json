[
    {
        "content": "<p>I'm looking at the <a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Linter/UnusedVariables.lean\">unused variable linter</a> because I'd like to implement a similar analysis in a tool for proof optimisation/cleanup. The docs say:</p>\n<blockquote>\n<p>The main complication is that it can be difficult to<br>\ndetermine what constitutes a \"use\" apart from direct references to a variable<br>\nthat we can easily find in the info tree.  For example, we would like this to be<br>\nconsidered a use of <code>x</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span>\n</code></pre></div>\n<p>The final proof term is <code>fun x =&gt; x</code> so clearly <code>x</code> was used, but we can't make<br>\nuse of this because the final proof term is after we have abstracted over the<br>\noriginal <code>fvar</code> for <code>x</code>. [...]</p>\n<p>If we [...] look further into the tactic state, we can see<br>\nthe <code>fvar</code> show up in the instantiation to the original goal metavariable<br>\n<code>?m : Nat := x</code>, but it is not always the case that we can follow metavariable<br>\ninstantiations to determine what happened after the fact, because tactics might<br>\nskip the goal metavariable and instantiate some other metavariable created prior<br>\nto it instead.</p>\n</blockquote>\n<p>I don't quite understand what the corner case described here would look like. Could someone enlighten me? CC <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> and <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> since you're listed as authors of the linter.</p>",
        "id": 528547358,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1752430755
    },
    {
        "content": "<p>(the last rewrite of the linter was <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> 's)</p>",
        "id": 528567261,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1752451570
    }
]