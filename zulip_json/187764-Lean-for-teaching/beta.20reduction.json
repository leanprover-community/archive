[
    {
        "content": "<p>I am teaching algorithms design with Lean. We can prove simple theorems and basically reduce step by step definitions with unfold and rewrite. But when I reach terms that can be beta reduced, simp and rw finish the proof. Is there any tactic to apply one beta reduction?</p>",
        "id": 464624011,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1724411653
    },
    {
        "content": "<p>For head beta, <code>beta%</code> is a term elaborator</p>",
        "id": 464626292,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724412373
    },
    {
        "content": "<p>Do you have a course webpage?</p>",
        "id": 464640595,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724416542
    },
    {
        "content": "<p>You can also turn off <code>beta</code> (and other reductions) in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.Simp.Config#doc\">docs#Lean.Meta.Simp.Config</a> if you want to intentional about the steps but still use <code>simp</code>.</p>",
        "id": 464641702,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724416864
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> , I am working on it. For now, <a href=\"https://github.com/emap-ed-20242/syllabus\">https://github.com/emap-ed-20242/syllabus</a>. I am basically trying to follow <a href=\"https://www.amazon.com/Algorithm-Design-Haskell-Richard-Bird/dp/1108491618\">https://www.amazon.com/Algorithm-Design-Haskell-Richard-Bird/dp/1108491618</a>. But I also found this nice book implemented in Isabelle (<a href=\"https://functional-algorithms-verified.org/\">https://functional-algorithms-verified.org/</a>).</p>",
        "id": 464695077,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1724432361
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> , I want to show one beta reduction at a time, that is my point. <code>simp</code> is not needed, <code>rfl</code> is enough or <code>rw</code>. I didn't find the <code>beta%</code></p>",
        "id": 464695608,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1724432458
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=elabBeta#doc\">docs#elabBeta</a></p>",
        "id": 464696923,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724432794
    },
    {
        "content": "<p>There's also a beta reduction gadget for conv mode in mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">beta_reduce</span>\n<span class=\"w\">    </span><span class=\"n\">trace_state</span><span class=\"w\"> </span><span class=\"c1\">-- id 1 = 1</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>But if there are multiple arguments they'll all get applied.</p>",
        "id": 464701247,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1724433944
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"228466\">@Chris Bailey</span> There's also a <code>beta_reduce</code> tactic</p>",
        "id": 464704003,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724434465
    },
    {
        "content": "<p>Even better.</p>",
        "id": 464704226,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1724434517
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121542\">@Alexandre Rademaker</span> You can use the <code>rewrite</code> tactic rather than <code>rw</code>. The <code>rw</code> tactic is basically <code>rewrite [...]; try rfl</code></p>",
        "id": 464704309,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724434541
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> I'm not sure how <code>beta%</code> would help here? The point is to try to do beta reduction in a target, not beta reduce during elaboration.</p>",
        "id": 464704500,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724434589
    },
    {
        "content": "<p>If you want tight control over your reductions, I think the clearest thing would be to do <code>change</code> with explicitly what you want to transform it to, since there's not really a tactic that does single beta reductions. However, I suppose you could use <code>conv</code> to navigate to a term and then use a custom version of <code>beta_reduce</code> that does just a single beta reduction at the head.</p>",
        "id": 464704639,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724434632
    },
    {
        "content": "<p>Oh, I read that as working forward from a term to a goal and not backwards on the goal.</p>",
        "id": 464712984,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724436768
    },
    {
        "content": "<p>I turns out that with more control in the rewrite solves my problem! Using the example below I could perfectly illustrate how <code>foldr</code> works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foldr</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foldr</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foldr</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foldr</span>\n<span class=\"w\">  </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]})</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]})</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">occs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]})</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 464746388,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1724447981
    },
    {
        "content": "<p>If I use <code>(· + ·)</code> instead of <code>Nat.add</code> than I would need the beta reduction control.. right?</p>",
        "id": 464746581,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1724448061
    }
]