[
    {
        "content": "<blockquote>\n<p>chore: adaptations for nightly-2024-10-19 <a href=\"https://github.com/leanprover-community/mathlib4/pull/17984\">#17984</a></p>\n</blockquote>",
        "id": 477930830,
        "sender_full_name": "port-progress bot",
        "timestamp": 1729461660
    },
    {
        "content": "<p>This one required some manual conflict resolution.</p>",
        "id": 477930857,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729461675
    },
    {
        "content": "<p>yikes, loads of things got worse</p>",
        "id": 477934397,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729464728
    },
    {
        "content": "<p>Oh no wait, only a couple of things got worse, but they were right at the top, and then there's loads of <code>set_option linter.deprecated false</code>.</p>",
        "id": 477934424,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729464772
    },
    {
        "content": "<p>There's an error in <code>test/Lint.lean</code></p>",
        "id": 477934463,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729464829
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/p6gPHm7CRlCtvcX69W8Rs1WU/Screenshot-from-2024-10-20-23-55-44.png\">Screenshot from 2024-10-20 23-55-44.png</a><br>\nRe getting worse: to be more precise, there are a few things like this -- what happened there? Primed lemmas got removed and it turned out they were useful but they're removed anyway?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/p6gPHm7CRlCtvcX69W8Rs1WU/Screenshot-from-2024-10-20-23-55-44.png\" title=\"Screenshot from 2024-10-20 23-55-44.png\"><img data-original-dimensions=\"868x202\" src=\"/user_uploads/thumbnail/3121/p6gPHm7CRlCtvcX69W8Rs1WU/Screenshot-from-2024-10-20-23-55-44.png/840x560.webp\"></a></div><p>And what's with all the linter.deprecated stuff e.g.<br>\n<a href=\"/user_uploads/3121/i4yVHhZS_U7HyckSVQ2ylsO5/Screenshot-from-2024-10-20-23-56-53.png\">Screenshot from 2024-10-20 23-56-53.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/i4yVHhZS_U7HyckSVQ2ylsO5/Screenshot-from-2024-10-20-23-56-53.png\" title=\"Screenshot from 2024-10-20 23-56-53.png\"><img data-original-dimensions=\"868x202\" src=\"/user_uploads/thumbnail/3121/i4yVHhZS_U7HyckSVQ2ylsO5/Screenshot-from-2024-10-20-23-56-53.png/840x560.webp\"></a></div>",
        "id": 477934702,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729465076
    },
    {
        "content": "<p>Other than those comments it looks fine</p>",
        "id": 477934808,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729465194
    },
    {
        "content": "<p>This is getting rid of <code>Nat.sum</code>, which there doesn't appear to be any use case for instead of <code>List.sum</code>. It used to be that <code>Nat.sum</code> was defined in Batteries and then later in Lean, so various theorems were stated in terms of it because <code>List.sum</code> wasn't available. Now <code>List.sum</code> is in Lean (it only uses notation typeclasses <code>Add</code> and <code>Zero</code>), so we no longer need to jump through hopes with duplicated lemmas with primed names. Hence I've deprecated the primed lemmas.</p>",
        "id": 477937347,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729467728
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/428973-nightly-testing/topic/.2317984.20adaptations.20for.20nightly-2024-10-19/near/477934702\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/p6gPHm7CRlCtvcX69W8Rs1WU/Screenshot-from-2024-10-20-23-55-44.png\">Screenshot from 2024-10-20 23-55-44.png</a><br>\nRe getting worse: to be more precise, there are a few things like this -- what happened there? Primed lemmas got removed and it turned out they were useful but they're removed anyway?</p>\n<p>And what's with all the linter.deprecated stuff e.g.<br>\n<a href=\"/user_uploads/3121/i4yVHhZS_U7HyckSVQ2ylsO5/Screenshot-from-2024-10-20-23-56-53.png\">Screenshot from 2024-10-20 23-56-53.png</a></p>\n</blockquote>\n<p>In this case I'm just moving the proof of the primed lemma verbatim to become the proof of the unprimed lemma, so we can let the primed lemma go.</p>",
        "id": 477937372,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729467766
    },
    {
        "content": "<p>Got it! Thanks for the explanations.</p>",
        "id": 477937656,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729468016
    },
    {
        "content": "<p>My one remaining confusion is why in Data.List.Join there are deprecations being removed, for example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2024-10-25\"</span><span class=\"o\">)</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">length_bind'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">length_flatMap'</span>\n</code></pre></div>\n<p>is removed (and the date was in the future!), so I'm wondering whether <code>length_bind'</code> has now vanished with no deprecation warning. Similarly</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2024-10-16\"</span><span class=\"o\">)</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">countP_bind'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">countP_flatMap'</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2024-10-16\"</span><span class=\"o\">)</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">count_bind'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">count_flatMap'</span>\n</code></pre></div>\n<p>Everything else looks fine to my slightly naive eyes.</p>",
        "id": 477938936,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729469057
    },
    {
        "content": "<p>Good catches, thank you. Those three deprecations did indeed get lost in a merge conflict I was insufficiently careful on! They are restored now.</p>",
        "id": 477940433,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729470572
    },
    {
        "content": "<p>OK no further questions. Do I need to wait for the tick to bors merge? I need to get some sleep! Edit: oh it's there.</p>",
        "id": 477942554,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729472576
    },
    {
        "content": "<p>I am very unclear about the time pressures involved in these adaption PRs. Am I right in thinking that now this one is over the line, we've made it up to 19th Oct but it's currently 21st Oct so right now we're \"two days behind\", and if we were to get for example a week behind then this would become problematic?</p>",
        "id": 477943281,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729473277
    },
    {
        "content": "<p>If <code>nightly-testing</code> itself is persistently failing, then it becomes hard/impossible for authors of Lean PRs to test their PRs against Mathlib (thereby identifying problems ahead of time, rather than here!). That's sad, not only because it makes it harder to test, it makes the authors of Lean PRs less enthusiastic about regularly making use of that testing process.</p>\n<p>If <code>nightly-testing</code> is at least intermittently green, at least that part of the process works, even if we don't make these adaptations PRs successfully / \"on time\".</p>\n<p>The main time pressure with the adaptation PRs is that it is only possible reliably to have one in flight at once (as we merge <code>master</code> into<code> bump/v4.X.0</code> immediately prior to making each adaptation PR, and then doing that again for the next week very often breaks the previous adaptation PR). So if one adaptation PR takes a while to be reviewed, we end up then batching several days worth of adaptations together in the next such PR. This is not problematic beyond the fact that experience shows reviewing time is superlinear in the size of a PR. :-)</p>",
        "id": 477967004,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729490694
    }
]