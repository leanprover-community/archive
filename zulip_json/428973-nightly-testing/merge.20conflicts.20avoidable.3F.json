[
    {
        "content": "<p>Which script is that again?<br>\n(Found it. <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span> )</p>",
        "id": 453342988,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721718643
    },
    {
        "content": "<p>I see three merge operations that might have conflicts (<code>master</code> into <code>bump</code>, nightly into adaption branch, adaption branch back into nightly) . Do you remember which of the two had conflicts?</p>",
        "id": 453345727,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721719721
    },
    {
        "content": "<p>One cause for unnecessary merge conflicts could be that adaption branches are squash-merged into <code>bump/v4.11.0</code>, so as soon as you merge back into <code>nightly-testing</code> or a new adaption branch, you’ll get unnecessary merge conflicts. Just like with stashed PRs against <code>master</code>.</p>\n<p>This can be mitigated by some additional merges: After <code>bump/nightly-2024-07-22</code> got merged into <code>bump/v4.11.0</code> (squash merge), if one then merges that squash merge commit  back to <code>bump/nightly-2024-07-22</code>, that should go without conflict, but effectively tells git about the relation between the squashed commit and the original branch. Merging that back into <code>nightly-testing</code> should then convey that information, and hopefully avoid merge conflicts. (Assuming I am barking at the right tree.)</p>\n<p>If the bump PRs are applied cleanly (i.e.  <code>bump/nightly-2024-07-22</code> is  up do date with regard to <code>bump/4.11.0</code> and after the merge,  <code>bump/nightly-2024-07-22</code> is identical to the tip of <code>bump/nightly-2024-07-22</code>), then running <code>git post-squash bump/4.11.0</code> (from  <a href=\"https://github.com/nomeata/git-post-squash\">https://github.com/nomeata/git-post-squash</a>) on <code>nightly-testing</code> should achieve the same result.</p>\n<p>Not sure how friction these conflicts cause for you; if they do annoy you I’m happy to help here.</p>",
        "id": 453346986,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721720298
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> It was the first two. The conflict was identical, just that the first time I wanted theirs, and the 2nd time I wanted ours.</p>",
        "id": 453393246,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1721734630
    },
    {
        "content": "<p>In this case the friction was small. But if there are 20 conflicts, and you fix all of them, and then you need to do all of them again... that's quite annoying. And that has happened.</p>",
        "id": 453393457,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1721734714
    },
    {
        "content": "<p>So I would be happy to experiment with ways to reduce the friction.<br>\nI still think <code>rerere</code> might also be a good solution to try out</p>",
        "id": 453393521,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1721734740
    },
    {
        "content": "<p>6 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"428973\" href=\"/#narrow/stream/428973-nightly-testing/topic/.2315046.20adaptations.20for.20nightly-2024-07-22\">#nightly-testing &gt; #15046 adaptations for nightly-2024-07-22</a> by <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>.</p>",
        "id": 453397775,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721736222
    },
    {
        "content": "<p>I’ll have a look when the next one is due.</p>",
        "id": 453398646,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721736536
    },
    {
        "content": "<p>The first step of the script seems to be merging <code>master</code> into <code>bump/v4.11.0</code>. Two questions:</p>\n<ul>\n<li>Here merge conflicts are expected, right? If something changes in master that had to be touched for adaption, this conflict is unavoidable.</li>\n<li>The script pushed to the bump branch; here it fails with <code>GH006: Protected branch update failed for refs/heads/bump/v4.11.0.</code>. Is this a priviledged operation performed by just a few people? Do you manually locally check that your merges still compile?</li>\n</ul>",
        "id": 453403927,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721737981
    },
    {
        "content": "<p>Indeed I do get a second merge conflict when merging <code>origin/nightly-testing</code> into <code>bump/nightly-2024-07-23</code>, but it’s not identical (or identical-but reversed).</p>",
        "id": 453404045,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721738032
    },
    {
        "content": "<p>Hmm, I don’t see anything easy to improve here. The conflicts don't seem to stem from squash-merging into the bump branch.<br>\nMaybe it’s a bit less confusing to create the adaption branch the other way around, so instead of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">bump</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">11</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"bump/nightly-$NIGHTLYDATE\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"n\">testing</span>\n</code></pre></div>\n<p>do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"n\">testing</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"bump/nightly-$NIGHTLYDATE\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"w\"> </span><span class=\"n\">bump</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">11</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n</code></pre></div>\n<p>This might make conflicts a bit easier to recognize.</p>",
        "id": 453405819,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721738623
    },
    {
        "content": "<p>In fact, Is there a good reason to not merge <code>bump/v4.11.0</code> to <code>nightly-testing</code> first, and then create the adaption branch from that, as opposed to merging <code>bump/v4.11.0</code> into the new branch later merging that into <code>nightly-testing</code>?</p>",
        "id": 453406240,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721738728
    },
    {
        "content": "<p>( <span aria-label=\"tree\" class=\"emoji emoji-1f333\" role=\"img\" title=\"tree\">:tree:</span>  <span aria-label=\"juggling\" class=\"emoji emoji-1f939\" role=\"img\" title=\"juggling\">:juggling:</span> )</p>",
        "id": 453406281,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721738746
    },
    {
        "content": "<p>Hmm, maybe one way to avoid this is if instead of having both <code>master → nightly-testing</code> and <code>master → bump/v4.11.0</code> propagation happening in parallel (thus requiring separate merges, and then again a conflict), new commits would go through it linearly:   <code>master → bump/v4.11.0</code> and <code>bump/v4.11.0</code> → <code>nightly-testing</code>.</p>\n<p>What is the quality expectation for <code>bump/v4.11.0</code>? Always green?</p>",
        "id": 453407685,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721739065
    },
    {
        "content": "<p>Yeah</p>",
        "id": 453421736,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721742867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/428973-nightly-testing/topic/merge.20conflicts.20avoidable.3F/near/453403927\">said</a>:</p>\n<blockquote>\n<ul>\n<li>The script pushed to the bump branch; here it fails with <code>GH006: Protected branch update failed for refs/heads/bump/v4.11.0.</code>. Is this a priviledged operation performed by just a few people? Do you manually locally check that your merges still compile?</li>\n</ul>\n</blockquote>\n<p>We don't check this locally. Of course there is a risk that we break something by merging master into <code>bump/v4.11.0</code>. But at least before the merge, both branches ought to pass CI. If we create problems, we currently have to fix them by hand afterwards.</p>",
        "id": 453446838,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1721748740
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/428973-nightly-testing/topic/merge.20conflicts.20avoidable.3F/near/453407685\">said</a>:</p>\n<blockquote>\n<p>Hmm, maybe one way to avoid this is if instead of having both <code>master → nightly-testing</code> and <code>master → bump/v4.11.0</code> propagation happening in parallel (thus requiring separate merges, and then again a conflict), new commits would go through it linearly:   <code>master → bump/v4.11.0</code> and <code>bump/v4.11.0</code> → <code>nightly-testing</code>.</p>\n<p>What is the quality expectation for <code>bump/v4.11.0</code>? Always green?</p>\n</blockquote>\n<p>The current plan is that <code>bump/v4.11.0</code> is green <em>except</em> in the window after a manual merge of <code>master</code> into it (which might break things) and before the next <code>bump/nightly-YYYY-MM-DD</code> is merged into it (which is expected to pass CI).</p>",
        "id": 453599783,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721799103
    },
    {
        "content": "<p>I see. Or put differently, if I may rephrase: it morally jumps from adoption branch merge to adoption branch merge, and the manual merge of master before the adoption branch is mostly for the benefit of keeping the git history complete.</p>",
        "id": 453603138,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721801051
    }
]