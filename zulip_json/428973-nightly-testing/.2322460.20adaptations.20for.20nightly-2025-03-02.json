[
    {
        "content": "<blockquote>\n<p>chore: adaptations for nightly-2025-03-02 <a href=\"https://github.com/leanprover-community/mathlib4/pull/22460\">#22460</a> Please review this PR. At the end of the month this diff will land in 'master'.</p>\n</blockquote>",
        "id": 502848882,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740913782
    },
    {
        "content": "<p>It would be great if the declaration diff tool could tell us when the deleted declarations are upstreamed</p>",
        "id": 502854701,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740917734
    },
    {
        "content": "<p>That's a good idea!  It can probably make an attempt.  Maybe it is time to implement a \"declaration diff with a full build written in Lean\".</p>",
        "id": 502857779,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740919917
    },
    {
        "content": "<p>Right now when I review these things I figure \"well everything must still compile if we're being asked to review, so presumably either this definition which is deleted in the adaptations PR is upstreamed or it's unused\" and sometimes it's manifestly clear that it's not unused.</p>",
        "id": 502859684,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740921211
    },
    {
        "content": "<p>The \"unused\" case is the one I worry about, since in those cases we should deprecate rather than delete</p>",
        "id": 502860203,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740921636
    },
    {
        "content": "<p><code>Mathlib.lean</code> contains <code>import Batteries</code>: is this enough to guarantee that if something is in <code>Batteries</code>, then it will be present in a file with <code>import Mathlib</code>?</p>",
        "id": 502875367,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740932229
    },
    {
        "content": "<p>If this is the case, then a minimal declaration diff can simply store all declarations in \"the last commit from where you branched off <code>master</code>\" and compare this with the declarations at the tip of the PR.</p>",
        "id": 502875497,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740932339
    },
    {
        "content": "<p>Maybe we can have the current text-based report right away and then an extra step after building finished that does the comparison of the declarations in the environments.</p>",
        "id": 502875688,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740932477
    },
    {
        "content": "<p>Besides <code>import Mathlib</code>, this final test should also import <code>Archive</code> and <code>Counterexamples</code>, I guess.</p>",
        "id": 502875818,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740932558
    },
    {
        "content": "<p>Looking at doc-strings it does seem that <code>Batteries.lean</code> contains all files in <code>Batteries</code>, so the script could compare the declarations contained in a file that starts with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Archive</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Counterexamples</span>\n</code></pre></div>\n<p>on \"<code>master</code>\" and on the PR branch.</p>",
        "id": 502877822,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740933910
    }
]