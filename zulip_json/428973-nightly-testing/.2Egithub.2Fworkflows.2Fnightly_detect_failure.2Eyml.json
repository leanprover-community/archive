[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/428973-nightly-testing/topic/Mathlib.20bump.20branch.20reminders/near/482296085\">said</a>:</p>\n<blockquote>\n<p>Oops: <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>, why is this script telling us to PR to <code>bump/v4.14.0</code>. It should be <code>v4.15.0</code> by now!!</p>\n</blockquote>\n<p>The following bit of the workflow is responsible for determining the branch</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Fetch latest bump branch name</span>\n<span class=\"w\">      </span><span class=\"nt\">id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">latest_bump_branch</span>\n<span class=\"w\">      </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">actions/github-script@v7</span>\n<span class=\"w\">      </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">        </span><span class=\"nt\">script</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span>\n<span class=\"w\">          </span><span class=\"no\">const branches = await github.paginate(github.rest.repos.listBranches, {</span>\n<span class=\"w\">            </span><span class=\"no\">owner: context.repo.owner,</span>\n<span class=\"w\">            </span><span class=\"no\">repo: context.repo.repo</span>\n<span class=\"w\">          </span><span class=\"no\">});</span>\n<span class=\"w\">          </span><span class=\"no\">const bumpBranches = branches</span>\n<span class=\"w\">            </span><span class=\"no\">.map(branch =&gt; branch.name)</span>\n<span class=\"w\">            </span><span class=\"no\">.filter(name =&gt; name.match(/^bump\\/v4\\.\\d+\\.0$/))</span>\n<span class=\"w\">            </span><span class=\"no\">.sort((a, b) =&gt; b.localeCompare(a, undefined, {numeric: true, sensitivity: 'base'}));</span>\n<span class=\"w\">          </span><span class=\"no\">if (!bumpBranches.length) {</span>\n<span class=\"w\">            </span><span class=\"no\">throw new Exception(\"Did not find any bump/v4.x.0 branch\")</span>\n<span class=\"w\">          </span><span class=\"no\">}</span>\n<span class=\"w\">          </span><span class=\"no\">const latestBranch = bumpBranches[0];</span>\n<span class=\"w\">          </span><span class=\"no\">return latestBranch;</span>\n</code></pre></div>",
        "id": 482309983,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731560101
    },
    {
        "content": "<p>As far as I can tell <code>v.4.15.0</code> doesn't exist. So it will not find it.</p>",
        "id": 482310000,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731560116
    },
    {
        "content": "<p>Who/what is responsible for creating the new branch? Should that happen automatically? Or is it part of the \"cut the release\" job?</p>",
        "id": 482310040,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731560147
    },
    {
        "content": "<p>Btw, note that on linux <code>sort</code> comes with a flag</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>       -V, --version-sort\n              natural sort of (version) numbers within text\n</code></pre></div>\n<p>which would also work for bump branches of the form <code>v4.x.1</code>.</p>",
        "id": 482310160,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731560227
    },
    {
        "content": "<p>Indeed! I'll create it now.</p>",
        "id": 482310969,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731560813
    }
]