[
    {
        "content": "<p>Usually I’d prepare an adaption branch for you, but since that’s not possible for now, I’ll just leave notes here.</p>\n<p>That linter likely lands in the June 23 nightly, and I expect a large number of warnings  in mathlib. I suggest to simply disable the linter in the adaption branch, wait for this feature to enter a RC and thus mathlib <code>master</code>, and then look at fixing it there – fixing it in <code>nightly-testing</code> might be a headache with lots of merge conflicts.</p>\n<p>I have a crude script that I used to update <code>Std</code> and <code>Init</code>, I can then look into using it on mathlib.</p>\n<p>(Assuming mathlib wants that linter to be on, of course.)</p>",
        "id": 525202610,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750582894
    },
    {
        "content": "<p>Alternatively, we can land all the changes to fix warnings in master immediately</p>",
        "id": 525208752,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750592493
    },
    {
        "content": "<p>But for that we’d have to run the linter on the code in master. Or run it on the code in nightly-testing and hope that it hasn’t diverged too much so that we can rebase that fix onto master without lots of conflicts (I assume that’s what you mean?). But there is no rush, so easier to just do it separately of nightly adoption, I’d say.</p>",
        "id": 525212482,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750597816
    },
    {
        "content": "<p>Let's say the linter flags 1000 unused arguments on nightly-testing. My assumption is that the changes for at least 990 of those apply without issue on master, and that landing the fixes sooner than later has a slightly positive impact overall (mostly for general tidiness, but also because unused <code>simp</code> arguments can add a bit of annoyance with <code>#min_imports</code>). But whoever does the work gets the biggest say on how to do it</p>",
        "id": 525213786,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750599498
    },
    {
        "content": "<p>It flagged 1000 in Std and Init alone, so I’ll be curious how many we’ll get in mathlib :-)</p>",
        "id": 525213863,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750599617
    },
    {
        "content": "<p>Okay, add another zero :)</p>",
        "id": 525213875,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750599629
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">1000</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"mi\">1000</span>\n</code></pre></div>",
        "id": 525213885,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750599639
    },
    {
        "content": "<p>Technically correct is the best kind of correct</p>",
        "id": 525213895,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750599653
    },
    {
        "content": "<p>I’m just an LLM, in a way</p>",
        "id": 525213898,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750599655
    },
    {
        "content": "<p>I think in any case I'd lean towards not landing 10000 (or however many) changes in one commit, too easy to mess up rebasing somewhere</p>",
        "id": 525213967,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750599728
    },
    {
        "content": "<p>And definitely looking forward to seeing this in action!</p>",
        "id": 525213982,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750599746
    },
    {
        "content": "<p>That linter looks amazing, and will definitely help diagnosing bumps to large repos downstream of mathlib, like FLT or Toric</p>",
        "id": 525214433,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1750600286
    },
    {
        "content": "<p>Glad to hear that, and I hope it’ll hold water, I didn’t test it against mathlib yet (despite my usual habits)</p>",
        "id": 525217941,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750604760
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> just flagging an <em>error</em> (rather than a linter warning) from <code>unusedSimpArgs</code>, which occurs in MathlibTest/nontriviality.lean</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">unusedSimpArgs</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Index</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">nontriviality</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"kn\">using</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_lt_one</span>\n</code></pre></div>\n<p>I've since turned off the linter in MathlibTest too, but this will require an upstream fix at some point.</p>",
        "id": 525425716,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1750725736
    },
    {
        "content": "<p>The issue is that <code>nontriviality</code> is an elab (not a macro) that calls <code>simp</code> with one of its arguments, and this code</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mask</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ci</span><span class=\"bp\">.</span><span class=\"n\">value</span><span class=\"bp\">.</span><span class=\"n\">get?</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">UnusedSimpArgsInfo</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"c1\">-- Only look at info with a range. This also happens to prevent the linter from</span>\n<span class=\"w\">            </span><span class=\"c1\">-- reporting about unused simp arguments inside macro, which we do not want to do</span>\n<span class=\"w\">            </span><span class=\"c1\">-- (we likely cannot see all uses of the macro, so the warning would be incomplete)</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"bp\">.</span><span class=\"n\">range?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span>\n</code></pre></div>\n<p>is not good enough to actually screen out non-<code>simp</code> macros that are manipulating positions explicitly for better error reporting.</p>",
        "id": 525427026,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750727058
    },
    {
        "content": "<p>I think you should just check that the head of the syntax is something you recognize</p>",
        "id": 525427189,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750727194
    },
    {
        "content": "<p>Thanks for catching this! Marc warned that there could be issues around macros, but my testing wasn't creative enough. I'll try to fix it before the RC</p>\n<p>Issue at <a href=\"https://github.com/leanprover/lean4/issues/8969\">https://github.com/leanprover/lean4/issues/8969</a><br>\nPR at <a href=\"https://github.com/leanprover/lean4/pull/8971\">https://github.com/leanprover/lean4/pull/8971</a></p>",
        "id": 525453024,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750748531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/428973-nightly-testing/topic/.60linter.2EunusedSimpArgs.60.20.28lean4.238901.29/near/525213786\">schrieb</a>:</p>\n<blockquote>\n<p>Let's say the linter flags 1000 unused arguments on nightly-testing. My assumption is that the changes for at least 990 of those apply without issue on master, and that landing the fixes sooner than later has a slightly positive impact overall (mostly for general tidiness, but also because unused <code>simp</code> arguments can add a bit of annoyance with <code>#min_imports</code>). But whoever does the work gets the biggest say on how to do it</p>\n</blockquote>\n<p>I gave this a shot, 5000 changes – so who wants to review that PR :-D</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26430\">https://github.com/leanprover-community/mathlib4/pull/26430</a></p>",
        "id": 525866139,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750931403
    },
    {
        "content": "<p>Please fix the 19 lines with trailing whitespace :)</p>",
        "id": 525866830,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750931655
    },
    {
        "content": "<p>(done, I think)</p>",
        "id": 525866848,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750931664
    },
    {
        "content": "<p>Reviewed as much as I'll have time for, but looking great so far!</p>",
        "id": 525872755,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750933777
    }
]