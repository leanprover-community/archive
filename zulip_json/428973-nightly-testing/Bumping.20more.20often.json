[
    {
        "content": "<p>Could we increase the frequency of the workflow<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/actions/workflows/nightly_bump_toolchain.yml\">https://github.com/leanprover-community/mathlib4/actions/workflows/nightly_bump_toolchain.yml</a><br>\nand/or allow manual trigger?<br>\nSometimes it misses the nightly release and we have to wait for a day.</p>",
        "id": 453976634,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721920819
    },
    {
        "content": "<p>Alternatively we can make that push-based, and add to <a href=\"https://github.com/leanprover/lean4/blob/master/.github/workflows/ci.yml\">https://github.com/leanprover/lean4/blob/master/.github/workflows/ci.yml</a> after</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Update</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">lang</span><span class=\"bp\">.</span><span class=\"n\">org</span>\n<span class=\"w\">        </span><span class=\"n\">run</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span>\n<span class=\"w\">          </span><span class=\"n\">gh</span><span class=\"w\"> </span><span class=\"n\">workflow</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">-</span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"bp\">-</span><span class=\"n\">index</span><span class=\"bp\">.</span><span class=\"n\">yml</span>\n<span class=\"w\">        </span><span class=\"n\">env</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">GITHUB_TOKEN</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{{</span><span class=\"w\"> </span><span class=\"n\">secrets</span><span class=\"bp\">.</span><span class=\"n\">RELEASE_INDEX_TOKEN</span><span class=\"w\"> </span><span class=\"o\">}}</span>\n</code></pre></div>\n<p>a similar section that triggers the <code>nightly_bump_toolchain.yml</code> workflow. Would <code>secrets.MATHLIB4_BOT</code> have the permissions for that (once we add <code>workflow_dispatch</code> to the job?)</p>",
        "id": 453977790,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721921052
    },
    {
        "content": "<p>Let's do both, this workflow is cheap and idempotent.</p>",
        "id": 454060381,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721944606
    },
    {
        "content": "<p>Indeed, that secret should be sufficient.</p>",
        "id": 454060407,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721944619
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15142\">#15142</a>: run every 3 hours (and don't fail if there's nothing to commit)</p>",
        "id": 454061169,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721944994
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15143\">#15143</a>: enable workflow dispatch</p>",
        "id": 454061187,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721945004
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>, I'll leave it to you to do the push side once that is merged?</p>",
        "id": 454061215,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721945025
    },
    {
        "content": "<p>Will have a look after breakfast, hopefully in time before the nightly.</p>\n<p>I'm of a mind of simply creating the commit directly after the release, instead of going through that extra workflow, using the GitHub API to avoid checking mathlib out:<br>\n<a href=\"https://stackoverflow.com/a/71130304\">https://stackoverflow.com/a/71130304</a><br>\nSeems simpler. WDYT?</p>",
        "id": 454172316,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721972681
    },
    {
        "content": "<p>OTOH, why bother when the workflow is already written and works. <a href=\"https://github.com/leanprover/lean4/pull/4838\">https://github.com/leanprover/lean4/pull/4838</a>.</p>",
        "id": 454172490,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721972779
    },
    {
        "content": "<p>Works:<br>\n<a href=\"/user_uploads/3121/hq4ZZ0xWvoN_o1jYpvpyXMmf/foo.png\">foo.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/hq4ZZ0xWvoN_o1jYpvpyXMmf/foo.png\" title=\"foo.png\"><img data-original-dimensions=\"1328x256\" src=\"/user_uploads/thumbnail/3121/hq4ZZ0xWvoN_o1jYpvpyXMmf/foo.png/840x560.webp\"></a></div>",
        "id": 454245632,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1721982959
    }
]