[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"128280\">@Wojciech Nawrocki</span> I'm having trouble bumping ProofWidgets to <code>v4.11.0-rc1</code> (and I think this will block me bumping Mathlib, as I don't dare have inconsistent Batteries imports...)</p>\n<p>Could you (or anyone else who know more about <code>npm</code>!) please take a look at <a href=\"https://github.com/leanprover-community/ProofWidgets4/pull/73\">https://github.com/leanprover-community/ProofWidgets4/pull/73</a>?</p>",
        "id": 456423042,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722825363
    },
    {
        "content": "<p>I think this issue is relevant <a href=\"https://github.com/nodejs/node/issues/52682\">https://github.com/nodejs/node/issues/52682</a></p>",
        "id": 456425899,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722826695
    },
    {
        "content": "<p>So I think adding a step to the workflow of <code>npm i -g npm</code> prior to the lake build step should work...?</p>",
        "id": 456426574,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722826882
    },
    {
        "content": "<p>Let's try it! (But how can we run <code>npm i</code> if <code>npm</code> isn't working?)</p>",
        "id": 456427516,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1722827173
    },
    {
        "content": "<p>npm is working, that's the utility giving the error messages. But the build is looking for npm source js inside the widgets subfolder</p>",
        "id": 456427681,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722827306
    },
    {
        "content": "<p>Which I'm not sure why it'd be looking there to begin with. Perhaps if the global install doesn't fix it, then <code>npm install npm</code> might. <code>npm install</code> places the source code in the node_modules folder, which is what the build error is complaining about being missing.</p>",
        "id": 456427837,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722827403
    },
    {
        "content": "<p>I see, I think the error occurs during this line, right? <a href=\"https://github.com/leanprover-community/ProofWidgets4/blob/main/lakefile.lean#L99\">https://github.com/leanprover-community/ProofWidgets4/blob/main/lakefile.lean#L99</a></p>",
        "id": 456428090,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722827588
    },
    {
        "content": "<p>Attempting to install it globally failed with missing permissions, so I tried your local install suggestion. That seems to have worked. We should remove it when MSYS2 NPM is more recent and no longer has the issue.</p>",
        "id": 456429691,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1722828269
    },
    {
        "content": "<p>I was a little worried that this step modifies <code>package-lock.json</code> which is then no longer considered up-to-date by Lake. Luckily we upload release archives from Ubuntu, and the <code>npm install npm</code> only runs on Windows. The whole setup is quite brittle.</p>",
        "id": 456429868,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1722828365
    },
    {
        "content": "<p>npm install --no-save won't modify the lockfile</p>",
        "id": 456430056,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722828495
    }
]