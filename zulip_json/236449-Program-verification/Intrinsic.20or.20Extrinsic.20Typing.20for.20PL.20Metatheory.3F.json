[
    {
        "content": "<p>Iâ€™m wondering if there is prevailing wisdom as to whether or not one should represent typed terms in Lean4 intrinsically (terms are well-typed by construction) or extrinsically?</p>\n<p>The prevailing wisdom is to use extrinsic typing in Roq (Coq) and intrinsic typing in Agda. As far as I know, the preference comes down to the ergonomics of performing dependent pattern matching.</p>\n<p>Thoughts?</p>",
        "id": 472052866,
        "sender_full_name": "Ian Sweet",
        "timestamp": 1727017373
    },
    {
        "content": "<p>The prevailing wisdom which I tend to dispense is in favor of extrinsic typing, although you can get away with intrinsic typing for sufficiently simple type systems</p>",
        "id": 472065599,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727025762
    },
    {
        "content": "<p>IME extrinsic typing scales better to the complicated cases</p>",
        "id": 472065626,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727025786
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/Intrinsic.20or.20Extrinsic.20Typing.20for.20PL.20Metatheory.3F/near/472065599\">said</a>:</p>\n<blockquote>\n<p>The prevailing wisdom which I tend to dispense is in favor of extrinsic typing, although you can get away with intrinsic typing for sufficiently simple type systems</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> Do you have examples you could share, especially of anything with some form of dependent types?</p>",
        "id": 472066999,
        "sender_full_name": "Chris Henson",
        "timestamp": 1727026934
    },
    {
        "content": "<p>Lean4lean is maybe a bit of an extreme example, but I think it is basically impossible to represent <a href=\"https://github.com/digama0/lean4lean/blob/cpp2025/Lean4Lean/Theory/Typing/Basic.lean#L17-L55\">this typing judgment</a> in intrinsic typing style</p>",
        "id": 472067058,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727027013
    },
    {
        "content": "<p>with dependent types you have computation inside the indices of the inductive type, I can't imagine this working out unless you have induction-recursion</p>",
        "id": 472067178,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727027099
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> , that matches my intuition as well. I appreciate the response!</p>",
        "id": 472198014,
        "sender_full_name": "Ian Sweet",
        "timestamp": 1727089832
    },
    {
        "content": "<p>Extrinsic typing is also the way to go if you care about performance, unless you have very simple types; otherwise you will duplicate the type parameters at every node of the AST and end up with ~quadratic or worse performance in the size of your types.</p>",
        "id": 472502657,
        "sender_full_name": "Jason Gross",
        "timestamp": 1727186584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"241007\">Jason Gross</span> <a href=\"#narrow/stream/236449-Program-verification/topic/Intrinsic.20or.20Extrinsic.20Typing.20for.20PL.20Metatheory.3F/near/472502657\">said</a>:</p>\n<blockquote>\n<p>Extrinsic typing is also the way to go if you care about performance, unless you have very simple types; otherwise you will duplicate the type parameters at every node of the AST and end up with ~quadratic or worse performance in the size of your types.</p>\n</blockquote>\n<p>This is something you can work around by playing tricks like <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Erased.html#Erased\"><code>Erased</code></a> to ensure the type parameters are erased at runtime, at the cost of even more complexity.</p>",
        "id": 476259814,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1728611102
    },
    {
        "content": "<p>I am assuming the bad complexity is in kernel-typechecking the term rather than in evaluating any code, in which case <code>Erased</code> wouldn't help, no?</p>",
        "id": 476269078,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1728613745
    }
]