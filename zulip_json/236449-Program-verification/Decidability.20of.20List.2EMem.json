[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Mem</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I get two different results for the two. First <code>true</code>, second <code>failed to synthesize Decidable (List.Mem 2 [1, 2]) Additional diagnostic information may be available using the </code>set_option diagnostics true<code> command.</code> . Why do I get two different results? Afaiu the definition at <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/List/Basic.html#List.Mem\">https://leanprover-community.github.io/mathlib4_docs/Init/Data/List/Basic.html#List.Mem</a> they should be the same ...</p>",
        "id": 474998897,
        "sender_full_name": "Alexander Kurz",
        "timestamp": 1728148769
    },
    {
        "content": "<p>This one is tricky... The notation expands to <code>Membership.mem</code> and <code>Membership</code> is a class which has an instance for List and that is in turn implemented by <code>List.Mem</code>. The decidable instance (also a class) is implemented for the constant <code>Membership.mem</code> but not for the more specific constant <code>List.mem</code>.</p>",
        "id": 475002828,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728151493
    },
    {
        "content": "<p>Class synthesis only see through <em>reducible</em> definitions, so it never gets past the semireducible <code>Membership.mem</code> to its implementation.</p>",
        "id": 475003017,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728151575
    },
    {
        "content": "<p>Without this, tabular resolution used by Lean for class synthesis would hardly be possible.</p>",
        "id": 475003154,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728151659
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"119741\">@François G. Dorais</span> Wow, thanks! I think that is too complicated for what I want to do ... maybe best to define my own member function. I need to understand exactly how member works as I need to expand the definition of member in my proof that insertion sort sorts.</p>",
        "id": 475007083,
        "sender_full_name": "Alexander Kurz",
        "timestamp": 1728153893
    },
    {
        "content": "<p>There should be an instance of Decidable for <code>List.Mem</code></p>",
        "id": 475007747,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728154219
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"220015\">Alexander Kurz</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007083\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> Wow, thanks! I think that is too complicated for what I want to do ... maybe best to define my own member function. I need to understand exactly how member works as I need to expand the definition of member in my proof that insertion sort sorts.</p>\n</blockquote>\n<p>That was a lot to digest all at once! If you provide more detailed code snippets (see <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>) then it's much easier to provide more specialized technical support.</p>",
        "id": 475011965,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728156262
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007747\">said</a>:</p>\n<blockquote>\n<p>There should be an instance of Decidable for <code>List.Mem</code></p>\n</blockquote>\n<p>How do you prevent diamonds doing this? I always find this very difficult.</p>",
        "id": 475012931,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728156766
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007747\">said</a>:</p>\n<blockquote>\n<p>There should be an instance of Decidable for <code>List.Mem</code></p>\n</blockquote>\n<p>Should there really be instances for every implementation detail?</p>",
        "id": 475013567,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728157136
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"220015\">Alexander Kurz</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007083\">said</a>:</p>\n<blockquote>\n<p>@François G. Dorais Wow, thanks! I think that is too complicated for what I want to do ... maybe best to define my own member function. I need to understand exactly how member works as I need to expand the definition of member in my proof that insertion sort sorts.</p>\n</blockquote>\n<p>In this kind of scenario, I often write a lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mem_def</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">should</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>If I'm confident about my definition, I just leave <code>sorry</code> for the proof until I have time to come back to it.</p>\n<p>When working on a theorem involving <code>x ∈ y</code>, I rewrite it using <code>rw [mem_def]</code> or even <code>simp [mem_def]</code> so I can work with the intended meaning more directly.</p>",
        "id": 475016509,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728158021
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475013567\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007747\">said</a>:</p>\n<blockquote>\n<p>There should be an instance of Decidable for <code>List.Mem</code></p>\n</blockquote>\n<p>Should there really be instances for every implementation detail?</p>\n</blockquote>\n<p>I think there should be instances for all <code>Prop</code> producing functions where applicable, in addition to having instances for all the notation wrappers we put over these. It's not that much work to maintain both</p>",
        "id": 475017372,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728158448
    },
    {
        "content": "<p><code>List.Mem</code> is not even a private function, and when you pattern match on it you see the constructors directly. I don't see any argument that this type should be hidden from users and never touched directly</p>",
        "id": 475017416,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728158468
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475012931\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475007747\">said</a>:</p>\n<blockquote>\n<p>There should be an instance of Decidable for <code>List.Mem</code></p>\n</blockquote>\n<p>How do you prevent diamonds doing this? I always find this very difficult.</p>\n</blockquote>\n<p>In this case the instances will be defeq so it will not cause any problem</p>",
        "id": 475017652,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728158582
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475017372\">said</a>:</p>\n<blockquote>\n<p>I think there should be instances for all <code>Prop</code> producing functions where applicable, in addition to having instances for all the notation wrappers we put over these. It's not that much work to maintain both</p>\n</blockquote>\n<p>In mathlib this could manifest as <code>Decidable (x ∈ S)</code> vs <code>Decidable (x ∈ S.carrier)</code> vs <code>Decidable (x ∈ Setlike.coe S)</code> for <code>S : Submonoid M</code>, which I don't think is a path we want to have to maintain.</p>",
        "id": 475020869,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728160511
    },
    {
        "content": "<p>I agree that <code>List.Mem</code> is more user-visible, though arguably pattern matching should resolve to the nice notation too, like it does for Nat.succ.</p>",
        "id": 475020919,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728160562
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475020869\">said</a>:</p>\n<blockquote>\n<p>In mathlib this could manifest as <code>Decidable (x ∈ S)</code> vs <code>Decidable (x ∈ S.carrier)</code> vs <code>Decidable (x ∈ Setlike.coe S)</code> for <code>S : Submonoid M</code>, which I don't think is a path we want to have to maintain.</p>\n</blockquote>\n<p>Since this is in the Program Verification channel, let me point out that these \"Mathlib problems\" are not that relevant in this channel. In fact, once this channel gets more traction, I suspect  \"working around Mathlib problems\" will become a more common topic.</p>",
        "id": 475022517,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728162016
    },
    {
        "content": "<p>Can we move the last few messages elsewhere? They're really not helpful to the main topic.</p>",
        "id": 475022716,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728162196
    },
    {
        "content": "<p>I was using mathlib as an example here, the issue manifests anywhere where there is more than one way to spell the argument to <code>Decidable</code> so isn't really about mathlib</p>",
        "id": 475025525,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728164976
    },
    {
        "content": "<p>I'm very sorry my comment came out as dismissive, that was not my intent. I just wanted to keep the discussion on topic.</p>",
        "id": 475057755,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728192712
    },
    {
        "content": "<p>I'm not really sure what topic you have in mind, unless you're suggesting splitting the thread between autoImplicit / Decidable.</p>",
        "id": 475064613,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728196522
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475020869\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil/near/475017372\">said</a>:</p>\n<blockquote>\n<p>I think there should be instances for all <code>Prop</code> producing functions where applicable, in addition to having instances for all the notation wrappers we put over these. It's not that much work to maintain both</p>\n</blockquote>\n<p>In mathlib this could manifest as <code>Decidable (x ∈ S)</code> vs <code>Decidable (x ∈ S.carrier)</code> vs <code>Decidable (x ∈ Setlike.coe S)</code> for <code>S : Submonoid M</code>, which I don't think is a path we want to have to maintain.</p>\n</blockquote>\n<p>No, I think we should actually have all those instances. Many of them are implied by others so it's not like you will actually have a combinatorial explosion here, it's basically one per function</p>",
        "id": 475066428,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728198039
    },
    {
        "content": "<p>Sorry I wasn't clear. The topic of this thread is helping Alexander Kurz. Our digression, while interesting, is not directly helpful for that.</p>",
        "id": 475066470,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728198057
    },
    {
        "content": "<p>22 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"236449\" href=\"/#narrow/stream/236449-Program-verification/topic/.5Bx.2Cy.5D.20vs.20x.3A.3Ay.3A.3Anil\">#Program verification &gt; [x,y] vs x::y::nil</a> by <span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span>.</p>",
        "id": 475066617,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728198116
    },
    {
        "content": "<p>Thanks Mario!</p>",
        "id": 475067134,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1728198291
    }
]