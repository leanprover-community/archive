[
    {
        "content": "<p>Hi, I'm studying Lean in the context of using it for program verification and developing mission-critical software using it. I'm curious what guarantees Lean provides about itself as a foundation, sure Lean checks my theorems and assertions but who is checking that Lean itself is checking things correctly?</p>\n<p>I assume there must some ground level/kernel that must be assumed/audited to work correctly and everything is built ontop of that but what is that and where can I learn more about it?</p>\n<p>Thanks!</p>",
        "id": 461982244,
        "sender_full_name": "Philogy",
        "timestamp": 1723508774
    },
    {
        "content": "<p>For some info on the kernel, you might start with this repo/book: <a href=\"https://github.com/ammkrn/type_checking_in_lean4\">https://github.com/ammkrn/type_checking_in_lean4</a></p>",
        "id": 461986088,
        "sender_full_name": "Chris Henson",
        "timestamp": 1723510486
    },
    {
        "content": "<p>For one there is a theoretical soundness argument for Lean 3's logic in <a href=\"https://github.com/digama0/lean-type-theory/releases/tag/v1.0\">#leantt</a>. Sebastian Ulrich's PhD thesis sketches how this work would change for Lean 4 (not a lot at all).</p>\n<p>The kernel itself is a couple of thousand lines of C++  code. However it may be exchanged for other kernels so you can check your proofs with a multitude of checkers to see if they all agree.</p>",
        "id": 462031515,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1723530575
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"687698\">Chris Henson</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/461986088\">said</a>:</p>\n<blockquote>\n<p>For some info on the kernel, you might start with this repo/book: <a href=\"https://github.com/ammkrn/type_checking_in_lean4\">https://github.com/ammkrn/type_checking_in_lean4</a></p>\n</blockquote>\n<p>Thanks will look into this!</p>",
        "id": 462065621,
        "sender_full_name": "Philogy",
        "timestamp": 1723542101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/462031515\">said</a>:</p>\n<blockquote>\n<p>The kernel itself is a couple of thousand lines of C++ code. However it may be exchanged for other kernels so you can check your proofs with a multitude of checkers to see if they all agree.</p>\n</blockquote>\n<p>Interesting, that seems quite small, good to know!</p>\n<p>When you use Lean4 as an interactive theorem prover, interpreter or compiler do they all rely on the same kernel?</p>\n<p>Also is the kernel actively part of Lean or is it simply the basis upon which Lean is bootstrapped before eventually fully being implemented in itself?</p>",
        "id": 462066007,
        "sender_full_name": "Philogy",
        "timestamp": 1723542220
    },
    {
        "content": "<p>The kernel is not a compiler. It is a typechecker. The way lean works is that type checking is outsourced to the kernel. The kernel has a somewhat minimal language. The rest of lean's proof infrastructure takes lean code that you see in a text editor and compiles it down to the kernel's langauge and asks whether that code + environment typechecks.</p>",
        "id": 462066892,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723542531
    },
    {
        "content": "<p>You can mark somethings <code>unsafe</code> or <code>partial</code>if you don't want to prove that they are terminating and so on. Then these definitions cannot be used in terms which are checked by the kernel. It is a different matter that they can be compiled  down to C and run. Sometimes you want to have the latitude to write unsafe procedures to produce proof terms for example.</p>",
        "id": 462067255,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723542647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/462031515\">said</a>:</p>\n<blockquote>\n<p>For one there is a theoretical soundness argument for Lean 3's logic in #dtt. </p>\n</blockquote>\n<p>You meant to link <a href=\"https://github.com/digama0/lean-type-theory/releases/tag/v1.0\">#leantt</a></p>",
        "id": 462200206,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723578418
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/462066892\">said</a>:</p>\n<blockquote>\n<p>The way lean works is that type checking is outsourced to the kernel.</p>\n</blockquote>\n<p>It's not really <em>outsourced</em> to the kernel, because the elaborator also has a typechecker, essentially independent of the kernel typechecker. But the kernel typechecker is a kind of backup plan in case there is a bug in the (much bigger and more likely to have bugs) elaborator, and it means that you don't have to trust the elaborator to believe the results.</p>",
        "id": 462200647,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723578605
    },
    {
        "content": "<p>But I think the most relevant link for \"is lean4 itself verified\" is <a href=\"https://github.com/digama0/lean4lean\">https://github.com/digama0/lean4lean</a> (+<a href=\"https://arxiv.org/abs/2403.14064\">paper</a>), which is a project to verify the correctness of a lean 4 kernel implementation and formally prove the theorems from <a href=\"https://github.com/digama0/lean-type-theory/releases/tag/v1.0\">#leantt</a></p>",
        "id": 462200885,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1723578704
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739332\">Philogy</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/461982244\">said</a>:</p>\n<blockquote>\n<p>Hi, I'm studying Lean in the context of using it for program verification and developing mission-critical software using it.</p>\n</blockquote>\n<p>I don't see this mentioned yet, so: if your goal is to actualy compile Lean code to mission-critical software, the <em>compiler</em> in Lean is <em>not</em> verified.</p>",
        "id": 462215520,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723584648
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/236449-Program-verification/topic/To.20what.20extent.20is.20Lean4.20itself.20verified.3F/near/462067255\">said</a>:</p>\n<blockquote>\n<p>You can mark somethings <code>unsafe</code> or <code>partial</code>if you don't want to prove that they are terminating and so on. Then these definitions cannot be used in terms which are checked by the kernel.</p>\n</blockquote>\n<p>Actually, partial defs are completely edible by the kernel. However, you can't prove anything useful about these functions. As far as the kernel is concerned, these functions simply return a completely arbitrary and unspecified value of the given type. This is sound for type checking since it is required that the type is inhabited.</p>",
        "id": 462227644,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1723591357
    },
    {
        "content": "<p>I mean \"outsourced\" in the sense that one doesn't trust the elaborator as much as the kernel.</p>",
        "id": 462290987,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723623780
    },
    {
        "content": "<p>and of course the environment needs to be checked in the end.</p>",
        "id": 462291088,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1723623826
    }
]