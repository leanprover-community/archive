[
    {
        "content": "<p>Hi! I am writing a program logic that defines small-step semantics as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Trace</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">small_step</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">...</span>\n</code></pre></div>\n<p>I define a reflexive transitive closure over the small step like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">rtc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">rtc</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">rtc</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">rtc</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">z</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">small_step_rtc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rtc</span><span class=\"w\"> </span><span class=\"n\">small_step</span>\n</code></pre></div>\n<p>Now, I have a hypothesis of the form:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⇝*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ'</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>where ⇝* is the small-step reflexive transitive closure. But when I try to perform an induction on this hypothesis, I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Index</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">target's</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">consider</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`cases</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">instead</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is there any way to do this induction without this error? I have tried generalizing and rewriting away my triples, but this is an enormous hassle. Given that I will have to do many inductions of this form, it seems insane to me that I will have to use a workaround for a very simple use-case</p>",
        "id": 529281681,
        "sender_full_name": "Andrew",
        "timestamp": 1752759553
    },
    {
        "content": "<p>There is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen#doc\">docs#Relation.ReflTransGen</a> in mathlib, coming with several useful lemmas and induction principles like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen.head_induction_on#doc\">docs#Relation.ReflTransGen.head_induction_on</a> that you can use with <code>induction some_rtc_hyp using Relation.ReflTransGen.head_induction_on</code>. Maybe use that or have a look how those are proven? (And in my own project here in <a href=\"https://m4lvin.github.io/lean4-pdl/docs/Pdl/Star.html\">Pdl.Star</a> are some more lemmas about it.)</p>\n<p>An <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> in one code block that workds in the live-lean browser thingy would be good to help you better.</p>",
        "id": 529282582,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1752759808
    },
    {
        "content": "<p>Unfortunately the ReflTransGen is in the wrong order (I'm looking for R a b -&gt; RTC R b c -&gt; R a c whereas ReflTransGen does RTC R a b -&gt; R b c -&gt; RTC R a c)</p>",
        "id": 529284103,
        "sender_full_name": "Andrew",
        "timestamp": 1752760249
    },
    {
        "content": "<p>I'm currently loking over how to use head_induction_on</p>",
        "id": 529284312,
        "sender_full_name": "Andrew",
        "timestamp": 1752760308
    },
    {
        "content": "<p>This is the <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> if you'd care to have a look. It seems to be a known limitation of lean that you can't do induction on tuples <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMB0AZCAc2AGMcAlAU3RWAgDsAoRgE0oDM4BnAVxDgBccAHIo4AdZFiAtAD4pMRgB84ACiQAaOFgCUcALzykcANTbm6SiBDH2ECIO581m7Xv1P+qrFqR65cABiSOhclIIeWACejHBwwPQwUBBccKix8fQsPCQwdPRpcISU9JRQIcAAXgmEcMZYGVzQUFFAA\">https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMB0AZCAc2AGMcAlAU3RWAgDsAoRgE0oDM4BnAVxDgBccAHIo4AdZFiAtAD4pMRgB84ACiQAaOFgCUcALzykcANTbm6SiBDH2ECIO581m7Xv1P+qrFqR65cABiSOhclIIeWACejHBwwPQwUBBccKix8fQsPCQwdPRpcISU9JRQIcAAXgmEcMZYGVzQUFFAA</a></p>",
        "id": 529284560,
        "sender_full_name": "Andrew",
        "timestamp": 1752760385
    },
    {
        "content": "<p>What would the induction proof here be in English? Why do you want induction in the first place? The <code>sum</code> type here is not inductive, i.e. it does not have values that contain values of the <code>sum</code> type itself, right?</p>",
        "id": 529285264,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1752760584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"938806\">Andrew</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529284103\">said</a>:</p>\n<blockquote>\n<p>Unfortunately the ReflTransGen is in the wrong order (I'm looking for R a b -&gt; RTC R b c -&gt; R a c whereas ReflTransGen does RTC R a b -&gt; R b c -&gt; RTC R a c)</p>\n</blockquote>\n<p>that's a theorem</p>",
        "id": 529285320,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760596
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"938806\">Andrew</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529284560\">said</a>:</p>\n<blockquote>\n<p>It seems to be a known limitation of lean that you can't do induction on tuples</p>\n</blockquote>\n<p>this feels false</p>",
        "id": 529285447,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760629
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"422703\">Malvin Gattinger</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529285264\">said</a>:</p>\n<blockquote>\n<p>What would the induction proof here be in English? Why do you want induction in the first place? The <code>sum</code> type here is not inductive, i.e. it does not have values that contain values of the <code>sum</code> type itself, right?</p>\n</blockquote>\n<p>This example doesn't have anything to do with what I'm actually doing, it just surfaces the error I'm running into</p>",
        "id": 529285463,
        "sender_full_name": "Andrew",
        "timestamp": 1752760634
    },
    {
        "content": "<p>Can you give us a more realistic example then? The lemma here seems false because <code>sum (1,2) = sum (2,1)</code> right? And have you tried using <code>cases</code> instead?</p>",
        "id": 529285815,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1752760716
    },
    {
        "content": "<p>I can't use cases, because in this example I need the inductive hypothesis</p>",
        "id": 529285927,
        "sender_full_name": "Andrew",
        "timestamp": 1752760744
    },
    {
        "content": "<p>It genuinely doesn't matter what I'm doing, i just need to be able to do an induction in which the hypothesis contains a tuple</p>",
        "id": 529286086,
        "sender_full_name": "Andrew",
        "timestamp": 1752760786
    },
    {
        "content": "<p>I will need more context</p>",
        "id": 529286117,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760798
    },
    {
        "content": "<p>If you see the error in the <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>, I'm just trying to get the induction tactic to not fail</p>",
        "id": 529286203,
        "sender_full_name": "Andrew",
        "timestamp": 1752760821
    },
    {
        "content": "<p>induction on tuples is complicated and it depends on what kind of induction hypotheses you need and whether you are inducting on <code>Prop</code>s or <code>Type</code>s</p>",
        "id": 529286243,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760831
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"938806\">Andrew</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529286203\">said</a>:</p>\n<blockquote>\n<p>If you see the error in the <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>, I'm just trying to get the induction tactic to not fail</p>\n</blockquote>\n<p>not sure what you want to accomplish here</p>",
        "id": 529286393,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760870
    },
    {
        "content": "<p>So in my example what I have is a triple: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">hstep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⇝*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ'</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 529286433,
        "sender_full_name": "Andrew",
        "timestamp": 1752760882
    },
    {
        "content": "<p>your goal is false and there aren't any inductive hypotheses</p>",
        "id": 529286467,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760891
    },
    {
        "content": "<p>Here skip is a constant and sigma and tau are variables</p>",
        "id": 529286554,
        "sender_full_name": "Andrew",
        "timestamp": 1752760915
    },
    {
        "content": "<p>oh I see</p>",
        "id": 529286570,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760919
    },
    {
        "content": "<p>What I want is to just get induction hstep to go through</p>",
        "id": 529286598,
        "sender_full_name": "Andrew",
        "timestamp": 1752760925
    },
    {
        "content": "<p>I would do <code>generalize ha : (skip, σ, τ) = a, hb : (skip, σ', τ') = b at hstep</code> followed by <code>induction hstep generalizing ...</code> for a sufficient amount of generalizing</p>",
        "id": 529286872,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752760989
    },
    {
        "content": "<p>it really depends on what you want the induction hypothesis to look like</p>",
        "id": 529286961,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761008
    },
    {
        "content": "<p>Yeah so that was my original question</p>",
        "id": 529287013,
        "sender_full_name": "Andrew",
        "timestamp": 1752761019
    },
    {
        "content": "<p>What I currently have is this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">hπ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">π</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">hπ'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">skip</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">σ'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">τ'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">π'</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hπ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hπ'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hstep</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">hstep</span>\n</code></pre></div>",
        "id": 529287145,
        "sender_full_name": "Andrew",
        "timestamp": 1752761048
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Relation</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Trace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">small_step</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Relation</span><span class=\"bp\">.</span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"n\">small_step</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">something</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">something_head</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Relation</span><span class=\"bp\">.</span><span class=\"n\">ReflTransGen</span><span class=\"bp\">.</span><span class=\"n\">head_induction_on</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 529287173,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1752761054
    },
    {
        "content": "<p>I'm trying to figure out if there's either an idiomatic or less repetitive way of doing this</p>",
        "id": 529287300,
        "sender_full_name": "Andrew",
        "timestamp": 1752761081
    },
    {
        "content": "<p>yeah I have nothing</p>",
        "id": 529287550,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761143
    },
    {
        "content": "<p>Thanks for the support both of you</p>",
        "id": 529288209,
        "sender_full_name": "Andrew",
        "timestamp": 1752761307
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"422703\">Malvin Gattinger</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529287173\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Relation</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Trace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Trace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">small_step</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Relation</span><span class=\"bp\">.</span><span class=\"n\">ReflTransGen</span><span class=\"w\"> </span><span class=\"n\">small_step</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">something</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">something_head</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">big_step</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isNice</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Relation</span><span class=\"bp\">.</span><span class=\"n\">ReflTransGen</span><span class=\"bp\">.</span><span class=\"n\">head_induction_on</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Im going to see if I can refactor my proof to make this work</p>",
        "id": 529288260,
        "sender_full_name": "Andrew",
        "timestamp": 1752761326
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529285320\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"938806\">Andrew</span> <a href=\"#narrow/channel/236449-Program-verification/topic/Induction.20over.20RTC/near/529284103\">said</a>:</p>\n<blockquote>\n<p>Unfortunately the ReflTransGen is in the wrong order (I'm looking for R a b -&gt; RTC R b c -&gt; R a c whereas ReflTransGen does RTC R a b -&gt; R b c -&gt; RTC R a c)</p>\n</blockquote>\n<p>that's a theorem</p>\n</blockquote>\n<p>Can you point me at any way to make the RTC work in the order I want? I'd like to use the Mathlib one if at all possible</p>",
        "id": 529288523,
        "sender_full_name": "Andrew",
        "timestamp": 1752761390
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen.head#doc\">docs#Relation.ReflTransGen.head</a> is the theorem</p>",
        "id": 529288686,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761435
    },
    {
        "content": "<p>In my example above please place the cursor after <code>case head IH =&gt;</code>and look at the info view :)</p>",
        "id": 529288794,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1752761467
    },
    {
        "content": "<p>there's also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen.trans#doc\">docs#Relation.ReflTransGen.trans</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Relation.ReflTransGen.single#doc\">docs#Relation.ReflTransGen.single</a></p>",
        "id": 529288863,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761483
    },
    {
        "content": "<p>there's a lot of theorems</p>",
        "id": 529288887,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761491
    },
    {
        "content": "<p>Thanks</p>",
        "id": 529288916,
        "sender_full_name": "Andrew",
        "timestamp": 1752761498
    },
    {
        "content": "<p>That's a huge help</p>",
        "id": 529288943,
        "sender_full_name": "Andrew",
        "timestamp": 1752761505
    },
    {
        "content": "<p>you're probably better off looking them up on your own rather than having me list them off</p>",
        "id": 529288962,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752761512
    }
]