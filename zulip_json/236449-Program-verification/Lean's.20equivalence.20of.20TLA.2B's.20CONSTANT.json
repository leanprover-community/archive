[
    {
        "content": "<p>What is the best way to express TLA+'s <code>CONSTANTS</code> in Lean 4?</p>\n<p>The definition of <code>CONSTANTS</code> from <a href=\"https://lamport.azurewebsites.net/tla/summary-standalone.pdf\">Summary of TLA+</a>:</p>\n<blockquote>\n<p>CONSTANTS C1, . . . , Cn (1) Declares the Cj to be constant parameters (rigid variables). Each Cj is either an identifier or has the form C (_, . . . , _), the latter form indicating that C is an operator with the indicated number of arguments.</p>\n</blockquote>\n<p>I found that there's a <code>constant</code> keyword in Lean 3, but seems like in Lean 4 it's just <code>def</code> (or <code>axiom</code>?) Specifically I was writing the proof for basic paxos and don't know how to best translate <a href=\"https://github.com/DistAlgo/proofs/blob/master/basic-paxos/PaxosHistVarNFM18.tla#L14\">this line</a> (e.g. Acceptors) from TLA+ to Lean.  </p>\n<p>From the TLA+ semantics, I think it might correspond more closely to 2 in the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n\n<span class=\"c1\">-- 1</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Acceptor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Acceptors</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Acceptor</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- 2</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Acceptor1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Acceptors1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Acceptor1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Acceptor1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>However, I feel declaring it as a type variable would suffice, like the first code block in sec 2.1 of <a href=\"https://protocols-made-fun.com/lean/2025/04/25/lean-two-phase.html\">https://protocols-made-fun.com/lean/2025/04/25/lean-two-phase.html</a>.</p>\n<p>Thanks!</p>",
        "id": 561036483,
        "sender_full_name": "Ethan Hong",
        "timestamp": 1764540124
    },
    {
        "content": "<p>You want to start with a DSL inside lean that supports this style of specification</p>",
        "id": 561112443,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1764583001
    },
    {
        "content": "<p>I suggest checking out Veil</p>",
        "id": 561112474,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1764583009
    },
    {
        "content": "<p>Thanks, I saw Veil a while ago actually. I am more asking about if one was to write this in Lean, what would be the best way to do it?</p>\n<p>I translated the proof for basic paxos from TLAPS to Lean, but wasn't so sure how to correctly write TLA+'s  <code>CONSTANT</code>.<br>\n<a href=\"https://github.com/xinhong3/PaxosProofLean/blob/main/Paxos/Spec.lean#L14\">https://github.com/xinhong3/PaxosProofLean/blob/main/Paxos/Spec.lean#L14</a></p>",
        "id": 561185264,
        "sender_full_name": "Ethan Hong",
        "timestamp": 1764601260
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"910774\">@Ethan Hong</span> The issue is that TLA+ is untyped, whereas Lean is typed, so it's non-trivial to encode the former into the latter.</p>\n<p>If you want to be faithful, you can check how TLAPS encodes TLA+ into many-sorted first-order logic, as explained in <a href=\"https://doi.org/10.1016/j.scico.2017.09.004\">Encoding TLA+ into unsorted and many-sorted first-order logic</a>.</p>\n<p>An alternative encoding is provided by the Apalache model checker. See <a href=\"https://doi.org/10.1145/3360549\">TLA+ model checking made symbolic</a> and follow-up papers for details on that.</p>",
        "id": 562447464,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1765194726
    },
    {
        "content": "<p>This is quite a bit of effort that you'd only want to do if your goal is to embed TLA+ in Lean.</p>\n<p>If you only care about verifying a specific protocol, it will definitely be easier to use a typed encoding specific for that protocol, or use a tool like <a href=\"https://veil.dev\">Veil</a>.</p>",
        "id": 562447831,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1765194846
    },
    {
        "content": "<p>embedding untyped into typed is easy, you just have everything in one type</p>",
        "id": 562563441,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1765230196
    },
    {
        "content": "<p>from what I know of TLA+'s axiomatics it should embed faithfully in lean</p>",
        "id": 562563503,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1765230226
    },
    {
        "content": "<p>Appreciate all the help! I should clarify my question since the title is too generic.</p>\n<p>Currently, the problem is protocol-specific. I am only looking at Basic Paxos.<br>\nI want to know (since there could be many ways) how to encode things such as (CONSTANT Acceptors) in Lean that's faithful to the TLA+ semantics. The TLA+ spec I am referring to is <a href=\"https://github.com/DistAlgo/proofs/blob/master/basic-paxos/PaxosHistVarNFM18.tla\">this</a>.<br>\nSo given the following in TLA+:</p>\n<div class=\"codehilite\" data-code-language=\"tla+\"><pre><span></span><code>CONSTANT Acceptors\n</code></pre></div>\n<p>Would the following be a \"good\" translation in Lean that's faithful to the TLA+ semantics?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Acceptor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Acceptors</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Acceptor</span><span class=\"o\">)</span>\n</code></pre></div>\n<hr>\n<p>however, since <code>Acceptors</code> is a constant, should I use <code>def</code> instead of <code>variable</code>?</p>",
        "id": 562726516,
        "sender_full_name": "Ethan Hong",
        "timestamp": 1765296158
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"910774\">@Ethan Hong</span> <code>variable</code> in Lean means that it's a parameter, not that it can be mutated, so that's a perfectly fine encoding.</p>",
        "id": 562852197,
        "sender_full_name": "George Pîrlea",
        "timestamp": 1765337779
    }
]