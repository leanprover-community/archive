[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">basic</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">polynomial</span> <span class=\"n\">linear_algebra</span><span class=\"bp\">.</span><span class=\"n\">multivariate_polynomial</span>\n\n<span class=\"n\">universes</span> <span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">w</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">mv_polynomial</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">β</span><span class=\"o\">]</span>\n\n<span class=\"n\">def</span> <span class=\"n\">option_ring_equiv_aux11</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"o\">(</span><span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span> <span class=\"err\">∘</span> <span class=\"n\">C</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux12</span> <span class=\"o\">:</span> <span class=\"n\">ring</span> <span class=\"o\">(</span><span class=\"n\">polynomial</span> <span class=\"o\">(</span><span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">comm_ring</span><span class=\"bp\">.</span><span class=\"n\">to_ring</span> <span class=\"bp\">_</span> <span class=\"err\">$</span> <span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">comm_ring</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux13</span> <span class=\"o\">:</span> <span class=\"n\">is_ring_hom</span> <span class=\"o\">(</span><span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"o\">(</span><span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">apply</span> <span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span><span class=\"bp\">.</span><span class=\"n\">is_ring_hom</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux14</span> <span class=\"o\">:</span> <span class=\"n\">is_ring_hom</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux11</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">is_ring_hom</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux15</span> <span class=\"o\">:</span> <span class=\"n\">is_semiring_hom</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux11</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">is_ring_hom</span><span class=\"bp\">.</span><span class=\"n\">is_semiring_hom</span> <span class=\"bp\">_</span>\n\n<span class=\"n\">def</span> <span class=\"n\">option_ring_equiv_aux1</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"o\">(</span><span class=\"n\">option</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"o\">(</span><span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">eval₂</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux11</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">option</span><span class=\"bp\">.</span><span class=\"n\">rec_on</span> <span class=\"n\">x</span> <span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span> <span class=\"err\">∘</span> <span class=\"n\">X</span><span class=\"o\">))</span>\n\n<span class=\"n\">def</span> <span class=\"n\">option_ring_equiv_aux21</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">mv_polynomial</span> <span class=\"o\">(</span><span class=\"n\">option</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"n\">eval₂</span> <span class=\"n\">C</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"err\">∘</span> <span class=\"n\">some</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux22</span> <span class=\"o\">:</span> <span class=\"n\">is_ring_hom</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux21</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">convert</span> <span class=\"n\">eval₂</span><span class=\"bp\">.</span><span class=\"n\">is_ring_hom</span> <span class=\"bp\">_</span> <span class=\"bp\">_;</span> <span class=\"n\">apply_instance</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">option_ring_equiv_aux23</span> <span class=\"o\">:</span> <span class=\"n\">is_semiring_hom</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux21</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">is_ring_hom</span><span class=\"bp\">.</span><span class=\"n\">is_semiring_hom</span> <span class=\"bp\">_</span>\n\n<span class=\"n\">def</span> <span class=\"n\">option_ring_equiv_aux2</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"o\">(</span><span class=\"n\">mv_polynomial</span> <span class=\"n\">β</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">mv_polynomial</span> <span class=\"o\">(</span><span class=\"n\">option</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">eval₂</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux21</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">none</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span>\n<span class=\"kn\">set_option</span> <span class=\"n\">class</span><span class=\"bp\">.</span><span class=\"n\">instance_max_depth</span> <span class=\"mi\">5</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">option_ring_equiv_aux3</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"o\">(</span><span class=\"n\">option</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">option_ring_equiv_aux2</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux1</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"n\">induction_on</span> <span class=\"n\">f</span>\n  <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">r</span><span class=\"o\">,</span> <span class=\"k\">calc</span> <span class=\"n\">option_ring_equiv_aux2</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux1</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"n\">r</span><span class=\"o\">))</span>\n           <span class=\"bp\">=</span> <span class=\"n\">option_ring_equiv_aux2</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">(</span><span class=\"n\">option_ring_equiv_aux11</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">congr&#39;</span> <span class=\"mi\">1</span><span class=\"bp\">;</span> <span class=\"n\">convert</span> <span class=\"n\">eval₂_C</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_;</span> <span class=\"n\">convert</span> <span class=\"n\">mv_polynomial</span><span class=\"bp\">.</span><span class=\"n\">option_ring_equiv_aux15</span> <span class=\"n\">α</span> <span class=\"n\">β</span>\n       <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">option_ring_equiv_aux21</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">convert</span> <span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">eval₂_C</span> <span class=\"bp\">_</span> <span class=\"bp\">_;</span> <span class=\"n\">apply_instance</span>\n       <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">C</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">convert</span> <span class=\"n\">eval₂_C</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_;</span> <span class=\"n\">apply_instance</span><span class=\"o\">)</span>\n  <span class=\"n\">sorry</span>\n  <span class=\"n\">sorry</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">mv_polynomial</span>\n</pre></div>",
        "id": 157091599,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548753343
    },
    {
        "content": "<p>challenge: shorten this code, but keep the compiling time low</p>",
        "id": 157091612,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548753357
    },
    {
        "content": "<p>(yes, the <code>set_option class.instance_max_depth 5</code> line is there to keep the compiling time low)</p>",
        "id": 157091663,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548753370
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110294\">@Johannes Hölzl</span></p>",
        "id": 157091668,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548753385
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110044\">@Chris Hughes</span></p>",
        "id": 157101129,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548765107
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>  I think we have a problem either with the ring homomorphisms, or some of the mv_polynomial instances... I changed the proof to <code>mv_polynomial (β ⊕ γ) α ≃r mv_polynomial β (mv_polynomial γ α)</code>, allowing also the symmetric variant.</p>",
        "id": 157194471,
        "sender_full_name": "Johannes Hölzl",
        "timestamp": 1548861489
    },
    {
        "content": "<p>are you planning to put this into mathlib? I'm about to prove the same theorem</p>",
        "id": 157194503,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548861543
    },
    {
        "content": "<p>its already in master</p>",
        "id": 157194621,
        "sender_full_name": "Johannes Hölzl",
        "timestamp": 1548861606
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/mathlib/commit/f7b9d6b43e478661eb87fef36c75e8e4ffc08499\" target=\"_blank\" title=\"https://github.com/leanprover/mathlib/commit/f7b9d6b43e478661eb87fef36c75e8e4ffc08499\">https://github.com/leanprover/mathlib/commit/f7b9d6b43e478661eb87fef36c75e8e4ffc08499</a></p>",
        "id": 157194636,
        "sender_full_name": "Johannes Hölzl",
        "timestamp": 1548861619
    },
    {
        "content": "<p>oh nice!</p>",
        "id": 157194647,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548861633
    },
    {
        "content": "<p>Aah, using <code>rename</code> we might be able to slightly cleanup the <code>mv_polynomial</code> adjunction that I PR'd a while ago.</p>",
        "id": 157194863,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1548861805
    }
]