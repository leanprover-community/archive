[
    {
        "content": "<p>Hello Lean folks,</p>\n<p>I am Luc Duponcheel, a Functional Programming veteran. I am new to this forum.</p>\n<p>I have worked on Monads and Monad Transformers since the 90-ties (previous century) with researchers like Erik Meijer, Graham Hutton, Mark P. Jones, Doaitse Swierstra and others ... .</p>\n<p>I am retired now.</p>\n<p>I think of a (various) <em>monads</em> as <em>specifications</em> of  <em>effectful expressions</em>.</p>\n<p>But what are <em>specifications of effectful functions</em>?</p>\n<p>Arrows are an appropriate candidate.</p>\n<p>I consider, what I call <em>programs</em> as being an appropriate candidate (they are inspired by Backus's FP).</p>\n<p>I have implemented  a PSBP Scala and Haskell librariy using this idea.<br>\nPSBP stands for <em>Program Specification Based Programing</em>.</p>\n<p>Recently I decided to also use Lean as a programming language because of its theorem proving capabilities. </p>\n<p>Attached (<a href=\"/user_uploads/3121/er1cj_VkqLF1nEe9PANqL-3u/PSBP.lean\">PSBP.lean</a>) you can find preliminary code with my idea's.  In practice, PSBP defines a <em>library level, specification based, programming language</em>.</p>\n<p>The code is really only the tip of a huge iceberg (no laws and proofs yet, no effects yet, and only 1 trivial active materialization). My Scala and Haskell code is much more elaborated.</p>\n<p>I am wondering if I could start some library project to contribute to this community, and, of course, I am wondering if there are any enthusiasts willing to contribute to that project.</p>\n<p>Finally, why considering programs (effectful function specifications) instead of computations (effectful expression specifications)? Well, just like functions, programs are denotational artifacts (they have a meaning), while, just like expressions, computations are operational artifacts. Just like functions can be defined using expressions, programs can be  materialized using program implementations in terms of computations. I consider functions and programs as a \"goal\" and  expressions and computations as a \"means\" to reach that goal.</p>",
        "id": 530439204,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753307379
    },
    {
        "content": "<p>By the way, I aleady have a first remark on the implementation of Applicative. It contains the following definition : seq : {α β : Type u} → f (α → β) → (Unit → f α) → f β. Ok, I understand that, because Lean evaluation is strict, type Unit → f α is used, but why not using Thunk (f α) in order to avoid multiple evaluations?</p>",
        "id": 530443102,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753309509
    },
    {
        "content": "<p>Hi Luc, welcome to Lean. I am browsing through your file and in my initial skim, I notice that you could use the inbuilt <code>Prod</code> and <code>Sum</code> types instead of the ProductType and SumType definitions. They will save you a lot of time later when proving theorems. Another quibble. You could share code more easily on this zulip, either through a code block like so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">```</span>\n<span class=\"c1\">-- some lean code</span>\n<span class=\"bp\">```</span>\n</code></pre></div>\n<p>or a github gist. You can make the codeblock collapsible by wrapping it as a spoiler</p>",
        "id": 530447605,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753312495
    },
    {
        "content": "<p>This helps us in two ways. First we can copy and paste the code in our editor. Secondly, we can use a little icon on the top right corner of the code block to open it on the lean scratch pad online. You can see this in the example below. The icons appear when you hover the mouse on the code block</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">example_code</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>",
        "id": 530447714,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753312557
    },
    {
        "content": "<p>Once my laptop finishes updating I will paste a more lean-style refactoring of your code. I think it should make it neater</p>",
        "id": 530449709,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753313889
    },
    {
        "content": "<p>At a conceptual level, I see that you are using several typeclass instances again and again. You could also define mixin type classes to extract the common combinations into one typeclass</p>",
        "id": 530449765,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753313934
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">--</span>\n<span class=\"c1\">-- generic, specification related, structures</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- abbrev ProductType := Prod -- Not required</span>\n\n<span class=\"c1\">-- thunks are used because Lean does not fully support lazy evaluation</span>\n<span class=\"c1\">-- SumType arguments should not both be evaluated</span>\n<span class=\"c1\">-- abbrev SumType (a b : Type u) := Thunk a ⊕ Thunk b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)(</span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"bp\">.</span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"bp\">.</span><span class=\"n\">get</span>\n\n\n<span class=\"c1\">-- clowns to the left</span>\n<span class=\"c1\">-- jokers to the right</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"o\">(</span><span class=\"n\">zb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">zb</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">zb</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">zb</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specifications</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- functions are programs</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">function</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- the identity function is a program</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"c1\">-- functions can act upon programs</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"c1\">-- programs can act upon themselves (i.e. programs be (sequentially) composed)</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- programs can create product values</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- programs can create intermediate values</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">let_</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">ab2c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ab2c</span>\n\n<span class=\"c1\">-- programs can consume sum values</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- programs can perform conditional logic</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">if_</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"o\">))</span>\n\n<span class=\"c1\">-- trivial library level keywords</span>\n<span class=\"c1\">-- that are introduced for for esthetic reasons</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- generic, implementation related, structures</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- generic</span>\n<span class=\"c1\">-- Functional, Functorial, Creational, Sequential, Conditional</span>\n<span class=\"c1\">-- implementations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cc</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">c2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨</span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"n\">c2ca</span><span class=\"w\"> </span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specific</span>\n<span class=\"c1\">-- Functor, Applicative, Monad</span>\n<span class=\"c1\">-- implementations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- trivial Active implementation</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">runActive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"n\">seq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">u2aa</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u2aa</span><span class=\"w\"> </span><span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">runActive</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">runActive</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specific implementation based materializations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- trivial Active materialization</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">materializeActive</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2ab</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">runActive</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- primitive examples</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">oneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwo</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">addF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">addF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiply</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- composite (recursive) examples</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- 'unsafe' keyword is used because Lean (strangely enough)</span>\n<span class=\"c1\">-- checks termination of (abstract) program specifications instead</span>\n<span class=\"c1\">-- of only checking (concrete) program implementation based materializations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">              </span><span class=\"n\">andThen</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"n\">product</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span>\n<span class=\"w\">                  </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"n\">minusTwo</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">))</span>\n<span class=\"w\">                </span><span class=\"n\">add</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorial</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">              </span><span class=\"n\">multiply</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- let's evaluate</span>\n<span class=\"c1\">--</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"c1\">-- $ lean PSBP.lean</span>\n<span class=\"c1\">-- 89</span>\n<span class=\"c1\">-- 3628800</span>\n</code></pre></div>\n</div></div>",
        "id": 530451678,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753315307
    },
    {
        "content": "<ol>\n<li>I have replaced <code>ProductType</code> with <code>Prod</code>. The notation for <code>Prod a b</code> is <code> a × b</code>. The cross is in unicode and written with the shortcut <code>\\x</code>.</li>\n<li>I have replaced  <code>SumType</code> with <code>Sum</code>. The notation for <code>Sum a b</code> is <code>a ⊕ b</code>. In this case I have replaced all occurrences of <code>SumType a b</code> with <code>Thunk a ⊕ Thunk b</code></li>\n<li>For every structure <code>structure XYZ</code>, you can construct and destructure it as <code>XYZ.mk &lt;field 1&gt; &lt;field 2&gt; ...</code>. There is standard notation for this <code>⟨&lt;field1&gt;, &lt;field2&gt;,...⟩</code>. The left and right arrow brackets are unicode characters respectively written using the shortcuts <code>\\&lt;</code> and <code>\\&gt;</code></li>\n<li>I have  replaced all ascii arrows <code>-&gt;</code> with unicode arrows <code>→</code> which can be entered using the shortcuts <code>\\-&gt;</code> or <code>\\r</code></li>\n<li>I have replaced all occurrences of <code>fun a =&gt; a</code> with <code>id</code></li>\n<li>There was one occurrence of a function creating a product type object from its pieces which looked like <code>fun x y =&gt; {fst := x, snd := y}</code>. I replaced it with <code>Prod.mk</code> which does the same thing</li>\n</ol>",
        "id": 530452172,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753315590
    },
    {
        "content": "<p>and finally, I have to ask one question : Why do you believe it will be easier to reason with Arrow computations over Monads (for which a system is already being tested in one of the release candidate toolchains)</p>",
        "id": 530454656,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753317222
    },
    {
        "content": "<p>Why thunks?</p>",
        "id": 530485912,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753339324
    },
    {
        "content": "<p>Shreyas Srinivas, thanks so much for your constructive comments. My main goal is to extend my \"library level programming language\" with extra monad-like features and to establish \"program\" laws and proof them making use of the corresponding  monad laws (I am going to name the various combinations of my type classes \"programs\" i.e. effectful functions,  just like computations (monads) are effectful expressions). Question: In Haskell there is an actor-like library (hakka) to deal with parallelism. I could use that library to add a \"parallel product\" and, for example, use it to write a parallelFibonacci. Does Lean also have such a library?   FWIW, I am just beginning to learn how to write proofs, so do not expect things to proceed very quickly. All comments are welcome.</p>",
        "id": 530504003,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753345998
    },
    {
        "content": "<p>I don’t think there is a Hakka style library for parallelism yet</p>",
        "id": 530504328,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753346111
    },
    {
        "content": "<p>Cc : <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> about parallelism</p>",
        "id": 530505003,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753346306
    },
    {
        "content": "<p>Aaron Liu, in <br>\n<code>sum {a b c : Type u} : program c a → program b a → program (Thunk c ⊕ Thunk b)</code><br>\nonly one of the two arguments of the resulting program are supposed to be used. Since, by default, Lean has eager evaluation, I use thunks to emulate lazy evaluation.<br>\nby the way, my question about the Applicative interface still remains in<br>\n seq : {α β : Type u} → f (α → β) → (Unit → f α) → f β<br>\nthe (Unit → f α)  does not really emulate lazy evaluation (evaluate zero times or one time), but rather \"by name evaluation\" (evaluate zero or more times). So I think that<br>\n seq : {α β : Type u} → f (α → β) → Thunk (f α) → f β<br>\nwould be more efficient.</p>",
        "id": 530505305,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753346398
    },
    {
        "content": "<p>you can get asynchrony using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Task#doc\">docs#Task</a></p>",
        "id": 530505879,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753346582
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/113488-general/topic/PSBP.2C.20a.20program.20specification.20based.20programming.20library/near/530505003\">said</a>:</p>\n<blockquote>\n<p>Cc : <span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> about parallelism</p>\n</blockquote>\n<p>I work on async IO, not parallelism, these matters are disjoint for the most part.</p>",
        "id": 530505918,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1753346597
    },
    {
        "content": "<p>Arrows can also represent asynchrony iirc</p>",
        "id": 530506017,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753346630
    },
    {
        "content": "<p>Shreyas Srinivas can you help me a bit by sending me a private message and copy/paste your first reply into a file that you attach, so that I can see how you produced the collapsed inline code? thx</p>",
        "id": 530506044,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753346639
    },
    {
        "content": "<p>I am currently on my phone so this will be difficult for now. But you can open the code in the lean4 playground. If you hover your mouse over the listing you will see two icons on the top right corner. Clicking on one of them will open the code in a lean editor on the web browser.</p>",
        "id": 530506707,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753346856
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939867\">Luc Duponcheel</span> <a href=\"#narrow/channel/113488-general/topic/PSBP.2C.20a.20program.20specification.20based.20programming.20library/near/530505305\">said</a>:</p>\n<blockquote>\n<p>Aaron Liu, in <br>\n<code>sum {a b c : Type u} : program c a → program b a → program (Thunk c ⊕ Thunk b)</code><br>\nonly one of the two arguments of the resulting program are supposed to be used. Since, by default, Lean has eager evaluation, I use thunks to emulate lazy evaluation.<br>\nby the way, my question about the Applicative interface still remains in<br>\n seq : {α β : Type u} → f (α → β) → (Unit → f α) → f β<br>\nthe (Unit → f α)  does not really emulate lazy evaluation (evaluate zero times or one time), but rather \"by name evaluation\" (evaluate zero or more times). So I think that<br>\n seq : {α β : Type u} → f (α → β) → Thunk (f α) → f β<br>\nwould be more efficient.</p>\n</blockquote>\n<p>In a sum type, you only get one of the two? <code>program</code> is a function type, so those won't be evaluated until you feed them an argument. And the sum type <code>Thunk c ⊕ Thunk b</code> contains only one thunk in total, and you're forcing it immediately once you acquire it, so I don't see the point of thunks here.</p>",
        "id": 530507132,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753346993
    },
    {
        "content": "<p>It would be equivalent to just force the thunk at the call site I think</p>",
        "id": 530507283,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753347035
    },
    {
        "content": "<p>Shreyas Srinivas, about your final question,<br>\n1) short specific answer: Take the associativity law for computations (monads), for programs (btw, you called mine arrows, but they are slightly different) it boils down to<br>\n<code>p ~~&gt; (q ~~&gt; r) = (p ~~&gt; g) ~~&gt; r</code> which is so much simpler and intuitive than the corresponding computation law. <br>\n2) short general answer: <em>embrace simplicity</em> that is what abstraction is all about.  <br>\n3) longer answer: computations (monads) are <em>effectful expression</em> <strong>specifications</strong>, programs are <em>effectful function</em> <strong>specifications</strong>. Programs and functions are denotational artifacts (they mean something and can be given a meaningful name). Computations and expressions are essentially operational artifacts. For example: can you give a meaningful name to <code>1 + 2*3</code> (of course <code>7</code> would be a reasonable answer, but you know what I mean). Finally, functions are defined in terms of expressions, likewise programs are defined in terms of computations (that is exactly what I did in my code). Writing programs is the <em>goal</em> using computations for doing so is a <em>means</em> to reach that goal.</p>",
        "id": 530509572,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753347837
    },
    {
        "content": "<p>Shreyas Srinivas, one final remark. I had to annotate my fibonacci and factorial code with <code>unsafe</code>. Fair enough that Lean does this termination check. But, as I wrote, fibonacci and factorial are not programs, they are <em>program specifications</em> (as can easily be derived by their signature, there are type class constraints involved). I can materialize them in various safe ways (I used <code>Active</code> but I could, e.g. have used <code>Reactive</code> as well, useful for parallelism). Think of a program specification as a (special) kind of <em>program description</em>. Compare this with the painting  \"Ceci n'est pas une pipe\" painted by René Magritte (also from Belgium, just like me). It is a description of a pipe. Or think about a painting with an effect (an explosing bomb), well, luckily enough it <em>is</em> not an explosing bomb so it is not <code>unsafe</code> at all to hang it on your wall.</p>",
        "id": 530511344,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753348474
    },
    {
        "content": "<p>If you have termination issues, then marking your code <code>partial</code> should do the trick. The issue here is not one of termination. Lean cannot prove that the type you have specified should be inhabited</p>",
        "id": 530515720,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753349900
    },
    {
        "content": "<p>In particular, lean is not sure that <code>program</code> is a non-empty type in the first place.</p>",
        "id": 530516178,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753350056
    },
    {
        "content": "<p>So what you need is a <code>Nonempty</code> instance. I added one to the factorial example and now it compiles:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorial</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">              </span><span class=\"n\">multiply</span>\n</code></pre></div>",
        "id": 530516260,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753350081
    },
    {
        "content": "<p>but when you invoke it, you have to supply this nonempty instance</p>",
        "id": 530516311,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753350099
    },
    {
        "content": "<p>But since you say you are interested in the theorem proving aspects, you should know that there is limited support for proving anything about <code>partial def</code>s</p>",
        "id": 530516464,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753350151
    },
    {
        "content": "<p>The existing support goes through something called <code>partial_fixpoint</code> which is currently only supported for functions which return an <code>Option</code> value.</p>",
        "id": 530516569,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753350191
    },
    {
        "content": "<p>Shreyas Srinivas, <em>you are my hero</em>! </p>\n<p>I will update my code, add operation symbols (for readability) and post everything using your instructions on how to do so in an appropriate way.</p>\n<p>About the theorem proving aspects ... not really good news to hear about this.</p>\n<p>Do you think that refactoring my code using <code>partial_fixpoint</code> and <code>Option</code> results is worth the trouble? </p>\n<p>I can imagine that those fixed points are akin to catamorphisms (I used them in the 90-ties when I worked in Utrecht with the group of Erik Meijer) but somewhat modified to yield an <code>Option</code> result in order to transform a partial function into a global one, right?</p>",
        "id": 530522470,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753352194
    },
    {
        "content": "<p><em>Thanks for all the constructive remarks.</em> </p>\n<p>I updated the code a little bit (I also added a few operation symbols for readability). For now I still use the <code>unsafe</code> keyword.  The partial fixed point stuff is for later.</p>\n<p>For those who read the <code>factorial</code> definition and wonder what is happening behind the scenes. <code>let_ ... in_ ...</code> creates (Creational) an intermediate local value that, together with the recursive call of <code>minusOne &gt;=&gt; factorial</code> can be used by <code>multiply</code>. </p>\n<p>Operationally, instead of popping an argument from the stack and pushing a result on the stack (what happens with sequential composition (Sequential) <code>&gt;&gt;&gt;</code>), it keeps the argument on the stack and pushes the result on top of it on the stack.</p>\n<p>My library level programming language is <em>pointfree</em> (cfr. Backus FP), but it can also deal with effects (internal, e.g. state, and external, e.g. IO). The language can also be (and sometimes has to be) used <em>positionally</em> by accessing values on the stack above <em>by position</em>. This is typically necessary for simple sequential <code>main</code>-like programs (think of them as <em>recipes</em>) where, apart from initial ingredients, also intermediate produced ingredients need to be used. Note that the intermediate ingredients can, potentially, be produced  by <em>fully fledged</em> programs (for example using recursion and condition (Conditional) to mix appropriate ingredients <em>until</em> they turn into \"mayonnaise\"). In other words, <code>PSBP</code> supports hybrid <em>pointfree and positional programming</em>. I hope that this analogy helps. Below is the code. Of course it is only the tip of a huge iceberg. My Haskell and Scala code is more elaborate.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">--</span>\n<span class=\"c1\">-- generic, specification related, functions</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)(</span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"bp\">.</span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"bp\">.</span><span class=\"n\">get</span>\n\n\n<span class=\"c1\">-- clowns to the left, jokers to the right (function)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"o\">(</span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specifications</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- functions are programs</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">function</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- the identity function is a program</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"c1\">-- functions can act upon programs</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"c1\">-- programs can create product values</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- trivial library level keyword</span>\n<span class=\"c1\">-- introduced for esthetic reasons</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" &amp;&amp;&amp; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">product</span>\n\n<span class=\"c1\">-- programs can act upon themselves</span>\n<span class=\"c1\">-- (programs be (sequentially) composed)</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;=&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"c1\">-- programs can create intermediate values</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">let_</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">ab2c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">ab2c</span>\n\n<span class=\"c1\">-- programs can consume sum values</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"s2\">\" ||| \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sum</span>\n\n<span class=\"c1\">-- clowns to the left, jokers to the right (program)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span>\n\n<span class=\"c1\">-- programs can perform conditional logic</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">if_</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"bp\">|||</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- trivial library level keyword</span>\n<span class=\"c1\">-- introduced for esthetic reasons</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- generic, implementation related, structures</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- generic</span>\n<span class=\"c1\">-- Functional, Functorial, Creational, Sequential, Conditional</span>\n<span class=\"c1\">-- implementations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cc</span><span class=\"w\"> </span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]:</span>\n<span class=\"w\">  </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">c2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"bp\">⟨</span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"n\">c2ca</span><span class=\"w\"> </span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specific</span>\n<span class=\"c1\">-- Functor, Applicative, Monad</span>\n<span class=\"c1\">-- implementations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- trivial Active implementation</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">runActive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"n\">seq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">u2aa</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u2aa</span><span class=\"w\"> </span><span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">runActive</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">runActive</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- specific implementation based materializations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"c1\">-- just to get started: trivial Active materialization</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">materializeActive</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2ab</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">runActive</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- primitive programs</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- they are program specifications, but,</span>\n<span class=\"c1\">-- by abuse of notation, let's call them programs</span>\n<span class=\"c1\">--</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">oneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwo</span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">addF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">addF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiply</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- composite (recursive) programs</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- they are program specifications, but,</span>\n<span class=\"c1\">-- by abuse of notation, let's call them programs</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- 'unsafe' keyword is used because Lean (strangely enough)</span>\n<span class=\"c1\">-- checks termination of (abstract) program specifications instead</span>\n<span class=\"c1\">-- of only checking (concrete) program implementation based materializations</span>\n<span class=\"c1\">--</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">             </span><span class=\"o\">(</span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minusTwo</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">add</span>\n\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorial</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">            </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">              </span><span class=\"n\">multiply</span>\n\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- let's evaluate</span>\n<span class=\"c1\">--</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"c1\">-- $ lean PSBP.lean</span>\n<span class=\"c1\">-- 89</span>\n<span class=\"c1\">-- 3628800</span>\n</code></pre></div>\n</div></div>",
        "id": 530527518,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753353963
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939867\">Luc Duponcheel</span> <a href=\"#narrow/channel/113488-general/topic/PSBP.2C.20a.20program.20specification.20based.20programming.20library/near/530505305\">schrieb</a>:</p>\n<blockquote>\n<p>seq : {α β : Type u} → f (α → β) → (Unit → f α) → f β<br>\nthe (Unit → f α) does not really emulate lazy evaluation (evaluate zero times or one time), but rather \"by name evaluation\" (evaluate zero or more times). So I think that<br>\nseq : {α β : Type u} → f (α → β) → Thunk (f α) → f β<br>\nwould be more efficient.</p>\n</blockquote>\n<p>Using <code>Thunk</code> is unnecessary, for several reasons:</p>\n<ol>\n<li>The caller can ensure themselves that the functions only needs to evaluate once, in the sense of:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"c1\">-- computation that we *really* don't want to run twice</span>\n<span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"c1\">-- i.e. seq f (fun _ =&gt; x.get)</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>Usually, the implementation of <code>seq</code> already ensures that the function is only evaluated once</li>\n<li>If not, the implementation can do:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">FunnyThing</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">seq</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">thunk</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Thunk</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">    </span><span class=\"c1\">-- use thunk.get later</span>\n</code></pre></div>\n<ol start=\"4\">\n<li>The definition of <code>seq</code> will usually be inlined and the compiler has better support for functions than for <code>Thunk</code>s</li>\n</ol>",
        "id": 530531928,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753355558
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 530532066,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753355611
    },
    {
        "content": "<p>Here's also a cleaned up version </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">generic, specification related, functions</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">c2a</span><span class=\"w\"> </span><span class=\"n\">tc</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2a</span><span class=\"w\"> </span><span class=\"n\">tb</span>\n\n\n<span class=\"c1\">-- clowns to the left, jokers to the right (function)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">specifications</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"sd\">/-- functions are programs -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">function</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- the identity function is a program -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"sd\">/-- functions can act upon programs -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"sd\">/-- programs can create product values -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">trivial library level keyword</span>\n<span class=\"sd\">introduced for esthetic reasons</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" &amp;&amp;&amp; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">product</span>\n\n<span class=\"sd\">/-- programs can act upon themselves (i.e. programs be (sequentially) composed) -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;=&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"sd\">/-- programs can create intermediate values -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">let_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">ab2c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">ab2c</span>\n\n<span class=\"sd\">/-- programs can consume sum values -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"s2\">\" ||| \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sum</span>\n\n<span class=\"sd\">/-- clowns to the left, jokers to the right (program) -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span>\n\n<span class=\"sd\">/-- programs can perform conditional logic -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">if_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">      </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">la2b</span><span class=\"w\"> </span><span class=\"bp\">|||</span><span class=\"w\"> </span><span class=\"n\">ra2b</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">trivial library level keyword</span>\n<span class=\"sd\">introduced for esthetic reasons</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">generic, implementation related, structures</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">generic</span>\n<span class=\"cm\">Functional, Functorial, Creational, Sequential, Conditional</span>\n<span class=\"cm\">implementations</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">a2b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">b2c</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cc</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2cb</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a2cb</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">b2cc</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">c2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"n\">c2ca</span><span class=\"w\"> </span><span class=\"n\">b2ca</span><span class=\"bp\">⟩</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">specific</span>\n<span class=\"cm\">Functor, Applicative, Monad</span>\n<span class=\"cm\">implementations</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">specific implementation based materializations</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"c1\">-- just to get started: trivial Active materialization</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">Active</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a2ab</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a2ab</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">run</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">primitive programs</span>\n\n<span class=\"cm\">they are program specifications, but,</span>\n<span class=\"cm\">by abuse of notation, let's call them programs</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isZeroF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOneF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">isOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">oneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusOneF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">minusTwo</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">minusTwoF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">addF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">addF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiply</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">multiplyF</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">composite (recursive) programs</span>\n\n<span class=\"cm\">'unsafe' keyword is used because Lean (strangely enough)</span>\n<span class=\"cm\">checks termination of (abstract) program specifications instead</span>\n<span class=\"cm\">of only checking (concrete) program implementation based materializations</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">    </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">      </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isOne</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minusTwo</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">add</span>\n\n\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">factorial</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">if_</span><span class=\"w\"> </span><span class=\"n\">isZero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">    </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">      </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">minusOne</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">          </span><span class=\"n\">multiply</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\">let's evaluate</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">fibonacci</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">materializeActive</span><span class=\"w\"> </span><span class=\"n\">factorial</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"c1\">-- $ lean PSBP.lean</span>\n<span class=\"c1\">-- 89</span>\n<span class=\"c1\">-- 3628800</span>\n</code></pre></div>\n</div></div>\n<p>I've adjusted the formatting and indentation, removed <code>Thunk</code> for the sum type (I think it's unnecessary..?) and replaced <code>Active</code> with <code>Id</code> which already exists in the core library.</p>",
        "id": 530534695,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753356379
    },
    {
        "content": "<p>Robin Arnez, just back from a cycling trip (I am also an addicted (race bicycle) cyclist and (green house) gardener), thanks so much for your constructive comments. What a positive community, this Lean community! In fact, with the standard Sum type the <code>Thunk</code>'s are indeed not necessary. Gonna update my code.</p>",
        "id": 530575509,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753366898
    },
    {
        "content": "<p>Robin Arnez, by the way, which formatter do you use? Is it a command-line one? Can it be integrated with vscode?</p>",
        "id": 530575665,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753366959
    },
    {
        "content": "<p>Shreyas Srinivas, I was thinking (.. .while cycling on my race bicycle ...). <br>\nThere are two things: programming and proving properties .<br>\nI want to do both.<br>\nBut do I really want to prove properties of (potentially unsafe) programs?<br>\nMaybe not.<br>\nI want to prove properties of the type class members (such as associativity of program sequential composition using computation (monad) laws).</p>\n<p>So, I am going to continue \"living unsafe (in a disciplined way) and hoping for the best\" and learn how to prove laws such as the associativity one mentioned above.</p>",
        "id": 530578901,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753367827
    },
    {
        "content": "<p>You probably want to look at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LawfulMonad#doc\">docs#LawfulMonad</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LawfulApplicative#doc\">docs#LawfulApplicative</a> then. By imposing this typeclass constraint on your monad, you get the monad laws for free</p>",
        "id": 530579507,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753367991
    },
    {
        "content": "<p>The distinction is made because it might be tedious to always prove that actual monads behave lawfully. For example the IO monad.</p>",
        "id": 530579920,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753368097
    },
    {
        "content": "<p>Also you might want to check out the new (in beta essentially) monadic verification framework that attaches a program logic into monads. <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/new.20monadic.20program.20verification.20framework/with/530542891\">#general &gt; new monadic program verification framework</a></p>",
        "id": 530580158,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753368150
    },
    {
        "content": "<p>Shreyas Srinivas, thanks for your tip. I have looked at those docs already, but, frankly,  I am starting to learn about all those fantastic Lean proving capabilities. Stay in touch, please.</p>",
        "id": 530580924,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753368356
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939867\">Luc Duponcheel</span> <a href=\"#narrow/channel/113488-general/topic/PSBP.2C.20a.20program.20specification.20based.20programming.20library/near/530522470\">schrieb</a>:</p>\n<blockquote>\n<p>I can imagine that those fixed points are akin to catamorphisms (I used them in the 90-ties when I worked in Utrecht with the group of Erik Meijer) but somewhat modified to yield an <code>Option</code> result in order to transform a partial function into a global one, right?</p>\n</blockquote>\n<p>I'm not sure about catamorphisms but the idea is the following: Lean is primarily a math language and as such objects behave like \"math objects\" so in particular there is no such thing as a \"natural number that doesn't terminate\". As such, a general purpose fixpoint can be proven incorrect because it would imply something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>could exist. However, this would imply <code>abc = abc + 1</code> which is mathematically unsound. So there are several strategies to still allow for recursion:</p>\n<ol>\n<li>Recursion \"by termination\": If a function terminates, there isn't any \"doesn't terminate\" problem and everything works fine. Lean implements this as well-founded recursion which requires you to prove that your parameters \"decrease\" by some well-founded notion of less-than.</li>\n<li>Partial recursion: Compiles the recursion as normal but hides the body of the declaration for proofs. That means that you can write functions that recurse indefinitely but can't prove anything about them.</li>\n<li>Recursion by monotonicity (<code>partial_fixpoint</code>): This one uses a fact from order theory that in certain orders, all monotone functions have a fixpoint. Here you can work with an <code>Option</code> type that means something like: <code>none</code> if it doesn't terminate and <code>some x</code> if it does terminate and returns <code>x</code>. In the kind of orders you're going to work with, <code>x &lt;= y</code> means something like \"if it terminated for some input in <code>x</code>, it will terminate with the same result in <code>y</code>\". Then, in order to get the fixpoint of a function <code>f</code>, you need to prove monotonicity of <code>f</code> which amounts to proving that if from <code>x</code> to <code>y</code> nothing changed that terminated before, then in the result, from <code>f x</code> to <code>f y</code> also nothing changed that terminated before.</li>\n</ol>",
        "id": 530739615,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753438039
    },
    {
        "content": "<p>Robin Arnez, thanks again for your information.<br>\nCatamorphism is +/- just a fancy word for structural recursion, and corresponds more or less to what you explained in 3. , see <a href=\"https://en.wikipedia.org/wiki/Catamorphism\">Catamorphism</a>.</p>\n<p>By that way, wiki page mentions the original <a href=\"http://Bananas,%20Lenses,%20Envelopes%20and%20Barbed%20Wire\">https://maartenfokkinga.github.io/utwente/mmf91m.pdf</a> paper (Erik Meijer is one of the authors). The paper was written a year before I joined the team for a short time.</p>\n<p>Anway, I am first going to concentrate on programming and only proving laws of my type classes, e.g. associativity, in terms of the Functor, Applicative and Monad laws (in other words, not on any laws of programs written using my library level programming language (using the members of my type classes)).</p>\n<p>I am also going to start a GitHub project.</p>\n<p>I guess that if you wrote \"math object\" you meant \"constructive math object\".  Using the \"axiom of choice\" (infinite product of non-empty sets is non-empty) there exist math objects that cannot be constructed.</p>",
        "id": 530759808,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753445489
    },
    {
        "content": "<p>Robin Arnez, by the way, which code formatter do you use? Is there a command-line one? Is there one that can be integrated with vscode? Sorry for repeating the question.</p>",
        "id": 530760926,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753445839
    },
    {
        "content": "<p>There is no automatic code formatter for Lean. This has been discussed many times, you can search on this Zulip. The short story is that the syntax extensibility of Lean makes it a <em>lot</em> harder than for regular programming languages. It will come at some point, but this is a lot more work than you would think.</p>",
        "id": 530789142,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753454221
    },
    {
        "content": "<p>Patrick Massot, frankly I am the kind of person who admires the <br>\npeople building projects like Lean rather than underestimating their work  <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> .</p>",
        "id": 530789665,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753454381
    },
    {
        "content": "<p>I’m sorry, my message was probably unclear. My intend was not at all to complain about anything you wrote. Asking for a code formatter is a very natural thing to do those days. We very much understand why people can expect this. I simply tried to explain why it’s not there yet.</p>",
        "id": 530792856,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753455288
    },
    {
        "content": "<p>And I apologize if you felt I was accusing you of underestimating the work of people building Lean and its tooling.</p>",
        "id": 530793037,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753455340
    },
    {
        "content": "<p>I'm particularly excited for the big shake up diffs on Lean 4 repos when the formatter come out <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>",
        "id": 530794258,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1753455700
    },
    {
        "content": "<p>Folks, I just created a new (preliminary) GitHub project,</p>\n<p><a href=\"https://github.com/LucDuponcheelAtGitHub/LeanPSBP\">https://github.com/LucDuponcheelAtGitHub/LeanPSBP</a>.</p>\n<p>Those who are inclined may also be interested in<br>\n<a href=\"https://github.com/LucDuponcheelAtGitHub/yoneda\">https://github.com/LucDuponcheelAtGitHub/yoneda</a> (code is Scala, docs are LaTeX)</p>\n<p>and those who are interested in \"understanding a universe framework by programming it\" may also be interested in  <br>\n<a href=\"https://github.com/LucDuponcheelAtGitHub/timeHybrids\">https://github.com/LucDuponcheelAtGitHub/timeHybrids</a>.</p>\n<p>The \"Time Hybrids\" book, by Fred Van Oystaeyen, explains an algebraic geometry instead of analytic geometry based approach to the \"universe\".  Fred has an, i.m.h.o. , highly underestimated mathematician's vision on reality.</p>\n<p>... sorry for doing free advertising ...</p>",
        "id": 530812841,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753462263
    },
    {
        "content": "<p>Hello, I am trying to document my code in a similar way as the <code>FPIL</code> and <code>TPIL</code> documentation. So I downloaded the FPIL GitHub source, and, as a experiment, tried to add an extra section on <code>PSBP</code>. So far so good, but I encountered a strange error with anchors. So far I defined three anchors, <code>Functional</code>, <code>Identity</code> and <code>Functorial</code> in <code>Examples</code>, and used them in <code>FPLean</code>. Strangely enough everything worked out fine for the first two anchors but for the third one I get the following error</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>fp-lean\n⚠<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">144</span>/399<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>VersoManual.InlineLean\nwarning:<span class=\"w\"> </span>src/verso-manual/VersoManual/InlineLean.lean:646:8:<span class=\"w\"> </span>unused<span class=\"w\"> </span>variable<span class=\"w\"> </span><span class=\"sb\">`</span>col?<span class=\"sb\">`</span>\n\nNote:<span class=\"w\"> </span>This<span class=\"w\"> </span>linter<span class=\"w\"> </span>can<span class=\"w\"> </span>be<span class=\"w\"> </span>disabled<span class=\"w\"> </span>with<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>linter.unusedVariables<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"sb\">`</span>\nℹ<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">151</span>/399<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>book/buildExamples\ninfo:<span class=\"w\"> </span>Building<span class=\"w\"> </span>examples<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>../examples\n✖<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">391</span>/399<span class=\"o\">]</span><span class=\"w\"> </span>Building<span class=\"w\"> </span>FPLean.ProgramSpecifications.Class\ntrace:<span class=\"w\"> </span>.&gt;<span class=\"w\"> </span><span class=\"nv\">LEAN_PATH</span><span class=\"o\">=</span>/home/luc/GitHub/Lean/fp-lean-master/book/.lake/packages/subverso/.lake/build/lib/lean:/home/luc/GitHub/Lean/fp-lean-master/book/.lake/packages/MD4Lean/.lake/build/lib/lean:/home/luc/GitHub/Lean/fp-lean-master/book/.lake/packages/verso/.lake/build/lib/lean:/home/luc/GitHub/Lean/fp-lean-master/book/.lake/build/lib/lean<span class=\"w\"> </span>/home/luc/.elan/toolchains/leanprover--lean4---v4.22.0-rc4/bin/lean<span class=\"w\"> </span>/home/luc/GitHub/Lean/fp-lean-master/book/FPLean/ProgramSpecifications/Class.lean<span class=\"w\"> </span>-o<span class=\"w\"> </span>/home/luc/GitHub/Lean/fp-lean-master/book/.lake/build/lib/lean/FPLean/ProgramSpecifications/Class.olean<span class=\"w\"> </span>-i<span class=\"w\"> </span>/home/luc/GitHub/Lean/fp-lean-master/book/.lake/build/lib/lean/FPLean/ProgramSpecifications/Class.ilean<span class=\"w\"> </span>-c<span class=\"w\"> </span>/home/luc/GitHub/Lean/fp-lean-master/book/.lake/build/ir/FPLean/ProgramSpecifications/Class.c<span class=\"w\"> </span>--setup<span class=\"w\"> </span>/home/luc/GitHub/Lean/fp-lean-master/book/.lake/build/ir/FPLean/ProgramSpecifications/Class.setup.json<span class=\"w\"> </span>--json\nerror:<span class=\"w\"> </span>FPLean/ProgramSpecifications/Class.lean:47:77:<span class=\"w\"> </span>Anchor<span class=\"w\"> </span>not<span class=\"w\"> </span>found.\n\n\n\nHint:<span class=\"w\"> </span>Use<span class=\"w\"> </span>a<span class=\"w\"> </span>defined<span class=\"w\"> </span>anchor\n<span class=\"w\">  </span>•<span class=\"w\"> </span>F̵u̵n̵c̵t̵o̵r̵i̵a̵l̵F̲u̲n̲c̲t̲i̲o̲n̲a̲l̲\n<span class=\"w\">  </span>•<span class=\"w\"> </span>F̵u̵n̵c̵t̵o̵r̵i̵a̵l̵I̲d̲e̲n̲t̲i̲t̲y̲\nerror:<span class=\"w\"> </span>FPLean/ProgramSpecifications/Class.lean:50:10:<span class=\"w\"> </span>Anchor<span class=\"w\"> </span>not<span class=\"w\"> </span>found.\n\n\n\nHint:<span class=\"w\"> </span>Use<span class=\"w\"> </span>a<span class=\"w\"> </span>defined<span class=\"w\"> </span>anchor\n<span class=\"w\">  </span>•<span class=\"w\"> </span>F̵u̵n̵c̵t̵o̵r̵i̵a̵l̵F̲u̲n̲c̲t̲i̲o̲n̲a̲l̲\n<span class=\"w\">  </span>•<span class=\"w\"> </span>F̵u̵n̵c̵t̵o̵r̵i̵a̵l̵I̲d̲e̲n̲t̲i̲t̲y̲\nerror:<span class=\"w\"> </span>Lean<span class=\"w\"> </span>exited<span class=\"w\"> </span>with<span class=\"w\"> </span>code<span class=\"w\"> </span><span class=\"m\">1</span>\nSome<span class=\"w\"> </span>required<span class=\"w\"> </span>builds<span class=\"w\"> </span>logged<span class=\"w\"> </span>failures:\n-<span class=\"w\"> </span>FPLean.ProgramSpecifications.Class\nerror:<span class=\"w\"> </span>build<span class=\"w\"> </span>failed\n</code></pre></div>\n</div></div>\n<p>The documentation fragments are</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">ExampleSupport</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Class</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"c1\">-- ANCHOR: Functional</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span>\n<span class=\"c1\">-- ANCHOR_END: Functional</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- ANCHOR: Identity</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"c1\">-- ANCHOR_END: Identity</span>\n\n<span class=\"c1\">-- ANCHOR: Functorial</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n<span class=\"c1\">-- ANCHOR_END: Functorial</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThenF</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Class</span>\n</code></pre></div>\n</div></div>\n<p>and</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">VersoManual</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">FPLean</span><span class=\"bp\">.</span><span class=\"n\">Examples</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Verso</span><span class=\"bp\">.</span><span class=\"n\">Genre</span><span class=\"w\"> </span><span class=\"n\">Manual</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Verso</span><span class=\"w\"> </span><span class=\"n\">Code</span><span class=\"w\"> </span><span class=\"n\">External</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FPLean</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">verso</span><span class=\"bp\">.</span><span class=\"n\">exampleProject</span><span class=\"w\"> </span><span class=\"s2\">\"../examples\"</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">verso</span><span class=\"bp\">.</span><span class=\"n\">exampleModule</span><span class=\"w\"> </span><span class=\"s2\">\"Examples.ProgramSpecifications.Class\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Manual</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"The Program Specification Type Classes\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n\n<span class=\"n\">So</span><span class=\"w\"> </span><span class=\"n\">far</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">seen</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">classes</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">lit</span><span class=\"o\">}</span><span class=\"ss\">`Functor</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">lit</span><span class=\"o\">}</span><span class=\"ss\">`Applicative</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">lit</span><span class=\"o\">}</span><span class=\"ss\">`Monad</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">computation</span>\n<span class=\"n\">specifications</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Think</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">computations</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">effectful</span><span class=\"w\"> </span><span class=\"n\">expressions</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">They</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">operational</span><span class=\"w\"> </span><span class=\"n\">artifacts</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">They</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">really</span><span class=\"w\"> </span><span class=\"k\">have</span>\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">meaning</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">mathematical</span><span class=\"w\"> </span><span class=\"n\">sense</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Functions</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">hand</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">denotational</span><span class=\"w\"> </span><span class=\"n\">artifacts</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">They</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">meaning</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">mathematical</span><span class=\"w\"> </span><span class=\"n\">sense</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">So</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">effectful</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">specifications?</span><span class=\"w\"> </span><span class=\"n\">That</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">going</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"kn\">section</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">lit</span><span class=\"o\">}</span><span class=\"ss\">`class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"bp\">`</span>\n\n<span class=\"n\">Functions</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">somehow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Well</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">that's</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">functional</span><span class=\"w\"> </span><span class=\"n\">programming</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">about</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Functions</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">are</span>\n<span class=\"n\">used</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">effectless</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">We</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">define</span><span class=\"w\"> </span><span class=\"n\">functions</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">formal</span><span class=\"w\"> </span><span class=\"n\">way</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">defining</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"kn\">class</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">is</span>\n<span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">anchorName</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"o\">}</span><span class=\"ss\">`Functional</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"kn\">class</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">::</span><span class=\"o\">:</span><span class=\"n\">paragraph</span>\n<span class=\"bp\">`</span><span class=\"ss\">``anchor</span><span class=\"w\"> </span><span class=\"n\">Functional</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span>\n</code></pre></div>\n<p>:::</p>\n<h1>{lit}<code>def identity</code></h1>\n<p>Below is a simple, standard, but extremely useful example of a function as a program,<br>\nthe {anchorName Identity}<code>identity</code> program.</p>\n<p>:::paragraph</p>\n<div class=\"codehilite\" data-code-language=\"anchor\"><pre><span></span><code>def identity [Functional program] : program α α :=\n  asProgram id\n</code></pre></div>\n<p>:::</p>\n<h1>{lit}<code>class Functorial</code></h1>\n<p>Functions can act upon programs. They do that in an effecless way. We can define functions acting upon programs in a<br>\nformal way by defining a type class. This is what we do with the {anchorName Functorial}<code>Functorial</code> class.</p>\n<p>:::paragraph</p>\n<div class=\"codehilite\" data-code-language=\"anchor\"><pre><span></span><code>class Functorial (program : Type u → Type u → Type v) where\n  andThenF {α β γ : Type u} : program α β → (β → γ) → program α γ\n</code></pre></div>\n<p>:::</p>\n<div class=\"codehilite\"><pre><span></span><code>````\n</code></pre></div>\n</div></div>",
        "id": 531358286,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753706210
    },
    {
        "content": "<p>sorry folks the triple backquotes in my code are sitting in the way of properly showing the last code  (any hints?)</p>",
        "id": 531359664,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753706581
    },
    {
        "content": "<p>Verso is fairly new and doesn't have too many references to learn from. I'd recommend checking with <span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> (CC)</p>",
        "id": 531360459,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753706769
    },
    {
        "content": "<p>Shreyas Srinivas, will do!</p>",
        "id": 531360623,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753706805
    },
    {
        "content": "<p>Hello, what a fantastic community,  <span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> helped me out !!!</p>",
        "id": 531392017,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753714688
    },
    {
        "content": "<p>Hello folks, </p>\n<p>I pushed a first (preliminary) version of the documentation of the <code>PSBP</code> library to <a href=\"https://github.com/LucDuponcheelAtGitHub/psbpDocumentation\">psbpDocumentation</a>.</p>\n<p>As usual you can make a local multi-html version (see <code>README.md</code>).</p>\n<p>I also updated the <code>PSBP</code> library itself to use more Greek letters.</p>\n<p>All comments are welcome</p>",
        "id": 531621841,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753798520
    },
    {
        "content": "<p>Hello,</p>\n<p><em>First some context</em></p>\n<p>My <code>PSBP</code> library can be seen as a library level pointfree programming language.<br>\nSo I have, for example, defined library level keywords <code>let_</code>, <code>in_</code>, <code>if_</code> and <code>else_</code>.<br>\n<code>PSBP</code> can also (and sometimes has to) be used as a positional programming language,<br>\naccessing values on a runtime stack by position. Especially for sequential <br>\n\"recipe-like\" scripts, accessing products of the initial and/or intermediate values<br>\non the runtime stack. That being said ...</p>\n<p><em>Here is my technical question</em></p>\n<p>I am translating my <code>Haskell</code> code to <code>Lean</code>, more precisely my code for yet another<br>\nlibrary level keyword <code>at_</code> to access products of the initial and/or intermediate values<br>\non the runtime stack. The code of <code>at_</code> is below (lines 76 to 88).<br>\nYou can also search for <code>at_</code>. <br>\nThe intention is to also define a convenient operation symbol, but that's another matter.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"o\">)</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThenF</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;-&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThenF</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" &amp;&amp;&amp; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">product</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;=&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"s2\">\" ||| \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sum</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">let_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">αaβpγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αaβpγ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">if_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpb</span><span class=\"w\"> </span><span class=\"n\">t_apβ</span><span class=\"w\"> </span><span class=\"n\">f_apβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">αpb</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">      </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">t_apβ</span><span class=\"w\"> </span><span class=\"bp\">|||</span><span class=\"w\"> </span><span class=\"n\">f_apβ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">at_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- λ αpβ σpα =&gt;</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let σpβ : program σ β := σpα &gt;=&gt; αpβ</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let_ σpβ</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">andThenF'</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">andThenF'</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functional</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functorial</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcγ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcγ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Sequential</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">βfcγ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">βfcγ</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foldSum</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">γfα</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">βfα</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">γfα</span><span class=\"w\"> </span><span class=\"n\">tc</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">βfα</span><span class=\"w\"> </span><span class=\"n\">tb</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Conditional</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">γfγα</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">βfγα</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"n\">γfγα</span><span class=\"w\"> </span><span class=\"n\">βfγα</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n</code></pre></div>\n</div></div>\n<p>Similar (almost identical) <code>Haskell</code> code compiles fine.<br>\nYou can run it the usual way using the little icon on<br>\nthe top right corner of the code block to open it in<br>\nthe lean scratch pad online. </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">overloaded</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n<span class=\"w\">  </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">    </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">9772</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span>\n<span class=\"w\">  </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">9687</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n<span class=\"w\">  </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n\n<span class=\"w\">  </span><span class=\"mi\">88</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">Application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">In</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">application</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">σpα</span>\n<span class=\"w\">  </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">argument</span>\n<span class=\"w\">    </span><span class=\"n\">σpα</span>\n<span class=\"w\">  </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n<span class=\"w\">  </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n</code></pre></div>\n</div></div>",
        "id": 531918177,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753905111
    },
    {
        "content": "<p>You want</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 531919009,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753905437
    },
    {
        "content": "<p>functions bind their arguments very very tightly</p>",
        "id": 531919064,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753905461
    },
    {
        "content": "<p>Aaron, sorry copy/paste error (btw, see code above it with a normal language level <code>let</code>).<br>\nWith your suggestion (and the code above) I still have an error</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stuck</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">solving</span><span class=\"w\"> </span><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">constraint</span>\n<span class=\"w\">  </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9684</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9685</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9652</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9653</span>\n<span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">trying</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">unify</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9653</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9652</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9653</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9652</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n<span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9685</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9684</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9685</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9684</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">9619</span>\n</code></pre></div>\n</div></div>\n<p>even more confusing for me, here is the corrected code</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"o\">)</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThenF</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;-&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThenF</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">product</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" &amp;&amp;&amp; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">product</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;=&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"o\">)</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"s2\">\" ||| \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sum</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">let_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">αaβpγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">identity</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αaβpγ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">trueToLeftFalseToRightF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">if_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Conditional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpb</span><span class=\"w\"> </span><span class=\"n\">t_apβ</span><span class=\"w\"> </span><span class=\"n\">f_apβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"n\">αpb</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">      </span><span class=\"n\">in_</span><span class=\"w\"> </span><span class=\"bp\">$</span>\n<span class=\"w\">        </span><span class=\"n\">trueToLeftFalseToRight</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">t_apβ</span><span class=\"w\"> </span><span class=\"bp\">|||</span><span class=\"w\"> </span><span class=\"n\">f_apβ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">else_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">at_</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- λ αpβ σpα =&gt;</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let σpβ : program σ β := σpα &gt;=&gt; αpβ</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let_ σpβ</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"o\">)</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">andThenF'</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functorial</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">andThenF'</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functional</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functorial</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThenF</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">product</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcγ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">&lt;*&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcγ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Sequential</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">αfcβ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">βfcγ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">βfcγ</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foldSum</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">γfα</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">βfα</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">tc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">γfα</span><span class=\"w\"> </span><span class=\"n\">tc</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">tb</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">βfα</span><span class=\"w\"> </span><span class=\"n\">tb</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Conditional</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">γfγα</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">βfγα</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">foldSum</span><span class=\"w\"> </span><span class=\"n\">γfγα</span><span class=\"w\"> </span><span class=\"n\">βfγα</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">--------------------------------------------------------------------------------</span>\n</code></pre></div>\n</div></div>",
        "id": 531920007,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753905769
    },
    {
        "content": "<p>that means you need to be more explicit with your universes</p>",
        "id": 531920371,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1753905891
    },
    {
        "content": "<p>Ok, I'll give it a try, all suggestions are welcome.</p>",
        "id": 531920911,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753906072
    },
    {
        "content": "<p>The suggestion is to replace all those <code>Type u</code> and <code>Type v</code> with <code>Type</code> and forget about universes.</p>",
        "id": 531922510,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906609
    },
    {
        "content": "<p>I’m pretty sure you Haskell code doesn’t have universes.</p>",
        "id": 531922575,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906632
    },
    {
        "content": "<p>And note most of Lean 4 programming infrastructure is <code>Type</code> only.</p>",
        "id": 531922660,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906664
    },
    {
        "content": "<p>You can help Lean by putting <code>variable {program : Type u → Type u → Type v} {α β γ σ : Type u}</code> around line 38.</p>",
        "id": 531922833,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906737
    },
    {
        "content": "<p>But you will immediately see that your <code>if_</code> is already not doing what you want.</p>",
        "id": 531922881,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906758
    },
    {
        "content": "<p>Since <code>Bool</code> only lives in <code>Type</code> and you want <code>program : Type u → Type u → Type v</code>.</p>",
        "id": 531922951,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753906785
    },
    {
        "content": "<p>It does not have universes indeed. I copy/pated from <code>Monad</code> and friends where there is also a <code>: Type (max (u+1) v) </code> which I already tried. and I also tried</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">at_</span><span class=\"o\">{</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- λ αpβ σpα =&gt;</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let σpβ : program σ β := σpα &gt;=&gt; αpβ</span>\n<span class=\"w\">  </span><span class=\"c1\">--   let_ σpβ</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"o\">)</span>\n</code></pre></div>\n</div></div>\n<p>did not work. </p>\n<p>I'll try with <code>variable</code> ...</p>",
        "id": 531923390,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753906962
    },
    {
        "content": "<p>Should I also somewhere use something similar to <code>: Type (max (u+1) v)</code> in my <code>def</code> of <code>at_</code>? I do not know  the syntax for <code>def</code>'s (I know the syntax for <code>class</code>es, cfr. <code>Monad</code> and friends) ... . My aim is to also state and prove laws, so  I guess that the universes will eventually be necessary anyway (or not?)<br>\n.</p>",
        "id": 531924550,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753907369
    },
    {
        "content": "<p>btw, the α  stands for \"stack\", and σ × β means β pushed onto σ.</p>",
        "id": 531924967,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753907519
    },
    {
        "content": "<p>Patrick, your suggestion to only use <code>Type</code> did the trick. But are you sure I'll never need the <code>Type u</code> and <code>Type v</code> like done in the <code>Prelude.lean</code> with <code>Monad</code> and friends (I mean, when doing theorem proving of my laws in terms of the laws of <code>Monad</code> and friends)?</p>",
        "id": 531925745,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753907804
    },
    {
        "content": "<p>All the monads that are used when programming in Lean are <code>Type</code> only.</p>",
        "id": 531926838,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753908203
    },
    {
        "content": "<p>It starts with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IO#doc\">docs#IO</a></p>",
        "id": 531926952,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753908249
    },
    {
        "content": "<p>Patrick, fair enough, but why then all those universes in <code>Prelude.lean</code>?<br>\nbtw, <em>what</em> precisely starts at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IO%3F#doc\">docs#IO?</a></p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Bind</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\">      </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">seq</span><span class=\"w\">      </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">())</span>\n<span class=\"w\">  </span><span class=\"n\">seqLeft</span><span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">())</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">seqRight</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>\n</div></div>",
        "id": 531927509,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753908460
    },
    {
        "content": "<p>Monads also play a role in maths, not only programming. I guess this is why they have universes. What I had in mind with <code>IO</code> all the monads that are used in meta-programming in Lean. They are all built on top of IO using monad transformers.</p>",
        "id": 531929668,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753909245
    },
    {
        "content": "<p>Anyway, maybe I wrote too much. My recommendation is to at least start without all those universes. There is enough to do without worrying about universes.</p>",
        "id": 531929842,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753909305
    },
    {
        "content": "<p>Thanks so much for your suggestion.<br>\nJust like with my documentation, I'll start  \"lazily\"  simple and, maybe, later,  add complexity by need. About <code>IO</code>...  When programming <code>PSBP</code> in <code>Haskell</code> I used <code>MonadIO</code> a lot in order to use my \"library level\" programs together with <code>IO</code>. Especially for the  logging of my parallel operator, used in a parallel version of <code>fibonacci</code>(implemented using <code>hakka</code>, an Actor library for <code>Haskell</code>). I would like to implement something like <code>hakka</code> in <code>Lean</code> as well. </p>\n<p>But there are ony 24 hours in a day <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> .</p>",
        "id": 531930889,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753909682
    },
    {
        "content": "<p>Folks, </p>\n<p>Thanks for all constructive replies.</p>\n<p>I could get rid of the error, even <em>without</em> giving up the </p>\n<p><code>{σ α β γ : Type u}</code><br>\nand <br>\n<code>(program : Type u → Type u → Type v) : Type (max (u+1) v)</code></p>\n<p>\"universe mumbo-jumbo\" by defining <br>\na <code>class Positional</code><br>\nand<br>\nan <code>instance ... Positional where ...</code></p>\n<p>It is all a bit \"trial and error\" for me, but, from a semantic point<br>\nof view, this <code>class</code> + <code>instance</code> approach actually makes sense.</p>\n<p>I hope now that my examples will work as well</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Positional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">at_</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">45</span><span class=\"w\"> </span><span class=\"s2\">\" @@@ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">at_</span>\n\n<span class=\"kn\">instance</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Creational</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Positional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">at_</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"w\"> </span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"n\">let_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σpα</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">αpβ</span><span class=\"o\">)</span>\n</code></pre></div>\n</div></div>",
        "id": 532016531,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1753951958
    },
    {
        "content": "<p>Folks,</p>\n<p>I added <em>positional programming</em> and <em>stateful programming</em> and updated the documentation. The documentation will, eventually, become a \"<a href=\"http://github.io\">github.io</a>\"<br>\nweb page, but I am still struggling a with how to configure everything.</p>\n<p>see<br>\n<a href=\"https://github.com/LucDuponcheelAtGitHub/PSBP\">https://github.com/LucDuponcheelAtGitHub/PSBP</a><br>\nand<br>\n<a href=\"https://github.com/LucDuponcheelAtGitHub/psbpDocumentation\">https://github.com/LucDuponcheelAtGitHub/psbpDocumentation</a></p>\n<p>For now, for the documentation, you'll have to </p>\n<ul>\n<li>download the .zip file and unzip it,</li>\n<li>[optionally] run \"$ lake exe psbpDocumentation --output _out/html --depth 2\"</li>\n<li>look at the documentation locally as \"htm-multi\" of \"html-single\".<br>\nFor example, on my laptop,<br>\nfile:///home/luc/GitHub/Lean/psbpDocumentation/_out/html/html-multi/index.html<br>\nI am truly sorry.</li>\n</ul>\n<p>Of course everything is preliminary work, but all comments are welcome.</p>",
        "id": 532483076,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754164302
    },
    {
        "content": "<p>I added programming with failure and it's documentation.</p>\n<p>The situation now is</p>\n<ol>\n<li>Warning</li>\n<li>Introduction</li>\n<li>The PSBP Library type classes</li>\n<li>fibonacci and factorial</li>\n<li>What about Functorial?</li>\n<li>Computation Valued Functions</li>\n<li>ActiveProgram</li>\n<li>ReactiveProgram</li>\n<li>Positional Programming</li>\n<li>Programming With State</li>\n<li>Programming With Failure</li>\n</ol>\n<p>Of course everything is preliminary work, but all comments are welcome.</p>\n<p>I hope you folks do not consider this as \"spam\".</p>",
        "id": 532804085,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754344963
    },
    {
        "content": "<p>Hello folks, I updated programming with failure and it's documentation and added a section on <em>validating failure</em>, accumulating failures (<code>Applicative</code> based implementation) as opposed to the already existing section on <em>fail-fast failure</em>, only considering first failure, (<code>Monad</code> based implementation).  </p>\n<p>The (slightly changed) situation is now</p>\n<ol>\n<li>Warning</li>\n<li>Introduction</li>\n<li>The PSBP Library type classes</li>\n<li>fibonacci and factorial</li>\n<li>Computation Valued Functions</li>\n<li>ActiveProgram</li>\n<li>ReactiveProgram</li>\n<li>Positional Programming</li>\n<li>Programming With State</li>\n<li>Programming With Failure</li>\n</ol>\n<p>Sorry for all my posts, hopefully the set of interested people is not empty.<br>\nAnd, once again, all comments are welcome.</p>\n<p>For now I am going to (temporarily) stop adding extra programming features<br>\nand concentrate on defining appropriate \"program and friends\" related laws, and prove \"program and friends\" related  theorems in terms of \"monad and friends\" related laws.</p>\n<p>But I am still learning the (exiting(!)) theorem proving part of Lean (the very reason for me to switch from Haskell to Lean).</p>\n<p>Thanks for reading.</p>",
        "id": 533305011,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754576771
    },
    {
        "content": "<p>Hello, folks, I added an introduction and added laws and proofs.</p>\n<p>The content is now</p>\n<ol>\n<li>About</li>\n<li>Naming conventions</li>\n<li>Programs versus Computations</li>\n<li>The PSBP library type classes</li>\n<li>fibonacci and factorial</li>\n<li>Laws</li>\n<li>Computation Valued Functions</li>\n<li>Theorems</li>\n<li>ActiveProgram</li>\n<li>ReactiveProgram</li>\n<li>Positional Programming</li>\n<li>Programming With State</li>\n<li>Programming With Failure</li>\n</ol>\n<p>Once again, sorry for all my posts, hopefully the set of interested people is not empty. And, once again, all comments are welcome.</p>",
        "id": 536050162,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1756135575
    },
    {
        "content": "<p>Hello folks, I decided to document the <code>PSBP</code> library in the <code>README.md</code> file of the <code>PSBP</code> repository itself.  Agreed, a bit more \"low profile\" than other <code>Lean</code> documentation. The documentation is also a kind of course with exercises and solutions. </p>\n<p>Once again, sorry for all my posts, hopefully the set of interested people is not empty. And, once again, all comments are welcome.</p>",
        "id": 537678124,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1756993997
    }
]