[
    {
        "content": "<p>Is it possible to somehow get Information about previously defined Variables from inside an elaboration?</p>\n<p>I want to check if a Variable is defined and log an Error if the Variable (which name I know) is not defined.</p>\n<p>I. e. here is a small example of what I would like to do. Read out the name written in the ident variableName and search if it is defined. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">isDefined</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"c1\">-- How to test if is defined?</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isDefined</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is defined\"</span>\n\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is not defined\"</span>\n</code></pre></div>\n<p>So after the above Definition is correct, I would like the following behaviour</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- prints out true</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVarFalse</span><span class=\"w\"> </span><span class=\"c1\">-- print out false</span>\n</code></pre></div>\n<p>Please let me know if this behaviour is possible to implement and how to do it if it is :D</p>",
        "id": 452372400,
        "sender_full_name": "Codegoblin",
        "timestamp": 1721315887
    },
    {
        "content": "<p>Are you looking for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.resolveGlobalConst#doc\">docs#Lean.resolveGlobalConst</a> (and the similarly named ones) and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.realizeGlobalConst#doc\">docs#Lean.realizeGlobalConst</a> (and again the similarly names ones)?</p>",
        "id": 452380591,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721318143
    },
    {
        "content": "<p>If you specifically want to look at <code>variable</code>, then you should search inside the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Command.Scope#doc\">docs#Lean.Elab.Command.Scope</a>.</p>",
        "id": 452380801,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721318211
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Thanks very much for your answer.<br>\nIn my tests, I could make your recommendet methods for defs but not for variables.<br>\ni.e.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testDef</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">resolvedNames</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">resolveGlobalConst</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">resolvedNamesN</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">resolveGlobalName</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{resolvedNames}\"</span><span class=\"w\"> </span><span class=\"c1\">-- [testDef] -- unknown constant 'testVar'</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"{resolvedNamesN}\"</span><span class=\"w\"> </span><span class=\"c1\">-- [(testDef, [])] -- []</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">isDefined</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">resolvedNames</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">resolvedNamesN</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isDefined</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is defined\"</span>\n\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is not defined\"</span>\n\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testDef</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- either unknown constant 'testVar' or []</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">testDef</span><span class=\"w\"> </span><span class=\"c1\">-- testDef : ℕ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- testVar : ℕ</span>\n</code></pre></div>\n<p>For the def there is a result. However if i cal resolveGlobalConst on the var i get unknown constant (because it is a variable i guess?) and if i call reslove GlobalName i get an empty List. So its not quite the right method.</p>\n<p>realizeGlobalName does not seem to be Found somehow (unknown Idetifier). Is there Something missing from my imports ?</p>\n<p>Still thanks for your input :)</p>",
        "id": 452386999,
        "sender_full_name": "Codegoblin",
        "timestamp": 1721319769
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>  I Just saw your Second response :D<br>\nIndeed, with the Scope, I can get the Variables and can simply check if the name I get is in the List of Variables.<br>\nThank you very much!</p>\n<p>Here is my working Example (there may be a better way :))</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getScope</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">variableNames</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">varUIds</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elem</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">elem</span><span class=\"bp\">.</span><span class=\"n\">getRoot</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">variableNames</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is defined\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName.getId.getString} is not defined\"</span>\n\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- Variable testVar is defined</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">lol</span><span class=\"w\"> </span><span class=\"c1\">--Variable lol is not defined</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- testVar : ℕ</span>\n</code></pre></div>",
        "id": 452394804,
        "sender_full_name": "Codegoblin",
        "timestamp": 1721322392
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"710184\">Codegoblin</span> has marked this topic as resolved.</p>",
        "id": 452394808,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721322395
    },
    {
        "content": "<p>It's probably best not to look into the scope state yourself or to make use of varUIds. (If you do use varUIds, don't use getRoot, but eraseMacroScopes).</p>\n<p>An easy way to do this is to elaborate the <code>variable</code>s using runTermElabM:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">runTermElabM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">varNames</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">arg</span><span class=\"bp\">.</span><span class=\"n\">fvarId!</span><span class=\"bp\">.</span><span class=\"n\">getUserName</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">varNames</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName} is defined\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Variable {variableName} is not defined\"</span>\n\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- Variable testVar is defined</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">lol</span><span class=\"w\"> </span><span class=\"c1\">--Variable lol is not defined</span>\n</code></pre></div>",
        "id": 452396714,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721322956
    },
    {
        "content": "<p>Cleaner,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">getFVarId</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">runTermElabM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getLCtx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findFromUserName?</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is defined and has type {decl.type}\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is not defined\"</span>\n\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- Variable testVar is defined and has type Nat</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">lol</span><span class=\"w\"> </span><span class=\"c1\">--Variable lol is not defined</span>\n</code></pre></div>",
        "id": 452397697,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721323164
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>  thank you for your recommendations.<br>\nUnfortunately, I think I can't use runTermsElabM since it seems to prevent the use of elabCommand?</p>\n<p>Or is there a trick to make it work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">hygiene</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">runTermElabM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">kek</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">elabCommand</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"c1\">-- type mismatch</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getLCtx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findFromUserName?</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is defined and has type {decl.type}\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is not defined\"</span>\n\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">testVar</span><span class=\"w\"> </span><span class=\"c1\">-- Variable testVar is defined and has type Nat</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">kek</span><span class=\"w\"> </span><span class=\"c1\">-- unknown</span>\n<span class=\"n\">isDefined?</span><span class=\"w\"> </span><span class=\"n\">lol</span><span class=\"w\"> </span><span class=\"c1\">--Variable lol is not defined</span>\n</code></pre></div>\n<p>However I replaced getRoot with eraseMacroScopes</p>",
        "id": 452401448,
        "sender_full_name": "Codegoblin",
        "timestamp": 1721323902
    },
    {
        "content": "<p>Don't set <code>hygiene false</code> unless you really need to. The solution is to use <code>mkIdent</code> to avoid adding macro scopes.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"isDefined? \"</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">runTermElabM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">thmName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdent</span><span class=\"w\"> </span><span class=\"ss\">`kek</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">thmName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">liftCommandElabM</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">elabCommand</span><span class=\"w\"> </span><span class=\"n\">c</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getLCtx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">findFromUserName?</span><span class=\"w\"> </span><span class=\"n\">variableName</span><span class=\"bp\">.</span><span class=\"n\">getId</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is defined and has type {decl.type}\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">logError</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Variable {variableName} is not defined\"</span>\n</code></pre></div>",
        "id": 452402255,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721324117
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>  Thank you again. I will try to use your example to improve my code :)</p>",
        "id": 452404622,
        "sender_full_name": "Codegoblin",
        "timestamp": 1721325022
    }
]