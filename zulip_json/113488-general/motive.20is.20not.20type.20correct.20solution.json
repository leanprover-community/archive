[
    {
        "content": "<p>It is probably well-known here but after being frustrated enough with the \"motive is not type correct\" error in <code>rw</code> in examples like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">l</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_comm</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I finally learned that all I need is usually just replace <code>rw</code> with <code>rw!</code>.</p>\n<p>I just thought that</p>\n<ol>\n<li>Could the error message in <code>rw</code> mention this as the first option, rather than listing many other less reliable ideas such as <code>occs</code>, <code>simp</code>, or <code>conv</code> mode? I understand there might be a difficulty that <code>rw</code> is a core tactic, and <code>rw!</code> is Mathlib only, but it would really help.</li>\n<li><span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> , how hard would be to use <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/DepRewrite.lean\">DepRewrite</a> in <code>rw??</code>, so that it doesn't fail on such cases, and recommends <code>rw!</code> to the user.</li>\n</ol>",
        "id": 555730451,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763198854
    },
    {
        "content": "<p>I think I heard from <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> that <code>rw</code> was going to be beefed up to solve this problem once and for all?</p>",
        "id": 555731122,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763199557
    },
    {
        "content": "<p>Some time ago, I have heard rumours about a a new promissed <code>rw</code> that could even rewrite under binders but I am not sure about the current status. Deprecating <code>rw!</code> to a strictly better <code>rw</code> in Core would be great of course,</p>",
        "id": 555732014,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763200539
    },
    {
        "content": "<p>I quote from the FRO year 3 roadmap:</p>\n<p>\"We will unify existing rewriting tactics, such as <code>rw</code> and <code>simp_rw</code>, into a single, more intuitive and powerful rewrite tool.\"</p>\n<p>Which is indeed what <span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> says that he'll be working on.</p>",
        "id": 555732142,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763200683
    },
    {
        "content": "<p>Do not forget to include <code>rw??</code> <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span>  . By the way I tried it as a user quite a lot now, it is great (when it doesn't complain about dependent type hell). It is usually giving more useful ideas than <code>apply?</code> when clicked on the main goal. Of course, having to wait for 15 seconds after a click eventually gets a little annoying, and sometimes I am not sure if it registered my click, so a spinning wheel &amp; speed improvement would be always nice.</p>",
        "id": 555732985,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763201475
    },
    {
        "content": "<p>This week, I was fixing a lot of code generated by Mathport, and this issue was really annoying there.</p>",
        "id": 556609237,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1763216519
    },
    {
        "content": "<p>Yes, I am currently working on a new version of <code>rw??</code> that will be faster, and it will tell you that it is loading when it is loading, and the results are shown as they come in, potentially before all of the results are computed.</p>",
        "id": 556634994,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763240372
    },
    {
        "content": "<p>Sounds great! And in case you are done before <code>rw</code> update, I would also consider using DepRewrite</p>",
        "id": 556669481,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763282815
    },
    {
        "content": "<p>By the way if you want to help, feel free to review my <code>rw??</code> PRs, which currently are <a href=\"https://github.com/leanprover-community/mathlib4/pull/31609\">#31609</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/31608\">#31608</a>.</p>",
        "id": 556723807,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763337028
    },
    {
        "content": "<p>What do you think the right behaviour would be with suggesting <code>rw!</code>? Where in the interaction should there be an explanation of why <code>rw</code> was replaced with <code>rw!</code>? Should there be a warning above the rewrite suggestions?</p>",
        "id": 556723898,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1763337145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/113488-general/topic/motive.20is.20not.20type.20correct.20solution/near/556723807\">said</a>:</p>\n<blockquote>\n<p>By the way if you want to help, feel free to review my <code>rw??</code> PRs, which currently are <a href=\"https://github.com/leanprover-community/mathlib4/pull/31609\">#31609</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/31608\">#31608</a>.</p>\n</blockquote>\n<p>Sounds fair, I can take a look on Tuesday / Wednesday.</p>",
        "id": 556772894,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763369209
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/113488-general/topic/motive.20is.20not.20type.20correct.20solution/near/556723898\">said</a>:</p>\n<blockquote>\n<p>What do you think the right behaviour would be with suggesting <code>rw!</code>? Where in the interaction should there be an explanation of why <code>rw</code> was replaced with <code>rw!</code>? Should there be a warning above the rewrite suggestions?</p>\n</blockquote>\n<p>Explanation is not necessary. Mainly do not fail on the \"motive is not type correct\". I can imagine two options, and don't have a preference.</p>\n<ol>\n<li>Always suggest <code>rw!</code>.</li>\n<li>Suggest <code>rw!</code> only when necessary (so try <code>kabstract</code> first, and replace with <code>dabstract</code> is <code>kabstract</code> fails).</li>\n</ol>",
        "id": 556773549,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1763369433
    }
]