[
    {
        "content": "<p>I measured the time to build Mathlib as of 2025-03-28 on my two computers. Both were measured with maximum performance settings, no power saving. The results were, as I expected (or perhaps more than I expected), tremendous. You can post yours.</p>",
        "id": 508919869,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743252809
    },
    {
        "content": "<p>CPU: Intel Core i5-8250U<br>\nRAM: DDR4, 16 GB, 2400 MHz<br>\nSSD: Samsung MZVLB512HBJQ-000L7</p>\n<p>6.5 hours</p>",
        "id": 508919873,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743252818
    },
    {
        "content": "<p>CPU: AMD Ryzen 9 9950X<br>\nRAM: DDR5, 32 GB, 6000 MHz<br>\nSSD: Samsung 990 PRO 1 TB</p>\n<p>15 minutes</p>",
        "id": 508919885,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743252828
    },
    {
        "content": "<p>Can you make it clear exactly what this benchmark is? Do you also compile batteries or get cache? What exactly are you typing to do this?</p>",
        "id": 508923193,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743255534
    },
    {
        "content": "<p>First I made sure that all the before-compilations things were finished by running <code>lake build</code> and waiting until it started crunching individual files. Then:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">clean</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n</code></pre></div>\n<p>Afaik it recompiled all dependencies.</p>",
        "id": 508934036,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743263684
    },
    {
        "content": "<p>So <code>lake exe cache get</code> (meaning that <code>lake build</code> is immediate) and then <code>lake clean</code> and <code>lake build</code> would also work?</p>",
        "id": 508934204,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743263837
    },
    {
        "content": "<p>Do we understand which parameters have the most effect on the compiler time?</p>",
        "id": 508968696,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743291979
    },
    {
        "content": "<p>Also, do you remember how much the faster computer cost?</p>",
        "id": 508969078,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743292336
    },
    {
        "content": "<p>I'm thinking about upgrading my desktop to something that can compile mathlib in less than half an hour.</p>",
        "id": 508969103,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743292373
    },
    {
        "content": "<p>My friends and I have also done some research on how to find a laptop better at compiling mathlib (because we're both upgrading our laptops). In general, we found that on the same laptop, it takes 4~5 times more time to compile under Windows comparing to compiling under Linux. And Ryzen 9 7940HX/7945HX outperforms intel i9-14900HX on this.</p>",
        "id": 508977857,
        "sender_full_name": "Wang Jingting",
        "timestamp": 1743299214
    },
    {
        "content": "<p>It is observed that in the process, the RAM it occupies is almost always less than 8~16GB (somewhere between that, but I forgot the exact number).</p>",
        "id": 508978041,
        "sender_full_name": "Wang Jingting",
        "timestamp": 1743299322
    },
    {
        "content": "<p>By the way, if we're hoping that mathlib will expand to 10~100 times its current size, how would we expect things to be done at that time? Are we facing the choice between downloading &gt;= 50GB of cache and hours of compilation? (Or are we expecting that Moore's law will give us better computers?)</p>",
        "id": 508978372,
        "sender_full_name": "Wang Jingting",
        "timestamp": 1743299567
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"750070\">Wang Jingting</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508977857\">said</a>:</p>\n<blockquote>\n<p>My friends and I have also done some research on how to find a laptop better at compiling mathlib (because we're both upgrading our laptops). In general, we found that on the same laptop, it takes 4~5 times more time to compile under Windows comparing to compiling under Linux. And Ryzen 9 7940HX/7945HX outperforms intel i9-14900HX on this.</p>\n</blockquote>\n<p>On i9-14900HX/64GB RAM, it took about 138 minutes under Windows and about 25 minutes under Linux. On R9-7940HX/64GB RAM, it took ~2 hours under Windows and 20 minutes under Linux.</p>",
        "id": 508978662,
        "sender_full_name": "Wang Jingting",
        "timestamp": 1743299812
    },
    {
        "content": "<p>I guess, my Intel i5 is too old. I'll search for something newer tomorrow.</p>",
        "id": 508981316,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743302041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"750070\">Wang Jingting</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508978372\">said</a>:</p>\n<blockquote>\n<p>By the way, if we're hoping that mathlib will expand to 10~100 times its current size, how would we expect things to be done at that time? Are we facing the choice between downloading &gt;= 50GB of cache and hours of compilation? (Or are we expecting that Moore's law will give us better computers?)</p>\n</blockquote>\n<p>There are several ways we can deal with that, and they are being discussed by the maintainers. E.g.,</p>\n<ul>\n<li>integrate <code>lake</code> with <code>lake exe cache</code> (or another cache solution) so that you don't download cache for the files you don't <code>import</code>;</li>\n<li>provide \"partial\" <code>olean</code>s that lack some information not required for basic operations;</li>\n<li>migrate from a single repository to many (similar to what KDE libraries did during KDE3-&gt;4 migration), so that you can choose what repositories do you depend on;</li>\n<li>hope for more effective Lean / Lean meta code / hardware.</li>\n</ul>\n<p>Note: this is not a summary of some specific discussion, but a random list of possibilities that came to my mind (though some of these options were discussed on Zulip before). And <strong>none of this</strong> is an \"official\" plan from the maintainers team.</p>",
        "id": 508981839,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743302464
    },
    {
        "content": "<p>In the case that we would get partial <code>.olean</code>s, would that basically mean that proofs would be erased from the <code>.olean</code> files? Would this have the potential to break other proofs?</p>",
        "id": 508987836,
        "sender_full_name": "Niels Voss",
        "timestamp": 1743307929
    },
    {
        "content": "<p>See <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/Lean.204.20needs.20to.20be.20optimised.20by.20at.20least.2010x.2E.20Ideas.3F/near/457235917\">#lean4 &gt; Lean 4 needs to be optimised by at least 10x. Ideas? @ ðŸ’¬</a></p>",
        "id": 508988058,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743308168
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508981839\">said</a>:</p>\n<blockquote>\n<ul>\n<li>integrate <code>lake</code> with <code>lake exe cache</code> (or another cache solution) so that you don't download cache for the files you don't <code>import</code>;</li>\n</ul>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> is working on this this quarter.</p>",
        "id": 509074564,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743377629
    },
    {
        "content": "<p>I guess, I included this because I saw a discussion about it somewhere on Zulip.</p>",
        "id": 509078908,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743381345
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"750070\">Wang Jingting</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508978662\">said</a>:</p>\n<blockquote>\n<p>On i9-14900HX/64GB RAM, it took about 138 minutes under Windows and about 25 minutes under Linux. On R9-7940HX/64GB RAM, it took ~2 hours under Windows and 20 minutes under Linux.</p>\n</blockquote>\n<p>I've also noticed Linux being much faster than windows  to build (with the same hardware), is there a reason these such a big gap? or is it just \"windows bad, linux good\"?</p>",
        "id": 509203897,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1743428289
    },
    {
        "content": "<p>On Windows, have you deativated the integrated antivirus on the directory containing mathlib? I think this makes a big difference.</p>",
        "id": 509204330,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1743428401
    },
    {
        "content": "<p>I had not, let me try and see if this helps.</p>",
        "id": 509205001,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1743428542
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">SÃ©bastien GouÃ«zel</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/509204330\">said</a>:</p>\n<blockquote>\n<p>On Windows, have you deativated the integrated antivirus on the directory containing mathlib? I think this makes a big difference.</p>\n</blockquote>\n<p>It definitely does, whenever we debug windows issues on our windows machines we can see large amounts of CPU percentage being wasted by anti virus software.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"389019\">Chris Birkbeck</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/509203897\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"750070\">Wang Jingting</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508978662\">said</a>:</p>\n<blockquote>\n<p>On i9-14900HX/64GB RAM, it took about 138 minutes under Windows and about 25 minutes under Linux. On R9-7940HX/64GB RAM, it took ~2 hours under Windows and 20 minutes under Linux.</p>\n</blockquote>\n<p>I've also noticed Linux being much faster than windows  to build (with the same hardware), is there a reason these such a big gap? or is it just \"windows bad, linux good\"?</p>\n</blockquote>\n<p>The windows build process is tweaked compared to the Linux one for technical reasons surrounding symbol limits in shared objects and has to do inherently more work than the linux or macos one.</p>",
        "id": 509208147,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1743429239
    },
    {
        "content": "<p>So I turned windows defender off but it doesn't seem hugely faster (its still running, but on Linux it would be basically done by now). One thing I notice is that even though all the cores show as if they are being used, the % utilisation stays in the 30-70% range, but on Linux once it starts building it stays at 100% until it finishes.</p>",
        "id": 509209518,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1743429531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"389019\">Chris Birkbeck</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/509209518\">said</a>:</p>\n<blockquote>\n<p>So I turned windows defender off but it doesn't seem hugely faster (its still running, but on Linux it would be basically done by now). One thing I notice is that even though all the cores show as if they are being used, the % utilisation stays in the 30-70% range, but on Linux once it starts building it stays at 100% until it finishes.</p>\n</blockquote>\n<p>I just wanted to back up that this was also my experience trying to use Lean in Windows. Same hardware, windows defender on/off... The build process is definitely slower. I'll add that running with WSL2 inside of Windows has almost equivalent performance to a Linux dual boot.</p>",
        "id": 509294268,
        "sender_full_name": "Matej Penciak",
        "timestamp": 1743452891
    },
    {
        "content": "<p>If someone here understands what should I care about when choosing a desktop for Lean and can help me choose a specific desktop (I use Linux), then I'll be very grateful.</p>\n<p>P.S.: I don't want to pay for this to avoid dealing with taxes, but I'm ready to donate $50 to a charity we'll agree on.</p>",
        "id": 509301006,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743455459
    },
    {
        "content": "<p>I just asked the analogous question about laptops recently (on mobile so can't face searching). One thing that came up was that GPUs probably aren't much help if your goal is \"compile lean code fast\" but they might be a lot of help if your goal is \"run AIs locally to help you writing lean code\". So what exactly are your goals? (Mine was the former so I didn't pay extra for GPUs)</p>",
        "id": 509305155,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743456710
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/with/492340550\">#general &gt; new (mac) laptop for Lean</a></p>",
        "id": 509305745,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743456952
    },
    {
        "content": "<p>My understanding is that you want a CPU with lots of cores (like a Ryzen 9950X or the newer 9950x3D if money is not a factor) and maybe something 32GB of RAM?  (although RAM seems less important now than it was before).</p>",
        "id": 509305926,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1743457015
    },
    {
        "content": "<p>(I have 32GB of RAM and wish I had more, though it's mostly my web browser eating it all up)</p>",
        "id": 509306412,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1743457206
    },
    {
        "content": "<p>One thing I'm really loving with 48GB and two monitors is that I can have FLT and mathlib open at the same time, and eg make PRs to mathlib whilst noting what I've PRed in FLT very easily. The only time I've heard my fan come on was when I ran into the <code>#count_heartbeats</code> issue which I posted about in <a class=\"stream\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4\">#lean4</a> over the weekend</p>",
        "id": 509306599,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743457278
    },
    {
        "content": "<p>My main issue is that I look at some configurations that differ 2x in price, and I can't see the difference. So, if someone is willing to hop on a quick call and help me order a specific desktop, I'll be very grateful.</p>",
        "id": 509306824,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743457369
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/509306599\">said</a>:</p>\n<blockquote>\n<p>One thing I'm really loving with 48GB and two monitors is that I can have FLT and mathlib open at the same time, and eg make PRs to mathlib whilst noting what I've PRed in FLT very easily. The only time I've heard my fan come on was when I ran into the <code>#count_heartbeats</code> issue which I posted about in <a class=\"stream\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4\">#lean4</a> over the weekend</p>\n</blockquote>\n<p>Oh interesting, but was it really the RAM stopping you from doing that before? I find that surprising, then again I know nothing really about this, just what I've overheard from others.</p>",
        "id": 509307205,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1743457532
    },
    {
        "content": "<p>No idea. It's just something I wouldn't have dreamed of trying before</p>",
        "id": 509358559,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743483141
    },
    {
        "content": "<p>OK, a specific question. Is there something wrong with this configuration? <a href=\"https://www.dell.com/en-us/shop/desktop-computers/dell-tower-plus-desktop/spd/dell-ebt2250-desktop/useebt2250ucto08?view=configurations&amp;configurationid=39f771ba-3fab-4eba-ac9b-dc7b3665a2bf#features_section\">https://www.dell.com/en-us/shop/desktop-computers/dell-tower-plus-desktop/spd/dell-ebt2250-desktop/useebt2250ucto08?view=configurations&amp;configurationid=39f771ba-3fab-4eba-ac9b-dc7b3665a2bf#features_section</a><br>\nI don't plan to run AI inference on this computer.</p>",
        "id": 509362038,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743485403
    },
    {
        "content": "<p>The only thing that is a bit weird to me is that they don't give the model names of the memory and SSD. If you had the names, searching for any quick reviews on them would not be a bad idea.</p>",
        "id": 509364520,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1743486885
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin DvoÅ™Ã¡k</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508919873\">said</a>:</p>\n<blockquote>\n<p>CPU: Intel Core i5-8250U<br>\nRAM: DDR4, 16 GB, 2400 MHz<br>\nSSD: Samsung MZVLB512HBJQ-000L7</p>\n<p>6.5 hours</p>\n</blockquote>\n<p>This PC has Windows. I didn't know it made a difference.</p>",
        "id": 509373302,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743490889
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin DvoÅ™Ã¡k</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/508919885\">said</a>:</p>\n<blockquote>\n<p>CPU: AMD Ryzen 9 9950X<br>\nRAM: DDR5, 32 GB, 6000 MHz<br>\nSSD: Samsung 990 PRO 1 TB</p>\n<p>15 minutes</p>\n</blockquote>\n<p>This PC has Linux.</p>",
        "id": 509373315,
        "sender_full_name": "Martin DvoÅ™Ã¡k",
        "timestamp": 1743490899
    },
    {
        "content": "<p>I'd take the 1TB SSD just to be on the safe side.</p>",
        "id": 509408874,
        "sender_full_name": "SÃ©bastien GouÃ«zel",
        "timestamp": 1743501526
    },
    {
        "content": "<p>It looks likeâ€”putting Mac devices asideâ€”the remaining contenders for mobile-laptop CPUs are the R9-9955HX, R9-9955HX 3D, U9-275HX, and U9-285HX. Do we have any measurements (on Windows 11 or Linux) for how long these CPUs take to compile Mathlib4, along with some hands-on impressions of everyday single-file workâ€”e.g., runningÂ <code>simp</code>,Â <code>inferInstance</code>,Â <code>rw?</code>,Â <code>apply</code>, and similar tactics?</p>\n<p>Iâ€™ll probably end up buying Lenovoâ€™s R9000P with the R9-9955HX. Still, Intelâ€™s U9 line looks very tempting thanks to its strong single-core performance (would that make working on a single file faster?). With my limited budget, choosing the right laptop for Lean 4 is giving me a real headache.</p>\n<p>Are there any powerful online servers we could use instead? I donâ€™t know much about server-grade CPUs, but in my mind their performance should far exceed that of a personal laptop. Is that just wishful thinking?</p>",
        "id": 514380917,
        "sender_full_name": "å¼ å®ˆä¿¡(Shouxin Zhang)",
        "timestamp": 1745587827
    },
    {
        "content": "<p>Re: server performance vs. local computers<br>\nWhen working on mathlib, you can use a similar phenomenon by using mathlib's cache. If you push your current branch of mathlib, CI servers try to build it. After the build has completed, you can download the olean files (for every file which built successfully). Thus, when I modify a lower-level file A in mathlib and want to see what effect it had on a \"higher-level\" file B (which depends on A, but through many other dependencies), a useful strategy can be (1) edit file A and push changes, (2) wait a bit, (3) download the cache for file (B). That way, I only have to build A and B on my computer.</p>",
        "id": 514424655,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745600549
    },
    {
        "content": "<p>At the moment, this cache is specific to mathlib --- but my understanding is that the Lean FRO is working on extending this to other projects. (I'm not sure who'd run the servers for that --- if it's \"bring your own, but we support it\" or some general service provided to e.g. any project on reservoir.)</p>",
        "id": 514424845,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745600613
    },
    {
        "content": "<p>I'm currently on an amd ryzen 7 and 16 GB of ram.</p>",
        "id": 514567505,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745694580
    },
    {
        "content": "<p>more cores will help with building with <code>lake</code> but I think lean server on any single file will only run on one core. So you'll want more threads per core for fast real time type checking</p>",
        "id": 514567600,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745694646
    },
    {
        "content": "<p>In file parallelism is becoming a thing in the very recent Lean development work so even individual files should assumed to be multi core.</p>",
        "id": 514568998,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1745695743
    },
    {
        "content": "<p>but isn't lean itself a single process program. Meaning that any lean process can only do multithreading not core level parrallelism?</p>",
        "id": 514590588,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745714038
    },
    {
        "content": "<p>Your wording makes me think you might be a bit confused? Number of cores you can use == number of threads. So \"multithreading\" and \"multi-core\" are the same thing. Being a single process is irrelevant: lots of massively parallel programs are only a single process.</p>\n<p>(There is some subtlety about logical vs physical core, hyperthreading, inter-core memory contention... but this is the main idea.)</p>",
        "id": 514608533,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1745728960
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"676310\">Frederick Pu</span> <a href=\"#narrow/channel/113488-general/topic/Mathlib.20as.20a.20PC.20benchmark/near/514590588\">said</a>:</p>\n<blockquote>\n<p>but isn't lean itself a single process program. Meaning that any lean process can only do multithreading not core level parrallelism?</p>\n</blockquote>\n<p>Quick Operating Systems crash course: A process is a thing in the OS world that has its own virtual address space (i.e. the memory it addresses is separated from the memory that other processes can address) and resources (open files, network connections etc.). A single process can have multiple threads associated with it that all share these resources but can be scheduled concurrently and in particular also in parallel if you have a multi core machine. So no, being a single process does not at all prevent you from doing something multicore and in fact most multicore applications out there are single process multiple thread ones.</p>",
        "id": 514619008,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1745737964
    }
]