[
    {
        "content": "<p>Hmm, quite annoying when I think my PR is ready for review, and I have labeled at that, and I’m patiently waiting for a review only to notice a few days later that CI wasn’t actually happy, and nobody is likely to look at it, and I only notice if I happen to check my open PRs. I wonder how best to avoid that? Maybe a bot that looks at PRs that are labeled <code>awaiting-review</code>, but CI is red, and that comment &amp; relabel the PR? Or maybe do that if nothing else is happening for a few days (no need to have bots annoy us when there is activity)?</p>",
        "id": 280332697,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1651056981
    },
    {
        "content": "<p>You can look at either of <a href=\"https://github.com/leanprover-community/mathlib/branches/yours\">your Github branches</a> and of <a href=\"https://github.com/leanprover-community/mathlib/pulls/nomeata\">your open PRs</a>.</p>",
        "id": 280332831,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1651057067
    },
    {
        "content": "<p>You can setup github to send you emails when CI fails; I think this might even be the default</p>",
        "id": 280333347,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1651057281
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> I'm sorry to hear that. I agree this can be annoying, because it's sometimes not clear where the responsibility for a PR lies, and so they can fall through the cracks.<br>\nI like your idea of a bot that draws some attention to such PRs.</p>",
        "id": 280333523,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1651057378
    },
    {
        "content": "<p>(oh, and I hope it’s not negative to call this “rant”, I’m not blaming anyone or such. It’s just nice to speakout what is bothering a bit.)<br>\nI think I might even get these emails, but they are also sent for PRs that I haven’t submitted for review, or for cancelled builds, so most of them are noise and that’s why I probably miss the relevant one.</p>",
        "id": 280333770,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1651057496
    },
    {
        "content": "<p>Indeed, clear responsibilities are probably a good idea. Assuming we only expect reviews on CI-green PRs by default (maybe there is a separate way to indicate “this doesn’t pass yet, and I know, but I still would like a review”), then that label plus a red CI is an invalid state that could be reconciled by a bot, by assigning to the user? But I’m worried it might cause too much noise…</p>",
        "id": 280334042,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1651057625
    },
    {
        "content": "<p>There is also a slight difference between \"red because mathlib did not build correctly\" and \"red but the olean's are available\".  I would say that flagging the first one is more important than the second one.</p>",
        "id": 280334205,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1651057731
    },
    {
        "content": "<p>If you look at <a href=\"https://bit.ly/3zVLgqR\">#queue</a>, it's just a fixed URL with some filtering parameters. I see two options:</p>\n<ul>\n<li>Creating a #broken_queue (or something along those lines) which points to such PRs</li>\n<li>You can create a URL of your own with red PRs labeled as <code>awating_review</code> and include <code>author:joachim</code> as a parameter so you can see your broken PRs from time to time</li>\n</ul>",
        "id": 280334246,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1651057758
    },
    {
        "content": "<p>I do look at my PRs from time to time, that’s how I find these stuck PRs right now. But I’m spoiled and lazy, and would like someone (better something) alert me when I made a mistake  :-)</p>",
        "id": 280334363,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1651057823
    },
    {
        "content": "<p>If you don't mind running a bot on your PC, it should be pretty straightforward to build a Python script that checks for your red PRs periodically. And if the community agrees, building a globally alerting bot should be straightforward as well (I can help with that)</p>",
        "id": 280334817,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1651058096
    },
    {
        "content": "<p>Personally, I think there are now so many PRs that I only have time to look at PRs with a green CI checkmark (barring occasional exceptions). In particular, I wouldn't mind strong bot flags that turn PRs with failing CI back in the realm of the PR author. I'm happy to have an even stronger label that authors can apply sparingly to override the broken-CI-bot to kick their PR on the review queue nonetheless.</p>",
        "id": 280335203,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1651058301
    },
    {
        "content": "<p>another one that always bites me is when there's magically a merge conflict, and I have no clue till a week later or so. it's also annoying that <code>gh pr status</code> (from the github cli) doesn't show labels</p>",
        "id": 280336894,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1651059372
    },
    {
        "content": "<p>but mercifully it does show all your PRs and whether CI is passing/failing, so it's a nice tool to run randomly</p>",
        "id": 280336928,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1651059400
    },
    {
        "content": "<p>I think the correct mechanism to handle \"my PR is broken but I'd like a review anyway\" is to post a message on <a class=\"stream\" data-stream-id=\"144837\" href=\"/#narrow/stream/144837-PR-reviews\">#PR reviews</a>!</p>",
        "id": 280337212,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1651059595
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> if labeling PRs is part of the scope of the lean-community bot, maybe it could be extended to change such labels back to <code>awating-author</code>?</p>",
        "id": 280338174,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1651060205
    },
    {
        "content": "<p>I have no idea how to do that, but it sounds reasonable to me. Of course, that's just my opinion. It would be good to hear from a lot of others as well. Including a bunch more <span class=\"user-group-mention\" data-user-group-id=\"2494\">@maintainers</span></p>",
        "id": 280338270,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1651060277
    },
    {
        "content": "<p>While we're here, automatically adding awaiting-review to new PRs when I forget would be neat</p>",
        "id": 280340021,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1651061274
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> how to conclude that the PR is indeed ready for review?</p>",
        "id": 280342220,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1651062470
    },
    {
        "content": "<p>I do not really know whether there is a flow associated to <code>awaiting-CI</code>, but that label I would interpret as: \"I am happy with the current version and would tag it <code>awaiting-review</code>, provided it passes CI\".  If this is not the current behaviour, then maybe it could become that, instead?  I.e., the bot could check that PRs labeled <code>awaiting-CI</code> are \"green\" and could remove <code>awaiting-CI</code> and replace it by <code>awaiting-review</code>?</p>",
        "id": 280342593,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1651062647
    },
    {
        "content": "<p>So far, I've mostly treated it as \"Warning, do not merge right now! Please review/merge in a couple of hours\".</p>",
        "id": 280342839,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1651062816
    },
    {
        "content": "<p>Ah, I was looking at it from the perspective of the author, not of the reviewer!</p>",
        "id": 280342933,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1651062856
    },
    {
        "content": "<p>Actually, Johan, I realize now that what you are saying also applies to the author.  Anyway, maybe there should be an <code>awaiting-review-if-green</code>-tag.</p>",
        "id": 280343012,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1651062917
    }
]