[
    {
        "content": "<p>What is the policy on deprecated modules? Are they required and must they be done in the same PR? The down side of it being in the same PR is that it botches the diff (and by extension the git history but I am willing to give this up) and make trivial PRs moving files significantly harder to review. I heard there are discussions about having a bot do this automatically after the moving PR is merged but are we anywhere near this?</p>",
        "id": 517583364,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1747063504
    },
    {
        "content": "<p>The status is: the <code>file-removed</code> label is now managed well, and this is waiting for somebody to implement the final bot. I sketched some implementation instructions <a href=\"#narrow/channel/287929-mathlib4/topic/Deprecation.20policy/near/516659706\">in the third bullet here</a>, but won't have too much time to implement it. Help is welcome!</p>",
        "id": 517587084,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747064243
    },
    {
        "content": "<p>Another option is to simply create the follow-up by hand and ping in this channel for review. I'm happy to maintainer merge such PRs quickly --- but presumably the \"speedy review\" channel could also work just fine.</p>",
        "id": 517587378,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747064294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/345428-mathlib-reviewers/topic/deprecated_module/near/517583364\">said</a>:</p>\n<blockquote>\n<p>What is the policy on deprecated modules? Are they required and must they be done in the same PR? The down side of it being in the same PR is that it botches the diff (and by extension the git history but I am willing to give this up) and make trivial PRs moving files significantly harder to review. I heard there are discussions about having a bot do this automatically after the moving PR is merged but are we anywhere near this?</p>\n</blockquote>\n<p>I recently (in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24788\">#24788</a>) put a link to the diff before the module deprecation commit below the PR description. That way this diff is easy to review and there is not the annoying overhead of an immediate follow-up PR.</p>",
        "id": 517600994,
        "sender_full_name": "Christian Merten",
        "timestamp": 1747067313
    },
    {
        "content": "<p>I've just seen a strong reason to do this in a separate PR; if you don't the conflicts downstream are not automatically resolved</p>",
        "id": 517607506,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747068924
    },
    {
        "content": "<p>That is, all of the following are reasons to care about the history:</p>\n<ul>\n<li>Review (solved with helpful comments)</li>\n<li>Blame (rare-ish use-case)</li>\n<li>Syncing PRs to HEAD (hard to fix without just creating the right history to start with)</li>\n</ul>",
        "id": 517607787,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747068993
    },
    {
        "content": "<p>How about this.</p>\n<p>On every commit to master,</p>\n<ul>\n<li>find the files in <code>Mathlib/</code> that have been removed,</li>\n<li>regenerate them up to their final import,</li>\n<li>append the <code>deprecated_module</code> command,</li>\n<li>create a branch with this and</li>\n<li>ping this channel about it?</li>\n</ul>\n<p>Have I missed something?</p>",
        "id": 517758429,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747122122
    },
    {
        "content": "<p>(You could refine this by only running the workflow if a PR with the file-removed label was merged. I'm not sure how easy or difficult that is.)</p>",
        "id": 517760470,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747122773
    },
    {
        "content": "<p>I'd add \"or moved\" to the first bullet ---- otherwise, looks spot on!</p>",
        "id": 517760471,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747122773
    },
    {
        "content": "<p>Well, I was thinking of not using gits interface for the removed files, but actually bash-diff'ing the <code>.lean</code> files.  That should catch renames, as it won't be aware of the files' contents.</p>",
        "id": 517761326,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747123033
    },
    {
        "content": "<p>Which makes me wonder: does git index empty files?</p>",
        "id": 517761634,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747123109
    },
    {
        "content": "<p>Are empty files allowed in mathlib?</p>",
        "id": 517761742,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747123138
    },
    {
        "content": "<p>(I suspect that both answers are yes and that I'd rather the second at least be no.)</p>",
        "id": 517761907,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747123188
    },
    {
        "content": "<p>Quick searching suggests that empty files are allowed (of course they are). And I don't see any mechanism to forbid empty files in mathlib. We could add one, though.</p>",
        "id": 517776455,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747127363
    },
    {
        "content": "<p>For lean files, the <code>mk_all</code> step ensures all files are present. (It doesn't check emptiness, though. I could add that to the lint-style linter, though.)</p>",
        "id": 517776527,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747127389
    },
    {
        "content": "<p>Empty files in FLT don't lint, because they're missing an import. Does this help?</p>",
        "id": 517787758,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747130754
    },
    {
        "content": "<p>... and this is because otherwise the flexible linter is not recognised. Right. But mathlib doesn't enable that linter (yet?).</p>",
        "id": 517789581,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747131334
    },
    {
        "content": "<p>My main concern is that there is therefore a difference between removing a file and simply emptying it.  The module deprecation script can also take care of handling empty files, but I suspect that doing this elsewhere is better.</p>",
        "id": 517831440,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747142930
    },
    {
        "content": "<p>By the way, I almost have a script ready.</p>",
        "id": 517831627,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747142977
    },
    {
        "content": "<p>I agree with both your points: handling empty files (e.g. by disallowing them) would be good, and should happen elsewhere.</p>",
        "id": 517841176,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747145308
    },
    {
        "content": "<p>Ok, I'll write the script assuming that there are no empty files.</p>",
        "id": 517842058,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747145514
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24861\">#24861</a> introduces the <code>#create_deprecated_modules</code> command.</p>",
        "id": 517930471,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747173582
    },
    {
        "content": "<p>From the doc-string:</p>\n<p>The command <code>#create_deprecated_modules (n)? (comment)? (write)?</code> generates deprecated modules.</p>\n<p>Writing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">create_deprecated_modules</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"s2\">\"These files are no longer relevant\"</span>\n</code></pre></div>\n<p>looks at the <code>lean</code> files in <code>Mathlib</code> that existed <code>4</code> commits ago<br>\n(i.e. the commit that you see with <code>git log -5</code>) and that are no longer present.<br>\nIt shows how the corresponding deprecated modules should look like, using<br>\n<code>\"These files are no longer relevant\"</code> as the (optional) comment.</p>\n<p>If the number of commits is not explicitly used, <code>#create_deprecated_modules</code> defaults to <code>2</code>,<br>\nnamely, the commit just prior to the current one.</p>\n<p>If the message is not explicitly used, <code>#create_deprecated_modules</code> defaults to<br>\n<code>\"Auto-generated deprecation\"</code>.<br>\nIf you wish there to be no comment, use <code>#create_deprecated_modules 5 \"\"</code>.</p>\n<p>Note that the command applies the <em>same</em> comment to all the files that it generates.</p>\n<p>Finally, if everything looks correct, adding a final <code>write</code> actually generates the files:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">create_deprecated_modules</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"s2\">\"These files are no longer relevant\"</span><span class=\"w\"> </span><span class=\"n\">write</span>\n</code></pre></div>",
        "id": 517930557,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747173605
    },
    {
        "content": "<p>I did not integrate it in CI, since there are some potential issues with the same deprecated file being generated multiple times, if the deprecation PRs don't get merged fast enough (and I would rather test that everything is behaving as expected!).</p>",
        "id": 517930800,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747173711
    },
    {
        "content": "<p>Here's a thought on the next step: add a workflow running daily (say, at 11pm --- this will get some deprecations wrong by a day, which may still be fine). Ask git for the number of commits merged that day, and then generate deprecations with that. (Actually, even running it with \"100\" hard-coded is unlikely do do much harm, if we make sure to only merge the <em>first</em> such PR/double-check the dates.)</p>",
        "id": 517977970,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747203113
    },
    {
        "content": "<p>A first test looks great (and produced <a href=\"https://github.com/leanprover-community/mathlib4/pull/24871\">#24871</a>)</p>",
        "id": 517979659,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747203937
    },
    {
        "content": "<p>Michael, your test shows that the PRs should also run <code>lake exe mk_all</code> before pushing!  <span aria-label=\"lol\" class=\"emoji emoji-1f606\" role=\"img\" title=\"lol\">:lol:</span></p>",
        "id": 517980540,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204316
    },
    {
        "content": "<p>Yes!</p>",
        "id": 517980597,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747204328
    },
    {
        "content": "<p>Another procrastination avenue: bisect the commits to find when a particular file was removed, and automatically determine the offending PR and day. (I would say that's not worth it.)</p>",
        "id": 517980687,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747204373
    },
    {
        "content": "<p>Other observation: the script works really well locally. If I commit the generated deprecation, it's \"self-silencing\" (an exception won't appear), so you can very well bisect manually \"which were recent deprecations\" and add them one by one. And the script is very fast, so this is pleasant to work with.</p>",
        "id": 517980916,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747204459
    },
    {
        "content": "<p>I'm glad that you are finding the script easy to use and workable!</p>",
        "id": 517981477,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204716
    },
    {
        "content": "<p>I think that naming a file to deprecate is a very reasonable extension, as git's <code>--follow</code> should give you quick access to all the information that you need.</p>",
        "id": 517981498,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204722
    },
    {
        "content": "<p>This would be for a later PR, though!</p>",
        "id": 517981502,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204725
    },
    {
        "content": "<p>Btw, were you testing this on Linux?</p>",
        "id": 517981540,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204739
    },
    {
        "content": "<p>(The script is written in Lean, but uses <code>git</code> internally.)</p>",
        "id": 517981608,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747204768
    },
    {
        "content": "<p>Yes, I used Linux (Debian stable).</p>",
        "id": 517982797,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747205252
    },
    {
        "content": "<p>Michael, thank you for sharing your workflow in your PR!  This is incredible useful!  Here are some comments.</p>\n<ol>\n<li>It would be good if the command ignored filename changes that only differ in upper/lowercase, since those are probably not going to be implemented.</li>\n<li>More generally, allowing a list of files that are not going to be deprecated is also reasonable, since there will always be exceptions.</li>\n<li>The command could show the commit message of the past commit that it is using.</li>\n</ol>",
        "id": 517984171,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747205786
    },
    {
        "content": "<p>I definitely agree with 1 and 3. I'm not sure about 2, but won't mind it either.</p>",
        "id": 517984299,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747205842
    },
    {
        "content": "<p>Since I expect this command to be eventually used by bots, maybe a simple solution would be to allow the syntax</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">create_deprecated_modules</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"s2\">\"These files are no longer relevant\"</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">names</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">modules</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">write</span>\n</code></pre></div>\n<p>to let the script know that you only want to deprecate the explicitly given list of modules (and the <code>only ...</code> is optional, kind of a \"I'm feeling lucky\" option).</p>",
        "id": 517985986,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747206433
    },
    {
        "content": "<ol start=\"4\">\n<li>Make the command emit a warning when the generated text exceeds 100 characters.</li>\n</ol>\n<p>We could even consider silencing the longLine linter on <code>deprecated module</code> messages, since those files may as well never be opened anyway.</p>",
        "id": 517991296,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747208177
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a> is a different version of the same PR: I like the UX a lot (but there seems to be a small bug making it not work on my side)</p>",
        "id": 518219902,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747292115
    },
    {
        "content": "<p>I should have fixed the issue: please, let me know if you still experience problems with the command!</p>",
        "id": 518482528,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1747383784
    },
    {
        "content": "<p>The current policy to move a file is to just move it in a PR and create the <code>deprecated module blah blah</code> in another one, right? (This discussion should be public anyway)</p>",
        "id": 522099759,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748951241
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"345428\" href=\"/#narrow/channel/345428-mathlib-reviewers/topic/deprecated_module\">#mathlib reviewers &gt; deprecated_module</a> by <span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span>.</p>",
        "id": 522307007,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749028474
    },
    {
        "content": "<p>I've moved this discussion to #**general&gt; since it is relevant for everybody.</p>",
        "id": 522307090,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749028498
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"488648\">@Xavier Roblot</span> this the discussion I mentioned in <a href=\"https://github.com/leanprover-community/mathlib4/pull/25388\">#25388</a></p>",
        "id": 522307295,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749028556
    },
    {
        "content": "<p>Damiano's \"ping this channel\" comment now should say \"ping a private channel (that not everybody can ping)\"</p>",
        "id": 522455977,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1749073020
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/522099759\">said</a>:</p>\n<blockquote>\n<p>The current policy to move a file is to just move it in a PR and create the <code>deprecated module blah blah</code> in another one, right? (This discussion should be public anyway)</p>\n</blockquote>\n<p>I just got told to do this, but I am confused. If I put the deprecated modules in another PR, doesn't that just mean there will be a period where the modules don't have a deprecation warning? What if someoneone makes a dependency on mathlib in the interim?</p>",
        "id": 525090928,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750446167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/517583364\">said</a>:</p>\n<blockquote>\n<p>What is the policy on deprecated modules? Are they required and must they be done in the same PR? The down side of it being in the same PR is that it botches the diff (and by extension the git history but I am willing to give this up) and make trivial PRs moving files significantly harder to review. I heard there are discussions about having a bot do this automatically after the moving PR is merged but are we anywhere near this?</p>\n</blockquote>\n<p>What do you mean when you say it \"botches the diff\"? Whether you do it over one PR or two, isn't it the same total amount of lines of diff either way?</p>",
        "id": 525091657,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750446438
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/525090928\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/522099759\">said</a>:</p>\n<blockquote>\n<p>The current policy to move a file is to just move it in a PR and create the <code>deprecated module blah blah</code> in another one, right? (This discussion should be public anyway)</p>\n</blockquote>\n<p>I just got told to do this, but I am confused. If I put the deprecated modules in another PR, doesn't that just mean there will be a period where the modules don't have a deprecation warning? What if someoneone makes a dependency on mathlib in the interim?</p>\n</blockquote>\n<p>Yes, but it's assumed most people won't update their mathlib right inside the gap</p>",
        "id": 525093760,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750447586
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/525091657\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/517583364\">said</a>:</p>\n<blockquote>\n<p>What is the policy on deprecated modules? Are they required and must they be done in the same PR? The down side of it being in the same PR is that it botches the diff (and by extension the git history but I am willing to give this up) and make trivial PRs moving files significantly harder to review. I heard there are discussions about having a bot do this automatically after the moving PR is merged but are we anywhere near this?</p>\n</blockquote>\n<p>What do you mean when you say it \"botches the diff\"? Whether you do it over one PR or two, isn't it the same total amount of lines of diff either way?</p>\n</blockquote>\n<p>Git can only detect the change as a move if you don't add a new file at the same path <em>in the same commit</em></p>",
        "id": 525093839,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750447624
    },
    {
        "content": "<p>Ah, ok, that actually makes sense, thanks for the explanation.</p>",
        "id": 525093935,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1750447672
    },
    {
        "content": "<p>It's somewhat hacky for sure</p>",
        "id": 525094080,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750447757
    },
    {
        "content": "<p>Did we end up automating this? We're missing one for <code>Mathlib/Analysis/SpecialFunctions/Integrals.lean</code> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/26135\">#26135</a>)</p>",
        "id": 526224570,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751139291
    },
    {
        "content": "<p>The current state of the art is <a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a> (which is primarily waiting on completing a review). So, in order:</p>\n<ul>\n<li>finish reviewing <a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a> (I reviewed the first 250 lines in detail, another 100 remaining)</li>\n<li>land <a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a></li>\n<li>use that to backfill missing deprecations (this could already be done now, using the current state of the branch)</li>\n<li>create a new PR, with automation to periodically search for missing deprecations, create them and making a PR adding them (this is very similar to the nolint workflow)</li>\n</ul>",
        "id": 526227132,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751142936
    },
    {
        "content": "<p>Feel free to make a PR for the missing deprecations! That would be very welcome.</p>",
        "id": 526227165,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751142968
    },
    {
        "content": "<p>(Help with reviewing the infrastructure also is. I do mean to return to this, but my mathlib infra time is short right now, and <a href=\"https://github.com/leanprover-community/mathlib4/pull/26109\">#26109</a> feels higher priority.)</p>",
        "id": 526227225,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751143044
    },
    {
        "content": "<p>I'm disappointed to discover while bumping sphere-eversion that Mathlib.Analysis.InnerProductSpace.Projection was removed and we didn't add a deprecation in time. If we're not working on automation to prevent this, can we revert to requiring deprecations in the PR that removes the file? I don't think the version history downsides weigh up to the downstream pain if we don't manage to follow up</p>",
        "id": 534443685,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755164258
    },
    {
        "content": "<p>The version history mess <em>really</em> downsides the downstream pain in my opinion</p>",
        "id": 534444505,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755164588
    },
    {
        "content": "<p>Then we should find a way to make sure the follow up happens</p>",
        "id": 534444834,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755164743
    },
    {
        "content": "<p>Ideally a bot does this, say every night?</p>",
        "id": 534446587,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755165424
    },
    {
        "content": "<p>For example, yeah</p>",
        "id": 534446626,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755165440
    },
    {
        "content": "<p>For the record: I finished reviewing <a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a> a week ago. Most of it is easy to fix, but there is one bug. Help with tracking that down is certainly welcome.</p>",
        "id": 534487420,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1755179385
    },
    {
        "content": "<p>That's my bad about the projection file. I forgot to remind to follow up with that.</p>",
        "id": 534499639,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755183113
    },
    {
        "content": "<p>Fwiw, I ran into another one today, but I forgot to write down which one</p>",
        "id": 534500319,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755183290
    },
    {
        "content": "<p>According to one of the commands in the script, in the last 600 commits, these are the missing deprecations:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"s1\">'Mathlib/Algebra/Group/FiniteSupport.lean'</span><span class=\"w\"> </span>was<span class=\"w\"> </span>renamed<span class=\"w\"> </span>to\n<span class=\"s1\">'Mathlib/Algebra/Notation/FiniteSupport.lean'</span><span class=\"w\"> </span><span class=\"o\">(</span>R089<span class=\"o\">)</span>,\nbut<span class=\"w\"> </span>the<span class=\"w\"> </span>similarity<span class=\"w\"> </span><span class=\"m\">89</span>%<span class=\"w\"> </span>is<span class=\"w\"> </span>less<span class=\"w\"> </span>than<span class=\"w\"> </span>the<span class=\"w\"> </span>expected<span class=\"w\"> </span>threshold<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">100</span>%.\n<span class=\"w\">          </span>We<span class=\"w\"> </span>treat<span class=\"w\"> </span>this<span class=\"w\"> </span>file<span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>removal.\n\n<span class=\"s1\">'Mathlib/Algebra/Notation/Pi.lean'</span><span class=\"w\"> </span>was<span class=\"w\"> </span>renamed<span class=\"w\"> </span>to\n<span class=\"s1\">'Mathlib/Algebra/Notation/Pi/Defs.lean'</span><span class=\"w\"> </span><span class=\"o\">(</span>R080<span class=\"o\">)</span>,\nbut<span class=\"w\"> </span>the<span class=\"w\"> </span>similarity<span class=\"w\"> </span><span class=\"m\">80</span>%<span class=\"w\"> </span>is<span class=\"w\"> </span>less<span class=\"w\"> </span>than<span class=\"w\"> </span>the<span class=\"w\"> </span>expected<span class=\"w\"> </span>threshold<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">100</span>%.\n<span class=\"w\">          </span>We<span class=\"w\"> </span>treat<span class=\"w\"> </span>this<span class=\"w\"> </span>file<span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>removal.\n\n<span class=\"s1\">'Mathlib/LinearAlgebra/RootSystem/GeckConstruction.lean'</span><span class=\"w\"> </span>was<span class=\"w\"> </span>renamed<span class=\"w\"> </span>to\n<span class=\"s1\">'Mathlib/LinearAlgebra/RootSystem/GeckConstruction/Relations.lean'</span><span class=\"w\"> </span><span class=\"o\">(</span>R050<span class=\"o\">)</span>,\nbut<span class=\"w\"> </span>the<span class=\"w\"> </span>similarity<span class=\"w\"> </span><span class=\"m\">50</span>%<span class=\"w\"> </span>is<span class=\"w\"> </span>less<span class=\"w\"> </span>than<span class=\"w\"> </span>the<span class=\"w\"> </span>expected<span class=\"w\"> </span>threshold<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">100</span>%.\n<span class=\"w\">          </span>We<span class=\"w\"> </span>treat<span class=\"w\"> </span>this<span class=\"w\"> </span>file<span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>removal.\n\n<span class=\"s1\">'Mathlib/RingTheory/DedekindDomain/Ideal.lean'</span><span class=\"w\"> </span>was<span class=\"w\"> </span>renamed<span class=\"w\"> </span>to\n<span class=\"s1\">'Mathlib/RingTheory/DedekindDomain/Ideal/Lemmas.lean'</span><span class=\"w\"> </span><span class=\"o\">(</span>R060<span class=\"o\">)</span>,\nbut<span class=\"w\"> </span>the<span class=\"w\"> </span>similarity<span class=\"w\"> </span><span class=\"m\">60</span>%<span class=\"w\"> </span>is<span class=\"w\"> </span>less<span class=\"w\"> </span>than<span class=\"w\"> </span>the<span class=\"w\"> </span>expected<span class=\"w\"> </span>threshold<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"m\">100</span>%.\n<span class=\"w\">          </span>We<span class=\"w\"> </span>treat<span class=\"w\"> </span>this<span class=\"w\"> </span>file<span class=\"w\"> </span>as<span class=\"w\"> </span>a<span class=\"w\"> </span>removal.\n\n<span class=\"s1\">'Mathlib/Algebra/Group/FiniteSupport.lean'</span>\n</code></pre></div>",
        "id": 534519183,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755189093
    },
    {
        "content": "<p>Did someone fix <code>Projection</code> already?</p>",
        "id": 534520248,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755189280
    },
    {
        "content": "<p>Sorry, I copy-pasted the ones that were not classed as <em>renames</em>.  These are the removals in the last 600 commits.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>•<span class=\"w\"> </span><span class=\"c1\">#create_deprecated_module \"Mathlib/Analysis/InnerProductSpace/Projection.lean\"</span>\n\n•<span class=\"w\"> </span><span class=\"c1\">#create_deprecated_module \"Mathlib/Algebra/Notation/Pi.lean\"</span>\n\n•<span class=\"w\"> </span><span class=\"c1\">#create_deprecated_module \"Mathlib/RingTheory/DedekindDomain/Ideal.lean\"</span>\n\n•<span class=\"w\"> </span><span class=\"c1\">#create_deprecated_module \"Mathlib/CategoryTheory/Monoidal/Limits.lean\" rename_to</span>\n<span class=\"w\">    </span><span class=\"s2\">\"Mathlib/CategoryTheory/Monoidal/Limits/Basic.lean\"</span>\n\n•<span class=\"w\"> </span><span class=\"c1\">#create_deprecated_module \"Mathlib/Algebra/Group/FiniteSupport.lean\"</span>\n</code></pre></div>",
        "id": 534521429,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755189602
    },
    {
        "content": "<p>Is the script detecting renames based on the git history?</p>",
        "id": 534526287,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755191466
    },
    {
        "content": "<p>Yes, in fact, it reads what git thinks the percentage of a change being a rename and acts accordingly.</p>",
        "id": 534526489,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755191534
    },
    {
        "content": "<p>I set the threshold for \"counts as a rename\" to be \"100%\", but this was just me trying to be conservative.</p>",
        "id": 534526588,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755191566
    },
    {
        "content": "<p>Basically, the script is a way of getting Lean to read off the appropriate git commands to figure out which files existed in the past, no longer exist now and whether they should be considered files that were removed or files that were renamed.</p>",
        "id": 534526928,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755191681
    },
    {
        "content": "<p>Based on this data, then the command can write the deprecated module accordingly: copy the imports for a removed file, import the renamed module for a rename.</p>",
        "id": 534526930,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755191683
    },
    {
        "content": "<p>I tried to make the command already have a clear \"suggestion\" of what to do, since it is my intention to use this in a completely automated way.  However, before getting there, I wanted to have something where you could confirm that simply clicking through the suggestion consistently produced the correct output, before automating the \"click the unique suggestion\" and stick it into CI.</p>",
        "id": 534527484,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755191882
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/28417\">#28417</a> deprecates <code>Projection</code></p>",
        "id": 534530099,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755192845
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Per your GitHub comment:</p>\n<blockquote>\n<p>You went for making it import the files into which the removed file was scattered, rather than the direct imports of the original file itself. While this is certainly a good choice, I wonder how to make the <code>deprecated_module</code> automation pick this up. The script would have used the imports of the deleted file.</p>\n</blockquote>\n<p>I'm not sure why using the direct imports of the original file would make any sense (no offense intended here). Indeed, suppose the file <code>Bar.lean</code> is split into two files <code>Bar1.lean</code> and <code>Bar2.lean</code>, and the original imports of <code>Bar.lean</code> consists of only<code>Foo.lean</code>. Then any downstream user who had been importing <code>Bar.lean</code> for some declaration <code>bar</code> in that file will still be left with \"unknown identifier <code>bar</code>\". Sure, they'll also get \"<code>Bar.lean</code> is deprecated\", but replacing it with <code>Foo.lean</code> won't help and they'll be stuck without hunting through the git history.</p>",
        "id": 534534200,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755194418
    },
    {
        "content": "<p>As for how to pick this up automatically: maybe if git detects that the file is not a rename but a deletion, then the command suggests all other files edited in that commit (with a diff of more than 5, number TBD, lines to avoid import changes to other random files in the original commit)?</p>",
        "id": 534534698,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1755194586
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/28423\">#28423</a> add the deprecation notice to <code>Mathlib/CategoryTheory/Monoidal/Limits.lean</code>.</p>",
        "id": 534541215,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1755197285
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> pointed out in <a href=\"https://github.com/leanprover-community/mathlib4/pull/28948#issuecomment-3242065852\">a comment</a> that <a href=\"https://github.com/leanprover-community/mathlib4/pull/28948\">#28948</a> moved several files and there was no follow-up deprecation PR. I suspect that this particular case may just be a case of bad timing, since <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> is now on vacation, but maybe we should try and push again to the automation for this working? I should have some time in a day or two if we need some more bots written, etc. It looks like <a href=\"https://github.com/leanprover-community/mathlib4/pull/24917\">#24917</a> is now on <code>awaiting-author</code>, but does it still need a review?</p>",
        "id": 537101034,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1756730093
    },
    {
        "content": "<p>I will take a look now at the PR.</p>",
        "id": 537101254,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730162
    },
    {
        "content": "<p>The PR makes module deprecation \"semi-automatic\": with very little input, it guides through the creation of a deprecated module.</p>",
        "id": 537101510,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730239
    },
    {
        "content": "<p>Making it fully automatic would not be hard (and was the initial goal), but it is not easy to get the deprecation command right, so I wanted to make it \"supervised\" for a bit, so that bugs and issues could be ironed out, before integrating it into CI.</p>",
        "id": 537101622,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730271
    },
    {
        "content": "<p>Ok, having reviewed the unresolved comments, they do not seem to me as bug reports.</p>",
        "id": 537102109,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730435
    },
    {
        "content": "<p>I think that testing this semi-automation would be easier if the command were in mathlib.</p>",
        "id": 537102193,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730463
    },
    {
        "content": "<p>Moreover, the command needs to be called by a human, as it currently does nothing completely autonomously.</p>",
        "id": 537102449,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730540
    },
    {
        "content": "<p>Let me see what it would suggest for the missing deprecations from <a href=\"https://github.com/leanprover-community/mathlib4/pull/28948\">#28948</a>.</p>",
        "id": 537102590,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756730587
    },
    {
        "content": "<p>OK, I'm about to head out for a bit so I have delegated with the understanding that this will probably evolve after more testing / integration with automation.</p>",
        "id": 537103894,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1756731011
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29209\">#29209</a> is the deprecating PR.  I on purpose had as little input as possible into generating it.</p>",
        "id": 537110857,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756733301
    },
    {
        "content": "<p>If it looks correct, I'll add some documentation to the deprecating automation and will merge that PR!  <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 537110975,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756733334
    },
    {
        "content": "<p>Thanks so much Damiano!</p>",
        "id": 537118102,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756735765
    },
    {
        "content": "<p>To add my two cents: <a href=\"https://github.com/leanprover-community/mathlib4/pull/2491\">#2491</a> had basically looked good to me: the remaining points were nits/requests for documentation, and there was one bug that would sometimes make the command do the wrong thing. Iterating on this in-tree is fine with me.</p>",
        "id": 537123837,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756737610
    },
    {
        "content": "<p>I'd rather have this automation at all than having to manually enact it :-)</p>",
        "id": 537123889,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756737625
    },
    {
        "content": "<p>I added the deprecations for the files from <a href=\"https://github.com/leanprover-community/mathlib4/pull/28909\">#28909</a> to <a href=\"https://github.com/leanprover-community/mathlib4/pull/29209\">#29209</a>.  This uncovered a bug in the old program that I fixed.  If someone can confirm that the deprecations are correct (or at least look reasonable), then I will go ahead and merge the (fixed up) script.</p>",
        "id": 537131177,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756740000
    },
    {
        "content": "<p>Kevin, the module deprecations have now been merged: let me know if there are some further issues!</p>",
        "id": 537409995,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756881726
    },
    {
        "content": "<p>I also created <a href=\"https://github.com/leanprover-community/mathlib4/pull/29293\">#29293</a> semi-automatically, adding deprecations for module changes arising from the last 50 commits.</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29263\">#29263</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/29267\">#29267</a>: <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> I see that you already prepared <a href=\"https://github.com/leanprover-community/mathlib4/pull/29264\">#29264</a>, so this is a great opportunity to see how the automated deprecation compares to the manual one!</p>\n</li>\n<li>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25790\">#25790</a>: <span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> does the deprecation in the PR above look correct to you?</p>\n</li>\n</ul>",
        "id": 537419778,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756885994
    },
    {
        "content": "<p>Ultimately, these PRs should be generated entirely automatically, but right now, I am still testing the process manually, to make sure that we can trust a bot to do it!  <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 537419888,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756886036
    },
    {
        "content": "<p>sorry, I didn't see this and I already merged my deprecation PRs.</p>",
        "id": 537511838,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756916224
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> I don't think <a href=\"https://github.com/leanprover-community/mathlib4/pull/25790\">#25790</a> is the correct PR. Did you mean <a href=\"https://github.com/leanprover-community/mathlib4/pull/29125\">#29125</a> ?</p>",
        "id": 537512581,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756916471
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29293\">#29293</a> looks correct to me (for all the deprecations, not just mine).</p>",
        "id": 537512750,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756916532
    },
    {
        "content": "<p>Once <a href=\"https://github.com/leanprover-community/mathlib4/pull/29323\">#29323</a> is merged you'll have another testbed for your script.</p>",
        "id": 537516673,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756917783
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> where is the branch with the <code>#create_deprecated_module</code> command? I couldn't find it.</p>",
        "id": 537547823,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756930593
    },
    {
        "content": "<p>The command is on master now: scripts/create_deprecated_module` or something like that.</p>",
        "id": 537548472,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756930790
    },
    {
        "content": "<p>(I'm on mobile)</p>",
        "id": 537548488,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1756930798
    },
    {
        "content": "<p>oh I see, thanks!</p>",
        "id": 537550919,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756931836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/517607506\">said</a>:</p>\n<blockquote>\n<p>I've just seen a strong reason to do this in a separate PR; if you don't the conflicts downstream are not automatically resolved</p>\n</blockquote>\n<p>It looks like I may have overestimated git here; I think to actually benefit from this data, you need to first merge the commit just before the <code>deprecated_module</code>s were added, then merge master</p>",
        "id": 537565204,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756940517
    },
    {
        "content": "<p>(in that, I have a datapoint where a direct merge of master fails, but a merge of <code>some_deprecated_module_sha^</code> then <code>master</code> works)</p>",
        "id": 537565266,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756940560
    },
    {
        "content": "<p>So either we should encourage the use of <code>git imerge</code>, or we should batch up all the deprecated module creation to do just once a month, so it's easy to just merge those commits</p>",
        "id": 537565323,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756940606
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2300</span><span class=\"bp\">/</span><span class=\"mi\">2314</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Norm</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 539545664,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1757939897
    },
    {
        "content": "<p>A missing module deprecation, I guess?</p>",
        "id": 539547661,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757940424
    },
    {
        "content": "<p>Indeed (again)</p>",
        "id": 539547724,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1757940440
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29672\">#29672</a></p>",
        "id": 539548216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1757940569
    },
    {
        "content": "<p>Once again, an almost auto-generated PR.  I was only guiding the deprecations by telling it which of the files that have been removed recently should have been deprecated (and I aimed for the ones in the PR that removed the ones that Ruben discovered).</p>",
        "id": 539548434,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1757940631
    },
    {
        "content": "<p>I have not even looked at the autogenerated files before making the PR!</p>",
        "id": 539548574,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1757940667
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, should we move the 4.23.0 tag to point after Damiano's PR?</p>",
        "id": 539549547,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757940858
    },
    {
        "content": "<p>Or is it too late once the tag is created? (It's certainly too late once the bors'd <a href=\"https://github.com/leanprover-community/mathlib4/pull/29671\">#29671</a> lands)</p>",
        "id": 539549664,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757940881
    },
    {
        "content": "<p>(As in the past, I had forgotten about running <code>mk_all</code>. <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span>)</p>",
        "id": 539549792,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1757940905
    },
    {
        "content": "<p>Couldn't we cherry-pick Damiano's commit onto the 4.23.0 tag, or have we promised somewhere that it's always a commit on <code>master</code>?</p>",
        "id": 539550526,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1757941044
    },
    {
        "content": "<p>I think the bigger question is whether we've promised that 4.23.0 doesn't move</p>",
        "id": 539550724,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757941083
    },
    {
        "content": "<p>Isn't this kind of thing what the third digit is for?</p>",
        "id": 539564781,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757944324
    },
    {
        "content": "<p>Oh no, it needs to match Lean, nevermind.</p>",
        "id": 539565225,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757944427
    },
    {
        "content": "<p>Whatever the answer is re: the 4.23.0 tag (and 4.x.y tags in general), we really need to document it <a href=\"https://leanprover-community.github.io/contribute/tags_and_branches.html\">here</a>; and possibly the README too.</p>",
        "id": 539565605,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1757944526
    },
    {
        "content": "<p>In this case, it seems certainly too minor to warrant cherry-picking or moving the tag.</p>\n<p>We can discuss elsewhere future policy for modifying these tags.</p>",
        "id": 539681105,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1757997095
    },
    {
        "content": "<p>Note to self for next month:</p>\n<ol>\n<li>Check out master and get cache</li>\n<li>Run <code>git rev-list v4.X.0... | wc -l</code> (<code>X</code> is the number from <code>lean-toolchain</code> minus one)</li>\n<li>Copy the number to <code>scripts/create_deprecated_modules.lean:374</code></li>\n<li>Apply the suggestions on <code>#find_deleted_files</code></li>\n<li>Apply the suggestions on each of the <code>#create_deprecated_module</code> commands</li>\n<li>Create a new git branch and manually <code>git add</code> each of the created files</li>\n<li>For each added file, look up the commit where it was removed and check if the imports from the command make sense, and fix if needed</li>\n<li>Run <code>mk_all</code></li>\n<li>Run <code>lake build</code></li>\n<li>commit, push and make pr</li>\n</ol>",
        "id": 563298741,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765494971
    },
    {
        "content": "<p>Step 8 is also done on CI: if you forget to make something a module, <code>lake build</code> will fail (as <code>Mathlib.lean</code> cannot import non-modules)</p>",
        "id": 563298844,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765495037
    },
    {
        "content": "<p>Okay, but then I need step 11: wait for ci :)</p>",
        "id": 563298910,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765495095
    },
    {
        "content": "<p>Sure - you get to pick your poison.</p>",
        "id": 563298927,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765495112
    },
    {
        "content": "<p>Which I need anyway</p>",
        "id": 563298941,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765495118
    },
    {
        "content": "<p>Though: can you <code>lake build</code> locally? Hopefully, these are only new files which should be quick to import, right?</p>",
        "id": 563298960,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765495137
    },
    {
        "content": "<p>(Assuming you have full cache for mathlib, of course.)</p>",
        "id": 563298969,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765495145
    },
    {
        "content": "<p>Yeah, good point</p>",
        "id": 563299125,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765495259
    },
    {
        "content": "<p>Ruben, thank you very much for this!</p>\n<p>I am really grateful that you worked this out, so that now there is a concrete suggestion for further automation!</p>",
        "id": 563591652,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1765600064
    },
    {
        "content": "<p>That would be ideal :)</p>",
        "id": 563614191,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1765626360
    },
    {
        "content": "<p>Let me add step 0: try to make <code>create_deprecated_modules.lean</code>, because apparently we don't build it in ci</p>",
        "id": 568686557,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768763068
    },
    {
        "content": "<p>And step 4.5: remove the files that were removed because they were deprecated &gt;6 months ago</p>",
        "id": 568687313,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768763946
    },
    {
        "content": "<p>And somewhere: add <code>module</code> headers to the generated files</p>",
        "id": 568692437,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768768607
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113488-general/topic/deprecated_module/near/568686557\">said</a>:</p>\n<blockquote>\n<p>Let me add step 0: try to make <code>create_deprecated_modules.lean</code>, because apparently we don't build it in ci</p>\n</blockquote>\n<p>Opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/34131\">#34131</a> with a wip</p>",
        "id": 568779786,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1768822340
    }
]