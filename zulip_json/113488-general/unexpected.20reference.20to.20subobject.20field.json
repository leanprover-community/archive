[
    {
        "content": "<p>Hello,<br>\ntake a look at this (extremely contrived) MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\">  </span><span class=\"n\">toTest1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">new_field</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n</code></pre></div>\n<p>I have a structure Test1 with some field. My new struture Test2 extends Test1 with some other field (which determines the field of Test1). I want to set Test1.field = new_field for every instance of Test2., but with this code I get the error: <code>unexpected reference to subobject field 'Test1'</code>. What am I doing wrong here? (Or is my goal fundamentally wrong?)</p>",
        "id": 491858064,
        "sender_full_name": "Christian K",
        "timestamp": 1735979068
    },
    {
        "content": "<p>two things: if you use the <code>:=</code> notation inside a <code>structure</code> <em>definition</em>, you're only providing a <em>default value</em>. second thing: if you want to specify the default for the original structure, use <code>field := new_field</code></p>",
        "id": 491858765,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735979792
    },
    {
        "content": "<p>Ohh ok, that makes sense. Am I able to force the value of field to be new_field for every instance of Test2 (without adding h : field = new_field to Test2)?</p>",
        "id": 491858867,
        "sender_full_name": "Christian K",
        "timestamp": 1735979926
    },
    {
        "content": "<p>yes, if you don't change the name of the field.</p>",
        "id": 491858885,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735979946
    },
    {
        "content": "<p>I don't think I fully understand this yet... </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\">  </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">new_field</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n</code></pre></div>\n<p><a href=\"http://Test2.mk\">Test2.mk</a> looks like this:  <a href=\"http://Test2.mk\">Test2.mk</a> (toTest1 : Test1) (new_field : ℕ) : Test2 <br>\nWhy does it still an instance of Test1 (even though I assigned field:=new_field)?</p>",
        "id": 491859249,
        "sender_full_name": "Christian K",
        "timestamp": 1735980293
    },
    {
        "content": "<p>because, like i said, it is only a default value.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"c1\">-- 0</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n</code></pre></div>",
        "id": 491859513,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735980529
    },
    {
        "content": "<p>Ahh, ok, I get it now. So would have to do something like this if i want to force field = new_field for every Test2 (or is there a better way?):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\">  </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">new_field</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">new_field</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"bp\">.</span><span class=\"n\">mk'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 491859747,
        "sender_full_name": "Christian K",
        "timestamp": 1735980771
    },
    {
        "content": "<p>in order to not have this be an issue, you could define it as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Option1</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Test1</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"bp\">.</span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">Test2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">field</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Option1</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Option2</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">new_field</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Test2</span><span class=\"bp\">.</span><span class=\"n\">toTest1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">Test2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Test1</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">new_field</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Option2</span>\n</code></pre></div>",
        "id": 491859749,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735980772
    },
    {
        "content": "<p>what is your use case, btw?</p>",
        "id": 491859783,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735980838
    },
    {
        "content": "<p>I have defined Sublocals on a Local E as a structure (= Test1). (The sublocal structure contains the corresponding Nucleus). Now I want to define a new structure for the open sublocals on E (= Test 2). These Open sublocals correspond exactly to the elements of E (so they get a new_field with their corresponding element). But this element e completely determines the Nucleus of the Open sublocal, so it has to be equal to some function of e.</p>",
        "id": 491860027,
        "sender_full_name": "Christian K",
        "timestamp": 1735981071
    },
    {
        "content": "<p>Thank you for your responses btw, I think the second one is the most suitable for my usecase.</p>",
        "id": 491860134,
        "sender_full_name": "Christian K",
        "timestamp": 1735981171
    },
    {
        "content": "<p>is it complicated to compute the element <code>e</code> from the other fields? if not, that can just be a custom projection...</p>",
        "id": 491860225,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735981244
    },
    {
        "content": "<p>i.e. use a variant of option 1</p>",
        "id": 491860313,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1735981323
    },
    {
        "content": "<p>I don't know of a way to compute the element ´e´ from a nucleus, I don't think it is possible. (It would make things  a lot easier though...)</p>",
        "id": 491860372,
        "sender_full_name": "Christian K",
        "timestamp": 1735981355
    }
]