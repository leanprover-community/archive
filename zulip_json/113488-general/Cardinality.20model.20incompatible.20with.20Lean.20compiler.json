[
    {
        "content": "<p>Something funny I figured out, the axiom <code>α ≃ β → α = β</code> is incompatible with <code>native_decide</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">equiv_of_eq</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mk_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟦</span><span class=\"mi\">0</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">1</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">equivNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">⟧</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">inductionOn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">recOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">equiv_of_eq</span><span class=\"w\"> </span><span class=\"n\">equivNat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">0</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">1</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span>\n\n<span class=\"c1\">-- 'contradiction' depends on axioms: [equiv_of_eq, propext, Lean.ofReduceBool, Quot.sound]</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n</code></pre></div>\n<p>This is pretty inconsequential all things considered; there's easier ways to prove <code>False</code> using <code>native_decide</code> (e.g. bad <code>implemented_by</code> tags). But I guess this one more pitfall with compiled Lean to be aware of.</p>",
        "id": 501673961,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1740439964
    },
    {
        "content": "<p>Relating to this: are we absolutely sure <code>cast</code> can't be used for evil in \"core\" Lean? Even if that's just crashing the VM through a bad <code>#eval</code>. Do we always know that equal types must have the exact same VM representation?</p>",
        "id": 501674428,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1740440120
    },
    {
        "content": "<p>we get that property from the other extremal model, where you tag all types so that different inductives are distinct</p>",
        "id": 501680681,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740442792
    },
    {
        "content": "<p>in that model, equality of types implies that they have the same construction, although there are some fun exceptions to this rule involving the inductive types which are not injective by cantor's theorem</p>",
        "id": 501680873,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740442893
    },
    {
        "content": "<p>But a full answer to this question involves proving the correctness of type erasure, a la <a href=\"https://inria.hal.science/hal-04077552v2/document\">this paper</a></p>",
        "id": 501681081,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1740442992
    },
    {
        "content": "<p>having fun</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Logic</span><span class=\"bp\">.</span><span class=\"n\">Small</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mk_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟦</span><span class=\"mi\">0</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">1</span><span class=\"bp\">⟧</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">equivNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">⟧</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">inductionOn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">recOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"n\">eq_of_equiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Small</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Small</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Shrink</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">propext</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">Nonempty</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hu</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Nat'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"n\">eq_of_equiv</span><span class=\"w\"> </span><span class=\"n\">equivNat</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">equivShrink</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">equivShrink</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">0</span><span class=\"bp\">⟧</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">≠</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">equivShrink</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">castNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">equivShrink</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">⟦</span><span class=\"mi\">1</span><span class=\"bp\">⟧</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> 'contradiction' depends on axioms:</span>\n<span class=\"cm\">[propext, Classical.choice, Lean.ofReduceBool, Lean.trustCompiler, Quot.sound] -/</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n</code></pre></div>",
        "id": 538013012,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757173726
    },
    {
        "content": "<p>see the <code>implemented_by</code> which makes this happen,<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/5123e3ed3fb8a3d1c4393ebe5ef8fbf543d8aa1a/Mathlib/Logic/Small/Defs.lean#L44-L55\">https://github.com/leanprover-community/mathlib4/blob/5123e3ed3fb8a3d1c4393ebe5ef8fbf543d8aa1a/Mathlib/Logic/Small/Defs.lean#L44-L55</a></p>",
        "id": 538013133,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757173826
    },
    {
        "content": "<p>What should be my takeaway from the example above? I was previously told that I can't trust <code>native_decide</code> because it can be affected by external plugins, but that left me impression that within the boundary of a controlled set of dependencies (lean core &amp; mathlib) it is fairly correct. But this one implies a different story</p>",
        "id": 538013595,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757174362
    },
    {
        "content": "<p>the takeaway is that for <code>equivShrinkImpl</code> to be sound we need to make <code>Shrink</code> opaque</p>",
        "id": 538013630,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757174402
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/501681081\">said</a>:</p>\n<blockquote>\n<p>But a full answer to this question involves proving the correctness of type erasure, a la <a href=\"https://inria.hal.science/hal-04077552v2/document\">this paper</a></p>\n</blockquote>\n<p>Would proving type erasure correct actually answer the question of which axioms consistent with Lean's type theory are also consistent with the \"model\" provided by Lean's compiler?</p>",
        "id": 538014284,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1757175051
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538013133\">said</a>:</p>\n<blockquote>\n<p>see the <code>implemented_by</code> which makes this happen,<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/5123e3ed3fb8a3d1c4393ebe5ef8fbf543d8aa1a/Mathlib/Logic/Small/Defs.lean#L44-L55\">https://github.com/leanprover-community/mathlib4/blob/5123e3ed3fb8a3d1c4393ebe5ef8fbf543d8aa1a/Mathlib/Logic/Small/Defs.lean#L44-L55</a></p>\n</blockquote>\n<p>There is probably some value in having <code>native_decide</code> distinguish between <code>implemented_by</code>/<code>extern</code>/<code>unsafe</code>/etc. decls in Lean's core libraries (maybe even just <code>Init</code>) and those outside of it, then only allowing the use of the former by default without additional options (possibly including an option to print the ones that were actually used).</p>",
        "id": 538014636,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1757175347
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538013630\">said</a>:</p>\n<blockquote>\n<p>the takeaway is that for <code>equivShrinkImpl</code> to be sound we need to make <code>Shrink</code> opaque</p>\n</blockquote>\n<p>Or rather, a sigma type combining <code>Shrink</code> and the <code>Equiv</code>?</p>",
        "id": 538017542,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757178463
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538017542\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538013630\">said</a>:</p>\n<blockquote>\n<p>the takeaway is that for <code>equivShrinkImpl</code> to be sound we need to make <code>Shrink</code> opaque</p>\n</blockquote>\n<p>Or rather, a sigma type combining <code>Shrink</code> and the <code>Equiv</code>?</p>\n</blockquote>\n<p>of course, otherwise we wouldn't be able to get the <code>Equiv</code></p>",
        "id": 538017896,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757178830
    },
    {
        "content": "<p>Another example showing the compiler's incompatibility with the cardinality model is redefining <code>Nat</code> by copying its definition as an inductive. The compiler's special representation for <code>Nat</code> will not be used for your own type. IIRC Idris will use the builtin <code>Nat</code> representation for any type that looks close enough to <code>Nat</code> (and we could do this too), but this will never solve the incompatibility, since you can e.g. always add a field whose size depends on whether FLT is true.</p>",
        "id": 538039009,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1757202595
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538013630\">said</a>:</p>\n<blockquote>\n<p>the takeaway is that for <code>equivShrinkImpl</code> to be sound we need to make <code>Shrink</code> opaque</p>\n</blockquote>\n<p>Is this something we should PR?</p>",
        "id": 538041519,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1757206128
    },
    {
        "content": "<p>Yeah, probably. Might also be good to make <code>Shrink</code> a <code>structure</code> at the same time, for good measure :-)</p>",
        "id": 538041625,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757206275
    },
    {
        "content": "<p>I would be happier about removing this implemented_by from Mathlib.</p>",
        "id": 538069491,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1757241547
    },
    {
        "content": "<p>Hmm you're right, this is the only occurrence of <code>implemented_by</code> in mathlib that's not on an <code>opaque</code>. The way I see it, we only need <code>implemented_by</code> here because of a missing feature (notably <a href=\"https://github.com/leanprover/lean4/pull/9508\">lean4#9508</a>), so the <code>implemented_by</code> will go away eventually. In the meantime we can probably use <code>opaque</code> to fix the problem <em>or</em> leave it to anyone needing it to implement it themselves.</p>",
        "id": 538084164,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757256303
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/538069491\">said</a>:</p>\n<blockquote>\n<p>I would be happier about removing this implemented_by from Mathlib.</p>\n</blockquote>\n<p>I would be happier if Mathlib had <em>no</em> uses of <code>implemented_by</code>. Between adding missing <code>csimp</code>s, improved compiler performance, and new features, how realistic is this future?</p>",
        "id": 538085375,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1757257551
    },
    {
        "content": "<p>I only see 4 <code>implemented_by</code> by code search, so I guess... not far away?</p>",
        "id": 538085651,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757257818
    },
    {
        "content": "<p>To me it looks like this:</p>\n<ul>\n<li><code>equivShrink</code> in <code>Mathlib/Logic/Small/Defs.lean</code>. This will be solved by <a href=\"https://github.com/leanprover-community/mathlib4/pull/9508\">#9508</a>, which should happen next quarter (because it's needed to make a good <code>Iterator</code> API).</li>\n<li><code>memoFix</code> in <code>Mathlib/Util/MemoFix.lean</code>. The real problem here is the use of very unsafe <code>unsafe</code> code (which also uses <code>unsafeBaseIO</code>), although its usage is restricted to tactics. It's only used by <code>Mathlib/Lean/Expr/ReplaceRec.lean</code>, but I don't see a way to do this with safe code without slightly changing the interface.</li>\n<li><code>Float.valUnsafe</code> and <code>Float.mkUnsafe</code> in <code>Mathlib/Util/CompileInductive.lean</code>. The compiler will support recursors for arbitrary inductives soonish, so this file will just be deleted.</li>\n</ul>",
        "id": 538086067,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1757258317
    },
    {
        "content": "<blockquote>\n<p>chore: Revert \"feat: computable shrink (<a href=\"https://github.com/leanprover-community/mathlib4/pull/28112\">#28112</a>)\" <a href=\"https://github.com/leanprover-community/mathlib4/pull/29419\">#29419</a></p>\n</blockquote>\n<p>reverts the change introducing this most recent invalid <code>implemented_by</code>.</p>",
        "id": 538117986,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1757294158
    },
    {
        "content": "<p>(<a href=\"https://github.com/leanprover/lean4/pull/9508\">lean4#9508</a> is the right link for Cameron's message)</p>",
        "id": 538119736,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757296279
    },
    {
        "content": "<p>May I ask why <code>Shrink</code> can still be computable, while its definition uses <code>Classical.choose</code>?</p>",
        "id": 538246530,
        "sender_full_name": "Dexin Zhang",
        "timestamp": 1757342912
    },
    {
        "content": "<p>Well, the definition couldn't be computable in its current state (as figured out in this thread) but if <code>Shrink</code> would be opaque then it is fine to assert certain things about its runtime behavior, in particular you can assume it that <code>Shrink alpha</code> has the same runtime representation as <code>alpha</code></p>",
        "id": 538250054,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757343794
    },
    {
        "content": "<p>And after <a href=\"https://github.com/leanprover/lean4/pull/9508\">lean4#9508</a>, you could use <code>Classical.choose</code> but you wouldn't use the constructor / projection but instead an autogenerated function to convert between <code>Shrink alpha</code> and <code>alpha</code> like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">def_type_with_rep</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Small</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">absType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">equiv_small</span><span class=\"bp\">.</span><span class=\"n\">choose</span>\n<span class=\"w\">  </span><span class=\"n\">repType</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">toRep</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">equiv_small</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"bp\">.</span><span class=\"n\">invFun</span>\n<span class=\"w\">  </span><span class=\"n\">fromRep</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">equiv_small</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"n\">fromRep_toRep</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">toRep_fromRep</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"n\">ofRep</span><span class=\"w\"> </span><span class=\"c1\">-- α -&gt; Small.{v} α</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Shrink</span><span class=\"bp\">.</span><span class=\"n\">rep</span><span class=\"w\"> </span><span class=\"c1\">-- Small.{v} α -&gt; α</span>\n</code></pre></div>",
        "id": 538253577,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757344601
    },
    {
        "content": "<p>But <code>Shrink</code> as a function returns <code>Type</code> is indeed computable even after <a href=\"https://github.com/leanprover-community/mathlib4/pull/29419\">#29419</a>... Do you mean we can write <code>Shrink</code> computably, but can never computably construct an element of it?</p>",
        "id": 538258173,
        "sender_full_name": "Dexin Zhang",
        "timestamp": 1757345568
    },
    {
        "content": "<p>Computability of <code>Shrink</code> itself is not a concern; types are irrelevant in Lean; the question is whether you'd be able to create a value <code>Shrink α</code> from a value of <code>α</code>. This is possible with an <code>@[implemented_by]</code> and should be possible without after some variant of <a href=\"https://github.com/leanprover/lean4/pull/9508\">lean4#9508</a> has been implemented.</p>",
        "id": 538258702,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757345688
    },
    {
        "content": "<p>I see. So functions returning <code>Type</code>s (like <code>Shrink</code>) are actually erased in runtime?</p>",
        "id": 538259682,
        "sender_full_name": "Dexin Zhang",
        "timestamp": 1757345980
    },
    {
        "content": "<p>Hi sorry for introducing this instance of False through native decide <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span>. I was wondering though how would the new proposal override_repr solve this? I tried just skimming the gh thread but I couldn’t find an example. Could someone link me this? It would just be really nice to see because it would be super useful for coinductives through QPF</p>",
        "id": 541879629,
        "sender_full_name": "William Sørensen",
        "timestamp": 1759053081
    },
    {
        "content": "<p>Wait lol i am completely blind. Ok I see now how it would be implemented. Do we know if / when this is planned to be added to lean?</p>",
        "id": 541880862,
        "sender_full_name": "William Sørensen",
        "timestamp": 1759054486
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/501680873\">said</a>:</p>\n<blockquote>\n<p>in that model, equality of types implies that they have the same construction, although there are some fun exceptions to this rule involving the inductive types which are not injective by cantor's theorem</p>\n</blockquote>\n<p>Is there a reference that talks about this failure of injectivity for inductive types?</p>",
        "id": 542344939,
        "sender_full_name": "James E Hanson",
        "timestamp": 1759257652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Are.20parametric.20type.20constructors.20injective.3F/near/477729049\">said</a>:</p>\n<blockquote>\n<p>Here's an example:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">IsntInj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"n\">IsntInj</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">cantor_injective</span><span class=\"w\"> </span><span class=\"n\">IsntInj</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Here's an example</p>",
        "id": 542345469,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759257848
    },
    {
        "content": "<p>Huh! Lean is Ok with that inductive being in <code>Type</code> rather than <code>Type 1</code>?</p>",
        "id": 542540267,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759336779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/542540267\">said</a>:</p>\n<blockquote>\n<p>Huh! Lean is Ok with that inductive being in <code>Type</code> rather than <code>Type 1</code>?</p>\n</blockquote>\n<p>None of the constructors (of which there are none) make use of <code>f</code>, which is why I think this is allowed.</p>",
        "id": 542544659,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1759338313
    },
    {
        "content": "<p>Huh, </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<p>is also fine (I would have used <code>Type 37</code> but apparently such silly ideas are now banned).</p>",
        "id": 542573317,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1759349075
    },
    {
        "content": "<p>not banned, just needs a bit of work</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<p>or, if you actually want <code>37</code> we can do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxUniverseOffset</span><span class=\"w\"> </span><span class=\"mi\">255</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>",
        "id": 542573821,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759349248
    },
    {
        "content": "<p>I tried adding some constructors and it still works?</p>",
        "id": 542574558,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1759349542
    },
    {
        "content": "<p>Well, for something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>you could've also done</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">OtherThing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hello</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">OtherThing</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The parameters of the inductive simply aren't put into the universe restrictions because you can model them indirectly.</p>",
        "id": 542619474,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1759355693
    },
    {
        "content": "<p>Wait, why is the universe number capped now?</p>",
        "id": 542624044,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1759357906
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/542624044\">said</a>:</p>\n<blockquote>\n<p>Wait, why is the universe number capped now?</p>\n</blockquote>\n<p>It's not, see the <code>set_option maxUniverseOffset 255</code> above. <br>\nIt's just that universe levels are stored in unary, so something like <code>Type 1000000</code> creates a universe expression with a million <code>Level.succ</code>'s, so they are capped by default.</p>",
        "id": 542624334,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1759358081
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Cardinality.20model.20incompatible.20with.20Lean.20compiler/near/542540267\">said</a>:</p>\n<blockquote>\n<p>Huh! Lean is Ok with that inductive being in <code>Type</code> rather than <code>Type 1</code>?</p>\n</blockquote>\n<p>Even if we are to take the universe level into account, it should be <code>Type</code> too. Notice that <code>List (A : Type) : Type</code> is valid, and <code>Type</code> is at the same universe level as <code>Type -&gt; Prop</code>. If we raise the universe level here we're basically in an ultra-predicative logic where most inductive constructions give you proper classes instead of sets.</p>",
        "id": 542861731,
        "sender_full_name": "Trebor Huang",
        "timestamp": 1759461874
    }
]