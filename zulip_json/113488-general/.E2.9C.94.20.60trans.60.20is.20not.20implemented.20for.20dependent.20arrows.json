[
    {
        "content": "<p>This is some need I came into recently. Basically, I have some hypothesis in the form of <code>∀ x, P x -&gt; Q x</code> and need to prove some goal of the form <code>∀ x, P x -&gt; Q' x</code>. To do so, I thought of writting a theorem which would allow me to conclude the proof by simply providing <code>Q' x -&gt; Q x</code> (which itself was an arithmetic goal I could close with <code>omega</code>).</p>\n<p>When writing the theorem I realized that this is in fact just the transitivity property of implication. I tried seeing if I could use <code>trans</code> (basically by doing something like <code>trans Q' &lt;;&gt; (first | assumption | omega)</code>). However, I got the following, rather specific, error (<a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOCmAHkuOvgBSCNwHAFxwAqAnmPgJR2AARHIQDTdwBqOAEY4APjgAGOAFoJhQXADM4qbQC8cLIxxw4MKEgB2AZzjkA7QIBMqya11wT0KIyA\">reproduced here</a>) </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"ss\">`trans</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">implemented</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">dependent</span><span class=\"w\"> </span><span class=\"n\">arrows</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>I was wondering if this was a hard limit at the time, or what prevents us from doing something like the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 501825434,
        "sender_full_name": "Ayhon",
        "timestamp": 1740495188
    },
    {
        "content": "<p>Please post a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 501880053,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740507102
    },
    {
        "content": "<p>That's what the link above my first code fence was for. Is anything missing there? Should I have copy-pasted that code in a code fence instead?</p>",
        "id": 501880302,
        "sender_full_name": "Ayhon",
        "timestamp": 1740507174
    },
    {
        "content": "<p>Here it is more explicitly (<a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOCmAHkuOvgBSCNwHAFxwAqAnmPgJR2AARHIQDTdwBqOAEY4APjgAGOAFoJhQXADM4qbQC8cLIxxw4MKEgB2AZzjkA7QIBMqya11wT0KIyA\">code</a>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The error happens on the <code>trans</code>.</p>",
        "id": 501880773,
        "sender_full_name": "Ayhon",
        "timestamp": 1740507334
    },
    {
        "content": "<p>E.g., you can <code>intro x; trans x+ 2 &gt; 0</code></p>",
        "id": 501881955,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740507768
    },
    {
        "content": "<p>Agreed. To clarify, I don't want to solve this particular example, but to know why we can't have \"dependent arrow\"s be usable through <code>trans</code>. Mainly because while experimenting I found this error message, which I felt was quite specific</p>",
        "id": 501882332,
        "sender_full_name": "Ayhon",
        "timestamp": 1740507916
    },
    {
        "content": "<p>Lean can't rewrite the goal as <code>(fun p q =&gt; forall x, p x -&gt; q x) (. + 1 &gt; 0) (. + 3 &gt; 0)</code> for you</p>",
        "id": 501882420,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740507951
    },
    {
        "content": "<p>It tries to unify the goal with <code> R x y </code> and fails</p>",
        "id": 501882583,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740508001
    },
    {
        "content": "<p>You can <code>change</code> the goal to the form above, then add a missing instance.</p>",
        "id": 501882677,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740508034
    },
    {
        "content": "<p>Hmm, so it's an issue with unification</p>",
        "id": 501882900,
        "sender_full_name": "Ayhon",
        "timestamp": 1740508102
    },
    {
        "content": "<p>But then my last line could be unified, no?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Perhaps I failed to implement <code>Trans</code> before, but it's actually doable if I hide the dependent arrow behind a definition</p>",
        "id": 501883327,
        "sender_full_name": "Ayhon",
        "timestamp": 1740508242
    },
    {
        "content": "<p>I'm pretty sure I was the one extending <code>trans</code> to work with (non-dependent) arrows at all (and not only trans. relations), and I remember that the decision to not think about dependent arrows was two-fold: For one I simple had no use for it, and I haven't thought about the dependent situation enough to really make sense of it.</p>\n<p>I don't think it's necessarily a hard limit, but I certainly don't remember what the conceptual difficulties were that made it not worth the effort.</p>",
        "id": 501930784,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1740526878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> <a href=\"#narrow/channel/113488-general/topic/.60trans.60.20is.20not.20implemented.20for.20dependent.20arrows/near/501883327\">said</a>:</p>\n<blockquote>\n<p>But then my last line could be unified, no?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Trans</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span><span class=\"mi\">0</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Perhaps I failed to implement <code>Trans</code> before, but it's actually doable if I hide the dependent arrow behind a definition</p>\n</blockquote>\n<p>This is not a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 501937211,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740530623
    },
    {
        "content": "<p>My guess (can't say more without a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>): <code>Trans.trans</code> tries to generate a <code>Trans</code> instance and fails.</p>",
        "id": 501937296,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740530658
    },
    {
        "content": "<p>Also, <code>Trans.trans</code> expects proofs, not types as arguments.</p>",
        "id": 501937956,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740531098
    },
    {
        "content": "<p>This instance works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsTrans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">hqr</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hqr</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>(not sure if <code>trans</code> or <code>calc</code> can somehow use it`</p>",
        "id": 501938048,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1740531129
    },
    {
        "content": "<p>(btw, this was the PR adding the error message from the original question: <a href=\"https://github.com/leanprover-community/mathlib4/pull/13719\">#13719</a>. Since then, the tactic has been upstreamed to <code>battteries</code>)</p>",
        "id": 501944868,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1740534900
    },
    {
        "content": "<p>Thank you all for your responses! I think my original question has been answered now.</p>",
        "id": 501989373,
        "sender_full_name": "Ayhon",
        "timestamp": 1740559247
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> has marked this topic as resolved.</p>",
        "id": 501989383,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740559252
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> has marked this topic as resolved.</p>",
        "id": 502005452,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740564113
    }
]