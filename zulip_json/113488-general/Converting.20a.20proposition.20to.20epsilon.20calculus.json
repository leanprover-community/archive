[
    {
        "content": "<p>I have a predicate, and I want to do some kind of skolemization on it using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Classical.epsilon#doc\">docs#Classical.epsilon</a>. As a concrete example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span>\n<span class=\"w\">  </span><span class=\"c1\">-- here I want to run some procedure on the above f1, to get a result like this:</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">epsilon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">epsilon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">f1</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"w\"> </span><span class=\"n\">d'</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">f1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">epsilon_spec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">c'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">d'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩⟩</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">epsilon_spec</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">clear_value</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">p : ℕ → ℕ → ℕ → ℕ → Prop</span>\n<span class=\"cm\">d c : ℕ → ℕ → ℕ</span>\n<span class=\"cm\">f1 : ℕ → ℕ → Prop := fun a b =&gt; p a b (c a b) (d a b)</span>\n<span class=\"cm\">hf : ∀ (a b c' d' : ℕ), p a b c' d' → f1 a b</span>\n<span class=\"cm\">⊢ False</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>\n<p>I assume there's no such tactic currently, although this does look similar to <code>choose</code>. Is there any easy way to do this (it should also be able to handle more quantifiers)? If not, does anybody have any suggestions for how to tweak <code>choose</code> to be able to do this?</p>",
        "id": 477244645,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729092628
    },
    {
        "content": "<p>I am not sure I understand. Shouldn't the first <code>let f1 (a b) := ∃ c d, p a b c d</code> be <code>have f1 (a b) : ∃ c d, p a b c d := sorry</code>?</p>",
        "id": 477246195,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729093105
    },
    {
        "content": "<p>Can you tell us what are the before and after contexts you want to see?</p>",
        "id": 477246363,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1729093178
    },
    {
        "content": "<p>The before isn't truly important — I have a predicate <code>p</code> and I want to introduce some functions <code>b_i b_{i+1} .. b_n</code> (using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Classical.epsilon#doc\">docs#Classical.epsilon</a>) such that <code>p a_1 a_2 a_3 .. a_n -&gt; p a_1 ... a_{i-1} (b_i a_1 ... a_{i-1}) (b_{i+1} a_1 ... a_{i-1}) .. (b_n a_1 ... a_{i-1})</code></p>",
        "id": 477250234,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729094382
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113488-general/topic/Converting.20a.20proposition.20to.20epsilon.20calculus/near/477246363\">said</a>:</p>\n<blockquote>\n<p>Can you tell us what are the before and after contexts you want to see?</p>\n</blockquote>\n<p>I'm assuming that the before is the state of the example before the code, and the after is the state in the comment at the end! My instinct was that <code>choose</code> would do this but I can't get it to work. Ironically I always think that the docstring for <code>choose</code> is poor because it only has one example which is quite complicated, but actually the example is very close to what seems to be wanted here.</p>",
        "id": 477275634,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729103325
    },
    {
        "content": "<p>Oh I see, Yael's comment is precisely that if one changes f1 to the thing that <code>choose</code> wants, then <code>choose</code> will work.</p>",
        "id": 477276072,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729103471
    },
    {
        "content": "<p><code>choose</code> takes a proof, while I want to skolemize the proposition directly, even if it's not true for all values</p>",
        "id": 477276653,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729103668
    },
    {
        "content": "<p>It would be pretty silly, but you could create a meta variable of your type, call choose on it, revert all the introduced hypotheses, then inferType</p>",
        "id": 477282260,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729105589
    },
    {
        "content": "<p>This might not work because <code>choose ... using f</code> seems to want <code>f</code> to be a proof</p>",
        "id": 477282592,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729105716
    },
    {
        "content": "<p>You can use <code>choose!</code> on <code>fun a b (h : ∃ c d, ...) =&gt; h</code></p>",
        "id": 477283469,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729106094
    },
    {
        "content": "<p>Provided that the types of <code>c</code> and <code>d</code> are nonempty.</p>",
        "id": 477283572,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729106139
    },
    {
        "content": "<p>Then you'll get <code>c d : Nat -&gt; Nat -&gt; Nat</code> and <code>H : ∀ a b, (∃ c d, p a b c d) → p a b (c a b) (c a d)</code>.</p>",
        "id": 477283721,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729106203
    },
    {
        "content": "<p>Possibly, we should add this trick to the docstring of <code>choose!</code>.</p>",
        "id": 477283813,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1729106248
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/stream/113488-general/topic/Converting.20a.20proposition.20to.20epsilon.20calculus/near/477283469\">said</a>:</p>\n<blockquote>\n<p>You can use <code>choose!</code> on <code>fun a b (h : ∃ c d, ...) =&gt; h</code></p>\n</blockquote>\n<p>Thanks!</p>",
        "id": 477324805,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729125564
    }
]