[
    {
        "content": "<p>I've been using Lean to build a library that helps you build factories in the Factorio game. I think it turned out pretty neat, and Lean turned out to be up to the task. A combination of good performance and features like dependent types and inline proofs have really been super nice! Thanks for all the help solving my <em>many</em> questions over the last couple of weeks. Really appreciate it :)</p>\n<p>The github repo is here: <a href=\"https://github.com/konne88/functorio\">https://github.com/konne88/functorio</a></p>\n<p>Here's an example of the kind of programs you can write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">redScience</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bus</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ironOre</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ironOre</span><span class=\"w\"> </span><span class=\"mi\">300</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">copperOre</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">copperOre</span><span class=\"w\"> </span><span class=\"mi\">150</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">iron</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Iron</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">makeIron</span><span class=\"w\"> </span><span class=\"n\">ironOre</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">copper</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Copper</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">makeCopper</span><span class=\"w\"> </span><span class=\"n\">copperOre</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">gear</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Gear</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">makeGear</span><span class=\"w\"> </span><span class=\"n\">iron</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">science</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RedScience</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">makeRedScience</span><span class=\"w\"> </span><span class=\"n\">copper</span><span class=\"w\"> </span><span class=\"n\">gear</span>\n</code></pre></div>\n<p>Which you can then export to a blueprint, and import into the game:</p>\n<p><a href=\"/user_uploads/3121/-CNATn21fCa95o2nQpqTs7qb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/-CNATn21fCa95o2nQpqTs7qb/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1976x1238\" src=\"/user_uploads/thumbnail/3121/-CNATn21fCa95o2nQpqTs7qb/image.png/840x560.webp\"></a></div><p>Thanks again for all the help along the way!</p>",
        "id": 535748268,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1755892968
    },
    {
        "content": "<p>I wish we could go the other way and prove theorems by playing factorio.</p>",
        "id": 535749023,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1755893274
    },
    {
        "content": "<p>Can you prove your factory correct in Functorio?</p>",
        "id": 535750668,
        "sender_full_name": "suhr",
        "timestamp": 1755894039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"394485\">@suhr</span> Yes! There are a couple of caveats, but if your factory type checks, it should mostly just work</p>",
        "id": 535751215,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1755894313
    },
    {
        "content": "<p>Probably the biggest thing you can do to build a broken factory that type checks is to use a BusLane multiple times. Lean should really add support for <em>linear types</em>, which would allow me to fix that :)</p>",
        "id": 535751685,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1755894584
    },
    {
        "content": "<p>You can build a model of linear logic in a similar way <a href=\"https://github.com/leanprover-community/iris-lean\">iris-lean</a> does for separation logic. It might be somewhat an overkill though.</p>",
        "id": 535752428,
        "sender_full_name": "suhr",
        "timestamp": 1755894946
    },
    {
        "content": "<p>I wonder how hard it would be to write a purely syntactic linter for linearity (it wouldn't give anything at the type level, but might still be useful, and would not have anything Functorio specific).</p>",
        "id": 535762435,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755900799
    },
    {
        "content": "<p>Without a model of linear logic in generality, you could surely upgrade your monads in some way to forbid at compile time overuse of resources.</p>",
        "id": 535762548,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755900885
    },
    {
        "content": "<p>Another feature that would be super nice. Let me register some tactic that Lean runs before printing a type. e.g. Lean prints the type of <code>busAssemblyLine .processingUnit 14</code> as <code>BusAssemblyLineType (getRecipe .processingUnit) 14</code>. It's impossible to tell from this why type checking fails. But if Lean could run some tactic like <code>simp!</code> it could print this, which makes it trivial to figure out what's going on:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">BusLane</span><span class=\"w\"> </span><span class=\"n\">Ingredient</span><span class=\"bp\">.</span><span class=\"n\">sulfuricAcid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">525</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"n\">BusLane</span><span class=\"w\"> </span><span class=\"n\">Ingredient</span><span class=\"bp\">.</span><span class=\"n\">electronicCircuit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"n\">BusLane</span><span class=\"w\"> </span><span class=\"n\">Ingredient</span><span class=\"bp\">.</span><span class=\"n\">advancedCircuit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">210</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"n\">Bus</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BusLane</span><span class=\"w\"> </span><span class=\"n\">Ingredient</span><span class=\"bp\">.</span><span class=\"n\">processingUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 535763332,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1755901491
    },
    {
        "content": "<p>Have you look at delaborators? You can customize pretty printing however you like!</p>",
        "id": 535766063,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755903674
    },
    {
        "content": "<p>The output of your program is really cool!<br>\nHow much of an input did you have to manually provide?</p>",
        "id": 536386142,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1756288825
    },
    {
        "content": "<p>Basically you just say how the resources flow, and how many assemblers you want of each kind, and Functorio generates the rest. Here is what you have to write for a 150 science per minute Nauvis factory:<br>\n<a href=\"https://github.com/konne88/functorio/blob/main/Nauvis150.lean\">https://github.com/konne88/functorio/blob/main/Nauvis150.lean</a></p>\n<p>And this is what you get:<br>\n<a href=\"/user_uploads/3121/y9XrMU7dyWuIctnvJ15DbMI5/Screenshot-2025-08-24-at-12.47.06PM.png\">Screenshot 2025-08-24 at 12.47.06 PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/y9XrMU7dyWuIctnvJ15DbMI5/Screenshot-2025-08-24-at-12.47.06PM.png\" title=\"Screenshot 2025-08-24 at 12.47.06 PM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2940x1908\" src=\"/user_uploads/thumbnail/3121/y9XrMU7dyWuIctnvJ15DbMI5/Screenshot-2025-08-24-at-12.47.06PM.png/840x560.webp\"></a></div>",
        "id": 536453903,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1756310833
    },
    {
        "content": "<p>Support for linear types would be great. It would turn all pain from threads like <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/FFI.2C.20Rust.20and.20mutability/with/504719516\">#lean4 &gt; FFI, Rust and mutability</a> into a non-issue.</p>",
        "id": 536464467,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1756314464
    }
]