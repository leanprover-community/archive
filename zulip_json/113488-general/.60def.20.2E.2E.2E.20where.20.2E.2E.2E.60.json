[
    {
        "content": "<p>Is there any explicit documentation for how precisely the syntax</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">   </span><span class=\"bp\">...</span>\n<span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>works? I've been trying to intuit it from examples, but there's some weird behavior around what things can see the definitions of things after the <code>where</code> I don't quite get, and trying to look into the code directly just gets me the somewhat impenetrable code for general declarations.</p>",
        "id": 531280347,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753681890
    },
    {
        "content": "<p>I tried checking the various references, but it's very hard to search for keywords as common as <code>def</code> and <code>where</code></p>",
        "id": 531280412,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753681923
    },
    {
        "content": "<p>It's syntax sugar for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rec</span>\n<span class=\"w\">    </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>This means the body of foo can refer to the where definitions, and the where definitions can refer to foo and each other.</p>",
        "id": 531281297,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753682382
    },
    {
        "content": "<p>Mm.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n<span class=\"w\">  </span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'α'</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"c1\">-- failed to synthesize Foo Unit</span>\n<span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 531282878,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753683041
    },
    {
        "content": "<p>It seems <code>let rec</code> doesn't add things to the context the way I expected it to, then</p>",
        "id": 531283084,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753683138
    },
    {
        "content": "<p>That explains some of my confusion, at least!</p>",
        "id": 531283095,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753683145
    },
    {
        "content": "<p>... It seems part of the issue is that I can't use let-rec definitions in the <em>types</em> of anything else?</p>",
        "id": 531283199,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1753683192
    },
    {
        "content": "<p>Yes, the types are elaborated first. Pretty much like in</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'α'</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>And I guess instance search doesn't want to introduce potentially recursive links?</p>",
        "id": 531289547,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753685975
    },
    {
        "content": "<p>Is this explicitly written anywhere in the manual? The syntaxt gets mentioned <a href=\"https://lean-lang.org/doc/reference/latest//Definitions/Definitions/#Lean___Parser___Command___declaration-next-next-next-next-next\">here</a> but I do not see any explanation like this. <br>\nIf not, who do we nag so that it gets properly documented?</p>",
        "id": 531293951,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1753687503
    },
    {
        "content": "<p>The \"Mutual block\" section works well as an explainer: <a href=\"https://lean-lang.org/doc/reference/latest//find/?domain=Verso.Genre.Manual.section&amp;name=mutual-syntax\">https://lean-lang.org/doc/reference/latest//find/?domain=Verso.Genre.Manual.section&amp;name=mutual-syntax</a></p>",
        "id": 531295097,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753687831
    },
    {
        "content": "<p>Basically everything there applies just as much to <code>let rec</code> and <code>def ... where</code></p>",
        "id": 531295158,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753687851
    },
    {
        "content": "<p>Thanks for the link! I think it still wouldn't hurt to add to the manual the fact that <code>def ... where</code> is same as <code>let rec</code> under the hood, otherwise you don't know where to look.</p>",
        "id": 531297972,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1753688712
    },
    {
        "content": "<p>There is:</p>\n<blockquote>\n<p>Local definitions introduced via <code>let rec</code> and <code>where</code> are lifted out of their context, introducing parameters for captured free variables as necessary, and treated as if they were separate definitions within the <a href=\"https://lean-lang.org/doc/reference/latest///Definitions/Recursive-Definitions/#Lean___Parser___Command___mutual\"><code>mutual</code></a> block as well</p>\n</blockquote>\n<p>But I guess it'd be nice to link from the <code>let rec</code> and <code>def ... where</code> syntax</p>",
        "id": 531298663,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753688925
    },
    {
        "content": "<p>Yes, I was meaning a link in the \"syntax\" block for <code>def ... where</code> that you're taken to when using the search bar, this is the location where you most probably expect information to be.</p>",
        "id": 531299030,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1753689032
    }
]