[
    {
        "content": "<p>In the following minimal working example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bool'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">false</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foe</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bool'</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"s2\">\"|\"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Foe</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"c1\">-- x : Foe := { a := 1, b := 1, h := ⋯ }</span>\n<span class=\"w\">  </span><span class=\"c1\">-- where ⋯ is Eq.refl (bool' 1 1) : bool' 1 1 = bool' 1 1</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>the type of <code>h</code> in <code>x</code> is <code>bool' 1 1 = bool' 1 1</code> as indicated, whereas I would expect it (and want it) to be <code>bool' 1 1 = true</code>. The code above does not give any errors.</p>\n<p>This seems to be a general consequence of filling in a proof in notation. Does anyone know what is going on here?</p>",
        "id": 462767413,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1723807718
    },
    {
        "content": "<p>Under these definitions, <code>bool' 1 1</code> and <code>true</code> are definitionally equal, so it's not changing the type. This seems like just a pretty-printing thing since you constructed the proof with reflexivity (<code>by rfl</code>).</p>",
        "id": 462774255,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1723810467
    },
    {
        "content": "<p>You can fix this with <code>(id &lt;| by rfl)</code> instead of <code>(by rfl)</code></p>",
        "id": 462775141,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723810855
    },
    {
        "content": "<p>Ok, thanks for your explanation <span class=\"user-mention\" data-user-id=\"228466\">@Chris Bailey</span> , and for your fix <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> .</p>",
        "id": 462775804,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1723811147
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> has marked this topic as resolved.</p>",
        "id": 462775815,
        "sender_full_name": "Notification Bot",
        "timestamp": 1723811152
    }
]