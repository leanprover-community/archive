[
    {
        "content": "<p>Is there a way to ensure that 'Array.set` return array of same size as mutated array? </p>\n<p>For example I want split <code>UInt32</code> onto 4 <code>UInt8</code> and store in the <code>Array UInt8</code>. I have to perform 4 calls to Array.Set and after first call, the returned array have <code>size</code> unrelated to original array. This I cannot precompute indexes and prove that I never write outside of bounds</p>",
        "id": 480001321,
        "sender_full_name": "Andrii Kurdiumov",
        "timestamp": 1730440824
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array.set#doc\">docs#Array.set</a></p>",
        "id": 480001518,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730440929
    },
    {
        "content": "<p><code>Array.set</code> doesn't change the size?</p>",
        "id": 480001540,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730440946
    },
    {
        "content": "<p>Honestly I don't know, and it's not clarified, but I would surprised if setting element at the specified index would change size somehow. It's relied on <code>List.set</code> which seems to be also preserve size</p>",
        "id": 480001854,
        "sender_full_name": "Andrii Kurdiumov",
        "timestamp": 1730441202
    },
    {
        "content": "<p>Sorry, I should have been clearer. It definitely does not change the size, I only wrote a question mark there because I was confused why you might think it does change the size. Apologies for that.</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array.size_set#doc\">docs#Array.size_set</a> will hopefully link to the relevant theorem!</p>",
        "id": 480002577,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730441736
    },
    {
        "content": "<p>Yeah. Thank, you! that's exactly what I was need. It's a bit cumbersome thought</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">baseNdx</span><span class=\"w\"> </span><span class=\"n\">byte1</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">base1Ndx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">]</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">byte2</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a2</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">base2Ndx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">]</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">byte3</span>\n<span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a3</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">base3Ndx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a1</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a2</span><span class=\"bp\">.</span><span class=\"n\">size_set</span><span class=\"o\">]</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">byte4</span>\n</code></pre></div>",
        "id": 480002857,
        "sender_full_name": "Andrii Kurdiumov",
        "timestamp": 1730441932
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"709598\">Andrii Kurdiumov</span> has marked this topic as resolved.</p>",
        "id": 480002880,
        "sender_full_name": "Notification Bot",
        "timestamp": 1730441961
    },
    {
        "content": "<p>You might like the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector#doc\">docs#Vector</a> type (currently on defined in Batteries).</p>",
        "id": 480003191,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730442203
    },
    {
        "content": "<p>It only differs from <code>Array</code> in that the size is a parameter.</p>",
        "id": 480003224,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730442238
    },
    {
        "content": "<p>I don't think that's bother me too much. That was only problem. I try ot provide TypedView over Array and have Vector or Arrays seems not bothers me too much yet.</p>\n<p>My complexity in learning Lean4 and wrangling indexes right now.</p>",
        "id": 480003639,
        "sender_full_name": "Andrii Kurdiumov",
        "timestamp": 1730442576
    },
    {
        "content": "<p>Lots of ways to do things like this without wrangling indices at all:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Batteries</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toUInt8</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">1783459234</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 480004285,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730443035
    }
]