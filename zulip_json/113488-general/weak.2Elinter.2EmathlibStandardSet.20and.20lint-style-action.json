[
    {
        "content": "<p>I am confused about the setup for a project using</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[leanOptions]</span>\n<span class=\"n\">weak</span><span class=\"p\">.</span><span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">mathlibStandardSet</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</code></pre></div>\n<p>in <code>lakefile.toml</code> and how this interacts with <a href=\"https://github.com/leanprover-community/lint-style-action\">lint-style-action</a>. Can/does <code>lint-style-action</code> run these lints? In our <a href=\"https://github.com/cs-lean/cslib/actions/runs/16693682963/job/47254816362?pr=25#step:2:268\">workflow log</a> we also get these errors:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nolints</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">treating</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">empty</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">nolints</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`print</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"bp\">-</span><span class=\"n\">error</span><span class=\"bp\">.</span><span class=\"n\">sh</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">255</span>\n<span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"bp\">'./</span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">print</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"bp\">-</span><span class=\"n\">errors</span><span class=\"bp\">.</span><span class=\"n\">sh'</span>\n</code></pre></div>\n<p>Are we meant to add these (and <code>./scripts/lint-style.py</code>) to our repo? Doing so does still not seem to report the lints enabled by <code>weak.linter.mathlibStandardSet</code>.</p>",
        "id": 532895791,
        "sender_full_name": "Chris Henson",
        "timestamp": 1754393522
    },
    {
        "content": "<p>CC <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span></p>",
        "id": 532915507,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754400053
    },
    {
        "content": "<p>I'll try to take a look tomorrow - if you haven't heard an answer by <time datetime=\"2025-08-06T12:00:00Z\">2025-08-06T14:00:00+02:00</time>, feel free to <code>@mention</code> me as a reminder.</p>",
        "id": 532915624,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754400092
    },
    {
        "content": "<p>Anne: is this action supposed to only run in projects depending on mathlib? If not, where does the action get the <code>lint-style</code> executable from?</p>",
        "id": 532917596,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754400745
    },
    {
        "content": "<p>Until tomorrow, let me explain some background:</p>\n<ul>\n<li>this action was made to run some of mathlib's linters in other repositories also --- this is why a mathlib assumption might be (unintentionally) present or undocumented</li>\n<li>mathlib has three different kinds of linters: text-based linters, syntax linters and environment linters</li>\n<li>environment linters are defined in batteries; you can run them with <code>lake exe runLinter</code> (but currently not enable or disable individual lints[1])<br>\n  This action is not about these.</li>\n</ul>\n<p>[1] I have an old work in progress branch which implemented this. If you need this, I could certainly resurrect it, or help you do so. So far, it never became important enough.</p>",
        "id": 532918499,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401041
    },
    {
        "content": "<ul>\n<li>you can run environment linters during editing by writing <code>#lint</code> in your Lean file</li>\n</ul>",
        "id": 532918656,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401091
    },
    {
        "content": "<ul>\n<li>syntax linters provide direct feedback on your code (i.e., some of the squiggly yellow lines you may see if you work in mathlib). They are controlled by mathlib options like <code>linter.style.refine</code>. You can enable or disable them in your file using something like <code>set_option linter.style.refine true</code>.</li>\n</ul>",
        "id": 532918930,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401178
    },
    {
        "content": "<ul>\n<li>you can also configure which syntax linters to run using your lakefile</li>\n</ul>",
        "id": 532919684,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401371
    },
    {
        "content": "<ul>\n<li>a recent feature are linter sets, allowing you to control a lot of linters at once: there is one for all the mathlib linters --- that's basically equivalent to enabling each mathlib linter one by one</li>\n</ul>",
        "id": 532919871,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401423
    },
    {
        "content": "<ul>\n<li>the final kind of linters are <em>text-based</em> linters. They were originally writing as a Python script (<code>scripts/lint-style.py</code>). Most of them have been rewritten in either Lean (<code>scripts/lint-style.lean</code>) or as syntax linters. The remaining ones also will be, but doing so is not the highest priority --- hence may take a while. (Help is welcome!)</li>\n</ul>",
        "id": 532920107,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401490
    },
    {
        "content": "<p>I haven't verified this yet, but my <em>guess</em> is that</p>\n<ul>\n<li><code>lint-style-action</code> is <em>only</em> about running the text-based linters,</li>\n<li>while <code>linter.mathlibStandardSet</code> is about syntax linters.</li>\n</ul>\n<p>In other words, what you're asking about are two different things, that can be used independently of each other.</p>",
        "id": 532920354,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401561
    },
    {
        "content": "<p>I'll further guess that</p>\n<ul>\n<li>the lint-style-action assumes your repository depends on mathlib (so you'd have the <code>lint-style</code>executable accessible, as well as all the other scripts) --- so, <em>no</em>, you're not meant to copy <code>script/lint-style.py</code>, <code>script/nolints-style.txt</code> or <code>print-style-errors.sh</code>).</li>\n</ul>",
        "id": 532920650,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401660
    },
    {
        "content": "<p>I'll have to run now, I can double-check tomorrow.</p>",
        "id": 532920681,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754401667
    },
    {
        "content": "<p>I see, I was vaguely aware of the different linters, but this description is helpful. I think this refines my questions to:</p>\n<p>1) Our project (<a href=\"https://github.com/cs-lean/cslib\">https://github.com/cs-lean/cslib</a>) does depend on Mathlib. For some reason, the action is still not able to access the appropriate scripts for text-based lints.</p>\n<p>2) What would be the preferred way to check for syntax lints, as enabled in our lakefile with <code>weak.linter.mathlibStandardSet</code>, in CI? Is there a lake command to run for these? (I do see them when when running <code>lake build</code>, but I was looking for something with an exit code to use in CI)</p>",
        "id": 532922484,
        "sender_full_name": "Chris Henson",
        "timestamp": 1754402264
    },
    {
        "content": "<p>I'll have to think about (1), but can answer (2) already: I would</p>\n<ul>\n<li>ensure you have the linter set enabled: doing so in your lakefile is good; I would even go one step further and replace it by <code>linter.mathlibStandardSet</code>. (If a file in your project doesn't import anything in mathlib, the <code>weak</code> version will not run any of the syntax linters, whereas the other version will error and tell you you forgot to import this. Importing almost any file from mathlib will do. You could have a file <code>CSLib/Init.lean</code> which everything imports, which imports some mathlib.)</li>\n</ul>",
        "id": 532939428,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754407422
    },
    {
        "content": "<ul>\n<li>as you said, running lake build already runs all syntax linters: the only part is to error when you get any warning. There's a lake option for that.</li>\n</ul>",
        "id": 532939507,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754407457
    },
    {
        "content": "<p>I believe it's the <code>--wfail</code> option.</p>",
        "id": 532939835,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1754407560
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113488-general/topic/weak.2Elinter.2EmathlibStandardSet.20and.20lint-style-action/near/532917596\">said</a>:</p>\n<blockquote>\n<p>Anne: is this action supposed to only run in projects depending on mathlib? If not, where does the action get the <code>lint-style</code> executable from?</p>\n</blockquote>\n<p>The Python script was supposed to migrate to the <code>lint-style-action</code> but that doesn't seem to have actually happened.</p>",
        "id": 533087089,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1754481750
    },
    {
        "content": "<p>I've just needed to add</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">pythonStyle</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">checkInitImports</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">allScriptsDocumented</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>to the Cslib lakefile, unfortunately, so this is still a live issue.</p>",
        "id": 544726745,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760442514
    },
    {
        "content": "<p>Can we modify the setup in Mathlib so that these three are <em>not</em> activated by <code>mathlibStandardSet</code>?</p>",
        "id": 544727208,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760442659
    },
    {
        "content": "<p>The <code>pythonStyle</code> linters could be made to work, but more care would be needed so that when run in a downstream repo the script is actually findable (because it will be somewhere under <code>.lake</code>, rather in the <code>./scripts/</code>).</p>",
        "id": 544727363,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760442704
    },
    {
        "content": "<p>(Better of course is not to have python scripts. :-)</p>",
        "id": 544727405,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760442715
    },
    {
        "content": "<p>I think it is safe to say <code>checkInitImports</code> and <code>allScriptsDocumented</code> should not be activated in downstream projects: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30541\">#30541</a></p>",
        "id": 544727496,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760442742
    },
    {
        "content": "<p>Is <code>checkInitImports</code> the reason I get a really annoying error every time I make a scratch file in a local copy of FLT? <code>invalid -D parameter, unknown configuration option 'linter.mathlibStandardSet'</code></p>",
        "id": 545069983,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760551422
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, if you read the rest of the error message you quote you'll see it says:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">parameter</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">mathlibStandardSet'</span>\n\n<span class=\"n\">If</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">Dweak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">mathlibStandardSet'</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">conditionally</span>\n</code></pre></div>\n<p>and indeed if you modify your lakefile by replacing the lines</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">flexible</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">rigid</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"ss\">`exact</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">flexible</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"ss\">`simp</span><span class=\"bp\">`</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Enable</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">linters</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">automatically</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">uses</span><span class=\"bp\">.</span>\n<span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">mathlibStandardSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">flexible</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">rigid</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"ss\">`exact</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">flexible</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"ss\">`simp</span><span class=\"bp\">`</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Enable</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">linters</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">automatically</span><span class=\"w\"> </span><span class=\"n\">matches</span><span class=\"w\"> </span><span class=\"n\">what</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">uses</span><span class=\"bp\">.</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">mathlibStandardSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>then the error messages in scratch files disappear. :-)</p>",
        "id": 545873307,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760926737
    },
    {
        "content": "<p>(Acknowleding that the error message is not ideal: instead of \"If the option is defined in this library\" it should say \"If the option is defined in a library\".)</p>",
        "id": 545873338,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760926771
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/10844\">lean#10844</a></p>",
        "id": 545873494,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760926948
    },
    {
        "content": "<p>My rule of thumb is: I have no understanding of my lakefile or of any consequences of fiddling with it, so don't touch it. In short, if I change the lakefile to silence that error then I have no understanding of the other consequences. Basically it is always other people who are editing my lakefile. I'll give it a go... (edit: <a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/753\">FLT#753</a>)</p>",
        "id": 545891907,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760942841
    },
    {
        "content": "<p>Late to the party, but let me try to help: does that scratch file import Mathlib/Init.lean (perhaps transitively)? I would expect the answer is \"no\", and importing it to fix your error.</p>",
        "id": 545906199,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760947772
    },
    {
        "content": "<p>Short explaination: the <code>mathlibStandardSet</code> is a \"linter set\", i.e. you can enable or disable a collection of linters at the same time. (In other words, <code>set_option linter.mathlibStandardSet true</code> is just a shorthand for saying <code>set_option linter.foo true</code> for various linters <code>foo</code> in mathlib.)</p>",
        "id": 545906628,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760947905
    },
    {
        "content": "<p>That linter set is defined in <code>Mathlib/Init.lean</code> (search mathlib for <code>mathlibStandardSet</code> and you'll find that). So if you don't have that file imported, lean complains about the unknown option.</p>",
        "id": 545906774,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760947946
    },
    {
        "content": "<p>Mathlib/Init.lean is imported by every other file in mathlib, so <em>any</em> mathlib import in your scratch file will make the error go away.</p>",
        "id": 545906849,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760947969
    },
    {
        "content": "<p>Can we emit a custom error message for this particular option, that explains how to fix this? I.e., for this particular error, append a </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">hint</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">make</span><span class=\"w\"> </span><span class=\"n\">sure</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`Mathlib</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">linter</span>\n</code></pre></div>\n<p>to the error message?</p>",
        "id": 545907452,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760948142
    },
    {
        "content": "<p>(Up to word-smithing: perhaps \"this linter set\" or \"this option\" would be better.)</p>",
        "id": 545907521,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760948164
    },
    {
        "content": "<p>The problem is rather when you make an <em>empty</em> file, <code>linter.mathlibStandardSet</code> doesn't exist, so you get an error! This is why it needs to have <code>weak.</code> prepended.</p>\n<p>Creating empty files in downstream repositories should not generate errors: these can be useful for quickly checking syntax, documentation, etc.</p>",
        "id": 545911587,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760949345
    },
    {
        "content": "<p>But the <code>weak</code> will silence any errors about this linter being unintentionally imported in non-empty files. I think we should do better here.</p>",
        "id": 545912629,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760949653
    },
    {
        "content": "<p>I agree that the user experience of errors in an empty file is not great. But I think we should strive for a different solution.</p>",
        "id": 545912776,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760949698
    },
    {
        "content": "<p>To rephrase, your ideal behavior is that in this error we give instructions on how to import the linter, rather than the distinct decision to suppress an error with <code>weak</code>? This has merit IMO. I've been thinking about this for CSLib where we use <code>weak</code>, opening the door to some leaf files independent of Mathlib not being linted as we would like.</p>\n<p>As a practical matter, how would the library specific error message get appended? The error message is from core where it's just checking that the option declarations exist.</p>",
        "id": 545919693,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760951584
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span>  Basically, my workflow is:</p>\n<p>I'm working on FLT and take a break to browse Zulip.<br>\nI see a post from someone saying \"I'm learning Lean, I'm a beginner, here is my basic question, this is core Lean, my MWE doesn't import mathlib\".<br>\nI dump the question into a scratch file in FLT and I get an <em>error</em> rather than warning.</p>\n<p>I am happy to ignore warnings but I am super-scared about ignoring errors; my rule of thumb is not to trust any output whatsoever after the first error, and in this case the first error is always on the first line.</p>\n<p>I totally understand that <code>import Mathlib.Init</code> will fix this. However it will also import random other things which might even stop me answering the question, e.g. because the behaviour of the code might change if I add this import.</p>",
        "id": 545921847,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760952143
    },
    {
        "content": "<p>Thanks for explaining. I understand better now.</p>",
        "id": 545957336,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760961898
    },
    {
        "content": "<p>In this particular case, I don't think you need to be scared about <code>import Mathlib.Init</code>changing the behaviour of your code. (Its imports are intentionally minimal: syntax linters, two of mathlib's environment linters and the #min_imports command. In particular, the file defines no new syntax, no new notation and enables no linters by itself. That's seems pretty innocuous.)</p>",
        "id": 545957756,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760961981
    },
    {
        "content": "<p>That said: a different solution could be to use the <code>weak</code> prefix, but add a linter (you can enable in FLT) that checks every file imports <code>Mathlib.Init</code> (or FLT.Init or something) transitively. This would allow you to work with an empty scratch file, but also ensure that you don't accidentally forget to lint an FLT file.</p>",
        "id": 545958078,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760962075
    },
    {
        "content": "<p>(Though I guess almost every non-trivial FLT file will import something from mathlib anyway, so perhaps using <code>weak</code> is just fine and there's no reason for me to be worried?)</p>",
        "id": 545958183,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760962106
    }
]