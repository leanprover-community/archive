[
    {
        "content": "<p>Hi I had a new user today and we were trying to install lean on windows by following <a href=\"https://github.com/leanprover-community/mathlib/blob/master/docs/install/windows.md\" target=\"_blank\" title=\"https://github.com/leanprover-community/mathlib/blob/master/docs/install/windows.md\">the mathlib instructions</a>, there were loads of issues getting everything working however. This might just be because we didn't follow the instructions well enough though.  I'm posting the issues we had just to see if there are any easy wins to fix them. <br>\n- <code>~/.profile</code>  was not sourced by git bash, either in the vscode terminal or in a new git-bash window. I had to move it to <code>~/.bashrc</code><br>\n- VSCode did not manage to find the lean executable in <code>~/.elan/bin</code>. This was not rectified by running the 'install using elan' prompt. I fixed this by explicitly setting the lean executable vscode setting, but that took a couple of attempts because you had to use the windows-style path not the bash-style path. <br>\n- Running the install by elan  prompt happened multiple times in desperation, and this meant that it was added to .profile multiple times so the path would have <code>~/.elan/bin</code> in it multiple times. <br>\n- Finally, the import fail 'not in LEAN_PATH' error for <code>import topology.basic</code> came up but it was not clear how to fix it, I think this was solved through some combination of restarts and calling leanpkg build / configure. Does anyone know what exactly causes this error?</p>",
        "id": 182688289,
        "sender_full_name": "Edward Ayers",
        "timestamp": 1575570629
    },
    {
        "content": "<p>It's hard to reply to some of these comments if you didn't follow the instructions closely. I've installed Lean a couple of times now following the instructions closely, and they worked for me. If you see a way to make the instructions more robust, feel free to tell us.</p>\n<blockquote>\n<p>- Finally, the import fail 'not in LEAN_PATH' error for import topology.basic came up but it was not clear how to fix it, I think this was solved through some combination of restarts and calling leanpkg build / configure. Does anyone know what exactly causes this error?</p>\n</blockquote>\n<p>This tends to happen if you open a <code>.lean</code> file directly in VSCode without opening the whole project folder:</p>\n<blockquote>\n<p>On the main screen, or in the File menu, click \"Open folder\" (on a Mac, just \"Open\"), and choose the folder my_project (not one of its subfolders).</p>\n</blockquote>",
        "id": 182711888,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1575584980
    },
    {
        "content": "<p>It can of course also happen if you have skipped other steps from the installation instructions, like calling <code>leanpkg configure</code> for the first time.</p>",
        "id": 182712279,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1575585289
    },
    {
        "content": "<p>I think the latest version of the VS Code extension now warns users if they open a file in a folder without a <code>leanpkg.path</code> file.</p>",
        "id": 182712337,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1575585346
    },
    {
        "content": "<p>I am here to ask a few question. Hope anyone can give me the clear explanation. Given how slow Lean is in my machine (i use vscode), 1) What's the system requirement to run Lean and its libraries? 2) Is Lean supposed to be hyperreactive for any cursor movement? 3) Why the lean playground suffers from the performance issue?.</p>\n<p>Thank you</p>",
        "id": 570230299,
        "sender_full_name": "0076_Haikal Isa Al Mahdi",
        "timestamp": 1769485845
    },
    {
        "content": "<p>Generally speaking, you will suffer if your machine doesn't have &gt;=32GB of RAM</p>",
        "id": 570248213,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1769498558
    },
    {
        "content": "<p>Is that really true? I tell people 16 nowadays.</p>",
        "id": 570250816,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769499720
    },
    {
        "content": "<p>1) That depends on what you include in \"its libraries\" for Lean core alone you can probably get away with just 8GB. For mathlib you need at least 8 just for mathlib alone so probably you want 16 or more.<br>\n2) That again depends on what you mean by hyper reactive and what specifically you are working on. Sometimes having instant feedback is just not possible because your proof is still computing. If you have an example of a particular slowness do tell us about it<br>\n3) in my experience on a sufficiently fast internet connection the lean playground is sufficiently fast at least if it is not under contention.</p>",
        "id": 570251109,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1769499828
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Issues.20on.20windows.20for.20new.20users/near/570250816\">said</a>:</p>\n<blockquote>\n<p>Is that really true? I tell people 16 nowadays.</p>\n</blockquote>\n<p>My (Windows) laptop has 16GB and it almost grinds to a halt when running even a single instance of lean</p>",
        "id": 570251879,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1769500139
    },
    {
        "content": "<p>Henrik's  (1) doesn't seem to factor in the OS. That might explain why 16GB is not enough on some systems.</p>",
        "id": 570254662,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1769501210
    },
    {
        "content": "<p>I had a laptop with 12GB and this was barely enough to work on Mathlib. I regularly had to close my browser while using it as otherwise all my RAM would get used up. Now I have a newer laptop with 24GB, and it works like a charm.</p>",
        "id": 570255797,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769501623
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/113488-general/topic/Issues.20on.20windows.20for.20new.20users/near/570254662\">said</a>:</p>\n<blockquote>\n<p>Henrik's  (1) doesn't seem to factor in the OS. That might explain why 16GB is not enough on some systems.</p>\n</blockquote>\n<p>For the type of loads that we keep track of in radar this does take the OS into account. We know that a current mathlib import takes 3GB of memory and similarly maxrss when building mathlib from scratch is also at 3GB. My understanding is that a Windows gobbles up ~4GB of memory just on its own so 16 should hopefully leave quite a bit of RAM free to do other things besides Lean. We have noticed that e.g. Firefox can consume quite a bit of additional RAM so sometimes it is also a synergy of programs that leads to these issues.</p>\n<p>If you are experiencing situations where 16 GB of RAM is not enough please do tell us about them! Even if it turns out that the reason is \"legitimate\" we need to know that this situation exists and track it as a metric in our benchmarking setup.</p>\n<p>In particular please provide the following information:</p>\n<ul>\n<li>what mathlib version were you working on, please provide the commit, e.g. via <code>git rev-parse HEAD</code></li>\n<li>what editor are you using<ul>\n<li>especially with VSCode a list of extensions you installed can be helpful as well. In the past we've even been able to track down bugs in official Microsoft extensions</li>\n</ul>\n</li>\n<li>do you have multiple tabs/buffers open in the editor at the same time? If so how many? We can share the information from importing the olean files but every tab in your editor has certain non-shareable informations so you can't just open infinitely many tabs without running out of memory</li>\n<li>what file were you working on, what were you doing? Ideally a video of the action that causes the issue if you can pin it down to doing a particular thing</li>\n<li>what anti-virus / corporate spyware if any do you have on your machine</li>\n<li>are you using storage in the cloud such as Dropbox, OneDrive etc.</li>\n<li>if you are in vscode send us the setup information by opening the forall menu and selecting \"show setup information\"<br>\n<a href=\"/user_uploads/3121/YKm8ywc7GA2TxVqLYWAaQd-k/image.png\">image.png</a><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YKm8ywc7GA2TxVqLYWAaQd-k/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1295x542\" src=\"/user_uploads/thumbnail/3121/YKm8ywc7GA2TxVqLYWAaQd-k/image.png/840x560.webp\"></a></div></li>\n</ul>\n<p>it should look like so:<br>\n<a href=\"/user_uploads/3121/o9kIvYF0Ibrm0fGkj2iHootd/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/o9kIvYF0Ibrm0fGkj2iHootd/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"560x355\" src=\"/user_uploads/thumbnail/3121/o9kIvYF0Ibrm0fGkj2iHootd/image.png/840x560.webp\"></a></div><ul>\n<li>if you are on a non vscode editor please do provide the information through other means such as <code>lscpu</code> etc.</li>\n<li>\n<p>If you are on Windows please do send us some information from the task manager/resource monitor:</p>\n<ul>\n<li>\n<p>for the task manager sort your processes by memory and find e.g. the vscode process tree then open it, please send us a screenshot of this:<br>\n<a href=\"/user_uploads/3121/CFfKvQZano-9m7M9GmsGyhTr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/CFfKvQZano-9m7M9GmsGyhTr/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1018x727\" src=\"/user_uploads/thumbnail/3121/CFfKvQZano-9m7M9GmsGyhTr/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>next open the resource monitor and switch to memory, sort this by working set size and also send us a screenshot of it like so:<br>\n<a href=\"/user_uploads/3121/1JYKyp9VppgrSeZ1ESREIl-p/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/1JYKyp9VppgrSeZ1ESREIl-p/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2280x1000\" src=\"/user_uploads/thumbnail/3121/1JYKyp9VppgrSeZ1ESREIl-p/image.png/840x560.webp\"></a></div></li>\n</ul>\n</li>\n<li>\n<p>if you are on Linux please send us:</p>\n<ul>\n<li>the output of <code>cat /proc/meminfo</code>. If this file is not available the output of <code>free -hm</code> instead.</li>\n<li>\n<p>a screenshot of <code>htop</code> with the following configuration: <code>htop -F 'lean|lake|code|nvim|emacs' -t</code> now you need to set a few config options:</p>\n<ol>\n<li>\n<p>press f2 to go into setup, in display options make sure to set hide userland process threads:  <a href=\"/user_uploads/3121/5mznOwD3YSDAe_7Qapvpa3pt/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5mznOwD3YSDAe_7Qapvpa3pt/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1130x779\" src=\"/user_uploads/thumbnail/3121/5mznOwD3YSDAe_7Qapvpa3pt/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>navigate to screens and ensure that M_PRIV and M_PSS are added to the columns: <br>\n<a href=\"/user_uploads/3121/mgLlU2qIu34Z6KM1JHcMz3k-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/mgLlU2qIu34Z6KM1JHcMz3k-/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1916x1157\" src=\"/user_uploads/thumbnail/3121/mgLlU2qIu34Z6KM1JHcMz3k-/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>you should now be greeted with a screen such as the following, please send us a screenshot of it: <br>\n<a href=\"/user_uploads/3121/IFB6UMGkxP14ZfcxOcC9b8nQ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/IFB6UMGkxP14ZfcxOcC9b8nQ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2513x415\" src=\"/user_uploads/thumbnail/3121/IFB6UMGkxP14ZfcxOcC9b8nQ/image.png/840x560.webp\"></a></div></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>if you are on MacOS my understanding is you can at least follow a similar approach as Linux to get this information but I don't have access to a MacOS machine at the moment</p>\n</li>\n</ul>",
        "id": 570281005,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1769508898
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> I stand corrected.<br>\nThanks!</p>",
        "id": 570285167,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1769510145
    }
]