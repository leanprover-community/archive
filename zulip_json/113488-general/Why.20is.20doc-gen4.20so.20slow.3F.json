[
    {
        "content": "<p>Every time I try to regenerate doc (using <code>doc-gen4</code>) for my project via e.g. <code>lake build Myproject:docs</code> it takes a long time apparently related to the dependency on <code>mathlib4</code>.  Is there a way to make this faster?</p>",
        "id": 522844935,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749242797
    },
    {
        "content": "<p>I just try and import as little of mathlib as possible (indeed I've even recently started linting against <code>import Mathlib</code> and I've got <code>shake</code> working on my project).</p>",
        "id": 522851286,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1749247010
    },
    {
        "content": "<p>Once you've built it once you can just reuse the same cache</p>",
        "id": 522851318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749247045
    },
    {
        "content": "<p>...except when you bump mathlib (which every good project should be doing at least once a week, right?)</p>",
        "id": 522851361,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1749247079
    },
    {
        "content": "<p>Well, as long as you are also sleeping, you can bump, kick off a doc build, go to bed, and then wake up to a hot build cache</p>",
        "id": 522851438,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749247134
    },
    {
        "content": "<p>If you're bumping multiple times a day then probably you have more important things going on than local doc builds</p>",
        "id": 522851479,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749247180
    },
    {
        "content": "<p>If you really want live docs for your project, then a 2hr delay in CI every time you bump is probably acceptable; that's what we have in <a href=\"https://github.com/google-deepmind/formal-conjectures\">https://github.com/google-deepmind/formal-conjectures</a></p>",
        "id": 522851558,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749247224
    },
    {
        "content": "<p>(our bumps were doc-gen versions because of bugs around weird filenames!)</p>",
        "id": 522851649,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749247289
    },
    {
        "content": "<p>I've got the project built and doc generated, and and I also have <code>lake exe cache get</code>.  However, even without make any changes, if I re-run <code>lake build Myproject:docs</code>, I still need to wait like a minute with lots of warning messages about <code>mathlib4</code>. Is this expected behavior? For example,</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>Nng4:docs\n‚Ñπ<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">125</span>/542<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>¬´doc-gen4¬ª/bibPrepass\ninfo:<span class=\"w\"> </span>stdout:\nINFO:<span class=\"w\"> </span>reference<span class=\"w\"> </span>page<span class=\"w\"> </span>disabled\n‚Ñπ<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">2945</span>/2949<span class=\"o\">]</span><span class=\"w\"> </span>Replayed<span class=\"w\"> </span>Mathlib.Tactic.Linter.FlexibleLinter:docs\ninfo:<span class=\"w\"> </span>stdout:\nWARNING:<span class=\"w\"> </span>Failed<span class=\"w\"> </span>to<span class=\"w\"> </span>calculate<span class=\"w\"> </span>equational<span class=\"w\"> </span>lemmata<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>Mathlib.Linter.Flexible.usesGoal?:<span class=\"w\"> </span><span class=\"o\">(</span>deterministic<span class=\"o\">)</span><span class=\"w\"> </span>timeout<span class=\"w\"> </span>at<span class=\"w\"> </span><span class=\"sb\">`</span>whnf<span class=\"sb\">`</span>,<span class=\"w\"> </span>maximum<span class=\"w\"> </span>number<span class=\"w\"> </span>of<span class=\"w\"> </span>heartbeats<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">200000</span><span class=\"o\">)</span><span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>reached\nUse<span class=\"w\"> </span><span class=\"sb\">`</span>set_option<span class=\"w\"> </span>maxHeartbeats<span class=\"w\"> </span>&lt;num&gt;<span class=\"sb\">`</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"nb\">set</span><span class=\"w\"> </span>the<span class=\"w\"> </span>limit.<span class=\"o\">(</span>invalid<span class=\"w\"> </span>MessageData.lazy,<span class=\"w\"> </span>missing<span class=\"w\"> </span>context<span class=\"o\">)</span>\n...\n</code></pre></div>\n<p>I'd think if no change is made to the project, the build process <em>should</em> be able to quickly detect that nothing needs to be done and complete in seconds, if not sub-seconds.  But clearly not the case.</p>",
        "id": 522852884,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749248185
    },
    {
        "content": "<p>I wonder if it's faster if you tell it to be quiet; by default it has to retrieve and print all the old logs.</p>",
        "id": 522853710,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749248816
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> may be able to advise.</p>",
        "id": 522853740,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749248829
    },
    {
        "content": "<p>Interesting idea. I just tried</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">time</span><span class=\"w\"> </span>lake<span class=\"w\"> </span>-q<span class=\"w\"> </span>build<span class=\"w\"> </span>Nng4:docs\n</code></pre></div>\n<p>No warnings shown, but it takes about as long.</p>",
        "id": 522856124,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749250734
    },
    {
        "content": "<p>7 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Syntax.20highlighting.20in.20doc-gen/with/522856736\">#general &gt; Syntax highlighting in doc-gen</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 522859142,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749253905
    },
    {
        "content": "<p>Is anything being built? You can test this with <code>lake build Nng4:docs --no-build</code> (an error indicates something does want build). If nothing is being built, it is possible that simply verifying everything is update-to-date is sufficiently time-consuming. Mathlib and doc-gen4 touch a lot of files and Lake's analysis scales linearly in the number of files. If file I/O is not particular fast on system (e.g., Windows vs Linux), this can hurt Lake's performance.</p>",
        "id": 522880311,
        "sender_full_name": "Mac Malone",
        "timestamp": 1749282534
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/channel/113488-general/topic/Is.20there.20a.20way.20to.20skip.20doc.20gen.20of.20mathlib4.3F/near/522880311\">said</a>:</p>\n<blockquote>\n<p>Is anything being built? You can test this with <code>lake build Nng4:docs --no-build</code> (an error indicates something does want build). If nothing is being built, it is possible that simply verifying everything is update-to-date is sufficiently time-consuming. Mathlib and doc-gen4 touch a lot of files and Lake's analysis scales linearly in the number of files. If file I/O is not particular fast on system (e.g., Windows vs Linux), this can hurt Lake's performance.</p>\n</blockquote>\n<p>Whether <code>--no-build</code> is specified or not doesn't seem to make any difference ‚Äî both take about a minute. It seems to me this is a problem specific to <code>doc-gen4</code>.  <code>lake build</code> returns in like one second. I wonder why doc-gen4 touches files unnecessarily.   This indicates a problematic design choice (or at least a performance bottleneck) in <code>doc-gen4</code>. It defeats the purpose of incremental builds, and is not sustainable as <code>mathlib</code> and its ecosystem continue to grow. We should probably open a Github issue for <code>doc-gen4</code>.</p>",
        "id": 522899182,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749306734
    },
    {
        "content": "<p>Found out the reason why the doc gen was so slow. This fixes it:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">export</span><span class=\"w\"> </span><span class=\"nv\">DOCGEN_SRC</span><span class=\"o\">=</span><span class=\"s2\">\"file\"</span>\n<span class=\"nb\">time</span><span class=\"w\"> </span>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>Nng4:docs\n...\nBuild<span class=\"w\"> </span>completed<span class=\"w\"> </span>successfully.\n\nreal<span class=\"w\">    </span>0m1.099s\nuser<span class=\"w\">    </span>0m1.367s\nsys<span class=\"w\"> </span>0m1.052s\n</code></pre></div>",
        "id": 522903277,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749311506
    },
    {
        "content": "<p>By default <code>doc-gen4</code> assumes the URL's are in github, so I suppose it remote accesses the links and time outs multiple times.  If so, then of course doc gen is slow.  By changing the default to local file reference, it stopped the bleed.  (I was wondering what those \"heart beats\" were about ‚Äî apparently it's doing remote access!)</p>\n<p>See <a href=\"https://github.com/leanprover/doc-gen4#source-locations\">here</a> for more info.</p>\n<p>In any case, interesting that <code>doc-gen4</code> appears to make many default assumptions, like the version control system is <code>git</code>, the repository is <code>github</code>, etc.  Make sense in a way, but surprising also to beginners like me :)</p>",
        "id": 522903424,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749311681
    },
    {
        "content": "<p>Thinking out loud, perhaps it would be smarter for <code>doc-gen4</code> to somehow detect that it's running in github workflow, or not.  If it's running in github workflow, then the default should be remote URL to github pages. If not, then it should default to local file reference.</p>\n<p>This would make it fast by default everywhere.</p>\n<p>For instance,</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$GITHUB_ACTIONS</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s2\">\"true\"</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"Running inside GitHub Actions\"</span>\n<span class=\"w\">    </span><span class=\"c1\"># default to remote URL's</span>\n<span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"Running outside GitHub Actions\"</span>\n<span class=\"w\">    </span><span class=\"c1\"># default to local file references</span>\n<span class=\"k\">fi</span>\n</code></pre></div>",
        "id": 522903859,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749312111
    },
    {
        "content": "<p>For now, I'll just create my own <code>Makefile</code> :)</p>",
        "id": 522904107,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749312381
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"711412\">some.knowit</span> has marked this topic as resolved.</p>",
        "id": 522904436,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749312780
    },
    {
        "content": "<blockquote>\n<p>so I suppose it remote accesses the links and time outs multiple times.</p>\n</blockquote>\n<p>Do you have anything belong speculation to back this up?</p>",
        "id": 522904575,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749312978
    },
    {
        "content": "<p>I'm pretty sure this is just used to inform what style the urls <em>output</em> by doc-gen use</p>",
        "id": 522904596,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749313006
    },
    {
        "content": "<p>I think more likely is that it is invoking <code>git remote -v</code> or similar a large number of times (which still makes no network access)</p>",
        "id": 522904619,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749313035
    },
    {
        "content": "<p>Good question.  Indeed, I cannot detect any network connections by running the doc gen using the default settings.  Yet it's so much faster once I changed it to local file reference.  ~60x performance improvement.</p>",
        "id": 522905548,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749314194
    },
    {
        "content": "<p>Indeed, the <a href=\"https://github.com/leanprover/doc-gen4/blob/main/lakefile.lean#L26-L39\">getGitRemoteUrl</a> appears to fork a new subprocess per call which is expensive, thus slowing things down.</p>",
        "id": 522906551,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749315367
    },
    {
        "content": "<p>This begs the question: why doesn't <code>doc-gen4</code> query git remote once, and then reuse the result, instead of repeatedly querying the same thing over and over?</p>",
        "id": 522906995,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749315894
    },
    {
        "content": "<p>That, is the right question :)</p>",
        "id": 522907576,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749316506
    },
    {
        "content": "<p>The answer is that doc-gen was decomposed into tiny pieces so that lake can manage the build, and so has no way to \"do things once\" without lake managing this</p>",
        "id": 522907641,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749316577
    },
    {
        "content": "<p>So the fix will involve adding an extra step to the docgen4 lakefile that computes this and stashes it in a json / text file somewhere that the next step reads.</p>",
        "id": 522907669,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749316605
    },
    {
        "content": "<p>Aha.  Sounds like a good cause to open an issue for doc-gen4.</p>",
        "id": 522907740,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749316673
    },
    {
        "content": "<p>Will benefit so many users instantly!</p>",
        "id": 522907765,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749316699
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/doc-gen4/pull/296\">https://github.com/leanprover/doc-gen4/pull/296</a> is an easy partial fix</p>",
        "id": 522907818,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749316747
    },
    {
        "content": "<p>This still does it for every file, but does so as part of the cached step.</p>",
        "id": 522907842,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749316768
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/522907842\">said</a>:</p>\n<blockquote>\n<p>This still does it for every file, but does so as part of the cached step.</p>\n</blockquote>\n<p>From a minute to less than 3 seconds ‚Äî good enough for me!</p>",
        "id": 522918223,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749329532
    },
    {
        "content": "<p>Well, the part that is still slow is when you're spending the ~1hr doing a fresh build from scratch; there my change makes no difference at all</p>",
        "id": 522919077,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749330666
    },
    {
        "content": "<p>True. It took 23 minutes in my case. Still a torture. Would using the json intermediate file approach help with fresh builds? It doesn't seem it would iiuc.</p>",
        "id": 522919209,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749330839
    },
    {
        "content": "<p>If you want to find out, I recommend timing the line I modified vs the <code>proc</code> call below it, to see how much of that 23 minutes is from git and how much is doc-gen itself</p>",
        "id": 522919270,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749330922
    },
    {
        "content": "<p>It's probably also worth checking if doc-gen makes any <code>git</code> calls outside of the lakefile</p>",
        "id": 522919278,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749330940
    },
    {
        "content": "<p>I see there are two places in <code>doc-gen4</code> that fork child process via <code>IO.Process.output</code>, both in <code>lakefile.lean</code>. One to get the git remote url, and the other to get the <a href=\"https://github.com/leanprover/doc-gen4/blob/main/lakefile.lean#L41-L52\">git commit hash</a> of the project. Can anything similar be done to the existing <code>getProjectCommit</code> to minimize the number of creating child processes?</p>\n<p>In principle, I see git has a C API called <a href=\"https://git-scm.com/book/ms/v2/Appendix-B:-Embedding-Git-in-your-Applications-Libgit2\">Libgit2</a>, and I presume Lean4 can call C via <a href=\"https://github.com/leanprover/lean4/blob/master/doc/dev/ffi.md\">FFI</a>; so it seems all possible to avoid the cost of process forking all together in <code>doc-gen4</code>.</p>",
        "id": 522919962,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749331932
    },
    {
        "content": "<p>I think this is the wrong direction entirely, let me try my fix...</p>",
        "id": 522922199,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749335474
    },
    {
        "content": "<p>Meanwhile, I am also trying to measure the total time spent on the git commands during doc gen.</p>",
        "id": 522923212,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749337093
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/doc-gen4/pull/298/\">https://github.com/leanprover/doc-gen4/pull/298/</a> is my attempt, but I don't think it currently helps</p>",
        "id": 522923425,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749337431
    },
    {
        "content": "<p>ok, with your <a href=\"https://github.com/leanprover/doc-gen4/pull/296\">PR-296</a> locally applied to <code>v4.20.0</code> of <code>doc-gen4</code>, I instrumented <code>doc-gen4</code> to measure the elapsed time of running <code>getGitRemoteUrl</code> and <code>getProjectCommit</code>.  I ran a fresh build <code>lake build Nng4:docs</code> which took ~18min. A total of 234.199 seconds (or roughly 3.9min) were spent on the git commands, each taking an average of ~42ms. (A total of 5,616 such git commands.) So roughly about 21% of a fresh build doc is spent on these git commands forking child processes.  (A sample size of only one.  Quite time consuming to run.)</p>",
        "id": 522928863,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749346542
    },
    {
        "content": "<p>by ms did you mean minutes or milliseconds?</p>",
        "id": 522929187,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749347077
    },
    {
        "content": "<p>min=minutes, ms=milliseconds</p>",
        "id": 522929196,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749347096
    },
    {
        "content": "<p>sorry, many typos :). Should be fixed, most if not all.</p>",
        "id": 522929268,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749347226
    },
    {
        "content": "<p>I also tried measuring the time spent on git commands on doc-gen4 v4.20.0 without PR-296, the result is similar. The whole build finished in 16.67min with 2.88min spent on git commands so about 17.28%.  Same number of 5,616 git commands executed.</p>\n<p>Another interesting observation is that without PR-296, the rebuild takes 58.115s with the same number of 5,616 git commands executed, but each taking much less time to complete. A total of 55.714s spent on these git commands.  I wonder why the git commands execute so much faster upon a rebuild than a fresh build.</p>",
        "id": 522931703,
        "sender_full_name": "Hanson Char",
        "timestamp": 1749351138
    },
    {
        "content": "<p>I further tested the case of caching all the Git URIs for all the packages so the construction of each github URL to each source file is done via reading from the file system instead of forking a git command. The performance doesn't seem to have any major improvement.  For instance, currently (without disk caching) it took 22m48s to do a cold build of docgen on the <a href=\"https://github.com/teorth/analysis\">analysis</a> project (that entails the following 9 packages), whereas with disk caching it took 21m52s.  The profit of (~10%) seems perhaps too small to be worth the effort.  The bottleneck seems somewhere else.  I guess I could even hardcode the 9 URI's as a hack to see the performance (when there is absolutely no disk access for the URL's).  That would absolutely confirm the bottleneck hypothesis.</p>\n<ul>\n<li>aesop</li>\n<li>Analysis</li>\n<li>batteries</li>\n<li>importGraph</li>\n<li>LeanSearchClient</li>\n<li>mathlib</li>\n<li>plausible</li>\n<li>proofwidgets</li>\n<li>Qq</li>\n</ul>",
        "id": 525794818,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750887747
    },
    {
        "content": "<p>Have you tried to just run the warm build with a profiler and see what it's doing?</p>",
        "id": 525797341,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1750889441
    },
    {
        "content": "<p>No, I haven't since the warm build seems fast enough. But this sounds interesting.  Will try it.</p>",
        "id": 525797545,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750889562
    },
    {
        "content": "<p>Oh I was under the impression that by \"with disk caching\" you mean a warm build?</p>",
        "id": 525797733,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1750889690
    },
    {
        "content": "<p>Warm build takes like 1min (or sometimes just 10s or so), so not paying much attention to it.</p>",
        "id": 525797766,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750889720
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik B√∂ving</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/525797733\">said</a>:</p>\n<blockquote>\n<p>Oh I was under the impression that by \"with disk caching\" you mean a warm build?</p>\n</blockquote>\n<p>Just to further clarify I hacked the doc-gen4 <code>lakefile.lean</code> to cache each unique module github URI to the disk (via running a git command once), and then read back from the files afterwards to see if it makes a difference to the cold build performance.</p>",
        "id": 525798095,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750889990
    },
    {
        "content": "<p>I see, a cold build performance of approximately 17 minutes on a beefy server machine is totally expected right now, last time I looked it was just that doing all of the pretty printing necessary to render equations takes some time really, that should be easily visible in a profiler.</p>",
        "id": 525798248,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1750890087
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"711412\">Hanson Char</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/525794818\">said</a>:</p>\n<blockquote>\n<p>I guess I could even hardcode the 9 URIs as a hack to see the performance (when there is absolutely no disk access for the URL's).  That would absolutely confirm the bottleneck hypothesis.</p>\n</blockquote>\n<p>The result of that <a href=\"https://github.com/leanprover/doc-gen4/compare/main...hansonchar:doc-gen4:hack\">experiment</a> turned out to be a little surprising. A cold build dropped from 22min48s to 15min47s ‚Äî about 30% reduction. In other words, the git commands accounted for roughly 30% of the total overhead during a cold build. That seems like low-hanging fruit and a strong incentive to optimize.</p>",
        "id": 525810871,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750901372
    },
    {
        "content": "<p>Is that with or without my previous patch?</p>",
        "id": 525858093,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750928986
    },
    {
        "content": "<p>with.  Specifically, it's based off the latest <code>main</code> as you can see <a href=\"https://github.com/leanprover/doc-gen4/compare/main...hansonchar:doc-gen4:hack\">here</a>.</p>\n<p>However, I don't think your previous patch makes much perf difference on cold build.</p>",
        "id": 525940908,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750955043
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/doc-gen4/pull/298/\">https://github.com/leanprover/doc-gen4/pull/298/</a> is not yet in main</p>",
        "id": 525962967,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750963397
    },
    {
        "content": "<p>ok, then without :) However, your patch doesn't seem to have much impact on cold build so I believe the optimization opportunity stands.</p>",
        "id": 525966462,
        "sender_full_name": "Hanson Char",
        "timestamp": 1750964936
    },
    {
        "content": "<p>I haven‚Äôt had time to investigate thoroughly, but it looks like doc generation has become even slower after the bump to the latest toolchain version. See <a class=\"stream-topic\" data-stream-id=\"509433\" href=\"/#narrow/channel/509433-Brownian-motion/topic/CI.20is.20very.20slow/with/526794260\">#Brownian motion &gt; CI is very slow</a>.</p>",
        "id": 526811544,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751465517
    },
    {
        "content": "<p>Ouch, yeah, I just had a 10 minute doc-gen build on a no-op commit...</p>",
        "id": 526838242,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751472942
    },
    {
        "content": "<p>I'll try to rebase my PR in the next week, which should probably fix this at the same time</p>",
        "id": 526896710,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751501161
    },
    {
        "content": "<p>Same problem here, seems that it from 40 minutes to 5 hours...</p>",
        "id": 526924731,
        "sender_full_name": "Jz Pan",
        "timestamp": 1751523781
    },
    {
        "content": "<p>CI is failing in FLT because I bumped mathlib in <code>main</code> triggering a build of doc-gen which <a href=\"https://github.com/ImperialCollegeLondon/FLT/actions/runs/16038445978/job/45255185656\">timed out after 5h50</a>.</p>",
        "id": 526934363,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751528267
    },
    {
        "content": "<p>Disabling equations seems to fix some of this slowdown but something is still very slow in mathlib files deep in the dependency chain</p>",
        "id": 526942513,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531113
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/P0_TkwlaAaGMihawqSwSHBI4/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/P0_TkwlaAaGMihawqSwSHBI4/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2497x1015\" src=\"/user_uploads/thumbnail/3121/P0_TkwlaAaGMihawqSwSHBI4/image.png/840x560.webp\"></a></div><p>well this can't be good</p>",
        "id": 526942950,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531280
    },
    {
        "content": "<p>Ok I know why this happens</p>",
        "id": 526943266,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531404
    },
    {
        "content": "<p>CC <span class=\"user-mention\" data-user-id=\"656225\">@Cameron Zwarich</span>, I don't know if this is a regressio nfrom the new compiler or that some definition was changed but:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">modidx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">getModuleIdxFor?</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">unreachable!</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">moduleName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">allImportedModuleNames</span><span class=\"o\">[</span><span class=\"n\">modidx</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">relevantModules</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">moduleName</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">continue</span>\n\n<span class=\"w\">    </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">tryCatchRuntimeEx</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">          </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">5000000</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getOptions</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">fileName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getFileName</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">fileMap</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getFileMap</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">analysis</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">DocInfo</span><span class=\"bp\">.</span><span class=\"n\">ofConstant</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cinfo</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toIO</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">dinfo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">analysis</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">moduleName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">allImportedModuleNames</span><span class=\"o\">[</span><span class=\"n\">modidx</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">[</span><span class=\"n\">moduleName</span><span class=\"o\">]</span><span class=\"bp\">!</span>\n<span class=\"w\">          </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"n\">moduleName</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">members</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"bp\">.</span><span class=\"n\">members</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ModuleMember</span><span class=\"bp\">.</span><span class=\"n\">docInfo</span><span class=\"w\"> </span><span class=\"n\">dinfo</span><span class=\"o\">)}</span>\n<span class=\"w\">        </span><span class=\"k\">else</span>\n<span class=\"w\">          </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">res</span>\n<span class=\"w\">      </span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">getRef</span><span class=\"bp\">.</span><span class=\"n\">getPos?</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getFileMap</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toPosition</span><span class=\"w\"> </span><span class=\"n\">pos</span>\n<span class=\"w\">          </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"WARNING: Failed to obtain information in file: {pos}, for: {name}, {‚Üê e.toMessageData.toString}\"</span>\n<span class=\"w\">        </span><span class=\"k\">else</span>\n<span class=\"w\">          </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"WARNING: Failed to obtain information for: {name}: {‚Üê e.toMessageData.toString}\"</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">res</span>\n<span class=\"w\">      </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>In this loop in doc-gen defined here <a href=\"https://github.com/leanprover/doc-gen4/blob/38a4f87cadd82f16d4c3e89dcc7140b8512b0bf2/DocGen4/Process/Analyze.lean#L130-L159\">https://github.com/leanprover/doc-gen4/blob/38a4f87cadd82f16d4c3e89dcc7140b8512b0bf2/DocGen4/Process/Analyze.lean#L130-L159</a> we have  <code>env.allImportedModuleNames</code> which is not O(1) but computed by mapping the module name from the import array so for environments with a lot of constants we keep repeating this computation over and over again. Retrospectively it is clearly my mistake for not pulling this <code>env.allImportedModuleNames</code> out of the loop into a <code>let</code> but the compiler should be able to do that maybe?</p>",
        "id": 526944045,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531676
    },
    {
        "content": "<p>I updated the tag <code>v4.22.0-rc2</code> with the performance fix, you should  get the top level commit <code>928dded</code> in your lock file which fixes this issue CC <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span></p>",
        "id": 526944691,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531920
    },
    {
        "content": "<p>And <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>  of course</p>",
        "id": 526944844,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751531975
    },
    {
        "content": "<p>Thanks a lot for the prompt fix! I'll give it a go on FLT now.</p>",
        "id": 526946516,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751532500
    },
    {
        "content": "<p>Actually I realise now that doc-gen is not listed in my lake-manifest so I don't really know where to start. It's not as simple as <code>lake update</code>? That's the only trick I know :-(</p>",
        "id": 526947364,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751532770
    },
    {
        "content": "<p>There is a recommended setup described in the doc-gen4 repo README but FLT doesn't seem to follow that so I don't know I'm afraid.</p>",
        "id": 526947584,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1751532859
    },
    {
        "content": "<p>We use the new <code>docgen-action</code> so, since <span class=\"user-mention\" data-user-id=\"395550\">@Henrik B√∂ving</span>  tagged a new commit, <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> should just rerun the failed job and everything should work fine.</p>",
        "id": 526948219,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751533074
    },
    {
        "content": "<p>I have just done it. Let‚Äôs see if it works as expected <a href=\"https://github.com/ImperialCollegeLondon/FLT/actions/runs/16038445978/job/45277793540\">https://github.com/ImperialCollegeLondon/FLT/actions/runs/16038445978/job/45277793540</a></p>",
        "id": 526948629,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751533200
    },
    {
        "content": "<p>This is all way out of my comfort zone, but my understanding was that we were originally using doc-gen in a way which Kim didn't like (I had to type <code>lake -R -Kenv=dev update</code> which made them unhappy) and then Yael changed it to a new way (doc-gen as a new private project?), and now I find out that we're still not using the recommended set-up :-) I would be happy to use any set-up which makes everyone happy (does such a set-up exist?) but would be completely unable to set that up myself. Having said that, it seems that if the current fix at the FLT end is \"do nothing\", this sounds perfect!</p>",
        "id": 526953920,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751534805
    },
    {
        "content": "<p>My understanding was that the doc-gen set-up changes was made specifically to align to the recommended set-up. Are you sure FLT does not follow it?</p>",
        "id": 526955129,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751535203
    },
    {
        "content": "<p>We are basically using the recommended setup. It‚Äôs just been incorporated in the new <code>docgen-action</code>. See here <a href=\"https://github.com/leanprover-community/docgen-action/blob/main/scripts/build_docs.sh\">https://github.com/leanprover-community/docgen-action/blob/main/scripts/build_docs.sh</a></p>",
        "id": 526955204,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751535227
    },
    {
        "content": "<p>There is a small wrinkle, that the CI step generates a project with the lakefile and runs that - so the lakefile is never committed to the repository. But that's inessential.</p>",
        "id": 526955292,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1751535251
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/526948629\">said</a>:</p>\n<blockquote>\n<p>I have just done it. Let‚Äôs see if it works as expected <a href=\"https://github.com/ImperialCollegeLondon/FLT/actions/runs/16038445978/job/45277793540\">https://github.com/ImperialCollegeLondon/FLT/actions/runs/16038445978/job/45277793540</a></p>\n</blockquote>\n<p>Yes, it worked as expected (37 min).</p>",
        "id": 526958136,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751536090
    },
    {
        "content": "<p>Same good news from <a class=\"message-link\" href=\"/#narrow/channel/509433-Brownian-motion/topic/CI.20is.20very.20slow/near/526958077\">#Brownian motion &gt; CI is very slow @ üí¨</a></p>",
        "id": 526958318,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1751536141
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik B√∂ving</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/526944045\">said</a>:</p>\n<blockquote>\n<p>Retrospectively it is clearly my mistake for not pulling this <code>env.allImportedModuleNames</code> out of the loop into a <code>let</code> but the compiler should be able to do that maybe?</p>\n</blockquote>\n<p>Sadly, until we get recursive join points this won't happen. Perhaps specialization worked differently in the old compiler in a way that would enable this, but I don't see how it could have (due to it also using a cache of specializations that does not include extra decls to be inserted in the caller of the specialized loop).</p>",
        "id": 527026923,
        "sender_full_name": "Cameron Zwarich",
        "timestamp": 1751557121
    },
    {
        "content": "<p>It's more likely that it's from me changing the definition :)</p>",
        "id": 527037970,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751560917
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik B√∂ving</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/526944691\">said</a>:</p>\n<blockquote>\n<p>I updated the tag <code>v4.22.0-rc2</code> with the performance fix, you should  get the top level commit <code>928dded</code> in your lock file which fixes this issue</p>\n</blockquote>\n<p>Thank you, it goes back to 35 minutes.</p>",
        "id": 527060104,
        "sender_full_name": "Jz Pan",
        "timestamp": 1751570128
    },
    {
        "content": "<p>FLT CI is green again! Many thanks all!</p>",
        "id": 527075953,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751578413
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/526896710\">said</a>:</p>\n<blockquote>\n<p>I'll try to rebase my PR in the next week</p>\n</blockquote>\n<p>This is now merged!</p>",
        "id": 527143452,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751621715
    },
    {
        "content": "<p>What's the status here? As far as I can see the <code>docgen-action</code> is attempting to cache the Mathlib parts of the docs. However looking at recent Carleson logs it seems like Mathlib docs are still being rebuilt.</p>",
        "id": 535943252,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1756088331
    },
    {
        "content": "<p>Separately, I've just made 3 PRs to <a href=\"https://github.com/leanprover-community/docgen-action/pulls\">https://github.com/leanprover-community/docgen-action/pulls</a>.</p>\n<p>Perhaps <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> and/or <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> could sanity check these for me?</p>",
        "id": 535943701,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1756088757
    },
    {
        "content": "<p>The next step is to have the caching action use <code>lake query</code> to list the files to cache</p>",
        "id": 535964205,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756104942
    },
    {
        "content": "<p>(the PR above was about making that list accurate)</p>",
        "id": 535964340,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756105014
    },
    {
        "content": "<p>I think there is still some missing work on the doc-gen side to prevent it being affected by stale files from a previous run (eg not listing files and instead taking arguments)</p>",
        "id": 535964523,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756105093
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20doc-gen4.20so.20slow.3F/near/535943252\">said</a>:</p>\n<blockquote>\n<p>What's the status here? As far as I can see the <code>docgen-action</code> is attempting to cache the Mathlib parts of the docs. However looking at recent Carleson logs it seems like Mathlib docs are still being rebuilt.</p>\n</blockquote>\n<p>I also noticed this, and opened <a href=\"https://github.com/leanprover-community/docgen-action/pull/3\">docgen-action#3</a> last month</p>",
        "id": 536206478,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1756204464
    },
    {
        "content": "<p>It's so slow on my builds i'm considering puting them on a side ci that only trigger when a commit is tagged. the default setup we get that runs it on every build is kind of too much</p>",
        "id": 537008056,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756673678
    }
]