[
    {
        "content": "<p>I have a student working on some model theory and they have a problem which was solved in Lean 3 in the flypitch project. I wanted to take a look at what was done there but I can no longer get it to work (I cloned it fine):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">buster</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">projects</span><span class=\"bp\">/</span><span class=\"n\">flypitch</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">leanproject</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"bp\">-</span><span class=\"n\">mathlib</span><span class=\"bp\">-</span><span class=\"n\">cache</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">Error</span><span class=\"o\">(</span><span class=\"n\">Download</span><span class=\"o\">(</span><span class=\"n\">HttpStatus</span><span class=\"o\">(</span><span class=\"mi\">404</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">next_error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">InternalBacktrace</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">})</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"n\">nonexistent</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"mf\">3.4</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">`</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">caused</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">expanded_assets</span><span class=\"bp\">/</span><span class=\"n\">v3</span><span class=\"bp\">.</span><span class=\"m\">4</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">buzzard</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">/</span><span class=\"n\">aru_sptirnlkmcf0_file'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">caused</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">http</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">unsuccessful</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">404</span>\n<span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">leanpkg'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">configure'</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"mf\">1.</span>\n</code></pre></div>\n<p>I see it's trying to download lean 3.4.2 from the lean 4 releases. Is there a fix for this? <code>leanproject build</code> gives me the same error.</p>",
        "id": 464035532,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724242648
    },
    {
        "content": "<p>Are you able to open the repository on gitpod?</p>",
        "id": 464036872,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724242924
    },
    {
        "content": "<p>Sorry, I have no idea how to do that if there's not a gitpod button in the README. The repo is this <a href=\"https://github.com/flypitch/flypitch\">https://github.com/flypitch/flypitch</a></p>",
        "id": 464037007,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724242980
    },
    {
        "content": "<p>easy way: Install the gitpod extension on your browser</p>",
        "id": 464037110,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243028
    },
    {
        "content": "<p>Here's a direct URL : <a href=\"http://gitpod.io/#https://github.com/flypitch/flypitch\">gitpod.io/#https://github.com/flypitch/flypitch</a></p>",
        "id": 464037266,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243081
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/Can't.20run.20lean.203.20project/near/464037007\">said</a>:</p>\n<blockquote>\n<p>Sorry, I have no idea how to do that if there's not a gitpod button in the README. The repo is this <a href=\"https://github.com/flypitch/flypitch\">https://github.com/flypitch/flypitch</a></p>\n</blockquote>\n<p>All you need to do is add <a href=\"http://gitpod.io/\">gitpod.io/#</a> before the repo name</p>",
        "id": 464037310,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724243096
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> : different subject : why is the gitpod image installing the lean4 extension and which is in tunr asking me to install lean4?</p>",
        "id": 464037516,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243159
    },
    {
        "content": "<p>Fwiw, I am getting the same error as Kevin on gitpod</p>",
        "id": 464037683,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243195
    },
    {
        "content": "<p>Extensions are not managed by the image but by the <code>.gitpod.yml</code></p>",
        "id": 464037715,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724243203
    },
    {
        "content": "<p>Yes, but the flypitch repo doesn't have a gitpod.yml config file</p>",
        "id": 464038125,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243308
    },
    {
        "content": "<p>Given that the same error occurs inside and outside the docker container, I think elan just isn't able to fetch lean3 images and picks a default lean4 toolchain instead. <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> : if making a PR to flypitch is okay, I can add a .gitpod.yml file that might just use an existing lean3 image and work. (CC: <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> )</p>",
        "id": 464039050,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243542
    },
    {
        "content": "<p>I can confirm that my solution will work since I just opened mathlib3 successfully on gitpod</p>",
        "id": 464040445,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724243820
    },
    {
        "content": "<p>Try</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">-lean_version = \"3.4.2\"</span>\n<span class=\"gi\">+lean_version = \"leanprover-community/lean:v3.4.2\"</span>\n</code></pre></div>",
        "id": 464044738,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1724244627
    },
    {
        "content": "<p>In <code>leanpkg.toml</code>? Now I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">buster</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">projects</span><span class=\"bp\">/</span><span class=\"n\">flypitch</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">leanproject</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">project</span><span class=\"w\"> </span><span class=\"n\">flypitch</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lean'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binary</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">provided</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">linux'</span>\n<span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">leanpkg'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">configure'</span><span class=\"o\">]</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"bp\">-</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"mf\">1.</span>\n<span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">buster</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">projects</span><span class=\"bp\">/</span><span class=\"n\">flypitch</span><span class=\"bp\">$</span>\n</code></pre></div>",
        "id": 464055318,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724246467
    },
    {
        "content": "<p>It works locally for me, presumably because I have the correct Lean version already installed (although actually when I run Lean locally I seem to have some <code>LEAN_PATH</code> issues later).<br>\nPRs to Flypitch improving the situation (Gitpod/leanpkg.toml fixes) are welcome.</p>",
        "id": 464058659,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1724247197
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/stream/113488-general/topic/Can't.20run.20lean.203.20project/near/464044738\">said</a>:</p>\n<blockquote>\n<p>Try</p>\n<p><div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">-lean_version = \"3.4.2\"</span>\n<span class=\"gi\">+lean_version = \"leanprover-community/lean:v3.4.2\"</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Don't you mean <code>leanprover/lean:v3.4.2</code>? EDIT: no, that similarly seems to say \"no binary package provided\".</p>",
        "id": 464061767,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724247924
    },
    {
        "content": "<p>Ah the issue is something (elan?) doesn't know how to follow github redirects. PR incoming.</p>",
        "id": 464062823,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724248221
    },
    {
        "content": "<p><a href=\"https://github.com/flypitch/flypitch/pull/41\">https://github.com/flypitch/flypitch/pull/41</a></p>",
        "id": 464063353,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724248358
    },
    {
        "content": "<p>PR for gitpod incoming</p>",
        "id": 464063456,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248384
    },
    {
        "content": "<p><a href=\"https://github.com/flypitch/flypitch/pull/40\">https://github.com/flypitch/flypitch/pull/40</a></p>",
        "id": 464063628,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> I ended up also having to change leanpkg.toml</p>",
        "id": 464064098,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248560
    },
    {
        "content": "<p>I'm happy to close mine if unneeded, but does what you changed in the leanpkg.toml work for you? For me in Gitpod Sebastian's change didn't work and I needed what I did.</p>",
        "id": 464064335,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724248610
    },
    {
        "content": "<p>It didn't. May I borrow your change?</p>",
        "id": 464065032,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248715
    },
    {
        "content": "<p>Mine also adds the gitpod stuff</p>",
        "id": 464065074,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248722
    },
    {
        "content": "<p>Sure, go for it.</p>",
        "id": 464066227,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724248890
    },
    {
        "content": "<p>Now gitpod works, but leanproject cache can't find oleans</p>",
        "id": 464066815,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248975
    },
    {
        "content": "<p><code>Looking for flypitch oleans for 95fad36\n  locally...</code></p>",
        "id": 464066920,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724248992
    },
    {
        "content": "<p>Oh wait that's just for flypitch files. Probably doesn't matter</p>",
        "id": 464067052,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724249011
    },
    {
        "content": "<p>so the gitpod setup appears to work, but takes a while to setup. Let me see if I can get it working on the docker images that Yael maintains</p>",
        "id": 464069461,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724249469
    },
    {
        "content": "<p>So the PR \"works\" although it seems to take forever for the yellow bar to disappear when opening a file in the project. I conjecture that this is because the flypitch project itself needs to be build. PR 40 is ready for review <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span></p>",
        "id": 464073054,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724250496
    },
    {
        "content": "<p>I am getting a warning : <code>WARNING: Lean version mismatch: installed version is 3.4.2, but package requires leanprover/lean3:3.4.2</code></p>",
        "id": 464075221,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724250924
    },
    {
        "content": "<p>2 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/stream/113488-general/topic/Dockerhub\">#general &gt; Dockerhub</a> by <span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span>.</p>",
        "id": 464164921,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724272922
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/Can't.20run.20lean.203.20project/near/464064098\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> I ended up also having to change leanpkg.toml</p>\n</blockquote>\n<p>This doesn't sound great, as it doesn't scale to every other abandoned lean3 project. Was the config wrong, or did something change with elan?</p>",
        "id": 464168574,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724274041
    },
    {
        "content": "<p>I tested it again. Apparently the warning is a serious issue. leanproject does not get the cache at all. So the build command builds all of mathlib3</p>",
        "id": 464173905,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724275793
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/Can't.20run.20lean.203.20project/near/464075221\">said</a>:</p>\n<blockquote>\n<p>I am getting a warning : <code>WARNING: Lean version mismatch: installed version is 3.4.2, but package requires leanprover/lean3:3.4.2</code></p>\n</blockquote>\n<p>this warning</p>",
        "id": 464173985,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724275806
    }
]