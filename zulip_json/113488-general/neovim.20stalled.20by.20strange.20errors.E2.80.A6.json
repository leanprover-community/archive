[
    {
        "content": "<p>I get a lot of errors like this tonight, which end up stalling neovim… What could happen?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">vim</span><span class=\"bp\">.</span><span class=\"n\">schedule</span><span class=\"w\"> </span><span class=\"n\">lua</span><span class=\"w\"> </span><span class=\"n\">callback</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">274</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">end_col'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">range</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">traceback</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">C</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">nvim_buf_set_extmark'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">274</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">iter</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">207</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">filter'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">254</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">handler'</span>\n<span class=\"w\">        </span><span class=\"bp\">.../</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">1109</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">''</span>\n<span class=\"w\">        </span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span>\n</code></pre></div>",
        "id": 510762823,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744058312
    },
    {
        "content": "<p>Does it happen with any file, or if not anything you can share to help me reproduce?</p>",
        "id": 510764339,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744058942
    },
    {
        "content": "<p>It happens with the file  Mathlib/RingTheory/Polynomial/Eisenstein/Generalized.lean of <a href=\"https://github.com/leanprover-community/mathlib4/pull/23710\">#23710</a></p>",
        "id": 510764605,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744059045
    },
    {
        "content": "<p>I can't reproduce with that file yet -- could I ask if you could double check you're up to date on lean.nvim? Is there anything in particular I should do? Or it happens for you just from moving around?</p>",
        "id": 510765510,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744059427
    },
    {
        "content": "<p>Meanwhile I'll also try to do it with your dotfiles that you shared.</p>",
        "id": 510765619,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744059478
    },
    {
        "content": "<p>I am getting this over and over now. It seems pretty sporadic.</p>",
        "id": 512579835,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744816707
    },
    {
        "content": "<p>Probably not a coincidence : at the same time, <code>top</code> shows that <code>nvim</code> takes 100% of CPU.</p>",
        "id": 512580193,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744816814
    },
    {
        "content": "<p>Does it have something to do with auto-indent? I seem to get it when pushing text to the next line.</p>",
        "id": 512580400,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744816878
    },
    {
        "content": "<p>It happens very often when I delete lines (<code>dd</code>).</p>",
        "id": 512580529,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744816915
    },
    {
        "content": "<p>Separately, overall performance is more sluggish but I can't tell whether the culprit is the async elab features, nvim, the extension, or else.</p>",
        "id": 512580632,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744816936
    },
    {
        "content": "<p>Can I confirm both of you are up to date? And I don't suppose either of you has anything that can help me reproduce? Not that I've done a lot of lean (as opposed to lean.nvim dev itself) recently so it's possible it's easy to reproduce and I just need to try. If it's exactly the traceback from above I could put in something to simply make it go away but I would like to avoid doing so if possible in favor of reproducing and seeing what/where the actual issue is :/</p>",
        "id": 512679655,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744834971
    },
    {
        "content": "<p>The best I can do to claim I'm “up to date” is entering <code>:Lazy</code>, and typing <code>U</code>. Is that OK?</p>",
        "id": 512679887,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744835065
    },
    {
        "content": "<p>Yes, that should mean you are!</p>",
        "id": 512679935,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744835089
    },
    {
        "content": "<p>I'll give you the commit in my local clone in a 5, 4, 3,...</p>",
        "id": 512680223,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744835205
    },
    {
        "content": "<p>I was about to tell you to just show me <code>checkhealth lean</code>, but I see the version info there is... broken :( so I am fixing that now too</p>",
        "id": 512680336,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744835248
    },
    {
        "content": "<p><code>ddb881407213d27</code></p>",
        "id": 512680458,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744835290
    },
    {
        "content": "<p>It is from March 30 so let me update</p>",
        "id": 512680483,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744835308
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">19</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc3</span><span class=\"bp\">-</span><span class=\"mi\">72</span><span class=\"bp\">-</span><span class=\"n\">g6c1b01338c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">OK</span><span class=\"w\"> </span><span class=\"n\">Neovim</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">enough</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"ss\">`vim.version</span><span class=\"o\">()</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">OK</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">runnable</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"c1\">--version`:  Lake version 5.0.0-045d07d (Lean version 4.19.0-rc3)</span>\n</code></pre></div>",
        "id": 512680495,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744835312
    },
    {
        "content": "<p>FWIW I have also noticed speed issues in nvim primarily when jumping to a definition which lands me in the middle of some large file.</p>",
        "id": 512680769,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1744835415
    },
    {
        "content": "<p>Hmm. Packer is telling me things are not very much out of date but the local clone is way off... I might be looking the wrong place. Either way I should be up to date now. I will report back if I see more issues.</p>",
        "id": 512680961,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744835481
    },
    {
        "content": "<p>OK, I'll also follow up with some instructions on how to collect a profile shortly, but one of the two things I'm trying to get finished right now is some memoization, so there's not much point doing so until I'm done given that's a source of slowness that I'm already aware of and is affecting things.</p>",
        "id": 512681590,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744835730
    },
    {
        "content": "<p>Still there -- <code>dd</code> is triggering it</p>",
        "id": 512683989,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744836745
    },
    {
        "content": "<p>So open some random file and dd and you get a traceback?</p>",
        "id": 512684556,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744836984
    },
    {
        "content": "<p>By opening a random file, do you wish that I open <code>/dev/random</code>?</p>",
        "id": 512684748,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837066
    },
    {
        "content": "<p>typically, yes.</p>",
        "id": 512684835,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837097
    },
    {
        "content": "<p>No sorry I just meant arbitrary</p>",
        "id": 512684860,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837109
    },
    {
        "content": "<p>It has to be a lean file. I don't get this otherwise.</p>",
        "id": 512684903,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837133
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>Error<span class=\"w\"> </span>executing<span class=\"w\"> </span>vim.schedule<span class=\"w\"> </span>lua<span class=\"w\"> </span>callback:<span class=\"w\"> </span>...e/nvim/site/pack/packer/start/lean.nvim/lua/lean/lsp.lua:219:<span class=\"w\"> </span>Invalid<span class=\"w\"> </span><span class=\"s1\">'end_col'</span>:<span class=\"w\"> </span>out<span class=\"w\"> </span>of<span class=\"w\"> </span>range\nstack<span class=\"w\"> </span>traceback:\n<span class=\"w\">        </span><span class=\"o\">[</span>C<span class=\"o\">]</span>:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"s1\">'nvim_buf_set_extmark'</span>\n<span class=\"w\">        </span>...e/nvim/site/pack/packer/start/lean.nvim/lua/lean/lsp.lua:219:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"s1\">'f'</span>\n<span class=\"w\">        </span>...Cellar/neovim/0.11.0/share/nvim/runtime/lua/vim/iter.lua:207:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"s1\">'filter'</span>\n<span class=\"w\">        </span>...e/nvim/site/pack/packer/start/lean.nvim/lua/lean/lsp.lua:199:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"s1\">'handler'</span>\n<span class=\"w\">        </span>.../neovim/0.11.0/share/nvim/runtime/lua/vim/lsp/client.lua:1109:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"s1\">''</span>\n<span class=\"w\">        </span>vim/_editor.lua:<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span>&lt;vim/_editor.lua:0&gt;\n</code></pre></div>\n<p>Same as above</p>",
        "id": 512684923,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837143
    },
    {
        "content": "<p>As in you deterministically are getting a traceback if you open any old Mathlib file and delete a line?</p>",
        "id": 512684924,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837143
    },
    {
        "content": "<p>Yes.</p>",
        "id": 512685000,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837193
    },
    {
        "content": "<p>Line 79 in <code>Mathlib.RingTheory.Valuation.ValuationSubring</code></p>",
        "id": 512685181,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837249
    },
    {
        "content": "<p>So strange, that definitely does not happen to me, so I really would love to know what's different. Let me try that file.</p>",
        "id": 512685221,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837268
    },
    {
        "content": "<p>I didn't expect it to be deterministic. But I just open <code>Mathlib/GroupTheory/Abelianization.lean</code>,  I'm at line 39, and <code>8dd</code>, followed by <code>u</code>, triggers it (at undo).</p>",
        "id": 512685230,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837270
    },
    {
        "content": "<p>I did it 5 or so times in a row</p>",
        "id": 512685270,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837291
    },
    {
        "content": "<p>Cursor positioned in the first column</p>",
        "id": 512685299,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837306
    },
    {
        "content": "<p>Aha! Perfect, that does it! Thank you (both of you)!</p>",
        "id": 512685300,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837306
    },
    {
        "content": "<p>God forbid you <code>dd</code> and then <code>u</code></p>",
        "id": 512685431,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837344
    },
    {
        "content": "<p>Of course it happened once and now has not happened again the next 5 times, but OK at least I have seen it once.</p>",
        "id": 512685601,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837420
    },
    {
        "content": "<p>Sometimes I get one of these error messages, and sometimes a full screen of them. (10 times the same stuff, more or less…)</p>",
        "id": 512685730,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744837453
    },
    {
        "content": "<p>Yes, I thought I had crashed the editor but enough returns got me back</p>",
        "id": 512685820,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837491
    },
    {
        "content": "<p>I did a few more times. It is not 100% but still happens more often than not</p>",
        "id": 512685960,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1744837555
    },
    {
        "content": "<p>OK I put in a fix (at least I haven't seen a traceback leak through now in 10 tries). Please update again and let me know if you still see them!</p>",
        "id": 512687669,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837929
    },
    {
        "content": "<p>(None of this will have anything to do with stalling unfortunately)</p>",
        "id": 512687819,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744837958
    },
    {
        "content": "<p>I still have it. Line 51 of Abelianization, 8dd/u.</p>",
        "id": 512688432,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838069
    },
    {
        "content": "<p>Can you show me what the traceback looks like now?</p>",
        "id": 512688766,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744838132
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">vim</span><span class=\"bp\">.</span><span class=\"n\">schedule</span><span class=\"w\"> </span><span class=\"n\">lua</span><span class=\"w\"> </span><span class=\"n\">callback</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">219</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">end_col'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">range</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">traceback</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">C</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">nvim_buf_set_extmark'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">219</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">iter</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">207</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">filter'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">199</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">handler'</span>\n<span class=\"w\">        </span><span class=\"bp\">.../</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">1109</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">''</span>\n<span class=\"w\">        </span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span>\n</code></pre></div>",
        "id": 512688873,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838154
    },
    {
        "content": "<p>OK, one more try then... Lazy update and cross our fingers.</p>",
        "id": 512690102,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744838563
    },
    {
        "content": "<p>Same…</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">vim</span><span class=\"bp\">.</span><span class=\"n\">schedule</span><span class=\"w\"> </span><span class=\"n\">lua</span><span class=\"w\"> </span><span class=\"n\">callback</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">219</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">end_col'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">range</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">traceback</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"n\">C</span><span class=\"o\">]:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">nvim_buf_set_extmark'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">219</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">Cellar</span><span class=\"bp\">/</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">iter</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">207</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">filter'</span>\n<span class=\"w\">        </span><span class=\"bp\">...</span><span class=\"n\">ambert</span><span class=\"bp\">/.</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lazy</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">199</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">handler'</span>\n<span class=\"w\">        </span><span class=\"bp\">.../</span><span class=\"n\">neovim</span><span class=\"bp\">/</span><span class=\"mf\">0.11</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">share</span><span class=\"bp\">/</span><span class=\"n\">nvim</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">lua</span><span class=\"bp\">/</span><span class=\"n\">vim</span><span class=\"bp\">/</span><span class=\"n\">lsp</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">1109</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">''</span>\n<span class=\"w\">        </span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">vim</span><span class=\"bp\">/_</span><span class=\"n\">editor</span><span class=\"bp\">.</span><span class=\"n\">lua</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span>\n</code></pre></div>\n<p>and if I press <code>Enter</code>, the same message repeats over and over.</p>",
        "id": 512690352,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838656
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/AavS0NaSx1ChN4dhON0ppYxA/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/AavS0NaSx1ChN4dhON0ppYxA/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2464x1536\" src=\"/user_uploads/thumbnail/3121/AavS0NaSx1ChN4dhON0ppYxA/image.png/840x560.webp\"></a></div>",
        "id": 512690400,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838682
    },
    {
        "content": "<p>A new error message, from satellite (Major Tom to Ground Control…)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">(</span><span class=\"n\">satellite</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">handler</span><span class=\"bp\">=</span><span class=\"n\">gitsigns</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"bp\">=</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">row</span><span class=\"bp\">=</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sign_hl_group</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"SatelliteGitSignsChange\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sign_text</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\" │\"</span><span class=\"w\"> </span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"bp\">=</span><span class=\"s2\">\"Invalid 'line':</span>\n<span class=\"s2\">error(satellite.nvim): handler=gitsigns buf=6 row=20 opts={ id = 21, priority = 20, sign_hl_group = \"</span><span class=\"n\">SatelliteGitSignsChange</span><span class=\"s2\">\", sign_text = \"</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"s2\">\" }, err=\"</span><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">line'</span><span class=\"o\">:</span>\n<span class=\"n\">error</span><span class=\"o\">(</span><span class=\"n\">satellite</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">handler</span><span class=\"bp\">=</span><span class=\"n\">gitsigns</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"bp\">=</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">row</span><span class=\"bp\">=</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"n\">opts</span><span class=\"bp\">=</span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sign_hl_group</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"SatelliteGitSignsAdd\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sign_text</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\" │\"</span><span class=\"w\"> </span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"bp\">=</span><span class=\"s2\">\"Invalid 'line': ou</span>\n<span class=\"s2\">error(satellite.nvim): handler=gitsigns buf=6 row=20 opts={ id = 21, priority = 20, sign_hl_group = \"</span><span class=\"n\">SatelliteGitSignsChange</span><span class=\"s2\">\", sign_text = \"</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"s2\">\" }, err=\"</span><span class=\"n\">Invalid</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">line'</span><span class=\"o\">:</span>\n<span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"s2\">\"</span>\n</code></pre></div>",
        "id": 512690843,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838872
    },
    {
        "content": "<p>:/ -- But something is strange because the line numbers are off there from what's on <code>main</code> after my commits I think. Can you show me <code>:checkhealth lean</code> now?</p>",
        "id": 512690947,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744838908
    },
    {
        "content": "<p>You're sure you ran <code>Lazy update</code> again right?</p>",
        "id": 512691010,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744838942
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lean</span><span class=\"bp\">.</span><span class=\"n\">nvim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v2024</span><span class=\"bp\">.</span><span class=\"m\">12</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">-</span><span class=\"mi\">193</span><span class=\"bp\">-</span><span class=\"n\">gf1d9e79</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 512691085,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1744838977
    },
    {
        "content": "<p>That's correct :/ OK, back to the drawing board then, even though I have not seen this again yet, will keep trying.</p>",
        "id": 512691224,
        "sender_full_name": "Julian Berman",
        "timestamp": 1744839024
    }
]