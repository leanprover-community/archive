[
    {
        "content": "<p>I just stumbled upon this puzzling example, which came up when trying to get aesop to prove a lemma of the form <code>¬¨ Property ‚Üî a ‚â† b ‚à® c = d</code> from an existing lemma saying <code>Property ‚Üî a = b ‚àß c ‚â† d</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">‚à®</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 514082889,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1745490821
    },
    {
        "content": "<p>This is a goal for <code>tauto</code></p>",
        "id": 514097243,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745494457
    },
    {
        "content": "<p>Why is this outside the intended scope of <code>aesop</code>?</p>",
        "id": 514103235,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1745496172
    },
    {
        "content": "<p>You could have <code>aesop</code> call <code>tauto</code>, but that might be slow for complicated goals</p>",
        "id": 514103918,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745496339
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/aesop.20can't.20prove.20.C2.AC.20p.20.E2.88.A8.20q.20from.20p.20.E2.86.92.20q/near/514097243\">said</a>:</p>\n<blockquote>\n<p>This is a goal for <code>tauto</code></p>\n</blockquote>\n<p>I am aware that <code>tauto</code> can prove this goal <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> but it cannot prove the lemma <code>¬¨ Property ‚Üî a ‚â† b ‚à® c = d</code> by calling the lemma <code>Property ‚Üî a = b ‚àß c ‚â† d</code> (because it does not know how to call lemmas, by design)</p>",
        "id": 514104094,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1745496369
    },
    {
        "content": "<p>The solution is to <code>have</code> the lemma you want</p>",
        "id": 514104204,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745496398
    },
    {
        "content": "<p>or <code>rw</code> since it's an iff</p>",
        "id": 514104218,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745496403
    },
    {
        "content": "<p>Again, I am aware</p>",
        "id": 514107725,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1745497025
    },
    {
        "content": "<p>For me the big problem with Aesop as a general tool for doing basic stuff, is that for it to work like that, a ton of things need to be tagged @aesop. Probably you can tag some logic lemmas with @aesop and this will fix the problem. I think that where Aesop has shown its real utility is being the general tool powering tactics like <code>aesop_cat</code>, and maybe what is happening here is that one could make another tactic <code>aesop_tauto</code> which would solve this goal. But my mental model of aesop is that it will prove goals which can be proved with cases, simp and solve_by_elim, and that you might not want to expect too much more from \"out of the box\" aesop, because the Great Tag Every Lemma With Aesop project never happened (and it was never really clear to me whether it was supposed to happen).</p>",
        "id": 514131985,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745502735
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/aesop.20can't.20prove.20.C2.AC.20p.20.E2.88.A8.20q.20from.20p.20.E2.86.92.20q/near/514131985\">said</a>:</p>\n<blockquote>\n<p>is that for it to work like that, a ton of things need to be tagged @aesop.</p>\n</blockquote>\n<p>I think this just means you need to do the tagging. For instance, I was recently preparing a presentation and looking at the proof, I had this goal (extracted) with this proof.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">extracted</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AlgHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSelfAdjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hœÜ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"n\">œÜ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h_spec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StarAlgHom</span><span class=\"bp\">.</span><span class=\"n\">restrictScalars</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ‚Çê</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚äÜ</span><span class=\"w\"> </span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚àâ</span><span class=\"w\"> </span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">(</span><span class=\"n\">‚Ñù</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h_eqOn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚áë</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">œÜ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_eqOn_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚áë</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">})</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚áë</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">spectrum</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">zero_ne_one</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">calc</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h_eqOn_x</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_singleton</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>I really didn't want to tel my audience that we didn't have automation that could handle it. The goal boils down to this, which I hope we can all agree is something <code>aesop</code> should be able to prove, but it couldn't at the time because the forward rule it now uses below didn't exist / wasn't tagged. The solution was to create / tag it.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h_mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_eqOn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h_eqOn_x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">aesop?</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  simp_all only [Set.eqOn_singleton, Pi.one_apply]</span>\n<span class=\"cm\">  have fwd : f x = (0 : Œ± ‚Üí ùïú) x := Set.EqOn.eq_of_mem (s := s) h_eqOn h_mem</span>\n<span class=\"cm\">  simp_all only [Pi.zero_apply, zero_ne_one]</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>\n<p>Aside: currently <code>aesop</code> can't prove the <code>extracted</code> goal above either, but this is due to a separate bug in the new stateful reasoning engine. It can be done with stateful reasoning disabled.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"c1\">-- first line required due to a new bug in aesop: https://github.com/leanprover-community/aesop/issues/207</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"bp\">.</span><span class=\"n\">dev</span><span class=\"bp\">.</span><span class=\"n\">statefulForward</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 514167385,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1745511134
    },
    {
        "content": "<p>Yael's original example is definitely in scope for Aesop. Really, Aesop should be complete for classical (or constructive) propositional logic, so it should be able to replace <code>tauto</code>. But making it so requires someone to think about how to do this (efficiently); it's not just a matter of tagging more stuff. I hope I'll get to it eventually.</p>",
        "id": 514181894,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1745515208
    },
    {
        "content": "<p><span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span> <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> indeed, I was more pushing back against Kevin's remark:<br>\n<span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/aesop.20can't.20prove.20.C2.AC.20p.20.E2.88.A8.20q.20from.20p.20.E2.86.92.20q/near/514131985\">said</a>:</p>\n<blockquote>\n<p>For me the big problem with Aesop as a general tool for doing basic stuff ...</p>\n</blockquote>",
        "id": 514205261,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1745520319
    },
    {
        "content": "<p>So should more stuff be tagged Aesop? The power of simp is that it knows so many lemmas. Aesop can use <code>apply</code> so has far more potential but in practice I'm using simp 100 times more often than Aesop in eg FLT I should think</p>",
        "id": 514209127,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745521321
    },
    {
        "content": "<p>We should definitely tag more lemmas with <code>@[aesop]</code>.</p>",
        "id": 514236195,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1745532474
    },
    {
        "content": "<p>When I'm reviewing PRs and/or proofs, I often ask myself if <code>aesop</code> works. If I think it should but it doesn't, that generally means there is a missing tag.</p>",
        "id": 514252159,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1745542647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/aesop.20can't.20prove.20.C2.AC.20p.20.E2.88.A8.20q.20from.20p.20.E2.86.92.20q/near/514209127\">said</a>:</p>\n<blockquote>\n<p>So should more stuff be tagged Aesop? The power of simp is that it knows so many lemmas. Aesop can use <code>apply</code> so has far more potential but in practice I'm using simp 100 times more often than Aesop in eg FLT I should think</p>\n</blockquote>\n<p><code>aesop</code> tries simp in its proof right?</p>",
        "id": 514296537,
        "sender_full_name": "Edison Xie",
        "timestamp": 1745562003
    }
]