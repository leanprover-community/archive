[
    {
        "content": "<p>I find this warning behavior a little confusing, does anyone have an explanation?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">dlookup_isSome</span>\n\n<span class=\"c1\">-- fails</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">dlookup</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">keys</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">isSome_of_mem</span><span class=\"w\"> </span><span class=\"n\">mem</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n\n<span class=\"c1\">-- succeeds, but with a redundant parameter warning</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">dlookup</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">keys</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">isSome_of_mem</span><span class=\"w\"> </span><span class=\"n\">mem</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">dlookup_isSome</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- succeeds</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">dlookup</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">keys</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">isSome_of_mem</span><span class=\"w\"> </span><span class=\"n\">mem</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">dlookup_isSome</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 544645420,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760407719
    },
    {
        "content": "<p>In the third case, the grind pattern used for the lemma is different to that given by <code>grind =</code>, which is the one used in the second (and the one you told it to use by default).</p>",
        "id": 544646433,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1760408514
    },
    {
        "content": "<p>Right, my confusion is that if you remove the pattern, it then fails (the first case).</p>",
        "id": 544646563,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760408625
    },
    {
        "content": "<p>Oops, I mis-numbered things, have edited. The pattern given by <code>=</code> is needed, and the (less restricted) pattern used in <code>grind [List.dlookup_isSome]</code> is (therefore) also enough, but it is different, so no warning is given.</p>",
        "id": 544646735,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1760408748
    },
    {
        "content": "<p>Yeah, the third makes sense, it highlights that the check is for the exact pattern. Together it suggests the linter doesn't check if removing the redundant patterns gives another valid proof, just what patterns are registered?</p>",
        "id": 544647217,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760409133
    },
    {
        "content": "<p>Yes, it checks which patterns it used, and warns if a pattern was explicitly included in a call that wasn't used. It doesn't check if there's still a proof if the pattern is removed.</p>",
        "id": 544649794,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1760411394
    },
    {
        "content": "<p>What I'm not understanding is why it fails without specifying the <code>=</code> pattern. Isn't that exactly what the attribute I placed above is supposed to be adding? The reason it is redundant is because it recognizes they are the same.</p>",
        "id": 544687833,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760430357
    },
    {
        "content": "<p>Ah! I misunderstood what you were confused about. This time I share your confusion!</p>",
        "id": 545037931,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1760550087
    },
    {
        "content": "<p>I had a similar but different issue: <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/grind.20incorrectly.20redundant.20parameter/with/545125858\">#lean4 &gt; grind incorrectly redundant parameter</a></p>",
        "id": 545125883,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760561689
    },
    {
        "content": "<p>Maybe worth opening an issue since multiple people have run into this? I can try making my example Mathlib independent too if that's helpful.</p>",
        "id": 545431453,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760643041
    }
]