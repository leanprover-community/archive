[
    {
        "content": "<p>This thread is for discussion of LeanSearchClient. A lot of discussion before announcement happened on the thread: <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/471011469\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/LeanSearch/near/471011469</a></p>",
        "id": 471154510,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726630188
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 471154540,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726630202
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> this is fantastic! Thanks!</p>",
        "id": 471156174,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1726630972
    },
    {
        "content": "<p>This is great! Is there any plan to give it access to the current proof state? It would likely be extremely useful to be able to ask the engines for all the theorems matching the current goal (kind of like <code>apply?</code>).</p>",
        "id": 471198796,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1726647691
    },
    {
        "content": "<p>What am I doing wrong?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">unexpected token '#'; expected search_cmd</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>Sorry for being such a noob. This is on <code>c5befd42d5d9755b17c292f81a721e72612b54e4</code> (most recent mathlib commit).</p>",
        "id": 471198968,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726647740
    },
    {
        "content": "<p>Maybe this?</p>\n<p>Due to some technical issues, for now you need the additional import <code>import LeanSearchClient.LoogleSyntax</code> to use <code>#loogle</code>.</p>",
        "id": 471199098,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1726647785
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"242586\">Vincent Beffara</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471198796\">said</a>:</p>\n<blockquote>\n<p>This is great! Is there any plan to give it access to the current proof state? It would likely be extremely useful to be able to ask the engines for all the theorems matching the current goal (kind of like <code>apply?</code>).</p>\n</blockquote>\n<p>It already does that. It tries <code>apply</code>, <code>have</code> and <code>rw</code> (in both directions) and only suggests tactics that work. There may be false positives and negatives due to bugs though (please report here are as an issue).</p>",
        "id": 471199873,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726648007
    },
    {
        "content": "<p>To clarify the above, it tries only the (by default 6) theorems returned by the search server. This is configurable with the options <code>leansearch.queries</code>, <code>moogle.queries</code> and <code>loogle.queries</code>.</p>",
        "id": 471200286,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726648128
    },
    {
        "content": "<p>I mean, can I already say <code>#loogle _</code> (or whatever syntax) and it passes the current goal to loogle as a query?</p>",
        "id": 471200642,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1726648225
    },
    {
        "content": "<p>Oops sorry.</p>",
        "id": 471200838,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726648293
    },
    {
        "content": "<p>It filters by applicability of tactic state. It does not build a query.</p>",
        "id": 471201083,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726648362
    },
    {
        "content": "<p>What is the correct query is a bit subtle but if this can be clarified I can add that.</p>",
        "id": 471201134,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726648383
    },
    {
        "content": "<p>Thinking further, <span class=\"user-mention\" data-user-id=\"242586\">@Vincent Beffara</span> I think that is a brilliant idea. I do not know how to convert a goal state into a loogle query (or queries depending on choices). If someone can describe that I can try to implement.</p>\n<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> Is there a nice way to go from goal state to loogle query?</p>",
        "id": 471205033,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726649588
    },
    {
        "content": "<p>I'm not sure there is something to do here that is better than <code>exact?</code></p>",
        "id": 471208582,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726650616
    },
    {
        "content": "<p>You can look at the goal, have some heuristics for \"the important constants\", and issue a loogle query for those, but ...</p>",
        "id": 471208670,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726650639
    },
    {
        "content": "<p>This is premise selection, and not really a great fit for what loogle does.</p>",
        "id": 471208731,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726650658
    },
    {
        "content": "<p>The only difference I see is we can search all of Mathlib without importing it.</p>",
        "id": 471209190,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726650776
    },
    {
        "content": "<blockquote>\n<p>You can look at the goal, have some heuristics for \"the important constants\", and issue a loogle query for those, but ...</p>\n</blockquote>\n<p>Yeah, that’s the most plausible I can think of as well.</p>",
        "id": 471212530,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726651676
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471199098\">said</a>:</p>\n<blockquote>\n<p>Maybe this?</p>\n<p>Due to some technical issues, for now you need the additional import <code>import LeanSearchClient.LoogleSyntax</code> to use <code>#loogle</code>.</p>\n</blockquote>\n<p>Could <code>#loogle</code> warn if the import is missing, like for example (I think) <code>run_meta</code> does?</p>",
        "id": 471212759,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726651727
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471209190\">said</a>:</p>\n<blockquote>\n<p>The only difference I see is we can search all of Mathlib without importing it.</p>\n</blockquote>\n<p>I can count three times in the last couple of months where I've asked a question here about a missing result when <code>exact?</code> failed and it turned out that I just hadn't imported enough. I've currently trained myself to <code>import Mathlib</code> before asking...</p>",
        "id": 471213544,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726651942
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471212759\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471199098\">said</a>:</p>\n<blockquote>\n<p>Maybe this?</p>\n<p>Due to some technical issues, for now you need the additional import <code>import LeanSearchClient.LoogleSyntax</code> to use <code>#loogle</code>.</p>\n</blockquote>\n<p>Could <code>#loogle</code> warn if the import is missing, like for example (I think) <code>run_meta</code> does?</p>\n</blockquote>\n<p>I will first try to fix the technical issue. There is a clean solution suggested by <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> which I should test - it gets slightly complicated to test without risking breaking CI again.</p>",
        "id": 471214709,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726652283
    },
    {
        "content": "<p>Oops, I did not realize to whom I was replying - sorry for quoting you to yourself.</p>",
        "id": 471214824,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726652324
    },
    {
        "content": "<p>Ah, that’s before the <code>no_keyword</code></p>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471214709\">said</a>:</p>\n<blockquote>\n<p>it gets slightly complicated to test without risking breaking CI again.</p>\n</blockquote>\n<p>You can bump LeanSearchClient to a branch in mathlib’s lakefile in a mathlib PR test CI safely, can you?</p>",
        "id": 471215934,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726652681
    },
    {
        "content": "<p>I also do not want to push to the main of LeanSearchClient. I can push to a branch and on a branch of mathlib change dependencies.</p>",
        "id": 471216138,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726652746
    },
    {
        "content": "<p>Right, that’s what I mean :-)</p>",
        "id": 471216252,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726652768
    },
    {
        "content": "<p>But I am getting a strange error <code>parser 'nonReservedSymbol' was not found</code> with your code even though <br>\n<code>#check Lean.Parser.nonReservedSymbol</code> works.</p>\n<p>Is there something I should open other than <code>Lean.Parser</code>?</p>",
        "id": 471216505,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726652850
    },
    {
        "content": "<p>Never mind. Adding auxiliary definitions worked.</p>",
        "id": 471221340,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726654247
    },
    {
        "content": "<p>Great job!  Now we also just need to add these tools to the search in <a href=\"https://leanprover-community.github.io/mathlib4_docs/index.html\">https://leanprover-community.github.io/mathlib4_docs/index.html</a>.</p>",
        "id": 471222954,
        "sender_full_name": "Jason Rute",
        "timestamp": 1726654774
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471222954\">said</a>:</p>\n<blockquote>\n<p>Great job!  Now we also just need to add these tools to the search in <a href=\"https://leanprover-community.github.io/mathlib4_docs/index.html\">https://leanprover-community.github.io/mathlib4_docs/index.html</a>.</p>\n</blockquote>\n<p>Thanks. It already works in a sense, but I should add docstrings.</p>",
        "id": 471223511,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726654944
    },
    {
        "content": "<p>I have made a PR to test if loogle syntax can be safely used. If CI is fine I can add to main.</p>",
        "id": 471223663,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726655001
    },
    {
        "content": "<p>What do you mean it “already works in a sense”?  You mean you are in the middle of implementing it?  Or are we talking about different things.  I’m talking about something similar to “search with Google” but using one of the other three tools.</p>",
        "id": 471224395,
        "sender_full_name": "Jason Rute",
        "timestamp": 1726655260
    },
    {
        "content": "<p>I just meant searching for the command, not searching <em>with</em> the command.</p>",
        "id": 471224517,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726655292
    },
    {
        "content": "<p>Implementing this is an entirely different task. It is adding javascript to the website generation, maybe to <code>docgen</code>?</p>",
        "id": 471224752,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726655373
    },
    {
        "content": "<p>I agree that it would be very good.</p>",
        "id": 471224943,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726655422
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471208670\">said</a>:</p>\n<blockquote>\n<p>You can look at the goal, have some heuristics for \"the important constants\", and issue a loogle query for those, but ...</p>\n</blockquote>\n<p>Yes, something like peel away quantifiers, truncate the parse tree and look for theorems that approximately fit. That would mean dropping the <code>apply</code>cability filter for that mode though. And then reply something like \"you would be able to apply this theorem, if only that subterm looked like such instead\".</p>",
        "id": 471232324,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1726657848
    },
    {
        "content": "<p>But it's already a huge gain to be able to query from within vscode!</p>",
        "id": 471232487,
        "sender_full_name": "Vincent Beffara",
        "timestamp": 1726657912
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"242586\">Vincent Beffara</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471232324\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/471208670\">said</a>:</p>\n<blockquote>\n<p>You can look at the goal, have some heuristics for \"the important constants\", and issue a loogle query for those, but ...</p>\n</blockquote>\n<p>Yes, something like peel away quantifiers, truncate the parse tree and look for theorems that approximately fit. That would mean dropping the <code>apply</code>cability filter for that mode though. And then reply something like \"you would be able to apply this theorem, if only that subterm looked like such instead\".</p>\n</blockquote>\n<p>I would agree with <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> that this is a fundamentally different AI task: premise selection, and it would be best to have an AI tool for this (MagnusHammer for Lean). Then we can query that tool with similar syntax.</p>",
        "id": 471232713,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726657995
    },
    {
        "content": "<p>It seems auto-update has broken again, though I tested the syntax with <code>nonReservedSymbol</code> on a branch and CI passed there. It may be a different dependency causing the problem (the line with the error has no syntax similar to that of LeanSearchClient).</p>",
        "id": 471292117,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726674185
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> very nice!! Thank you.</p>\n<p>but why <code>#loogle</code> command outputs is multiple info? I think first info <code>info: Option ?a → ?a, \"get!\"</code> is not needed.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient.LoogleSyntax</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Moogle Search Results</span>\n<span class=\"sd\">• #check Nat.Primes.infinite</span>\n<span class=\"sd\">• #check Nat.exists_infinite_primes</span>\n<span class=\"sd\">• #check Nat.exists_infinite_pseudoprimes</span>\n<span class=\"sd\">• #check Nat.infinite_setOf_prime</span>\n<span class=\"sd\">• #check Nat.infinite_setOf_prime_modEq_one</span>\n<span class=\"sd\">• #check Nat.infinite_setOf_pseudoprimes</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">moogle</span><span class=\"w\"> </span><span class=\"s2\">\"primes exists infinitely.\"</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: LeanSearch Search Results</span>\n<span class=\"sd\">• #check Nat.exists_infinite_primes</span>\n<span class=\"sd\">• #check Nat.Primes.infinite</span>\n<span class=\"sd\">• #check Nat.infinite_setOf_prime</span>\n<span class=\"sd\">• #check Nat.frequently_odd</span>\n<span class=\"sd\">• #check Nat.exists_prime_gt_modEq_one</span>\n<span class=\"sd\">• #check Nat.frequently_even</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"s2\">\"primes exists infinitely.\"</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Option ?a → ?a, \"get!\"</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">info: Loogle Search Results</span>\n<span class=\"sd\">• #check Option.get!</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"get!\"</span>\n</code></pre></div>",
        "id": 471357733,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726697819
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 471358178,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726698036
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> Thanks. That was info that was there for debugging which I forgot to remove. Fixed this (though it will take a while to percolate to users).</p>",
        "id": 471372207,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726705982
    },
    {
        "content": "<p>The fix has made its way to Mathlib, and now the extra import is not needed for loogle.<br>\n<span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span></p>",
        "id": 471495879,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726755069
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> </p>\n<p>I have found an unexpected behavior. This raise no error.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient.LoogleSyntax</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Loogle Search Results</span>\n<span class=\"sd\">• #check Option.get!</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"get!\"</span>\n</code></pre></div>\n<p>But this fails.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient.LoogleSyntax</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: Loogle Search Results</span>\n<span class=\"sd\">• #check Option.get!</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"get!\"</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> hello -/</span>\n</code></pre></div>",
        "id": 471506124,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726758036
    },
    {
        "content": "<p>Can you make an issue? I am travelling so can't look at it till Saturday</p>",
        "id": 471507439,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726758385
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> Where to make an issue? mathlib4 repo?</p>",
        "id": 471507795,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726758485
    },
    {
        "content": "<p>Sorry I was not clear. No, the LeanSearchClient repo linked in the announcement</p>",
        "id": 471508032,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726758561
    },
    {
        "content": "<p>done <a href=\"https://github.com/leanprover-community/LeanSearchClient/issues/8\">https://github.com/leanprover-community/LeanSearchClient/issues/8</a></p>",
        "id": 471602304,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726803755
    },
    {
        "content": "<p>This is a great tool!  However, I was unable to get any of the three search tools working without some frustration.  After following the instructions of running <code>lake update mathlib' and adding </code>import Mathlib.Tactic', I was getting the error  <code>unexpected token '#'</code>. It also doesn't seem to work in the Lean4 playground.</p>\n<p>However, after running `lake update', it did start working for some reason.  Just posting this here in case anyone finds it useful.</p>",
        "id": 473976444,
        "sender_full_name": "Jarod Alper",
        "timestamp": 1727769502
    },
    {
        "content": "<p>Thanks. This is not part of mathlib but is a dependency of mathlib. My guess is that <code>lake update mathlib</code> only updated mathlib, not dependencies, so <code>lake update</code> is needed.</p>\n<p>Maybe the same can be done for the lean playground <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span></p>",
        "id": 473977368,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727769754
    },
    {
        "content": "<p>The playground runs in a sandbox, so it doesn’t have network access. But indeed the tool should ideally handle network errors more gracefully, and not say </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">BasicAux</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"n\">backtrace</span><span class=\"o\">:</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">BasicAux</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"n\">backtrace</span><span class=\"o\">:</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">JSON</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">input</span>\n</code></pre></div>",
        "id": 473981024,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727771040
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/473981024\">said</a>:</p>\n<blockquote>\n<p>The playground runs in a sandbox, so it doesn’t have network access. But indeed the tool should ideally handle network errors more gracefully, and not say </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">BasicAux</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"n\">backtrace</span><span class=\"o\">:</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">get!</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">BasicAux</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"n\">backtrace</span><span class=\"o\">:</span>\n</code></pre></div>\n<p>or</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">JSON</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unexpected</span><span class=\"w\"> </span><span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">input</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Agreed. Will fix this.</p>",
        "id": 473981370,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727771145
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> <span class=\"user-mention\" data-user-id=\"490964\">@Jarod Alper</span> I see two options UI wise:</p>\n<ul>\n<li>log a warning and have an empty set of suggestions.</li>\n<li>throw an error but with a useful message.</li>\n</ul>\n<p>Which do you think a user will prefer.</p>",
        "id": 473983059,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727771741
    },
    {
        "content": "<p>If there is an error, throw an error :-)</p>",
        "id": 473984710,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727772313
    },
    {
        "content": "<p>I have modified to give informative errors.</p>",
        "id": 473985886,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727772700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/473981024\">said</a>:</p>\n<blockquote>\n<p>The playground runs in a sandbox, so it doesn’t have network access.</p>\n</blockquote>\n<p><span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span></p>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/Discussion.20for.20LeanSearchClient/near/473977368\">said</a>:</p>\n<blockquote>\n<p>My guess is that <code>lake update mathlib</code> only updated mathlib, not dependencies, so <code>lake update</code> is needed.</p>\n<p>Maybe the same can be done for the lean playground <span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span></p>\n</blockquote>\n<p>Here is how the playground updates:<br>\n<a href=\"https://github.com/leanprover-community/lean4web/blob/main/Projects/mathlib-demo/build.sh\">https://github.com/leanprover-community/lean4web/blob/main/Projects/mathlib-demo/build.sh</a></p>\n<p>concretely:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>curl<span class=\"w\"> </span>-L<span class=\"w\"> </span>https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain<span class=\"w\"> </span>-o<span class=\"w\"> </span>lean-toolchain\nlake<span class=\"w\"> </span>update<span class=\"w\"> </span>-R\nlake<span class=\"w\"> </span>build\n</code></pre></div>",
        "id": 474024923,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1727785800
    },
    {
        "content": "<p>Do I understand it correctly that this means there is no action needed from my side?</p>",
        "id": 474024940,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1727785802
    },
    {
        "content": "<p>I think so</p>",
        "id": 474025098,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727785834
    },
    {
        "content": "<p>So do I. These services cannot run in a sandbox</p>",
        "id": 474025243,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727785868
    },
    {
        "content": "<p>If it is worth it I suppose limited web access can be allowed</p>",
        "id": 474025395,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1727785917
    },
    {
        "content": "<p>It’s a possibility, although “no network access” is certianly easier to keep secure than “some network access”</p>",
        "id": 474028119,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1727786741
    },
    {
        "content": "<p>If people have a browser open already, I don't think it's too crazy that they need to switch to another tab, especially if the cost of the alternative is reduced security.</p>",
        "id": 474037580,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1727789148
    },
    {
        "content": "<p>Presumably an alternative here would be for the commands to communicate with a widget, and the widget to run the web requests client-side?</p>",
        "id": 474148969,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727827073
    },
    {
        "content": "<p>this is really impressive <span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>. earlier today i learned that ~150K searches have been issued to Moogle since we launched it nearly a year ago. many more improvements are coming soon!</p>",
        "id": 474432143,
        "sender_full_name": "Jesse Michael Han",
        "timestamp": 1727916477
    }
]