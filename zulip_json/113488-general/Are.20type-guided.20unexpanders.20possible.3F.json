[
    {
        "content": "<p>I'm defining the datatype of integers and positive and negative infinities, and I want to do so with as nice of a syntax as possible, while also making use as much as possible of the definitions found in Mathlib.</p>\n<p>So far, I have the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- WithBot/Top is just Option with extra semantics</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"+∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"-∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">match_pattern</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">int</span>\n</code></pre></div>\n<p>So far it works well, since I can do pattern-matching on <code>∞</code>, <code>-∞</code> and <code>.int x</code>. However, the issue comes when, in proofs, one has to match on these elements. Then, the underlying structure of the datatype is exposed, and one has to deal with <code>.some</code> and <code>.none</code> everywhere. </p>\n<p>I can get around the issue by adding some <code>simp</code> lemmas which perform the translations back. However, ideally I wanted my user-experience to be more similar to that of lists or natural numbers, where the \"pretty-printed\" syntax is also used when destructuring elements. Looking into how this syntax is achieved, it seems like I need to make use of <code>unexpander</code>s or <code>delab</code>orators. However, the issue is that since my datatype is implemented in terms of another datatype, I cannot implement an unexpander/delaborator for it without the underlying datatype beign affected.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabClosedInt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span>\n<span class=\"w\">  </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hijacked</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"c1\">-- hijacked!</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- .some 1</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- hijacked!!</span>\n</code></pre></div>\n<p>From what I understand, my best hope is to either use a custom destructor every time I destruct, which makes use of some new identifiers mapping to the underlying representation, or to simply create my own datatype and do away with <code>WithTop</code> and <code>WithBot</code> (which so far I wanted to avoid, since I wanted to reuse the mathlib definitions for them). Are there any other options I am not considering which are worth exploring?</p>",
        "id": 567285961,
        "sender_full_name": "Ayhon",
        "timestamp": 1768010413
    },
    {
        "content": "<p>Why do you use <code>Option.none</code> instead of <code>\\bot</code>/<code>\\top</code>?</p>",
        "id": 567286504,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768011032
    },
    {
        "content": "<p>See, e.g., how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EReal#doc\">docs#EReal</a> work.</p>",
        "id": 567286515,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768011042
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/113488-general/topic/Are.20type-guided.20unexpanders.20possible.3F/near/567286504\">said</a>:</p>\n<blockquote>\n<p>Why do you use <code>Option.none</code> instead of <code>\\bot</code>/<code>\\top</code>?</p>\n</blockquote>\n<p>Aren't they mapped to the same thing? I don't understand the issue.</p>",
        "id": 567286625,
        "sender_full_name": "Ayhon",
        "timestamp": 1768011193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/113488-general/topic/Are.20type-guided.20unexpanders.20possible.3F/near/567286515\">said</a>:</p>\n<blockquote>\n<p>See, e.g., how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EReal#doc\">docs#EReal</a> work.</p>\n</blockquote>\n<p>Thanks! I completely missed this definition existed, but it looks really close to what I am trying to achieve</p>",
        "id": 567286648,
        "sender_full_name": "Ayhon",
        "timestamp": 1768011226
    },
    {
        "content": "<p>While <code>\\bot</code> and <code>\\top</code> are defeq to what you use, they aren't syntactically equal, and <code>simp</code>/<code>rw</code>/... expect them. Also, you can use <code>\\bot</code>/<code>\\top</code> in <code>match</code>, and get them in the RHS.</p>",
        "id": 567287610,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1768012722
    },
    {
        "content": "<p>(<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithTop#doc\">docs#WithTop</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithBot#doc\">docs#WithBot</a>)</p>",
        "id": 567309461,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768041156
    },
    {
        "content": "<p>i believe it is <em>definitely</em> possible to change delab behaviour based on what type some expression is. Unfortunately i haven't been able to make your example delab work due to missing imports/opens, but i suspect the following will <em>just work</em> <span aria-label=\"tm\" class=\"emoji emoji-2122\" role=\"img\" title=\"tm\">:tm:</span> (and is the best way to go about it):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabClosedInt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span>\n<span class=\"w\">  </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hijacked</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Aside from that, please, <em>please</em> don't think <code>WithBot/Top</code> is \"just\" Option with extra semantics. The definitional equality between these types is in general <em>not</em> to be used. In particular, don't go constructing elements of <code>WithBot/Top</code> using constructors/functions giving <code>Option</code>, as you will confuse the automation machinery.<br>\nInstead, if you have to use something like constructors, use <code>WithTop.some/WithBot.some</code> and, as Yury suggested, <code>⊤</code> and <code>⊥</code>.<br>\nIf my understanding is correct, the difference is particularly important for delaborators.</p>",
        "id": 567311302,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768042986
    },
    {
        "content": "<p>other than that, i think another issue is that you're testing these with <code>#eval</code>. it is my understanding that <code>#eval</code> doesn't use the kernel, and instead just goes straight to the generated code, which inherently doesn't use lean's types. As a result, after <code>eval</code>uating lean is unable to tell how to turn e.g. <code>Option.some (Option.some 1)</code> into something with return type <code>ClosedInt</code>. I believe this will cause most unexpanders for type aliases which aren't defined with one-field structures to fail after <code>#eval</code></p>",
        "id": 567312484,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768044184
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113488-general/topic/Are.20type-guided.20unexpanders.20possible.3F/near/567311302\">said</a>:</p>\n<blockquote>\n<p>Unfortunately i haven't been able to make your example delab work due to missing imports/opens</p>\n</blockquote>\n<p>Indeed, my appologies, I should have been added the following before the elaborator declaration, and added an <code>import Lean</code>. Here's the corrected <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQpKxwAyApkgHY44AmJAZnAMLoQDOJ1AkufAFwC8cAOrA0AFQhg4AChFoAQhHjcYASjgBaDcNGpFMAPQSpwVnABWAV1bwA8mBjAI5OAHddcEgA8YUJHHYQCkcAY1YqciQQElYwJBCSJhZ2Lh4qYHIbCgTeOH0ZZjYOFXUBOAy6EihuLPIEgEEzaXzZXWMZOT0lOBLVVTxMmGySXPbpQpSSuDKKqpqhupJGmTHO1d183v6cVhDJDjhyJRQnFwAiQDwiM7h+AD4VyQA6GElppKLUtR29sAOjocczjgZwA1FcbvdpMZnq9chNijx+rt9tRDsdAecNOC7jJ9I8sN04ckEV8cAABADaQRgIVQAH04jAYFVyAAaOB7EgAXRo9HKPGkXlyJSJHxU00E9gxj1YEGiMilpxlcsSXn6GVqOSYEES4vhnzcqCqiU5ErgjwyMCo+xcpAocAAClASEyAJ5Oy1VOAAERI6CQBL8LygcAAypYsABRLxgEMZckU2j+rBwJBgMCPRXOZXRHm0BhJgP68W5X3Js3UCA4OBwdAuzxwQAJhHAAOYu6Ox6u1l107yxuBZ8g5xJ0htlEhdmsAHzgdCQwHQlmdXbrMF7MZDg+HcFHo/Hk7gM7nC6XE5rAANpKhgOZ4gBrDjbADEJAAbkh0O9JjwLTw4ABGAAGTRtGvW8QgfagAEIcBfd9Py3WV5X/EDzSQxJ/1gt8PwHBwlXQuAAB4Z0QlUANQsD7w4KCYIGTURmISMCmJT5SkEWZqkGYZlmkIgmNacRXgErplERPoqG8KIwDrXJAAAiGtpAAL1Fb81HZRS4EAEyI4AuM0sFdOAuygS0oAgGRRxnCy4EU/oay7D90DpFsIA/MxZSgKBXSAA\">snippet.</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- WithBot/Top is just Option with extra semantics</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Bot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)))</span>\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"+∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"-∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Bot</span><span class=\"bp\">.</span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">match_pattern</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">int</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"w\"> </span><span class=\"n\">Delaborator</span><span class=\"w\"> </span><span class=\"n\">SubExpr</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kd\">@[</span><span class=\"n\">delab</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"bp\">.</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabClosedInt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getExpr</span>\n<span class=\"w\">  </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"n\">let_expr</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hijacked</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"c1\">-- hijacked!</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- .some 1</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- hijacked!!</span>\n\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">∞</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 567313961,
        "sender_full_name": "Ayhon",
        "timestamp": 1768045671
    },
    {
        "content": "<p>I've tried using your suggestion, but it <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQpKxwAyApkgHY44AmJAZnAMLoQDOJ1AkufAFwC8cAOrA0AFQhg4AChFoAQhHjcYASjgBaDcNGpFMAPQSpwVnABWAV1bwA8mBjAI5OAHddcEgA8YUJHHYQCkcAY1YqciQQElYwJBCSJhZ2Lh4qYHIbCgTeOH0ZZjYOFXUBOAy6EihuLPIEgEEzaXzZXWMZOT0lOBLVVTxMmGySXPbpQpSSuDKKqpqhupJGmTHO1d183v6cVhDJDjhyJRQnFwAiQDwiM7h+AD4VyQA6GElppKLUtR29sAOjocczjgZwA1FcbvdpMZnq9chNijx+rt9tRDsdAecNOC7jJ9I8sN04ckEV8cAABADaQRgIVQAH04jAYFVyAAaOB7EgAXRo9HKPGkXlyJSJHxU00E9gxj1YEGiMilpxlcsSXn6GVqOSYEES4vhnzcqCqiU5ErgjwyMCo+xcpAocAAClASEyAJ5Oy1VOAAERI6CQBL8LygcAAypYsABRLxgEMZckU2j+rBwJBgMCPfUqC08Hm0BhJgNZnhvX3Js3UCA4OBwdAuzxwQAJhHAAOYu6Ox6u1l107yx96THg5+B0s0kLs1gA+cDoSGA6Eszq7AANpKhgOZ4gBrDjbADEJAAbkh0AOScO4ABGAAMmm0683IR31AAhDgD8fT4rnMr5Ze7+asp/u+R4nnA37kL+iQADzThBUFXgBD7bhwL5vgMmojMQkYFMSnylIIszVIMwzLNIRA4a04ivFRXTKIifRUN4URgHWuSAABENbSAAXqKg5qOy3FwIAJkRwBcZpYK6cBdlAlpQBAMijtOSlwNx/Q1l2J7oHSLYQCeZiylAUCukAA\">doesn't seem to work</a>. Furthermore, my issue is not with <code>CLosedInt.int _</code> being show in a particular manner, but more that, when destructing elements of type <code>ClosedInt</code> (as I do at the end of my most recent snippet), the elements shown are treated as if they were elements of <code>Option.some</code>.</p>",
        "id": 567314241,
        "sender_full_name": "Ayhon",
        "timestamp": 1768045925
    },
    {
        "content": "<p>ah. using delaborators isn't going to help you there i'm afraid. delaborators are purely cosmetic...</p>",
        "id": 567314711,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046373
    },
    {
        "content": "<p>Yeah, I was beginning to fear taht was the case</p>",
        "id": 567314731,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046392
    },
    {
        "content": "<p>I can get away with it if I define my custom recursor, which decomposes to top, bot and .int</p>",
        "id": 567314761,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046414
    },
    {
        "content": "<p>yea, i was about to suggest that</p>",
        "id": 567314771,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046427
    },
    {
        "content": "<p>But having to explicitly specify I'm using that recursor is a bit of a pain</p>",
        "id": 567314781,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046434
    },
    {
        "content": "<p>ah, then let me introduce the <code>cases_eliminator</code> attribute</p>",
        "id": 567314816,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046461
    },
    {
        "content": "<p>example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">cases_eliminator</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">bot</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">top</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">i</span>\n\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">∞</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">z</span>\n\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 567314836,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046474
    },
    {
        "content": "<p>no need to specify the recursor anymore</p>",
        "id": 567314872,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046505
    },
    {
        "content": "<p>(see also the <code>induction_eliminator</code> attribute for similar results with <code>induction</code>)</p>",
        "id": 567314890,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046531
    },
    {
        "content": "<p>Hmm, nice!</p>",
        "id": 567314905,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046549
    },
    {
        "content": "<p>Definitely an improvement over what I had before</p>",
        "id": 567314931,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046557
    },
    {
        "content": "<p>However, I've noticed that it doesn't seem to work when used with <code>rintro</code>.</p>",
        "id": 567314949,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046569
    },
    {
        "content": "<p>Or <code>rcases</code> for that matter</p>",
        "id": 567314983,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046585
    },
    {
        "content": "<p>yea, unfortunately</p>",
        "id": 567314993,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046587
    },
    {
        "content": "<p>I see. It's definitely much better than what I had achieved on my own so far</p>",
        "id": 567315014,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046610
    },
    {
        "content": "<p>Thank you for your help!</p>",
        "id": 567315024,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046615
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> <a href=\"#narrow/channel/113488-general/topic/Are.20type-guided.20unexpanders.20possible.3F/near/567314983\">said</a>:</p>\n<blockquote>\n<p>Or <code>rcases</code> for that matter</p>\n</blockquote>\n<p>btw, i think this definitely can be a RFC...<br>\ni.e. having <code>rintro</code> and <code>rcases</code> look up custom eliminators</p>",
        "id": 567315076,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768046661
    },
    {
        "content": "<p>Indeed. I'm surprised there's a difference between <code>cases</code> and <code>rcases</code>, I thought the implementationo of one would depend on the other</p>",
        "id": 567315188,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046794
    },
    {
        "content": "<p>But <code>rcases</code> doesn't seem to have a <code>using</code> syntax to specify custom eliminators, so maybe it's a design feature</p>",
        "id": 567315250,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046849
    },
    {
        "content": "<p>Definitely worth asking though</p>",
        "id": 567315285,
        "sender_full_name": "Ayhon",
        "timestamp": 1768046882
    },
    {
        "content": "<p>Mentioned in <a href=\"#narrow/channel/113488-general/topic/Is.20.60rcases.60.20with.20custom.20eliminators.20supported.3F\">#general &gt; Is &#96;rcases&#96; with custom eliminators supported?</a></p>",
        "id": 567315933,
        "sender_full_name": "Ayhon",
        "timestamp": 1768047510
    },
    {
        "content": "<p>btw, the idea for <code>rintro</code> and <code>rcases</code> is that you can do multiple cases/matchings at once. for example, the fact that you're able to do <code>rintro (_ | _ | z)</code> despite the fact that <code>Option</code> only has two constructors, is due to this. As a result, it's hard to create syntax to specify exactly which eliminators should be used at which step. However, having <code>rintro</code> and <code>rcases</code> look up custom eliminators (i.e. those tagged with <code>cases_eliminator</code>) is much more feasible/definable (from a specification POV)</p>",
        "id": 567316164,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1768047804
    },
    {
        "content": "<p>Fair enough. It's true that it becomes a bit of a mess trying to specify which pattern should use a custom eliminator and which not. I guess it could be done by specifying the set of \"active custom eliminatos\", sort of how <code>only []</code> works for <code>simp</code>, but it's a lot less precise than what have with <code>cases</code></p>",
        "id": 567316340,
        "sender_full_name": "Ayhon",
        "timestamp": 1768048036
    },
    {
        "content": "<p>Some hints:</p>\n<ul>\n<li>Use <code>notation3</code> instead of <code>notation</code>, since that generates type-sensitive delaborators.</li>\n<li>Be sure to use <code>#check</code> when testing pretty printing instead of <code>#eval</code>, since <code>#eval</code> is doing a lot of transformation of an expression, so it's not clear what it's testing.</li>\n<li>You can use <code>deriving</code> to derive all the instances in your example.</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithBot</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- WithBot/Top is just Option with extra semantics</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Bot</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Top</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LE</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span>\n\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"+∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Top</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"-∞\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Bot</span><span class=\"bp\">.</span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">match_pattern</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"kn\">instance</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">int</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"c1\">-- ↑10 : ClosedInt</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- some 1</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"c1\">-- some (some 1)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">cases_eliminator</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⊥</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">bot</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">top</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"bp\">.</span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">i</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ClosedInt</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">∞</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  case bot</span>\n<span class=\"cm\">  ⊢ -∞ ≤ +∞</span>\n\n<span class=\"cm\">  case top</span>\n<span class=\"cm\">  ⊢ +∞ ≤ +∞</span>\n\n<span class=\"cm\">  case int</span>\n<span class=\"cm\">  i✝ : ℤ</span>\n<span class=\"cm\">  ⊢ ↑i✝ ≤ +∞</span>\n<span class=\"cm\">  -/</span>\n\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 567327329,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1768058637
    },
    {
        "content": "<p>This feels relevant: <a href=\"https://github.com/leanprover-community/mathlib4/pull/33876\">#33876</a></p>",
        "id": 567905275,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1768367154
    }
]