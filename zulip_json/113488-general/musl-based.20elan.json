[
    {
        "content": "<p>I just tried to open a PR in codespaces, and the lean extension trying to install elan gave this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">codespaces</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"n\">ed4d0</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">workspaces</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">bash</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">sSf</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"c1\">-- -y --default-toolchain leanprover/lean4:stable || (echo &amp;&amp; read -n 1 -s -r -p \"Install failed, press ENTER to continue...\")' &amp;&amp; exit</span>\n<span class=\"n\">elan</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">musl</span><span class=\"bp\">-</span><span class=\"n\">based</span><span class=\"w\"> </span><span class=\"n\">systems</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">unsupported</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">moment</span>\n</code></pre></div>\n<p>I don't think I have anything other than default codespace settings, so I don't really understand why this no longer works</p>",
        "id": 532372667,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754079322
    },
    {
        "content": "<p>Does your codespace happen to be an alpine container?</p>",
        "id": 532376520,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081168
    },
    {
        "content": "<p>I don't know what that means, I just pressed the codespaces button and I know it's called ominous potato</p>",
        "id": 532376902,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081347
    },
    {
        "content": "<p>What does <code>cat /etc/os-release</code> give you?</p>",
        "id": 532377092,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081429
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">NAME</span><span class=\"bp\">=</span><span class=\"s2\">\"Alpine Linux\"</span>\n<span class=\"n\">ID</span><span class=\"bp\">=</span><span class=\"n\">alpine</span>\n<span class=\"n\">VERSION_ID</span><span class=\"bp\">=</span><span class=\"mf\">3.21</span><span class=\"bp\">.</span><span class=\"m\">3</span>\n<span class=\"n\">PRETTY_NAME</span><span class=\"bp\">=</span><span class=\"s2\">\"Alpine Linux v3.21\"</span>\n<span class=\"n\">HOME_URL</span><span class=\"bp\">=</span><span class=\"s2\">\"https://alpinelinux.org/\"</span>\n<span class=\"n\">BUG_REPORT_URL</span><span class=\"bp\">=</span><span class=\"s2\">\"https://gitlab.alpinelinux.org/alpine/aports/-/issues\"</span>\n</code></pre></div>",
        "id": 532377134,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081450
    },
    {
        "content": "<p>So seemingly it is an alpine container!</p>",
        "id": 532377149,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081460
    },
    {
        "content": "<p>Congrats, you are in an alpine container :P</p>",
        "id": 532377159,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081462
    },
    {
        "content": "<p>Yeah, you can't run Lean in an alpine container unfortunately</p>",
        "id": 532377192,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081478
    },
    {
        "content": "<p>Since I did this from mathlib, I presume that means there's a config file in mathlib we should change to disallow alpine containers?</p>",
        "id": 532377256,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081511
    },
    {
        "content": "<p>Or instead, do I need to change something in my codespaces profile (if such a thing exists)?</p>",
        "id": 532377324,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081536
    },
    {
        "content": "<p>I'm a bit confused, the config file <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.devcontainer/Dockerfile\">https://github.com/leanprover-community/mathlib4/blob/master/.devcontainer/Dockerfile</a> in mathlib branches off from from ubuntu jammy, if that Dockerfile was actually used while you setup the codespace (I've never used codspaces) you should not be in an alpine container</p>",
        "id": 532377443,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081607
    },
    {
        "content": "<p>Or maybe .devcontainer is not related to codespaces? I have no clue how this works really</p>",
        "id": 532377482,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1754081632
    },
    {
        "content": "<p>Here's the start of the creation log</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">=================================================================================</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">06</span><span class=\"o\">:</span><span class=\"mf\">58.392</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configuration</span><span class=\"w\"> </span><span class=\"n\">starting</span><span class=\"bp\">...</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">06</span><span class=\"o\">:</span><span class=\"mf\">58.401</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cloning</span><span class=\"bp\">...</span>\n\n<span class=\"bp\">=================================================================================</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">06.770</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Creating</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"bp\">...</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">06.806</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">devcontainer</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"w\"> </span><span class=\"c1\">--id-label Type=codespaces --workspace-folder /var/lib/docker/codespacemount/workspace/mathlib4 --mount type=bind,source=/.codespaces/agent/mount/cache,target=/vscode --user-data-folder /var/lib/docker/codespacemount/.persistedshare --container-data-folder .vscode-remote/data/Machine --container-system-data-folder /var/vscode-remote --log-level trace --log-format json --update-remote-user-uid-default never --mount-workspace-git-root false --omit-config-remote-env-from-metadata --skip-non-blocking-commands --skip-post-create --config \"/var/lib/docker/codespacemount/workspace/mathlib4/.devcontainer/devcontainer.json\" --override-config /root/.codespaces/shared/merged_devcontainer.json --default-user-env-probe loginInteractiveShell --container-session-data-folder /workspaces/.codespaces/.persistedshare/devcontainers-cli/cache --secrets-file /root/.codespaces/shared/user-secrets-envs.json</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">06.939</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">devcontainers</span><span class=\"bp\">/</span><span class=\"n\">cli</span><span class=\"w\"> </span><span class=\"mf\">0.80</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"bp\">.</span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"n\">v18</span><span class=\"bp\">.</span><span class=\"m\">20</span><span class=\"bp\">.</span><span class=\"m\">6</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">linux</span><span class=\"w\"> </span><span class=\"mf\">6.8</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"mi\">1030</span><span class=\"bp\">-</span><span class=\"n\">azure</span><span class=\"w\"> </span><span class=\"n\">x64</span><span class=\"bp\">.</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">07.888</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"mi\">4</span><span class=\"o\">}}]</span><span class=\"w\"> </span><span class=\"n\">ghcr</span><span class=\"bp\">.</span><span class=\"n\">io</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"n\">started</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">07.902</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">image</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">ghcr</span><span class=\"bp\">.</span><span class=\"n\">io</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span><span class=\"o\">:</span><span class=\"n\">latest'</span><span class=\"w\"> </span><span class=\"n\">locally</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">08.538</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">latest</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Pulling</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">gitpod</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">08.540</span><span class=\"n\">Z</span><span class=\"o\">:</span>\n<span class=\"bp\"></span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"n\">A</span><span class=\"bp\"></span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"n\">K</span>\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">08</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">:</span><span class=\"mi\">07</span><span class=\"o\">:</span><span class=\"mf\">08.540</span><span class=\"n\">Z</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">66587</span><span class=\"n\">c81b81a</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Pulling</span><span class=\"w\"> </span><span class=\"n\">fs</span><span class=\"w\"> </span><span class=\"n\">layer</span>\n</code></pre></div>",
        "id": 532377554,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081665
    },
    {
        "content": "<p>Ah, it looks like it was changed 3 months ago to use <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.devcontainer/devcontainer.json\">https://github.com/leanprover-community/mathlib4/blob/master/.devcontainer/devcontainer.json</a> and a prebuilt docker image, rather than that specific Dockerfile</p>",
        "id": 532377717,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754081750
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span></p>",
        "id": 532378546,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1754082129
    },
    {
        "content": "<p>I just tried again to open a codespaces using the button on mathlib4 readme, and it seems to work fine this time... So perhaps it's either different on PRs, or picks the container type randomly?</p>",
        "id": 532378661,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754082193
    },
    {
        "content": "<p>Uhoh, this is partly my doing. If I update the dockerfiles to use jammy, then everything should be back in order, right?</p>",
        "id": 532379666,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1754082688
    },
    {
        "content": "<p>In your defense this is maybe the 10th time I've used codespaces and the first time it's failed, so it's not entirely clear that it is your fault!</p>",
        "id": 532381071,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754083490
    },
    {
        "content": "<p>This bug is really curious then <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 532415775,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1754109986
    },
    {
        "content": "<p>I just hit this again, twice in a row. In each case, it took about 15 minutes to set up the codespace, and after all that I got the error message as above...</p>",
        "id": 555574175,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1763122821
    },
    {
        "content": "<p>I'll just mention <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/Access.20to.20gitpod.20or.20codespaces/near/571056355\">#general &gt; Access to gitpod or codespaces @ ðŸ’¬</a> here, since it may fix this issue.</p>",
        "id": 571058556,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1769786844
    }
]