[
    {
        "content": "<p>I wrote a script to go through all .lean files of Mathlib4 and generate the import dependency graph, then applied a <a href=\"https://en.wikipedia.org/wiki/Topological_sorting\">topological sort</a> to that graph so an ordering by dependencies arises (there where a handful of cyclical imports which i arbitrarily broke manually): <br>\n<a href=\"/user_uploads/3121/H8SPnXKyVMfnWScQF5n_cAP3/lean_toposort.png\">lean_toposort.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/H8SPnXKyVMfnWScQF5n_cAP3/lean_toposort.png\" title=\"lean_toposort.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"7202x7182\" src=\"/user_uploads/thumbnail/3121/H8SPnXKyVMfnWScQF5n_cAP3/lean_toposort.png/840x560.webp\"></a></div><p>Not sure if there is a tool that instead generates a list of <em>theorems</em> in a file (and a list of the specific theorems they depend on for each), that may be interesting to apply such a topological sort too, since different theorems in one file may be of varying complexity.</p>",
        "id": 503879918,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741291402
    },
    {
        "content": "<p>Here is the same idea but with theorems of Metamath's <code>set.mm</code> proof library<br>\n<a href=\"/user_uploads/3121/P3IyM10h5vI3FHMNVKvYI1G4/toposort_metamath.png\">toposort_metamath.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/P3IyM10h5vI3FHMNVKvYI1G4/toposort_metamath.png\" title=\"toposort_metamath.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"7202x7182\" src=\"/user_uploads/thumbnail/3121/P3IyM10h5vI3FHMNVKvYI1G4/toposort_metamath.png/840x560.webp\"></a></div>",
        "id": 503880445,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741291581
    },
    {
        "content": "<p>These make me wonder at which depth cutting edge math proofs would be found</p>",
        "id": 503880590,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741291648
    },
    {
        "content": "<p>I made a similar <a href=\"https://oli.show/leanstructure/#14351,0,AkraBazziRecurrence.GrowsPolynomially.zpow\">visualization of theorem dependencies</a> in Mathlib (v4.15-rc1). </p>\n<p>The underlying data is extracted using LeanDojo and processed into a <a href=\"https://github.com/oOo0oOo/leanstructure/blob/main/math-vis/static/data.zip\">3MB zip</a>.</p>\n<p>Topological sort is a cool idea, I might give that a try and include the resulting complexity in the visualization!</p>",
        "id": 503896350,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1741297385
    },
    {
        "content": "<p>Another good thing to compute is the dominator tree of the graph. It is basically \"Y is needed only because it's used by X\" relation.</p>",
        "id": 503899425,
        "sender_full_name": "suhr",
        "timestamp": 1741298594
    },
    {
        "content": "<p>There's a rather simple algorithm for that: <a href=\"https://www.cs.tufts.edu/~nr/cs257/archive/keith-cooper/dom14.pdf\">https://www.cs.tufts.edu/~nr/cs257/archive/keith-cooper/dom14.pdf</a></p>",
        "id": 503899620,
        "sender_full_name": "suhr",
        "timestamp": 1741298675
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"508937\">Arndt Schnabel</span> <a href=\"#narrow/channel/113488-general/topic/Visualizing.2Fquantifying.20proof.20complexity/near/503879918\">said</a>:</p>\n<blockquote>\n<p>there where a handful of cyclical imports which i arbitrarily broke manually</p>\n</blockquote>\n<p>I'm surprised by that statement: I thought/think that import cycles are disallowed. Do you remember one example of such a cycle?</p>",
        "id": 504089883,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741352651
    },
    {
        "content": "<p>Me too, but since i don't understand Lean yet or my script is too simple it may not be correct yet. But it found these:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Exponential</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Trigonometric</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">FunProp</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">ContinuousFunctionalCalculus</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Star</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Exponential</span>\n\n<span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">UnorderedInterval</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrderEmbedding</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Cover</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Multiset</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Finsupp</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">LSum</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">MonoidAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Polynomial</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">ExtractGoal</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">UnorderedInterval</span>\n</code></pre></div>",
        "id": 504164715,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741374278
    },
    {
        "content": "<p>here is the script: <br>\n<a href=\"/user_uploads/3121/YjgCFfQ6ROoYYf9NN-EnjUOd/topo.py\">topo.py</a></p>",
        "id": 504164959,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741374319
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/113488-general/topic/Visualizing.2Fquantifying.20proof.20complexity/near/503896350\">said</a>:</p>\n<blockquote>\n<p>I made a similar visualization of theorem </p>\n</blockquote>\n<p>ooh, LeanDojo looks very useful for this purpose :)</p>",
        "id": 504165210,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741374377
    },
    {
        "content": "<p><code>Data.Rat.Defs</code> doesn't import <code>Algebra.Ring.Rat</code></p>",
        "id": 504165240,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1741374391
    },
    {
        "content": "<p>right, strange</p>",
        "id": 504165400,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741374462
    },
    {
        "content": "<p>ah, the order is the other way around</p>",
        "id": 504165850,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741374615
    },
    {
        "content": "<p>okay, i shouldn't have stripped the first component of the path, since it could be Mathlib or Batteries, also, i didn't consider multiline comments - the two remaining \"cycles\" are probably also only artifacts due to an import example in a comment - which my very basic script doesn't recognize as such</p>",
        "id": 504167032,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741375066
    },
    {
        "content": "<p>updated the lean_toposort.png image above</p>",
        "id": 504168387,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741375521
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/113488-general/topic/Visualizing.2Fquantifying.20proof.20complexity/near/503896350\">said</a>:</p>\n<blockquote>\n<p>The underlying data is extracted using LeanDojo and processed into a <a href=\"https://github.com/oOo0oOo/leanstructure/blob/main/math-vis/static/data.zip\">3MB zip</a>.</p>\n</blockquote>\n<p>I hope I understood the data.json structure correctly, but here is a list of the top 3 used theorems of each level of the topological sort on its graph :)<br>\n<a href=\"/user_uploads/3121/r5f34noHpJ_s-NLrHSHvEUDf/topolevelstop3.txt\">topolevelstop3.txt</a><br>\n<a href=\"/user_uploads/3121/PVwxSfFx3hsbp_OHPrTJgaSs/main.py\">main.py</a></p>",
        "id": 504178352,
        "sender_full_name": "Arndt Schnabel",
        "timestamp": 1741379129
    }
]