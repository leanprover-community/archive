[
    {
        "content": "<p>I learned from <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/BetterFind.2Elean.20-.20a.20better.20way.20to.20find.20theorems.20in.20Lean/near/532915554\">#general &gt; BetterFind.lean - a better way to find theorems in Lean @ üí¨</a> that <a href=\"https://loogle.lean-lang.org/\">#loogle</a> provides a <code>#find</code> tactic, which looks like exactly the tactic I have been looking for for quite some time. However, I am struggling to use it in my project that does not depend on Mathlib. I tried adding the following to my <code>lakefile.toml</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"loogle\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"nomeata\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"git#master\"</span>\n</code></pre></div>\n<p>and then adding <code>import Loogle.Find</code>, but this causes weird build errors in batteries and Qq since my project is using <code>leanprover/lean4:v4.21.0</code>, but loogle master is using <code>leanprover/lean4:v4.20.0-rc5</code>. Also it tries to download mathlib, which I do not need. How can I get access to the <code>#find</code> tactic for my project?</p>",
        "id": 533041839,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1754465753
    },
    {
        "content": "<p>The code is there, but convenient integration into downstream projects is still pending, so so far this is mostly for early adopters who'll working around these issues and thus help finding a good way of setting this up.</p>\n<p>Eventually I'm hoping that lake comes with support for ‚Äúlocal dev dependencies‚Äù that allow you to add tools like loogle to your local setup without disturbing your projects dependcy resolution and without having to touch committed files.</p>\n<p>Does it help to move the loogle require up or down in your lake file?</p>",
        "id": 533056583,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754470976
    },
    {
        "content": "<p>In the meantime should mathlib just depend on loogle, or does that put us in a mess WRT the loogle cache?</p>",
        "id": 533057084,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754471140
    },
    {
        "content": "<blockquote>\n<p>Also it tries to download mathlib, which I do not need.</p>\n</blockquote>\n<p>Does it download the olean cache or just the source files? I'd argue you should just ignore the fact it downloads mathlib, but if it's slow doing so then that's something we should try to fix in lake</p>",
        "id": 533057300,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754471216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533057084\">schrieb</a>:</p>\n<blockquote>\n<p>In the meantime should mathlib just depend on loogle, or does that put us in a mess WRT the loogle cache?</p>\n</blockquote>\n<p>We can make that work, if there is demand. You still would have to do manual steps to get a local cache, and re-run to update it (or else just wait for a while when you use <code>#find</code> the first time per module).</p>",
        "id": 533058061,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754471441
    },
    {
        "content": "<p>Could the loogle cache be part of the mathlib cache?</p>",
        "id": 533058219,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754471491
    },
    {
        "content": "<p>Michael could experiment with a branch of loogle without the mathlib dependency there (which shouldn't really be there)</p>",
        "id": 533058235,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754471496
    },
    {
        "content": "<p>Possibly, but that would require a bit more thought. What if the downstream user uses mathlib as a dependency and wants to find their definitions as well? What about local changes? When to update the cache?</p>",
        "id": 533058442,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754471566
    },
    {
        "content": "<p>hot take: loogle should be in core?</p>",
        "id": 533059667,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754471953
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533056583\">said</a>:</p>\n<blockquote>\n<p>Does it help to move the loogle require up or down in your lake file?</p>\n</blockquote>\n<p>I did not know that the order in the lakefile matters. I can try it, but my only other dependency is Qq, so I am not sure what difference to expect.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533056583\">said</a>:</p>\n<blockquote>\n<p>Eventually I'm hoping that lake comes with support for ‚Äúlocal dev dependencies‚Äù that allow you to add tools like loogle to your local setup without disturbing your projects dependcy resolution and without having to touch committed files.</p>\n</blockquote>\n<p>That would be very nice!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533057300\">said</a>:</p>\n<blockquote>\n<p>Does it download the olean cache or just the source files? I'd argue you should just ignore the fact it downloads mathlib, but if it's slow doing so then that's something we should try to fix in lake</p>\n</blockquote>\n<p>It tries to download the cache I think and then fails because of the toolchain mismatch.</p>",
        "id": 533064675,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1754473545
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533059667\">said</a>:</p>\n<blockquote>\n<p>hot take: loogle should be in core?</p>\n</blockquote>\n<p>I would actually second this. In Rocq, there is the built-in <code>Search</code> command that is very similar to <code>#find</code> and I am using it a lot in large developments to find relevant lemmas. I find that this is really core functionality that Lean is currently missing compared to Rocq.</p>",
        "id": 533064995,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1754473651
    },
    {
        "content": "<p>Before it can be in core I think there are a few questions to be solved around the index (when to generate and update). At least if you want to be able to search in the whole project, and not just the imports of the file you currently have open. </p>\n<p>Maybe for that reason even for local use it should maybe be a separate process/server that you can use using the browser, the VSCode integration and the <code>#loogle</code> client?</p>",
        "id": 533069677,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754475296
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533057084\">said</a>:</p>\n<blockquote>\n<p>In the meantime should mathlib just depend on loogle, or does that put us in a mess WRT the loogle cache?</p>\n</blockquote>\n<p>please, no more mathlib lakefile bloat!</p>",
        "id": 533070149,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754475465
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533056583\">said</a>:</p>\n<blockquote>\n<p>Eventually I'm hoping that lake comes with support for ‚Äúlocal dev dependencies‚Äù that allow you to add tools like loogle to your local setup without disturbing your projects dependcy resolution and without having to touch committed files.</p>\n</blockquote>\n<p>I second that this would be a nice (and in fact, essential) thing to have. Are there discussions in Core/FRO to make this happens at some point? this is not in this year‚Äôs roadmap afaict...</p>",
        "id": 533071805,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754476098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20use.20the.20.23find.20tactic.20from.20Loogle.20in.20a.20custom.20project.3F/near/533069677\">said</a>:</p>\n<blockquote>\n<p>Before it can be in core I think there are a few questions to be solved around the index (when to generate and update). At least if you want to be able to search in the whole project, and not just the imports of the file you currently have open.</p>\n</blockquote>\n<p>Searching the whole project would be nice, but Search in Rocq only works on the currently imported files and that is already very useful. So I personally would also be happy with a simpler version that just works with the currently imported files.</p>",
        "id": 533076396,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1754477840
    },
    {
        "content": "<p>Right - but it needs to be possible to develop and use such tools without waiting for core :-)</p>",
        "id": 533130095,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1754495005
    }
]