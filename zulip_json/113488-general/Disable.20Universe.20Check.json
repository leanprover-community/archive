[
    {
        "content": "<p>Hi,</p>\n<p>How do I disable Lean's universe check, analogous to Agda's {-# OPTIONS --type-in-type #-}? I'm happy to label everything <code>unsafe</code>.</p>\n<p>I tried simply using <code>unsafe structure</code> for the relevant definition, but the universe error persisted.</p>\n<p>Thanks!</p>",
        "id": 545155308,
        "sender_full_name": "finegeometer",
        "timestamp": 1760580783
    },
    {
        "content": "<p>what structure are you trying to make?</p>",
        "id": 545155776,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760581156
    },
    {
        "content": "<p>can you give the example</p>",
        "id": 545155797,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760581168
    },
    {
        "content": "<p>Generally, I want to be able to write something of the following form.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ... lots of fields that refer to X</span>\n</code></pre></div>\n<p>If the solution is a sufficiently intensive restructuring that more information is needed, it's probably easier for me to simply switch to Agda.</p>",
        "id": 545156491,
        "sender_full_name": "finegeometer",
        "timestamp": 1760581675
    },
    {
        "content": "<p>In more detail:</p>\n<p>Several times, I've tried to use Lean as a programming language, rather than a proof assistant. When I do so, it's because I'm doing something I don't quite understand, so I want the safety of dependent types to check my work. But this tends to mean I'm working on something that causes a lot of cognitive load, so \"nitpicky\" issues like the universe check serve only to prevent me from doing anything at all. In this situation, I can't afford complicated, problem-specific solutions; it's either disable the check or discontinue the project. And I can't find a way to disable the check.</p>",
        "id": 545158057,
        "sender_full_name": "finegeometer",
        "timestamp": 1760582783
    },
    {
        "content": "<p>What I'd really like is a way to disable the universe check, and maybe other similar checks, throughout an entire file, or an entire project. Just like Agda's <code>{-# OPTIONS --type-in-type #-}</code>.</p>",
        "id": 545158372,
        "sender_full_name": "finegeometer",
        "timestamp": 1760583072
    },
    {
        "content": "<p>The easiest solution would just be to leave : Type out of your structure declaration because lean is perfectly capable of inferring universes in most situations.</p>\n<p>But no you can not just generally disable it</p>",
        "id": 545160855,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1760585405
    },
    {
        "content": "<p>Good to know. I will use Agda then.</p>",
        "id": 545161567,
        "sender_full_name": "finegeometer",
        "timestamp": 1760586060
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"741219\">finegeometer</span> <a href=\"#narrow/channel/113488-general/topic/Disable.20Universe.20Check/near/545156491\">said</a>:</p>\n<blockquote>\n<p>Generally, I want to be able to write something of the following form.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ... lots of fields that refer to X</span>\n</code></pre></div>\n<p>If the solution is a sufficiently intensive restructuring that more information is needed, it's probably easier for me to simply switch to Agda.</p>\n</blockquote>\n<p>this is really troubling me because I totally thought this would be possible</p>",
        "id": 545250832,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760609075
    },
    {
        "content": "<p>with unsafe</p>",
        "id": 545250894,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760609087
    },
    {
        "content": "<p>Isn't there some unsafe inverse to <code>ULift</code> that pulls something down to a different universe?</p>",
        "id": 545274954,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760613363
    },
    {
        "content": "<p>Certainly you can implement one with <code>unsafeCast</code></p>",
        "id": 545275002,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760613371
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Disable.20Universe.20Check/near/545274954\">said</a>:</p>\n<blockquote>\n<p>Isn't there some unsafe inverse to <code>ULift</code> that pulls something down to a different universe?</p>\n</blockquote>\n<p>But why would that exist</p>",
        "id": 545277944,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760613862
    },
    {
        "content": "<p>I can't think of any use cases</p>",
        "id": 545277991,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760613870
    },
    {
        "content": "<p>Working with big types in IO where the monad only allows <code>Type 0</code></p>",
        "id": 545284124,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760614881
    },
    {
        "content": "<p>sure but then the question is why do you have big types</p>",
        "id": 545285252,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760615110
    },
    {
        "content": "<p><a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Universe.20Polymorphic.20.60Meta.2EevalExpr.60/near/531232638\">Polymorphism with vtables</a> a la C++ gives you such types</p>",
        "id": 545285636,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760615173
    },
    {
        "content": "<p>Indeed, that thread also prototypes the <code>usquash</code>I'm thinking of</p>",
        "id": 545286305,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760615284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"741219\">finegeometer</span> <a href=\"#narrow/channel/113488-general/topic/Disable.20Universe.20Check/near/545161567\">said</a>:</p>\n<blockquote>\n<p>Good to know. I will use Agda then.</p>\n</blockquote>\n<p>Probably too late to correct the misunderstanding but better late than never...</p>\n<p>Henrik was not suggesting that <strong>you</strong> should leave. Instead, he was suggesting to <strong>leave out</strong> <code>: Type</code> from your structure declarations.</p>",
        "id": 545788552,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1760830080
    },
    {
        "content": "<p>In other words, you should not worry about universe levels and just use <code>Type _</code> everywhere rather than <code>Type</code>. If you run into issues where Lean can't figure out a solution to the universe unification problem on its own, discussing the specific issue here is probably the right way to solve the problem.</p>\n<p>However, as Henrik pointed out, Lean does not provide a blanket solution to ignore these issues. After all, <code>Type : Type</code> is well-known to be inconsistent. By design, Lean doesn't try to make it easy to get into an inconsistent situation.</p>",
        "id": 545789017,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1760830738
    },
    {
        "content": "<blockquote>\n<p>Probably too late to correct the misunderstanding but better late than never...</p>\n<p>Henrik was not suggesting that <strong>you</strong> should leave. Instead, he was suggesting to <strong>leave out</strong> <code>: Type</code> from your structure declarations.</p>\n</blockquote>\n<p>My phone inserted a line break between <code>:</code> and <code>Type</code> and that message read so wrong until you pointed out...</p>",
        "id": 545789836,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1760832004
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119741\">François G. Dorais</span> <a href=\"#narrow/channel/113488-general/topic/Disable.20Universe.20Check/near/545789017\">said</a>:</p>\n<blockquote>\n<p>However, as Henrik pointed out, Lean does not provide a blanket solution to ignore these issues. After all, <code>Type : Type</code> is well-known to be inconsistent. By design, Lean doesn't try to make it easy to get into an inconsistent situation.</p>\n</blockquote>\n<p>I wonder what about locally disable universe check? Does Lean have that or plan to support that? like Rocq's <code>bypass_check</code>? <br>\nOne such usage example is illustrated by Sterling to model impredicative universe, see <a href=\"https://arxiv.org/pdf/2210.02169\">https://arxiv.org/pdf/2210.02169</a> Sec 2.5.1.</p>",
        "id": 569147681,
        "sender_full_name": "EDJ",
        "timestamp": 1768953480
    }
]