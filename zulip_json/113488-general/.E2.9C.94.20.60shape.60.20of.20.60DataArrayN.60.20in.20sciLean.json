[
    {
        "content": "<p>I'm reading sciLean documentation. </p>\n<p>And I would like to implement a function similar to <code>shape</code> of NumPy. </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SciLean.Data.DataArray</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">SciLean</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⊞</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PlainDataType</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IndexType</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- I want to implement this!</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">SciLean.DataArrayN.shape</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DataArrayN</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- I want a output such like: Fin 2 × Fin 2 : Type</span>\n<span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"n\">A.shape</span>\n</code></pre></div>",
        "id": 449012267,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720074788
    },
    {
        "content": "<p>How to implement this?</p>",
        "id": 449012583,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720074919
    },
    {
        "content": "<p>Should I make a MWE without <code>import SciLean</code> ...? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 449018966,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720077617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"733817\">Kunil Lee</span> has marked this topic as resolved.</p>",
        "id": 449043974,
        "sender_full_name": "Notification Bot",
        "timestamp": 1720085418
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"733817\">Kunil Lee</span> has marked this topic as unresolved.</p>",
        "id": 449044064,
        "sender_full_name": "Notification Bot",
        "timestamp": 1720085433
    },
    {
        "content": "<p>The shape is just the type <code>ι</code>. So the implementation should be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SciLean</span><span class=\"bp\">.</span><span class=\"n\">DataArrayN</span><span class=\"bp\">.</span><span class=\"n\">shape</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DataArrayN</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ι</span>\n</code></pre></div>",
        "id": 449065121,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1720092340
    },
    {
        "content": "<p>Note that such a function is not very useful because arrays have their size explicit in the type therefore you don't need to get it with <code>A.shape</code> just use the type <code>ι</code> directly as it has to live somewhere in the current context.</p>",
        "id": 449067866,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1720093287
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"346070\">@Tomas Skrivan</span> Thank you. This works!!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">_root_.SciLean.DataArrayN.shape</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DataArrayN</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ι</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">Fin 3 × Fin 2</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">whnf</span><span class=\"w\"> </span><span class=\"n\">X.shape</span>\n</code></pre></div>",
        "id": 449079549,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720097374
    },
    {
        "content": "<blockquote>\n<p>Note that such a function is not very useful because arrays have their size explicit in the type therefore you don't need to get it with <code>A.shape</code> just use the type <code>ι</code> directly as it has to live somewhere in the current context.</p>\n</blockquote>\n<p>Indeed, in the case of NumPy, it may have been necessary because it is not always possible to know the shape from the type.</p>",
        "id": 449080062,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720097513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 449080086,
        "sender_full_name": "Notification Bot",
        "timestamp": 1720097519
    },
    {
        "content": "<p>this command also works.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"#shape\"</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"k\">#reduce</span><span class=\"w\"> </span><span class=\"n\">SciLean.DataArrayN.shape</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 449082151,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1720098119
    }
]