[
    {
        "content": "<p>I'm looking to implement a minimal HTTP server in Lean. Just enough to support basic RPC calls. After a bit of research, I am tending towards building upon <a href=\"https://github.com/hargoniX/socket.lean\">https://github.com/hargoniX/socket.lean</a>, which is actively maintained. Is there anything a bit more high-level?</p>\n<p>I also saw that the roadmap included a server http library, but I couldn't find any details on it.</p>",
        "id": 530628605,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1753383897
    },
    {
        "content": "<p>There is infrastructure for asynchronous TCP machinery in internal namespaces of the standard library and <span class=\"user-mention\" data-user-id=\"481858\">@Sofia Rodrigues</span> is actively working to put an HTTP sever on top of that</p>",
        "id": 530630152,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1753384510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530630152\">said</a>:</p>\n<blockquote>\n<p>There is infrastructure for asynchronous TCP machinery in internal namespaces of the standard library and <span class=\"user-mention silent\" data-user-id=\"481858\">Sofia Rodrigues</span> is actively working to put an HTTP sever on top of that</p>\n</blockquote>\n<p>Great, thanks!<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Std/Internal/Async/TCP.lean\">https://github.com/leanprover/lean4/blob/master/src/Std/Internal/Async/TCP.lean</a> looks like a much nicer abstraction. I'll get started using this as the basis, but will probably switch it out for the proper HTTP server once it is available. If you have a (rough) ETA that would be great, otherwise I'll just keep my eyes open for this.</p>",
        "id": 530631372,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1753385068
    },
    {
        "content": "<p>I'm also quite interested in this - is the source for this on a branch anywhere?</p>",
        "id": 530686162,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1753415207
    },
    {
        "content": "<p>The code is in <a href=\"https://github.com/leanprover/lean4/tree/sofia/http\">this</a> branch. I'm currently fixing some other issues in the Async monad before returning to work on it. It's messy and experimental code, I would love to have some suggestions on how to improve it :)</p>",
        "id": 530686363,
        "sender_full_name": "Sofia Rodrigues",
        "timestamp": 1753415372
    },
    {
        "content": "<p>Some quick questions:</p>\n<ol>\n<li>Is <code>Method#allowsRequestBody</code> planning to actually enforce anything?</li>\n<li>Will <code>Request#uri</code> have a more precise backing structure instead of <code>String</code>?</li>\n</ol>",
        "id": 530688399,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1753416815
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767695\">Tristan Figueroa-Reid</span> <a href=\"#narrow/channel/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530688399\">said</a>:</p>\n<blockquote>\n<p>Some quick questions:</p>\n<ol>\n<li>Is <code>Method#allowsRequestBody</code> planning to actually enforce anything?</li>\n<li>Will <code>Request#uri</code> have a more precise backing structure instead of <code>String</code>?</li>\n</ol>\n</blockquote>\n<ol>\n<li>Yes</li>\n<li>I'm talking with <span class=\"user-mention\" data-user-id=\"228466\">@Chris Bailey</span> about his URL library, and if he’s interested, I think it would be a great addition to the Std library. Otherwise, I'll create some structures to represent some of the formats described by the RFC 9112.</li>\n</ol>",
        "id": 530688707,
        "sender_full_name": "Sofia Rodrigues",
        "timestamp": 1753417038
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530628605\">said</a>:</p>\n<blockquote>\n<p>I'm looking to implement a minimal HTTP server in Lean. Just enough to support basic RPC calls. </p>\n</blockquote>\n<p>As a heads up (to maybe save you some time down the road), there's an existing implementation of JsonRpc in Lean: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Data/JsonRpc.html#Lean.JsonRpc.Message\">https://leanprover-community.github.io/mathlib4_docs/Lean/Data/JsonRpc.html#Lean.JsonRpc.Message</a></p>",
        "id": 530689172,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1753417407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"228466\">Chris Bailey</span> <a href=\"#narrow/stream/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530689172\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530628605\">said</a>:</p>\n<blockquote>\n<p>I'm looking to implement a minimal HTTP server in Lean. Just enough to support basic RPC calls. </p>\n</blockquote>\n<p>As a heads up (to maybe save you some time down the road), there's an existing implementation of JsonRpc in Lean: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Data/JsonRpc.html#Lean.JsonRpc.Message\">https://leanprover-community.github.io/mathlib4_docs/Lean/Data/JsonRpc.html#Lean.JsonRpc.Message</a></p>\n</blockquote>\n<p>Thanks! This implementation seems quite heavily geared towards the LSP. I will use it as an inspiration but dont need the persistence/streaming, custom error codes, etc</p>",
        "id": 530709123,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1753428077
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"481858\">Sofia Rodrigues</span> <a href=\"#narrow/channel/113488-general/topic/State.20of.20HTTP.20.28Server-side.29/near/530686363\">said</a>:</p>\n<blockquote>\n<p>The code is in <a href=\"https://github.com/leanprover/lean4/tree/sofia/http\">this</a> branch. I'm currently fixing some other issues in the Async monad before returning to work on it. It's messy and experimental code, I would love to have some suggestions on how to improve it :)</p>\n</blockquote>\n<p>I had a quick look. From a usability perspective it would be nice to have</p>\n<ol>\n<li>\n<p>Some more logging per request (time &amp; some infos from Request/Response)</p>\n</li>\n<li>\n<p>A bit more context on the Errors, such as</p>\n</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">entityTooLarge</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">actual</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"c1\">-- ...</span>\n</code></pre></div>\n<ol start=\"3\">\n<li>Centralized server config, like maxConnections, keepAliveTimeout, accessLogFormat, ...</li>\n</ol>\n<p>On a nitpicky note, it seems <code>Connection#timeoutRecv</code> is not used currently?</p>\n<p>In any case, thanks a lot for developing this!</p>",
        "id": 530723353,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1753432852
    },
    {
        "content": "<p>This has worked like a charm! Thanks again! Just as a reference, here is the server and client code I use:<br>\n<a href=\"https://github.com/oOo0oOo/LeanRPC/blob/main/LeanRPC/HTTP.lean\">https://github.com/oOo0oOo/LeanRPC/blob/main/LeanRPC/HTTP.lean</a></p>",
        "id": 531902113,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1753899299
    }
]