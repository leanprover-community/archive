[
    {
        "content": "<p>In a PR where the line count of a file goes above the limit, the style linter check tells me</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">/</span><span class=\"n\">Measure</span><span class=\"bp\">/</span><span class=\"n\">Typeclasses</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"mi\">1531</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">up</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">style</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">run</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">lint</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"w\"> </span><span class=\"c1\">--update` to ignore all of them</span>\n</code></pre></div>\n<p>So I ran the command <code>lake exe lint-style --update</code>, but it failed with an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">\\</span><span class=\"n\">Algebra</span><span class=\"bp\">\\</span><span class=\"n\">BigOperators</span><span class=\"bp\">\\</span><span class=\"n\">Group</span><span class=\"bp\">\\</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"mi\">2254</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">up</span>\n<span class=\"bp\">...</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">\\</span><span class=\"n\">Topology</span><span class=\"bp\">\\</span><span class=\"n\">UniformSpace</span><span class=\"bp\">\\</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"mi\">1768</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">up</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unspecified</span><span class=\"w\"> </span><span class=\"n\">system_category</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">193</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I'm on windows. Does it ring a bell?</p>",
        "id": 464818257,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724493678
    },
    {
        "content": "<p>The initial <code>/</code> became <code>\\</code>, weird.</p>",
        "id": 464818392,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724493773
    },
    {
        "content": "<p>(and it emptied the file <code>scripts/style-exceptions.txt</code>)</p>",
        "id": 464818403,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724493783
    },
    {
        "content": "<p>Also, is the initial error correct, as in the file <code>Mathlib/MeasureTheory/Measure/Typeclasses.lean</code> really has 1531 lines?</p>",
        "id": 464818420,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724493799
    },
    {
        "content": "<p>Yes, the error is genuine, it's only the fixing step which is buggy.</p>",
        "id": 464818453,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1724493841
    },
    {
        "content": "<p>From the change in slashes, I wonder whether there is a misparsing of path separators.</p>",
        "id": 464818586,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724493939
    },
    {
        "content": "<p>(Btw, I hope that many of these issues will disappear if the <code>longFile</code> <em>syntax</em> linter will get merged, as there exceptions will be in-place and there will no longer be the need of a separate exception file.)</p>",
        "id": 464819023,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724494238
    },
    {
        "content": "<p>I am not sure, but I think that what happened is that the linter found your error, correctly identifying <code>\\</code> as path separators.  However, when it then tried to \"update\" stuff, it used the incorrect path separator, found no files with the new paths and cleared the exceptions.  Finally, it realized that there were style exceptions, even though the newly cleared exceptions file told it that there were none.</p>",
        "id": 464819468,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724494418
    },
    {
        "content": "<p>Or something along these lines.</p>",
        "id": 464819491,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724494424
    },
    {
        "content": "<p>(Sorry, I have to leave now and I am not too familiar with the <code>TextBased</code> code anyway.  I'll ping <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span>, in case he has not noticed this! <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> )</p>",
        "id": 464819960,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724494707
    },
    {
        "content": "<p>Thanks for pinging me. I also wonder if path separators are an issue. (I remember looking into this for <code>mk_all</code>, but perhaps I did not check if lint-style was also affected.) I will try to investigate tomorrow, but no promises (weekend and such).</p>",
        "id": 464903811,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1724535124
    },
    {
        "content": "<p>In the mean-time, you can certainly add the exception manually, or I can update the file for you.</p>",
        "id": 464903846,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1724535153
    },
    {
        "content": "<p>Sorry for the delay. I found a moment to investigate now:</p>\n<ul>\n<li>with <a href=\"https://github.com/leanprover-community/mathlib4/pull/15610\">#15610</a> landed, the text-based linter for long files is basically unused (in fact, <a href=\"https://github.com/leanprover-community/mathlib4/pull/16299\">#16299</a> proposes removing it). All remaining text-based linters should usually be fixed (not allowed); hence, this particular issue should not appear in practice any more.</li>\n<li>The text-based linter was indeed not taking different path separators into account. <a href=\"https://github.com/leanprover-community/mathlib4/pull/16329\">#16329</a> should fix this. <span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> Do you have a chance to test this change?<br>\n(It is fine if not; the PR seems like a strict improvement anyway.)</li>\n</ul>",
        "id": 466342309,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1725051609
    }
]