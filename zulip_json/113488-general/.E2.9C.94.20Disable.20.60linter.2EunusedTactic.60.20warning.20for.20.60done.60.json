[
    {
        "content": "<p>I am using the <code>done</code> tactic extensively in a project that uses Mathlib, but it has been complaining about it doing nothing. Reading the source code and documentation, it seems like I should use <code>Mathlib.Linter.UnusedTactic.addIgnoreTacticKind</code>, but I can't figure out how to make that work. This is what I've tried:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">initialize</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">``Lean.Parser.Tactic.done</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Parser.Tactic.done</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">``Lean.Elab.Tactic.evalDone</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Elab.Tactic.evalDone</span>\n</code></pre></div>",
        "id": 449959656,
        "sender_full_name": "Ricardo Prado Cunha",
        "timestamp": 1720465948
    },
    {
        "content": "<p>Here's a full MWE just to be clear about how I'm using this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">initialize</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">``Lean.Parser.Tactic.done</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Parser.Tactic.done</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">``Lean.Elab.Tactic.evalDone</span>\n<span class=\"w\">  </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Linter</span><span class=\"bp\">.</span><span class=\"n\">UnusedTactic</span><span class=\"bp\">.</span><span class=\"n\">addIgnoreTacticKind</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Elab.Tactic.evalDone</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  warning: ././././Test.lean:15:2: 'done' tactic does nothing</span>\n<span class=\"cm\">  note: this linter can be disabled with `set_option linter.unusedTactic false`</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"n\">done</span>\n</code></pre></div>\n<p>The multiple lines in the <code>initialize</code> block are just scattershot to try to get something to work.</p>",
        "id": 449963618,
        "sender_full_name": "Ricardo Prado Cunha",
        "timestamp": 1720466699
    },
    {
        "content": "<p>I think that <code>done</code> would have to be added to <code>allowed</code>, but it can't be done later on, it would have to be changed in mathlib.</p>",
        "id": 449965267,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720467174
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/113488-general/topic/Disable.20.60linter.2EunusedTactic.60.20warning.20for.20.60done.60/near/449965267\">said</a>:</p>\n<blockquote>\n<p>I think that <code>done</code> would have to be added to <code>allowed</code>, but it can't be done later on, it would have to be changed in mathlib.</p>\n</blockquote>\n<p>As per the discussion in <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/stream/113488-general/topic/pointless.20tactic.20linter\">#general &gt; pointless tactic linter</a>, they explicitly do not want <code>done</code> to in <code>allowed</code> for Mathlib, so that seems like a no-go.</p>",
        "id": 449966890,
        "sender_full_name": "Ricardo Prado Cunha",
        "timestamp": 1720467808
    },
    {
        "content": "<p>I don't like this alternative as much, but is there a way to do a <code>set_option</code> globally? <code>set_option linter.unusedTactic false</code> only applies to the current file, and adding it to the <code>leanOptions</code> array in the lake configuration doesn't work, since the option is dynamically registered while compiling.</p>",
        "id": 449966920,
        "sender_full_name": "Ricardo Prado Cunha",
        "timestamp": 1720467820
    },
    {
        "content": "<p>Unfortunately, setting options globally for a project is not supported at the moment.  There is an issue about it: if I can find it, you can give it a thumbs up!</p>",
        "id": 449974324,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720470180
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/3403\">lean4#3403</a>?</p>",
        "id": 449974668,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720470274
    },
    {
        "content": "<p>In a way similar to what is happening with the discussion about the <code>set_option</code> linter, it is possible to have different reporting on mathlib/projects, but I worry that different projects would have different, probably incompatible, requirements.</p>",
        "id": 449975097,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720470394
    },
    {
        "content": "<p>Here is a possible solution: <a href=\"https://github.com/leanprover-community/mathlib4/pull/14557\">#14557</a></p>\n<p>Let's see if it seems reasonable for mathlib!</p>",
        "id": 450092535,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720511761
    },
    {
        "content": "<p>Broadly looks good to me (but an expert should review the IO.Ref change).</p>",
        "id": 450101066,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1720514267
    },
    {
        "content": "<p>The change has been merged into mathlib: if you update mathlib, then</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">allow_unused_tactic</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">done</span>\n</code></pre></div>\n<p>will make the linter not flag <code>done</code>.</p>",
        "id": 450162349,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1720529105
    },
    {
        "content": "<p>tysm for the fix</p>",
        "id": 450186464,
        "sender_full_name": "Ricardo Prado Cunha",
        "timestamp": 1720535040
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"620085\">Ricardo Prado Cunha</span> has marked this topic as resolved.</p>",
        "id": 450186527,
        "sender_full_name": "Notification Bot",
        "timestamp": 1720535047
    }
]