[
    {
        "content": "<p>Hi,</p>\n<p>I am using leanblueprint for my master's thesis project and over the next few weeks will be using it heavily and was hoping to use this thread to ask for some help, I hope that is ok:</p>\n<p>The link to the blueprint is <a href=\"https://alexbrodbelt.github.io/ClassificationOfFiniteSubgroupsOfPGL/\">https://alexbrodbelt.github.io/ClassificationOfFiniteSubgroupsOfPGL/</a></p>\n<ol>\n<li>I cannot get the <code>minted</code>package to work. Things I have tried and were not sufficient:</li>\n</ol>\n<ul>\n<li>It seems \\usepackage{minted} in both web.tex and print.tex is not sufficient.</li>\n<li>Downloaded the pygmentize for python</li>\n<li>Have considered downloading the minted.sty from <a href=\"https://github.com/leanprover/tutorial/blob/master/minted.sty\">https://github.com/leanprover/tutorial/blob/master/minted.sty</a> but I'm not sure where to place such a file as the leanblueprint is not the typical LaTeX setup I have, if this makes sense.</li>\n</ul>\n<ol start=\"2\">\n<li>How hard would it be to define a code environment similar to the proof environment that toggles between showing the minted environment showing the corresponding lean code for a proof/definition. Ideally I would put it below the proof, as I would like to have the following structure for a given theorem:</li>\n</ol>\n<ul>\n<li>informal statement</li>\n<li>formal statement</li>\n<li>informal proof</li>\n<li>formal proof</li>\n<li>comments on formalization</li>\n</ul>\n<ol start=\"3\">\n<li>In general, defining another toggle environment would be quite useful or even new environments where the background is a different colours to emphasize it is code or not my work. My attempts so far have broken the blueprint.</li>\n</ol>\n<p>I would appreciate any pointers or things I should bear in mind. Thank you for your patience :-)</p>",
        "id": 500949194,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740077711
    },
    {
        "content": "<p>Currently there is not minted support in plastex. But using pygmentize would be fairly easy since it‚Äôs also python.</p>",
        "id": 500949968,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740077989
    },
    {
        "content": "<p>You cannot hope plastex will swallow the original minted.sty. Implementing this in python directly will be much easier.</p>",
        "id": 500950185,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078050
    },
    {
        "content": "<p>The <code>listings</code> support in plasTeX uses pygments, see <a href=\"https://github.com/plastex/plastex/blob/master/plasTeX/Packages/listings.py\">https://github.com/plastex/plastex/blob/master/plasTeX/Packages/listings.py</a></p>",
        "id": 500950356,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078121
    },
    {
        "content": "<p>By the way, do you also seek to produce a pdf version, or would you be happy with a web only rendering?</p>",
        "id": 500950469,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078145
    },
    {
        "content": "<p>My supervisor is trying to bargain being able to submit the web version as it is much nicer. But so far the pdf renders very nicely anyway. Would using the <code>listings</code> package break the pdf?</p>",
        "id": 500950615,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078205
    },
    {
        "content": "<p>About point 2, how do you want plasTeX to get the Lean code? Do you want to paste it into your TeX file? If yes then doing the toggle thing will be very easy. If you want to put a file path or url into the TeX file then it would take a bit more work. But everything is doable of course. You can hook the full power of python anywhere in the process.</p>",
        "id": 500950818,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078271
    },
    {
        "content": "<p>I suspect doing \\usepackage{listings} is sufficient as plasTeX can find a suitable script?</p>",
        "id": 500950821,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078273
    },
    {
        "content": "<p>If you are happy to use listings for the pdf then yes. But if you want minted for the pdf and listings for the web version then you need to define an environment (called <code>code</code> of whatever) in both preambles (<code>web.tex</code> and <code>print.tex</code>) and then use your environment. So it‚Äôs a bit more work, but not much.</p>",
        "id": 500951014,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078349
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/113488-general/topic/Customizing.20leanblueprint/near/500950818\">said</a>:</p>\n<blockquote>\n<p>About point 2, how do you want plasTeX to get the Lean code? Do you want to paste it into your TeX file? If yes then doing the toggle thing will be very easy. If you want to put a file path or url into the TeX file then it would take a bit more work. But everything is doable of course. You can hook the full power of python anywhere in the process.</p>\n</blockquote>\n<p>My plan was to copy and paste the relevant code into the TeX file, as I have 2 weeks and a half to clean up the project and present it.</p>",
        "id": 500951046,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078360
    },
    {
        "content": "<p>In the future I would like to use python to automate more of this and maybe contribute to leanblueprint should it be of value, but for now it will have to do.</p>",
        "id": 500951210,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078416
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/113488-general/topic/Customizing.20leanblueprint/near/500951014\">said</a>:</p>\n<blockquote>\n<p>If you are happy to use listings for the pdf then yes. But if you want minted for the pdf and listings for the web version then you need to define an environment (called <code>code</code> of whatever) in both preambles (<code>web.tex</code> and <code>print.tex</code>) and then use your environment. So it‚Äôs a bit more work, but not much.</p>\n</blockquote>\n<p>I see that makes sense. OK, so <code>minted</code> will work for the pdf.</p>",
        "id": 500951300,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078451
    },
    {
        "content": "<p>Did you look at the code at <a href=\"https://github.com/PatrickMassot/plastexshowmore/\">https://github.com/PatrickMassot/plastexshowmore/</a> already?</p>",
        "id": 500951692,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078592
    },
    {
        "content": "<p>I was not aware of this repo. I will check it out, thanks!</p>",
        "id": 500951863,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740078642
    },
    {
        "content": "<p>This is a pretty simple plasTeX plugin that add the icons showing and hiding proofs in certain blueprints. You can see those icons in the lower right corner of <a href=\"https://leanprover-community.github.io/sphere-eversion/blueprint/chap-local.html\">https://leanprover-community.github.io/sphere-eversion/blueprint/chap-local.html</a> for instance.</p>",
        "id": 500951967,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078688
    },
    {
        "content": "<p>Of course you need to read <a href=\"https://plastex.github.io/plastex/plastex/sec-plugins.html\">https://plastex.github.io/plastex/plastex/sec-plugins.html</a> before making sense of any plasTeX plugin.</p>",
        "id": 500952136,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078750
    },
    {
        "content": "<p>I mean this page and the following ones in the same section.</p>",
        "id": 500952215,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078784
    },
    {
        "content": "<p>Another useful read is the theorem template at <a href=\"https://github.com/plastex/plastex/blob/master/plasTeX/Renderers/HTML5/Thms.jinja2s\">https://github.com/plastex/plastex/blob/master/plasTeX/Renderers/HTML5/Thms.jinja2s</a></p>",
        "id": 500952584,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740078939
    },
    {
        "content": "<p>This is extremely helpful, thank you Patrick!</p>",
        "id": 500953193,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740079174
    },
    {
        "content": "<p>As a case study in how things fit together, let‚Äôs try for instance to answer the question: ‚ÄúHow does the LeanBlueprint plasTeX plugin manages to add a checkmark to formalized lemmas?‚Äù In the Thms.jinja2s, we see starting on line 27</p>\n<div class=\"codehilite\" data-code-language=\"HTML\"><pre><span></span><code>    {% if doc.userdata['thm_header_extras_tpl'] %}\n    <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">class</span><span class=\"o\">=</span><span class=\"s\">\"thm_header_extras\"</span><span class=\"p\">&gt;</span>\n    {% for tpl in doc.userdata['thm_header_extras_tpl'] %}\n    {% include tpl %}\n    {% endfor %}\n    <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>\n    {% endif %}\n</code></pre></div>\n<p>and in <a href=\"https://github.com/PatrickMassot/leanblueprint/blob/master/leanblueprint/Packages/blueprint.py\">https://github.com/PatrickMassot/leanblueprint/blob/master/leanblueprint/Packages/blueprint.py</a> we see</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">CHECKMARK_TPL</span> <span class=\"o\">=</span> <span class=\"n\">Template</span><span class=\"p\">(</span><span class=\"s2\">\"\"\"</span>\n<span class=\"s2\">    {</span><span class=\"si\">% i</span><span class=\"s2\">f obj.userdata.leanok and ('proved_by' not in obj.userdata or obj.userdata.proved_by.userdata.leanok ) %}</span>\n<span class=\"s2\">    ‚úì</span>\n<span class=\"s2\">    {</span><span class=\"si\">% e</span><span class=\"s2\">ndif %}</span>\n<span class=\"s2\">\"\"\"</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>and then further down</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code>    <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">userdata</span><span class=\"o\">.</span><span class=\"n\">setdefault</span><span class=\"p\">(</span>\n        <span class=\"s1\">'thm_header_extras_tpl'</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">([</span><span class=\"n\">CHECKMARK_TPL</span><span class=\"p\">])</span>\n</code></pre></div>\n<p>Does it make some sense?</p>",
        "id": 500953416,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740079246
    },
    {
        "content": "<p>yes, this reminds me a fair bit of how things in svelte work.</p>",
        "id": 500953873,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740079413
    },
    {
        "content": "<p>what is <code>tpl</code> iterating over? What sort of data?</p>",
        "id": 500954059,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740079479
    },
    {
        "content": "<p>I suppose my initial questions without having read the sources you provide are: how do you link this back to the TeX or the web/print generation? I was looking at FLT and LeanAPAP to see how python scripts are used. Will think about this when I get back home, thank you Patrick :-)</p>",
        "id": 500954551,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740079682
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634542\">Alex Brodbelt</span> <a href=\"#narrow/channel/113488-general/topic/Customizing.20leanblueprint/near/500954059\">said</a>:</p>\n<blockquote>\n<p>what is <code>tpl</code> iterating over? What sort of data?</p>\n</blockquote>\n<p>probably not a meaningful question, can probably figure this out.</p>",
        "id": 500954662,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740079718
    },
    {
        "content": "<p>Sorry, I was having dinner. It‚Äôs iterating over Jinja2 templates.</p>",
        "id": 500962775,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740083007
    },
    {
        "content": "<p>For others wanting to do similar, the <code>verbatim</code> package works very well with leanblueprint in both web and print version; it even renders the unicode! (or at least the subset of unicode I have thrown at it so far)</p>\n<p>I tried <code>listings</code>for the web version and ran into issues with unicode and just setting it up in general.</p>\n<p>I also tried <code>minted</code> for the print version and I suspect it would work well but it has issues rendering unicode - I did not try using <code>inputenc</code> to remedy this.</p>",
        "id": 501836887,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740498029
    },
    {
        "content": "<p>I think I have a minted implementation for plasTeX lying around somewhere...</p>",
        "id": 501839468,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740498441
    },
    {
        "content": "<p>I assume that when using a theorem from mathlib there is no way you can reference it using <code>lean{}</code> as it is not part of your project but part of mathlib? </p>\n<p>The purpose of wanting to do this, is to help others wanting to use this particular part of mathlib understand how informal maths corresponds to formal maths and as far as I understand why certain decisions were made.</p>",
        "id": 501839639,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740498473
    },
    {
        "content": "<p>There should be no problem at all, unless I misunderstand the question.</p>",
        "id": 501839995,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740498511
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Customizing.20leanblueprint/near/501839468\">said</a>:</p>\n<blockquote>\n<p>I think I have a minted implementation for plasTeX lying around somewhere...</p>\n</blockquote>\n<p>Presented without warranty:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">pathlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Path</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">plasTeX</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Command</span><span class=\"p\">,</span> <span class=\"n\">Environment</span><span class=\"p\">,</span> <span class=\"n\">VerbatimEnvironment</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">plasTeX.Base.LaTeX.Verbatim</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">verbatim</span><span class=\"p\">,</span> <span class=\"n\">verb</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">plasTeX.Logging</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">getLogger</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">plasTeX.PackageResource</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">PackagePreCleanupCB</span><span class=\"p\">,</span> <span class=\"n\">PackageCss</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">plasTeX.PackageResource</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">PackageResource</span><span class=\"p\">,</span> <span class=\"n\">PackageCss</span><span class=\"p\">,</span> <span class=\"n\">PackageTemplateDir</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">pygments</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">lexers</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">pygments.formatters</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">HtmlFormatter</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">pygments.lexers.special</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">TextLexer</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">pygments</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">textwrap</span>\n\n<span class=\"n\">log</span> <span class=\"o\">=</span> <span class=\"n\">getLogger</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">minted</span><span class=\"p\">(</span><span class=\"n\">verbatim</span><span class=\"p\">):</span>\n    <span class=\"n\">autogobble</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">digest</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">tokens</span><span class=\"p\">):</span>\n        <span class=\"n\">verbatim</span><span class=\"o\">.</span><span class=\"n\">digest</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">tokens</span><span class=\"p\">)</span>\n        <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">textContent</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">autogobble</span><span class=\"p\">:</span>\n            <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">dedent</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">lstrip</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">))</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_content</span> <span class=\"o\">=</span> <span class=\"n\">text</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">lexer</span> <span class=\"o\">=</span> <span class=\"n\">lexers</span><span class=\"o\">.</span><span class=\"n\">get_lexer_by_name</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">language</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n            <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">warning</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"No lexer for </span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">language</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n            <span class=\"n\">lexer</span> <span class=\"o\">=</span> <span class=\"n\">TextLexer</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">html_listing</span> <span class=\"o\">=</span> <span class=\"n\">pygments</span><span class=\"o\">.</span><span class=\"n\">highlight</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_content</span><span class=\"p\">,</span> <span class=\"n\">lexer</span><span class=\"p\">,</span>\n                <span class=\"n\">HtmlFormatter</span><span class=\"p\">(</span><span class=\"n\">nowrap</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">mintinline</span><span class=\"p\">(</span><span class=\"n\">verb</span><span class=\"p\">):</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">digest</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">tokens</span><span class=\"p\">):</span>\n        <span class=\"n\">verb</span><span class=\"o\">.</span><span class=\"n\">digest</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">tokens</span><span class=\"p\">)</span>\n        <span class=\"n\">text</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">textContent</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_content</span> <span class=\"o\">=</span> <span class=\"n\">text</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">lexer</span> <span class=\"o\">=</span> <span class=\"n\">lexers</span><span class=\"o\">.</span><span class=\"n\">get_lexer_by_name</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">language</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n            <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">warning</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">\"No lexer for </span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">language</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">)</span>\n            <span class=\"n\">lexer</span> <span class=\"o\">=</span> <span class=\"n\">TextLexer</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">html_listing</span> <span class=\"o\">=</span> <span class=\"n\">pygments</span><span class=\"o\">.</span><span class=\"n\">highlight</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_content</span><span class=\"p\">,</span> <span class=\"n\">lexer</span><span class=\"p\">,</span>\n                <span class=\"n\">HtmlFormatter</span><span class=\"p\">(</span><span class=\"n\">nowrap</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">lean</span><span class=\"p\">(</span><span class=\"n\">mintinline</span><span class=\"p\">):</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">'lean'</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">leanf</span><span class=\"p\">(</span><span class=\"n\">mintinline</span><span class=\"p\">):</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">'lean4'</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">leancode</span><span class=\"p\">(</span><span class=\"n\">minted</span><span class=\"p\">):</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">'lean'</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">lean4code</span><span class=\"p\">(</span><span class=\"n\">minted</span><span class=\"p\">):</span>\n    <span class=\"n\">language</span> <span class=\"o\">=</span> <span class=\"s1\">'lean4'</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">ProcessOptions</span><span class=\"p\">(</span><span class=\"n\">options</span><span class=\"p\">,</span> <span class=\"n\">document</span><span class=\"p\">):</span>\n\n    <span class=\"n\">tpl</span> <span class=\"o\">=</span> <span class=\"n\">PackageTemplateDir</span><span class=\"p\">(</span>\n        <span class=\"n\">renderers</span><span class=\"o\">=</span><span class=\"s1\">'html5'</span><span class=\"p\">,</span>\n        <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"vm\">__file__</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"o\">/</span><span class=\"s1\">'templates'</span><span class=\"p\">)</span>\n\n    <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">addPackageResource</span><span class=\"p\">([</span><span class=\"n\">tpl</span><span class=\"p\">])</span>\n\n    <span class=\"n\">cb</span> <span class=\"o\">=</span> <span class=\"n\">PackagePreCleanupCB</span><span class=\"p\">(</span><span class=\"n\">renderers</span><span class=\"o\">=</span><span class=\"s1\">'html5'</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">make_pygments_css</span><span class=\"p\">)</span>\n    <span class=\"n\">css</span> <span class=\"o\">=</span> <span class=\"n\">PackageCss</span><span class=\"p\">(</span><span class=\"n\">renderers</span><span class=\"o\">=</span><span class=\"s1\">'html5'</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"s1\">'pygments.css'</span><span class=\"p\">))</span>\n    <span class=\"n\">css</span><span class=\"o\">.</span><span class=\"n\">copy</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">addPackageResource</span><span class=\"p\">([</span>\n        <span class=\"n\">cb</span><span class=\"p\">,</span> <span class=\"n\">css</span><span class=\"p\">,</span>\n        <span class=\"n\">PackageCss</span><span class=\"p\">(</span><span class=\"n\">renderers</span><span class=\"o\">=</span><span class=\"s1\">'html5'</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"vm\">__file__</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"o\">/</span><span class=\"s1\">'css'</span><span class=\"o\">/</span><span class=\"s1\">'codeboxes.css'</span><span class=\"p\">)</span>\n    <span class=\"p\">])</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">make_pygments_css</span><span class=\"p\">(</span><span class=\"n\">document</span><span class=\"p\">):</span>\n    <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"s1\">'styles'</span><span class=\"p\">)</span><span class=\"o\">/</span><span class=\"s1\">'pygments.css'</span>\n    <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">write_text</span><span class=\"p\">(</span><span class=\"n\">HtmlFormatter</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_style_defs</span><span class=\"p\">())</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)]</span>\n</code></pre></div>\n</div></div>",
        "id": 501840157,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740498537
    },
    {
        "content": "<p>So I tried, putting <code>\\lean{Subgroup.center}</code> to have the definition for the center visible but it does not find it and lists the definitions I have made as potential remedies.</p>\n<p><a href=\"/user_uploads/3121/nAkq18-gpII_IbS3sFkDVB_v/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/nAkq18-gpII_IbS3sFkDVB_v/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1150x636\" src=\"/user_uploads/thumbnail/3121/nAkq18-gpII_IbS3sFkDVB_v/image.png/840x560.webp\"></a></div>",
        "id": 501840504,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740498593
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634542\">Alex Brodbelt</span> <a href=\"#narrow/channel/113488-general/topic/Customizing.20leanblueprint/near/501836887\">said</a>:</p>\n<blockquote>\n<p>For others wanting to do similar, the <code>verbatim</code> package works very well with leanblueprint in both web and print version; it even renders the unicode! (or at least the subset of unicode I have thrown at it so far)</p>\n<p>I tried <code>listings</code>for the web version and ran into issues with unicode and just setting it up in general.</p>\n<p>I also tried <code>minted</code> for the print version and I suspect it would work well but it has issues rendering unicode - I did not try using <code>inputenc</code> to remedy this.</p>\n</blockquote>\n<p>It seems I got a bit excited, it does indeed work for the local web version - but when I push to github things fall apart. I wonder if this means I should modify what github actions run? <br>\nI suspect it is the unicode characters which XeTeX is not happy with</p>",
        "id": 502047325,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740576689
    },
    {
        "content": "<p>Unicode shouldn't be an issue for plasTeX (the blueprint software) or XeTeX</p>",
        "id": 502055380,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740578836
    },
    {
        "content": "<p>I get a combination of the following type warnings:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Package</span><span class=\"w\"> </span><span class=\"n\">hyperref</span><span class=\"w\"> </span><span class=\"n\">Warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Token</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">PDF</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Unicode</span><span class=\"o\">):</span>\n<span class=\"o\">(</span><span class=\"n\">hyperref</span><span class=\"o\">)</span><span class=\"w\">                </span><span class=\"n\">removing</span><span class=\"w\"> </span><span class=\"ss\">`math</span><span class=\"w\"> </span><span class=\"n\">shift'</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mf\">1.</span>\n</code></pre></div>\n<p>My hunch for this is that writing mathmode in the section titles does not make LaTeX hyperref happy - but it has not crashed because of this before.</p>\n<p>and warnings from what I am guessing are the verbatim boxes:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Missing</span><span class=\"w\"> </span><span class=\"n\">character</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">There</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"bp\">+</span><span class=\"mi\">2203</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">font</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lmmono10</span><span class=\"bp\">-</span><span class=\"n\">regular</span><span class=\"o\">]:</span><span class=\"bp\">!</span>\n</code></pre></div>\n<p>Overall, this leads to the following error message</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">Internal</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bad</span><span class=\"w\"> </span><span class=\"n\">native</span><span class=\"w\"> </span><span class=\"n\">font</span><span class=\"w\"> </span><span class=\"n\">flag</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"ss\">`map_char_to_glyph'</span>\n\n<span class=\"n\">xdvipdfmx</span><span class=\"o\">:</span><span class=\"n\">fatal</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"n\">ended</span><span class=\"w\"> </span><span class=\"n\">prematurely</span>\n</code></pre></div>\n<p>In the larger trace at:<br>\n<a href=\"https://github.com/AlexBrodbelt/ClassificationOfFiniteSubgroupsOfPGL/actions/runs/13544289543/job/37852134797\">https://github.com/AlexBrodbelt/ClassificationOfFiniteSubgroupsOfPGL/actions/runs/13544289543/job/37852134797</a></p>\n<p>Upon StackOverflow-ing: <a href=\"https://tex.stackexchange.com/questions/63244/internal-error-bad-native-font-flag-xelatex-fontspec-newtxmath-libertine\">https://tex.stackexchange.com/questions/63244/internal-error-bad-native-font-flag-xelatex-fontspec-newtxmath-libertine</a> </p>\n<p>Maybe using <code>\\texttt{}</code>is not a good idea for inline code? As it mixes OpenType and TFM fonts which is not supported in XeTeX. </p>\n<p>Conclusion: I am not sure how to debug yet, maybe using your minted plasTeX should make my problems vanish?</p>",
        "id": 502057552,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740579391
    },
    {
        "content": "<p>All those error messages seem to have <em>nothing</em> to do with plastex.</p>",
        "id": 502058518,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740579636
    },
    {
        "content": "<p>They all come from xelatex.</p>",
        "id": 502058548,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740579644
    },
    {
        "content": "<p>And that mention of xdvipdfmx sounds very wrong. How could the dvi file format be involved in 2025?</p>",
        "id": 502058657,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740579670
    },
    {
        "content": "<p>And if it works locally then the issue is with the TeX setup in CI.</p>",
        "id": 502058864,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1740579721
    },
    {
        "content": "<p>Ahhh so it indeed might be a problem with the CI?</p>",
        "id": 502059127,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740579781
    },
    {
        "content": "<blockquote>\n<p><code>Missing character: There is no ‚àÉ (U+2203) in font [lmmono10-regular]:!</code></p>\n</blockquote>\n<p>I would hope you can fix this by using a better font. Julia Mono is a reasonable choice, as is Deja Vu Sans Mono</p>",
        "id": 502059130,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740579781
    },
    {
        "content": "<p>I must admit I do not know too much about typesetting and LaTeX - I am guessing you mean I should fix the preamble to be (in some appropriate place): </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">\\</span><span class=\"n\">usepackage</span><span class=\"o\">{</span><span class=\"n\">fontspec</span><span class=\"o\">}</span>\n\n<span class=\"bp\">\\</span><span class=\"n\">setmainfont</span><span class=\"o\">{</span><span class=\"n\">DejaVu</span><span class=\"w\"> </span><span class=\"n\">Serif</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 502060187,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1740580069
    },
    {
        "content": "<p>See <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/LaTeX.20beamer/near/476469255\">#general &gt; LaTeX beamer @ üí¨</a>  for an example with LuaLaTeX, which should be similar enough</p>",
        "id": 502060695,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740580201
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 504124273,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741361950
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 504298064,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741454210
    },
    {
        "content": "<p>Is there a reason why the dependency graph is not visible if one opens the html file from the <code>web</code> folder? Is there something I can do to make the dependency graph visible - it would be a shame if I could not show such a pretty thing!</p>\n<p>(I should say that when I run <code>leanblueprint web</code> and then <code>leanblueprint serve</code> everything works wonderfully (aside from the bibliography being shy)</p>\n<p><a href=\"/user_uploads/3121/Et5e1HBQZsEaCON8PL1oYVUq/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Et5e1HBQZsEaCON8PL1oYVUq/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1839x660\" src=\"/user_uploads/thumbnail/3121/Et5e1HBQZsEaCON8PL1oYVUq/image.png/840x560.webp\"></a></div>",
        "id": 504406595,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741536127
    },
    {
        "content": "<p>Probably if that worked, the blueprint could also read all your passwords</p>",
        "id": 504408502,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741537516
    },
    {
        "content": "<p>I see</p>",
        "id": 504409161,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741538038
    },
    {
        "content": "<p>I'm assuming from the deleted messages and the screenshot that you now have things working! :-)</p>",
        "id": 504409562,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741538336
    },
    {
        "content": "<p>ehh, unfortunately that is not the case :'(  - but I am cutting my losses <span aria-label=\"light bulb\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"light bulb\">:light_bulb:</span></p>",
        "id": 504409598,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741538373
    },
    {
        "content": "<p>yeah, this is a general web browser limitation done for security reasons. You can work around it by serving the folder on localhost so that the browser applies a different security policy. A long time ago someone taught me that python supports this out of the box with <code>python3 -m http.server</code>, even without writing a line of python. But it sounds like <code>leanblueprint serve</code> also does the same thing</p>",
        "id": 504420240,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1741546217
    },
    {
        "content": "<p>Ah so I can tell the markers to launch it using <code>python3 -m ...</code> so they can see the dependency graph? It's going to be interesting to see how they mark this Lean project...</p>",
        "id": 504450351,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741568593
    },
    {
        "content": "<p>Is there a way for using labels that don't appear in the dependency graph? (i.e theorems are already in mathlib but still want to reference)</p>",
        "id": 504450400,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741568634
    },
    {
        "content": "<p>Or you host the output on a (private) GitHub repo, which runs the server for you</p>",
        "id": 504496820,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741593324
    },
    {
        "content": "<p>Private repos still have public webpages, so you can just give the graders the url</p>",
        "id": 504496904,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741593353
    },
    {
        "content": "<p>They might want a copy that can't be changed out from under them, though</p>",
        "id": 504501578,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741594726
    }
]