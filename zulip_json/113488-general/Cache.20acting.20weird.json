[
    {
        "content": "<p>For the past few days cache had some weird behaviors that I have never seen before. I thought it was a transient issue on my local machine but yesterday at Xena there were several people hitting this issue. The error messages comes in several flavours but here is one</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">erd1</span><span class=\"bp\">/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Classes</span><span class=\"bp\">/</span><span class=\"n\">Cast</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">incompatible</span><span class=\"w\"> </span><span class=\"n\">header</span>\n</code></pre></div>\n<p>I assume this means the cache is out of date but restarting the file nor the server works. Sometimes <code>lake build</code> fixes this but sometimes you need to <code>lake clean</code>. </p>\n<p>This usually happens when opening a new file or importing a new file that has no cache but it is very unreproducible. I wonder if there are other people facing this that knows better about what is going on?</p>",
        "id": 520135260,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748037829
    },
    {
        "content": "<p>I did <code>rm -rf .lake</code> in FLT for the first time in a very long time today after getting cache looked like it worked but <code>lake build</code> started to build the second half of mathlib instead of FLT. Nuking .lake fixed it. Also someone just starting to help with FLT DMed me on Tuesday or so with a weird cache error complaining about proofwidgets and I commented that usually nowadays we didn't have to <code>rm -rf .lake</code> but I didn't understand his error so he should try it. It also fixed his problems.</p>",
        "id": 520135672,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748038031
    },
    {
        "content": "<p>It sounds like you simply corrupted your cache by partially rebuilding it</p>",
        "id": 520145003,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748045293
    },
    {
        "content": "<p>But usually restarting file will solve this.</p>",
        "id": 520145036,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748045330
    },
    {
        "content": "<p>No, restarting a file never solved a corrupted cache for me</p>",
        "id": 520145295,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748045537
    },
    {
        "content": "<p>Corrupting is quite rare IME. It might be the first time it happens to you?</p>",
        "id": 520145451,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748045674
    },
    {
        "content": "<p>Then maybe we are not talking the same corrputed cache.<br>\nCurrently if I open two fresh new file and try to import one from the other I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">erd1</span><span class=\"bp\">/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">NumberTheory</span><span class=\"bp\">/</span><span class=\"n\">NumberField</span><span class=\"bp\">/</span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">exist</span>\n</code></pre></div>\n<p>And the only way to solve it is to run lake build a few times.</p>",
        "id": 520145452,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748045674
    },
    {
        "content": "<p>Ah! That's a different error from the one you mentioned in your original post</p>",
        "id": 520145494,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1748045721
    },
    {
        "content": "<p>I get corruptions pretty often if I switch branch with an editor open</p>",
        "id": 520145512,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748045738
    },
    {
        "content": "<p>Yeah I said \"The error messages comes in several flavours\" and that one in the OP is the one I happen to see when I started this thread. But probably as you said they are different things.</p>",
        "id": 520145574,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748045781
    },
    {
        "content": "<p>I got a new variant again</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">`/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">erd1</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.20.0-rc5/bin/lake setup-file /Users/erd1/Desktop/lean/mathlib4/Mathlib/NumberTheory/NumberField/Representation/Basic.lean Init Mathlib Mathlib.NumberTheory.NumberField.Representation.Lemmas --no-build --no-cache` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">6752</span><span class=\"bp\">/</span><span class=\"mi\">6753</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">erd1</span><span class=\"bp\">/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">NumberTheory</span><span class=\"bp\">/</span><span class=\"n\">NumberField</span><span class=\"bp\">/</span><span class=\"n\">Lemmas</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">6753</span><span class=\"bp\">/</span><span class=\"mi\">6753</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">setup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Representation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">erd1</span><span class=\"bp\">/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">NumberTheory</span><span class=\"bp\">/</span><span class=\"n\">NumberField</span><span class=\"bp\">/</span><span class=\"n\">Representation</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bad</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Lemmas'</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">setup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Representation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>which was still fixed by a <code>lake build</code> but not via restart file.</p>",
        "id": 520152106,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1748051789
    }
]