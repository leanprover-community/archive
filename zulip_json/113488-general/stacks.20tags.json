[
    {
        "content": "<p>Top 35, with labels</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>00DV 119 algebra-lemma-NAK\n01ZM 69 limits-lemma-descend-finite-presentation\n02KH 64 coherent-lemma-flat-base-change-cohomology\n06Z0 61 perfect-lemma-affine-compare-bounded\n03H4 57 spaces-properties-lemma-points-cartesian\n01XB 48 coherent-lemma-quasi-coherent-affine-cohomology-zero\n00NX 47 algebra-lemma-finite-projective\n01UA 46 morphisms-lemma-fppf-open\n0149 41 derived-lemma-representable-homological\n00DS 41 algebra-lemma-silly\n01LC 40 schemes-lemma-push-forward-quasi-coherent\n00E0 40 algebra-lemma-Zariski-topology\n00MB 39 algebra-lemma-completion-flat\n00EU 37 algebra-lemma-minimal-prime-reduced-ring\n01T6 36 morphisms-lemma-finite-type-noetherian\n00XR 36 sites-lemma-when-shriek\n00U2 36 algebra-lemma-etale\n03H6 34 spaces-properties-lemma-quasi-compact-affine-cover\n01W6 34 morphisms-lemma-image-proper-scheme-closed\n00NQ 34 algebra-lemma-regular-ring-CM\n01Z4 33 limits-lemma-descend-opens\n00HN 32 algebra-lemma-characterize-zero-local\n001P 32 categories-lemma-yoneda\n08J5 31 derived-remark-truncation-distinguished-triangle\n01T2 31 morphisms-lemma-locally-finite-type-characterize\n00KW 31 algebra-lemma-one-equation\n07SK 29 spaces-limits-lemma-descend-finite-presentation\n01WM 29 morphisms-lemma-integral-universally-closed\n01U9 29 morphisms-lemma-base-change-flat\n015J 29 derived-lemma-two-ss-complex-functor\n04XB 28 stacks-properties-section-properties-morphisms\n04KF 28 spaces-properties-lemma-describe-etale-local-ring\n01WN 28 morphisms-lemma-finite-proper\n00HL 28 algebra-lemma-flat-tor-zero\n00HI 28 algebra-lemma-flat-base-change\n</code></pre></div>",
        "id": 226943606,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613729563
    },
    {
        "content": "<p>A brief glance, we have <code>NAKayama</code>, <code>yoneda</code>, <code>Zariski-topology</code>. Most of the rest seems quite far away.</p>",
        "id": 226943821,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613729679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/113488-general/topic/https.3A.2F.2Fleanprover-community.2Egithub.2Eio.2Fmathlib_docs.2F/near/226938750\">said</a>:</p>\n<blockquote>\n<p>I think the chance that old tags rot is very small. So the main issue is that new things should get tagged. This will have to be a community effort. But I think it's ok if we do it in bursts.</p>\n</blockquote>\n<p>But like you said there are a lot of stacks tags, and there are a lot of contributors here who don't know the project. How do these bursts work? Read all the stacks tags and remember what's been added to mathlib since the last iteration? Or look at a month of mathlib commits and see which ones might have corresponding tags?</p>",
        "id": 226944487,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613730086
    },
    {
        "content": "<p>Is there any chance of a new stacks tag that corresponds to something already in mathlib?</p>",
        "id": 226944533,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613730122
    },
    {
        "content": "<p>I think the latter chance is very small (but increasing?!)</p>",
        "id": 226945293,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613730597
    },
    {
        "content": "<p>Those bursts would have to be done by the algebraists in our community. Look through <code>ring_theory/</code> and <code>algebraic_geometry/</code> for lemmas that don't have <code>@[stacks]</code> but for which you expect that SP will have a tag for it.</p>",
        "id": 226945439,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613730665
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/stream/113488-general/topic/https.3A.2F.2Fleanprover-community.2Egithub.2Eio.2Fmathlib_docs.2F/near/226945293\">said</a>:</p>\n<blockquote>\n<p>I think the latter chance is very small (but increasing?!)</p>\n</blockquote>\n<p>Do old tags ever get split? Like, ABC gets expanded and a lemma becomes DEF? That seems like the more likely way for this to happen.</p>",
        "id": 226945487,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613730713
    },
    {
        "content": "<p>They make a very strong effort to never change the <em>statement</em> of a tag (apart from cosmetic changes).</p>",
        "id": 226945590,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613730766
    },
    {
        "content": "<p>So if there is a split, my guess is that you'll get two new tags, and the old one will be \"deprecated\" (but still point to the old result, but not show up in their most rendering of the website)</p>",
        "id": 226945655,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613730799
    },
    {
        "content": "<p>Right, so if ABC is in mathlib and gets split into DEF and GHI, then DEF and GHI are new tags that are likely in mathlib</p>",
        "id": 226945742,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613730851
    },
    {
        "content": "<p>So you need to track changes on their end as well as ours</p>",
        "id": 226945771,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613730876
    },
    {
        "content": "<p>I think they maintain a list of deprecated tags. So part of a \"burst\" could be to check against that list.</p>",
        "id": 226945853,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613730950
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>#003W,categories-equation-fibred-groupoids-commutes\n#003X,categories-equation-fibred-groupoids-commutes2\n#Taken out as an exact duplicate of 00CR\n#00DU,algebra-lemma-localize-colimit\n#This equation was in a second proof 00EE which we removed\n#00EL,algebra-equation-idempotent-exact-sequence\n#Replaced proof by a new one avoiding this equation\n#013L,derived-equation-new-star\n#013M,derived-equation-star-star\n#013Z,derived-remark-failure\n#014T,derived-section-derived-triangulated\n#014U,derived-definition-derived-triangulated\n#0155,derived-lemma-ses-injective-ses\n# Equations for relations between maps no longer needed because of\n# vastly improve proof of Lemma Tag 01A6\n#01A7,simplicial-equation-cd\n#01A8,simplicial-equation-cs\n# Changed coherent-remark-base-complex into lemma\n# Changed coherent-remark-hypercoverings into lemma\n#The following tag referred to a technical question whose answer is now in the\n#stacks project, namely, it is answered by (the new version of) 01ZH\n#01ZI,limits-remark-question-finite-type-necessary\n# This section got moved to properies.tex\n# This affects tags 01ZU, 01ZV, 01ZW, 01ZX, 01ZY\n</code></pre></div>",
        "id": 226946101,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613731099
    },
    {
        "content": "<p>All the commented out tags are deprecated. <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span> is the first chunk of about 100 such lines that <code>grep</code> found for me in <code>tags/tags</code></p>",
        "id": 226946147,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613731130
    },
    {
        "content": "<p>So I'm not saying \"don't do this,\" just trying to emphasize that this is a sustained maintenance effort that needs someone to lead the charge. Otherwise infrastructure will be built and forgotten and there will be a bunch of incomplete and outdated noise floating around.</p>",
        "id": 226946396,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613731299
    },
    {
        "content": "<p>OK I'll do it.</p>",
        "id": 226946586,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613731422
    },
    {
        "content": "<p>Stacks is becoming a canonical reference for commutative algebra for the young -- even the \"standard\" textbooks like Matsumura and Atiyah-Macdonald seem to be going out of fashion, because Stacks is online and looks beautiful, much better than the dodgy illegal pdfs (sometimes not even OCR'ed) which the UGs have of the classic books.</p>\n<p>For me, moving into commutative algebra is a very natural next step for mathlib. Avigad has always pointed out how Lean is really dominating when it comes to algebra. Isabelle is still way ahead on analysis and of course Coq has the odd order theorem, however the odd order theorem is tons of lemmas about finite groups and some basic undergraduate representation theory, and this does not really add new users. If you look at what is coming out way, it's mathematicians appearing out of nowhere saying things like \"let's do regular rings\" or \"let's do flat modules\". Stacks is a perfect blueprint for this stuff.</p>\n<p>I know the material well enough to even start breaking stuff up into \"mini-projects\", and I can probably be trusted to be diligent enough to make sure that things aren't broken. Disadvantages: I can't do any computer things. But I think that if the buck stops with me then this will be good enough for me to at least take responsibility for problems.</p>",
        "id": 226947012,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613731664
    },
    {
        "content": "<p>Another thing I mentioned when we talked about this a while back. This is a big human-curated formal-informal alignment, the ML people here should be drooling at the idea. It would probably be helpful to have a story for <a href=\"https://stacks.math.columbia.edu/tag/055X\">things that don't align perfectly</a> -- humans can adapt easily enough, maybe machines could use something systematic?</p>",
        "id": 226947061,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613731684
    },
    {
        "content": "<p>I agree that we could try to at least have a bool that tracks whether things \"obviously don't line up perfectly\". But as you point out, since the definition of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{N}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">N</span></span></span></span></span> doesn't line up, that basically means that almost everything that follows is infected by that virus.</p>",
        "id": 226947321,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613731877
    },
    {
        "content": "<p>So that <code>bool</code> should be applied with a bit of human wisdom...</p>",
        "id": 226947339,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613731894
    },
    {
        "content": "<p>One issue which I discovered recently is that when Bhavik was working on sheaves taking values in a general category, he had to cite things like \"Stacks, remark between tag X and tag Y\". For me the natural number thing is right now just noise. I know this sounds weird but actually the natural numbers in some sense do not show up much in this kind of mathematics. I took a good look through stacks when this convention was pointed out a few months back, and most of the uses of naturals just seemed to be as an arbitrary countably infinite index set. One of the few times naturals do show up as as dimensions of schemes, and certainly there are 0-dimensional schemes, so all that will be happening is that Stacks will sometimes say Z_{&gt;=0}. We can translate this, as long as I'm overseeing stuff.</p>",
        "id": 226947347,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613731901
    },
    {
        "content": "<p>I guess we can make PRs to Stacks that add labels to \"remark between tag X and tag Y\", or rewrite that part of stacks to make things slightly more explicit. My guess is that Johan will be happy to receive such PRs.</p>",
        "id": 226947478,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613731984
    },
    {
        "content": "<p>I think we need to talk to Pieter Belmans about this (he's at Bonn, the same place as Scholze, so this is cool).</p>",
        "id": 226947520,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613732002
    },
    {
        "content": "<p>I had rather hoped that this term would be a bit quieter, but preparing my course has taken a lot of my time. It's over in three weeks though.</p>",
        "id": 226947627,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613732049
    },
    {
        "content": "<p>It reminds me: did we settle the crazy <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> issue? I don't care what the Stacks project thinks here, there is now way we can keep the notation and name <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> for something related but different from what the whole universe but the Stacks project calls <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>.</p>",
        "id": 226947777,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1613732153
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> yes, that got fixed</p>",
        "id": 226948137,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613732350
    },
    {
        "content": "<p>It's now called <code>connected_components</code></p>",
        "id": 226948149,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613732358
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/226947520\">said</a>:</p>\n<blockquote>\n<p>I think we need to talk to Pieter Belmans about this (he's at Bonn, the same place as Scholze, so this is cool).</p>\n</blockquote>\n<p>I'm now here! And my only interactions with Peter have been when I was in his way to the coffee machine, or he was in my way to the tea kettle, so don't read my association to Bonn in any way :)</p>",
        "id": 226957714,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613738529
    },
    {
        "content": "<p>So we think we have enough commutative algebra and category theory now to start thinking more seriously about integration of mathlib with the stacks project.</p>",
        "id": 226957883,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613738640
    },
    {
        "content": "<p>We've needed to do a bunch of category theory to get the definition of a condensed abelian group, and people followed the stacks project to do some of this; also commutative algebra is slowly but surely appearing (e.g. we have lots of facts about Jacobson rings and the NSS, with more in the pipeline) so maybe it's time to think about how to actually do this.</p>",
        "id": 226958007,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613738722
    },
    {
        "content": "<p>Right now at our end we are considering adding a stacks project attribute which we can attach to definitions and lemmas, pointing people to the corresponding stacks project tag.</p>",
        "id": 226958168,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613738797
    },
    {
        "content": "<p>and documentation tools could use the attribute to generate a dictionary <code>json</code> or such</p>",
        "id": 226958334,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613738866
    },
    {
        "content": "<p>One issue that showed up is <a href=\"https://github.com/leanprover-community/mathlib/blob/e2a6e3f6e92e37000cbb5976f6845e64353fdb7d/src/category_theory/sites/sheaf.lean#L112\">this</a>, a reference to a diagram <a href=\"https://stacks.math.columbia.edu/tag/00VL\">here</a> which didn't have a tag.</p>",
        "id": 226958502,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613738958
    },
    {
        "content": "<p>it's really easy to assign a new tag to a useful equation which currently does not have one, and we should be able to convince Johan of this</p>",
        "id": 226958550,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613738998
    },
    {
        "content": "<p>If we are going to start doing something at our end, I guess it would be good to know whether you think it might be useful at your end, or at least usable if you want to use it in some way. I guess the dictionary could e.g. relate stacks tags to links to the mathlib API. Is there any particular thing which you want want to see or hope to see or whatever?</p>",
        "id": 226958942,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613739218
    },
    {
        "content": "<p>that's not so much a question for me per se, but more for Johan: I don't know what kind of mathlib integration he foresees</p>",
        "id": 226959132,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739325
    },
    {
        "content": "<p>when I say Johan, I mean not this Johan, but the other Johan</p>",
        "id": 226959143,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739338
    },
    {
        "content": "<p>but I think having a visual clue about which tags have been formalised, and having a link to the mathlib documentation, seems like a good thing that I hope I can convince the other Johan of</p>",
        "id": 226959273,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739418
    },
    {
        "content": "<p>I don't quite know what the analogue of a tag is in mathlib, but having a uniform way of saying \"this thing here corresponds to tag 0000\" should be enough to allow for scraping the source code, and then we can set up a dictionary from that</p>",
        "id": 226959475,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739565
    },
    {
        "content": "<p>The easy (from our end at least) kind of \"integration\" is just cross referencing. For various reasons it seems simpler to store the correspondences on the mathlib side, and then it's very simple to generate a map from mathlib declarations (or files, or locations in the docs) to stacks tags.</p>",
        "id": 226959567,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613739617
    },
    {
        "content": "<p>Yes, that's exactly what those attributes will do. Although it will quite likely be a many-to-one dictionary. With 5 mathlib declarations working together to get one Stacks tag.</p>",
        "id": 226959593,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613739638
    },
    {
        "content": "<p>I don't know if the correspondences are one-to-one or many-to-many or what.</p>",
        "id": 226959604,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613739646
    },
    {
        "content": "<p>For example \"The following are equivalent\" are typically broken into pieces in mathlib.</p>",
        "id": 226959619,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1613739657
    },
    {
        "content": "<p>yes, exactly, I think mathlib is the more unstable thing, and the arity of the correspondence is I guess the major thing to understand</p>",
        "id": 226959629,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739665
    },
    {
        "content": "<p>so the Stacks project website (or some overlay, or some separate website) could do several things:</p>\n<ul>\n<li>show that there is some kind of relationship between tags and mathlib code, without a serious commitment</li>\n<li>really commit to showing certain results</li>\n</ul>",
        "id": 226960119,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613739931
    },
    {
        "content": "<p>We have a reasonable API right now for getting a \"display version\" of a theorem statement. See <a href=\"https://leanprover-community.github.io/100.html\">https://leanprover-community.github.io/100.html</a> , that's generated from <a href=\"https://github.com/leanprover-community/mathlib/blob/master/docs/100.yaml\">https://github.com/leanprover-community/mathlib/blob/master/docs/100.yaml</a></p>",
        "id": 226960298,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613740030
    },
    {
        "content": "<p>So if you wanted to really display the formal statements (on the main website or another, whatever), it's easy to set up.</p>",
        "id": 226960364,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613740080
    },
    {
        "content": "<p>here (or rather on some place like <a href=\"https://leanprover-community.github.io/mathlib_docs/ring_theory/nullstellensatz.html\">https://leanprover-community.github.io/mathlib_docs/ring_theory/nullstellensatz.html</a>) you could easily add a link to the Stacks project website I guess, based on some decoration of the code, that is one thing</p>",
        "id": 226960609,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740223
    },
    {
        "content": "<p>I don't know whether Johan wants to display anything more than just a link on the Stacks project website</p>",
        "id": 226960649,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740251
    },
    {
        "content": "<p>Right, we would definitely do that and it's pretty trivial to set up.</p>",
        "id": 226960912,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613740413
    },
    {
        "content": "<p>one issue from the Stacks project POV is synchronisation: how and when will the website update, when updates to mathlib happen</p>",
        "id": 226960918,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740419
    },
    {
        "content": "<p>but I guess with some continuous integration magic (that you seem to have set up anyway) you can create say a JSON file with the up-to-date information, and that can be read by the Stacks project infrastructure</p>",
        "id": 226961012,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740485
    },
    {
        "content": "<p>so I'm imagining a single file giving a tag and then a file + line number + method name, and that would be the first thing for mathlib integration in the Stacks project website</p>",
        "id": 226961215,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740607
    },
    {
        "content": "<p>in the table of contents (see e.g. <a href=\"https://stacks.math.columbia.edu/tag/073W\">https://stacks.math.columbia.edu/tag/073W</a> and expand) we can add an icon, indicating that there is a mathlib implementation (see the indication of a slogan on tag 074W)<br>\non the page of a tag (see e.g. <a href=\"https://stacks.math.columbia.edu/tag/074W\">https://stacks.math.columbia.edu/tag/074W</a>) we can have the precise link to mathlib</p>",
        "id": 226961439,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613740732
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"390767\">Pieter Belmans</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/226961215\">said</a>:</p>\n<blockquote>\n<p>so I'm imagining a single file giving a tag and then a file + line number + method name, and that would be the first thing for mathlib integration in the Stacks project website</p>\n</blockquote>\n<p>Probably a list of files + line numbers + declaration names, but yeah! How often do you see the Stacks project infrastructure retrieving the database from our end?</p>",
        "id": 226961652,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613740850
    },
    {
        "content": "<p>right now we are loading and caching an RSS file for the blog posts and GitHub commits once every hour or day</p>",
        "id": 226961974,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613741006
    },
    {
        "content": "<p>I can check the precise caching settings, but I'd imagine something similar here: hitting it for every request is nonsense :)</p>",
        "id": 226962013,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613741038
    },
    {
        "content": "<p>RSS cache is cleared once per hour</p>",
        "id": 226962233,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613741162
    },
    {
        "content": "<p>If the name of a tagged declaration in mathlib changes, links to the mathlib docs will break until you resync. But I guess this won't happen too often? We can handle declarations that move to a new file but keep the same name.</p>",
        "id": 226962733,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613741419
    },
    {
        "content": "<p>Links to the source code on github can point to a specific commit, so those can be stable.</p>",
        "id": 226962786,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613741449
    },
    {
        "content": "<p>but any such change would trigger a rebuild of that particular file (i.e. the dictionary file), no?</p>",
        "id": 226962825,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613741474
    },
    {
        "content": "<p>Right, but links will be broken until you pull the new dictionary.</p>",
        "id": 226963004,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613741562
    },
    {
        "content": "<p>It's a rare event and the broken links won't last long so I'm not too worried about it.</p>",
        "id": 226963073,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613741599
    },
    {
        "content": "<p>we'd only cache that for an hour or so, so I don't worry about those things being out of sync; the Stacks project is popular, but not _that_ popular that there'd be many confused people</p>",
        "id": 226963080,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613741603
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> is the mathlib-stacks correspondence many-to-one or many-to-many?</p>",
        "id": 226965619,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613742905
    },
    {
        "content": "<p>And is it necessary to have tags in module docs? Or only declarations?</p>",
        "id": 226965666,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613742940
    },
    {
        "content": "<p>If it's only declarations, I think it's probably better to use an <code>@[stacks \"ABC\"]</code> attribute to avoid making up and parsing new markdown syntax.</p>",
        "id": 226965823,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1613743020
    },
    {
        "content": "<p>Sorry, I'm about to start a meeting. We could force it to be one-to-one but this would probably be a bad idea. One of the lemmas we formalised when doing schemes was a lemma about basic ring theory which had 22 parts (which became 22 lemmas in our project) and then said \"...\" afterwards!</p>",
        "id": 226966278,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613743222
    },
    {
        "content": "<p>On the other hand I am struggling to think of one definition or theorem in mathlib which could genuinely be tagged with more than one tag.</p>",
        "id": 226966372,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613743265
    },
    {
        "content": "<p>I think we will end up mentioning Stacks tags in module docs and docstrings even if we have the attributes, so we should have some convention for those citations too.</p>",
        "id": 226970086,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1613744902
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/226966372\">said</a>:</p>\n<blockquote>\n<p>On the other hand I am struggling to think of one definition or theorem in mathlib which could genuinely be tagged with more than one tag.</p>\n</blockquote>\n<p>The closest which comes to mind for me is <a href=\"https://github.com/leanprover-community/mathlib/pull/5927/files#diff-b339408bea66dd365a33cbd939875712dd819b5adf71f314691da2f2ab210a43R221\">this lemma</a>, which is a generalisation of both <a href=\"https://stacks.math.columbia.edu/tag/0073\">https://stacks.math.columbia.edu/tag/0073</a> and <a href=\"https://stacks.math.columbia.edu/tag/00YR\">https://stacks.math.columbia.edu/tag/00YR</a> (a), in particular the former talks about sheaves on a space taking values in a nice concrete category, and the latter talks about sheaves on a site taking values in the same nice concrete category but with an extra assumption on it; whereas the Lean version talks about sheaves on a site taking values in a concrete category without the extra assumption</p>",
        "id": 226972313,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1613745828
    },
    {
        "content": "<p>So should the generalization get its own stacks tag?</p>",
        "id": 226973204,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1613746216
    },
    {
        "content": "<p>I don't think it makes sense to modify the Stacks project in such a way, based on a quickly developing formalisation project<br>\nit makes sense to take certain cues (e.g. to make referencing easier, adding tags for equations and informal discussions), but anything beyond that you will have a very hard time convincing Johan of</p>",
        "id": 226973525,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613746366
    },
    {
        "content": "<p>Yeah, I think for the sake of exposition the way Stacks does it right now is sensible - <a href=\"https://stacks.math.columbia.edu/tag/0073\">https://stacks.math.columbia.edu/tag/0073</a> is in the context of talking about sheaves on a space, and the part of <a href=\"https://stacks.math.columbia.edu/tag/00YR\">https://stacks.math.columbia.edu/tag/00YR</a> which is relevant is the first part in a series of six statements, where only the first doesn't need the extra assumption</p>",
        "id": 226974471,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1613746799
    },
    {
        "content": "<p>I certainly agree that asking de Jong to change any of the exposition would be a very bad idea. \"Can you please split this lemma into two because of some formaliser people\" means having to go through everywhere where the lemma is used and understanding the mathematics again and then deciding how to rephrase stuff. I think that we have the flexibility to write our own library so that the correspondence is a simple one-tag-to-many-defs/theorems.</p>",
        "id": 226976752,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613747691
    },
    {
        "content": "<p><a href=\"https://stacks.math.columbia.edu/tag/00E0\">Here is tag 00E0</a> -- this should definitely not be one lemma in Lean!</p>",
        "id": 226977088,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613747807
    },
    {
        "content": "<p>Kenny proved all 17 statements though in our preliminary formalisation of the definition of a scheme.</p>",
        "id": 226977180,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613747847
    },
    {
        "content": "<p>some of the issues you encounter here, such as this monstrosity lemma with 17 parts, are only happening at the beginning of the Stacks project: the stuff that an algebraic geometer likes to get away with in order to get cracking with the geometry</p>",
        "id": 226977455,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613747963
    },
    {
        "content": "<p>(I have no idea how Stacks-aware people are, if I'm stating too many obvious things in my desire to explain the Stacks project, please tell!)</p>",
        "id": 226977501,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613747987
    },
    {
        "content": "<p>there are people here ranging from professional algebraic geometers to people doing post-docs in computer science topics who know a lot about mathlib documentation but have probably never even been to the stacks project website and don't know any alg geom at all, so feel free to say obvious-to-some-people things.</p>",
        "id": 226978841,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613748515
    },
    {
        "content": "<p>Would it make sense to prove lemmas in mathlib style, and, once a literal stacks statement can be proved, simply add that result in?  In the 17 example above, after the 17 lemmas, prove another one that is simply the conjunction of the previous 17?  This way, we can keep a 1-1 correspondence to something stable...</p>",
        "id": 227024216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1613766892
    },
    {
        "content": "<p>This is another possibility but, just as the stacks people will not want to change their 1 lemma into 17 lemmas because of the mathlib people, I don't think that the mathlib people will want a conjunction of 17 lemmas just because of the stacks people. Both communities are right now extremely successful in their own ways and one reason I believe for this is the extremely high level of attention which everything gets -- as you will know if you ever tried to PR one lemma and had about 5 people suggesting alternative proofs, putting it in a different namespace, a different file, adding three more lemmas, and actually perhaps completely refactoring something else so your lemma would not be necessary. I think it's best to not try and change either side of things and instead just do the best we can to show that they are doing related things.</p>",
        "id": 227024855,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613767193
    },
    {
        "content": "<p>An alternative approach is to start a new repo stacks-in-lean which does have these horrendous conjunctions in and has mathlib as a dependency, but for me this seems to be a far more painful solution -- it will need constant maintenance, for example, and in practice if someone wants to see a lemma which really _is_ directly in mathlib (and of course this sort of thing will happen a lot) they don't really want to be sent to some random other repo with mathlib as a dependency.</p>\n<p>My gut feeling is that actually one should be liberal here. If there is a tag X in stacks which is mathematically trivially covered by e.g. the union of three lemmas in mathlib then those lemmas should get given the <code>@[stacks X]</code> attribute and also probably docstrings saying what they do in a way which a mathematician would understand.</p>",
        "id": 227025365,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613767440
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> I can envisage the following situation: stacks tag X proves lemma L assuming some ultimately superfluous extra hypothesis, and then using lemma L it proves in tag X' the correct lemma L' without the superfluous hypotheses. Mathlib uses a totally different approach so doesn't need to go via L. Nobody wants to see L in mathlib because there is no point. So now we want to tag our lemma L' with both stacks tag X and X', and perhaps explain in a comment or docstring why tag X leads to a proof which is strictly stronger than what is stated in X. </p>\n<p>Also it is kind of clear that not all tags need to be formalised in mathlib. There might be useless intermediate lemmas proved in Stacks which are never used again other than in the proof of a bigger theorem, and the mathlib proof of the bigger theorem is different and doesn't go via the lemma. So a naive \"we're not done until all the tags are formalised\" approach is not right. </p>\n<p>For me the main aim is not getting an AI to learn stacks via mathlib, and my impression is that AI stuff is happy to be sloppy anyway (cf Szegedy's comment that he doesn't care at all that the naturals start at 1 in stacks and 0 in Lean because it's all heuristics anyway). For me the aim is to see if this helps with search in stacks, which to be honest I find very poor. Example : <a href=\"https://stacks.math.columbia.edu/search?query=affine+scheme\">where is the definition of an affine scheme?</a> . But maybe this is a lousy example because affine schemes are probably everywhere in stacks.</p>",
        "id": 227026587,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613767983
    },
    {
        "content": "<p>Kevin, I agree.  I think that being liberal in the referencing is perfectly ok and in fact, desirable.  If a mathlib statement proves a commutative algebra assuming comm_semiring, while the one in stacks is about a comm_ring, I think that it is more than fair that they get the same tag!</p>",
        "id": 227029668,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1613769336
    },
    {
        "content": "<p>In fact, should we call these... \"stags\"?</p>",
        "id": 227029779,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1613769379
    },
    {
        "content": "<p>It sounds like we came to the conclusion that it is pretty close to a many(mathlib)-to-one(stacks), relationship, but possibly with some exceptions.</p>",
        "id": 227065088,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1613795195
    },
    {
        "content": "<p>I remember in the elementary category theory stuff finding quite a few cases of misalignments, often when mathlib proved \"the main part\" of a stacks tag but omitted some minor point.</p>",
        "id": 227065123,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1613795259
    },
    {
        "content": "<p>I'd propose that we be open to including these as cross references. Ideally on the mathlib side there will be a link back to the stacks tag along with a note \"we don't do part e\" or similar.</p>",
        "id": 227065199,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1613795332
    },
    {
        "content": "<p>After the current doc-gen PR is merged, I'm planning to collect all the Stacks tag URLs / other tag-like patterns in docstrings and display those in a special section of the references page.</p>\n<p>As I said above, even if we have attributes, we'll still be mentioning Stacks tags in the docstrings, so this effort should be complementary to whatever we decide for the stacks attribute.</p>",
        "id": 227065440,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1613795628
    },
    {
        "content": "<p>Why not something like <code>@[stacks \"01AB\" \"part (a,b,c)\"]</code> if we really want to keep track of sub-tag tracking in a machine readable way, and</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/-- Foos the bar. Stacks project 01AB, part (a,b,c) -/</span>\n<span class=\"kd\">@[stacks \"01AB\"]</span>\n<span class=\"kd\">def</span> <span class=\"bp\">...</span>\n</code></pre></div>\n<p>otherwise</p>",
        "id": 227065525,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1613795702
    },
    {
        "content": "<p>In line with this stream, I updated one of my files to add an explicit reference to the Stacks Project.  This is another one of those cases where I proved a part of the statement, but not the whole lemma.</p>\n<p>PR <a href=\"https://github.com/leanprover-community/mathlib/issues/6322\">#6322</a></p>",
        "id": 227068625,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1613799286
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>  to find the definition of an affine scheme using the search, it is but a small thing to search for 'affine scheme definition' and limit yourself to statements (see <a href=\"https://stacks.math.columbia.edu/search?query=affine+scheme+definition&amp;radius=statements\">https://stacks.math.columbia.edu/search?query=affine+scheme+definition&amp;radius=statements</a>): the name of the LaTeX environment is also being used in the plaintext search, and now the first result is indeed the definition of an affine scheme :)</p>",
        "id": 227069442,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1613800344
    },
    {
        "content": "<p>I think that we still need to do some thinking about exactly what data we want to be collecting here. Right now I like Mario's suggestion. I also think that perhaps I was hasty yesterday saying \"who cares about the machine learning people, let's just try and make killer search for theorems\". I need to spend some time looking at all the examples we have, also also things we don't have but which I would see as minor success stories (e.g. proving some standard theorem about schemes which all alg geometers know, even if it's a standard basic one) and trying to imagine what the mathlib version would actually look like. So my gut feeling right now is just to start off with some detailed notes about what the actual correspondence between the two databases looks like. I am unlikely to find the time to do this before teaching finishes, which is in just under three weeks. <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> I think you might have already tried something like this. Is there even some branch, which perhaps was already mentioned?</p>",
        "id": 227091702,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613827568
    },
    {
        "content": "<p>A bit of a tangential thought: it might be interesting to generate a list of stacks tags that are not formalized, while all the tags they depend on are formalized</p>",
        "id": 227091998,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1613827939
    },
    {
        "content": "<p>Yes, the \"boundary\" of what is done. One could imagine Patrick's flowchart tool thing being helpful here.</p>",
        "id": 227092395,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1613828456
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/227091702\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Scott Morrison</span> I think you might have already tried something like this. Is there even some branch, which perhaps was already mentioned?</p>\n</blockquote>\n<p>All the actual tagging done in the <a href=\"https://github.com/leanprover-community/mathlib/tree/stacks\">branch#stacks</a> using <code>@[stacks 01AB]</code> has since been incorporated into mathlib using full URLs in doc-strings.</p>\n<p>What that branch does still have it a script that scrapes all those doc-strings and produces a yaml file, ready for consumption by the stacks build process.</p>",
        "id": 227106665,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1613843451
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib/blob/stacks/scripts/stacks_tags.lean\">scripts/stacks_tags.lean</a> and <a href=\"https://github.com/leanprover-community/mathlib/blob/stacks/src/meta/stacks.lean\">meta/stacks.lean</a> get data from the stacks attribute, not the doc strings, right?</p>",
        "id": 227106897,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1613843665
    },
    {
        "content": "<p>We're about to revive this ancient thread, to continue discussion about Stacks project tagging, given there is a sudden influx of interest in doing this.</p>",
        "id": 465413267,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724757243
    },
    {
        "content": "<p>Proposal:</p>\n<p>Someone implements an attribute that looks like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">stacks</span><span class=\"w\"> </span><span class=\"mi\">044</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"s2\">\"Our definition of a quotient stack differs from the Stacks definition, because it is much more fun.\"</span><span class=\"kd\">]</span>\n</code></pre></div>\n<p>i.e. that <em>requires</em> a tag as the first argument, and takes an optional string to contains any notes about the alignment.</p>",
        "id": 465413627,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724757372
    },
    {
        "content": "<p>(Note that the discussion above <em>also</em> talks about a <code>@[stacks]</code> tag, but then does not currently exist in Mathlib4.)</p>",
        "id": 465413959,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724757469
    },
    {
        "content": "<p>Hi, <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>  I strongly support this multiple (mathlib) to one (stacks project) attribute. I have two minor related questions:</p>\n<ol>\n<li>Is there a possibility that a mathlib theorem corresponds to multiple stacks project theorem together? (e.g. by using <code>TFAE</code>) If so, shall we decompose the theorem in mathlib? or make multiple tags?</li>\n<li>Do you think we should have a way to record that some tags in stacks are NOT in mathlib and are in the TODO list?</li>\n</ol>",
        "id": 465423366,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1724759857
    },
    {
        "content": "<ol>\n<li>I <em>think</em> it should be possible to write <code>@[stacks ABC, stacks XYZ]</code>, to achieve many-to-many tagging. I think it's probably best <em>not</em> to decompose a big theorem to match Stacks. However I think that will generally be very rare.</li>\n</ol>",
        "id": 465423743,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724759965
    },
    {
        "content": "<p>Let's aim initially to just be adding tags, but I think if this gets some traction will also find ourselves writing corollaries of mathlib lemmas to more exactly match something in stacks, and generally that should be fine?</p>",
        "id": 465423991,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724760012
    },
    {
        "content": "<p>Regarding TODO lists, it would be amazing if the \"prerequisites\" of a stacks tag were reliable enough that we could auto generate a list of all stacks tags which are not in Mathlib, but whose prerequisites are. I suspect that Stacks very often uses some much earlier fact without explicitly linking to the tag, however.</p>",
        "id": 465424372,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724760083
    },
    {
        "content": "<p>It would be great to experiment however. (And the stacks project is probably willing to help here are bit, if we can tell them about missing prerequisites!)</p>",
        "id": 465424563,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724760110
    },
    {
        "content": "<p>Here's a stub for the attribute:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">stacksAttr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"stacks \"</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">str</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">attr</span>\n\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">registerBuiltinAttribute</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`stacksAttr</span>\n<span class=\"w\">  </span><span class=\"n\">descr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Register a Stacks tag for a theorem or definition\"</span>\n<span class=\"w\">  </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">attrKind</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>Then in a different (!) file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">StacksAttr</span><span class=\"w\"> </span><span class=\"c1\">-- or whatever filename you chose above</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">stacks</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span>\n</code></pre></div>\n<p>The Stacks tag grammar may not be a subset of Lean's <code>ident</code> grammar. In that case, one could use <code>str</code> instead of <code>ident</code> in the attribute syntax, then write the tags as <code>\"044Q\"</code> with quotes. Alternatively, one could implement a dedicated Stacks tag parser.</p>\n<p>This definition of the attribute doesn't do anything, but code can be added to collect all the Stacks tags in a hash map, for example.</p>",
        "id": 465426356,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1724760386
    },
    {
        "content": "<p>Oh, I started <a href=\"https://github.com/leanprover-community/mathlib4/pull/16179\">#16179</a> that also allows tags to start with a digit.</p>",
        "id": 465427036,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724760497
    },
    {
        "content": "<p>It is lacking a little \"strictness\" in not allowing spaces and probably no lowercase either, though.</p>",
        "id": 465427848,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724760634
    },
    {
        "content": "<p>Ah, cool. I see you've already spent much more brainpower on this than my \"waiting for Lean to compile\" attempt. :)</p>",
        "id": 465434674,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1724762058
    },
    {
        "content": "<p>The attribute at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16179\">#16179</a> now checks that the \"tag\" is a 4-character string consisting of digits and uppercase letters only.  The tag is mandatory, the comment is optional.</p>",
        "id": 465447438,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724764197
    },
    {
        "content": "<p>As usual, I am surprised by how many mistakes there were in the initial implementation of something so simple, but hopefully this works as intended now!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 465447752,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724764229
    },
    {
        "content": "<p>A good follow up would be to actually check that the tag exists in the Stacks project, e.g. making sure that</p>\n<p><a href=\"https://stacks.math.columbia.edu/tag/&lt;myTag\">https://stacks.math.columbia.edu/tag/&lt;myTag</a>&gt;</p>\n<p>is an existing webpage.  I would rather not include that in this PR, though.</p>",
        "id": 465448512,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724764315
    },
    {
        "content": "<p>I think you need to parse this file: <a href=\"https://github.com/stacks/stacks-project/blob/master/tags/tags\">https://github.com/stacks/stacks-project/blob/master/tags/tags</a> But, later yes</p>",
        "id": 465450170,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724764556
    },
    {
        "content": "<p>a PR that adds a 100 stacks tags (and nothing else) would benefit quite a bit from an explicit export (as json, or csv) of pairs <code>(lean name, stacks tag in the attribute)</code>.<br>\nBecause then we can query the stacks project for all the statements of those tags, and quickly skim whether the corresponding lean name makes sense.</p>\n<p>I think we shouldn't over-engineer this yet. But also, it would be good to have a little bit of tooling to help streamline the reviews.</p>",
        "id": 465459366,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724766488
    },
    {
        "content": "<p>While we're over-engineering: how about a widget that shows an iframe for the stacks lemma when your cursor is on the id?</p>",
        "id": 465473458,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724770004
    },
    {
        "content": "<p>And even more over-engineering: it could show the pretty printed type of the lean declaration as well (this is for the list Johan suggested)</p>",
        "id": 465473744,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1724770071
    },
    {
        "content": "<p>Recycling quite a bit from the <code>assert_not_exists</code> extension and command, I implemented a more sophisticated tagging system at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16191\">#16191</a>.</p>",
        "id": 465506358,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724777678
    },
    {
        "content": "<p>You can take a look at the test file of <a href=\"https://github.com/leanprover-community/mathlib4/pull/16191\">#16191</a> for what it adds.  Briefly, <code>#stacks_tags</code> retrieves all declarations that have the <code>stacks</code> attribute.</p>\n<p>For each found declaration, it prints a line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">'</span><span class=\"n\">declaration_name'</span><span class=\"w\"> </span><span class=\"n\">corresponds</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">declaration_tag'</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>The variant <code>#stacks_tags!</code> also adds the theorem statement after each summary line.</p>",
        "id": 465506498,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724777715
    },
    {
        "content": "<p>Did you push?</p>",
        "id": 465506740,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724777769
    },
    {
        "content": "<p>I did not, but I should have done so now!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 465506887,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724777814
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"390767\">@Pieter Belmans</span> looks like we're finally getting serious!</p>",
        "id": 465520380,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1724781433
    },
    {
        "content": "<p>Shall we merge <a href=\"https://github.com/leanprover-community/mathlib4/pull/16191\">#16191</a>? I think we can iterate on the design as we start using it.</p>",
        "id": 465547984,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724788348
    },
    {
        "content": "<p>I am trying to tag theorems with the corresponding Tags from the Stacks Project using <code>@[stacks]</code>, but when I write <code>@[stacks 0BR2]</code>, it gives an error saying \"binary number.\" However, when I write <code>@[stacks 08R2]</code> or <code>@[stacks 02R2]</code>, it does not report any errors. Could you please advise me on how to solve this problem? Thanks a lot!</p>",
        "id": 465660576,
        "sender_full_name": "Yongle Hu",
        "timestamp": 1724829055
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> this is an issue using num+ident as the parser - <code>0BR2</code> is treated as a (malformed) binary number with <code>0B</code> prefix instead of <code>0</code> and then the ident <code>BR2</code></p>",
        "id": 465662710,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724829445
    },
    {
        "content": "<p>I think it needs a custom parser</p>",
        "id": 465663004,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724829495
    },
    {
        "content": "<p>Oh, does <code>0B</code> mean something, then?</p>",
        "id": 465663068,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724829509
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/465663004\">said</a>:</p>\n<blockquote>\n<p>I think it needs a custom parser</p>\n</blockquote>\n<p>Ok, that should be straightforward anyway: it should accept any sequence of digits and uppercase letters.</p>",
        "id": 465663202,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724829541
    },
    {
        "content": "<p>I'm not sure that I'll have time to do it today: I'm about to catch a plane and will have a busy day until later this evening.</p>",
        "id": 465663420,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724829589
    },
    {
        "content": "<p><code>0b11010</code> is syntax for binary numbers, like <code>0x012abc</code></p>",
        "id": 465664021,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724829771
    },
    {
        "content": "<p>Oh, I see.</p>",
        "id": 465664182,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724829835
    },
    {
        "content": "<p>If it is of any temporary use, <a href=\"https://github.com/leanprover-community/mathlib4/pull/16211\">#16211</a> allows to write <code>@[stacks «0BR8»]</code> in the situations where the current parsing would fail.</p>",
        "id": 465675475,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724831927
    },
    {
        "content": "<p>Thank you very much!</p>\n<p>Moreover, I think <code>@[stacks 044Q \"Our definition of a quotient stack differs from the Stacks definition, because it is much more fun\"]</code> should generate a line at the end of the annotation in the form <code>[Stacks: Definition 044Q, Our definition of a quotient stack differs from the Stacks definition, because it is much more fun](https://stacks.math.columbia.edu/tag/044Q)</code>. This would make it easier for us to view the Stacks tags in the documentation webpage.</p>",
        "id": 465682195,
        "sender_full_name": "Yongle Hu",
        "timestamp": 1724832858
    },
    {
        "content": "<p>Oh, you mean adding the link to the webpage?  That is a good idea and it will not require a hack, but I'm now on the plane!  I'll do it later today.</p>",
        "id": 465682777,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724833005
    },
    {
        "content": "<p>To be completely clear: this is what you want the <code>#stacks_tags</code> to report, right?</p>",
        "id": 465682931,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724833040
    },
    {
        "content": "<p>Thank you for this <code>@[stacks ...]</code>!</p>",
        "id": 465703567,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1724836989
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/465682931\">said</a>:</p>\n<blockquote>\n<p>To be completely clear: this is what you want the <code>#stacks_tags</code> to report, right?</p>\n</blockquote>\n<p>I think it will be more helpful if, say, a link to 044Q and a documentation \"our defintion ....\" is rendered on the mathlib4 documentation pages, i.e. <a href=\"https://leanprover-community.github.io/mathlib4_docs/\">here</a></p>",
        "id": 465704325,
        "sender_full_name": "Yongle Hu",
        "timestamp": 1724837094
    },
    {
        "content": "<p>I have a PR-splitting question. Since we are currently working on adding tags, we are also trying to add a natural language description (mostly by copy from the stacks project) to the theorem's comment if there is not one already. Shall we split it into 2 PRs? one for tag only and one for these copied descriptions. Or a single PR is OK? Splitting or not, this PR will be purely modifying comments, no declarations will be harmed. <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>",
        "id": 465705880,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1724837369
    },
    {
        "content": "<p>I'm the Stacks project infrastructure maintainer, checking in on what's going on after Kevin pinged me. I'll read up more on things later, but one thing I want to point out is that there is an API that gives you the HTML of just a statement, which might be something you could use here? I see word iframe being dropped, and I think a much better solution can be obtained via this API :).</p>",
        "id": 465707423,
        "sender_full_name": "Pieter Belmans",
        "timestamp": 1724837561
    },
    {
        "content": "<p>Is copy/pasting allowed, strictly speaking, under the GFDL?</p>",
        "id": 465707842,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1724837623
    },
    {
        "content": "<p>The reason I suggested an iframe is that in the short term it saves us having to load  KaTeX within the widget, for which we have a bunch of prototypes but nothing in mathlib.</p>",
        "id": 465708250,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724837679
    },
    {
        "content": "<p>Ruben's comment sounds like reason enough to do tags and docstrings separately</p>",
        "id": 465708555,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724837724
    },
    {
        "content": "<p>An update:</p>\n<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/16225\">#16225</a> makes <code>#stacks_tags</code> print the url of the corresponding tags (although the links are not clickable);</li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/16211\">#16211</a> is a hacky way of \"solving\" the binary issue (via  <code>@[stacks «0BR8»]</code>);</li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/16230\">#16230</a> is a more principled way of solving the binary issue (via <code>@[stacks 0BR8]</code>), but may require more careful review, since I never wrote a parser before.</li>\n</ul>",
        "id": 465857133,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724882748
    },
    {
        "content": "<p>I merged <a href=\"https://github.com/leanprover-community/mathlib4/pull/16225\">#16225</a>. Eric has left a suggestion on <a href=\"https://github.com/leanprover-community/mathlib4/pull/16230\">#16230</a>. Let's just close <a href=\"https://github.com/leanprover-community/mathlib4/pull/16211\">#16211</a> as I think <a href=\"https://github.com/leanprover-community/mathlib4/pull/16230\">#16230</a> can converge quickly enough.</p>",
        "id": 465863775,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724886525
    },
    {
        "content": "<p>I think the parser should also accept a string literal, which avoids the thorny parser issues</p>",
        "id": 465864240,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724886833
    },
    {
        "content": "<p>Are there thorny issues here? This seems like a very simple parser</p>",
        "id": 465864506,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724887002
    },
    {
        "content": "<p>One thing I'm puzzled by is why the parser is using <code>logWarning</code> rather than <code>throwError</code> or even producing a parse error.</p>",
        "id": 465864544,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724887031
    },
    {
        "content": "<p>I don't like the parse error, since the message is confusing: <code>stacks 0i44</code> suggests to close a square bracket rather than capitalising the <code>i</code>.</p>",
        "id": 465911636,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724909791
    },
    {
        "content": "<p>I'm happy to do <code>logWarning</code> or <code>throwError</code>, though for final code that is irrelevant.</p>",
        "id": 465911682,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724909827
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/stacks.20tags/near/465864240\">said</a>:</p>\n<blockquote>\n<p>I think the parser should also accept a string literal, which avoids the thorny parser issues</p>\n</blockquote>\n<p>Doees this apply to the old <code>(num)? (ident)?</code> trick?  Or to the current custom parser?</p>",
        "id": 465911732,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724909871
    },
    {
        "content": "<p>both...</p>",
        "id": 465915216,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1724911661
    },
    {
        "content": "<p>Sorry to bother but Mario can you expand?</p>",
        "id": 466020739,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724939727
    },
    {
        "content": "<p>With Eric's and Matt's suggestions, the parser now accepts only a 4-character long sequence of digits and uppercase letters, throwing meaningful errors otherwise.</p>",
        "id": 466042225,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724943897
    },
    {
        "content": "<p>For this reason, allowing it to alternatively parse also a string may not be necessary, unless Mario has some other reason for wanting to allow that.</p>",
        "id": 466042429,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724943944
    },
    {
        "content": "<p>While we wait for any other feedback, please feel free to try out the changes at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16230\">#16230</a> and report back any issues <span class=\"user-mention\" data-user-id=\"631684\">@Yongle Hu</span> <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> <span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> and others</p>",
        "id": 466057022,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1724947823
    },
    {
        "content": "<p>Also, <span class=\"user-mention\" data-user-id=\"128280\">@Wojciech Nawrocki</span> implemented clickable links to modules for <code>#find_home</code> <a href=\"https://github.com/leanprover-community/import-graph/blob/fe36a37a5f1b3260331f54fc010c24bbf9fbcfeb/ImportGraph/Imports.lean#L244\">here</a>.  Maybe something similar could be done for making the hardcoded URLs <a href=\"https://github.com/leanprover-community/mathlib4/blob/6ce4187086ef93261927bbc72d061888099b30fc/Mathlib/Tactic/StacksAttribute.lean#L122\">here</a> also live and clickable!</p>\n<p>(Sorry for pinging you directly Wojciech, feel free to ignore!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> )</p>",
        "id": 466058208,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724948187
    },
    {
        "content": "<p>What would happen when the comment <code>\"xxx\"</code> in <code>@[stacks 09HH \"xxx\"] </code> is longer than 100 characters?</p>",
        "id": 468824498,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725893561
    },
    {
        "content": "<p>You should be able to use </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"s2\">\"a very long </span><span class=\"se\">\\</span>\n<span class=\"s2\">string\"</span>\n</code></pre></div>",
        "id": 468824740,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725893603
    },
    {
        "content": "<p>After the <code>\\</code> (that you should probably type by pressing twice <code>\\</code>), there has to be a line break and the subsequent spaces are ignored.</p>",
        "id": 468824913,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725893639
    },
    {
        "content": "<p>So, </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"s2\">\"a very long </span><span class=\"se\">\\</span>\n<span class=\"s2\">string\"</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"s2\">\"a very long string\"</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"s2\">\"a very long </span><span class=\"se\">\\</span>\n<span class=\"s2\">                              string\"</span>\n</code></pre></div>\n<p>should render the same.</p>",
        "id": 468825115,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725893678
    },
    {
        "content": "<p>Perhaps the 100 character linter warning should include this advice?</p>",
        "id": 468961679,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725936586
    },
    {
        "content": "<p>That's a good idea!  Should I add this as a blanket comment to all overflowing lines, or just to lines that contain a <code>\"</code>?  Or maybe only if there is a <code>\"</code> past the 100 character limit!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 468987216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725945215
    },
    {
        "content": "<p>The beauty of a syntax linter is that you can have very granular bike-shedding.</p>",
        "id": 468987305,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725945238
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/16652\">#16652</a></p>",
        "id": 468990407,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725946810
    },
    {
        "content": "<p>I could not find a place to reference for usage example of string gaps, though.</p>",
        "id": 468990451,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725946834
    },
    {
        "content": "<p>We now have &gt; 10 stacks tags in mathlib <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> It took us ~ 4 years after the idea was first mentioned <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 481666933,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731315806
    },
    {
        "content": "<p>There are in fact many more <a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4%20%5Bstacks%3A&amp;type=code\">lemmas labeled <code>[Stacks: ...]</code></a>. Should we made a PR to switch them all to <code>@[stacks ...]</code>?</p>",
        "id": 481730107,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731333869
    },
    {
        "content": "<p>Yes please!</p>",
        "id": 481730900,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731334063
    },
    {
        "content": "<p>And I think there are also many other refs to stacks, that link to the full website</p>",
        "id": 481731005,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731334082
    },
    {
        "content": "<p><a href=\"https://gist.github.com/adomani/f3ff9ebca3c5c22a801ce43408b56c68\">Here is a gist</a> that Johan orchestrated and suggested that I should post here.</p>",
        "id": 481735154,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731335215
    },
    {
        "content": "<p>There is a PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16105\">#16105</a> with ～100 new stacks tag in the field theory before the infinite Galois theory. It will be ready for review in 1-2 hours.</p>",
        "id": 481735602,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1731335341
    },
    {
        "content": "<p>Andrew and I have proved a few things from Stacks and I will open a PR with <code>stacks</code>-annotated lemmas soon</p>",
        "id": 481746932,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731338400
    },
    {
        "content": "<p>If people are suddenly enthusiastic about linking Mathlib to the real world, can I remind that we have a nice <a href=\"https://leanprover-community.github.io/mathlib-overview.html\">Mathlib overview page</a> that is full of holes and that editing it is simply done by editing <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/docs/overview.yaml\">https://github.com/leanprover-community/mathlib4/blob/master/docs/overview.yaml</a>?</p>",
        "id": 481750116,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731339297
    },
    {
        "content": "<p>Grepping on that page for <code>''</code> yields no (true) positive. What do you mean by a \"hole\"? How can I determine what holes there are?</p>",
        "id": 481752106,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731339823
    },
    {
        "content": "<p>Maybe Patrick meant <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/docs/undergrad.yaml\">https://github.com/leanprover-community/mathlib4/blob/master/docs/undergrad.yaml</a></p>",
        "id": 481754419,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731340453
    },
    {
        "content": "<p>I mean whole areas of maths that are covered in Mathlib but not mentioned at all on this page.</p>",
        "id": 481758098,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731341450
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  Let’s think of something you like. Say someone wants to know what kind of combinatorics is in Mathlib, and get some entry points to explore this area. Do you think this page will help them?</p>",
        "id": 481758358,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1731341528
    },
    {
        "content": "<p>Hmm, not if they do additive combinatorics, no <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 481760957,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731342308
    },
    {
        "content": "<p>Is one big result per file too detailed, or is that okay?</p>",
        "id": 481761034,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731342336
    },
    {
        "content": "<p>We should probably have some of the set family stuff, and regularity lemma there too</p>",
        "id": 481761094,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1731342356
    },
    {
        "content": "<p>From the PR review of <a href=\"https://github.com/leanprover-community/mathlib4/pull/16105\">#16105</a>, I realized that many results in the Stacks Project are claimed in untagged paragraphs.</p>",
        "id": 481781203,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1731348834
    },
    {
        "content": "<p>Is it meaningful that we also find some way of linking these results (in the untagged paragraphs) to mathlib theorems?</p>",
        "id": 481781587,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1731348966
    },
    {
        "content": "<p>There are also some cases where two similar statements in the Stacks Project correspond to the same mathlib theorem. The current solution is write in the comments @[stacks ABCD \"See also XYZW.\"]</p>",
        "id": 481787470,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1731351165
    },
    {
        "content": "<p>I think mathlib isn't striving to be a formalization of stacks project and it should be fine if there are many-to-one or one-to-none correspondences.</p>",
        "id": 481798271,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1731354674
    },
    {
        "content": "<p>Many to many is allowed by the syntax last I checked</p>",
        "id": 481801034,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1731355803
    },
    {
        "content": "<p>7 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/mathlib.20overview\">#general &gt; mathlib overview</a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 481867085,
        "sender_full_name": "Notification Bot",
        "timestamp": 1731388993
    },
    {
        "content": "<p>Two easy Stacks attributes: <a href=\"https://github.com/leanprover-community/mathlib4/pull/18920\">#18920</a></p>",
        "id": 481998982,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1731431966
    },
    {
        "content": "<p>Nov 11: ~ 10 <code>@[stacks]</code><br>\nNov 13: ~120 <code>@[stacks]</code></p>",
        "id": 482108789,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731484343
    },
    {
        "content": "<p>Should <code>#stacks_tags</code> report also how many it found?</p>",
        "id": 482109244,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731484538
    },
    {
        "content": "<p>Maybe it should also have an optional string input to filter them.</p>",
        "id": 482109777,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731484734
    },
    {
        "content": "<p>Mwah, I think it's fine for now we can start worrying about that when we have 2000 of them</p>",
        "id": 482110823,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731485120
    },
    {
        "content": "<p>There are still lots of direct links to stacks in doc strings, if anyone would like to convert some to tags.</p>",
        "id": 482111833,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731485479
    },
    {
        "content": "<p>I do not know how to get clickable links to webpages, but <a href=\"https://github.com/leanprover-community/mathlib4/pull/18955\">#18955</a> adds hover and go-to-definition for the stacks/kerodon reports.</p>",
        "id": 482117131,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731487265
    },
    {
        "content": "<p>Is it possible to get the info of stacks tags using doc-gen4? Maybe I'll working on it.</p>",
        "id": 482600039,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731672992
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span> What do you mean exactly? What kind of info would you like?</p>",
        "id": 482637901,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731684566
    },
    {
        "content": "<p>I think the answer here is \"no, because doc-gen is not allowed to know about mathlib extensions\"</p>",
        "id": 482639394,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731684958
    },
    {
        "content": "<p>But maybe doc-gen could have an extension point for custom renderers for attributes</p>",
        "id": 482639550,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731684991
    },
    {
        "content": "<p>Also, would you like to see the attribute on the declaration, or would seeing the output of <code>#stacks_tags</code> with <code>import Mathlib</code> be closer to what you want?</p>",
        "id": 482639810,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731685069
    },
    {
        "content": "<p>E.g. a link to a page with a list of all the declarations that have a stacks tag, for instance?</p>",
        "id": 482640077,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731685145
    },
    {
        "content": "<p>What I want is if a theorem has stack tags, then <code>Stacks: ... (link) ...</code> will be automatically inserted to the docstring when generating doc pages. Otherwise you can't see anything about stacks on online doc pages.</p>",
        "id": 482646075,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731686910
    },
    {
        "content": "<blockquote>\n<p>E.g. a link to a page with a list of all the declarations that have a stacks tag, for instance?</p>\n</blockquote>\n<p>I haven't think of this yet; maybe it is unnecessary.</p>",
        "id": 482646152,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731686937
    },
    {
        "content": "<p>If stacks mathlib extension can inject docstring automatically, then we don't need to change the code of doc-gen4.</p>",
        "id": 482646447,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731687023
    },
    {
        "content": "<blockquote>\n<p>If stacks mathlib extension can inject docstring automatically</p>\n</blockquote>\n<p>Maybe it's possible? Just like <code>alias</code> which will inject docstring automatically.</p>",
        "id": 482647881,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731687486
    },
    {
        "content": "<p>This is a good idea: if the stacks tag added text to the doc-string, it could include a link to the stacks project and hovers are clickable!</p>",
        "id": 482648514,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731687677
    },
    {
        "content": "<p>Very primitive, but here is goes!</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19131\">#19131</a></p>",
        "id": 482790431,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1731780466
    },
    {
        "content": "<p>Could you run a test on, for example, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/SeparableDegree.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/SeparableDegree.html</a> ? Current code looks good, except for the comments, etc. in a wrong position.</p>",
        "id": 482794238,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731783859
    },
    {
        "content": "<p>(Maybe I can try by myself later.)</p>",
        "id": 482794293,
        "sender_full_name": "Jz Pan",
        "timestamp": 1731783934
    },
    {
        "content": "<p><a href=\"https://stacks.math.columbia.edu/\">https://stacks.math.columbia.edu/</a> has apparently be down for more than one day.</p>",
        "id": 493215741,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1736710498
    },
    {
        "content": "<p>It was down for me earlier but it looks like it's working again now</p>",
        "id": 493229214,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736722369
    },
    {
        "content": "<p>I've just opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/21046\">#21046</a> to turn all links to Stacks in docstrings into <code>stacks</code> tags</p>",
        "id": 495852763,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737796117
    },
    {
        "content": "<p>I can't go through the PR carefully right now, but this is great, thank you very much!</p>",
        "id": 495853114,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737796457
    },
    {
        "content": "<p>I wonder if we should also make sure that there are no links to the stacks projects that could be stacks tag (with some thought about how to make it work in practice), to avoid similar PRs in the future.</p>",
        "id": 495853172,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737796509
    },
    {
        "content": "<p>I think it would be hard. I can imagine one would want to link to Stacks for information rather than authoritatively saying \"This is the entry corresponding to that declaration\"</p>",
        "id": 495853324,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737796657
    },
    {
        "content": "<p>I think that once there are many <code>@[stacks]</code> in the library, future contributors will stumble upon them and use the same pattern. So I don't think we need to take any action to prevent this.</p>",
        "id": 495853325,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1737796658
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21048\">#21048</a> contains the first 2 Kerodon tags, as far as I can tell!</p>",
        "id": 495861190,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1737803485
    },
    {
        "content": "<p>Here's a second, more manual, PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/21135\">#21135</a></p>",
        "id": 496177182,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1737999074
    },
    {
        "content": "<p>Yaël's PR exposed that there are already Stacks tags referring to <em>sections</em>, rather than specific lemmas (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/21135#discussion_r1931212621\">this example</a>).</p>\n<p>Should we add a <code>#stacks &lt;tag&gt; (\"optional string\")</code> command that adds the <code>&lt;tag&gt;</code> as a section to the Stacks environment extension?</p>",
        "id": 496227415,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738019531
    },
    {
        "content": "<p>How common is this? My gut feeling is we should wait slightly longer</p>",
        "id": 496268082,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738047187
    },
    {
        "content": "<p>Probably not very common, I agree.</p>",
        "id": 496273917,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738050306
    },
    {
        "content": "<p>I would say there are roughly 50 module docs referring to Stacks, not all to a section of Stacks</p>",
        "id": 496274203,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738050460
    },
    {
        "content": "<p>For references to lemmas in module-docs, I would say that they do not need special treatment: if the lemma is later proved, it is the lemma that should get the attribute.</p>",
        "id": 496277900,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738052053
    },
    {
        "content": "<p>Thinking about this again, I probably think that aligning <em>section</em> via the same mechanism is probably not a good approach.</p>",
        "id": 496278091,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738052133
    },
    {
        "content": "<p>It may be useful to do it, but it would probably be in a broader context of formalising all of the Stacks project, rather than establishing a direct connection between statements there and in mathlib.</p>",
        "id": 496278261,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738052182
    },
    {
        "content": "<p>What! Formalising all of Stacks is not our end goal? <span aria-label=\"scream\" class=\"emoji emoji-1f631\" role=\"img\" title=\"scream\">:scream:</span> (/j)</p>",
        "id": 496281293,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738053277
    },
    {
        "content": "<p>Of course it is, but for the moment it is a secret.</p>",
        "id": 496281383,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738053306
    },
    {
        "content": "<p>I found that Stacks tags on decls with a docstring are not currently displayed in the docs, see <a href=\"https://github.com/leanprover/doc-gen4/pull/331\">leanprover/doc-gen4#331</a>.</p>",
        "id": 558890742,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1763900440
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span></p>",
        "id": 558964480,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763968592
    }
]