[
    {
        "content": "<p>LeanExpr refers to: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Expr.html#Lean.Expr\">https://leanprover-community.github.io/mathlib4_docs/Lean/Expr.html#Lean.Expr</a></p>\n<p>Something inside:</p>\n<ul>\n<li><a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/\">https://leanprover-community.github.io/lean4-metaprogramming-book/</a></li>\n<li><a href=\"https://lean-lang.org/doc/reference/latest/\">https://lean-lang.org/doc/reference/latest/</a></li>\n</ul>\n<p>Is there a description of the \"Lean Kernel Type Checking Rules\" on Lean.Expr ? In the above two links, I am finding lots of related information, but not a concrete definition of what the \"Lean Kernel\" accepts and rejects in terms of Lean.Expr</p>\n<p>Context:</p>\n<ol>\n<li>I am playing with <a href=\"https://github.com/ammkrn/nanoda_lib\">https://github.com/ammkrn/nanoda_lib</a></li>\n<li>I have dumped all of the <code>Lean</code> module using the (nanoda_lib fork of) lean4export</li>\n<li>I try to run nanoda_lib, with something like:</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"c1\">--release -- config_file</span>\n</code></pre></div>\n<ol start=\"4\">\n<li>\n<p>I get an error that looks like:<br>\n<a href=\"/user_uploads/3121/cqg-rxJR7t5Gi7SM0U35knJ7/PastedText.txt\">PastedText.txt</a></p>\n</li>\n<li>\n<p>nanoda_lib rejected something I exported from <code>lean4export Lean</code></p>\n</li>\n<li>This is a bit weird -- but to figure out what is going on, I need to reference impl/description of what the Lean Kernel is supposed to do -- i.e. what it accepts/rejects.</li>\n</ol>\n<p>Besides the C++ Lean4 Kernel source code, is there a description anywhere of what the Lean4 kernel is supposed to accept/reject? (I want to compare this to the nanoda_lib, and see where I screwed up the export process.)</p>\n<p>Thanks!</p>",
        "id": 562809602,
        "sender_full_name": "TongKe Xue",
        "timestamp": 1765318042
    },
    {
        "content": "<p><a href=\"https://github.com/digama0/lean-type-theory/releases/tag/v1.0\">#leantt</a> is the formalization of the rules</p>",
        "id": 562811149,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1765318586
    },
    {
        "content": "<p>(for Lean 3, modified slightly for Lean 4 as can be found in Sebastian Ullrich's PhD thesis)</p>",
        "id": 562811191,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1765318605
    },
    {
        "content": "<p>There have been modifications to the kernel in the not so distant past, mostly changes to <a href=\"http://String.mk\">String.mk</a> and string literals,  as well as the addition of an eager reduction gadget with kernel support. The String changes are what's causing this particular error. The necessary changes were made to <code>nanoda_lib</code> in the <code>debug</code> branch when this issue was first noticed a few weeks ago. </p>\n<p>The String changes haven't been merged into master yet, as I'm trying to get some time to finish sorting out <a href=\"https://github.com/leanprover/lean4export/issues/3#issuecomment-3590602671\">this issue</a> first; the head of mathlib has declarations that are not possible to export in the current version of the export format because the names coming from a <code>library_note2</code> feature contain whitespace. When I get some time I'll move forward with the json format, then merge the type checker changes.</p>",
        "id": 562812252,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765319000
    },
    {
        "content": "<p>Also there's some prose/pseud-code info on type checking in this document: <a href=\"https://ammkrn.github.io/type_checking_in_lean4/title_page.html\">https://ammkrn.github.io/type_checking_in_lean4/title_page.html</a></p>",
        "id": 562812551,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765319108
    },
    {
        "content": "<ol>\n<li>Confirming that on nanoda_lib/debug branch, everything works fine:<br>\n(this is type checking <code>lean4export Lean</code>)</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">RUST_BACKTRACE</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"c1\">--release -- config_file</span>\n<span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">nanoda_lib</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"bp\">.</span><span class=\"m\">3</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">y</span><span class=\"bp\">/</span><span class=\"n\">tt2</span><span class=\"bp\">/</span><span class=\"n\">nanoda_lib</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"ss\">`release</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">optimized</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">11.19</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"ss\">`target</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">nanoda_bin</span><span class=\"w\"> </span><span class=\"n\">config_file</span><span class=\"bp\">`</span>\n<span class=\"n\">Checked</span><span class=\"w\"> </span><span class=\"mi\">131241</span><span class=\"w\"> </span><span class=\"n\">declarations</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n</code></pre></div>\n<p>output.txt</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">HAdd</span><span class=\"bp\">.</span><span class=\"n\">hAdd</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">1</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"k\">forall</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>Could you point me at the docs/issue explaining why nanoda_lib does not use  <a href=\"https://github.com/leanprover/lean4export\">https://github.com/leanprover/lean4export</a> and instead uses a fork? I.e. could this problem be solved by me writing some Rust code to parse the \"official\" lean4export ?</li>\n</ol>\n<p>Thanks!</p>",
        "id": 562819188,
        "sender_full_name": "TongKe Xue",
        "timestamp": 1765321712
    },
    {
        "content": "<p>It doesn't require the use a fork anymore, the recommended additions were merged upstream. I updated the book but evidently not the README. Since it's not a live issue anymore I don't necessarily recommend reading the background, but for the record it's <a href=\"https://github.com/leanprover/lean4export/issues/1\">here</a>.</p>",
        "id": 562820615,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765322367
    },
    {
        "content": "<p>Also these are the upstream changes of note:<br>\n<a href=\"https://github.com/leanprover/lean4/commit/cf8ffc28d306a9d8f442470b88f0385248e8cf32\">https://github.com/leanprover/lean4/commit/cf8ffc28d306a9d8f442470b88f0385248e8cf32</a><br>\n<a href=\"https://github.com/leanprover/lean4/commit/cf871a892c2685af88baa76cdb134f4b980d9819\">https://github.com/leanprover/lean4/commit/cf871a892c2685af88baa76cdb134f4b980d9819</a><br>\n<a href=\"https://github.com/leanprover/lean4/commit/6e18afac8c3eda3b3a53006c67e6842cab2ac681\">https://github.com/leanprover/lean4/commit/6e18afac8c3eda3b3a53006c67e6842cab2ac681</a></p>",
        "id": 562821453,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765322749
    },
    {
        "content": "<p>I failed to get <a href=\"https://github.com/leanprover/lean4export\">https://github.com/leanprover/lean4export</a> to work with nanolib/debug. Error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">RUST_BACKTRACE</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"c1\">--release -- config_file</span>\n<span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">debug</span><span class=\"w\">  </span><span class=\"n\">e5438ac</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">adjustment</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">redefinition</span>\n<span class=\"w\">  </span><span class=\"n\">master</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"n\">cca78</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">lifetime</span><span class=\"w\"> </span><span class=\"n\">annotation</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">quiet</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">lint</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"ss\">`release</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">optimized</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.03</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"ss\">`target</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">nanoda_bin</span><span class=\"w\"> </span><span class=\"n\">config_file</span><span class=\"bp\">`</span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">main'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">154604</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">parser</span><span class=\"bp\">.</span><span class=\"n\">rs</span><span class=\"o\">:</span><span class=\"mi\">322</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"o\">:</span>\n<span class=\"n\">assertion</span><span class=\"w\"> </span><span class=\"ss\">`left</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"w\">  </span><span class=\"n\">left</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">18610</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"n\">right</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">18597</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"o\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">rustc</span><span class=\"bp\">::</span><span class=\"n\">rust_begin_unwind</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"bp\">::</span><span class=\"n\">panicking</span><span class=\"bp\">::</span><span class=\"n\">panic_fmt</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"bp\">::</span><span class=\"n\">panicking</span><span class=\"bp\">::</span><span class=\"n\">assert_failed_inner</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"bp\">::</span><span class=\"n\">panicking</span><span class=\"bp\">::</span><span class=\"n\">assert_failed</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nanoda_lib</span><span class=\"bp\">::</span><span class=\"n\">parser</span><span class=\"bp\">::</span><span class=\"n\">Parser</span><span class=\"bp\">&lt;</span><span class=\"n\">R</span><span class=\"bp\">&gt;::</span><span class=\"n\">parse_expr_let_row</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nanoda_lib</span><span class=\"bp\">::</span><span class=\"n\">util</span><span class=\"bp\">::</span><span class=\"n\">Config</span><span class=\"bp\">::</span><span class=\"n\">to_export_file</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nanoda_bin</span><span class=\"bp\">::</span><span class=\"n\">main</span>\n<span class=\"n\">note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`RUST_BACKTRACE</span><span class=\"bp\">=</span><span class=\"n\">full</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">verbose</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>This looks similar to the error I had yesterday, when trying leanprover/lean4export w/ nanoda_lib/master: <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/how.20to.20install.20https.3A.2F.2Fgithub.2Ecom.2Fammkrn.2Flean4export.2F.20.3F/near/562673153\">#general &gt; how to install https://github.com/ammkrn/lean4export/ ? @ ðŸ’¬</a> </p>\n<p>Full commands I executed:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ExportProject</span><span class=\"o\">]</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">System</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">ExportProject</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.1.0\"</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">mathlib</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">lake4export</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover/lean4export\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"master\"</span>\n<span class=\"w\">  </span><span class=\"c1\">-- \"https://github.com/ammkrn/lean4export/\" @ \"master\"</span>\n\n\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"n\">ExportProject</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"n\">exportproject</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>\n<p>then I used commands</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">25378</span><span class=\"w\">  </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"bp\">...</span>\n<span class=\"mi\">25383</span><span class=\"w\">  </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">lean4export</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">nanoda_lean</span>\n<span class=\"mi\">25384</span><span class=\"w\">  </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">lean4export</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">nanoda_mathlib</span>\n</code></pre></div>\n<p>I'm trying to figure out what I'm doing wrong.</p>\n<ol>\n<li>running wrong branch of nanoda_lib ?</li>\n<li>running wrong version of leanprover/lean4export ?</li>\n</ol>",
        "id": 562833210,
        "sender_full_name": "TongKe Xue",
        "timestamp": 1765327836
    },
    {
        "content": "<p>See the previous comment about some mathlib declarations not being exportable in the current format. No branch of lean4export is currently capable of exporting mathlib properly, because library_note2 introduced declarations with names that the export format was not built to handle (from inception).</p>\n<p>The white space handling in the <code>debug</code> branch is noted in the commit message as being \"known incorrect\"; I wanted to confirm that was indeed the issue. What's happening in your mathlib test is that two names that are the same except for different white space are being exported (improperly), and this improper export is not handled elegantly by the type checker. It's failing because a runtime check intended to prevent this kind of thing is doing its job.</p>\n<p>Until the exporter is switched to use a format that can handle white space in identifiers, there is not a good way to export mathlib using lean4export. I don't have time to do it, but you're welcome to take a stab at implementing the JSON version as described in the GitHub issue.</p>",
        "id": 562834959,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765328769
    },
    {
        "content": "<p>If you're working on something specific, you can DM/email me about what you're trying to do and I'll see if I can point you in the right direction or help you find the right people to ask, if they don't show up here.</p>",
        "id": 562838253,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1765330579
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/batteries/pull/1601\">batteries#1601</a> changes the implementation of <code>library_note</code> to be compatible with <code>lean4export</code>. I understand that soon we will move to a JSON export format, but I'm sad that I had entirely missed this issue until today --- this is the sort of thing we should always address promptly.</p>",
        "id": 566470781,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767668331
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33648\">mathlib#33648</a> sets up a daily Mathlib CI job to run nanoda against <code>master</code> and <code>nightly-testing</code>. I've tested locally. (Currently it uses a patched version of lean4export, but I hope this will converge again quickly.)</p>",
        "id": 566472344,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767669762
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33648\">#33648</a> (the i and l are swapped)</p>",
        "id": 566474641,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1767671767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/docs.20for.20kernel.20type.20checking.20rules.20for.20Lean.2EExpr/near/566470781\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/batteries/pull/1601\">batteries#1601</a> changes the implementation of <code>library_note</code> to be compatible with <code>lean4export</code>. I understand that soon we will move to a JSON export format, but I'm sad that I had entirely missed this issue until today --- this is the sort of thing we should always address promptly.</p>\n</blockquote>\n<p>It seems a bit odd for the export format to cause us to forbid otherwise valid names. Is this meant to be a temporary change until these declarations are supported by <code>lean4export</code>?</p>",
        "id": 566478724,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767675342
    },
    {
        "content": "<p>Yes, the export format is going to be JSON \"real soon now\", and this will all go away, but I want nanoda in Mathlib <strong>now</strong>. :-)</p>",
        "id": 566479936,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767676448
    }
]