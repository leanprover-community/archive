[
    {
        "content": "<p>I've got some code from 2022 which mostly uses the syntax/style of </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">&lt;-&gt;</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>I've reopened this code to make a couple of minor changes, and the whole thing is throwing syntax errors<br>\nIf I take out all the braces and all the semicolons it works.<br>\nChatGPT says there was a recent breaking change around this, but I can't figure out where in the docs that is.<br>\nCan anyone point me in the right direction, or is ChatGPT hallucinating again?</p>",
        "id": 509934220,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743685454
    },
    {
        "content": "<p>maybe</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/wiki/Lean-4-survival-guide-for-Lean-3-users\">https://github.com/leanprover-community/mathlib4/wiki/Lean-4-survival-guide-for-Lean-3-users</a></p>\n<p>and</p>\n<p><a href=\"https://lean-lang.org/lean4/doc/lean3changes.html\">https://lean-lang.org/lean4/doc/lean3changes.html</a></p>\n<p>?</p>",
        "id": 509938409,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1743686423
    },
    {
        "content": "<p>I had a look at that, but neither offers a conclusive answer<br>\nThis is the closest: <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Lean-4-survival-guide-for-Lean-3-users#:~:text=If%20you%20have%20multiple%20goals%2C%20you%20can%20work%20on%20the%20first%20goal%20using%20%C2%B7%20%3Ctactics%3E%20instead%20of%20%7B%3Ctactics%3E%7D.%20Note%20that%20%C2%B7%20is%20%5C.%2C%20not%20%5Ccdot\">https://github.com/leanprover-community/mathlib4/wiki/Lean-4-survival-guide-for-Lean-3-users#:~:text=If%20you%20have%20multiple%20goals%2C%20you%20can%20work%20on%20the%20first%20goal%20using%20%C2%B7%20%3Ctactics%3E%20instead%20of%20%7B%3Ctactics%3E%7D.%20Note%20that%20%C2%B7%20is%20%5C.%2C%20not%20%5Ccdot</a>.</p>",
        "id": 509957264,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743690460
    },
    {
        "content": "<p>The thing that particularly confuses me is that this code worked in Lean4 3ish years ago, but now doesn't</p>",
        "id": 509957439,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743690494
    },
    {
        "content": "<p>Can you post a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 509960030,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691080
    },
    {
        "content": "<p>(in this case, a minimal non-working example)</p>",
        "id": 509960115,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691096
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_false</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">temp</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>This code was committed to my repo in May 2023 and the proof succeeded. (So presumable there were no syntax errors<br>\nWhen opening it again today, VS code gives me the following 3 errors, all on the \"case mp\" line:<br>\nunexpected syntax <br>\n  case mp =&gt; {intro temp; apply eq_false; exact temp;<br>\n  }</p>\n<p>this tactic is never executed<br>\nnote: this linter can be disabled with <code>set_option linter.unreachableTactic false</code></p>\n<p>'case mp =&gt; {intro temp; apply eq_false; exact temp;<br>\n}' tactic does nothing<br>\nnote: this linter can be disabled with <code>set_option linter.unusedTactic false</code></p>\n<p>It also gives me the \"tactic does nothing\" and \"never executed\" warnings on the \"case mpr\" line, but no syntax error. (Presumably because it can't continue finding errors after a parse fail?)</p>",
        "id": 509962038,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743691599
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_false</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">temp</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 509962538,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743691755
    },
    {
        "content": "<p>Basically for reasons beyond me, <code>apply Iff.intro</code> introduced two unnamed goals</p>",
        "id": 509962653,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743691784
    },
    {
        "content": "<p>thus <code>case mp</code> and <code>case mpr</code> are not selecting these goals. Otherwise your syntax is fine, although not typical.</p>",
        "id": 509962703,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743691801
    },
    {
        "content": "<p>Of course, if you only want to select the goals, you can also just skip the <code>\\.</code> selectors:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_false</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">temp</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 509964100,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743692143
    },
    {
        "content": "<p>Opening braces seems to focus proof mode on the first goal</p>",
        "id": 509964300,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743692186
    },
    {
        "content": "<p>Once I remove all the brackets and semicolons it works, and has 2 named goals as mp and mpr<br>\nI've just accepted that I don't understand what's going on and re-syntaxed my entire proof</p>",
        "id": 509969966,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743693556
    },
    {
        "content": "<p>Essentially no-one is using the braced syntax so I'm not too surprised it broke at some point without anyone noticing. You can file an issue, but switching to indentation-based syntax is the much better option, yes.</p>",
        "id": 509970372,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1743693642
    },
    {
        "content": "<p>A simpler fix would just be to remove the braces from your code, then it works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_false</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">temp</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"bp\">;</span>\n</code></pre></div>",
        "id": 509974658,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743694613
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/113488-general/topic/Recent.20Changes/near/509962653\">said</a>:</p>\n<blockquote>\n<p>Basically for reasons beyond me, <code>apply Iff.intro</code> introduced two unnamed goals</p>\n</blockquote>\n<p>I don't think this is true, it's introducing two named goals, and I can select them as above. But perhaps you got misled (by the same thing that's misled me in the past): <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/lean4.2Einfoview.2EshowGoalNames.20is.20false.20in.20the.20web.20editor/with/509768221\">#general &gt; lean4.infoview.showGoalNames is false in the web editor</a></p>",
        "id": 509976650,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743695094
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/Recent.20Changes/near/509970372\">said</a>:</p>\n<blockquote>\n<p>switching to indentation-based syntax is the much better option, yes.</p>\n</blockquote>\n<p>I did exactly this, and removed all the semicolons at the end of lines, which I believe were also unnecessary and did nothing</p>",
        "id": 509979585,
        "sender_full_name": "Rosie Baish",
        "timestamp": 1743695846
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/113488-general/topic/Recent.20Changes/near/509976650\">said</a>:</p>\n<blockquote>\n<p>I don't think this is true, it's introducing two named goals, and I can select them as above. But perhaps you got misled (by the same thing that's misled me in the past): <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/lean4.2Einfoview.2EshowGoalNames.20is.20false.20in.20the.20web.20editor/with/509768221\">#general &gt; lean4.infoview.showGoalNames is false in the web editor</a></p>\n</blockquote>\n<p>Yes I think this was the issue. But I was able to get the braces syntax working after removing the explicit <code>case mp</code> and <code>case mpr</code> selectors as shown above.</p>\n<p>The braced syntax still works</p>",
        "id": 510154766,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743765144
    },
    {
        "content": "<p>Specifically here :</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/113488-general/topic/Recent.20Changes/near/509964100\">said</a>:</p>\n<blockquote>\n<p>Of course, if you only want to select the goals, you can also just skip the <code>\\.</code> selectors:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">eq_false</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">temp</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">temp</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 510155513,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1743765340
    },
    {
        "content": "<p>Poking into this issue a bit more specifically, it appears that <code>case x =&gt; {}</code> is the part that fails. It's not a syntax error, but rather there is no elaborator found for the syntax. It's the same message you get from</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Macro</span><span class=\"bp\">.</span><span class=\"n\">throwUnsupported</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c1\">-- unexpected syntax</span>\n<span class=\"c1\">--   foo</span>\n</code></pre></div>",
        "id": 510259736,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743789232
    },
    {
        "content": "<p>And when looking at the elaborator it's pretty clear why this happens:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">builtin_tactic</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">case</span><span class=\"bp\">»</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">builtin_incremental</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">evalCase</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">@`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"bp\">%$</span><span class=\"n\">caseTk</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">hs</span><span class=\"bp\">*</span><span class=\"o\">]</span><span class=\"bp\">|*</span><span class=\"w\"> </span><span class=\"bp\">=&gt;%$</span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">tac</span><span class=\"o\">:</span><span class=\"n\">tacticSeq1Indented</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">...</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>",
        "id": 510260662,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743789577
    },
    {
        "content": "<p>this seems to be the only direct use of <code>tacticSeq1Indented</code> in the codebase, so I don't think there are any other errors like it lurking</p>",
        "id": 510260880,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743789631
    },
    {
        "content": "<p>the bug was introduced in <a href=\"https://github.com/leanprover/lean4/pull/3940\">lean4#3940</a> (cc:  <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> ) as part of incremental tactic elaboration for <code>case</code></p>",
        "id": 510261486,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743789809
    },
    {
        "content": "<p>I think it was just done so that the <code>argIdx := 3</code> part is correct (the index is different for bracketed syntax), so the fix should be easy</p>",
        "id": 510261747,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743789881
    },
    {
        "content": "<p>Mario means <a href=\"https://github.com/leanprover/lean4/pull/3940\">lean4#3940</a></p>",
        "id": 510264134,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1743790687
    }
]