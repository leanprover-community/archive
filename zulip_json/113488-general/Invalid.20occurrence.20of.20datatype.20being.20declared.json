[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Vect</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vect</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">   </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Vect</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Vect</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">semF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Sigma</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Vect</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">semF</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"n\">σ</span>\n</code></pre></div>\n<p>how come the above produces <code>(kernel) arg #2 of 'μ.mk' contains a non valid occurrence of the datatypes being declared</code>?</p>",
        "id": 476812434,
        "sender_full_name": "nrs",
        "timestamp": 1728920108
    },
    {
        "content": "<p>It works if we use <code>unsafe inductive μ (σ : Signature)</code></p>",
        "id": 476812560,
        "sender_full_name": "nrs",
        "timestamp": 1728920155
    },
    {
        "content": "<p>I've also tried replacing occurrence of <code>Type</code> in <code>semF</code> by <code>Type _</code></p>",
        "id": 476813137,
        "sender_full_name": "nrs",
        "timestamp": 1728920387
    },
    {
        "content": "<p>because nested inductive types only work through other inductives</p>",
        "id": 476813431,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728920499
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/Invalid.20occurrence.20of.20datatype.20being.20declared/near/476813431\">said</a>:</p>\n<blockquote>\n<p>because nested inductive types only work through other inductives</p>\n</blockquote>\n<p>i.e. <code>semF</code> should be inductive for this to work?</p>",
        "id": 476813571,
        "sender_full_name": "nrs",
        "timestamp": 1728920545
    },
    {
        "content": "<p>If you inline the definition of <code>semF</code> it appears to work</p>",
        "id": 476813658,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728920581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113488-general/topic/Invalid.20occurrence.20of.20datatype.20being.20declared/near/476813658\">said</a>:</p>\n<blockquote>\n<p>If you inline the definition of <code>semF</code> it appears to work</p>\n</blockquote>\n<p>ah thank you very much! I'm adding that to my heuristics. First: check whether you need to change parameters ordering. Second, check whether universe level is right. Now adding third: try inlining.</p>",
        "id": 476814040,
        "sender_full_name": "nrs",
        "timestamp": 1728920733
    },
    {
        "content": "<p>in this case this happened because <code>semF</code> was not inductive right?</p>",
        "id": 476814170,
        "sender_full_name": "nrs",
        "timestamp": 1728920775
    },
    {
        "content": "<p>yes</p>",
        "id": 476814923,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728921123
    },
    {
        "content": "<p>noted, tyvm for help!!</p>",
        "id": 476814968,
        "sender_full_name": "nrs",
        "timestamp": 1728921135
    },
    {
        "content": "<p>specifically, try inlining any functions which use the type being defined, here <code>μ σ</code></p>",
        "id": 476815117,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728921200
    }
]