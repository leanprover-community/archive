[
    {
        "content": "<p>Several declarations named <code>Simps.apply</code> have \"See Note [custom simps projection]\" as a docstring. Where can I find this note?</p>",
        "id": 469840462,
        "sender_full_name": "Felix Weilacher",
        "timestamp": 1726199615
    },
    {
        "content": "<p><a href=\"https://tqft.net/mathlib4files/Mathlib/Tactic/Simps/Basic\">file#Mathlib/Tactic/Simps/Basic</a></p>\n<p>particularly <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Simps/Basic.lean#L814\">line 814</a></p>",
        "id": 469850158,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726202972
    },
    {
        "content": "<p>(I found this by grepping for <code>library_note.*custom simps projection</code></p>",
        "id": 469850239,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726203025
    },
    {
        "content": "<p>There used to be a jump-to-defn function for these, right?</p>",
        "id": 469850256,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726203039
    },
    {
        "content": "<p>These notes used to just be clickable, but that seems to have been lost :-(</p>",
        "id": 469850260,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726203040
    },
    {
        "content": "<p>I think this was back in Lean 3</p>",
        "id": 469850272,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726203052
    },
    {
        "content": "<p>I think the issue here is that making them clickable would require hard-coding knowledge about mathlib into the extension. My understanding (based on similar tensions with doc-gen) is that this is no longer considered acceptable, even as a short term hack</p>",
        "id": 469905642,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1726218768
    },
    {
        "content": "<p>thanks!</p>",
        "id": 470049444,
        "sender_full_name": "Felix Weilacher",
        "timestamp": 1726261780
    },
    {
        "content": "<p>Perhaps it would be useful to gather all these notes to one place, so people will know where to look? I think having to search for documentation is an anti-pattern...</p>",
        "id": 470102834,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726291752
    },
    {
        "content": "<p>This could conceivably allow us to tell docgen in some kind of setting where to look for these notes, and link them, which means it doesn't need to be a mathlib-specific solution</p>",
        "id": 470103265,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726291927
    },
    {
        "content": "<p>I think getting jump-to-defn to work shouldn't be too hard. And that seems like a solution that scales well</p>",
        "id": 470120987,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726300465
    },
    {
        "content": "<p>When lean meets openai o1?</p>",
        "id": 470136729,
        "sender_full_name": "Daniel Kang",
        "timestamp": 1726306704
    },
    {
        "content": "<p>btw, the <code>library_note</code> command is defined in <code>Batteries.Util.LibraryNote</code>, so it is not quite a <code>Mathlib</code>-only thing.</p>",
        "id": 470161307,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726315920
    },
    {
        "content": "<p>it might be predominantly used in mathlib (for all i know; i only ever head about it being used in this context), but it is technically a <code>Batteries</code> thing.</p>",
        "id": 470161433,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726315995
    },
    {
        "content": "<p>As another alternative, maybe a command <code>#check_note [some_note]</code> might be used to display the note in the infoview?</p>",
        "id": 470163634,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726316736
    },
    {
        "content": "<p>i have a prototype command which manages to find the notes in the same file, (presumably because <code>Lean.Environment</code> is local to a file). i'm quite new to metaprogramming and lean internals, so perhaps someone could take my prototype to a new level?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">LibraryNote</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">LibraryNote</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#check_note\"</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"n\">strLit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">libraryNoteExt</span><span class=\"bp\">.</span><span class=\"n\">getEntries</span><span class=\"w\"> </span><span class=\"n\">env</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">entry_name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">getString</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">valid_entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">entries</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">entry_name</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">valid_entries</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"404 Note not found\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">compiled_entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"/--</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"-/</span><span class=\"se\">\\n\\n</span><span class=\"s2\">/--</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">valid_entries</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"-/\"</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">compiled_entries</span>\n\n<span class=\"n\">library_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">note1</span>\n<span class=\"sd\">-/</span>\n\n\n<span class=\"n\">library_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"sd\">/--</span>\n<span class=\"sd\">note2</span>\n<span class=\"sd\">-/</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">check_note</span><span class=\"w\"> </span><span class=\"s2\">\"custom simps projection\"</span>\n<span class=\"bp\">#</span><span class=\"n\">check_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span>\n</code></pre></div>",
        "id": 470181979,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726325973
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">LibraryNote</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">LibraryNote</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#check_note\"</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"n\">strLit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">libraryNoteExt</span><span class=\"bp\">.</span><span class=\"n\">getEntries</span><span class=\"w\"> </span><span class=\"n\">env</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">libraryNoteExt</span><span class=\"bp\">.</span><span class=\"n\">toEnvExtension</span><span class=\"bp\">.</span><span class=\"n\">getState</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">importedEntries</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">entry_name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">getString</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">imported_filtered</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imported</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">filterMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">entry_name</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">flatten</span><span class=\"bp\">.</span><span class=\"n\">toList</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">valid_entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">entries</span><span class=\"bp\">.</span><span class=\"n\">filterMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">entry_name</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">imported_filtered</span>\n\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">valid_entries</span><span class=\"bp\">.</span><span class=\"n\">isEmpty</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"404 Note not found\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">compiled_entries</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"/--</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"-/</span><span class=\"se\">\\n\\n</span><span class=\"s2\">/--</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"bp\">.</span><span class=\"n\">intercalate</span><span class=\"w\"> </span><span class=\"n\">valid_entries</span><span class=\"bp\">.</span><span class=\"n\">reverse</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"-/\"</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">compiled_entries</span>\n\n<span class=\"n\">library_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span>\n<span class=\"sd\">/--</span>\n<span class=\"sd\">note1</span>\n<span class=\"sd\">-/</span>\n\n\n<span class=\"n\">library_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"sd\">/--</span>\n<span class=\"sd\">note2</span>\n<span class=\"sd\">-/</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">check_note</span><span class=\"w\"> </span><span class=\"s2\">\"custom simps projection\"</span>\n<span class=\"bp\">#</span><span class=\"n\">check_note</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span>\n</code></pre></div>\n<p>i figured out how to do it by myself <span aria-label=\"confetti\" class=\"emoji emoji-1f38a\" role=\"img\" title=\"confetti\">:confetti:</span></p>",
        "id": 470195559,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726331382
    },
    {
        "content": "<p>is this something that would be welcome in batteries (in <code>Batteries.Util.LibraryNote</code>?)</p>",
        "id": 470195833,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726331547
    },
    {
        "content": "<p>fwiw, there now is <a href=\"https://github.com/leanprover-community/batteries/pull/948\">this PR</a> to batteries, adding the command to the file.</p>",
        "id": 470202552,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726334354
    },
    {
        "content": "<p>as a side note, the README for batteries says that PRs should preferably use the tags system, but i don't have the right to add or change those, it seems.</p>",
        "id": 470202999,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1726334689
    },
    {
        "content": "<p>To make this work for doc-gen4, I think the easiest way is to hack the bibliography system, since <code>[custom simps projection]</code> syntax is the same as the bibliography syntax. Perhaps we can add a way to allow docstring or something else register global links with names.</p>",
        "id": 470561529,
        "sender_full_name": "Jz Pan",
        "timestamp": 1726486110
    },
    {
        "content": "<p>Unfortunately, this (along with some other enhancements) may need a two-pass approach for doc-gen...</p>",
        "id": 470562481,
        "sender_full_name": "Jz Pan",
        "timestamp": 1726486238
    }
]