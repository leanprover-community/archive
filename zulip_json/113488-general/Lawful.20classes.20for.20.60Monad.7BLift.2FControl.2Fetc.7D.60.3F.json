[
    {
        "content": "<p>Hi all,</p>\n<p>I'm looking to add <code>Lawful</code> instances to a bunch of monadic definitions in <code>Init/Prelude</code> such as <code>Monad{Lift/Control/Functor/State/etc.}</code>. The motivation being verification of programs written in a monadic stack. More generally, I hope to flesh out the monadic stack in Lean and align them to be more similar to what is in Haskell.</p>\n<p>It seems that there's interest in such a development, from prior Zulip threads <a href=\"#narrow/channel/270676-lean4/topic/MonadControlT.20vs.20transitive.20closure.20of.20MonadControl\">here</a> and <a href=\"#narrow/channel/270676-lean4/topic/MonadFunctor.20misunderstanding.20or.20bug.3F/near/476662228\">here</a>. I'd imagine that this will prove helpful to Lean FRO's project to add support for verifying <code>do</code> block code (see <a href=\"#narrow/channel/474713-Lean-Together-2025/topic/Lean.20FRO.20Meeting/near/493943761\">this comment</a>).</p>\n<p>My question is thus: is this something in scope for the community, and where should this go (i.e. <code>lean</code>, <code>batteries</code>, <code>mathlib</code>, or perhaps a separate repo)?</p>",
        "id": 498160300,
        "sender_full_name": "Quang Dao",
        "timestamp": 1738858798
    },
    {
        "content": "<p>To the extent that you are simply adding lawful instances of existing <code>LawfulX</code> type classes, I would suggest Batteries, or <em>possibly</em> Lean if you're happy to write an RFC first, and explain clearly what is being done and what would remain to be done. </p>\n<p>If you're designing new classes, I'd recommend exploring in a separate repo for a while.</p>",
        "id": 498228667,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738883755
    },
    {
        "content": "<p>Do feel free to consult people in the batteries channel about this and related questions.</p>",
        "id": 498256911,
        "sender_full_name": "Fran√ßois G. Dorais",
        "timestamp": 1738901522
    },
    {
        "content": "<p>PR opened: <a href=\"https://github.com/leanprover-community/batteries/pull/1125\">batteries#1125</a></p>",
        "id": 498259492,
        "sender_full_name": "Quang Dao",
        "timestamp": 1738903213
    },
    {
        "content": "<p>Looks good, thanks. Left minor comments, but this is sufficiently straightforward that I'd be happy to take it.</p>",
        "id": 498259843,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738903501
    },
    {
        "content": "<p>Can you add instances corresponding to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadLift</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonadLiftT</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonadLiftT</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">monadLift</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MonadLift</span><span class=\"bp\">.</span><span class=\"n\">monadLift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">monadLift</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonadLiftT</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">monadLift</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 498259860,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738903513
    },
    {
        "content": "<p>Can you say something about the EIO, BaseIO, IO, CoreM, MetaM, TermElabM, TacticM, CommandElabM stack. Are there any meaningful instances for the lifts existing there?</p>",
        "id": 498260027,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738903649
    },
    {
        "content": "<p>A lot of these don't even appear to be accessible in batteries? They also rely on <code>StateRefT</code> which is somehow opaque.</p>\n<p>I went through all instances of <code>MonadLift</code> (via typing <code>#check instMonadLift</code> and wait for all suggestions) and add the corresponding <code>Lawful</code> instances</p>",
        "id": 498264658,
        "sender_full_name": "Quang Dao",
        "timestamp": 1738906972
    },
    {
        "content": "<p>To find all instances, grep <code>instance.*: MonadLift</code> in the lean4 repo.</p>",
        "id": 498287056,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738917926
    },
    {
        "content": "<p>If you want to add anything about the CoreM and upwards stack (if it even is true?) then they should go in <code>Batteries/Lean/LawfulMonadLift.lean</code>.</p>",
        "id": 498287631,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738918094
    }
]