[
    {
        "content": "<p>Hello,</p>\n<p>I am very new to lean and I'm trying to define the Collatz function over the 2-adic integers:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">Padics</span><span class=\"bp\">.</span><span class=\"n\">PadicIntegers</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">C_Z2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>This fails with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">x</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">HDiv</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Would you know how to fix these issues? Thank you!</p>",
        "id": 526783392,
        "sender_full_name": "Tristan Stérin",
        "timestamp": 1751457102
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"911558\">@Tristan Stérin</span> welcome! for a MWE, pleaes include the relevant imports etc. so that your code compiles as it is (if you hover over the code block, you can click the button on the top right corner to be transported to online Lean, so that you can confirm)</p>",
        "id": 526786514,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458139
    },
    {
        "content": "<p>from these error messages, the first error is saying that it can't figure out a way to convert an element of Z_2 to an element of Z/2Z yet; the second error is saying that obviously x/2 is not defined on Z_2</p>",
        "id": 526786645,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458182
    },
    {
        "content": "<p>when mathematicians write down an expression x/y, it usually means, \"assume x is divisible by y, and then evaluate this expression\"; but a computer can't do that, whatever expression you write down will already have a meaning</p>",
        "id": 526786790,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458242
    },
    {
        "content": "<p>so if you ever write down the expression \"x / 2\", then you're making a promise that this expression will make sense for every <code>x : Z_[2]</code></p>",
        "id": 526786929,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458286
    },
    {
        "content": "<p>Apologies, I'm using mathlib's <code>Mathlib.NumberTheory.Padics.PadicIntegers</code></p>",
        "id": 526786988,
        "sender_full_name": "Tristan Stérin",
        "timestamp": 1751458307
    },
    {
        "content": "<p>Any even 2-adic integer <code>x</code> ends with LSB <code>0</code> and operation x/2 only consists in getting rid of this final <code>0</code>. I assume this logic is encoded somewhere in mathlib.</p>",
        "id": 526787236,
        "sender_full_name": "Tristan Stérin",
        "timestamp": 1751458389
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"911558\">Tristan Stérin</span> <a href=\"#narrow/channel/113488-general/topic/Defining.20the.20Collatz.20function.20of.20the.202-adic.20integers/near/526787236\">said</a>:</p>\n<blockquote>\n<p>Any even 2-adic integer <code>x</code> ends with LSB <code>0</code></p>\n</blockquote>\n<p>This is an \"implementation-dependent\" statement.</p>",
        "id": 526788827,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458861
    },
    {
        "content": "<p>anyways, here is how you do it, given the current implementation</p>",
        "id": 526789004,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458910
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"911558\">@Tristan Stérin</span> Z_[2] is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/Padics/PadicIntegers.html#PadicInt\">defined to be</a> elements of ℚ_[2] with norm &lt;= 1. show that under your assumptions, (↑x : ℚ_[2]) / 2 has norm &lt;= 1, then use that to get back your answer</p>",
        "id": 526789239,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751458995
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 526789310,
        "sender_full_name": "Tristan Stérin",
        "timestamp": 1751459019
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">Padics</span><span class=\"bp\">.</span><span class=\"n\">PadicIntegers</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">Padics</span><span class=\"bp\">.</span><span class=\"n\">RingHoms</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">PadicInt</span><span class=\"bp\">.</span><span class=\"n\">norm_le_one_div_p_of_mem_maximalIdeal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">IsLocalRing</span><span class=\"bp\">.</span><span class=\"n\">maximalIdeal</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‖</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">C_Z2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">toZMod</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">norm_le_one_div_p_of_mem_maximalIdeal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">PadicInt</span><span class=\"bp\">.</span><span class=\"n\">ker_toZMod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">])</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 526790294,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751459378
    },
    {
        "content": "<p>Thank you !! This hints thay I may need to define them differently for my needs (and maybe prove that both definitions are the same)</p>",
        "id": 526790680,
        "sender_full_name": "Tristan Stérin",
        "timestamp": 1751459515
    },
    {
        "content": "<p>in type theory, everything has to have a type immediately</p>",
        "id": 526791299,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751459725
    },
    {
        "content": "<p>if you think about it more, you'll realise that in maths \"x/y\" can have an indeterminate type until x and y are specified <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 526791366,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751459749
    },
    {
        "content": "<p>for example, people will say that x/y is \"undefined\" when y=0</p>",
        "id": 526791410,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751459763
    },
    {
        "content": "<p>and 13/4 is \"a rational number\" even though you started with natural numbers 13 and 4</p>",
        "id": 526791489,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751459787
    },
    {
        "content": "<p>so you must be careful when translating these expressions into Lean</p>",
        "id": 526791528,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751459797
    },
    {
        "content": "<p>Cheat:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">Padics</span><span class=\"bp\">.</span><span class=\"n\">PadicIntegers</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">C_Z2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 526792875,
        "sender_full_name": "Jz Pan",
        "timestamp": 1751460268
    },
    {
        "content": "<p>That's basically what <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PadicInt.zmodRepr#doc\">docs#PadicInt.zmodRepr</a> does too.</p>",
        "id": 526798732,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751462009
    },
    {
        "content": "<p>It can probably be made computable by switching to <code>Nat.find</code></p>",
        "id": 526798856,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751462048
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/113488-general/topic/Defining.20the.20Collatz.20function.20of.20the.202-adic.20integers/near/526798856\">said</a>:</p>\n<blockquote>\n<p>It can probably be made computable by switching to <code>Nat.find</code></p>\n</blockquote>\n<p>uh.... Qp is defined using Cauchy sequences. Let f: N -&gt; Q be the sequence such that f(n) = 0 if the Riemann Hypothesis is true, and f(n) = 1 if the Riemann Hypothesis is false. What's the corresponding value of zmodRepr?</p>",
        "id": 526799472,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462234
    },
    {
        "content": "<p><a href=\"https://hal.science/hal-01444183/document\">https://hal.science/hal-01444183/document</a></p>",
        "id": 526800864,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751462660
    },
    {
        "content": "<p>sorry, this f is not computable, but you can <a href=\"https://mathoverflow.net/a/107083\">convert RH into a Π1 statement</a> basically of the form <code>∀ n, f(n) &lt; g(n)</code> for functions <code>f, g : ℕ → ℚ</code>, then you can instead form the Cauchy sequence a_k that is 1 if that statement is true for all n &lt; k, and 0 otherwise</p>",
        "id": 526801187,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462743
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/113488-general/topic/Defining.20the.20Collatz.20function.20of.20the.202-adic.20integers/near/526800864\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://hal.science/hal-01444183/document\">https://hal.science/hal-01444183/document</a></p>\n</blockquote>\n<p>sure, you can cite articles, but have you read the fine print? did you see that they're using a different definition? did you look at all the merits and weaknesses of the alternate definition?</p>",
        "id": 526801566,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462852
    },
    {
        "content": "<p>it's the same situation with the reals</p>",
        "id": 526801716,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462891
    },
    {
        "content": "<p>there are \"more computable definitions\" but none of them is perfect</p>",
        "id": 526801764,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462905
    },
    {
        "content": "<p>and i don't think mathlib cares about these more computable definitions</p>",
        "id": 526801805,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751462916
    },
    {
        "content": "<p>Yes, but if someone wants to work on Collatz, they might be interested in actually \"computing\" a chain</p>",
        "id": 526802180,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751463018
    },
    {
        "content": "<p>well anyone is welcome to make an alternate definition of Z_[p] anywhere</p>",
        "id": 526802315,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751463052
    }
]