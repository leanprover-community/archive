[
    {
        "content": "<p>I'm trying to find an adequate way to state whether or not a function or an operation is computable. Does anyone have suggestions?</p>",
        "id": 478065822,
        "sender_full_name": "nrs",
        "timestamp": 1729518524
    },
    {
        "content": "<p>Is it possible to state this internally in Lean?</p>",
        "id": 478066201,
        "sender_full_name": "nrs",
        "timestamp": 1729518627
    },
    {
        "content": "<p>Do not mean \"not computable\" in the CS sense, or <code>noncomputable</code> in the \"does lean actually compile it\" sense?</p>",
        "id": 478067183,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729518867
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478067183\">said</a>:</p>\n<blockquote>\n<p>Do not mean \"not computable\" in the CS sense, or <code>noncomputable</code> in the \"does lean actually compile it\" sense?</p>\n</blockquote>\n<p>I am not sure, do these two have any sort of relationship to one another?</p>",
        "id": 478067477,
        "sender_full_name": "nrs",
        "timestamp": 1729518939
    },
    {
        "content": "<p>Not really; neither is a subset of the other</p>",
        "id": 478074831,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729520725
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478074831\">said</a>:</p>\n<blockquote>\n<p>Not really; neither is a subset of the other</p>\n</blockquote>\n<p>If a function is not computable in the CS sense, shouldn't it have to be a <code>noncomputable def</code> in Lean?</p>",
        "id": 478098438,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1729526833
    },
    {
        "content": "<p><code>noncomputable</code> is really a practical keyword. For example functions implemented directly using recursors need to be marked as <code>noncomputable</code>, even though recursors have a perfectly fine theoretical interpretation of computation. But using them directly leads to inefficient code being generated (so I've been told at least), hence the need to be marked as noncomputable.</p>",
        "id": 478098802,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1729526946
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478098438\">said</a>:</p>\n<blockquote>\n<p>If a function is not computable in the CS sense, shouldn't it have to be a <code>noncomputable def</code> in Lean?</p>\n</blockquote>\n<p>No, see <a href=\"#narrow/channel/458659-Equational/topic/non-computable.20non-non-computables.3F/near/477546578\">this thread</a></p>",
        "id": 478099251,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729527053
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"416280\">Max Nowak üêâ</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478098802\">said</a>:</p>\n<blockquote>\n<p>For example functions implemented directly using recursors need to be marked as <code>noncomputable</code></p>\n</blockquote>\n<p>Unless you use <code>compile_inductive%</code> first.</p>",
        "id": 478099357,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729527079
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478099251\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478098438\">said</a>:</p>\n<blockquote>\n<p>If a function is not computable in the CS sense, shouldn't it have to be a <code>noncomputable def</code> in Lean?</p>\n</blockquote>\n<p>No, see <a href=\"#narrow/channel/458659-Equational/topic/non-computable.20non-non-computables.3F/near/477546578\">this thread</a></p>\n</blockquote>\n<p>I did not think of <code>partial def</code>. And if a regular <code>def</code> calls a <code>partial def</code> then it can be noncomputable. I understand now. Thanks.</p>",
        "id": 478099941,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1729527245
    },
    {
        "content": "<p>What does <code>compile_inductive%</code> do?</p>",
        "id": 478100022,
        "sender_full_name": "Max Nowak üêâ",
        "timestamp": 1729527281
    },
    {
        "content": "<p>Makes the recursors computable</p>",
        "id": 478100349,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729527378
    },
    {
        "content": "<p>(Notably by accepting the badly generated code)</p>",
        "id": 478100949,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1729527549
    },
    {
        "content": "<p>In some cases the generated code is optimal though, I think? Such as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unpack</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ULift</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">id</span>\n</code></pre></div>\n<p>Certainly it's non-optimal on types with more than one constructor.</p>",
        "id": 478101427,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729527685
    },
    {
        "content": "<p>Whats the IR thats generated by this?</p>",
        "id": 478102089,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1729527892
    },
    {
        "content": "<p>But yeah this could be fine. Its generally an issue if actual recursion is involved</p>",
        "id": 478102295,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1729527957
    },
    {
        "content": "<p>Its also a fixable issue by adding more optimizations</p>",
        "id": 478102472,
        "sender_full_name": "Henrik B√∂ving",
        "timestamp": 1729527993
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478099251\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478098438\">said</a>:</p>\n<blockquote>\n<p>If a function is not computable in the CS sense, shouldn't it have to be a <code>noncomputable def</code> in Lean?</p>\n</blockquote>\n<p>No, see <a href=\"#narrow/channel/458659-Equational/topic/non-computable.20non-non-computables.3F/near/477546578\">this thread</a></p>\n</blockquote>\n<p>Doesn't this mean that either:</p>\n<ul>\n<li>there are functions marked not with <code>noncomputable</code> that will not actually be compiled by Lean (I feel like that <code>noncomputable</code> kinda lose its meaning then)</li>\n<li><code>haltingFunction</code> compiles but at runtime behaves differently than what the <code>haltingFunction_not_computable</code> assumes (but wouldn't this be unsound?)</li>\n</ul>",
        "id": 478360571,
        "sender_full_name": "Giacomo Stevanato",
        "timestamp": 1729628202
    },
    {
        "content": "<p>The runtime behavior is just running in an infinite loop</p>",
        "id": 478399686,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729651898
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478399686\">said</a>:</p>\n<blockquote>\n<p>The runtime behavior is just running in an infinite loop</p>\n</blockquote>\n<p>Then why is it that <code>haltingFunction</code> is considered to be the halting function? To actually be the halting function it should not loop infinitely.</p>",
        "id": 478451148,
        "sender_full_name": "Giacomo Stevanato",
        "timestamp": 1729675711
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik B√∂ving</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20metatheory.3A.20what.20is.20the.20statement.20.22f.20is.20noncomputable.22.3F/near/478102472\">said</a>:</p>\n<blockquote>\n<p>Its also a fixable issue by adding more optimizations</p>\n</blockquote>\n<p>I've generally found this issue to be overblown. Lean already switches to a partial call-by-need evaluation strategy for compiling <code>casesOn</code>, and it could do so for <code>recOn</code> too. It's really just adding a single additional case to handle <code>recOn</code> in the code generator, I looked into it maybe a year ago. But the code generator is frozen <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 478915421,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1729861627
    },
    {
        "content": "<p>I'm interested about the <code>compile_inductive</code> think, what exactly is the issue it solves?</p>",
        "id": 480181527,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1730521360
    },
    {
        "content": "<p>(maybe this should be a separate thread...)</p>",
        "id": 480181532,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1730521368
    },
    {
        "content": "<p>If you attempt to use <code>T.rec</code> directly in a definition, lean complains that it is <code>noncomputable</code> because the code generator doesn't know how to handle primitive recursors.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"c1\">-- code generator does not support recursor 'List.rec' yet, consider using 'match ... with' and/or structural recursion</span>\n</code></pre></div>\n<p>Using the <code>compile_inductive%</code> command generates code for the recursors so that it works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">CompileInductive</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 480333064,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730662900
    },
    {
        "content": "<p>What <em>does</em> the code generator handle then? I think of recursors as the \"basic\" terms from which all other functions are built. Like if statements are the recursor for Decidable, addition of nats is a recursor on nat...</p>\n<p>Is it just a fixed list of operations which <em>are</em> supported?</p>",
        "id": 480350239,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1730680039
    },
    {
        "content": "<p>The code generator uses different primitive functions than the kernel. To the code generator, the primitive is <code>casesOn</code> and/or projections for getting data out and constructors for putting data in, plus unguarded recursion. In other words, the code generator thinks in terms of <code>match</code> and <code>fix</code> rather than recursors</p>",
        "id": 480350566,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1730680436
    }
]