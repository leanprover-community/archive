[
    {
        "content": "<p>thought i'd make a fun quiz on how the comment parser behaves - you should try and figure out whether the position directly after said token is valid Lean code, a comment, or an error - good luck :)</p>\n<p>ps the syntax highlighter won't always help you!</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>--\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>simple - an inline comment. directly after would be a <strong>comment</strong>, or <strong>normal code</strong> after a newline.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/- -/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>again, a simple multiline comment; it is closed, so after it would be <strong>normal code</strong>.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/-- -/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>a doc comment - technically this is an <strong>error</strong>, as doc comments require to be just before a declaration (you can see the full list if you copy-paste this into an editor</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/- /- -/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>you're still in a <strong>comment</strong>! (technically you <strong>error</strong> as it's unterminated). Lean is the only language I know that supports nested multiline comments.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/- /- -/ -/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>yes, this is indeed a valid nested comment! after would be <strong>normal code</strong>.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>-- /-\n-/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>the inline comment stops the multiline from starting, so you terminate  a comment that doesn't exist -- <strong>error</strong>.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/-/-/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>this is <strong>normal code</strong>?? but you opened a comment twice?</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/-/--/-/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>this is an <strong>error</strong>! huh?!</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/--/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>this is still a <strong>comment</strong> / <strong>error</strong> as an unterminated multiline comment - this explains what happens in the above two. the first three characters are parsed as the docstring marker. however, the way this parsing is done <strong>doesn't backtrack</strong> - so for the case of <code>/-/-/</code>, the second <code>/</code> is actually eaten, and so the comment parser effectively sees <code>/-|-/</code> (where the bar implies they're two separate tokens) and so this would be a valid comment.</p>\n</div></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>/- /--/ -/\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Answer</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>this is <strong>normal code</strong>. the inner parser for comments within comments does not eat the third character as above, because it's of course implemented separately ;)</p>\n</div></div>\n<p>curious what scores people get!</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>some further comments</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>There's also some special handling for <code>/-!</code>, module docstrings, but I don't think you can do anything that fun with them that's not covered by the existing <code>/--</code> handler.</p>\n<p>I think these last few examples lead to very odd syntax formatting in editors - not sure this \"eating\" behaviour has been written into these</p>\n</div></div>",
        "id": 565441468,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1766754167
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>about nesting</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p><span class=\"user-mention silent\" data-user-id=\"284160\">Eric Rodriguez</span> <a href=\"#narrow/channel/113488-general/topic/comment.20parser.20quiz/near/565441468\">said</a>:</p>\n<blockquote>\n<p>Lean is the only language I know that supports nested multiline comments.</p>\n</blockquote>\n<p>Rust &amp; Haskell &amp; Kotlin &amp; Typst also support it.</p>\n<p>I think most relatively-new languages support nesting, though interestingly Zig has no multiline comments at all.</p>\n</div></div>",
        "id": 565450672,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766762046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/113488-general/topic/comment.20parser.20quiz/near/565450672\">said</a>:</p>\n<blockquote>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>about nesting</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p><span class=\"user-mention silent\" data-user-id=\"284160\">Eric Rodriguez</span> <a href=\"#narrow/channel/113488-general/topic/comment.20parser.20quiz/near/565441468\">said</a>:</p>\n<blockquote>\n<p>Lean is the only language I know that supports nested multiline comments.</p>\n</blockquote>\n<p>Rust &amp; Haskell &amp; Kotlin &amp; Typst also support it.</p>\n<p>I think most relatively-new languages support nesting, though interestingly Zig has no multiline comments at all.</p>\n<p></div></div><br>\n</p>\n</blockquote>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>hmm, that's interesting - I have been learning Rust lately for fun and not realised this! i wonder if this is due to the advent of LSP-based \"comment out\" features, that make it nice to not have such issues. in that case, I guess this could be a considered a bug report - \"comment out\" on \"/-/-/\" would give you a syntax error. although this is probably an unsolvable problem in general - see <a href=\"https://www.reddit.com/r/rust/comments/dshfiy/nested_comments_are_a_lie/\">https://www.reddit.com/r/rust/comments/dshfiy/nested_comments_are_a_lie/</a>. AFAIR Lean's (complicated!) string parser does not run within the comment parser.</p>\n</div></div>",
        "id": 565456518,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1766767259
    },
    {
        "content": "<p>Got the first six right and was lost on the last four</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>Nested multi line comments are the best, imho</p>\n</div></div>",
        "id": 565462615,
        "sender_full_name": "Rob Simmons",
        "timestamp": 1766773179
    }
]