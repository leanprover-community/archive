[
    {
        "content": "<p>Is the new module behaviour documented somewhere ?</p>",
        "id": 546929618,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761321203
    },
    {
        "content": "<p><a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/546929618\">A message</a> was moved here from <a class=\"stream-topic\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce/topic/releases.20of.20new.20Lean.20versions/with/546645674\">#announce &gt; releases of new Lean versions</a> by <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span>.</p>",
        "id": 546934416,
        "sender_full_name": "Notification Bot",
        "timestamp": 1761322493
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">Alfredo Moreira-Rosa</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/546929618\">said</a>:</p>\n<blockquote>\n<p>Is the new module behaviour documented somewhere ?</p>\n</blockquote>\n<p>Yes, see <a href=\"https://lean-lang.org/doc/reference/latest/The-Module-System\">https://lean-lang.org/doc/reference/latest/The-Module-System</a>! This is a first documentation draft, now that the system is accessible to users, we will rapidly improve it. So do ask questions.</p>",
        "id": 547007679,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761345443
    },
    {
        "content": "<p>I'm not actually sure how to enable the module system. I know we have to put <code>experimental.module</code> in the lakefile, but I am not actually super familiar with how to use lake so I don't really know what that means.</p>",
        "id": 547076468,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761418791
    },
    {
        "content": "<p>Actually nevermind, I just found the lakefile for Std and basically we just add <code>leanOptions = { experimental.module = true }</code> to the lakefile below the \"defaultTargets\" line.</p>",
        "id": 547076615,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761418939
    },
    {
        "content": "<p>And add <code>module</code> to the start of the file?</p>",
        "id": 547077099,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761419541
    },
    {
        "content": "<p>I have two questions about the semantics of the module system:</p>\n<ul>\n<li>Suppose that B imports A and that B declares a private variable <code>def foo : Nat := 5</code>, for internal use exclusively. But then A later adds a <code>public def foo : String := \"bar\"</code>. This seems to break B. Essentially, every time A declares a file in the root namespace, it has the potential to break backwards compatibility. I think the solution is to have A place everything in a namespace. Is this ideal?</li>\n<li>In my opinion, the structure of required imports is part of the public interface of a library. If <code>foo</code> is defined in <code>MyLib.Alpha.Foo</code>, then moving it to <code>MyLib.Beta.Foo</code> is a breaking change. And if <code>MyLib.Alpha.Foo</code> depends on <code>MyLib.Gamma.Bar</code>, which exposes a constant <code>bar</code>, a downstream library might import <code>MyLib.Alpha.Foo</code> and just assume that this means <code>bar</code> is now accessible as well. But then if MyLib removes the dependency of <code>MyLib.Alpha.Foo</code> on <code>MyLib.Gamma.Bar</code>, it could break the downstream library. Since imports must still be acyclic, I think this means that any large library will be constantly moving constants around between modules or at least changing the import graph as needed. Is there a way to allow these sorts of changes without potentially breaking downstream code?</li>\n</ul>",
        "id": 547078017,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761420726
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547078017\">said</a>:</p>\n<blockquote>\n<p>I think the solution is to have A place everything in a namespace.</p>\n</blockquote>\n<p>Yes, this has always been the case and your scenario appears to apply even before the module system.</p>\n<blockquote>\n<p>Is there a way to allow these sorts of changes without potentially breaking downstream code?</p>\n</blockquote>\n<p>No - removing a (public) import is a breaking change, this too has always been the case and should not be done without consideration. What is new is being able to demote an import to a private import, which likewise is a breaking change. I'm not sure I would agree that acyclicity of the import graph is a major driving factor in moving declarations in general. I think what we will see is that libraries will commit to one big breaking change when they reconsider what imports should stay public and after that the ability to use private imports will lead to a public import graph that is more stable than before, not less.</p>",
        "id": 547081904,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761425386
    },
    {
        "content": "<p>Wait, let's say that the FLT project becomes sorry-free and there ends up being a single file called FLT.lean which has a single theorem for Fermat's Last Theorem. Also suppose mathlib has migrated to the module system. The private imports for that file would be enormous, but what would be the minimum possible public imports? Could you set up the file so that the public imports include hardly anything at all from Mathlib?</p>",
        "id": 547086574,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761431792
    },
    {
        "content": "<p>You don't need any public Mathlib imports at all to state FLT. Well, one if you want to go Semiring.</p>",
        "id": 547086894,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761432357
    },
    {
        "content": "<p>So in the most extreme case (not saying this is a good idea), mathlib could potentially be split into <code>MathlibDefs</code> and <code>MathlibTheorems</code> folders, where <code>MathlibDefs</code> contains every single public definition in mathlib and no public theorems, and doesn't publically import anything from <code>MathlibTheorems</code>, and no two files in <code>MathlibTheorems</code> publically import each other? And then the import graph of <code>MathlibDefs</code> would be very sparse, so we could for example have <code>Mathlib.Data.Real.Basic</code> have very few public imports (so it wouldn't need to publically import the rationals in any way)?</p>",
        "id": 547087424,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761433239
    },
    {
        "content": "<p>I believe that separation already exists to a good degree specifically through the <code>Basic</code> files even before anyone was thinking about the module system? So instead of a complete reorganization, refining the existing splits, e.g. moving out even defs such as <code>Real.equivCauchy</code> that leak the implementation, should be sufficient here.</p>",
        "id": 547120822,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761475669
    },
    {
        "content": "<p>Except that in Mathlib the split is mostly via <code>Defs</code> files rather than <code>Basic</code> files (which is the convention in the <code>lean4</code> repo).</p>",
        "id": 547172611,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761527179
    },
    {
        "content": "<p>We put quite a lot of effort into extending the \"spine\" of \"<code>Defs</code> files only import other <code>Defs</code> files\" as far as possible over the last year or two, and hopefully this will really start to provide some pay-offs with the module system.</p>\n<p>If anyone would like to put effort into refactoring more definitions in mathlib onto this spine that would be appreciated and helpful!</p>",
        "id": 547172709,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761527254
    },
    {
        "content": "<p>Just wanted to flag one sad consequence of this approach, which is that whenever you want to see the basic API for definition X, jumping to definition and then reading the next 50 lines of code doesn't work :-( This was a strategy which was very effective before we made this defs/basic split.</p>",
        "id": 547192584,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761543636
    },
    {
        "content": "<p>What exactly is the synergy between the spine of <code>Defs</code> approach and the module system? I can see how this would let Mathlib have a public api which is essentially just definitions, but I don't know if this actually makes development of mathlib easier because we still have to keep track of the private import chain so that we can avoid cycles, so it doesn't actually give any more flexibility in how mathlib's imports are structured.</p>",
        "id": 547195555,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761545420
    },
    {
        "content": "<p>In more generality, suppose that in Mathlib we want to refactor <code>A.lean</code> to depend on <code>B.lean</code>, which has no public imports. But <code>B.lean</code> privately imports something which privately imports <code>A.lean</code>. Then this refactor will be invalid because it will create a cycle of private imports, even though there is no cycle of public imports. So in some sense, the fact that <code>B.lean</code> <em>privately</em> depends on <code>A.lean</code> is part of <code>B.lean</code>'s <em>public</em> interface within Mathlib. (Once we get to a package outside of Mathlib, then <code>B.lean</code>'s private dependency on <code>A.lean</code> is no longer part of <code>B.lean</code>'s public interface, because it can't affect anything).</p>",
        "id": 547196669,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761546001
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547192584\">said</a>:</p>\n<blockquote>\n<p>Just wanted to flag one sad consequence of this approach, which is that whenever you want to see the basic API for definition X, jumping to definition and then reading the next 50 lines of code doesn't work :-( This was a strategy which was very effective before we made this defs/basic split.</p>\n</blockquote>\n<p>well now I suppose there's the approach of clicking the definition and then going to the file name in the explorer and changing it from <code>Defs</code> to <code>Basic</code></p>",
        "id": 547230949,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761558164
    },
    {
        "content": "<p>And sometimes it's not in there! Because the definition was moved from a file other than Basic, because, well, it was a definition.</p>\n<p>It's also not immediately obvious how to solve this with search, because at this point you don't know the names of the API lemmas. But of course you can muddle through in the end.</p>",
        "id": 547239710,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761560790
    },
    {
        "content": "<p>I do rely on Loogle a lot</p>",
        "id": 547240856,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761561113
    },
    {
        "content": "<p>Yes maybe that's the answer to this one.</p>",
        "id": 547253828,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761564923
    },
    {
        "content": "<p>My standard workflow for discovering files is also to use loogle. I've had the thought previously that listing all the files by number of occurrences might be a nice feature. (I assume this is easy since each result already lists the file.)</p>",
        "id": 547265807,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761568576
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547195555\">said</a>:</p>\n<blockquote>\n<p>What exactly is the synergy between the spine of <code>Defs</code> approach and the module system? I can see how this would let Mathlib have a public api which is essentially just definitions, but I don't know if this actually makes development of mathlib easier because we still have to keep track of the private import chain so that we can avoid cycles, so it doesn't actually give any more flexibility in how mathlib's imports are structured.</p>\n</blockquote>\n<p>In general, minimizing the dependency closure of a module minimizes both the cases in which the module has to be rebuilt as well as the amount of data that has to be fetched and stored to work on the module.</p>",
        "id": 547328180,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761583887
    },
    {
        "content": "<p>Ah I see, that makes sense. I was mainly thinking about the semantic advantages of modules, but I hadn't considered that there might be major performance benefits as well.</p>",
        "id": 547376393,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761601407
    },
    {
        "content": "<p>I have a more basic question that I've asked several times before but still don't understand the answer to (apologies to those who have tried to explain).</p>\n<p>I'm running a <a href=\"https://github.com/emilyriehl/infinity-cosmos\">Lean project</a> using the Lean blueprint infrastructure.</p>\n<ol>\n<li>How do I keep the local copy of mathlib relatively up to date?</li>\n<li>If I want to immediately import the latest mathlib, how do I do this?</li>\n</ol>",
        "id": 547762986,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761755418
    },
    {
        "content": "<p>I've tried various things this morning that I can describe but they haven't yet succeeded in updating the files I want (the result of a PR that was merged overnight). What has happened is now <code>lake build</code> fails will a bunch of errors involving Batteries.something that I don't understand.</p>",
        "id": 547763401,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761755516
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/oZMkhagrbJxUdg0NSUEeUiCv/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/oZMkhagrbJxUdg0NSUEeUiCv/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"658x550\" src=\"/user_uploads/thumbnail/3121/oZMkhagrbJxUdg0NSUEeUiCv/image.png/840x560.webp\"></a></div>",
        "id": 547763527,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761755537
    },
    {
        "content": "<p>This looks like you're in vscode. How do you make those menus appear?</p>",
        "id": 547764006,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761755668
    },
    {
        "content": "<p>Clicking on the forall symbol at the top</p>",
        "id": 547764119,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1761755698
    },
    {
        "content": "<p>I also had these batteries errors recently when mathlib was updated to the last version of lean. The problem was that one of the dependencies had not been updated to the latest lean.</p>",
        "id": 547764422,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1761755778
    },
    {
        "content": "<p>This seems to fail:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Cannot</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">dependency</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"n\">output</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"w\"> </span><span class=\"n\">post</span><span class=\"bp\">-</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">hooks</span><span class=\"w\"> </span><span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">19</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span><span class=\"w\"> </span><span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.Pos</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">29</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span><span class=\"w\"> </span><span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.atEnd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">30</span><span class=\"o\">:</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span><span class=\"w\"> </span><span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.get</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">31</span><span class=\"o\">:</span><span class=\"mi\">29</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 547764720,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761755859
    },
    {
        "content": "<p><a href=\"#narrow/channel/113488-general/topic/Can't.20update.20BrownianMotion.20project/with/547109126\">https://leanprover.zulipchat.com/#narrow/channel/113488-general/topic/Can't.20update.20BrownianMotion.20project/with/547109126</a></p>",
        "id": 547764736,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1761755862
    },
    {
        "content": "<p>I disagree that relying on Loogle is a good approach. \"Go to definition\" is too basic to depend on a project being hosted somewhere else. This is the kind of devex feature that's expected to work entirely on local files.</p>",
        "id": 547770541,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761757598
    },
    {
        "content": "<p>Limited/broken GTD was my main heart break with Haskell. Lean's GTD as of v4.23 is amazing (as good as Rust's!). Please don't nerf it <span aria-label=\"tear\" class=\"emoji emoji-1f972\" role=\"img\" title=\"tear\">:tear:</span></p>",
        "id": 547771051,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761757768
    },
    {
        "content": "<p>I am a bit confused by what Arthur is talking about, but I also saw this weird batteries error recently. </p>\n<p>When I bump a game I do this:<br>\n1) <code>git checkout -b bump-mathlib</code><br>\n2) <code>lake update</code> or <code>lake update mathlib</code> (should both do the same as the VS Code point and click solution above)<br>\n3) <code>lake exe cache get</code><br>\n4) <code>lake build</code> and expect only to see errors in my local files because of changes in mathlib which broke stuff. If I see errors in batteries then something has gone wrong and my gut feeling is that it's not my fault.<br>\n5) fix build, commit all changed files to the branch (which will be all the local lean files that broke, <code>lake-manifest.json</code> (if that didn't change then you didn't bump at all) and sometimes <code>lean-toolchain</code> (depending on whether the version of core lean that mathlib was using has changed since you last bumped; this changes once or twice a month)  and then commit, push, check CI passes on github, and then merge.</p>",
        "id": 547774179,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761758677
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547774179\">said</a>:</p>\n<blockquote>\n<p>I am a bit confused by what Arthur is talking about</p>\n</blockquote>\n<p>From your message <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547192584\">above</a> I understood that the \"Go to definition\" feature would no longer take you to the definition right away. That's what I'm talking about</p>",
        "id": 547774702,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761758836
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> I can confirm that I cloned your repo <a href=\"https://github.com/emilyriehl/infinity-cosmos\">https://github.com/emilyriehl/infinity-cosmos</a>, tried what I suggested, and got the same error as you.</p>",
        "id": 547775007,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761758931
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>...\ninfo: batteries: cloning https://github.com/leanprover-community/batteries\ninfo: batteries: checking out revision '8da40b72fece29b7d3fe3d768bac4c8910ce9bee'\ninfo: mathlib: running post-update hooks\n⚠ [7/20] Built Batteries.Data.String.Basic\nwarning: Batteries/Data/String/Basic.lean:28:12: `String.Pos` has been deprecated: Use `String.Pos.Raw` instead\n\nNote: The updated constant is in a different namespace. Dot notation may need to be changed (e.g., from `x.Pos` to `Pos.Raw x`).\nwarning: Batteries/Data/String/Basic.lean:29:11: `String.atEnd` has been deprecated: Use `String.Pos.Raw.atEnd` instead\n\nNote: The updated constant is in a different namespace. Dot notation may need to be changed (e.g., from `x.atEnd` to `Pos.Raw.atEnd x`).\nwarning: Batteries/Data/String/Basic.lean:30:13: `String.get` has been deprecated: Use `String.Pos.Raw.get` instead\n\nNote: The updated constant is in a different namespace. Dot notation may need to be changed (e.g., from `x.get` to `Pos.Raw.get x`).\nwarning: Batteries/Data/String/Basic.lean:31:29: `String.next` has been deprecated: Use `String.Pos.Raw.next` instead\n\nNote: The updated constant is in a different namespace. Dot notation may need to be changed (e.g., from `x.next` to `Pos.Raw.next x`).\nwarning: Batteries/Data/String/Basic.lean:34:10: `String.next` has been deprecated: Use `String.Pos.Raw.next` instead\n\nNote: The updated constant is in a different namespace. Dot notation may need to be changed (e.g., from `x.next` to `Pos.Raw.next x`).\n✖ [9/20] Building Batteries.Data.Array.Match\ntrace: .&gt; LEAN_PATH=/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/Qq/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/aesop/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/proofwidgets/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/importGraph/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/LeanSearchClient/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/plausible/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/MD4Lean/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/BibtexQuery/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/UnicodeBasic/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/Cli/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/mathlib/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/checkdecls/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/doc-gen4/.lake/build/lib/lean:/media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/build/lib/lean /home/buzzard/.elan/toolchains/leanprover--lean4---v4.25.0-rc2/bin/lean /media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/Batteries/Data/Array/Match.lean -o /media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/.lake/build/lib/lean/Batteries/Data/Array/Match.olean -i /media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/.lake/build/lib/lean/Batteries/Data/Array/Match.ilean -c /media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/.lake/build/ir/Batteries/Data/Array/Match.c --setup /media/buzzard/ExternalSSD1TB/lean-projects/infinity-cosmos/.lake/packages/batteries/.lake/build/ir/Batteries/Data/Array/Match.setup.json --json\n...\n</code></pre></div>",
        "id": 547775217,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761758991
    },
    {
        "content": "<p>I am not sure I understand this stuff any better than you do, but deleting <code>.lake</code> and trying <code>lake exe cache get</code> does not fix it. The error I get after doing that is the same. After <code>lake update</code> my <code>lakefile.toml</code> has</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.24.0\"</span>\n</code></pre></div>\n<p>and my <code>lean-toolchain</code> has <code>leanprover/lean4:v4.25.0-rc2</code>.</p>",
        "id": 547776602,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761759405
    },
    {
        "content": "<p>That's odd. By the way, note that you have the <code>rev</code> key set for mathlib in your lakefile.toml, so <code>lake update</code> will not give you a more recent version</p>",
        "id": 547776688,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761759426
    },
    {
        "content": "<p>Somehow it's comments like this that exactly show the kind of problems which Emily and I face. I have no idea what this whole \"rev\" thing is, what the syntax of <code>lakefile.toml</code> is, I never touch this file myself, all that happens in practice with FLT is that people like Pietro occasionally make PRs called \"bump mathlib\" and I merge them, and then sometimes I type <code>lake update</code> and it works and then I bump mathlib myself. If you are suggesting that to make progress we are supposed to be editing system files which we don't understand then I would suggest that something is wrong with our set-up.</p>",
        "id": 547777115,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761759555
    },
    {
        "content": "<p>What was the output of <code>lake update</code>?</p>",
        "id": 547777141,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761759562
    },
    {
        "content": "<p>This was the first thing I typed after cloning the repo and creating a bump branch. The output up until to the first error was</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">buzzard</span><span class=\"bp\">@</span><span class=\"n\">brutus</span><span class=\"o\">:</span><span class=\"bp\">~/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">projects</span><span class=\"bp\">/</span><span class=\"n\">infinity</span><span class=\"bp\">-</span><span class=\"n\">cosmos</span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">gen4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">gen4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">-</span><span class=\"n\">gen4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">1</span><span class=\"n\">cd7a1113090e216703e323e8fdcdf099f0a9c8a'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checkdecls</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">PatrickMassot</span><span class=\"bp\">/</span><span class=\"n\">checkdecls</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">f897ebcf72cd16f89ab4577d0c826cd14afaafc7'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">cli</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">91</span><span class=\"n\">c18fa62838ad0ab7384c03c9684d99d306e1da'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">fgdorais</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">unicode</span><span class=\"bp\">-</span><span class=\"n\">basic</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">e5aaa4949aad9a866aead1da5d5619e8decc8da7'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BibtexQuery</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">dupuisf</span><span class=\"bp\">/</span><span class=\"n\">BibtexQuery</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BibtexQuery</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">1</span><span class=\"n\">b05159ad44f220cec7489e65e6bc4b1e178b67f'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MD4Lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">acmepjz</span><span class=\"bp\">/</span><span class=\"n\">md4lean</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MD4Lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">66</span><span class=\"n\">aefec2852d3e229517694e642659f316576591'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">plausible</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">dfd06ebfe8d0e8fa7faba9cb5e5a2e74e7bd2805'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchClient</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">99657</span><span class=\"n\">ad92e23804e279f77ea6dbdeebaa1317b98'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">importGraph</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"kn\">import</span><span class=\"bp\">-</span><span class=\"n\">graph</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">importGraph</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">d768126816be17600904726ca7976b185786e6b9'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">556</span><span class=\"n\">caed0eadb7901e068131d1be208dd907d07a2'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">aesop</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">725</span><span class=\"n\">ac8cd67acd70a7beaf47c3725e23484c1ef50'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">quote4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">dea6a3361fa36d5a13f87333dc506ada582e025c'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">batteries</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">8</span><span class=\"n\">da40b72fece29b7d3fe3d768bac4c8910ce9bee'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"w\"> </span><span class=\"n\">post</span><span class=\"bp\">-</span><span class=\"n\">update</span><span class=\"w\"> </span><span class=\"n\">hooks</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">7</span><span class=\"bp\">/</span><span class=\"mi\">20</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Built</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.Pos</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">29</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.atEnd</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.atEnd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">30</span><span class=\"o\">:</span><span class=\"mi\">13</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.get</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">31</span><span class=\"o\">:</span><span class=\"mi\">29</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.next</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">String</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">34</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"kn\">namespace</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Dot</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"ss\">`x.next</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"ss\">`Pos.Raw.next</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">`</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">9</span><span class=\"bp\">/</span><span class=\"mi\">20</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">Match</span>\n</code></pre></div>",
        "id": 547777472,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761759652
    },
    {
        "content": "<p>The lakefile is a list of dependencies for your project, and you can add some key-value pairs for each dependency</p>",
        "id": 547777606,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761759694
    },
    {
        "content": "<p>One of them is <code>rev</code>, which you can use to make <code>lake update</code> stick to that particular revision of the dependency, rather than the most recent version</p>",
        "id": 547777867,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761759793
    },
    {
        "content": "<p>I'll try to have a look when I'm not on mobile later</p>",
        "id": 547777976,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761759840
    },
    {
        "content": "<p>I mean in some sense I know everything you just said, but what I don't know is what the file is supposed to look like in order for me to never have to care about it ever again.</p>",
        "id": 547778137,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761759897
    },
    {
        "content": "<p>Or is \"edit your <code>lakefile.toml</code>\" actually supposed to be a part of the bump-mathlib workflow? (it wasn't part of the workflow I posted above, which I'm sure I've had some success with).</p>",
        "id": 547778238,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761759931
    },
    {
        "content": "<p>FLT right now says </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.25.0-rc1\"</span>\n</code></pre></div>\n<p>Is that wrong? Or right-but-I-am-doomed-to-failure-if-I-bump-rather-than-Pietro?</p>",
        "id": 547778572,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761760043
    },
    {
        "content": "<p>I have manually edited the <code>lakefile.toml</code> so that both <code>mathlib</code> and <code>doc-gen</code> both say <code>rev = \"v4.25.0-rc2\"</code> and now things have got much further.</p>",
        "id": 547779447,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761760275
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> PR incoming <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/143\">https://github.com/emilyriehl/infinity-cosmos/pull/143</a></p>",
        "id": 547780280,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761760524
    },
    {
        "content": "<p>One funny thing about the current <code>main</code> branch of <code>infinity-cosmos</code> is that <code>lean-toolchain</code> says <code>leanprover/lean4:v4.25.0-rc2</code> but <code>lakefile.toml</code> has mathlib's <code>rev</code> as <code>v4.24.0</code>. Maybe this is the cause of the frustration?</p>",
        "id": 547781047,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761760785
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547778572\">said</a>:</p>\n<blockquote>\n<p>Is that wrong? Or right-but-I-am-doomed-to-failure-if-I-bump-rather-than-Pietro?</p>\n</blockquote>\n<p>I think the answer is more nuanced. I'd say \"there's no guarantee of success\". A Lean dependency carries all of its transitive dependencies with it. Each isolated lib might be tested to build with its locally defined toolchain. But when you add a dependency, you're going to build it with the toolchain explicitly defined in your project.</p>\n<p>I forgot what Lake does in case of dependency clashes. I try my absolute best to avoid those. And I <em>never</em> run <code>lake update</code>. Every dependency bump I do is meticulously examined.</p>",
        "id": 547781277,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761760859
    },
    {
        "content": "<p>Oh but Arthur, all the maths projects just depend on mathlib and nothing else, so we should never get dependency clashes.</p>",
        "id": 547781379,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761760895
    },
    {
        "content": "<p>Am I right in thinking that this PR here</p>\n<p><a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/142\">https://github.com/emilyriehl/infinity-cosmos/pull/142</a></p>\n<p>which was generated by <code>github-actions</code> (presumably a robot) seems to have changed <code>lean-toolchain</code> to <code>v4.25.0-rc2</code> but left the mathlib dependency in <code>lakefile.lean</code> on <code>v4.24.0</code>? Is that ultimately the cause of the confusion or have I misdiagnosed?</p>",
        "id": 547781844,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761761024
    },
    {
        "content": "<p>And mathlib has its own dependencies. When you bump mathlib, you need to make sure it and all its transitive dependencies actually build with your local toolchain. To be safe, I think it's better to just stick with the toolchain of your mathlib dependency.</p>",
        "id": 547781911,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761761045
    },
    {
        "content": "<p>Right -- that's exactly what I do with FLT -- every bump is to the most recent commit of mathlib and to whichever version of Lean (and of everything else) that mathlib is using at that time. That's the only thing I ever want to happen. Which is why I'm really hoping it should always be easy.</p>",
        "id": 547782127,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761761114
    },
    {
        "content": "<p>Does it sound plausible that Emily was sabotaged by a machine with <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/142\">https://github.com/emilyriehl/infinity-cosmos/pull/142</a> ?</p>",
        "id": 547783512,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761761520
    },
    {
        "content": "<p>but you said you tried to bump it independently and got the same error</p>",
        "id": 547784117,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761761701
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547783512\">said</a>:</p>\n<blockquote>\n<p>Does it sound plausible that Emily was sabotaged by a machine with <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/142\">https://github.com/emilyriehl/infinity-cosmos/pull/142</a> ?</p>\n</blockquote>\n<p>It's possible, yes. Looking at the <a href=\"https://github.com/emilyriehl/infinity-cosmos/blob/main/lakefile.toml\">dependencies</a>, some are still on v4.24. The PR bumps the toolchain to v4.25 with seemingly no CI job to check that it builds</p>",
        "id": 547784409,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761761803
    },
    {
        "content": "<p>The automation that created the PR is <a href=\"https://github.com/emilyriehl/infinity-cosmos/blob/main/.github/workflows/update.yml\">here</a>; it uses <a href=\"https://github.com/leanprover-community/mathlib-update-action\">leanprover-community/mathlib-update-action</a>, so maybe something can be improved there? cc: <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> </p>\n<p>I hinted at this in a comment on the PR, but I think for CI to run automatically on those PRs, Emily would have to set up a <a href=\"https://github.com/leanprover-community/mathlib-update-action?tab=readme-ov-file#token\">github token</a>. However, it looks like Emily's repo was created from <a href=\"https://github.com/pitmonticone/LeanProject\">the pitmonticone/LeanProject template</a>, which doesn't mention that (yet), so it's understandable that she didn't know about this (and quite honestly, we should try to improve things here so that after setting things up once she doesn't have to worry about these sorts of details anymore).</p>",
        "id": 547785759,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1761762278
    },
    {
        "content": "<p>The action that creates the PRs first runs a <code>lake build</code> on the modified files (you can see that in the <a href=\"https://github.com/emilyriehl/infinity-cosmos/actions/runs/18709958440/job/53356513410\">logs here</a>). So even though no official green checkmark appears on the PR, it has still been tested.</p>",
        "id": 547788391,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761763092
    },
    {
        "content": "<p>Looking through those logs I see </p>\n<p><a href=\"/user_uploads/3121/ZXQvgOjOLddtsQ3nG3cXGKmr/Screenshot-from-2025-10-29-18-47-34.png\">Screenshot from 2025-10-29 18-47-34.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ZXQvgOjOLddtsQ3nG3cXGKmr/Screenshot-from-2025-10-29-18-47-34.png\" title=\"Screenshot from 2025-10-29 18-47-34.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1029x297\" src=\"/user_uploads/thumbnail/3121/ZXQvgOjOLddtsQ3nG3cXGKmr/Screenshot-from-2025-10-29-18-47-34.png/840x560.webp\"></a></div><p>and mathlib commit <code>d9d1cc1012eccfc8d01215b1b7943b0e7f8b7757</code> is on <code>v4.25.0-rc2</code>. So is it the case that the action checked out a mathlib on <code>v4.25.0-rc2</code>, checked that Emily's repo compiled with it, and then made the PR but neglected to edit <code>lakefile.lean</code> thus leaving the repo itself on mathlib <code>v4.24.0</code>?</p>",
        "id": 547790288,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761763749
    },
    {
        "content": "<p>There are two ways you can update your dependencies:</p>\n<ul>\n<li>You just want the freshest commits. In your lakefile.toml you write a branch name, like <code>rev = \"master\"</code>. To update, you run <code>lake update</code> and get to use all the new contributions to Mathlib right now.</li>\n<li>You want to carefully manage your compatibility with specific versions. In your lakefile.toml you write a tag name, like <code>rev = \"v4.24.0</code>. To update, you modify lakefile.toml to say <code>rev = \"v4.25.0-rc2\"</code>, then run <code>lake update</code>, and you get that specific version.</li>\n</ul>\n<p>The mathlib-update-action, by default, assumes you want to follow the first approach.</p>",
        "id": 547790305,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761763757
    },
    {
        "content": "<p>So my advice for using <code>mathlib-update-action</code> would be: do not touch the <code>rev</code> field in your lakefiles, leave it set to <code>rev = \"master\"</code> and let the machine take care of which updates to apply. <span aria-label=\"robot\" class=\"emoji emoji-1f916\" role=\"img\" title=\"robot\">:robot:</span></p>",
        "id": 547790624,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761763858
    },
    {
        "content": "<p>So for FLT I should change my <code>lakefile.lean</code> to <code>rev = \"master\"</code> and then complain if anybody ever changes this to something else?</p>\n<p>It seems to me that Emily is in a more delicate situation because she is depending on both Mathlib and doc-gen, although I don't really know why infinity-cosmos is any different to FLT.</p>",
        "id": 547790660,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761763869
    },
    {
        "content": "<p>Regardless of this advice, <code>mathlib-update-action</code> should absolutely detect when a situation like this occurs and complain. (Unfortunately it is hard to decide whether <code>rev = \"v4.24.0\"</code> is deliberate or a remnant of a manual update. So we'll have to assume that such a situation means to not upgrade at all, I suppose.)</p>",
        "id": 547791361,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761764096
    },
    {
        "content": "<p>Since infinity-cosmos now runs with <code>docgen-action</code>, I suspect we don't actually need to depend on a specific doc-gen revision anymore: the action contains some logic to figure out which doc-gen version is compatible with the current version of Lean.</p>",
        "id": 547792896,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761764623
    },
    {
        "content": "<p>I'm looking at the history of the <code>lakefile.lean</code> in FLT. I see that at times I even just have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n</code></pre></div>\n<p>with no <code>rev</code> at all! In fact looking through recent history I see bumps made by people who just seem to be randomly changing the convention from <code>rev = \"master\"</code> to <code>rev = \"v4.whatever\"</code> to no <code>rev</code> at all.</p>",
        "id": 547792918,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761764631
    },
    {
        "content": "<p>(Removing <code>doc-gen</code> from the Lakefile is not a solution on a larger scale, unfortunately. We'll need to come up with a good versioning scheme across the community, or else suffer through every single Lean package making its own GitHub action to do updates in their preferred way...)</p>",
        "id": 547793055,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761764683
    },
    {
        "content": "<p>Because I had no real understanding of what was <em>supposed</em> to be happening, I have just let people or machines change the conventions back and forth. My understanding going forwards is that I should stick to <code>rev = \"master\"</code> and complain if anyone tries to change it.</p>",
        "id": 547793234,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761764730
    },
    {
        "content": "<p>Thanks for the advice Anne and everyone else! I had never really known what I should be doing here.</p>",
        "id": 547793305,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761764761
    },
    {
        "content": "<p>And from my side, apologies for the mess you find yourself in! <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 547793727,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761764904
    },
    {
        "content": "<p>Aah but there is one dangling question left: what should Emily's <code>lakefile.toml</code> look like?</p>",
        "id": 547793762,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761764918
    },
    {
        "content": "<p>Right now it has two non-master revs:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>name = \"InfinityCosmos\"\ndefaultTargets = [\"InfinityCosmos\"]\n\n[leanOptions]\npp.unicode.fun = true\nautoImplicit = false\nrelaxedAutoImplicit = false\n\n[[require]]\nname = \"mathlib\"\ngit = \"https://github.com/leanprover-community/mathlib4.git\"\nrev = \"v4.25.0-rc2\"\n\n[[require]]\nname = \"checkdecls\"\ngit = \"https://github.com/PatrickMassot/checkdecls.git\"\n\n[[require]]\nname = \"«doc-gen4»\"\ngit = \"https://github.com/leanprover/doc-gen4\"\nrev = \"v4.25.0-rc2\"\n\n[[lean_lib]]\nname = \"InfinityCosmos\"\n</code></pre></div>",
        "id": 547793855,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761764949
    },
    {
        "content": "<p>(oh sorry, that's my PR; right now it has two <code>rev = \"v4.24.0\"</code>s</p>",
        "id": 547794031,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761765010
    },
    {
        "content": "<p>I am concerned about doc-gen4 and mathlib using two different versions of lean at the moment a machine bumps.</p>",
        "id": 547794149,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761765044
    },
    {
        "content": "<p>On my side i don't put any rev, and by default it takes whatever is the master branch in any dependencies.</p>",
        "id": 547794285,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761765081
    },
    {
        "content": "<p>And I am assuming that if you have more than one dependency then you're running a risk here.</p>",
        "id": 547794389,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761765121
    },
    {
        "content": "<p>I was about to make a PR to change the lakefile.toml, one moment please :)</p>",
        "id": 547794593,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761765197
    },
    {
        "content": "<p>If your project depends on projects A and B, and both depend on Mathlib, then you have a problem, since there is no guaranteed way to update to a version of A and B that use the same version of Mathlib... This needs a social solution, not a technical one unfortunately!</p>",
        "id": 547794867,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761765294
    },
    {
        "content": "<p>Yeah, but the social solution is the v4.X tags</p>",
        "id": 547794960,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761765328
    },
    {
        "content": "<p>It is certainly part of a solution! Issue is, many projects don't want to wait a month for Mathlib updates.</p>",
        "id": 547795158,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761765403
    },
    {
        "content": "<p>Also most projects don't have diamond dependencies on mathlib. I guess right now you need to pick one of the two :)</p>",
        "id": 547795549,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761765544
    },
    {
        "content": "<p>Thanks all for looking into this for me. I'm still very confused though!</p>\n<ol>\n<li>Could you summarize how I should be configuring these files and what I should be doing in the future?</li>\n<li>Kevin's PR unfortunately broke the blueprint with a very weird <a href=\"https://github.com/emilyriehl/infinity-cosmos/actions/runs/18918942536/job/54009640634\">error message</a>. It seems to be referring to some stuff I was doing locally in trying to reset up a virtual environment so i could reinstall the leanblueprint command line tools. Or is something else going wrong?</li>\n<li>The reason I want to bump mathlib was to get the latest version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/AlgebraicTopology/SimplicialSet/NerveAdjunction.html\">this file</a>. It's still not there with Kevin's PR. Why not?</li>\n</ol>",
        "id": 547795594,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1761765567
    },
    {
        "content": "<p>Oh dear sorry!</p>",
        "id": 547796681,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761766002
    },
    {
        "content": "<ol>\n<li>If <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/144\">https://github.com/emilyriehl/infinity-cosmos/pull/144</a> builds, it should free you from versioning issues. <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span> You don't need to modify this file, you can run <code>lake update</code> whenever you want to and commit the resulting <code>lake-manifest.json</code> (or wait for the bot to do so for you).</li>\n<li>This seems to come from an update in Python, where the <a href=\"https://github.com/pypa/pip/pull/13602\">pip command removed an option</a>. Let me see if I can fix this for you before my family really get angry at me for not cooking dinner yet :)</li>\n<li>Kevin bumped Mathlib to <code>v4.25.0-rc2</code> which is the <em>first</em> version of Mathlib building under Lean version <code>v4.25.0-rc2</code>. After <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/144\">https://github.com/emilyriehl/infinity-cosmos/pull/144</a> is merged, a simple <code>lake update</code> should give you the latest version of the file.</li>\n</ol>",
        "id": 547796735,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761766023
    },
    {
        "content": "<p>Yes I see the error I made; \"rev=v4.25.0-rc2\" is not what you want either in your lakefile.toml; I'm assuming you, like me, are often bumping mathlib because you want the new goodies which have just arrived. I think \"rev=master\" is what you and I both always want in our lakefile.toml's.</p>",
        "id": 547797296,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761766217
    },
    {
        "content": "<p>For 2: thankfully Bryan already fixed this in <code>docgen-action</code>, so updating that action should be enough: <a href=\"https://github.com/emilyriehl/infinity-cosmos/pull/145\">https://github.com/emilyriehl/infinity-cosmos/pull/145</a></p>",
        "id": 547797323,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1761766225
    },
    {
        "content": "<p>Aah -- I can think of a reason why I might want to change <code>lakefile.toml</code> to have <code>rev = \"v4.whatever\"</code> -- if I want to release versions of FLT corresponding to specific mathlib tags such as <code>v4.whatever</code>. This might help people downstream from me who are having version management issues. However I suspect that the number of people downstream from me is and will remain 0; if someone wants something from FLT then they should be arguing that that thing should be merged into mathlib rather than depending on FLT directly.</p>",
        "id": 547806765,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761770047
    },
    {
        "content": "<p>I think it is fine to use <code>master</code> during active development if that isn't too much churn for you, but I might suggest pinning a revision once a project is in a \"finished\" state so that updates past that are more structured.</p>",
        "id": 547809697,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761771142
    },
    {
        "content": "<p>Might take a while for FLT :)</p>",
        "id": 547811318,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761771742
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547790305\">said</a>:</p>\n<blockquote>\n<p>There are two ways you can update your dependencies:</p>\n<ul>\n<li>You just want the freshest commits. In your lakefile.toml you write a branch name, like <code>rev = \"master\"</code>. To update, you run <code>lake update</code> and get to use all the new contributions to Mathlib right now.</li>\n<li>You want to carefully manage your compatibility with specific versions. In your lakefile.toml you write a tag name, like <code>rev = \"v4.24.0</code>. To update, you modify lakefile.toml to say <code>rev = \"v4.25.0-rc2\"</code>, then run <code>lake update</code>, and you get that specific version.</li>\n</ul>\n<p>The mathlib-update-action, by default, assumes you want to follow the first approach.</p>\n</blockquote>\n<p>I think part of the problem is that projects ideally do both:</p>\n<ul>\n<li>stay on master to get the latest Mathlib updates</li>\n<li>once a month make a release against the \"stable\" Mathlib version (useful for downstream packages and this will show up in the reservoir).</li>\n</ul>\n<p>Ideally there should just be a <code>lake exe mk_release</code> (maybe with a <code>lake exe continue_release</code> after fixing all Lean errors) that creates the release on a branch, so that you don't have to ever touch <code>lakefile.toml</code> yourself.</p>",
        "id": 547911033,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1761824063
    },
    {
        "content": "<p>One could imagine a lake feature where you could update to a specific revision of a dependency regardless of the <code>rev</code> in the lakefile</p>",
        "id": 547915618,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1761825486
    },
    {
        "content": "<p>I like the idea of a new lake command! How about <code>lake exe mk_release --continue</code> for the second case?</p>",
        "id": 547923748,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1761827821
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547007679\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"942100\">Alfredo Moreira-Rosa</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/546929618\">said</a>:</p>\n<blockquote>\n<p>Is the new module behaviour documented somewhere ?</p>\n</blockquote>\n<p>Yes, see <a href=\"https://lean-lang.org/doc/reference/latest/The-Module-System\">https://lean-lang.org/doc/reference/latest/The-Module-System</a>! This is a first documentation draft, now that the system is accessible to users, we will rapidly improve it. So do ask questions.</p>\n</blockquote>\n<p>I have a few questions about the <code>meta</code> phase which I hope are useful to address in the documentation. :) I'm looking at this paragraph:</p>\n<blockquote>\n<p>A <code>meta</code> definition may access (and thus invoke) any <code>meta</code> or non-<code>meta</code> definition of the current module. For accessing imported definitions, the definition must either have been marked as <code>meta</code> when it was declared or the import must be marked as such (<code>meta import</code> when the accessing definition is in the private scope and <code>public meta import</code> otherwise).</p>\n</blockquote>\n<ol>\n<li>Does private/public scoping affect <code>meta</code> defs in the same way as it affects regular defs? I.e., the second half of the paragraph indicates that <code>meta</code> defs can itself still be either in the private or public scope, and imported defs which a new <code>meta</code> def invokes must be imported into the correct scope--but then it's a bit confusing that <code>meta</code> defs can access <em>any</em> definition in the current module, regardless of whether it's public or private. I.e. even a <code>public</code> <code>meta</code> def can use a private def from the current module in its body--is that right?</li>\n<li>Do <code>meta import</code> and <code>public meta import</code> still behave like <code>import</code> and <code>public import</code> as far as the use of non-meta imported defs in new non-meta defs is concerned? (As part of this, does <code>public meta import</code> still put imported public defs in the current module's public scope?)</li>\n<li>Just to confirm: do <code>meta import all</code> and <code>public meta import all</code> work as you'd expect (i.e. they additionally import private meta defs)?</li>\n</ol>",
        "id": 547992631,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761844431
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/547992631\">said</a>:</p>\n<blockquote>\n<ol>\n<li>I.e. even a <code>public</code> <code>meta</code> def can use a private def from the current module in its body--is that right?</li>\n</ol>\n</blockquote>\n<p>Yes, same as <code>public def</code> (unless annotated <code>@[expose]</code>). All <code>def</code> rules still apply to <code>meta def</code>.</p>\n<blockquote>\n<p>Do <code>meta import</code> and <code>public meta import</code> still behave like <code>import</code> and <code>public import</code> as far as the use of non-meta imported defs in new non-meta defs is concerned?</p>\n</blockquote>\n<p>I'm not sure I understand this question, if you use <code>meta import</code>, there are no \"non-meta imported\" defs from that by definition.</p>\n<blockquote>\n<p>(As part of this, does <code>public meta import</code> still put imported public defs in the current module's public scope?)</p>\n</blockquote>\n<p>Yes, they will be public and meta.</p>\n<blockquote>\n<p>Just to confirm: do <code>meta import all</code> and <code>public meta import all</code> work as you'd expect (i.e. they additionally import private meta defs)?</p>\n</blockquote>\n<p><code>meta import all</code> should. There is no <code>public meta import all</code> just like there is no <code>public import all</code>.</p>",
        "id": 548018090,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761852480
    },
    {
        "content": "<p>Thanks!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/548018090\">said</a>:</p>\n<blockquote>\n<p>Yes, same as <code>public def</code> (unless annotated <code>@[expose]</code>)</p>\n</blockquote>\n<p>Ah, right--still getting used to that. :)</p>\n<blockquote>\n<blockquote>\n<p>Do <code>meta import</code> and <code>public meta import</code> still behave like <code>import</code> and <code>public import</code> as far as the use of non-meta imported defs in new non-meta defs is concerned?</p>\n</blockquote>\n<p>I'm not sure I understand this question, if you use <code>meta import</code>, there are no \"non-meta imported\" defs from that by definition.</p>\n</blockquote>\n<p>Sorry, parenthesization ambiguity! I mean \"non-meta (imported defs)\", i.e. imported defs which were not marked meta when declared, and are now imported. (Though in this context, specifically such defs which have been imported by <code>meta import</code>). :) Going by the <code>public meta import</code> example, it seems the answer is yes!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/548018090\">said</a>:</p>\n<blockquote>\n<p><code>meta import all</code> should. There is no <code>public meta import all</code> just like there is no <code>public import all</code></p>\n</blockquote>\n<p>Oh? The documentation mentions <code>public import all</code> at the bottom of the visibility page! <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span>  Seems like it's treated mostly as syntactic sugar, though, not as a wholly new way to import. (Based on that, I'd expect <code>public meta import all</code> to behave essentially like <code>public meta import</code> followed by <code>meta import all</code>.)</p>\n<blockquote>\n<p><code>public import all M</code> behaves like <code>public import M</code> followed by <code>import all M</code>, i.e. the <code>all</code> modifier becomes irrelevant for downstream modules.</p>\n</blockquote>",
        "id": 548174913,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761921754
    },
    {
        "content": "<p>One last question:</p>\n<p>If I write <code>public meta import Foo</code> in <code>Bar</code>, thus importing an ordinary, non-meta <code>public def foo</code> in <code>Foo</code> into <code>Bar</code> and marking it both public and meta, does the new meta annotation on <code>foo</code> persist through imports of <code>Bar</code>? I.e., if downstream <code>Baz</code> writes <code>import Bar</code> and gets <code>foo</code>, is <code>foo</code> still <code>meta</code>?</p>",
        "id": 548175074,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761921792
    },
    {
        "content": "<p>Yes. Importing declarations acts uniformly independently whether the declaration was defined in the imported module or itself imported into it, so <code>meta</code> is preserved in both cases.</p>",
        "id": 548193353,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761926089
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"548935\">Thomas Murrills</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/548174913\">said</a>:</p>\n<blockquote>\n<p>The documentation mentions <code>public import all</code> at the bottom of the visibility page!</p>\n</blockquote>\n<p>Ahh, that information is outdated. Thanks!</p>",
        "id": 548193481,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761926117
    },
    {
        "content": "<p>Ok, thanks! :) Just curious, what's the reasoning behind not having <code>public import all</code>? It does seem like these are independent toggles (\"does the imported public scope become private or public\" and \"is the upstream private scope imported (into the current private scope)\"). Is there a technical reason, or is it just that people might think that <code>public import all</code> means \"import everything, incl. the private scope, as public\"?</p>",
        "id": 548196704,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1761926943
    },
    {
        "content": "<p>The latter :)</p>",
        "id": 548212034,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1761931704
    },
    {
        "content": "<p>It seems <code>grind</code> \"interactive mode\" is now in the latest releases. When can we expect a proper reference manual entry about this?</p>",
        "id": 558187244,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1763554757
    },
    {
        "content": "<p>I've only found <a href=\"https://lean-lang.org/doc/reference/latest//releases/v4.25.0/?terms=grind%20interactive#The-Lean-Language-Reference--Release-Notes--Lean-4___25___0-_LPAR_2025-11-14_RPAR_--Highlights--Grind--Interactive-mode\">this</a> so far :).</p>",
        "id": 558191023,
        "sender_full_name": "František Silváši 🦉",
        "timestamp": 1763555819
    },
    {
        "content": "<p>I can confirm that <code>leanprover/lean4:v4.26.0-rc1</code> fixes the <a href=\"#narrow/channel/270676-lean4/topic/Yet.20another.20UInt64.20miscompilation/near/548250126\">recent UInt64 miscompilation bug</a>!</p>",
        "id": 558319406,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1763592879
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/558187244\">said</a>:</p>\n<blockquote>\n<p>It seems <code>grind</code> \"interactive mode\" is now in the latest releases. When can we expect a proper reference manual entry about this?</p>\n</blockquote>\n<p>I'm sure it's in the works, but I would like to second the request for more information about the <code>grind</code> interactive mode, especially anchors. For instance, <code>grind?</code> now uses anchors in the suggestions it makes and it is unclear to me what are the style guidelines are around these.</p>\n<p>I think in general (as I mentioned in <a class=\"message-link\" href=\"/#narrow/channel/287929-mathlib4/topic/Mathlib.3A.20the.20Missing.20Manuals/near/556925503\">#mathlib4 &gt; Mathlib: the Missing Manuals @ 💬</a> ) that it would be helpful to have a style guide entry about grind. One I don't mention there is if <code>grind only</code> is analogous to <code>simp only</code> for squeezing purposes, and I am not sure how <code>grind?</code> suggesting interactive mode fits into that.</p>",
        "id": 558639057,
        "sender_full_name": "Chris Henson",
        "timestamp": 1763725033
    },
    {
        "content": "<p>I think it's too early to write style suggestions for <code>grind =&gt;</code> in Mathlib. We have to explore how it works for a while.</p>",
        "id": 558786912,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763789507
    },
    {
        "content": "<p>I mostly meant style suggestions for regular uses of grind, and just a passing mention of <code>grind =&gt;</code> because it is already being exposed to users via <code>grind?</code>.</p>",
        "id": 558802675,
        "sender_full_name": "Chris Henson",
        "timestamp": 1763805207
    },
    {
        "content": "<p><code>v4.27.0-rc1</code> brings many changes to <code>grind</code>:</p>\n<ul>\n<li>allow arbitrary terms as arguments to <code>grind</code> </li>\n<li>better support for <code>Fin n</code></li>\n<li>congruence closure for function-valued equalities</li>\n<li>renames the <code>cutsat</code> frontend to <code>grind</code> to <code>lia</code></li>\n<li>support of <code>LawfulOfScientific</code></li>\n<li>improvements for <code>grind</code>'s linarith mode</li>\n<li>many new \"guards\" for <code>grind_pattern</code>, allowing controlled instantiation (see <a href=\"https://github.com/leanprover/lean4/pull/11429\">lean#11429</a> for docs)</li>\n<li>more aggressive case splitting when non-chronological backtracking is effective</li>\n<li>... many bug fixes and improvements to corner cases.</li>\n</ul>",
        "id": 563941547,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765840183
    },
    {
        "content": "<p>Also of note is significant changes to the behaviour of <code>exact?</code> and <code>apply?</code>:</p>\n<ul>\n<li><code>exact?</code> falls back to trying \"unindexable\" theorems if it doesn't otherwise find a result (restoring Lean 3 behaviour). Reports where this is painfully slow in the wild are welcome.</li>\n<li><code>exact? +all</code> gives all solutions, not just the first one.</li>\n<li>No longer calls <code>solve_by_elim</code> (use <code>try?</code> if you want that behaviour), as <code>exact?</code> is specifically a theorem lookup tool, not a general purpose helper</li>\n<li><code>exact? +grind</code> calls <code>grind</code> on subsidiary goals. Potentially powerful, and slow. (Reports from the wild very welcome.)</li>\n</ul>\n<p>Of particular interest, I would like user reports of places where <code>exact?</code> (possibly with these new options) is effective but painfully slow. I have the machinery in place to add parallelism to <code>exact?</code>, but would like some real world test cases for tuning.</p>",
        "id": 563941755,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765840321
    },
    {
        "content": "<p>Finally, between <code>v4.26.0</code> and <code>v4.27.0</code> we have added many new features to <code>try?</code> (including, notably, user extensibility via the <code>register_try?_tactic</code> command). It is powerful and often useful, especially in programming applications, and suggestions for further improvements are welcome.</p>",
        "id": 563941824,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1765840376
    },
    {
        "content": "<p>Pleased to have two (albeit minor) contributions in this patch :D</p>",
        "id": 563994663,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1765876581
    },
    {
        "content": "<p>Same, first minor contribution on my side! (min and max on lists).<br>\nThank you also to Kim and Markus for reviewing it so fast!</p>",
        "id": 564141793,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1765923033
    },
    {
        "content": "<p>So, I just encountered the <code>lia</code> tactic in the wild for the first time, being used to tick off a trivial inequality side condition of the form</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n<span class=\"n\">hk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">k</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">k</span>\n</code></pre></div>\n<p>It's wonderful that we have all these new automation tactics, but I'm a little confused about which ones are preferable for which kinds of goals. Here <code>omega</code>, <code>lia</code>, <code>grind</code> and <code>linarith</code> all work, so which one should be preferred? Or does it not matter?</p>",
        "id": 564683709,
        "sender_full_name": "David Loeffler",
        "timestamp": 1766146761
    },
    {
        "content": "<p><code>omega</code> and <code>cutsat</code> are both being deprecated to <code>lia</code>. <code>grind</code> uses <code>lia</code> under the hood (and so it is better to use <code>lia</code> directly, to convey what exactly <code>grind</code> is doing). From the name, I suspect <code>linarith</code> might eventually be deprecated to <code>lia</code> too?</p>",
        "id": 564684265,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1766146931
    },
    {
        "content": "<p>My understanding is that <code>linarith</code> is stronger but also maybe slower? So if <code>lia</code> handles your goal, you probably want to use that</p>",
        "id": 564685543,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766147368
    },
    {
        "content": "<p>Docstrings should be updated, though</p>",
        "id": 564685591,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766147384
    },
    {
        "content": "<p>(If they haven't already been, I didn't check)</p>",
        "id": 564685626,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766147394
    },
    {
        "content": "<p>And do we have a tactic cheat sheet on the community web site by now that needs updating?</p>",
        "id": 564685713,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1766147419
    },
    {
        "content": "<p>Just to clarify, the relationship is that <code>lia</code> (and deprecated <code>cutstat</code>) elaborate into a restricted call to <code>grind</code>, i.e. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Tactic.evalLia#doc\">docs#Lean.Elab.Tactic.evalLia</a></p>",
        "id": 564687767,
        "sender_full_name": "Chris Henson",
        "timestamp": 1766148120
    },
    {
        "content": "<p><code>lia</code> only does linear integer arithmetic (hence the name, l.i.a), there it is stronger than <code>linarith</code>. But <code>lia</code> does not handle real inequalities, which <code>linarith</code> does do.</p>",
        "id": 564688642,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1766148437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564688642\">said</a>:</p>\n<blockquote>\n<p><code>lia</code> only does linear integer arithmetic (hence the name, l.i.a), there it is stronger than <code>linarith</code>. But <code>lia</code> does not handle real inequalities, which <code>linarith</code> does do.</p>\n</blockquote>\n<p>I'm slightly puzzled, then, that the following example works:<br>\n<code>example (k : ℝ) (hk : 2 ≤ k) : 0 ≤ k := by lia</code></p>",
        "id": 564688881,
        "sender_full_name": "David Loeffler",
        "timestamp": 1766148525
    },
    {
        "content": "<p>it fails when running <code>by lia -order</code>. This is because the \"no op config\" of grind (<a href=\"https://github.com/leanprover/lean4/blob/73ff198d11410054def5223123a58de85f06d3dd/src/Init/Grind/Config.lean#L229-L248\">here</a>) does not the unset the \"order\" module.</p>",
        "id": 564690097,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766148954
    },
    {
        "content": "<p>(and <code>example (k : Nat) (hk : 2 ≤ k) : 0 ≤ k := by lia -order</code> does work.)</p>",
        "id": 564690199,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1766148989
    },
    {
        "content": "<p>Also <a class=\"stream-topic\" data-stream-id=\"428973\" href=\"/#narrow/channel/428973-nightly-testing/topic/nightly-testing.20regression.20log/with/564621473\">#nightly-testing &gt; nightly-testing regression log</a> is relevant, which tracks the extent to which <code>grind</code>/<code>lia</code> can replace <code>omega</code>/<code>ring</code>/<code>linarith</code>/<code>tauto</code> in Mathlib.</p>",
        "id": 564690265,
        "sender_full_name": "Chris Henson",
        "timestamp": 1766149011
    },
    {
        "content": "<p>I see: so the real-number example is arguably a bug – that the <code>lia</code> tactic is actually doing stuff that it's not meant to.</p>",
        "id": 564691520,
        "sender_full_name": "David Loeffler",
        "timestamp": 1766149447
    },
    {
        "content": "<p>Shall I make an issue in the lean4 repo for this?</p>",
        "id": 564691899,
        "sender_full_name": "David Loeffler",
        "timestamp": 1766149578
    },
    {
        "content": "<p>If you make an issue there's a risk they might fix it!</p>",
        "id": 564728033,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766159722
    },
    {
        "content": "<p>Yes, that is a bug in <code>lia</code> that I will fix asap.</p>",
        "id": 564760374,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766171040
    },
    {
        "content": "<p><code>linarith</code> and <code>lia</code> are incomparable, as explained above.</p>",
        "id": 564760455,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766171080
    },
    {
        "content": "<p>As of quite recently <code>grind</code> is strictly more powerful that <code>linarith</code> (with two known exceptions in mathlib, that I still need to look at). I'm intending to provide a <code>lia</code> style front-end, possibly just called <code>grind_linarith</code>, for users who don't have access to mathlib's <code>linarith</code> (or prefer to avoid it).</p>",
        "id": 564760763,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766171222
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564760763\">said</a>:</p>\n<blockquote>\n<p>As of quite recently <code>grind</code> is strictly more powerful that <code>linarith</code></p>\n</blockquote>\n<p>Can this be made precise? I know that Bhavik and Heather use tactics like linarith as part of proof discovery. Not just as a finishing tactic.<br>\nIs it clear that all use cases are covered?</p>",
        "id": 564772073,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766176439
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564772073\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564760763\">said</a>:</p>\n<blockquote>\n<p>As of quite recently <code>grind</code> is strictly more powerful that <code>linarith</code></p>\n</blockquote>\n<p>Can this be made precise? I know that Bhavik and Heather use tactics like linarith as part of proof discovery. Not just as a finishing tactic.<br>\nIs it clear that all use cases are covered?</p>\n</blockquote>\n<p>What does this mean? <code>linarith</code> closes a goal or fails, just like <code>grind_linarith</code> would.</p>",
        "id": 564790942,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766189836
    },
    {
        "content": "<p>When CI completes on <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/pull/140\">https://github.com/leanprover-community/mathlib4-nightly-testing/pull/140</a> it should hopefully have the few remaining exceptions indicated in the build log.</p>",
        "id": 564790957,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766189861
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564760374\">said</a>:</p>\n<blockquote>\n<p>Yes, that is a bug in <code>lia</code> that I will fix asap.</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover/lean4/pull/11744\">lean#11744</a>, although Mathlib may still need some repair.</p>",
        "id": 564792377,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766191522
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564790957\">said</a>:</p>\n<blockquote>\n<p>When CI completes on <a href=\"https://github.com/leanprover-community/mathlib4-nightly-testing/pull/140\">https://github.com/leanprover-community/mathlib4-nightly-testing/pull/140</a> it should hopefully have the few remaining exceptions indicated in the build log.</p>\n</blockquote>\n<p>Five files with failures.</p>\n<ul>\n<li>GeckConstruction needs investigating</li>\n<li>Polynomial.Cyclotomic.Eval also</li>\n<li>Combinatorics/Additive/AP/Three/Behrend looks like a grind bug handling arguments; I thought I'd fixed this <span aria-label=\"woman shrugging\" class=\"emoji emoji-1f937-200d-2640\" role=\"img\" title=\"woman shrugging\">:woman_shrugging:</span> </li>\n<li>Mathlib.Geometry.Manifold.PartitionOfUnity is the TacticAnalysis framework crashing, perhaps <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> might be interested in looking?</li>\n<li>Mathlib.Analysis.SpecialFunctions.Elliptic.Weierstrass is just missing <code>import Mathlib.Data.Rat.Cast.OfScientific</code>. I would really like to get this imported somewhere much lower down, but it has strangely disjoint imports.</li>\n</ul>",
        "id": 564794412,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766194396
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/releases.20of.20new.20Lean.20versions/near/564790942\">said</a>:</p>\n<blockquote>\n<p>What does this mean? <code>linarith</code> closes a goal or fails, just like <code>grind_linarith</code> would.</p>\n</blockquote>\n<p>My understanding, from discussing with <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> is that they use linarith's failure in useful ways to discover new proof steps.</p>",
        "id": 564806584,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766212008
    },
    {
        "content": "<p><code>grind</code> also gives witnesses (i.e. a model satisfying all the linear inequalities) when it fails</p>",
        "id": 564820986,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766229055
    },
    {
        "content": "<p>(It also does this for integer linear arithmetic, unlike <code>omega</code>.)</p>",
        "id": 564821008,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766229074
    },
    {
        "content": "<p>For me, I used linear_combination rather than linarith for proof discovery, which was useful to help find slack in inequalities, particularly if I change the discharger it uses.</p>",
        "id": 564825314,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1766234066
    }
]