[
    {
        "content": "<p>I'm registering a tagged attribute: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">euclidAttr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TagAttribute</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">  </span><span class=\"n\">registerTagAttribute</span><span class=\"w\"> </span><span class=\"ss\">`euclid</span><span class=\"w\"> </span><span class=\"s2\">\"Used to mark System E inference axioms\"</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"#printTagged\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">decls</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">euclidAttr</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"bp\">.</span><span class=\"n\">getState</span><span class=\"w\"> </span><span class=\"n\">env</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">decls</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Tagged: {decl}\"</span>\n</code></pre></div>\n<p>When I printTagged in a file where the attributes are declared it works fine ```</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"bp\">.</span><span class=\"n\">Relations</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Attr</span>\n<span class=\"kd\">@[</span><span class=\"n\">euclid</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">two_points_determine_line</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Point</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Line</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">distinctPointsOnLine</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">onLine</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">onLine</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">M</span>\n</code></pre></div>\n<p>However if I import the above file and printTagged I don't get anything</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"bp\">.</span><span class=\"n\">Inferences</span><span class=\"bp\">.</span><span class=\"n\">Diagrammatic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"bp\">.</span><span class=\"n\">Inferences</span><span class=\"bp\">.</span><span class=\"n\">Metric</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"bp\">.</span><span class=\"n\">Inferences</span><span class=\"bp\">.</span><span class=\"n\">Transfer</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">SystemE</span><span class=\"bp\">.</span><span class=\"n\">Theory</span><span class=\"bp\">.</span><span class=\"n\">Inferences</span><span class=\"bp\">.</span><span class=\"n\">Superposition</span>\n\n<span class=\"bp\">#</span><span class=\"n\">printTagged</span>\n</code></pre></div>\n<p>Is it my way getting the enviroment that's wrong or is the attribute simply not persisting across imports?</p>",
        "id": 513195199,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745088188
    },
    {
        "content": "<blockquote>\n<p>Is it my way getting the enviroment that's wrong</p>\n</blockquote>\n<p>Yes, <code>getState</code> gets the module-local state. Take a look at the source for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.TagAttribute.hasTag#doc\">docs#Lean.TagAttribute.hasTag</a> (the intended interface). In the source you can see that there's <code>getModuleEntries</code> for the tagged declarations per imported module.</p>",
        "id": 513199483,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745091955
    },
    {
        "content": "<p>so how would I get all imported modules?</p>",
        "id": 513204753,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745096173
    },
    {
        "content": "<p>actually I would like to do it in a similar way that simp does it where a single Extension gets updated everytime. Any tips?</p>",
        "id": 513204812,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745096232
    },
    {
        "content": "<p>You can make your own persistent env extension and attribute from scratch.</p>",
        "id": 513208419,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1745099289
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.LabelExtension#doc\">docs#Lean.LabelExtension</a> is probably what you want</p>",
        "id": 513210825,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1745101421
    },
    {
        "content": "<p>thx!</p>",
        "id": 513235399,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1745122326
    }
]