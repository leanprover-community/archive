[
    {
        "content": "<p>In the Brownian motion project, half of our CI runs get stuck on the <code>Lint project</code> step, where we get those 3 lines printed, and then nothing for a very long time (I don't know how long, I stopped one after 50 minutes):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">BrownianMotion</span>\n<span class=\"w\">  </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">BrownianMotion</span>\n<span class=\"w\">  </span><span class=\"n\">shell</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">bash</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>Example: <a href=\"https://github.com/RemyDegenne/brownian-motion/actions/runs/19140278725/job/54703144152?pr=199\">https://github.com/RemyDegenne/brownian-motion/actions/runs/19140278725/job/54703144152?pr=199</a></p>\n<p>When I cancel and then restart the job, I usually get a successful <code>Lint project</code> step which is less than a minute. But sometimes it gets stuck again.<br>\nThere was no problem with CI yesterday, but today I had to restart many runs. Does someone have any idea of what could be the cause?</p>",
        "id": 554143358,
        "sender_full_name": "RÃ©my Degenne",
        "timestamp": 1762448323
    },
    {
        "content": "<p>As I mentioned in the original thread at <a class=\"message-link\" href=\"/#narrow/channel/509433-Brownian-motion/topic/CI.20gets.20stuck/near/554129274\">#Brownian motion &gt; CI gets stuck @ ðŸ’¬</a>, I looked a little bit but didn't get very far. Here are some more details that might save some clicking:</p>\n<ul>\n<li><a href=\"https://github.com/RemyDegenne/brownian-motion/actions/workflows/blueprint.yml\">the logs for the stuck jobs are here</a>; some of the ones that are green only became green after being re-run, so the runs with the issues don't all show up when you filter for canceled jobs.</li>\n<li><a href=\"https://github.com/RemyDegenne/brownian-motion/actions/runs/19131235592/job/54672239711#step:5:5\">the first run that had to get canceled seems to be this one</a>, corresponding to <a href=\"https://github.com/RemyDegenne/brownian-motion/commit/8bfa4ecf90ae1608e2293edb6cbde50626d083c0\">this commit</a> in <a href=\"https://github.com/RemyDegenne/brownian-motion/pull/194\">RemyDegenne/brownian-motion#194</a>. Nothing looked off to me but maybe I just don't know the linters well enough.</li>\n<li>there's currently <a href=\"https://github.com/RemyDegenne/brownian-motion/actions/runs/19141550379/job/54707721006#step:5:1\">a run</a> that's been stuck for over an hour and a half. It might be interesting to just keep letting it run to see if it eventually finishes or if (as I suspect) GitHub will terminate it after hitting the <a href=\"https://docs.github.com/en/actions/reference/limits#existing-system-limits\">6 hour limit</a>.</li>\n<li>Does anyone know what linters might be nondeterministic? That might be a good place to start digging.</li>\n</ul>\n<p><strong>edit</strong>: looks like the job I mentioned above was indeed automatically canceled after 6 hours: <a href=\"https://github.com/RemyDegenne/brownian-motion/actions/runs/19141550379/job/54707721006\">https://github.com/RemyDegenne/brownian-motion/actions/runs/19141550379/job/54707721006</a></p>",
        "id": 554151150,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1762450435
    },
    {
        "content": "<p>Several stuck jobs have now hit the 6 hours point, so I guess stuck means stuck forever.<br>\nIt might be only a feeling but it looks like it's now much more than 50% of runs that have problems.</p>",
        "id": 554249061,
        "sender_full_name": "RÃ©my Degenne",
        "timestamp": 1762498511
    },
    {
        "content": "<p>I do not know what this could be, but I am reminded of <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/runLinter.20in.20github.20workflow.20not.20terminating/with/546934304\">#general &gt; runLinter in github workflow not terminating</a> which also has some issues with linters on projects depending on Mathlib.</p>",
        "id": 554276945,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1762508460
    },
    {
        "content": "<p>What I ended up doing to fix this on PhysLean is (see the link Damiano posted): </p>\n<ol>\n<li>Putting a time limit on the step in the workflow so it doesn't go on forever. </li>\n<li>Rewriting runLinter, leaving only what is actually needed (hard to say if this actually did anything). </li>\n<li>Just waited a couple of days. </li>\n</ol>\n<p>For PhysLean, I think it may have been down to lots of simultaneous, or close together runs of the workflow.  Would something like this make sense here?</p>",
        "id": 554701300,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1762781559
    },
    {
        "content": "<p>I didn't notice any simultaneous runs of the workflow when I checked the logs; I'd also be very surprised if something like that could affect what happened on GitHub-hosted runners.</p>",
        "id": 554702314,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1762781838
    },
    {
        "content": "<p>Yeah, I agree. The only evidence I have for this is that when I was having issues with it, I noticed that usually the \"first run\" of the day would work, and then it would stop working, or fluctuating working after that.</p>\n<p>Let me also add, PhysLean is no longer having these issues. I have not bumped Lean or Mathlib since then.</p>",
        "id": 554703087,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1762782042
    },
    {
        "content": "<p>The only real change I made was replacing <code>runLinter</code> with a stripped down version, which can be found in <a href=\"https://github.com/HEPLean/PhysLean/pull/786\">PhysLean#786</a>. I think after making this change, I <em>did</em> have the issue again, but only one or two times - so I can't say anything conclusive about making said change.</p>",
        "id": 554703717,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1762782190
    }
]