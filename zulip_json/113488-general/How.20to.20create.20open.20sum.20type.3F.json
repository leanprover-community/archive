[
    {
        "content": "<p>Like <code>open type</code> in Koka, I want to have a sum type with branches across many files.</p>\n<p>Should I do <code>AnyOf [TypeA, TypeB, ...]</code> or something else? How do i Elab a <code>inductive</code> type to see its possible branches?</p>",
        "id": 547039116,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761380312
    },
    {
        "content": "<p>To confirm, you want an inductive type where you can dynamically extend the possible branches of the type after it has already been defined?</p>",
        "id": 547040850,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761381982
    },
    {
        "content": "<p>idk if it is \"after it has already been defined\". </p>\n<p>Is it possible to put <code>add_branch [...]</code> anywhere in the source repository and have it scanned? There has been a few times during ordinary programming that I hoped the language had this feature.</p>",
        "id": 547041260,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761382387
    },
    {
        "content": "<p>I'm not sure this is possible. The problem is that if you create an inductive type <code>A</code>, you can define a function <code>A -&gt; SomeOtherType</code> by pattern matching on <code>A</code>. But if there were a way to add more branches to <code>A</code>, it would break all the functions that pattern matched on <code>A</code>. So it must be that if there were a way to define an <code>open inductive</code> or something, you wouldn't be able to pattern match on it.</p>\n<p>The alternative would be to make <code>A</code> into a typeclass. Since you couldn't pattern match on <code>A</code> anyways, it seems this meets your requirements, and then you can dynamically extend it later with <code>instance</code>.</p>\n<p>The inductive types vs typeclasses tradeoff is known as the <a href=\"https://en.wikipedia.org/wiki/Expression_problem\">Expression problem</a>. It is effectively the same as the trade-off between normal classes/interfaces and sealed classes in Java.</p>",
        "id": 547041360,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761382470
    },
    {
        "content": "<p>But <code>Type</code> is not inductive.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">TypeA</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">TypeA</span>\n<span class=\"n\">TypeB</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">TypeB</span>\n</code></pre></div>\n<p>If I use typeclass, the constructor parameter type is erased. How do I use elaboration to make a \"sum type\" constructor and eliminator?</p>",
        "id": 547041657,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761382788
    },
    {
        "content": "<p>Can you maybe link to some documentation on what <code>open type</code> does in Koka? I couldn't find any documentation of it with a quick search.</p>",
        "id": 547041714,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761382835
    },
    {
        "content": "<p><a href=\"https://github.com/koka-lang/koka/discussions/631\">https://github.com/koka-lang/koka/discussions/631</a><br>\nsearch for <code>extend type</code></p>",
        "id": 547041804,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761382921
    },
    {
        "content": "<p>From the discussion you sent: <a href=\"https://koka-community.github.io/koka-docs/koka-docs.kk.html#sec-type-definitions\">https://koka-community.github.io/koka-docs/koka-docs.kk.html#sec-type-definitions</a></p>",
        "id": 547041993,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761383093
    },
    {
        "content": "<p>This is more of a convenience thing. Not about type theory.</p>",
        "id": 547042057,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761383150
    },
    {
        "content": "<p>You could use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Dynamic#doc\">docs#Dynamic</a>, which is basically \"any type that has deriving TypeName\"</p>",
        "id": 547042210,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1761383246
    },
    {
        "content": "<p>The type of a parameter of a constructor of a branch may be defined later than the typeclass.</p>",
        "id": 547042365,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761383380
    },
    {
        "content": "<p>The semantics of this are actually pretty complicated, so I'm not actually sure how this would be done. One complication I can imagine is that if you declare an open type <code>A : Type</code> and allow extending what values it can have in the future, then <code>A</code> must have cardinality larger than every type in <code>Type</code>, because for any <code>B : Type</code> you can extend <code>A</code> to allow values of <code>B</code>. This leads to a logical inconsistency. The alternative is to give <code>A</code> a universe bump or make it opaque-ish.</p>",
        "id": 547042447,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761383454
    },
    {
        "content": "<p>the compiler can prevent cycles</p>",
        "id": 547042571,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761383564
    },
    {
        "content": "<p>no paradox</p>",
        "id": 547042574,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761383568
    },
    {
        "content": "<p>it's one type with definitions split across many files</p>",
        "id": 547042612,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761383608
    },
    {
        "content": "<p>At the very least, this means that if any definition <code>x</code> references <code>A</code> or something depending on <code>A</code> after it is defined, then when extending <code>A</code> with new branches those branches cannot depend on <code>x</code>. So the compiler would need to track dependencies for every open type for every definition.</p>",
        "id": 547042856,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761383835
    },
    {
        "content": "<blockquote>\n<p>it's one type with definitions split across many files</p>\n</blockquote>\n<p>Are you allowed to write theorems and definitions depending on the type between when the type is declared and when it is extended? If so, this is much more complicated than a standard inductive type</p>",
        "id": 547042998,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761383993
    },
    {
        "content": "<p>I think with sufficient cleverness, something like this could be implemented without a universe bump by making an opaque type for which some properties can be proven, but the recursion principle is insufficiently powerful to ever allow establishing an upper bound on the type's cardinality. I don't think this would be a conservative extension of Lean.</p>",
        "id": 547043139,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761384149
    },
    {
        "content": "<p>That is, you could have something like (and clearly this is not the most optimal way to do it nor does it cover all concerns)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Declare open inductive type with two branches</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isApple</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getAppleSize</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">isApple</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Float</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkApple</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fruit</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isApple_mkApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkApple</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getAppleSize_mkApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getAppleSize</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkApple</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isBanana</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getBananaLength</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">isBanana</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Float</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkBanana</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fruit</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isBanana_mkBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkBanana</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getBananaLength_mkBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getBananaLength</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkBanana</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isApple_mkBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkBanana</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isBanana_mkApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkApple</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>\n<p>and then later on you can extend it with a third branch:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getPersimmonSpecies</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkPersimmon</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fruit</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon_mkPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkPersimmon</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getPersimmonSpecies_mkPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">getPersimmonSpecies</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkPersimmon</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isPersimmon_mkApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkApple</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isPersimmon_mkBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkBanana</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isApple_mkPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isApple</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkPersimmon</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">not_isBanana_mkPersimmon</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">isBanana</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fruit</span><span class=\"bp\">.</span><span class=\"n\">mkPersimmon</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n</code></pre></div>",
        "id": 547043902,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761385005
    },
    {
        "content": "<p>The point is, <code>Fruit</code> must always be under-specified, in the sense that at any point in the code there exist multiple non-isomorphic types that satisfy all the axioms of <code>Fruit</code> so far. And it is impossible to find a cardinal C and prove that the cardinality of <code>Fruit</code> is less than C. And for any cardinal C, we can extend Fruit such that it has cardinality greater than C. But this doesn't let us derive a contradiction.</p>",
        "id": 547044264,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761385369
    },
    {
        "content": "<p>it seems like <span class=\"user-mention\" data-user-id=\"515610\">@Locria Cyber</span> might be happy with each new constructor being countable and there only being finitely many constructors</p>",
        "id": 547044335,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761385439
    },
    {
        "content": "<p>but then it also seems like we'll need some sort of metaprogramming to store what branches have been declared (as this is not static)</p>",
        "id": 547044410,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761385511
    },
    {
        "content": "<p>I am a bit worried this breaks some important property of the logic though. I was thinking it might break omega-consistency, but now I'm not actually sure it does.</p>",
        "id": 547044529,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761385634
    },
    {
        "content": "<p>Oh, and yeah, we are not allowed to extend Fruit to have a branch with elements of <code>Set Fruit</code>. But I think this should be covered when you write that you require each new branch to be countable.</p>",
        "id": 547044625,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761385739
    },
    {
        "content": "<p>It's not about the logic, but about code organization. Instead of defining a type in one file, now it's defined in many files.</p>",
        "id": 547064458,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761405488
    },
    {
        "content": "<p>do you just want an \"extendable enum\" or something more complicated</p>",
        "id": 547064548,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405597
    },
    {
        "content": "<p>if it's just an enum without anything inside then you can just implement it as <code>Nat</code></p>",
        "id": 547064634,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405712
    },
    {
        "content": "<p>if it's something more complicated then it might be more tricky</p>",
        "id": 547064659,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405741
    },
    {
        "content": "<p>but this also might be an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a></p>",
        "id": 547064705,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405786
    },
    {
        "content": "<blockquote>\n<p>if it's just an enum without anything inside then you can just implement it as <code>Nat</code></p>\n</blockquote>\n<p>How to have the compiler assign a number?</p>",
        "id": 547064734,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761405822
    },
    {
        "content": "<p>unfortunately you'll have to assign the numbers yourself</p>",
        "id": 547064804,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405884
    },
    {
        "content": "<p>how to scan through the source code in a lake file?</p>",
        "id": 547064842,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761405918
    },
    {
        "content": "<p>since it has to work across the import graph without having collisions</p>",
        "id": 547064844,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405919
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515610\">Locria Cyber</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20create.20open.20sum.20type.3F/near/547064842\">said</a>:</p>\n<blockquote>\n<p>how to scan through the source code in a lake file?</p>\n</blockquote>\n<p>what do you mean by this?</p>",
        "id": 547064854,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405930
    },
    {
        "content": "<p>what are you looking for in the scan</p>",
        "id": 547064863,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405939
    },
    {
        "content": "<p>why is it coming from the lake file?</p>",
        "id": 547064878,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405949
    },
    {
        "content": "<p>say, <code>#[open_type] def ...</code></p>",
        "id": 547064900,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761405966
    },
    {
        "content": "<p>because it can only be done by a build tool</p>",
        "id": 547064918,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761405989
    },
    {
        "content": "<p>what does that mean</p>",
        "id": 547064925,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761405995
    },
    {
        "content": "<p>the build system generates the sum type definition from the rest of the source code</p>",
        "id": 547064981,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406031
    },
    {
        "content": "<p>oh do you want a script that goes through the files and figures out an assignment of numbers for you</p>",
        "id": 547064984,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406032
    },
    {
        "content": "<p>yes</p>",
        "id": 547064998,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406051
    },
    {
        "content": "<p>well, what have you tried so far?</p>",
        "id": 547065138,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406171
    },
    {
        "content": "<p>for other languages, opengrep</p>",
        "id": 547065152,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406191
    },
    {
        "content": "<p>Go has <code>go generate</code></p>",
        "id": 547065175,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406214
    },
    {
        "content": "<p>I guess the other option would be to implement it as <code>String</code> and then you don't have to worry about the numbers anymore</p>",
        "id": 547065230,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406272
    },
    {
        "content": "<p>it is exactly about functions with different signatures.</p>",
        "id": 547065267,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406300
    },
    {
        "content": "<p>e.g. i want to register some Python extensions on load, in a type safe manner.</p>",
        "id": 547065309,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406341
    },
    {
        "content": "<p>what do you mean \"register\"</p>",
        "id": 547065318,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406357
    },
    {
        "content": "<p>and what are python extensions</p>",
        "id": 547065332,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406372
    },
    {
        "content": "<p>C code that extends Python. They have to be registered before used in Python.</p>",
        "id": 547065359,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406411
    },
    {
        "content": "<p>ok</p>",
        "id": 547065383,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406440
    },
    {
        "content": "<p>Is there like a <code>#[do_something]</code> that is a no-op but appear in AST?</p>",
        "id": 547065401,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406455
    },
    {
        "content": "<p>I don't think there's anything that's specifically for that purpose</p>",
        "id": 547065429,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406487
    },
    {
        "content": "<p>but Lean has extensible syntax so you can just extend the syntax to have a noop</p>",
        "id": 547065457,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761406511
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 547065618,
        "sender_full_name": "Locria Cyber",
        "timestamp": 1761406633
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515610\">Locria Cyber</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20create.20open.20sum.20type.3F/near/547039116\">said</a>:</p>\n<blockquote>\n<p>Like <code>open type</code> in Koka, I want to have a sum type with branches across many files.</p>\n<p>Should I do <code>AnyOf [TypeA, TypeB, ...]</code> or something else? How do i Elab a <code>inductive</code> type to see its possible branches?</p>\n</blockquote>\n<p>Is this the same thing as <a href=\"https://ocaml.org/manual/5.4/polyvariant.html\">polymorphic variants in OCaml</a>?</p>",
        "id": 547068862,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1761410329
    },
    {
        "content": "<p>No one seems to have mentioned that Lake has an implementation of open types already via the <code>family_def</code> macro</p>",
        "id": 547307612,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1761578806
    },
    {
        "content": "<p><a href=\"https://lean-lang.org/doc/api/Lake/Util/Family.html\">https://lean-lang.org/doc/api/Lake/Util/Family.html</a></p>",
        "id": 547316847,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761580966
    }
]