[
    {
        "content": "<p>I have long been wondering about how to best recall <code>P ∧ Q → R</code> theorems.<br>\nI want to optimize for readability, believability, and esthetics.</p>\n<p>Consider a project that contains <code>main_result</code> at the end of a long and messy implementation.<br>\nI want to <code>recall</code> it in a user-facing file that is formally verified as well.<br>\nSeveral options came to my mind.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hxy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"c1\">-----------------------------------------------------------------------------</span>\n\n<span class=\"n\">recall</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hxy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"n\">recall</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"n\">recall</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"n\">recall</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hxy</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hxy</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hxy</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hxy</span>\n</code></pre></div>\n<ul>\n<li>The first <code>recall</code> is the most faithful-to-the-implementation option, but it contains unnecessary variable names and makes <code>linter.unusedVariables</code> complain.</li>\n<li>The second <code>recall</code> fixes the disadvantages of the above but it may make the reader wonder what the underscores mean, distracting readers from the message.</li>\n<li>The third <code>recall</code> is probably the most natural way for me to write it; it is also the most consistent way with respect to other recalls in the same file. Unfortunately, many mathematicians are not used to currying and will be left confused.</li>\n<li>The fourth <code>recall</code> carries a lower risk of confusing the readers. Unfortunately, it is somewhat ugly to look at, especially in situations where <code>P</code> and <code>Q</code> are similar. Also, for people who are not used to currying, it may be still difficult to internalize its meaning.</li>\n<li>The <code>example</code>s at the end are perhaps a good way how to eat the cake and have it too — the curried version is better for the implementation (and also for potential downstream projects), so we keep it inside, but it isn't optimal for presentation of our results, hence we present the results in the uncurried way. On the negative side, it is less obvious on the first sight that an existing result is recalled. Also, we need to decide whether it is obvious that <code>∧</code> has higher precedence than <code>→</code> or parentheses should be used for clarity.</li>\n</ul>\n<p>Which version do you prefer?</p>",
        "id": 532666812,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754293650
    },
    {
        "content": "<p>One possibility is to tell the unused variable linter to stop complaining about <code>recall</code>.</p>",
        "id": 532708899,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1754307593
    },
    {
        "content": "<p>Yes, I also considered turning off the linter in the \"presentation\" file.<br>\nHowever, the question remains whether</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">recall</span><span class=\"w\"> </span><span class=\"n\">main_result</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hxy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>\n<p>is the best way to recall given result.</p>",
        "id": 532709863,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754307918
    },
    {
        "content": "<p>/poll Which version do you prefer?<br>\nthe first recall, after suppressing the linter<br>\nthe first recall, letting the linter complain<br>\nthe second recall (underscores)<br>\nthe third recall (chained implication)<br>\nthe fourth recall (chained implication with redundant parentheses)<br>\nthe first example (conjunction implies)<br>\nthe second example (conjunction with redundant parentheses implies)</p>",
        "id": 533076980,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754478069
    },
    {
        "content": "<p>(what does recall do?)</p>",
        "id": 533109009,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1754488514
    },
    {
        "content": "<p>like a no-op, hopefully</p>",
        "id": 533111587,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754489222
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20best.20recall.20P.20.E2.88.A7.20Q.20.E2.86.92.20R/near/533109009\">said</a>:</p>\n<blockquote>\n<p>(what does recall do?)</p>\n</blockquote>\n<p>It allows us to repeat an existing declaration in a way that emits a compile-time error if the recalled declaration isn't definitionally equal to the original declaration.</p>",
        "id": 533114197,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754490030
    },
    {
        "content": "<p>The very fact that such a proficient Lean user as <span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span> didn't know <code>recall</code> demonstrates that this command is underutilized and not talked about enough in this community.</p>\n<p>It is such a pity that <code>recall</code> isn't used more!<br>\nMost of the time when I visit a repository downstream of Mathlib, I don't know where to start reading in order to be able to understand and believe the main results, even if the README file vaguely says what the main results are.</p>\n<p>I suggest that every project should have a \"summary\" in the sink file (the file that is usually named the same as the project, lies in the root folder, and imports all other .lean files) that <code>recall</code>s the main results and all nontrivial definitions they depend on (dependencies of the statements, not the proofs). It is very little extra work and a huge advantage for visitors!</p>",
        "id": 533355457,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754596757
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20best.20recall.20P.20.E2.88.A7.20Q.20.E2.86.92.20R/near/533355457\">said</a>:</p>\n<blockquote>\n<p>I suggest that every project should have a \"summary\" in the sink file (the file that is usually named the same as the project, lies in the root folder, and imports all other .lean files) that <code>recall</code>s the main results and all nontrivial definitions they depend on (dependencies of the statements, not the proofs). It is very little extra work</p>\n</blockquote>\n<p>It is in fact a lot of (continuous) extra work because those <code>recall</code> commands would get wiped out every time I run <code>lake exe mk_all</code> to update that file. This happens &gt; 20 times a week</p>",
        "id": 533402045,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754632892
    },
    {
        "content": "<p>If you can think of another standardised place where such <code>recall</code> commands could go, I'd gladly switch</p>",
        "id": 533402146,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754632948
    },
    {
        "content": "<p>maybe don't use <code>mk_all</code> and use globs instead</p>",
        "id": 533526267,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1754686255
    },
    {
        "content": "<p>I think we should really encourage use of globs. If they don’t work well enough then we should encourage the FRO to fix them instead of writing those mk_all files.</p>",
        "id": 533533275,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1754690129
    },
    {
        "content": "<p>I would be the first happy to drop those files, but I manage too many projects simultaneously to be able to take such an approach on an individual basis. What about we switch out mathlib first?</p>",
        "id": 533557593,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754719525
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20best.20recall.20P.20.E2.88.A7.20Q.20.E2.86.92.20R/near/533533275\">said</a>:</p>\n<blockquote>\n<p>I think we should really encourage use of globs.</p>\n</blockquote>\n<p>Is it <a href=\"https://github.com/madvorak/duality/blob/db8a785db20438eb379d8fe5a423e5e07469a707/lakefile.lean#L12\">https://github.com/madvorak/duality/blob/db8a785db20438eb379d8fe5a423e5e07469a707/lakefile.lean#L12</a><br>\nthat you mean?</p>",
        "id": 533712253,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754894333
    },
    {
        "content": "<p>I love using globs!<br>\nI have them in most of my projects that don't have a blueprint (and don't have doc-gen either).<br>\nIs it possible to have globs with Leanblueprint (in LeanProject-generated projects)?</p>",
        "id": 533726625,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1754899340
    }
]