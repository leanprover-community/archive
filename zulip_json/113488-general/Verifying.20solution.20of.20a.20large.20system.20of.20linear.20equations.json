[
    {
        "content": "<p>I'd appreciate some advice on how I should convince Lean that a system of 3787 linear equations has exactly one particular solution.<br>\nThe linear equations come from the following theorems:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">getTiles</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">vol_cors</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ps</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">bl</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">    </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">br</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">    </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tl</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">    </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tr</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">vol</span><span class=\"o\">,</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">comp_apply</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">nth_rw</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">vol_corners_sorted</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">vol_full'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">fullPiece</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">getTiles</span><span class=\"o\">,</span><span class=\"n\">getTile</span><span class=\"o\">,</span><span class=\"n\">vol_usq</span><span class=\"o\">,</span><span class=\"n\">vol</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">vol_empty'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">getTiles</span><span class=\"o\">,</span><span class=\"n\">getTile</span><span class=\"o\">,</span><span class=\"n\">vol</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>And in around a minute, Lean can verify that </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">finRange</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flatMap</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">finRange</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">map</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Piece</span><span class=\"bp\">.</span><span class=\"n\">treePiece</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]))</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">all_pieces_needed_by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xss</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">mergeSort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xss</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">xss</span><span class=\"bp\">.</span><span class=\"n\">flatMap</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">)</span>\n<span class=\"w\">                        </span><span class=\"o\">[</span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">bl</span><span class=\"o\">,</span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">br</span><span class=\"o\">,</span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tl</span><span class=\"o\">,</span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tr</span><span class=\"o\">]))</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">dedup</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">plist</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">iterate</span><span class=\"w\"> </span><span class=\"n\">all_pieces_needed_by</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">plist_contains_all</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plist</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">all_pieces_needed_by</span><span class=\"w\"> </span><span class=\"n\">plist</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- decide -- After unfolding the instance 'instDecidableEqList', reduction got stuck at the 'Decidable' instance</span>\n<span class=\"w\">            </span><span class=\"c1\">-- plist.hasDecEq (all_pieces_needed_by plist)</span>\n<span class=\"w\">  </span><span class=\"n\">native_decide</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">plist</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- 3785</span>\n</code></pre></div>\n<p>This means we have a finite system of linear equations and some Python code tells me that it has a unique solution. I can provide this solution as a list of rational numbers.<br>\nI would like to know how to get a proof of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">init_vols</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">105187607728740402443028874590589271175727417984243041331444253942248364837950737123031018215335541841177518</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6414096097425050620500764171446769897743493331559233629508200333423987240533524436757176775373463909744921363</span><span class=\"bp\">/</span><span class=\"mi\">14040198496569921098110450890605625160855820057203888770200008143743666723979734760755150490956943003574529488</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1176698522459228389099830819267655834622649884875353804796033584561545681626359435628767068906115966430851873</span><span class=\"bp\">/</span><span class=\"mi\">3510049624142480274527612722651406290213955014300972192550002035935916680994933690188787622739235750893632372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42284834655695127325062859536576439763737670748317991543196353411630489597197835666648107752420706453507719884</span><span class=\"bp\">/</span><span class=\"mi\">74588554513027705833711770356342383667046544053895659091687543263638229471142340916511736983208759706489687905</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">736343266571063881623570783362816978314866472318007127181049860729231335817598303978994808300953469180994956641</span><span class=\"bp\">/</span><span class=\"mi\">1193416872208443293339388325701478138672744704862330545467000692218211671538277454664187791731340155303835006480</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">430508607342923240396615459602561656085901916611003856909524500219813256808719072877455150638297429801971077</span><span class=\"bp\">/</span><span class=\"mi\">501435660591782896361087531807343755744850716328710313221428862276559525856419098598398231819890821556233196</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">420750430914961609772115498362357084702909671936972165325777015768993459351802948492124072861342167364710072</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25612890656319030766360156938388263906837250638489325028184557498360800304211824161052872150362113755003904457</span><span class=\"bp\">/</span><span class=\"mi\">149177109026055411667423540712684767334093088107791318183375086527276458942284681833023473966417519412979375810</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">323967108708429854101207238363757798575023426854071961394934730552913718188781187827099820083197152580962656077</span><span class=\"bp\">/</span><span class=\"mi\">596708436104221646669694162850739069336372352431165272733500346109105835769138727332093895865670077651917503240</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4931201186158886148615443017275731652431413483711915532303287562933183263851332100804582310589566272587491623</span><span class=\"bp\">/</span><span class=\"mi\">7020099248284960549055225445302812580427910028601944385100004071871833361989867380377575245478471501787264744</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">755948091544266779327715320905298749919740212938381639470256568792552222274556487136642996044773799066141801</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2536547679753422136345732885106290781940312914416746096203737500009855636085193105273255012857421257559598339</span><span class=\"bp\">/</span><span class=\"mi\">3510049624142480274527612722651406290213955014300972192550002035935916680994933690188787622739235750893632372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3390303731247983503189902887825574898064532479805707071627174058253778351435298488210604791194368713480354159</span><span class=\"bp\">/</span><span class=\"mi\">3510049624142480274527612722651406290213955014300972192550002035935916680994933690188787622739235750893632372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25612890656319030766360156938388263906837250638489325028184557498360800304211824161052872150362113755003904457</span><span class=\"bp\">/</span><span class=\"mi\">149177109026055411667423540712684767334093088107791318183375086527276458942284681833023473966417519412979375810</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">323967108708429854101207238363757798575023426854071961394934730552913718188781187827099820083197152580962656077</span><span class=\"bp\">/</span><span class=\"mi\">596708436104221646669694162850739069336372352431165272733500346109105835769138727332093895865670077651917503240</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4931201186158886148615443017275731652431413483711915532303287562933183263851332100804582310589566272587491623</span><span class=\"bp\">/</span><span class=\"mi\">7020099248284960549055225445302812580427910028601944385100004071871833361989867380377575245478471501787264744</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">755948091544266779327715320905298749919740212938381639470256568792552222274556487136642996044773799066141801</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42284834655695127325062859536576439763737670748317991543196353411630489597197835666648107752420706453507719884</span><span class=\"bp\">/</span><span class=\"mi\">74588554513027705833711770356342383667046544053895659091687543263638229471142340916511736983208759706489687905</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">736343266571063881623570783362816978314866472318007127181049860729231335817598303978994808300953469180994956641</span><span class=\"bp\">/</span><span class=\"mi\">1193416872208443293339388325701478138672744704862330545467000692218211671538277454664187791731340155303835006480</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">430508607342923240396615459602561656085901916611003856909524500219813256808719072877455150638297429801971077</span><span class=\"bp\">/</span><span class=\"mi\">501435660591782896361087531807343755744850716328710313221428862276559525856419098598398231819890821556233196</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">420750430914961609772115498362357084702909671936972165325777015768993459351802948492124072861342167364710072</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105187607728740402443028874590589271175727417984243041331444253942248364837950737123031018215335541841177518</span><span class=\"bp\">/</span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6414096097425050620500764171446769897743493331559233629508200333423987240533524436757176775373463909744921363</span><span class=\"bp\">/</span><span class=\"mi\">14040198496569921098110450890605625160855820057203888770200008143743666723979734760755150490956943003574529488</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1176698522459228389099830819267655834622649884875353804796033584561545681626359435628767068906115966430851873</span><span class=\"bp\">/</span><span class=\"mi\">3510049624142480274527612722651406290213955014300972192550002035935916680994933690188787622739235750893632372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>(If you're interested in further details, <a href=\"https://penteract.github.io/pythagTree.html\">https://penteract.github.io/pythagTree.html</a> is the proof I'm formalizing, and <a href=\"https://github.com/penteract/pythagTreeProof\">https://github.com/penteract/pythagTreeProof</a> contains my proof so far, but I hope this question is self contained without them).</p>",
        "id": 527555063,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1751919649
    },
    {
        "content": "<p>does <code>linarith</code> work?</p>",
        "id": 527560222,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751921368
    },
    {
        "content": "<p>I'm not sure how to get to a point where it would be reasonable to apply <code>linarith</code> unless I generate several thousand lines of proof code to put the relevant concrete instances of <code>vol_cors</code> into the tactic state. Is there a way to do something like <code>List.foldr (And.intro) (by simp:true) [plist.map vol_cors] </code>?</p>",
        "id": 527569235,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1751925231
    },
    {
        "content": "<p>Not sure what you mean by that one</p>",
        "id": 527572252,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751926275
    },
    {
        "content": "<p>Can you get your program to output a certificate?</p>",
        "id": 527572430,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751926346
    },
    {
        "content": "<p>I used sympy.solvers.solveset.linsolve. I don't think that has a way to output a proof certificate. Do you know a Linear algebra solver which can do make one? (ideally one that works nicely with Lean)</p>",
        "id": 527576548,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1751927791
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\">  </span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">plist</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">bl</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">      </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">br</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">      </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tl</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">      </span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canon_cor_rot</span><span class=\"w\"> </span><span class=\"n\">Cor</span><span class=\"bp\">.</span><span class=\"n\">tr</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>almost has the type I'd need to try linarith, but I'd need to fully evaluate <code>plist</code> and <code>canon_cor_rot</code> in the type.</p>",
        "id": 527577479,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1751928350
    },
    {
        "content": "<p>linarith doesn't work on ENNReal, so I proved the equations with <code>vol'</code> in place of <code>vol</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">vol'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ps</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Piece</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">vol</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>There's something with at least quadratic runtime in the way lean parses long lists, so I split  one up into 100 parts so that I could spell out the equations I need explicitly. </p>\n<p>I've then put what should be a conjunction of all necessary equations into scope. <code>linarith</code> looks like it's trying to work, but it runs out of stack space.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxRecDepth</span><span class=\"w\"> </span><span class=\"mi\">100000</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"mi\">200000000</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">init_vols</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">vol'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">12823413011547414368862997525616691741041579688920794331363953564934456759066858494476606822552437442098640979</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">877512406035620068631903180662851572553488753575243048137500508983979170248733422547196905684808937723408093</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">init</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">finRange</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\">  </span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">allparts2</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ps</span><span class=\"o\">,</span><span class=\"n\">cs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">vol'</span><span class=\"w\"> </span><span class=\"n\">ps</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cs</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">vol'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">vol_full'</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h''</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">vol_empty'</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">allparts2</span><span class=\"o\">,</span><span class=\"n\">allparts</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">part0</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map_cons</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map_nil</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">flatMap_cons</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">flatMap_nil</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">append_nil</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons_append</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil_append</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">reduceDiv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_true</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part1</span><span class=\"o\">,</span><span class=\"n\">part2</span><span class=\"o\">,</span><span class=\"n\">part3</span><span class=\"o\">,</span><span class=\"n\">part4</span><span class=\"o\">,</span><span class=\"n\">part5</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part6</span><span class=\"o\">,</span><span class=\"n\">part7</span><span class=\"o\">,</span><span class=\"n\">part8</span><span class=\"o\">,</span><span class=\"n\">part9</span><span class=\"o\">,</span><span class=\"n\">part10</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part11</span><span class=\"o\">,</span><span class=\"n\">part12</span><span class=\"o\">,</span><span class=\"n\">part13</span><span class=\"o\">,</span><span class=\"n\">part14</span><span class=\"o\">,</span><span class=\"n\">part15</span><span class=\"o\">,</span><span class=\"n\">part16</span><span class=\"o\">,</span><span class=\"n\">part17</span><span class=\"o\">,</span><span class=\"n\">part18</span><span class=\"o\">,</span><span class=\"n\">part19</span><span class=\"o\">,</span><span class=\"n\">part20</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part21</span><span class=\"o\">,</span><span class=\"n\">part22</span><span class=\"o\">,</span><span class=\"n\">part23</span><span class=\"o\">,</span><span class=\"n\">part24</span><span class=\"o\">,</span><span class=\"n\">part25</span><span class=\"o\">,</span><span class=\"n\">part26</span><span class=\"o\">,</span><span class=\"n\">part27</span><span class=\"o\">,</span><span class=\"n\">part28</span><span class=\"o\">,</span><span class=\"n\">part29</span><span class=\"o\">,</span><span class=\"n\">part30</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part31</span><span class=\"o\">,</span><span class=\"n\">part32</span><span class=\"o\">,</span><span class=\"n\">part33</span><span class=\"o\">,</span><span class=\"n\">part34</span><span class=\"o\">,</span><span class=\"n\">part35</span><span class=\"o\">,</span><span class=\"n\">part36</span><span class=\"o\">,</span><span class=\"n\">part37</span><span class=\"o\">,</span><span class=\"n\">part38</span><span class=\"o\">,</span><span class=\"n\">part39</span><span class=\"o\">,</span><span class=\"n\">part40</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part41</span><span class=\"o\">,</span><span class=\"n\">part42</span><span class=\"o\">,</span><span class=\"n\">part43</span><span class=\"o\">,</span><span class=\"n\">part44</span><span class=\"o\">,</span><span class=\"n\">part45</span><span class=\"o\">,</span><span class=\"n\">part46</span><span class=\"o\">,</span><span class=\"n\">part47</span><span class=\"o\">,</span><span class=\"n\">part48</span><span class=\"o\">,</span><span class=\"n\">part49</span><span class=\"o\">,</span><span class=\"n\">part50</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part51</span><span class=\"o\">,</span><span class=\"n\">part52</span><span class=\"o\">,</span><span class=\"n\">part53</span><span class=\"o\">,</span><span class=\"n\">part54</span><span class=\"o\">,</span><span class=\"n\">part55</span><span class=\"o\">,</span><span class=\"n\">part56</span><span class=\"o\">,</span><span class=\"n\">part57</span><span class=\"o\">,</span><span class=\"n\">part58</span><span class=\"o\">,</span><span class=\"n\">part59</span><span class=\"o\">,</span><span class=\"n\">part60</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part61</span><span class=\"o\">,</span><span class=\"n\">part62</span><span class=\"o\">,</span><span class=\"n\">part63</span><span class=\"o\">,</span><span class=\"n\">part64</span><span class=\"o\">,</span><span class=\"n\">part65</span><span class=\"o\">,</span><span class=\"n\">part66</span><span class=\"o\">,</span><span class=\"n\">part67</span><span class=\"o\">,</span><span class=\"n\">part68</span><span class=\"o\">,</span><span class=\"n\">part69</span><span class=\"o\">,</span><span class=\"n\">part70</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part71</span><span class=\"o\">,</span><span class=\"n\">part72</span><span class=\"o\">,</span><span class=\"n\">part73</span><span class=\"o\">,</span><span class=\"n\">part74</span><span class=\"o\">,</span><span class=\"n\">part75</span><span class=\"o\">,</span><span class=\"n\">part76</span><span class=\"o\">,</span><span class=\"n\">part77</span><span class=\"o\">,</span><span class=\"n\">part78</span><span class=\"o\">,</span><span class=\"n\">part79</span><span class=\"o\">,</span><span class=\"n\">part80</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part81</span><span class=\"o\">,</span><span class=\"n\">part82</span><span class=\"o\">,</span><span class=\"n\">part83</span><span class=\"o\">,</span><span class=\"n\">part84</span><span class=\"o\">,</span><span class=\"n\">part85</span><span class=\"o\">,</span><span class=\"n\">part86</span><span class=\"o\">,</span><span class=\"n\">part87</span><span class=\"o\">,</span><span class=\"n\">part88</span><span class=\"o\">,</span><span class=\"n\">part89</span><span class=\"o\">,</span><span class=\"n\">part90</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">part91</span><span class=\"o\">,</span><span class=\"n\">part92</span><span class=\"o\">,</span><span class=\"n\">part93</span><span class=\"o\">,</span><span class=\"n\">part94</span><span class=\"o\">,</span><span class=\"n\">part95</span><span class=\"o\">,</span><span class=\"n\">part96</span><span class=\"o\">,</span><span class=\"n\">part97</span><span class=\"o\">,</span><span class=\"n\">part98</span><span class=\"o\">,</span><span class=\"n\">part99</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">linarith</span>\n</code></pre></div>",
        "id": 528166662,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752185726
    },
    {
        "content": "<p>If you get a certificate you can use <code>linear_combination</code> instead, which takes the burden of finding a solution off Lean.</p>",
        "id": 528166928,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752185918
    },
    {
        "content": "<p>Thanks, that's very helpful. I hadn't realized what a proof certificate would look like until you told me about that.</p>\n<p>I think the sum of rows of the inverse matrix of A (where Ax=b is the system of linear equations), so solving Aᵀy = v (where v describes the equation I want to verify) gives me the coefficients I need for linear_combination. I might try and find another way to use those coefficients, since the linear_combination line would have to be awkwardly long, and getting concrete statements of particular equations isn't straightforward (evaluating canon_cor_rot several thousand times doesn't seem to work unless I use native_decide).</p>",
        "id": 528365446,
        "sender_full_name": "Toby Cathcart Burn",
        "timestamp": 1752248601
    }
]