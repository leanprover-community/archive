[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subsingleton</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">grind</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Subsingleton</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>What would be the right pattern to get <code>grind</code> to work here? I’ve tried all variants of the <code>[grind]</code> attribute on <code>Subsingleton.elim</code> and various related subsingleton lemmas, but none seem to be working.</p>\n<p>Note that <code>grind</code> reports </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">issue</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"bp\">-</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">for</span>\n<span class=\"w\">        </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>Is this worth escalating to a lean4 issue or is this user issue?</p>",
        "id": 528936623,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1752611336
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subsingleton</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ext</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Subsingleton</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>",
        "id": 528943640,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752614381
    },
    {
        "content": "<p>It seems <code>@[grind ext]</code> is not documented in the manual!?</p>",
        "id": 528943888,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1752614494
    },
    {
        "content": "<p>Thanks!<br>\nIt would be cool if <code>grind ext</code> was documented in the reference manual (to which subsystem of grind is it talking to?)</p>",
        "id": 528943908,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1752614505
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> does adding <code>ext</code> to <code>Subsingleton.elim</code> and making <code>grind ext</code> seem like reasonable annotations to you? This looks like annotations that Core should make rather than Mathlib.</p>",
        "id": 532268296,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754041321
    },
    {
        "content": "<p>Subsingleton isn't cheap to always try (failures can take some time).</p>\n<p>Mathlib has a FastSubsingleton class used by <code>congr!</code> and friends for that reason.</p>",
        "id": 532296062,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754051328
    },
    {
        "content": "<p>I expect that could have serious performance issues. IIRC <code>simp</code> did a subsingleton check on every subterm, but that is also not the default anymore for performance reasons(?)</p>",
        "id": 532296064,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1754051329
    },
    {
        "content": "<p>So better to make it <code>[local grind ext]</code> only where relevant?</p>",
        "id": 532296423,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754051433
    },
    {
        "content": "<p>Note that this came up when trying to use grind in <code>CategoryTheory</code> for things related to discrete categories or thin quivers. <code>aesop_cat</code> has no trouble using subsingletons instances but <code>grind</code> needs some help with those.</p>",
        "id": 532296737,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1754051545
    },
    {
        "content": "<p>Yes, I think we add it as an aesop rule in the CategoryTheory ruleset.</p>",
        "id": 533398204,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754629828
    }
]