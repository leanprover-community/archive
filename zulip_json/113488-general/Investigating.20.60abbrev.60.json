[
    {
        "content": "<p>I want to gain a better understanding of what <code>abbrev</code> does.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">NaturalNumber</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NaturalNumber</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is there a way to examine how this code is interpreted by Lean, and why it doesn’t result in an error?</p>",
        "id": 524053417,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1749894224
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> <code>abbrev</code> means that \"when you're doing typeclass search, unfold this\". For example, for the notation <code>+</code> to work on a type <code>α</code>, you first need to provide an instance of <code>Add α</code>. If you now have <code>def Test := α</code> and try to do <code>+</code> on <code>Test</code>; it wouldn't work, because the typeclass search can't figure out the instance of <code>Add Test</code>; but if you do <code>abbrev Test := α</code> instead, then the typeclass will unfold <code>Add Test</code> to <code>Add α</code>, and will then successfully find the instance.</p>",
        "id": 524053898,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749894836
    },
    {
        "content": "<p>Code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\">       </span><span class=\"c1\">-- control</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\">  </span><span class=\"c1\">-- failed to synthesize HAdd (Test α) (Test α) ?m.154</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Test'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Test'</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>",
        "id": 524054014,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749894959
    },
    {
        "content": "<p>Is there a way to verify in Lean code that type class resolution looked for an instance of <code>Add α</code> rather than <code>Add Test</code>?</p>",
        "id": 524054035,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1749894981
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> <br>\n<a href=\"/user_uploads/3121/Dla8DTH_iKrNAaaCnMifigXO/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Dla8DTH_iKrNAaaCnMifigXO/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"508x210\" src=\"/user_uploads/thumbnail/3121/Dla8DTH_iKrNAaaCnMifigXO/image.png/840x560.webp\"></a></div><p>If you put your text cursor on the <code>#check</code> and click on the <code>x + y</code> in the infoview and keep clicking, this is what you will see</p>",
        "id": 524054147,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749895110
    },
    {
        "content": "<p>Lean synthesised <code>HAdd (Test' α) (Test' α) (Test' α)</code> from the instance of <code>Add α</code>.</p>",
        "id": 524054194,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749895158
    },
    {
        "content": "<p>nice!</p>",
        "id": 524054209,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1749895193
    },
    {
        "content": "<p>thank you very much!</p>",
        "id": 524054229,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1749895207
    }
]