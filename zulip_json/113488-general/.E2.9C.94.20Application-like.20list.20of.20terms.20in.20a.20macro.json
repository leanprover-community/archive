[
    {
        "content": "<p>I want to have <code>absurd</code> as a tactic. For this purpose, I defined the following macro:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"absurd \"</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"s2\">\" , \"</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>But this way syntax of <code>absurd</code> is different in term mode and in tactic mode, which is a bit annoying. Is there a way to define <code>absurd</code> in such a way so it behaves exactly like the corresponding term?</p>",
        "id": 527576799,
        "sender_full_name": "suhr",
        "timestamp": 1751927934
    },
    {
        "content": "<p>I think <code>absurd</code> is already a tactic</p>",
        "id": 527576978,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751928043
    },
    {
        "content": "<p>Not in vanilla Lean. But it indeed is defined in Batteries.</p>",
        "id": 527577461,
        "sender_full_name": "suhr",
        "timestamp": 1751928335
    },
    {
        "content": "<p>I think you just need to set the precedence correctly on the terms. The first one should have precedence <code>lead</code> IIRC</p>",
        "id": 527591720,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751939547
    },
    {
        "content": "<p>and the second one should have precedence <code>arg</code> if you want to match application (and in particular not parse <code>absurd f x y</code> as <code>absurd f (x y)</code>)</p>",
        "id": 527591915,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751939731
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"absurd \"</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">lead</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 527591925,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751939740
    },
    {
        "content": "<p>This does not seem to work, unfortunately. For example, it parses <code>absurd this (Nat.lt_irrefl n)</code> as application of <code>this</code>.</p>",
        "id": 527658982,
        "sender_full_name": "suhr",
        "timestamp": 1751972668
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"absurd \"</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n</code></pre></div>",
        "id": 527663067,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751973899
    },
    {
        "content": "<p>The tactic could be a little more helpful than the <code>absurd</code> term and try both argument orders:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"absurd \"</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"n\">first</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÇ</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e‚ÇÅ</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"s2\">\"could not find absurdity\"</span>\n<span class=\"w\">  </span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- error: could not find absurdity</span>\n</code></pre></div>",
        "id": 527663603,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751974087
    },
    {
        "content": "<p>That works, thanks.</p>",
        "id": 527670816,
        "sender_full_name": "suhr",
        "timestamp": 1751976310
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"394485\">suhr</span> has marked this topic as resolved.</p>",
        "id": 527670857,
        "sender_full_name": "Notification Bot",
        "timestamp": 1751976323
    },
    {
        "content": "<p>Is this 2-argument <code>absurd</code> useful though? <code>contradiction</code> should be able to deal with such cases.</p>",
        "id": 538199850,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1757331240
    },
    {
        "content": "<p>Let's continue the conversation at the new topic, <a class=\"message-link\" href=\"/#narrow/channel/348111-batteries/topic/Remove.20hypothesis.20in.20absurd.20tactic/near/538195248\">#batteries &gt; Remove hypothesis in absurd tactic @ üí¨</a></p>",
        "id": 538201905,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1757331851
    }
]