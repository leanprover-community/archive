[
    {
        "content": "<p>I made a web site \"Code with Proofs: The Arena\", where users can create coding problems with formal specifications (as Lean theorem statements); other users can submit solutions consists of code and proof, and be judged by the Lean proof checker.</p>\n<p>The code is open sourced at <a href=\"https://github.com/GasStationManager/CodeProofTheArena\">https://github.com/GasStationManager/CodeProofTheArena</a>, with a demo site up at <a href=\"http://www.codeproofarena.com:8000/\">http://www.codeproofarena.com:8000/</a></p>\n<p>If you are interested in Lean as a general programming language with ability for formal verification, you might enjoy the practice! Right now the demo site has some relatively easy problems taken from <a href=\"https://github.com/GasStationManager/CodeProofBenchmark\">https://github.com/GasStationManager/CodeProofBenchmark</a> Feel free to create your own challenges!<br>\n<br>\nThis is a work in progress. Feature requests are welcome! Or even better, contribute to the project.</p>\n<p>The stated goal of the site is to collect and share data, for the training of open source coding AI. See my essay <a href=\"https://gasstationmanager.github.io/ai/2024/11/04/a-proposal.html\">https://gasstationmanager.github.io/ai/2024/11/04/a-proposal.html</a> for more details on the motivation.</p>",
        "id": 482500649,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731626625
    },
    {
        "content": "<p>I don't get it. To submit a solution I have to log in but I don't see how to create an account. Normally there would be a link \"Don't have an account? Make one!\" on the login page. Sorry to be dense.</p>",
        "id": 482589389,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731669487
    },
    {
        "content": "<p>I see this at the top:<br>\n<a href=\"/user_uploads/3121/qwt7z38r3dbPjRcXN0068zcu/Screenshot-from-2024-11-15-12-19-07.png\">Screenshot from 2024-11-15 12-19-07.png</a><br>\nand it seems like the \"Register\" text links to what you're looking for</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/qwt7z38r3dbPjRcXN0068zcu/Screenshot-from-2024-11-15-12-19-07.png\" title=\"Screenshot from 2024-11-15 12-19-07.png\"><img data-original-dimensions=\"336x51\" src=\"/user_uploads/thumbnail/3121/qwt7z38r3dbPjRcXN0068zcu/Screenshot-from-2024-11-15-12-19-07.png/840x560.webp\"></a></div>",
        "id": 482589620,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731669580
    },
    {
        "content": "<p>Due to the main page being displayed with a white background and the top line being displayed with a black background (the same colour background as my bookmarks bar etc), I literally didn't even notice that line. Thanks!</p>",
        "id": 482590680,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731669930
    },
    {
        "content": "<p>Both Eric and me are trying to break the system for the last challenge, and currently I'm winning: <br>\n<a href=\"http://5.78.72.236:8000/challenges/23/submissions\">http://5.78.72.236:8000/challenges/23/submissions</a></p>",
        "id": 482593059,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731670811
    },
    {
        "content": "<p>Oh apologies <span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> , the system became unresponsive so I mashed \"submit\" lots of times to try and spark it into life and now you have lots of correct submissions from me to the first challenge :-(</p>",
        "id": 482593567,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731671004
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482593059\">said</a>:</p>\n<blockquote>\n<p>Both Eric and me are trying to break the system for the last challenge, and currently I'm winning: <br>\n<a href=\"http://5.78.72.236:8000/challenges/23/submissions\">http://5.78.72.236:8000/challenges/23/submissions</a></p>\n</blockquote>\n<p>I got there in the end :)</p>",
        "id": 482593650,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731671037
    },
    {
        "content": "<p>So <span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> the point of these attacks on the last problem is just to show how people can be evil in various ways. There was one of these systems for Coq years ago, where you could actually win bitcoin by proving theorems, and people would find hacks and clean the system out :-(</p>",
        "id": 482594110,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731671194
    },
    {
        "content": "<p>a good first start might be to make some sort of check that whatever is given as a solution is a term?</p>",
        "id": 482668828,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731694314
    },
    {
        "content": "<p>additionally, it turns out you may make uncompilable challenges, which is a bit annoying...</p>",
        "id": 482669011,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731694378
    },
    {
        "content": "<p>Bit of a quibble, but it wasn't clear to me that I had to include a := in my solution at first.</p>",
        "id": 482669714,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731694644
    },
    {
        "content": "<p>i'm curious how bad the breakage gets... can someone find a solution to <a href=\"http://5.78.72.236:8000/challenges/25\">this challenge</a>?</p>",
        "id": 482669983,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731694734
    },
    {
        "content": "<p>Another note: It would be nice if the link to the playground came pre-loaded with the code relevant to the challenge.</p>",
        "id": 482672830,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731695767
    },
    {
        "content": "<p>Is there a canonical setup (version number, etc. ) for the problems?  I have a few proofs that work on my machine that aren't accepted on the server.  Thanks.</p>",
        "id": 482673537,
        "sender_full_name": "Kent Van Vels",
        "timestamp": 1731696025
    },
    {
        "content": "<p>Outstanding</p>",
        "id": 482674429,
        "sender_full_name": "Quinn",
        "timestamp": 1731696384
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482669983\">said</a>:</p>\n<blockquote>\n<p>i'm curious how bad the breakage gets... can someone find a solution to <a href=\"http://5.78.72.236:8000/challenges/25\">this challenge</a>?</p>\n</blockquote>\n<p>Yes</p>",
        "id": 482677234,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731697346
    },
    {
        "content": "<p>oooh, cool</p>",
        "id": 482677457,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1731697431
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482668828\">said</a>:</p>\n<blockquote>\n<p>a good first start might be to make some sort of check that whatever is given as a solution is a term?</p>\n</blockquote>\n<p>I think the premise for how to check these is wrong; this has been thought about before in <a class=\"stream\" data-stream-id=\"187764\" href=\"/#narrow/channel/187764-Lean-for-teaching\">#Lean for teaching</a>, and I think the approach is to have a lean program that uses <code>withImportModules</code> to read the user code, and then inspects the resulting environment to check the statements are what they are supposed to be.</p>",
        "id": 482677548,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731697452
    },
    {
        "content": "<p>Quibbles aside, this is a very cool project! I don't think previous attempts at this like (seemingly now defunct) Math Genome Project have had any mechanism for actually checking proofs. Kudos <span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> !</p>",
        "id": 482681829,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731699068
    },
    {
        "content": "<p>Thanks all for testing it out! I did not know of these cool ways to bypass the proof checker :) Right now the code only checked for sorry warnings, and it compiles the function by itself first to prevent wrapping the theorem in comments. I'll look into <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  suggestion of <code>withImportModules</code>, thanks! Would that in theory defend against all known attacks?</p>",
        "id": 482683930,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731699881
    },
    {
        "content": "<p>If you combined it with an axiom check, then I think so</p>",
        "id": 482684018,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731699927
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"519925\">Kent Van Vels</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482673537\">said</a>:</p>\n<blockquote>\n<p>Is there a canonical setup (version number, etc. ) for the problems?  I have a few proofs that work on my machine that aren't accepted on the server.  Thanks.</p>\n</blockquote>\n<p>It is the mathlib4 version I pulled a couple days ago, and the lean-toolchain that it points to. Looking at lake-manifest.json the mathlib4 revision is 4ac7881bba2522f56411a175689efe7039731fb9. And Lean version is<br>\nLean (version 4.14.0-rc2, x86_64-unknown-linux-gnu, commit 7dc1ceb8d431, Release)</p>",
        "id": 482694736,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731704892
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482684018\">said</a>:</p>\n<blockquote>\n<p>If you combined it with an axiom check, then I think so</p>\n</blockquote>\n<p>What do you mean by an axiom check? To check the user has not introduced any new axioms?</p>",
        "id": 482715505,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731716445
    },
    {
        "content": "<p>After using <code>withImportModules</code>, you should call <code>Lean.collectAxioms</code> on the theorem name you intend to check, and verify only the standard three axioms are used</p>",
        "id": 482720641,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731720332
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> ! Another noob question: would I be on the right track if I do the following: first compile the submission file with <code>lean -o</code>, then start with something like <a href=\"https://github.com/kim-em/lean-training-data/blob/master/scripts/declaration_types.lean\">https://github.com/kim-em/lean-training-data/blob/master/scripts/declaration_types.lean</a> ? What's the difference between Lean.withImportModules and Mathlib's CoreM.withImportModules (used by the above script)?</p>",
        "id": 482727446,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731726032
    },
    {
        "content": "<p>Trying to install the github project (on mac) I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">sudo</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">postgres</span><span class=\"w\"> </span><span class=\"n\">psql</span>\n\n<span class=\"n\">sudo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"n\">postgres</span>\n<span class=\"n\">sudo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">initializing</span><span class=\"w\"> </span><span class=\"n\">audit</span><span class=\"w\"> </span><span class=\"n\">plugin</span><span class=\"w\"> </span><span class=\"n\">sudoers_audit</span>\n</code></pre></div>\n<p>Should I expect this to work on macOS or do I need to be on Linux?</p>",
        "id": 482801663,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731790530
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482801663\">said</a>:</p>\n<blockquote>\n<p>Trying to install the github project (on mac) I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">sudo</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">postgres</span><span class=\"w\"> </span><span class=\"n\">psql</span>\n\n<span class=\"n\">sudo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"n\">postgres</span>\n<span class=\"n\">sudo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">initializing</span><span class=\"w\"> </span><span class=\"n\">audit</span><span class=\"w\"> </span><span class=\"n\">plugin</span><span class=\"w\"> </span><span class=\"n\">sudoers_audit</span>\n</code></pre></div>\n<p>Should I expect this to work on macOS or do I need to be on Linux?</p>\n</blockquote>\n<p>I only tested on Linux (Ubuntu). For this part, assuming the postgresql server is installed and running, the main thing needed is to log into postgresql with whichever is the superuser account for the postgresql installation, and then create the database etc following the rest of the instructions</p>",
        "id": 482806224,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731794997
    },
    {
        "content": "<p>This <a href=\"https://stackoverflow.com/questions/70487669/postgres-superuser-is-not-created-upon-installation\">Stackoverflow</a> suggests that for Mac homebrew installation of postgresql, just doing <code>psql</code> would work</p>",
        "id": 482807036,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731795739
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"519925\">@Kent Van Vels</span> You might try submitting again; the site had a bug regarding challenges with two theorems earlier, now fixed</p>",
        "id": 482807482,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731796110
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482720641\">said</a>:</p>\n<blockquote>\n<p>After using <code>withImportModules</code>, you should call <code>Lean.collectAxioms</code> on the theorem name you intend to check, and verify only the standard three axioms are used</p>\n</blockquote>\n<p>Checking the used axioms is still insufficient because you can redefine axioms:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries.Tactic.OpenPrivate</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Redefine `propext : False`. -/</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">Environment.mk</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Lean.Environment</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"k\">#eval</span><span class=\"w\"> </span><span class=\"n\">modifyEnv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">env.constants</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"n\">map‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env.constants.map‚ÇÅ.insert</span><span class=\"w\"> </span><span class=\"ss\">``propext</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">axiomInfo</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">          </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">``propext</span>\n<span class=\"w\">          </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``False</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">          </span><span class=\"n\">levelParams</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">          </span><span class=\"n\">isUnsafe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">        </span><span class=\"o\">})</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">Environment.mk</span><span class=\"w\"> </span><span class=\"n\">env.const2ModIdx</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"w\"> </span><span class=\"n\">env.extensions</span><span class=\"w\"> </span><span class=\"n\">env.extraConstNames</span><span class=\"w\"> </span><span class=\"n\">env.header</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">efsq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span>\n<span class=\"w\">    </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exfalso</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">propext</span>\n\n<span class=\"c1\">-- 'efsq' depends on axioms: [propext]</span>\n<span class=\"k\">#print</span><span class=\"w\"> </span><span class=\"kd\">axioms</span><span class=\"w\"> </span><span class=\"n\">efsq</span>\n</code></pre></div>",
        "id": 482808260,
        "sender_full_name": "ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí",
        "timestamp": 1731796889
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"128280\">@Wojciech Nawrocki</span> Nice one! I guess to check for this, we would pre-compute and store the correct types for the axioms, then after <code>withImportModules</code>, check whether any of the axioms has been redefined..</p>",
        "id": 482809414,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731798006
    },
    {
        "content": "<p>I would suggest using <code>Environment.replay</code> to protect against poisoned environments created via the constructor. (This is why we wrote <code>replay</code>.)</p>",
        "id": 482809723,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731798310
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> ! That's very cool, I'll look into it. Quick question: when I google this I got both Lean.Replay and the repo lean4checker. Should I be looking at both?</p>",
        "id": 482810711,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731799268
    },
    {
        "content": "<p>lean4checker is using <code>replay</code>. It's essentially just a command line frontend around it, so it depends on your exact use case whether it's useful. Likely you just want to use it as an example.</p>",
        "id": 482810841,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731799422
    },
    {
        "content": "<p>Actually, <span class=\"user-mention\" data-user-id=\"128280\">@Wojciech Nawrocki</span>'s example replacing an axiom probably should have a test case in the <code>lean4checker</code> repository, if only for the sake of documenting the variety of \"attacks\" it protects against.</p>",
        "id": 482810957,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731799557
    },
    {
        "content": "<p>I think it's different from what we have there at this point.</p>",
        "id": 482811007,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731799572
    },
    {
        "content": "<p>Thanks, the <code>psql</code> command worked with some debugging. </p>\n<p>I am now not sure what change to <code>alembic.ini</code> step 5 is telling me to make.</p>\n<p>I don't know if this related but when I run the application without this, and try to access the list of challenges, I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">sqlalchemy</span><span class=\"bp\">.</span><span class=\"n\">exc</span><span class=\"bp\">.</span><span class=\"n\">ProgrammingError</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">psycopg2</span><span class=\"bp\">.</span><span class=\"n\">errors</span><span class=\"bp\">.</span><span class=\"n\">UndefinedTable</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">relation</span><span class=\"w\"> </span><span class=\"s2\">\"challenges\"</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">exist</span>\n<span class=\"n\">LINE</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FROM</span><span class=\"w\"> </span><span class=\"n\">challenges</span><span class=\"w\"> </span><span class=\"n\">JOIN</span><span class=\"w\"> </span><span class=\"n\">users</span><span class=\"w\"> </span><span class=\"n\">ON</span><span class=\"w\"> </span><span class=\"n\">challenges</span><span class=\"bp\">.</span><span class=\"n\">owner_id</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">users</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 482811889,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731800527
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482811889\">said</a>:</p>\n<blockquote>\n<p>Thanks, the <code>psql</code> command worked with some debugging. </p>\n<p>I am now not sure what change to <code>alembic.ini</code> step 5 is telling me to make.<br>\n</p>\n</blockquote>\n<p>Around line 64 in the file, it is setting sqlalchemy.url to connect to your local postgresql server. Replace the password there with what you chose in the previous step. Then the alembic command in the next step will connect to the db and create the tables</p>",
        "id": 482813123,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731801793
    },
    {
        "content": "<p>Ok I substituted \"LocalPass\" on line 64 with the password I set in step 4, but I am still getting the same error.</p>",
        "id": 482814159,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731802844
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"282271\">@Bolton Bailey</span>  Now redo Step 6 : <br>\n<code>poetry run alembic upgrade head</code> <br>\nThis should create the tables</p>",
        "id": 482814374,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731803095
    },
    {
        "content": "<p>Ah, yes of course that makes sense, I wasn't reading carefully</p>",
        "id": 482814410,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731803145
    },
    {
        "content": "<p>Sweet, no more error, the site works locally for me now</p>",
        "id": 482814463,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731803166
    },
    {
        "content": "<p>A brief update: I have gotten a domain name for the demo site: <a href=\"http://www.codeproofarena.com:8000/\">http://www.codeproofarena.com:8000/</a> so now you don't have to remember the IP address :) <br>\nAs suggested by <span class=\"user-mention\" data-user-id=\"282271\">@Bolton Bailey</span> , now the link to the playground from the submission page will load the function and theorem signatures into the playground.</p>",
        "id": 482901018,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731881666
    },
    {
        "content": "<p>I would like to be able to put simple open questions on this website. One way I could imagine doing this is by having the user specify either \"true\" or \"false\", and then prove the theorem in question is equivalent to the truth value they specified. The trouble is, in the same vein as the \"determine\" problem for IMO problems, someone might just specify the full proposition they are trying to decide as their value.</p>\n<p>Is there some native way in Lean to detect that a term is represented in a sufficiently simple form (i.e. only using a certain specified set of functions or constructors)?</p>",
        "id": 482910204,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731890591
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/482810957\">said</a>:</p>\n<blockquote>\n<p>Actually, <span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span>'s example replacing an axiom probably should have a test case in the <code>lean4checker</code> repository, if only for the sake of documenting the variety of \"attacks\" it protects against.</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover/lean4checker/pull/31\">https://github.com/leanprover/lean4checker/pull/31</a></p>",
        "id": 482910337,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731890736
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"282271\">@Bolton Bailey</span> One approach might be that the user can select to either prove the statement or the negation of the statement. Depending on the selection, the corresponding signature is given. Right now the website doesn't have that yet, but I think it can be very useful. E.g. given a piece of code without proof, determine whether it is correct by proving/disproving.</p>",
        "id": 482922277,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731900310
    },
    {
        "content": "<p>Another question for <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> and other experts here: we've been working on a more robust theorem checking script based on everyone's suggestions, here's a work-in-progress prototype: <a href=\"https://github.com/GasStationManager/SafeVerify\">https://github.com/GasStationManager/SafeVerify</a> <br>\nIt is mostly adapted from lean4checker. It takes two .olean files, run Environment.replay on them, and compare the theorem types; also checks for axioms used. One issues is I would like to check for the <code>noncomputable</code> flag for definitions; for coding tasks this could allow cheating by producing an answer using e.g. <code>Classical.ofNonempty</code>. But it seems <code>noncomputable</code>  is not part of the ConstantInfo but is in the environment extension. So Environment.replay is not going to load it into the environment (since it only loads the constants). The information should still be in the olean file / ModuleData, but I'm not knowledgeable enough to extract it. Once it is in the environment I can use <code>isNoncomputable</code> to access it. One thing I could do is to re-load the entire file with <code>withImportModules</code>;  would I need to put the file somewhere in the search path?</p>",
        "id": 483137652,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731969570
    },
    {
        "content": "<p>I'm a bit skeptical that it is useful to look at the noncomputable flag, but maybe. <code>withImportModules</code> sounds like the way to go.</p>",
        "id": 483138079,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731969760
    },
    {
        "content": "<p>Isn't the flag meaningless, because I could be using <code>implemented_by something_entirely_different</code>?</p>",
        "id": 483141696,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731971257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> interesting; I'll have to understand more how implemented_by works.<br>\nBut yes the general question is whether noncomputable is the right thing to check, to make sure the function is actually going to compute the answer. I could disallow the use of Classical.choice for the function def (so only propext and Quot.sound allowed); would that be too restrictive?</p>",
        "id": 483145113,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731972644
    },
    {
        "content": "<p>Many of the Lean ecosystem's close-to-the-metal functionalities assume choice, so I would suggest trying to allow it. I believe <code>simp</code> for example invokes choice.</p>",
        "id": 483145426,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731972776
    },
    {
        "content": "<p>What type of cheating are you trying to catch here? Do you have an example in mind?</p>",
        "id": 483146585,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731973237
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> The type of question I had in mind is asking for a function to produce an element from a set that is known to be nonempty but perhaps not trivial to compute. E.g. a Nash equilibrium of a game. Could one use Classical.ofNonempty to \"generate\" an element without computing it?</p>",
        "id": 483147210,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731973526
    },
    {
        "content": "<p>Would you accept an algorithm that doesn't terminate in the lifetime of the universe?</p>",
        "id": 483148902,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731974365
    },
    {
        "content": "<p>You're also in trouble here if your \"computation\" is real-valued, since division and comparison on <code>Real</code>s is noncomputable, so you can't write any algorithm that \"compute\"s in the sense of <code>noncomputable</code></p>",
        "id": 483149224,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731974477
    },
    {
        "content": "<p>Or perhaps the solution is to actually try to run the function with a single test input, and Lean would given an error/fail to compile if it is noncomputable</p>",
        "id": 483149316,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731974521
    },
    {
        "content": "<p>What would be nice would be some kind of proven guarantee of the performance, sort of like <a href=\"http://www.codeproofarena.com:8000/challenges/27\">this example</a>, but Lean doesn't really have a way to do that for normal Lean functions yet.</p>",
        "id": 483149744,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731974694
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> running time would be an issue but the first step is to ensure there is actually an algorithm provided</p>",
        "id": 483149777,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731974710
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/483149316\">said</a>:</p>\n<blockquote>\n<p>Or perhaps the solution is to actually try to run the function with a single test input, and Lean would given an error/fail to compile if it is noncomputable</p>\n</blockquote>\n<p>This doesn't tell you anything at all:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">implemented_by</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"kd\">]</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">definitely_at_least_two</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Exists</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚ü®</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">definitely_at_least_two_spec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">definitely_at_least_two</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Exists</span><span class=\"bp\">.</span><span class=\"n\">choose_spec</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">definitely_at_least_two</span><span class=\"w\"> </span><span class=\"c1\">-- 0</span>\n</code></pre></div>",
        "id": 483149779,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731974711
    },
    {
        "content": "<p>Lean doesn't make any strong guarantees that the compiled output faithfully reflects the model you proved things about. All it guarantees is that the proofs about your ideal model really are sound.</p>",
        "id": 483149941,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731974781
    },
    {
        "content": "<p>It makes weak guarantees: namely that if the model and compiler diverges in core, that's a bug; and if it the model and compiler diverge in your own code that uses <code>implemented_by</code> or <code>unsafe</code>, then you got what you asked for.</p>",
        "id": 483150106,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731974865
    },
    {
        "content": "<p>(In particular, if you want to trust the compiled output you need to trust all the <code>implemented_by</code> attributes in your codebase.)</p>",
        "id": 483150115,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731974873
    },
    {
        "content": "<p>For the purposes of this project, is there some way to simply guarantee that a particular codebase doesn't use the <code>implemented_by</code> or <code>unsafe</code> constructs?</p>",
        "id": 483150310,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1731974972
    },
    {
        "content": "<p>That wouldn't help with things like <a href=\"#narrow/channel/113489-new-members/topic/Nat.2Eble.20.3F.3F.3F/near/482551997\">the issue with <code>Nat.ble</code> in this thread</a> where the model and compiler diverge in core.</p>",
        "id": 483150433,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731975019
    },
    {
        "content": "<p>Yes, but it would help.</p>",
        "id": 483150472,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731975036
    },
    {
        "content": "<p>I guess also building a contest to find inconsistencies in core between the model and compiler is probably good for lean, but it's bad for the problems that you meant to ask users to solve, and it's possibly bad from a security perspective to do that in public.</p>",
        "id": 483150544,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731975084
    },
    {
        "content": "<p>I <em>think</em> that if you use the environment after using <code>replay</code>, all <code>implemented_by</code> and <code>unsafe</code> have been stripped out? That doesn't actually tell you whether they were present.</p>",
        "id": 483150577,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731975099
    },
    {
        "content": "<p>Perhaps it makes sense to have an option (perhaps irreversible??) that disables <code>implemented_by</code> and <code>unsafe</code> from that point onwards. I'm not at all sure what this would look like, however.</p>",
        "id": 483151478,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731975578
    },
    {
        "content": "<p>I was just having a look at <code>unsafe</code> and <code>implemented_by</code> in Mathlib, they are used once or twice in meta-programming tools.</p>",
        "id": 483151511,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731975598
    },
    {
        "content": "<p>I wouldn't mind trying to move those out of Mathlib, then banning these.</p>",
        "id": 483151575,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731975613
    },
    {
        "content": "<p>I've argued before that <code>implemented_by</code> should be treated like an axiom, rather than <code>ofReduceBool</code>. <code>ofReduceBool</code> isn't so much an axiom itself as a license to use another brand of axiom</p>",
        "id": 483152528,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976111
    },
    {
        "content": "<p>as long as it has the current meaning, it's almost useless for actual threat assessment unless you want to check that it is not used at all</p>",
        "id": 483152592,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976149
    },
    {
        "content": "<p>From the raw perspective of \"what is the consistency strength of the system with this axiom added\", for <code>ofReduceBool</code> the answer is trivially \"it's inconsistent\" if you don't track <code>implemented_by</code> statements. It's the same thing as if we had a tool which checks whether you have used any axioms (without regard to the number or statement of those axioms), it's pretty much useless unless the answer is \"no axioms\"</p>",
        "id": 483152845,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976284
    },
    {
        "content": "<p>unfortunately, it is not so easy to tell whether an <code>implemented_by</code> has been used, since the compiler doesn't keep track and the resulting code just has the replaced definition, you can't tell if it was supposed to be something else or if that was actually the definition called</p>",
        "id": 483153150,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976441
    },
    {
        "content": "<p>You can get a pretty good estimation if you simulate the replacement process on lean source expressions - just look for uses of the constant to be replaced, and you find one, mark that implemented_by as used and traverse the replacement's definition</p>",
        "id": 483153444,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976584
    },
    {
        "content": "<p>However if an <code>extern</code> is used then you are truly hosed, because even setting aside the behavior of the FFI code itself you don't know which lean functions it calls so that you can continue the traversal</p>",
        "id": 483153560,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731976655
    },
    {
        "content": "<p>Thanks all for the helpful comments; I think I have a better understanding now. For this project my current plan is to ban implemented_by in submissions (by scanning the text). The unsafe/partial flags are already being checked (in the environment after replay). As for noncomputable functions, looks like the <code>noncomputable</code> flag might not be a reliable indicator; I'll investigate further, possibly other approach like inserting an #eval to see if the function can be run. <br>\nWhat is a simple way to run something like <code>#eval</code> in an environment after <code>replay</code>?</p>",
        "id": 483178180,
        "sender_full_name": "GasStationManager",
        "timestamp": 1731989318
    },
    {
        "content": "<p>One could easily subvert a text scan for <code>implemented_by</code>.</p>",
        "id": 483181358,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731991501
    },
    {
        "content": "<p>Here's a <a href=\"https://gist.github.com/kim-em/e604b7abc53c16c82197ba76b73f3b84\">blob of code</a> from another project that provides a bare bones \"text mode interface\" to Lean.</p>\n<p>Sorry I don't have time to explain it, but others can hopefully suggest alternatives, or explain what this does. :-)</p>",
        "id": 483181488,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731991568
    },
    {
        "content": "<p>Just checking for <code>noncomputable</code> isn't sufficient, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">computable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>",
        "id": 483181934,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731991880
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/483148902\">said</a>:</p>\n<blockquote>\n<p>Would you accept an algorithm that doesn't terminate in the lifetime of the universe?</p>\n</blockquote>\n<p>We actually have something like this in current Mathlib <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">SetTheory</span><span class=\"bp\">.</span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">Notation</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">ONote</span><span class=\"bp\">.</span><span class=\"n\">fastGrowingŒµ‚ÇÄ</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"c1\">-- this is many orders of magnitude larger than Graham's number</span>\n</code></pre></div>",
        "id": 483208992,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1732005883
    },
    {
        "content": "<p>As for everything in this thread. It doesn't seem good that it's so difficult to figure out if a proof from the formal theorem prover is in fact properly formalized...</p>",
        "id": 483212986,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1732007128
    },
    {
        "content": "<p>The <a href=\"https://github.com/GasStationManager/CodeProofTheArena\">code</a> and <a href=\"http://www.codeproofarena.com:8000/\">demo site</a> are now updated to use the new <a href=\"https://github.com/GasStationManager/SafeVerify\">proof checking script</a> based on lean4checker. Thanks all for your suggestions and testing! More stress testing is welcome :)</p>\n<p>One relevant change: earlier the system inserted <code>import Mathlib</code> by default. Under the new checking script this results in long wait times for compilation and checking. Now Mathlib is not imported by default. The challenge creator can import narrower libraries in the function signature. You can also include imports in the submissions as well, the system will scan for lines starting with <code>import</code> and put them at the beginning.</p>",
        "id": 484187838,
        "sender_full_name": "GasStationManager",
        "timestamp": 1732490152
    },
    {
        "content": "<p>There're a couple of <a href=\"#narrow/channel/217875-Is-there-code-for-X.3F/topic/Computation.20Complexity.20of.20Implementations.20in.20Lean/near/500109391\">recent</a> <a href=\"#narrow/channel/270676-lean4/topic/Expressing.20complexity.20of.20algorithms.20in.20Lean/near/500968258\">discussion</a> threads on reasoning about computational complexity in Lean. </p>\n<p>I have posted a challenge on the Arena demo site: <a href=\"http://www.codeproofarena.com:8000/challenges/48\">http://www.codeproofarena.com:8000/challenges/48</a> <br>\nwhich asks to implement Fibonacci in linear time, and specifications requiring that the operation in question is called a linear number of times (using a state monad to count). </p>\n<p>Can do a similar one for comparison sort. </p>\n<p>Question is, can this set up be circumvented? Would one be able to produce a linear-time comparison sort algorithm that passes the proof checker?</p>",
        "id": 503372263,
        "sender_full_name": "GasStationManager",
        "timestamp": 1741125402
    },
    {
        "content": "<p>It would be painful, but I believe you can circumvent it by defining you function as \"if <code>m</code>, <code>instMonad</code>, <code>op</code> are isomorphic to the specific arguments passed in the test, then pull out the cheating construction noncomputably; otherwise use some slow implementation\"</p>",
        "id": 503375717,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741126702
    },
    {
        "content": "<p>It's much less painful if you define the theorem after the state monad, since then you can just talk about equality:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fLinear</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">‚ü®</span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Äπ</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">‚Ä∫</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">countingOp</span><span class=\"bp\">‚ü©</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">fib</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>but ultimately doesn't affect whether it's possible</p>",
        "id": 503375789,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741126736
    },
    {
        "content": "<p>This all assumes that <code>noncomputable</code> is allowed; I'm not sure if you can cheat without it</p>",
        "id": 503375989,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741126811
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> ! I think if the only way to attack this is using <code>noncomputable</code>, it is perhaps not so bad, since I'd need to ban noncomputable in submissions anyway. The aim of this framework is to have runnable, computable code, that you can also prove theorems about. None of this works if noncomputable code can sneak in.</p>\n<p>I guess what I'm somewhat more worried about are potential ways to do the (slow) computation, but somehow avoid the cost being counted in the final tally / or just somehow create a state monad with a fake count. Would something like that be possible?</p>",
        "id": 503396876,
        "sender_full_name": "GasStationManager",
        "timestamp": 1741136742
    },
    {
        "content": "<p>I suspect you can cheat noncomputable with implemented_by</p>",
        "id": 503399803,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741138173
    },
    {
        "content": "<p>The open PR on oracle computations plugs the hole above, I believe</p>",
        "id": 503400700,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741138559
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/Code.20with.20Proofs.3A.20the.20Arena/near/503400700\">said</a>:</p>\n<blockquote>\n<p>The open PR on oracle computations plugs the hole above, I believe</p>\n</blockquote>\n<p>Which hole are you referring to?<br>\nI'm actually very interested in getting a better understanding of the PR (I think you mean this one <a href=\"https://github.com/leanprover-community/mathlib4/pull/20924\">https://github.com/leanprover-community/mathlib4/pull/20924</a>).  You're saying that the <code>Comp</code> monad from the PR is in some sense more robust against cheating attempts than the simple state monad. Which is plausible but I want to understand why.</p>",
        "id": 503442632,
        "sender_full_name": "GasStationManager",
        "timestamp": 1741160552
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">OpenPrivate</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Redefine `propext : False`. -/</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">Environment</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Environment</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">modifyEnv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"n\">map‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">constants</span><span class=\"bp\">.</span><span class=\"n\">map‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"ss\">``propext</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">axiomInfo</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">          </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">``propext</span>\n<span class=\"w\">          </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``False</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">          </span><span class=\"n\">levelParams</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">          </span><span class=\"n\">isUnsafe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">        </span><span class=\"o\">})</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">Environment</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">const2ModIdx</span><span class=\"w\"> </span><span class=\"n\">consts</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">extensions</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">extraConstNames</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">header</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">efsq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span>\n<span class=\"w\">    </span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">^</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exfalso</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">propext</span>\n\n<span class=\"c1\">-- 'efsq' depends on axioms: [propext]</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"w\"> </span><span class=\"n\">efsq</span>\n</code></pre></div>\n<p>This code now does not work, how to fix this?</p>",
        "id": 522970675,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1749380523
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>  This might be a version updated for the latest version of Lean:<br>\n<a href=\"https://github.com/leanprover/lean4checker/blob/master/Lean4CheckerTests/ReplaceAxiom.lean\">https://github.com/leanprover/lean4checker/blob/master/Lean4CheckerTests/ReplaceAxiom.lean</a></p>\n<p>As for the <a href=\"http://www.codeproofarena.com:8000/\">Code with Proofs: Arena</a> website, I haven't updated its Lean version recently so it is still running on 4.14.0-rc2; so the older version above might still compile (but fail to pass the proof checker, now backed by <a href=\"https://github.com/GasStationManager/SafeVerify\">SafeVerify</a> )</p>",
        "id": 522990627,
        "sender_full_name": "GasStationManager",
        "timestamp": 1749404453
    }
]