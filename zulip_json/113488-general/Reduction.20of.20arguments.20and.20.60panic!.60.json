[
    {
        "content": "<p>I found that this command does not print panic:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">panic!</span><span class=\"w\"> </span><span class=\"s2\">\"why is expression conditionally reduced?\"</span><span class=\"o\">)</span>\n<span class=\"c1\">-- Successfully prints 10</span>\n</code></pre></div>\n<p>My understanding of Lean was that it was using call-by-value semantics, hence the <code>panic!</code> must have raised regardless of the value of <code>.some 10</code>. When does <code>panic!</code> happen?</p>",
        "id": 573372925,
        "sender_full_name": "Juneyoung Lee",
        "timestamp": 1770838918
    },
    {
        "content": "<p>looks like it might be getting optimized out?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">compiler</span><span class=\"bp\">.</span><span class=\"n\">ir</span><span class=\"bp\">.</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">panic!</span><span class=\"w\"> </span><span class=\"s2\">\"why is expression conditionally reduced?\"</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 573376717,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1770840239
    },
    {
        "content": "<p>The <code>@[macro_inline]</code> switches to call-by-name semantics <a href=\"https://github.com/leanprover/lean4/blob/3b0f2862196c6a8af9eb0025ee650252694013dd/src/Init/Prelude.lean#L2897\">https://github.com/leanprover/lean4/blob/3b0f2862196c6a8af9eb0025ee650252694013dd/src/Init/Prelude.lean#L2897</a></p>\n<p>The way it does this is that the definition is inlined early on in the compiler pipeline.</p>",
        "id": 573377892,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1770840652
    },
    {
        "content": "<p>Ah, makes sense! Thanks :)</p>",
        "id": 573378690,
        "sender_full_name": "Juneyoung Lee",
        "timestamp": 1770840945
    }
]