[
    {
        "content": "<p>I just updated my local copy of mathlib to the latest commit (4.21.0-rc1), but now the Lean infoview is forever saying \"Waiting for Lean server to start...\"</p>",
        "id": 522071013,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1748943007
    },
    {
        "content": "<p>i.e. apparently, the Lean server is never starting</p>",
        "id": 522071095,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1748943036
    },
    {
        "content": "<p>never mind, reinstalling the toolchain works, apparently</p>",
        "id": 522073626,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1748943723
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> has marked this topic as resolved.</p>",
        "id": 522073635,
        "sender_full_name": "Notification Bot",
        "timestamp": 1748943725
    },
    {
        "content": "<p>I managed to reproduce this issue and I think I know what is causing it.</p>",
        "id": 522078418,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748944965
    },
    {
        "content": "<p>Unfortunately, I can reproduce this as well :). VS Code won't start the Lean server on 4.21.0-rc1 for me.</p>",
        "id": 522088901,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1748948178
    },
    {
        "content": "<p>Same here. What is the workaround?</p>",
        "id": 522094377,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1748949803
    },
    {
        "content": "<p>I'm implementing one right now, give me a few more minutes :-)</p>\n<p>(This issue only affects 4.21.0-rc1)</p>",
        "id": 522094753,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748949908
    },
    {
        "content": "<p>Details at <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/618\">vscode-lean4#618</a></p>",
        "id": 522099107,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748951068
    },
    {
        "content": "<p>Thanks Marc.</p>",
        "id": 522100439,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1748951425
    },
    {
        "content": "<p>0.0.206 of the Lean 4 VS Code extension has been released now. The issue should not occur on this version anymore.</p>",
        "id": 522102815,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748952058
    },
    {
        "content": "<p>In the meantime, I'm preparing release candidate 2 with exactly the same code but a rerolled commit hash, since not everyone will update their extension immediately.</p>",
        "id": 522109006,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1748953673
    },
    {
        "content": "<p>Mathlib is now at v4.21.0-rc2, please let me know if there are any issues.</p>",
        "id": 522168888,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1748968081
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span> <a href=\"#narrow/channel/113488-general/topic/.E2.9C.94.20Lean.20server.20not.20starting.20in.20VSCode/near/522168888\">said</a>:</p>\n<blockquote>\n<p>Mathlib is now at v4.21.0-rc2, please let me know if there are any issues.</p>\n</blockquote>\n<p>It looks to me like there's not a release tag for mathlib rc2, so <code>rev = \"v4.21.0-rc2\"</code> in a downstream .toml doesn't work; is that intentional?</p>",
        "id": 522197776,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1748977776
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> has marked this topic as unresolved.</p>",
        "id": 522201717,
        "sender_full_name": "Notification Bot",
        "timestamp": 1748979322
    },
    {
        "content": "<p>I have this issue, but in the sphere-eversion project <a href=\"https://github.com/leanprover-community/sphere-eversion\">https://github.com/leanprover-community/sphere-eversion</a> (never in mathlib). STR: clone the project (current master, i.e. mathlib 4.20 works), open the folder in VS Code, open Indexing.lean and watch the server never start.</p>",
        "id": 522201872,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748979380
    },
    {
        "content": "<p>I can't reproduce, unfortunately.</p>",
        "id": 522204536,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748980414
    },
    {
        "content": "<p>Ah, I can reproduce it if the project folder is called <code>sphere-eversion</code>, but not if it is called something else, like <code>SphereEversion</code> ...</p>",
        "id": 522205018,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748980592
    },
    {
        "content": "<p>OK, I don't think it's the name after all. I'll look into it tomorrow.</p>",
        "id": 522205774,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748980868
    },
    {
        "content": "<p>I think I actually can't reproduce that it never starts. It takes unusually long, but it does start eventually.</p>",
        "id": 522206276,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748981063
    },
    {
        "content": "<p>Retrying again, now it works fast. It seems it was a different issue for sure.</p>",
        "id": 522208075,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748981806
    },
    {
        "content": "<p>One part contributing to it: when the server wouldn't start, running <code>lake exe cache get</code> from a terminal also would \"hang\", and eventually error with \"git exited with exit code 1\" (and no further details).</p>",
        "id": 522208232,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748981882
    },
    {
        "content": "<p>Perhaps this is a \"error messages could be more helpful\" bug report then...</p>",
        "id": 522208299,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748981907
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20server.20not.20starting.20in.20VSCode/near/522208075\">said</a>:</p>\n<blockquote>\n<p>Retrying again, now it works fast. It seems it was a different issue for sure.</p>\n</blockquote>\n<p>It only happens on initial clone. I think it's because Lake is cloning dependencies when <code>lake serve</code> is called for the first time by the VS Code extension.</p>",
        "id": 522208521,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748982000
    },
    {
        "content": "<p>Can there be a message printed to the terminal, that it's cloning dependencies or so? (Printing and erasing the message is fine with me; the point is to prevent an impression \"nothing happens\".)</p>",
        "id": 522209079,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748982227
    },
    {
        "content": "<p>It does report the cloning progress information in the output panel at the end (presumably due to <a href=\"https://github.com/leanprover/lean4/pull/5615\">lean4#5615</a>), but I can improve the language server startup progress bar in the bottom right to indicate that it may take a while if this is the first launch.</p>",
        "id": 522210845,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748982933
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/vscode-lean4/pull/619\">vscode-lean4#619</a> improves the progress bar message</p>",
        "id": 522215286,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1748984874
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20server.20not.20starting.20in.20VSCode/near/522197776\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span> <a href=\"#narrow/channel/113488-general/topic/.E2.9C.94.20Lean.20server.20not.20starting.20in.20VSCode/near/522168888\">said</a>:</p>\n<blockquote>\n<p>Mathlib is now at v4.21.0-rc2, please let me know if there are any issues.</p>\n</blockquote>\n<p>It looks to me like there's not a release tag for mathlib rc2, so <code>rev = \"v4.21.0-rc2\"</code> in a downstream .toml doesn't work; is that intentional?</p>\n</blockquote>\n<p>Apologies, fixed now!</p>",
        "id": 522288265,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1749023284
    }
]