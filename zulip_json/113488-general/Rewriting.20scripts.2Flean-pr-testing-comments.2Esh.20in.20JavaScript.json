[
    {
        "content": "<p>The TODO <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/scripts/lean-pr-testing-comments.sh\">here</a> says: </p>\n<blockquote>\n<p>The whole script ought to be rewritten in javascript, to avoid having to use curl for API calls.</p>\n</blockquote>\n<p>I'd like to work on this task. Searching through Zulip and the PR's, it seems that nobody is yet working on this.</p>\n<p>One issue is that such a script is hard to test.<br>\nShould the script work without installing libraries? The script should run in CI, not from command line. I assume I can add depencies in the environment, like <code>npm install axios</code>.</p>",
        "id": 452609746,
        "sender_full_name": "Nick Decroos",
        "timestamp": 1721405614
    },
    {
        "content": "<p>A possibly naive question from the sideline: why Javascript? Right now, mathlib's infrastructure is a wild mix of (some) Lean, Python (some scripts, some style linters), Shell (more scripts), Rust (for the cache etc.) - I'm not aware of any Javascript so far. Is there a reason it cannot be rewritten in Lean (or perhaps Rust)?</p>",
        "id": 452618063,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721407699
    },
    {
        "content": "<p>That said: I don't have any horse in this race; I'm not volunteering to rewrite this, but you are - so feel free to ignore my 2c!</p>",
        "id": 452618154,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1721407738
    },
    {
        "content": "<p>There's some JavaScript in GitHub actions, because that's the one alternative I found for shell scripts</p>",
        "id": 452621084,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721408640
    },
    {
        "content": "<p>I'm just now looking at the script and <a href=\"https://github.com/leanprover-community/mathlib4/blob/cb4fdfb34b267846faa95e7a8eb60863c4f68e2d/.github/workflows/build.yml.in#L265\">where it's used</a> for the first time, but my impression is that using a shell script is fine for this. If we really want to avoid curl, maybe using the <code>gh</code> CLI tool instead would make it simpler (though maybe that's not installed by default on our runners yet).</p>",
        "id": 452621190,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1721408661
    },
    {
        "content": "<p>Good remark on using languages that are already used in the infrastrcture and not introducing another language. <br>\nI didn't make the TODO, but it mentions that curl should be avoided. I am not sure why curl should be avoided.<br>\nIt should be possible in Python and Rust. (It should also be possible in Lean using Http I think, but needs more work).</p>",
        "id": 452621299,
        "sender_full_name": "Nick Decroos",
        "timestamp": 1721408690
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 452621337,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1721408704
    },
    {
        "content": "<p>I remember various discussions about some systems having very old (or very unusual) versions of <code>curl</code>: maybe this was the origin of the issue?</p>",
        "id": 452622425,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721409023
    },
    {
        "content": "<p>Since this particular script is only meant to be run in CI, that should be less of a concern.</p>",
        "id": 452623146,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1721409257
    },
    {
        "content": "<p>Ah, perhaps the idea was to convert the shell script into something written using the <a href=\"https://github.com/actions/github-script\">github-script</a> action in the build.yml workflow files?</p>",
        "id": 452624574,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1721409687
    },
    {
        "content": "<p>I think I should wait for a reaction by <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> reacts, before doing anything.</p>",
        "id": 452649260,
        "sender_full_name": "Nick Decroos",
        "timestamp": 1721417176
    },
    {
        "content": "<p>Yes, it's just a desire to use github-script where possible, to reduce marginally the amount of shell scripting we have interacting with the Github API.</p>",
        "id": 452681915,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721430606
    },
    {
        "content": "<p>Looking back at it I'm less convinced that increasing the amount of javascript in our system is a good idea!</p>",
        "id": 452681948,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721430629
    },
    {
        "content": "<p>Generally making CI scripts more self-explanatory, better documented, or using more robust APIs is a good idea. But this TODO per se is not really doing that.</p>",
        "id": 452682012,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721430669
    }
]