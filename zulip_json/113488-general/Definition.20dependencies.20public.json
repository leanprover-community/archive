[
    {
        "content": "<p>What is the easiest way to check that a specific important (public) definition doesn't depend on any <code>private</code> definition? I mean both <code>def</code> and  <code>abbrev</code> by \"definition\" in the previous sentence.</p>",
        "id": 525341362,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750687724
    },
    {
        "content": "<p>Why do you care?</p>",
        "id": 525348020,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750689614
    },
    {
        "content": "<p>API consistency?</p>",
        "id": 525349673,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750690076
    },
    {
        "content": "<p>I think you'll need to expand on that</p>",
        "id": 525350988,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1750690455
    },
    {
        "content": "<p>Maybe I should ask what you mean by \"depend on\"?</p>",
        "id": 525352352,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750690826
    },
    {
        "content": "<p>Indeed <code>def foo : Bar := _</code> where <code>private structure Bar</code> is probably problematic, but <code>def foo : Nat := bar</code> where <code>private def bar</code> is not</p>",
        "id": 525352537,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750690857
    },
    {
        "content": "<p>I would like to detect both (anti)patterns:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">zeroFoo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">b'</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n</code></pre></div>\n<p>The latter is less problematic, but I'd like to avoid both of them.</p>",
        "id": 525355751,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750691804
    },
    {
        "content": "<p>the latter is fine as long as there is API</p>",
        "id": 525368512,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750695971
    },
    {
        "content": "<p>Speaking of the former problem, is the following catch known?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">eq_self</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">break_me</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">eq_self</span>\n</code></pre></div>\n<p>Removing <code>private</code> from <code>Foo.eq_self</code> breaks the proof of the subsequent theorem.</p>",
        "id": 525377350,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750699432
    },
    {
        "content": "<p>It because of macro scopes but I can see why it would be confusing if you didn't know the reason</p>",
        "id": 525397549,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750707741
    },
    {
        "content": "<p>It's not macro scopes but the fact that <code>private</code> is a name prefix, similar to namespaces</p>",
        "id": 525399998,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750708895
    },
    {
        "content": "<p><code>private Foo</code> is actually <code>_private.My.Module.Path.0.Foo</code> and then it obviously expected <code>_private.My.Module.Path.0.Foo.eq_self</code> for dot notation</p>",
        "id": 525400165,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750708954
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/stream/113488-general/topic/Definition.20dependencies.20public/near/525400165\">said</a>:</p>\n<blockquote>\n<p><code>private Foo</code> is actually <code>_private.My.Module.Path.0.Foo</code> and then it obviously expected <code>_private.My.Module.Path.0.Foo.eq_self</code> for dot notation</p>\n</blockquote>\n<p>Oh I thought those were macro scopes but I guess not (they seemed really similar)</p>",
        "id": 525400788,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750709257
    },
    {
        "content": "<p>It's similar but <code>_private</code> is a deterministic prefix (only based on module name) and macro scopes are suffixes with random (technically deterministic but ever-changing) numbers</p>",
        "id": 525402113,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750709949
    },
    {
        "content": "<p>or well, <code>_hyg</code> vs <code>_private</code></p>",
        "id": 525402276,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1750710026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/113488-general/topic/Definition.20dependencies.20public/near/525399998\">said</a>:</p>\n<blockquote>\n<p>It's not macro scopes but the fact that <code>private</code> is a name prefix, similar to namespaces</p>\n</blockquote>\n<p>Would it be reasonable to open a RFC about changing this behavior?</p>",
        "id": 525452308,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750748207
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Definition.20dependencies.20public/near/525355751\">schrieb</a>:</p>\n<blockquote>\n<p>I would like to detect both (anti)patterns:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">zeroFoo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">b'</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n</code></pre></div>\n<p>The latter is less problematic, but I'd like to avoid both of them.</p>\n</blockquote>\n<p>I think the upcoming module system will prevent the former, and also the latter if the definition is exposed. So maybe just wait for that?</p>",
        "id": 525453474,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1750748741
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Definition.20dependencies.20public/near/525377350\">said</a>:</p>\n<blockquote>\n<p>Speaking of the former problem, is the following catch known?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">eq_self</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">break_me</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">eq_self</span>\n</code></pre></div>\n<p>Removing <code>private</code> from <code>Foo.eq_self</code> breaks the proof of the subsequent theorem.</p>\n</blockquote>\n<p>The suggested potential RFC was about this behavior.</p>",
        "id": 525471517,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1750755486
    }
]