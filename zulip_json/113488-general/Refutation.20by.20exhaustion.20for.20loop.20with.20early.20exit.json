[
    {
        "content": "<p>There is a simple coding exercise that asks:</p>\n<blockquote>\n<p>You are given an integer array <code>nums</code> with the following properties:</p>\n<ul>\n<li><code>nums.length == 2 * n</code>.</li>\n<li><code>nums</code> contains <code>n + 1</code> <strong>unique</strong> elements.</li>\n<li>Exactly one element of nums is repeated <code>n</code> times.<br>\n<em>Return the element that is repeated <code>n</code> times.</em></li>\n</ul>\n</blockquote>\n<p>Plus some additional constraints. My goal here was to take this Python solution:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">repeatedNTimes</span><span class=\"p\">(</span><span class=\"n\">nums</span><span class=\"p\">:</span> <span class=\"nb\">list</span><span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">])</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">int</span><span class=\"p\">:</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">nums</span><span class=\"p\">)):</span>\n        <span class=\"k\">if</span> <span class=\"n\">nums</span><span class=\"p\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"ow\">or</span> <span class=\"n\">nums</span><span class=\"p\">[</span><span class=\"n\">i</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">nums</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]:</span>\n            <span class=\"k\">return</span> <span class=\"n\">nums</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>And prove that it is correct as is. Where \"as is\" would be a translation padded with additional witnesses to induce the proof.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repeatedNTimes</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5000</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"bp\">^</span><span class=\"mi\">4</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">instNeZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Casting `i : ℕ` to `i : Fin nums.size` for wrap around</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">is_solution</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">for_loop_concluded_no_return</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">admit</span>\n\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">unreachable!</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">for_loop_concluded_no_return</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">repeated_n_on_2n_prop</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"bp\">.</span><span class=\"n\">right</span>\n<span class=\"w\">  </span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>This is at line 237 of my <a href=\"https://live.lean-lang.org/#codez=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\">Proof</a>. As I see it, the \"interesting\" parts of the proof were <code>is_solution</code> and <code>repeated_n_on_2n_prop</code> which asserts that given the constraints and <code>for_loop_concluded_no_return</code>, we have a contradiction.</p>\n<p>My question then is, is it possible to arrive at <code>for_loop_concluded_no_return</code> while maintaining the for loop? Or would that require one to restructure the solution? From what I have seen, this should be possible with some sort of state added to the for loop, but I am not really sure where to start.</p>",
        "id": 567032595,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767906135
    },
    {
        "content": "<p>I think it is better (and also plausible!) to actually prove this really \"as is\", where you just write the function in Lean, with early return and no verification conditions, and then write the theorem you want about it as a separate declaration.</p>",
        "id": 567035968,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767907553
    },
    {
        "content": "<p>By separate declaration, do you mean a lemma that relates to the solution via \"argumentation\" and in which the wanted properties are proved? If that is the case, then I would say I am done, since I have already proved:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">repeated_n_on_2n_prop</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>And</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">is_solution</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Which from what I can tell, is all you would need to show to \"argue\" the correctness of the solution. However, for this I thought it would be more interesting to code up a solution that is type checked correct onto itself. By \"also plausible\", do you mean to say that it is not possible to have <code>for_loop_concluded_no_return</code> while still keeping the for loop, or that it is impractical and would require a lot of work?</p>",
        "id": 567038242,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767908615
    },
    {
        "content": "<p>Here's how I'd solve this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- the lemmas `repeated_n_on_2n_prop` and `is_solution`</span>\n<span class=\"c1\">-- ...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repeatedNTimes</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">*...</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Casting `i : ℕ` to `i : Fin nums.size` for wrap around</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rio</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">unreachable!</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Do</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">mvcgen</span><span class=\"bp\">.</span><span class=\"n\">warning</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">repeatedNTimes_correct</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">repeatedNTimes</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n<span class=\"w\">  </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repeatedNTimes</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">of_wp_run_eq</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">mvcgen</span><span class=\"w\"> </span><span class=\"n\">invariants</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">Invariant</span><span class=\"bp\">.</span><span class=\"n\">withEarlyReturn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">onReturn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⌜</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">⌝</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">onContinue</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⌜∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"kn\">prefix</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">;</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">⌝</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">vc1</span><span class=\"bp\">.</span><span class=\"n\">step</span><span class=\"bp\">.</span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">is_solution</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">hi</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">vc2</span><span class=\"bp\">.</span><span class=\"n\">step</span><span class=\"bp\">.</span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">vc3</span><span class=\"bp\">.</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">pre</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">vc4</span><span class=\"bp\">.</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">post</span><span class=\"bp\">.</span><span class=\"n\">success</span><span class=\"bp\">.</span><span class=\"n\">h_1</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">repeated_n_on_2n_prop</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">hi</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">toList_rio_eq_toList_rco</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rco</span><span class=\"bp\">.</span><span class=\"n\">mem_toList_iff_mem</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Rco</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">zero_le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true_and</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">ofNat_eq_cast</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">is_lt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">getElem!_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">getElem_fin</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">getElem!_fin</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_natCast</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">or_eq_false_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">beq_eq_false_iff_ne</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne_eq</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">reduceCtorEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false_and</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exists_const</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_false</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">vc5</span><span class=\"bp\">.</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">post</span><span class=\"bp\">.</span><span class=\"n\">success</span><span class=\"bp\">.</span><span class=\"n\">h_2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 567045610,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1767912341
    },
    {
        "content": "<p>You can read more at <a href=\"https://lean-lang.org/doc/reference/latest/The--mvcgen--tactic/Tutorial___-Verifying-Imperative-Programs-Using--mvcgen/#mvcgen-tactic-tutorial\">https://lean-lang.org/doc/reference/latest/The--mvcgen--tactic/Tutorial___-Verifying-Imperative-Programs-Using--mvcgen/#mvcgen-tactic-tutorial</a></p>",
        "id": 567045638,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1767912358
    },
    {
        "content": "<p>I didn't know about <code>mvcgen</code> until now. I haven't read much into it yet, but it seems to be exactly* what I was looking for... Thanks for giving this example</p>\n<p>*I mean I just wanted a principled way to prove properties of imperative programs. It would still be nice to somehow do it like I did and have a feature that would bring that kinda of statement in or state keeping track of things. But given that it seems the purpose of this tool is to address this kinda of problem, it seems silly to try to hack something together</p>",
        "id": 567047137,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767913263
    },
    {
        "content": "<p>mvcgen is fairly new, and while it's hopefully a good robust foundation, we're still hoping to make it much more user friendly (and have more and better tutorials!)</p>",
        "id": 567075694,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767936929
    }
]