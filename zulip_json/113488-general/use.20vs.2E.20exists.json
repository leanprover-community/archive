[
    {
        "content": "<p>I was usually using <code>exists</code>, then someone mentioned to me that <code>use</code> is recommended. What is the difference? I thought I could see a difference in the examples provided by the docs of <code>use</code> but that is not much helpful, these are the examples in the docs of <code>use</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"c1\">-- all `use`, `exists`, `use!` succeed</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"c1\">-- all `use`, `exists`, `use!` succeed</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"forty-two\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"forty-two\"</span><span class=\"o\">)</span>\n<span class=\"c1\">-- all `use`, `exists`, `use!` succeed</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use!</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"c1\">-- Error no matter which tactic I write, bug in the docs I suppose</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use!</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">)</span>\n<span class=\"c1\">-- all `use`, `exists`, `use!` succeed</span>\n</code></pre></div>",
        "id": 562650656,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765277134
    },
    {
        "content": "<p>Oh, I see in cases like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"c1\">-- here exists fails</span>\n</code></pre></div>\n<p>there should be also a more natural example without a custom structure...</p>",
        "id": 562666625,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765281935
    },
    {
        "content": "<p>The difference between <code>exists</code> and <code>use</code> doesn't really appear until you have constructors with more than two arguments.</p>\n<p>The <code>use!</code> tactic is able to flatten structures. Unlike you, I'm seeing that <code>use!</code> succeeds in the following example (using the latest Mathlib on <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a>)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use!</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n</code></pre></div>\n<p>You can do <code>use! 42</code> as well.</p>",
        "id": 562766720,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765305176
    },
    {
        "content": "<p>Maybe the difference is that I tested it with <code>import Mathlib.Tactic.Common</code>. Importing all of <code>Mathlib</code> breaks it for some reason.</p>",
        "id": 562766914,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765305231
    },
    {
        "content": "<p>Ah, if you do <code>use! 42</code> you can see the problem. It's using the OfNat instance for <code>ℕ × ℕ</code>. The <code>use!</code> tactic tries elaborating a value for a constructor field, and if that fails, then it tries going into that constructor field. Unfortunately for this example, elaboration succeeds for <code>ℕ × ℕ</code>.</p>",
        "id": 562767161,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765305283
    },
    {
        "content": "<p>Here's one that works with all of Mathlib imported:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use!</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 562767819,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765305400
    },
    {
        "content": "<p>Interesting, I am usually just doing <code>import Mathlib</code>, sometimes <code>import Mathlib.Tactic</code></p>",
        "id": 562768373,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765305536
    },
    {
        "content": "<p>It's a surprise, but at least it's not a bug.</p>\n<p>For what it's worth, this example is in MathlibTest/Use.lean, to make sure the docstring is accurate. (That said, the \"forty-two\" example is not in the test file...)</p>",
        "id": 562768682,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765305612
    },
    {
        "content": "<p>Even if if it is not a bug, wouldn't it be helpful to have more stable &amp; demonstrative examples?</p>",
        "id": 562770156,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765305983
    },
    {
        "content": "<p>Or maybe <code>use!</code>just cannot be stable under different import...</p>",
        "id": 562770925,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765306201
    },
    {
        "content": "<p>Feel free to make a PR to improve the docstring, with some more realistic examples (and make sure the test file actually includes all the docstring examples). You can't completely protect against all possible imports, but you can at least protected against obvious culprits — in this case the cartesian product has a natural algebraic structure.</p>",
        "id": 562776473,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765307666
    },
    {
        "content": "<p>You could also use a type ascription in the <code>use</code> argument to protect against it, and use the example as a gotcha of <code>use!</code>.</p>",
        "id": 562776555,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765307688
    },
    {
        "content": "<p>Ok, will think about better examples, I am not sure if I understand it perfectly but hopefully better now.</p>",
        "id": 562831274,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765326881
    },
    {
        "content": "<p>Perhaps these examples?</p>\n<ol>\n<li><code>use</code>, but not <code>exists</code></li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">≃</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">PNat</span><span class=\"bp\">.</span><span class=\"n\">natPred</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succPNat</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">PNat</span><span class=\"bp\">.</span><span class=\"n\">succPNat_natPred</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<ol start=\"2\">\n<li><code>use!</code> but not <code>use</code></li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">%</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use!</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 562954124,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765373155
    },
    {
        "content": "<p>Those seem reasonable. I'm actually surprised that the second example can be done with <code>use</code>; I'd have expected <code>use!</code> since this needs to first apply the Nonempty constructor.</p>",
        "id": 563010446,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765387323
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113488-general/topic/use.20vs.2E.20exists/near/562776473\">said</a>:</p>\n<blockquote>\n<p>Feel free to make a PR to improve the docstring, with some more realistic examples (and make sure the test file actually includes all the docstring examples).</p>\n</blockquote>\n<p>Like this? <a href=\"https://github.com/leanprover-community/mathlib4/pull/32699\">https://github.com/leanprover-community/mathlib4/pull/32699</a><br>\nI needed to import some more files to make the example with <code>PNat</code> working, which also caused the <code>ℕ</code> notation in the tests.</p>",
        "id": 563024818,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765391935
    },
    {
        "content": "<p>I've not once used <code>exists</code>. I always assumed it was some kind of holdover, or one of those \"for teaching only\" tactics.</p>",
        "id": 563077035,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1765408133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/use.20vs.2E.20exists/near/563077035\">said</a>:</p>\n<blockquote>\n<p>I've not once used <code>exists</code>. I always assumed it was some kind of holdover, or one of those \"for teaching only\" tactics.</p>\n</blockquote>\n<p>Poor <code>exists</code>... On the other hand, isn't it the case that <code>exists</code> is good enough for 90% cases of your applications of <code>use</code>? I would say <code>exists</code> is a natural word to write when you don't know the tactic but I would approve making it a direct synonym to <code>use</code>. Then I am also aware of <code>existsi</code> which doesn't try the automatic discharging (so its output is more predictable).</p>",
        "id": 563164668,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765452803
    },
    {
        "content": "<p>To me, using <code>use</code> to fill an existential feels more natural than<code>exists</code>.</p>",
        "id": 563165438,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765453089
    },
    {
        "content": "<p>Nothing against that, perhaps I just knew <code>exists</code> from Rocq, or an older Lean version... but what is the long-term plan with <code>exists</code> &amp; <code>existsi</code> when they seem to be almost forgotten by the community?</p>",
        "id": 563167151,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765453649
    },
    {
        "content": "<p>I am actually a little surprised that <code>existsi</code> is a Mathlib tactic, and smarter <code>exists</code> is a Core tactic.</p>",
        "id": 563167835,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765453881
    },
    {
        "content": "<p>Maybe one day the core <code>exists</code> will do what <code>use</code> does, and mathlib's can be a synonym. That seems like a reasonable outcome. For the short term though it seems low-priority to do anything about it.</p>\n<p>Something that would be neat is if <code>use</code> could avoid splitting the goal, if it would reassemble the goal into an existential as needed.</p>\n<p>It would also be neat if <code>use</code> could make use of the names of constructor fields or of the binders for existentials. For example, if your goal was <code>exists x, exists y, ...</code>, imagine being able to do <code>use y := 3</code>. Or if the goal was a structure, write <code>use invFun := fun x =&gt; ...</code>. Havig <code>use</code> reassemble the goal as an existential would enable you to use <code>use</code> to introduce choices one at a time.</p>",
        "id": 563232141,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765470352
    }
]