[
    {
        "content": "<p>Friends, I'm going through the Functional Programming book for Lean, and I'm getting an error in Chapter 3 on proofs with Lean.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"s2\">\"hedgehog\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"deer\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"snail\"</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- Error here</span>\n</code></pre></div>\n<p>According to the book, this should work... Any ideas on what might be happening?</p>",
        "id": 485979009,
        "sender_full_name": "DSB",
        "timestamp": 1733270512
    },
    {
        "content": "<p>you can use <code>apply?</code> here to get suggestions for theorems that will close this goal</p>",
        "id": 485983433,
        "sender_full_name": "nrs",
        "timestamp": 1733272464
    },
    {
        "content": "<p>if you import Mathlib, <code>reduce</code> will also reduce that goal to a tautology by \"evaluating\" its terms</p>",
        "id": 485983507,
        "sender_full_name": "nrs",
        "timestamp": 1733272506
    },
    {
        "content": "<p><code>by reduce; simp</code></p>",
        "id": 485983548,
        "sender_full_name": "nrs",
        "timestamp": 1733272526
    },
    {
        "content": "<p>The solution I got was using <code>by decide</code>. But I was wondering if the problem was actually with my code. If I needed to import something or enable some option.</p>",
        "id": 485983949,
        "sender_full_name": "DSB",
        "timestamp": 1733272706
    },
    {
        "content": "<p>it's not an error strictly speaking it's just a goal that's not closed, but <code>by simp</code> doesn't close the goal for me neither</p>",
        "id": 485984488,
        "sender_full_name": "nrs",
        "timestamp": 1733272968
    },
    {
        "content": "<p><code>simp [woodlandCritters]</code> or <code>simp +ground</code> will both work here</p>",
        "id": 485995794,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733278573
    },
    {
        "content": "<p>But an even better option is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">get_elem_tactic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"s2\">\"hedgehog\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"deer\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"snail\"</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span>\n</code></pre></div>",
        "id": 485995863,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733278605
    },
    {
        "content": "<p>did not know about <code>simp +ground</code> cool!</p>",
        "id": 486007533,
        "sender_full_name": "nrs",
        "timestamp": 1733284328
    },
    {
        "content": "<p>The <a href=\"https://lean-lang.org/functional_programming_in_lean/\">second sentence</a> of this book is pretty important:  </p>\n<blockquote>\n<p>All code samples are tested with Lean 4 release <code>4.1.0</code>.</p>\n</blockquote>\n<p>Lean is changing fast and if you are learning this for the first time then you’ll be much less frustrated if you use the version of Lean mentioned above when playing with code samples from that book. I think there are plans to move this book to the new verso infrastructure and update it to a more recent Lean version. <span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> can probably comment on that.</p>",
        "id": 486071883,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1733312245
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> ! I thought that something like this could be going on. I imagined the book was correct, and there was something different with my setup.</p>",
        "id": 486073938,
        "sender_full_name": "DSB",
        "timestamp": 1733313034
    },
    {
        "content": "<p>The book is now a bit over a year old. All of the examples in it are machine-checked at build time, but they're checked against Lean 4.1.0.</p>\n<p>Updating it to a more recent Lean, and updating its infrastructure, is absolutely on my to-do list, but getting the reference manual ready to go is priority number one. Once it's in good shape, other priorities may begin to rise up the list again :-) </p>\n<p>As a nice bonus, porting it to Verso will get fancy type signature hovers and hyperlinks to the reference manual for free in all the code examples!</p>\n<p>Updating it is something that will require rewriting text as well as updating the code examples. One goal of the book is to do very little proving of anything until readers are comfortable programming, but some understanding of proofs is necessary for things like array lookup syntax.</p>\n<p>There have been two big changes to the interaction between proving and programming that will require nontrivial text revisions: <code>simp</code> now does less by default, and data structure lookup now uses <code>omega</code> when checking that an index is in bounds. The former will require introducing another tactic (probably <code>decide</code>), and the latter will allow some code to be simplified and some explanations removed or moved later in the book.</p>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> for the ping!</p>",
        "id": 486098743,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1733320729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"709428\">DSB</span> has marked this topic as resolved.</p>",
        "id": 486122774,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733327029
    }
]