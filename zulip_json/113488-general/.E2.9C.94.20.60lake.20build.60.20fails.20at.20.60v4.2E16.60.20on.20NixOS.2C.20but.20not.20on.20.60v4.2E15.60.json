[
    {
        "content": "<p>Since I'm not sure whether this is due to something being broken in my setup or an issue introduced in the latest versions, I also opened <a href=\"https://github.com/leanprover/lean4/issues/6945\">an issue on GitHub</a>.</p>\n<p>Basically, when I run <code>lake build</code> in a new project (created with <code>lake new Example</code>), I get what seems to be a linker error. The issue is not reproduced if I remove the <code>lean_exe</code> section in the <code>lakefile.toml</code>. This issue happened originally when running <code>lake exe cache get</code> in a different project, although we didn't have any <code>lean_exe</code> sections in the lakefile.</p>\n<p>I'm running NixOS 24.11.</p>",
        "id": 497619281,
        "sender_full_name": "Ayhon",
        "timestamp": 1738661882
    },
    {
        "content": "<p>Why are you configuring Lean to use a non standard compiler and does it work if you just don't do that? Furthermore how did you install Lean on NixOS? Through elan or through a derivation? The latter is neither supported nor recommended.</p>",
        "id": 497619800,
        "sender_full_name": "Henrik BÃ¶ving",
        "timestamp": 1738662042
    },
    {
        "content": "<p>I installed Lean through <code>elan</code>. The error happens with the default compiler as well, I just remarked how using a non-standard one seems to give a shorter error message. You can see the actual command I ran when expanding the full output in the issue</p>",
        "id": 497620128,
        "sender_full_name": "Ayhon",
        "timestamp": 1738662127
    },
    {
        "content": "<p>It seems like I should update <code>nixpkgs</code>. The <code>elan</code> version is the issue here.<br>\n<a href=\"https://github.com/NixOS/nixpkgs/pull/362062\">https://github.com/NixOS/nixpkgs/pull/362062</a></p>",
        "id": 497622264,
        "sender_full_name": "Ayhon",
        "timestamp": 1738662798
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> has marked this topic as resolved.</p>",
        "id": 497622274,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738662800
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> has marked this topic as unresolved.</p>",
        "id": 497627307,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738664160
    },
    {
        "content": "<p>Nevermind, running <code>nix flake update</code> and changing <code>elan</code> to come from <code>nixpkgs-unstable</code> didn't seem to fix the issue. I'm running <code>elan</code> version <code>3.1.1</code>, the issue is confirmed to persist in <code>v4.16.0-rc2</code>, I'm currently downloading <code>v4.16.0</code> to confirm if it also happens there</p>",
        "id": 497627667,
        "sender_full_name": "Ayhon",
        "timestamp": 1738664264
    },
    {
        "content": "<p>Also doesn't work with <code>v4.16.0</code></p>",
        "id": 497629336,
        "sender_full_name": "Ayhon",
        "timestamp": 1738664747
    },
    {
        "content": "<p>Why not update to elan 4?</p>",
        "id": 497630546,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738665088
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/.60lake.20build.60.20fails.20at.20.60v4.2E16.60.20on.20NixOS.2C.20but.20not.20on.20.60v4.2E15.60/near/497630546\">said</a>:</p>\n<blockquote>\n<p>Why not update to elan 4?</p>\n</blockquote>\n<p>As far as I know, it's not available in <code>nixpkgs</code> or <code>nixpkgs-unstable</code> (<a href=\"https://github.com/NixOS/nixpkgs/blob/nixpkgs-unstable/pkgs/by-name/el/elan/package.nix\">link</a>).</p>",
        "id": 497636181,
        "sender_full_name": "Ayhon",
        "timestamp": 1738666690
    },
    {
        "content": "<p>The issue seemed to solve itself after I delted the <code>.elan</code> directory and ran <code>lake build</code> in the shell provided by <code>nix shell nixpkgs#elan</code></p>",
        "id": 497636299,
        "sender_full_name": "Ayhon",
        "timestamp": 1738666726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690100\">@Ayhon</span> After updating elan (from nixpkgs 24.11 or nixpkgs unstable), you need to reinstall the relevant toolchains. Deleting <code>~/.elan</code> and letting it redownload the toolchain is the easiest way to do that.</p>",
        "id": 497665514,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738675632
    },
    {
        "content": "<p>Ah, sorry, that was precisely the content of your last message!</p>",
        "id": 497665567,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738675650
    },
    {
        "content": "<p>Nixpkgs elan is patched to create wrappers in <code>~/.elan</code> at toolchain installation time, and the patch itself was updated recently</p>",
        "id": 497665726,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1738675690
    },
    {
        "content": "<p>Thank you for the explanation, now I know what to try if something similar happens again.</p>",
        "id": 497666001,
        "sender_full_name": "Ayhon",
        "timestamp": 1738675782
    },
    {
        "content": "<p>It also seems like I forgot to mark the topic as resolved.</p>",
        "id": 497666057,
        "sender_full_name": "Ayhon",
        "timestamp": 1738675801
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690100\">Ayhon</span> has marked this topic as resolved.</p>",
        "id": 497666096,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738675803
    }
]