[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Logic</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">stroke</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">500</span><span class=\"w\"> </span><span class=\"s2\">\"|\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">stroke</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">700</span><span class=\"w\"> </span><span class=\"s2\">\"~\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Not</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">600</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" ∨ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Or</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Impl</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">400</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" → \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Impl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- ...</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">taut</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- ...</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"c1\">-- Okay!</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">taut</span><span class=\"w\"> </span><span class=\"c1\">-- ❌ uses _root_.Or</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Logic</span>\n</code></pre></div>\n<p>Is this resolvable? The logical development itself works fine in the prelude but I'm not sure about writing tactics without Notation</p>",
        "id": 490335279,
        "sender_full_name": "Soundwave",
        "timestamp": 1734819836
    },
    {
        "content": "<p>This seems to work: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" ∨ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Or</span>\n</code></pre></div>",
        "id": 490341189,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734825378
    },
    {
        "content": "<p>Oops, that's not going to yield the right parse.</p>",
        "id": 490342259,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734826428
    },
    {
        "content": "<p>Nope, but it did narrow down the issue: Seems to be related to preference for _root_.Or for maximal munch</p>",
        "id": 490342316,
        "sender_full_name": "Soundwave",
        "timestamp": 1734826469
    },
    {
        "content": "<p>Try these:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" ∨ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Or</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Impl</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" → \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Impl</span>\n</code></pre></div>",
        "id": 490342323,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734826484
    },
    {
        "content": "<p>The default for or is 30, I'm not sure what it is for the arrow.</p>",
        "id": 490342330,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734826496
    },
    {
        "content": "<p>Bringing Impl down below _root_.Or works, but leads to a probably unsolvable problem: Or being infixr was a mistake, and if it's infixl, then p ∨ p ∨ p parses wrong regardless of their precedences.</p>",
        "id": 490342374,
        "sender_full_name": "Soundwave",
        "timestamp": 1734826560
    },
    {
        "content": "<p>I may have to settle for right-associative syntax. Thanks for taking a look.</p>",
        "id": 490342711,
        "sender_full_name": "Soundwave",
        "timestamp": 1734826875
    },
    {
        "content": "<p>Someone smarter will probably drop in; the default precedence for the arrow is apparently 25, but I'm actually not sure why it doesn't parse the way you want it to when it's higher than the built-in Or.</p>",
        "id": 490344895,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1734829105
    },
    {
        "content": "<p>Yeah it's strange. At the very least I can continue without a substitute symbol now, and if somebody figures out a way to get right and left associativity to play nice together I can just swap it and fix parens where needed.</p>",
        "id": 490345171,
        "sender_full_name": "Soundwave",
        "timestamp": 1734829347
    },
    {
        "content": "<p>I'm pretty confident that there's no workaround for the associativity issue, and I'm in good company running into it: Bauer seems to have concluded this as well.</p>\n<p>For my case it's perfectly workable to just build a toolchain that doesn't have notations I want to override, and this proved easy enough, so it's what I went with.</p>",
        "id": 490431597,
        "sender_full_name": "Soundwave",
        "timestamp": 1734914247
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814459\">Soundwave</span> has marked this topic as resolved.</p>",
        "id": 490431606,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734914259
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814459\">Soundwave</span> <a href=\"#narrow/stream/113488-general/topic/.E2.9C.94.20Notation.20conflict.20with.20prelude/near/490431597\">said</a>:</p>\n<blockquote>\n<p>For my case it's perfectly workable to just build a toolchain that doesn't have notations I want to override, and this proved easy enough, so it's what I went with.</p>\n</blockquote>\n<p>This sounds pretty unworkable to me. :-) You're proposing to maintain a fork solely so you can have some notations. How would you share your work with others? Use other libraries? Lean/Mathlib, for very good reasons, values global interoperability, and is very willing to say \"so don't use that notation\" in order to get achieve that.</p>",
        "id": 490576813,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1734984796
    },
    {
        "content": "<p>If I anticipated upstreaming or integrating this work, I wouldn't find it workable, certainly. There's far more pressing philosophical clashes with this work, like a strong preference for getting type theoretic conveniences by coercing set theoretic representations with tactics and coercions rather than native type theoretic constructions, as appropriate for, say, inclusion in mathlib.</p>\n<p>As for sharing it, I'm fortunate that elan makes it very nice; <del>you can already use a fork with some disabled default notations at--</del> whoops looks like I broke some tests. Shortly. Shortly you will be able to use a fork with the appropriate notation changes.</p>",
        "id": 490585144,
        "sender_full_name": "Soundwave",
        "timestamp": 1734988765
    }
]