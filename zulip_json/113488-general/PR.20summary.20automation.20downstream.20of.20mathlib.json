[
    {
        "content": "<p>For a project downstream of mathlib, I was missing the PR summary automation, so I wrote a script that copies it over.  If you also want to use it, you can find the script that I wrote <a href=\"https://gist.github.com/adomani/0e3a6c85f4235961940f9b1fa7f10a47\">here</a>!</p>",
        "id": 532331826,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1754062822
    },
    {
        "content": "<p>(By the way, I do not think that the project needs to be downstream of mathlib for the automation to work, but</p>\n<ul>\n<li>I have not tested it in this situation;</li>\n<li>you will still have to point the script to a copy of mathlib's root directory.)</li>\n</ul>",
        "id": 532332305,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1754062982
    },
    {
        "content": "<p>Ideally rather than a script which automatically incurs technical debt (unsynchronized copies of code being spammed across repositories!), we would instead package up the PR summary automation as a GitHub action, and remove the original code from Mathlib itself. </p>\n<p>(AI is good at this sort of task!)</p>",
        "id": 532526353,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1754203986
    },
    {
        "content": "<p>I created a standalone GitHub action for the PR summary, but have only tested on two of my repos.</p>\n<p>If you want to try it, you can use a <em>very preliminary</em> version by adding a file containing</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">PR Summary</span>\n<span class=\"nt\">on</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nt\">pull_request_target</span><span class=\"p\">:</span>\n\n<span class=\"c1\"># Limit permissions for GITHUB_TOKEN for the entire workflow</span>\n<span class=\"nt\">permissions</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nt\">contents</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">read</span>\n<span class=\"w\">  </span><span class=\"nt\">pull-requests</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">write</span><span class=\"w\">  </span><span class=\"c1\"># Only allow PR comments/labels</span>\n<span class=\"w\">  </span><span class=\"c1\"># All other permissions are implicitly 'none'</span>\n\n<span class=\"nt\">jobs</span><span class=\"p\">:</span>\n<span class=\"w\">  </span><span class=\"nt\">pr-summary</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nt\">runs-on</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ubuntu-latest</span>\n<span class=\"w\">    </span><span class=\"nt\">steps</span><span class=\"p\">:</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">adomani/PR_summary/@dev</span>\n</code></pre></div>\n<p>in your <code>.github/workflows</code> directory.  Once you merge it into master, the action will create a report on every push to every PR.</p>\n<p>By default it runs the import diff, the declarations diff and the renamed/removed files checks.</p>\n<p>The action has a few configuration options that I am happy to discuss, but right now, I would like to know that at least it <em>does something useful</em> if used as is!  <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 534498574,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1755182816
    },
    {
        "content": "<p>I think this is a great idea. A couple of small suggestions/problems I'm having testing: </p>\n<ul>\n<li>In the above I would suggest <code>pull_request</code> vs <code>pull_request_target</code> for simplicity in getting started (since the former uses the merge commit, you can see that it's working on the PR adding the workflow)</li>\n<li>There is an Mathlib-specific assumption that a <code>merge-conflict</code> label exists, so it is currently failing for me (testing in Cslib) before it gets to the actual diff.</li>\n</ul>",
        "id": 547817957,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761774405
    },
    {
        "content": "<p>Ah, there are a couple of labels that the script expects: let me find them.</p>",
        "id": 547818049,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761774458
    },
    {
        "content": "<p>As for <code>pull_request</code>, I thought that it was \"safer\" to use <code>pull_request_target</code>, but I am not really sure about the details.</p>",
        "id": 547818101,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761774483
    },
    {
        "content": "<p>The script expects these labels:</p>\n<ul>\n<li><code>file-removed</code></li>\n<li><code>large-import</code></li>\n<li><code>merge-conflict</code></li>\n</ul>",
        "id": 547818183,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761774519
    },
    {
        "content": "<p>I wonder if I could make the trigger customizable, so that you can run the workflow on <code>pull_request</code> or <code>pull_request_target</code> by setting a flag.</p>",
        "id": 547818398,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761774632
    },
    {
        "content": "<p>To clarify for everyone: I just meant <code>pull_request</code> if you're doing a quick test in your repo and want to see if it immediately works. We should probably use <code>pull_request_target</code> in general.</p>",
        "id": 547821835,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761776222
    }
]