[
    {
        "content": "<p>Hi everyone,<br>\nI am trying to improve performance of our program at runtime, and for that I would like to print in a <code>dbg_trace</code> (or elsewhere) the current time in milliseconds, to later perform analysis using them. Is there a proper way to do so?<br>\nI tried <code>IO.monoMsNow</code>, <code>IO.Process.output { cmd := \"date\", args := #[\"+%s%3N\"] }</code> and other related things, but it is always printing 0, and I couldn't find why.</p>\n<p>Thanks a lot :)</p>",
        "id": 534051217,
        "sender_full_name": "Samuel Chassot",
        "timestamp": 1755030606
    },
    {
        "content": "<p>I would probably suggest to work with proper profiling tools instead</p>",
        "id": 534051990,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1755030951
    },
    {
        "content": "<p>I am, but with them I am loosing information like what are the arguments passed to a given function for a given call.</p>",
        "id": 534052336,
        "sender_full_name": "Samuel Chassot",
        "timestamp": 1755031119
    },
    {
        "content": "<p>Well if your function is indeed in an IO compatible monad you should be able to use IO.monoMsNow and it should just print things, if it is then monoMsNow returning 0 is certainly a bug</p>",
        "id": 534052797,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1755031332
    },
    {
        "content": "<p>that's the thing, the function is already in an <code>Except</code> monad and I couldn't change the signature without introducing to much of a burden. I was using IO.monoMsNow with <code>unsafe</code></p>",
        "id": 534053093,
        "sender_full_name": "Samuel Chassot",
        "timestamp": 1755031482
    },
    {
        "content": "<p>If you do that the compiler can arbitrarily reorder the monoMsNow call, you will at least have to use the same continuation based trick that dbgTrace uses.</p>",
        "id": 534054125,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1755031968
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/113488-general/topic/dbg_trace.20timestamp.20milliseconds/near/534054125\">said</a>:</p>\n<blockquote>\n<p>If you do that the compiler can arbitrarily reorder the monoMsNow call, you will at least have to use the same continuation based trick that dbgTrace uses.</p>\n</blockquote>\n<p>Alright, that's what I suspected. Thank you!</p>",
        "id": 534059350,
        "sender_full_name": "Samuel Chassot",
        "timestamp": 1755034735
    }
]