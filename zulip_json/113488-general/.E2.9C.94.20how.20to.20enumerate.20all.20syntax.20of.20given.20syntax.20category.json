[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"hoge\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"fuga\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Can the code make sure that `hoge_cat` has only `hoge`, `fuga` and `foo`? -/</span>\n</code></pre></div>",
        "id": 482743885,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731739653
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"hoge\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"fuga\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hoge_cat</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">matchHogeCat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`hoge_cat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hoge_cat</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hoge</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hoge_cat</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">fuga</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">hoge_cat</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"c1\">-- why this line is needed? Without this line, the match is said not to be exhaustive.</span>\n</code></pre></div>",
        "id": 482747728,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731743328
    },
    {
        "content": "<blockquote>\n<p><code>why this line is needed?</code></p>\n</blockquote>\n<p>You can define additional <code>syntax</code> in that category <em>after</em> the definition is made. Syntax categories are extensible.</p>",
        "id": 482747814,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731743403
    },
    {
        "content": "<p>Even for non-extensible syntax you will find matches are not exhaustive. <code>TSyntax</code> does not ensure that the syntax is correct.</p>",
        "id": 482747897,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731743512
    },
    {
        "content": "<p>Is it impossible to guarantee that ‘this is all there is?’</p>",
        "id": 482748017,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731743630
    },
    {
        "content": "<p>Does this mean that these warning messages cannot be generated automatically?</p>\n<p><a href=\"/user_uploads/3121/rKyKl-2sGxFN3KHxZ7D1m5Sx/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/rKyKl-2sGxFN3KHxZ7D1m5Sx/image.png\" title=\"image.png\"><img data-original-dimensions=\"1231x158\" src=\"/user_uploads/thumbnail/3121/rKyKl-2sGxFN3KHxZ7D1m5Sx/image.png/840x560.webp\"></a></div>",
        "id": 482748859,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731744346
    },
    {
        "content": "<p>those messages are generated automatically</p>",
        "id": 482778737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731770532
    },
    {
        "content": "<blockquote>\n<p>those messages are generated automatically</p>\n</blockquote>\n<p>I want to know how this is implemented.</p>",
        "id": 482782963,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731774090
    },
    {
        "content": "<p>The parser turns all these declarations into an automaton, and so it generally knows at each point which tokens it was expecting to see and would not take it to a rejecting state. The error messages are constructed from that list of tokens.</p>",
        "id": 482787145,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731777497
    },
    {
        "content": "<p>This particular error message is coming from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Error.toString#src\">src#Lean.Parser.Error.toString</a></p>",
        "id": 482787198,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731777560
    },
    {
        "content": "<p>it's a bit complicated how the <code>Error</code> object acquires its <code>expected</code> list, but basically it's the union of all expected lists of errors at <code>&lt;|&gt;</code> nodes, and atomic tokens set the expected to something specific like <code>'foo'</code> for keyword parsers or <code>identifier</code> for the identifier parser</p>",
        "id": 482787453,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731777766
    },
    {
        "content": "<p>Here's an example using this method to get an error message with your keyword list:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"bla\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"hoge\"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"fuga\"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">bla</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"c1\">-- unexpected identifier; expected 'foo', 'fuga' or 'hoge'</span>\n</code></pre></div>",
        "id": 482787645,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731777957
    },
    {
        "content": "<p>If you want a closed class rather than an open one, you should use <code>&lt;|&gt;</code> instead of declaring a syntax category</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">hoge</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"hoge\"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"fuga\"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span>\n</code></pre></div>",
        "id": 482787729,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1731778013
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> Thank you!!!</p>",
        "id": 482787773,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1731778050
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> has marked this topic as resolved.</p>",
        "id": 482787780,
        "sender_full_name": "Notification Bot",
        "timestamp": 1731778054
    }
]