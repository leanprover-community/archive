[
    {
        "content": "<p>Hey, I am trying to formalize results from reverse mathematics. They reason about weak formal systems, so you want to restrict the set of tactics / theorems the user can use in order to prove a theorem. My approach was to define logic as a deep embedding completely inside Lean. Define what a logical formula is (this is inside Mathlib.ModelTheory), what is Natural Deduction, what it means to be provable etc. But today I thought of a different approach. I think that I can define a custom monad RCA0, and define custom monadic functions <code>def myIntro : RCA0M Unit</code>, <code>def myApply : RCA0M Unit</code> and in this way, 'whitelist' the tactics I want to allow in my weak proofs. I am trying this right now and hopefully, it'd enable me to formalize proofs written inside of RCA0, without defining my own logic +tactics for it from scratch, which is an ungodly amount of work.</p>\n<p>I vibe-coded a very small demo of this approach. Running proofs looks a bit like this for now:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Example usage</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">exampleProof</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RCA0M</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">st</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">st</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">imp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"s2\">\"P\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"s2\">\"P\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">myIntro</span>\n<span class=\"w\">  </span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">myAssumption</span>\n\n<span class=\"c1\">-- Run proof</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">exampleProof</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">imp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"s2\">\"P\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"s2\">\"P\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EStateM</span><span class=\"bp\">.</span><span class=\"n\">Result</span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">final</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Proof succeeded. Final goal: {final.goal}\"</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EStateM</span><span class=\"bp\">.</span><span class=\"n\">Result</span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Proof failed: {e}\"</span>\n</code></pre></div>\n<p>But this is not interactive. My question is: is the appropriate Lean4 functionality to enable user to interact with such a proof state interactively, Lean4 Widgets? This is slightly tricky, because ideally I would like the user to just import my library and write rca0 proof in some standard Lean4 code, but the text they write will not be a proof, really - it will be some text, then converted to code running inside of the custom RCA0M monad, to be executed by #eval proof.run(). Is this even feasible to finish such a functionality as for now?</p>",
        "id": 521113479,
        "sender_full_name": "Paweł Balawender",
        "timestamp": 1748531332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"892220\">Paweł Balawender</span> has marked this topic as resolved.</p>",
        "id": 521116423,
        "sender_full_name": "Notification Bot",
        "timestamp": 1748531954
    },
    {
        "content": "<p>Okay after more thought, Widgets won't help me here</p>",
        "id": 521116502,
        "sender_full_name": "Paweł Balawender",
        "timestamp": 1748531977
    }
]