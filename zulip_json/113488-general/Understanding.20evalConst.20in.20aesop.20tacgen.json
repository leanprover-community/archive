[
    {
        "content": "<p>I'm having trouble understanding what <code>evalConst</code> is actually doing in <code>tacGenImpl</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Precondition: `decl` has type `TacGen`.</span>\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tacGenImpl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RuleTac</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">tacGen</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">evalConst</span><span class=\"w\"> </span><span class=\"n\">TacGen</span><span class=\"w\"> </span><span class=\"n\">decl</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">initialState</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">saveState</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">tacGen</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">goal</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">apps</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">mkEmpty</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 505725669,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1741971756
    },
    {
        "content": "<p>It's getting the <code>TacGen</code> from an name.</p>",
        "id": 505726300,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741971939
    },
    {
        "content": "<p>so does it run a compiler on the string?</p>",
        "id": 505753420,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1741980919
    },
    {
        "content": "<p>It looks up the definition and evaluates it. Use like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TacGen</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"c1\">-- evalConst TacGen `foo</span>\n<span class=\"c1\">-- works here</span>\n</code></pre></div>",
        "id": 505754104,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741981190
    },
    {
        "content": "<p>Yeah, my understanding is that <code>evalConst TacGen decl</code> looks up the declaration whose name is given by <code>decl</code>, which has already been compiled, and then uses the interpreter to evaluate the compiled code, returning some runtime value, which must be a <code>TacGen</code>. If it's not actually a <code>TacGen</code>, then unspecified behavior occurs.</p>",
        "id": 505999543,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1742161415
    }
]