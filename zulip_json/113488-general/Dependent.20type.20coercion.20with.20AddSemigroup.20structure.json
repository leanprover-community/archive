[
    {
        "content": "<p>Is it possible to automatically cast an object of a dependent type to an other type that are equals because of the associativity of the addition provided by the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddSemigroup#doc\">docs#AddSemigroup</a> structure:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddSemigroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_assoc</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>I guess <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CoeDep#doc\">docs#CoeDep</a> could do the trick but I'm struggling with it</p>",
        "id": 525378396,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750699705
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"635099\">@Gaëtan Serré</span> what is the context? (i.e. what is the real value of E)? because the convention in mathlib is that for concrete values of E, there should be a <code>cast</code> function to transfer between equal types; e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/Fin/Basic.html#Fin.cast\">Fin.cast</a></p>",
        "id": 525381849,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750700748
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> I'm trying to formalize Markov kernels with different arrival and departure spaces. I do not have much more information on E except that each one is a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasurableSpace#doc\">docs#MeasurableSpace</a>.</p>\n<p>I could create a cast function MeasurableSpace.cast?</p>",
        "id": 525382145,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750700874
    },
    {
        "content": "<p>well, there's always <code>▸</code> which will work right now and will put you in what's called \"dependent type hell\" later down the line</p>",
        "id": 525382417,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701006
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"635099\">Gaëtan Serré</span> <a href=\"#narrow/channel/113488-general/topic/Dependent.20type.20coercion.20with.20AddSemigroup.20structure/near/525382145\">said</a>:</p>\n<blockquote>\n<p>I could create a cast function MeasurableSpace.cast?</p>\n</blockquote>\n<p>I don't think this will work, the <code>cast</code> function should only be on <code>E</code>, and not on the resulting type</p>",
        "id": 525382505,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701040
    },
    {
        "content": "<p>use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cast#doc\">docs#cast</a> to get a map from <code>E (a + (m + d))</code> to <code>E (a + m + d)</code></p>",
        "id": 525382588,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750701067
    },
    {
        "content": "<p>It's a bit of a miracle how we haven't run into problems yet with <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/GradedAlgebra/Basic.html#GradedRing\">GradedRing</a></p>",
        "id": 525382699,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701113
    },
    {
        "content": "<p>I don't think DTT hell is as bad as its made out to be</p>",
        "id": 525382789,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1750701147
    },
    {
        "content": "<p>Is what you want to implement related to that kind of kernel: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Kernel/Defs.html#ProbabilityTheory.Kernel\">ProbabilityTheory.Kernel</a>?</p>",
        "id": 525382812,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1750701157
    },
    {
        "content": "<blockquote>\n<p>well, there's always <code>▸</code> which will work right now and will put you in what's called \"dependent type hell\" later down the line</p>\n</blockquote>\n<p>I don't know about it, could you send a reference?</p>\n<blockquote>\n<p>I don't think this will work, the <code>cast</code> function should only be on <code>E</code>, and not on the resulting type</p>\n</blockquote>\n<p>Indeed, I wrote too fast!</p>",
        "id": 525382865,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701175
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"635099\">Gaëtan Serré</span> <a href=\"#narrow/channel/113488-general/topic/Dependent.20type.20coercion.20with.20AddSemigroup.20structure/near/525382865\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>well, there's always <code>▸</code> which will work right now and will put you in what's called \"dependent type hell\" later down the line</p>\n</blockquote>\n<p>I don't know about it, could you send a reference?</p>\n</blockquote>\n<p><a href=\"https://lean-lang.org/theorem_proving_in_lean4/Quantifiers-and-Equality/#quantifiers-and-equality\">TPIL4</a>:</p>\n<blockquote>\n<p>The triangle in the second presentation is a macro built on top of Eq.subst and Eq.symm, and you can enter it by typing \\t.</p>\n</blockquote>",
        "id": 525383197,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701311
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> Ok nice, should I just define a function that uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cast#doc\">docs#cast</a> and use it whenever I need it?</p>",
        "id": 525383223,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701319
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"350992\">@Rémy Degenne</span> Indeed, I use the definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Kernel#doc\">docs#Kernel</a> and the kernel composition</p>",
        "id": 525383288,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701349
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"635099\">Gaëtan Serré</span> <a href=\"#narrow/channel/113488-general/topic/Dependent.20type.20coercion.20with.20AddSemigroup.20structure/near/525383223\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> Ok nice, should I just define a function that uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=cast#doc\">docs#cast</a> and use it whenever I need it?</p>\n</blockquote>\n<p>again, it probably won't work if your <code>E</code> is a variable</p>",
        "id": 525383333,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701367
    },
    {
        "content": "<p>he's saying that you should just use <code>cast</code> itself</p>",
        "id": 525383371,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1750701386
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Thanks a lot!</p>",
        "id": 525383378,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701390
    },
    {
        "content": "<blockquote>\n<p>he's saying that you should just use <code>cast</code> itself</p>\n</blockquote>\n<p>Something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>\n<p>?</p>",
        "id": 525383491,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701439
    },
    {
        "content": "<p>See how</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_assoc</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>\n<p>goes. I think the idea is that if you stick with <code>cast</code> then hopefully <code>simp</code> will solve many of your problems.</p>",
        "id": 525383755,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750701566
    },
    {
        "content": "<p>This file is all about dealing with the type associativity issue for kernel composition: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Kernel/IonescuTulcea/PartialTraj.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Kernel/IonescuTulcea/PartialTraj.html</a></p>",
        "id": 525383781,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1750701582
    },
    {
        "content": "<p>Thank you! I'll look into <code>▸</code> out of curiosity</p>",
        "id": 525383808,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701592
    },
    {
        "content": "<blockquote>\n<p>See how</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">p'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_assoc</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">p</span>\n</code></pre></div>\n<p>goes. I think the idea is that if you stick with <code>cast</code> then hopefully <code>simp</code> will solve many of your problems.</p>\n</blockquote>\n<p>It seems to work fine, I'll see ago it goes when doing more involved stuff</p>",
        "id": 525384020,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701665
    },
    {
        "content": "<p>I don't know what you want to do so I can't tell if the technique used by <span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> for Ionescu-Tulcea would be adapted for your use case, but you might want to have a look.</p>",
        "id": 525384082,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1750701687
    },
    {
        "content": "<blockquote>\n<p>This file is all about dealing with the type associativity issue for kernel composition: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Kernel/IonescuTulcea/PartialTraj.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Kernel/IonescuTulcea/PartialTraj.html</a></p>\n</blockquote>\n<p>Ok nice thank you very much! I'll look into that as well</p>\n<blockquote>\n<p>I don't know what you want to do so I can't tell if the technique used by @Etienne Marion for Ionescu-Tulcea would be adapted for your use case, but you might want to have a look.</p>\n</blockquote>\n<p>For a research project, I started to try to unify definitions of Markov processes and SDE from several books. I ended up with an pretty abstract definition of transition kernels that act on different measurable spaces and depend on a probability law. I was kind of lost at some point so I started to formalize this definition. Also, I'm in a continuous time setting. I think the technique used by <span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> can be very useful for the future of my work.</p>",
        "id": 525384777,
        "sender_full_name": "Gaëtan Serré",
        "timestamp": 1750701956
    }
]