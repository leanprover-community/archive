[
    {
        "content": "<p>I was wondering if someone might have a suggestion for how to go about proving that this terminates:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">CompileInductive</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">atom_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">forall_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exists_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"n\">compile_inductive</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n</code></pre></div>",
        "id": 495434882,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737615147
    },
    {
        "content": "<p>The issue seems to be the calls of the form <code>to_nnf (not_ phi)</code> and <code>to_nnf (not_ psi)</code> on the rhs.</p>",
        "id": 495434941,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737615203
    },
    {
        "content": "<p>Right, these aren't obviously smaller, are they? <br>\nIf you specify <code>termination_by f =&gt; f</code> then you should get better error messagea about what could not be solved here. Maybe you need a custom measure that really is decreasing.</p>",
        "id": 495447118,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737620699
    },
    {
        "content": "<p>Alternatively and maybe cleaner: write two mutually recursive functions, <code>to_nnf</code> and <code>to_nnf_neg</code>. Then you might even get away with structural recursion!</p>",
        "id": 495447370,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737620783
    },
    {
        "content": "<p>Oh, yes, the <code>imp</code> case will clearly make it hard to get your current definition through, at least without a very carefully crafted measure that makes <code>not</code> cheap and <code>imp</code> expensive. Try the mutual variant!</p>",
        "id": 495447548,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737620861
    },
    {
        "content": "<p>And read <a href=\"https://lean-lang.org/blog/2024-1-11-recursive-definitions-in-lean/\">https://lean-lang.org/blog/2024-1-11-recursive-definitions-in-lean/</a> if you haven't already!</p>",
        "id": 495447720,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737620916
    },
    {
        "content": "<p>Do you mean one that translates a formula <code>F</code> and another that translates <code>not F</code>?</p>",
        "id": 495447813,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737620958
    },
    {
        "content": "<p>I see. I'll give it a try. Thank you!</p>",
        "id": 495447922,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737620991
    },
    {
        "content": "<p>Right. This way you should never have to make bigger arguments in the recursive calls</p>",
        "id": 495447931,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737620996
    },
    {
        "content": "<p>This seems to type check. I'll have to prove some properties to make sure it means the same thing.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">CompileInductive</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">atom_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">forall_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exists_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"n\">compile_inductive</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n\n<span class=\"kn\">mutual</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Formula_</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Formula_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n<span class=\"kn\">end</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">false_</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"o\">))</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"o\">)))</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">false_</span><span class=\"o\">))))</span>\n</code></pre></div>",
        "id": 495455518,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737623353
    },
    {
        "content": "<p>I’d replace</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imp_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">iff_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">or_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">and_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf_neg</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">to_nnf</span><span class=\"w\"> </span><span class=\"n\">psi</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">not_</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">to_nnf_not</span><span class=\"w\"> </span><span class=\"n\">phi</span>\n</code></pre></div>\n<p>no need to duplicate that logic!</p>",
        "id": 495455696,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737623406
    },
    {
        "content": "<p>That did seem to be odd to me.</p>",
        "id": 495455873,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737623467
    },
    {
        "content": "<p>Hmm, why? Seems natural to me. After all, <code>to_nnf_not phi</code> is meant to be the helper to implement <code>to_nnf (not phi)</code></p>",
        "id": 495456406,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737623640
    },
    {
        "content": "<p>No, I mean it seemed odd to have the same logic twice.</p>",
        "id": 495456496,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737623663
    },
    {
        "content": "<p>Cool. Thank you!</p>",
        "id": 495456683,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1737623731
    }
]