[
    {
        "content": "<p>I tried to update my code to Lean v4.25.0-rc2, but  I got the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">120</span><span class=\"bp\">/</span><span class=\"mi\">1438</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">latest</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">If</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">work</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">report</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">issue</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Zulip</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Since I have not found a solution. I cleaned up the repo </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">manifest</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span>\n</code></pre></div>\n<p>and manually updated the lean-toolchain to  </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">24</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n</code></pre></div>\n<p>After that,  I executed</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fad</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">manifest</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">creating</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">scratch</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">afa82c7ce3e4de5ce7506b6766458e0b3386e0f5'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">updating</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">25</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2'</span>\n<span class=\"bp\">...</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">120</span><span class=\"bp\">/</span><span class=\"mi\">1438</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">Please</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">latest</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">If</span>\n</code></pre></div>\n<p>So back to the same error! Why did the lake update to <code>v4.25.0-rc2</code> automatically? What is the proper way to say 'I want to use Lean version X`</p>\n<p>I see some error in the output of the build with <code>-v</code> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ℹ</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">451</span><span class=\"bp\">/</span><span class=\"mi\">536</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widgetPackageLock</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././</span><span class=\"n\">widget</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">npm</span><span class=\"w\"> </span><span class=\"n\">install</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stdout</span><span class=\"o\">:</span>\n<span class=\"n\">added</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">changed</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">audited</span><span class=\"w\"> </span><span class=\"mi\">367</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">s</span>\n\n<span class=\"mi\">67</span><span class=\"w\"> </span><span class=\"n\">packages</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">looking</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">funding</span>\n<span class=\"w\">  </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"ss\">`npm</span><span class=\"w\"> </span><span class=\"n\">fund</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span>\n\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">moderate</span><span class=\"w\"> </span><span class=\"n\">severity</span><span class=\"w\"> </span><span class=\"n\">vulnerability</span>\n\n<span class=\"n\">To</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">issues</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">npm</span><span class=\"w\"> </span><span class=\"n\">audit</span><span class=\"w\"> </span><span class=\"n\">fix</span>\n\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"ss\">`npm</span><span class=\"w\"> </span><span class=\"n\">audit</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>After running <code>npm audit fix</code> I got the same error!</p>",
        "id": 555448660,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1763064408
    },
    {
        "content": "<p>Is your project using mathlib? What does your <code>lakefile.toml</code> look like?</p>\n<p>As <code>lake --help</code> says: \"A bare <code>lake update</code> will upgrade all dependencies.\" so if you depend on something that in its latest version wants to have a newer toolchain then <code>lake update</code> will also update your toolchain, I think.</p>\n<p>(In my own projects this is why I prefer to pin a specific version of mathlib too.)</p>",
        "id": 555451980,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1763065669
    },
    {
        "content": "<p>You are right. I believe I had learn that before, but I forgot. Previously, my <code>lakefile.toml</code> had only: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n</code></pre></div>\n<p>So no <code>rev</code> specified. So the main point here is that <code>lean-toolchain</code> does not dictate the version; it can be updated by the dependencies.  Once I fixed the <code>rev</code> of Mathlib, I can now work with <code>v4.24.0</code>.</p>",
        "id": 555460211,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1763068721
    },
    {
        "content": "<p>I'd like to understand the problem you're having on <code>v4.25.0-rc2</code>, nevertheless. Can you provide a commit SHA in a repository, such that <code>lake build</code> will produce the \"error: ProofWidgets not up-to-date.\" message, but run <code>lake exe cache get</code> does not resolve the problem?</p>",
        "id": 555477033,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763076427
    },
    {
        "content": "<p>This seems to be the same bug as <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/ProofWidgets.20not.20building.2C.20says.20it.20is.20out.20of.20date/with/555460198\">#new members &gt; ProofWidgets not building, says it is out of date</a></p>",
        "id": 555494357,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1763087150
    }
]