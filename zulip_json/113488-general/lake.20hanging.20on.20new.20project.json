[
    {
        "content": "<p>My <code>lake</code> is hanging in the following way: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">peternelson</span><span class=\"bp\">@</span><span class=\"n\">Peters</span><span class=\"bp\">-</span><span class=\"n\">MacBook</span><span class=\"bp\">-</span><span class=\"n\">Pro</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"n\">peternelson</span><span class=\"bp\">@</span><span class=\"n\">Peters</span><span class=\"bp\">-</span><span class=\"n\">MacBook</span><span class=\"bp\">-</span><span class=\"n\">Pro</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">math</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"ss\">`lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"n\">peternelson</span><span class=\"bp\">@</span><span class=\"n\">Peters</span><span class=\"bp\">-</span><span class=\"n\">MacBook</span><span class=\"bp\">-</span><span class=\"n\">Pro</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"n\">peternelson</span><span class=\"bp\">@</span><span class=\"n\">Peters</span><span class=\"bp\">-</span><span class=\"n\">MacBook</span><span class=\"bp\">-</span><span class=\"n\">Pro</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">manifest</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">creating</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">scratch</span>\n</code></pre></div>\n<p>And nothing further after waiting minutes. <br>\nSimilar for <code>lake build</code>.  I have killed any lean/lake related processes and vscode, and tried updating <code>elan</code> and a system reset, and the problem persists. Things work fine inside a mathlib directory.</p>\n<p>Can anyone help?</p>",
        "id": 495613866,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1737681168
    },
    {
        "content": "<p>And like magic, the problem disappeared after half an hour during which time I'd done nothing. </p>\n<p>I think this has happened to me before, and I've been as baffled in the past as I am now. Does this kind of behaviour ring any bells?</p>",
        "id": 495617785,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1737683560
    },
    {
        "content": "<p>It could be temporary network issues since it was likely trying to download dependencies</p>",
        "id": 495620884,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737685688
    },
    {
        "content": "<p>Would that also be a problem with <code>lake build</code>?</p>",
        "id": 495623970,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1737687772
    },
    {
        "content": "<p>Sure, they are build dependencies</p>",
        "id": 495625178,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737688576
    },
    {
        "content": "<p>It would be nice to have lake indicate this failure mode rather than hang.</p>",
        "id": 495808113,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1737760347
    },
    {
        "content": "<p>You didn't specify your Lean version, this should be addressed by <a href=\"https://github.com/leanprover/lean4/issues/5615\">https://github.com/leanprover/lean4/issues/5615</a></p>",
        "id": 495808830,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737760796
    },
    {
        "content": "<p>However given using Mathlib should have upgraded Lean, it may be a different issue after all</p>",
        "id": 495808968,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737760864
    },
    {
        "content": "<p>I can confirm this still exists. If you have no internet connection and no manifest, you see:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyProject</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">manifest</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">creating</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">scratch</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">curl'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Reservoir</span><span class=\"w\"> </span><span class=\"n\">lookup</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">materialize</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">transient</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">bug</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">Reservoir</span>\n</code></pre></div>\n<p>but notice that no info message is printed before the Reservoir lookup (which is done via <code>curl</code>). If that stalls due to network issues, you'll get an apparent hang.</p>",
        "id": 495891848,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1737828014
    },
    {
        "content": "<p>Thanks for confirming, could you please leave a comment in the issue?</p>",
        "id": 495928855,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737862561
    }
]