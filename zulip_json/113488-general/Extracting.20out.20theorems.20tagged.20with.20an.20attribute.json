[
    {
        "content": "<p>I am interested in extracting out theorems that I tag with <code>@[rewrite]</code> in the same manner that Tao's Equational Theories project uses the <a href=\"https://github.com/teorth/equational_theories/blob/main/scripts/extract_implications.lean\">extract_implications.lean</a> or <a href=\"https://github.com/teorth/equational_theories/blob/main/scripts/export_equations.lean\">export_equations.lean</a>. It is used in the CI like so to generate a list of equations:</p>\n<p><a href=\"/user_uploads/3121/kHRsKXk_keZW_rVG9USss8Sa/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kHRsKXk_keZW_rVG9USss8Sa/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1501x293\" src=\"/user_uploads/thumbnail/3121/kHRsKXk_keZW_rVG9USss8Sa/image.png/840x560.webp\"></a></div><p>I am guessing that on an attribute use, the registered attribute will add to a global list of implications or equations? <a href=\"https://github.com/teorth/equational_theories/blob/main/equational_theories/EquationalResult.lean#L79\">EquationalResult.lean</a> might have what I'm explaining.</p>\n<p>The goal for my project is to formalise compiler rewrite rules, so I would define a theorem in Lean and use the <code>@[rewrite]</code> attribute to tag a theorem as a valid rewrite, given it's proven. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">rewrite</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">const_swap</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">con1</span><span class=\"w\"> </span><span class=\"n\">con2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BitVec</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">con1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">con2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">con1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">con2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>\n<p>It would be nice to be able to extract out all of these theorems, iterate over them, and output a list of valid rules to my liking. Just at the moment, I do not know how to implement an attribute that would do such a thing. The Lean metaprogramming handbook did not have anything on attributes and the reference wasn't too helpful either. Could anyone explain to me a basic skeleton for what needs to get done?</p>",
        "id": 538113627,
        "sender_full_name": "l1mey",
        "timestamp": 1757290107
    },
    {
        "content": "<p>what I do in these kinds of situations is I find an attribute and I copy how it works</p>",
        "id": 538113684,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757290193
    },
    {
        "content": "<p>I'm currently trying with the Equational Theories attributes, will let people know how it goes.</p>",
        "id": 538113733,
        "sender_full_name": "l1mey",
        "timestamp": 1757290251
    },
    {
        "content": "<p>here's an example you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Meta.NormNum.normNumExt#doc\">docs#Mathlib.Meta.NormNum.normNumExt</a></p>",
        "id": 538113779,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757290288
    },
    {
        "content": "<p>If you want another example, I had a similar situation in LeanRPC.<br>\nI define a custom attribute, then collect and process all functions tagged with it:<br>\n<a href=\"https://github.com/oOo0oOo/LeanRPC/blob/cfa37190964d4d3468ad6e293d9911af2009f053/LeanRPC/Attribute.lean#L22\">https://github.com/oOo0oOo/LeanRPC/blob/cfa37190964d4d3468ad6e293d9911af2009f053/LeanRPC/Attribute.lean#L22</a></p>",
        "id": 538163045,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1757320588
    }
]