[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `Arity α` is a type class that gives the arity (number of arguments) of the type `α`. -/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Arity</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Arity</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"c1\">-- The arity of a non-function type is 0</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"c1\">-- The arity of a single-argument function type is 1</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- The arity of a two-argument function type is 2</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n\n<span class=\"c1\">-- A function type that takes a tuple has “one argument”, so the arity is 1</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 536582273,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1756379568
    },
    {
        "content": "<h3>My Question</h3>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Arity</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>This instance is for the base case, and normally one would specify <code>priority := low</code>.<br>\nHowever, as in the code above, it seems to work fine even without specifying <code>priority := low</code>.<br>\nI thought Lean usually gives priority to instances declared later, so why does the code above work without any issues?</p>",
        "id": 536582688,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1756379727
    },
    {
        "content": "<p>More generic instances are always tried later</p>",
        "id": 536583937,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756380254
    },
    {
        "content": "<p>So does that mean there is absolutely no need to specify <code>priority := low</code>?</p>",
        "id": 536687361,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1756417281
    },
    {
        "content": "<p>Well, if you had another generic instance <code>XYZ α → Arity α</code> because of something like <code>extends Arity α</code>, <code>priority := low</code> might be better for disambiguation</p>",
        "id": 536689005,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756418519
    },
    {
        "content": "<p>Even then, it might not be explicitly needed but might be better for clarity</p>",
        "id": 536689035,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756418542
    },
    {
        "content": "<p>The way Lean determines the order of instances is:</p>\n<ol>\n<li>compare the given priority</li>\n<li>compare where the instances are stored in the discrimination tree. The consequence of this is that more specific instances are tried before more generic instances.</li>\n<li>first try instances that are declared later</li>\n</ol>\n<p>So yes, there is technically no need to specify <code>priority := low</code> in your example. But as <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> said, specifying the low priority explicit makes the code much easier to understand.</p>",
        "id": 536689426,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1756418742
    },
    {
        "content": "<p>Thank you!!</p>",
        "id": 536773831,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1756469061
    }
]