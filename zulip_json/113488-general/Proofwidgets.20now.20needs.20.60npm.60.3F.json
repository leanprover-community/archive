[
    {
        "content": "<p>I've just run a fresh clean and rebuild of my project, and I'm getting the following error (Windows 11) - do we now need <code>npm</code> to build proofwidgets, even with cache? This seems like something's misconfigured.</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell\"><pre><span></span><code><span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span> <span class=\"n\">lake</span> <span class=\"n\">exe</span> <span class=\"n\">cache</span> <span class=\"n\">clean</span><span class=\"p\">!</span>\n<span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span> <span class=\"n\">lake</span> <span class=\"n\">exe</span> <span class=\"n\">cache</span> <span class=\"n\">get</span>\n<span class=\"n\">Attempting</span> <span class=\"n\">to</span> <span class=\"n\">download</span> <span class=\"n\">5641</span> <span class=\"n\">file</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>\n<span class=\"n\">Downloaded</span><span class=\"p\">:</span> <span class=\"n\">5641</span> <span class=\"n\">file</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"p\">[</span><span class=\"n\">attempted</span> <span class=\"n\">5641</span><span class=\"p\">/</span><span class=\"n\">5641</span> <span class=\"p\">=</span> <span class=\"n\">100</span><span class=\"p\">%]</span> <span class=\"p\">(</span><span class=\"n\">100</span><span class=\"p\">%</span> <span class=\"n\">success</span><span class=\"p\">)</span>\n<span class=\"n\">Decompressing</span> <span class=\"n\">5641</span> <span class=\"n\">file</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>\n<span class=\"n\">Unpacked</span> <span class=\"k\">in</span> <span class=\"n\">42721</span> <span class=\"n\">ms</span>\n<span class=\"n\">Completed</span> <span class=\"n\">successfully</span><span class=\"p\">!</span>\n<span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span> <span class=\"n\">lake</span> <span class=\"n\">build</span>\n<span class=\"n\">Ô</span><span class=\"err\">£</span><span class=\"n\">û</span> <span class=\"p\">[</span><span class=\"n\">440</span><span class=\"p\">/</span><span class=\"n\">1047</span><span class=\"p\">]</span> <span class=\"n\">Building</span> <span class=\"n\">proofwidgets</span><span class=\"p\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">trace</span><span class=\"p\">:</span> <span class=\"p\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"p\">\\</span><span class=\"n\">packages</span><span class=\"p\">\\</span><span class=\"n\">proofwidgets</span><span class=\"p\">\\</span><span class=\"n\">widget</span><span class=\"p\">&gt;</span> <span class=\"n\">npm</span><span class=\"p\">.</span><span class=\"n\">cmd</span> <span class=\"n\">clean-install</span>\n<span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">execute</span> <span class=\"s1\">'npm.cmd'</span><span class=\"p\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"p\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"p\">:</span> <span class=\"n\">2</span><span class=\"p\">)</span>\n<span class=\"n\">Some</span> <span class=\"n\">required</span> <span class=\"n\">builds</span> <span class=\"n\">logged</span> <span class=\"n\">failures</span><span class=\"p\">:</span>\n<span class=\"p\">-</span> <span class=\"n\">proofwidgets</span><span class=\"p\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">build</span> <span class=\"n\">failed</span>\n<span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span> <span class=\"n\">lake</span> <span class=\"n\">build</span>\n<span class=\"n\">Ô</span><span class=\"err\">£</span><span class=\"n\">û</span> <span class=\"p\">[</span><span class=\"n\">440</span><span class=\"p\">/</span><span class=\"n\">1047</span><span class=\"p\">]</span> <span class=\"n\">Building</span> <span class=\"n\">proofwidgets</span><span class=\"p\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">trace</span><span class=\"p\">:</span> <span class=\"p\">.\\.\\.</span><span class=\"n\">lake</span><span class=\"p\">\\</span><span class=\"n\">packages</span><span class=\"p\">\\</span><span class=\"n\">proofwidgets</span><span class=\"p\">\\</span><span class=\"n\">widget</span><span class=\"p\">&gt;</span> <span class=\"n\">npm</span><span class=\"p\">.</span><span class=\"n\">cmd</span> <span class=\"n\">clean-install</span>\n<span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">execute</span> <span class=\"s1\">'npm.cmd'</span><span class=\"p\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"p\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"p\">:</span> <span class=\"n\">2</span><span class=\"p\">)</span>\n<span class=\"n\">Some</span> <span class=\"n\">required</span> <span class=\"n\">builds</span> <span class=\"n\">logged</span> <span class=\"n\">failures</span><span class=\"p\">:</span>\n<span class=\"p\">-</span> <span class=\"n\">proofwidgets</span><span class=\"p\">/</span><span class=\"n\">widgetJsAll</span>\n<span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">build</span> <span class=\"n\">failed</span>\n<span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span> <span class=\"n\">npm</span>\n<span class=\"n\">npm</span> <span class=\"p\">:</span> <span class=\"n\">The</span> <span class=\"n\">term</span> <span class=\"s1\">'npm'</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">recognized</span> <span class=\"n\">as</span> <span class=\"n\">the</span> <span class=\"n\">name</span> <span class=\"n\">of</span> <span class=\"n\">a</span> <span class=\"n\">cmdlet</span><span class=\"p\">,</span> <span class=\"k\">function</span><span class=\"p\">,</span> <span class=\"n\">script</span> <span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"n\">or</span> <span class=\"n\">operable</span> <span class=\"n\">program</span><span class=\"p\">.</span> <span class=\"n\">Check</span> <span class=\"n\">the</span>\n<span class=\"n\">spelling</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">or</span> <span class=\"k\">if</span> <span class=\"n\">a</span> <span class=\"n\">path</span> <span class=\"n\">was</span> <span class=\"n\">included</span><span class=\"p\">,</span> <span class=\"n\">verify</span> <span class=\"n\">that</span> <span class=\"n\">the</span> <span class=\"n\">path</span> <span class=\"n\">is</span> <span class=\"n\">correct</span> <span class=\"n\">and</span> <span class=\"k\">try</span> <span class=\"n\">again</span><span class=\"p\">.</span>\n<span class=\"n\">At</span> <span class=\"n\">line</span><span class=\"p\">:</span><span class=\"n\">1</span> <span class=\"n\">char</span><span class=\"p\">:</span><span class=\"n\">1</span>\n<span class=\"p\">+</span> <span class=\"n\">npm</span>\n<span class=\"p\">+</span> <span class=\"p\">~~~</span>\n    <span class=\"p\">+</span> <span class=\"n\">CategoryInfo</span>          <span class=\"p\">:</span> <span class=\"n\">ObjectNotFound</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"n\">npm</span><span class=\"p\">:</span><span class=\"n\">String</span><span class=\"p\">)</span> <span class=\"p\">[],</span> <span class=\"n\">CommandNotFoundException</span>\n    <span class=\"p\">+</span> <span class=\"n\">FullyQualifiedErrorId</span> <span class=\"p\">:</span> <span class=\"n\">CommandNotFoundException</span>\n\n<span class=\"nb\">PS </span><span class=\"n\">C</span><span class=\"p\">:\\</span><span class=\"n\">Users</span><span class=\"p\">\\</span><span class=\"n\">skywi</span><span class=\"p\">\\</span><span class=\"n\">Documents</span><span class=\"p\">\\</span><span class=\"n\">code</span><span class=\"p\">\\</span><span class=\"n\">con-nf</span><span class=\"p\">&gt;</span>\n</code></pre></div>",
        "id": 484572221,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732645352
    },
    {
        "content": "<p>I think <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/cache.20rebuilding.20proofwidgets.20JS\">#mathlib4 &gt; cache rebuilding proofwidgets JS</a>  (and maybe one other recent thread) is relevant.</p>",
        "id": 484572395,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732645432
    },
    {
        "content": "<p>Looks like <code>rm -r .lake</code> and then trying again is probably your first step at the minute.</p>",
        "id": 484572505,
        "sender_full_name": "Julian Berman",
        "timestamp": 1732645477
    },
    {
        "content": "<p>Thanks, I'll give it a shot.</p>",
        "id": 484572736,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732645577
    },
    {
        "content": "<p>That seems to have done the trick, thanks!</p>",
        "id": 484573097,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1732645726
    },
    {
        "content": "<p>I <em>think</em> we now have a fix in place for this, so hopefully it's not going to keep happening!</p>",
        "id": 484860905,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732781569
    },
    {
        "content": "<p>I think I met this problem too just now,  even after re-downloading the repo it still have this problem.<br>\n<a href=\"/user_uploads/3121/1V_gAXqd8nDIzniROtsMBtKl/.png\">图片.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/1V_gAXqd8nDIzniROtsMBtKl/.png\" title=\"图片.png\"><img data-original-dimensions=\"1737x755\" src=\"/user_uploads/thumbnail/3121/1V_gAXqd8nDIzniROtsMBtKl/.png/840x560.webp\"></a></div>",
        "id": 485789944,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1733216053
    },
    {
        "content": "<p>Could you give the exact instructions for reproducing? That would be really helpful.</p>",
        "id": 485792322,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733216754
    },
    {
        "content": "<p>This happens after only running <code>lake exe cache get</code> in a newly cloned <code>Mathlib4</code>, when building it got this error. Sorry that I don't know anything else that might cause this.</p>",
        "id": 485809838,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1733221161
    },
    {
        "content": "<p>But it is resolved for now, after deleting <code>.lake</code> and rerun <code>lake exe cache get</code>, I don't really know the difference between the two.</p>",
        "id": 485810267,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1733221267
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"749361\">@Nailin Guan</span>, unfortunately I can't reproduce. When did you do this? If it happens again, to you or anyone else, please ignore the git SHA for the commit you were using. This may be essential for reproducing whatever problems are occurring.</p>\n<p>Here's what I see, on a machine without npm installed:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">kim</span><span class=\"bp\">@</span><span class=\"n\">carica</span><span class=\"w\"> </span><span class=\"n\">scratch</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"bp\">@</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"o\">:</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">Cloning</span><span class=\"w\"> </span><span class=\"n\">into</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">mathlib4'</span><span class=\"bp\">...</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Enumerating</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">688856</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Counting</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">8116</span><span class=\"bp\">/</span><span class=\"mi\">8116</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Compressing</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3922</span><span class=\"bp\">/</span><span class=\"mi\">3922</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"mi\">688856</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">delta</span><span class=\"w\"> </span><span class=\"mi\">5613</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">reused</span><span class=\"w\"> </span><span class=\"mi\">6228</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">delta</span><span class=\"w\"> </span><span class=\"mi\">4152</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">pack</span><span class=\"bp\">-</span><span class=\"n\">reused</span><span class=\"w\"> </span><span class=\"mi\">680740</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"n\">Receiving</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">688856</span><span class=\"bp\">/</span><span class=\"mi\">688856</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mf\">312.67</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mf\">8.43</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">Resolving</span><span class=\"w\"> </span><span class=\"n\">deltas</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">559449</span><span class=\"bp\">/</span><span class=\"mi\">559449</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">5858</span><span class=\"bp\">/</span><span class=\"mi\">5858</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">done</span><span class=\"bp\">.</span>\n<span class=\"n\">kim</span><span class=\"bp\">@</span><span class=\"n\">carica</span><span class=\"w\"> </span><span class=\"n\">scratch</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span>\n<span class=\"n\">kim</span><span class=\"bp\">@</span><span class=\"n\">carica</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">rev</span><span class=\"bp\">-</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">HEAD</span>\n<span class=\"n\">deb1faaee197406368b6bc1f680c5c242c955045</span>\n<span class=\"n\">kim</span><span class=\"bp\">@</span><span class=\"n\">carica</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">plausible</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">plausible</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">8</span><span class=\"n\">e5cb8d424df462f84997dd68af6f40e347c3e35'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchClient</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">d7caecce0d0f003fd5e9cce9a61f1dd6ba83142b'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">importGraph</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"kn\">import</span><span class=\"bp\">-</span><span class=\"n\">graph</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">importGraph</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">ed3b856bd8893ade75cafe13e8544d4c2660f377'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">2</span><span class=\"n\">b000e02d50394af68cfb4770a291113d94801b5'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">aesop</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">aesop</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">8</span><span class=\"n\">b6048aa0a4a4b6bcf83597802d8dee734e64b7e'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">quote4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">ad942fdf0b15c38bface6acbb01d63855a2519ac'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">batteries</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">7805</span><span class=\"n\">acf1864ba1a2e359f86a8f092ccf1438ad83'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">cli</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">0</span><span class=\"n\">c8ea32a15a4f74143e4e1e107ba2c412adb90fd'</span>\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">3296</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3296</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">3296</span><span class=\"bp\">/</span><span class=\"mi\">3296</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">success</span><span class=\"o\">)</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">5698</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">12969</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n<span class=\"n\">kim</span><span class=\"bp\">@</span><span class=\"n\">carica</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 485823102,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733224806
    },
    {
        "content": "<p>It will really help the next time anyone encounters this if they can give the exact steps that led up to it, including the git SHA of the branch they are on. But even with that it may be a transient issue with some corruption inside <code>.lake</code>... Hopefully not!</p>",
        "id": 485823264,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733224853
    },
    {
        "content": "<p>I just encountered this again, but was unable to reproduce. What I didn't try was zipping up the contents of <code>.lake</code>, and seeing if I could reproduce using that.</p>",
        "id": 485973053,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1733267843
    },
    {
        "content": "<p>I ran into it while trying to prepare a hot cache of both the latest mathlib head and two previous stable releases, possibly also with some <code>lake exe cache unpack</code>s mixed in</p>",
        "id": 486000106,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733280606
    },
    {
        "content": "<p>Maybe this is just some problem with my internet connection, never mind.</p>",
        "id": 486069224,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1733311339
    },
    {
        "content": "<p>Could the logic be changed so that the behavior isn't dependent on how reliable the Internet connection is?</p>",
        "id": 486071068,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733311948
    },
    {
        "content": "<p>That is, make the user set a <code>PROOFWIDGETS_LOCAL_BUILD</code> environment variable or something if they want the npm build, and let the network error propagate normally when this isn't set.</p>",
        "id": 486071259,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733312021
    },
    {
        "content": "<p>I just run in the same problem with SHA<br>\nbfa197c8cff3cb63a8115130b7a43ef4cb15efbe</p>",
        "id": 486108778,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1733323462
    },
    {
        "content": "<p>I am now trying to delete <code>.lake</code> and move on.</p>",
        "id": 486108825,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1733323476
    },
    {
        "content": "<p>Indeed, after deleting the <code>.lake</code> folder altogether and calling <code>lake exe cache get</code> everything works perfectly./</p>",
        "id": 486114624,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1733324955
    },
    {
        "content": "<p>A fix for what is believed to be the issue here is up at <a href=\"https://github.com/leanprover-community/mathlib4/pull/19728\">mathlib4#19728</a>.</p>",
        "id": 486146093,
        "sender_full_name": "Mac Malone",
        "timestamp": 1733333869
    },
    {
        "content": "<p>I hit this problem again on 4.15.0</p>",
        "id": 492718620,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736428318
    },
    {
        "content": "<p>mathlib SHA 9837ca9d65d9de6fad1ef4381750ca688774e608</p>",
        "id": 492718893,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736428385
    },
    {
        "content": "<p>I think the current diagnosis is that the error now means \"the prebuilt version couldn't be fetched, so we are building it from source\".  Unfortunately this information is probably cached, so you might have to delete <code>.lake/packages/proofwidgets/.lake/build</code> and try again</p>",
        "id": 492721241,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429020
    },
    {
        "content": "<p>But if the fetch failure is indeed cached, that's still good to report</p>",
        "id": 492721407,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429072
    },
    {
        "content": "<p>I've done the usual fix of deleting <code>.lake</code> and doing clean + get cache twice, and I'm still getting the npm error</p>",
        "id": 492721495,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429100
    },
    {
        "content": "<p>Oh, that's bad</p>",
        "id": 492721532,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429110
    },
    {
        "content": "<p>Yeah, no idea how to resolve this...</p>",
        "id": 492721572,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429121
    },
    {
        "content": "<p>Does <code>lake build --no-build proofwidgets:release</code> print anything else?</p>",
        "id": 492721857,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429193
    },
    {
        "content": "<p>That says build completed successfully</p>",
        "id": 492721917,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429212
    },
    {
        "content": "<p>And then <code>lake build proofwidgets:release</code>errors out, I assume</p>",
        "id": 492722383,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429349
    },
    {
        "content": "<p>That also builds successfully</p>",
        "id": 492722513,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429391
    },
    {
        "content": "<p>Which file fails to build when you do a normal <code>lake build</code>?</p>",
        "id": 492722665,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736429429
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">416</span><span class=\"bp\">/</span><span class=\"mi\">5851</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widgetPackageLock</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widget</span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">npm</span><span class=\"w\"> </span><span class=\"n\">install</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">npm'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">npm'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">255</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span><span class=\"n\">widgetPackageLock</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>",
        "id": 492722698,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429439
    },
    {
        "content": "<p>Incidentally, my cache seems to be broken, even after executing cache get it needs to rebuild mathlib since updating yesterday. Could be linked?</p>",
        "id": 492722881,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1736429495
    },
    {
        "content": "<p>That might be <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/lake.20exe.20cache.20get.20error\">#mathlib4 &gt; lake exe cache get error</a> instead. Right now I'm on 4.15.0, which I think doesn't have that problem</p>",
        "id": 492723138,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736429559
    },
    {
        "content": "<p>Hmm, ProofWidgets in mathlib was bumped straight from 0.0.48 (4.15.0-rc1) to 0.0.50 (4.16.0-rc1).<code>lake-manifest.json</code> at the v4.15.0 mathlib tag points to ProofWidgets 0.0.48. The 0.0.49 release corresponds to v4.15.0. That shouldn't matter unless there were breaking changes, but maybe the cloud release feature needs an exact match.</p>",
        "id": 492726351,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736430436
    },
    {
        "content": "<p>Still, I don't see why this would fail on some machines and not others (and it works for me)</p>",
        "id": 492726441,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736430466
    },
    {
        "content": "<p>Oh, maybe it has to do with how my manifest references proofwidgets</p>",
        "id": 492727285,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736430704
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>, could you give us a complete repro? (e.g. <code>git clone ...; git checkout ...; lake exe cache get; lake build</code>, and on which OS?)</p>",
        "id": 492728029,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736430886
    },
    {
        "content": "<p>Just checking out Mathlib master at that commit (<code>v4.15.0</code>) I can't reproduce.</p>",
        "id": 492728103,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736430904
    },
    {
        "content": "<p>Yes, sorry I should have clarified that this is on a project depending on mathlib, rather than mathlib itself</p>",
        "id": 492728186,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736430925
    },
    {
        "content": "<p>I'll wipe everything and try to repro again, one moment. I'm on MacOS Ventura</p>",
        "id": 492728732,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736431065
    },
    {
        "content": "<p>Trying to reproduce by rebasing <a href=\"https://github.com/leanprover-community/mathlib4/pull/20532\">#20532</a> onto v4.15.0. Have to run to a meeting now.</p>",
        "id": 492728996,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736431132
    },
    {
        "content": "<p>It's working fine for me in a downstream project, also on macos.</p>",
        "id": 492729137,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1736431170
    },
    {
        "content": "<p>Bah, I fixed it. The problem was that my version of ProofWidgets in the manifest was 0.0.50</p>",
        "id": 492729792,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736431330
    },
    {
        "content": "<p>Thanks for the attempt anyway Kim!</p>",
        "id": 492730745,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736431597
    },
    {
        "content": "<p>How did you end up in that state, through <code>lake update</code>? That would still be something worth investigating</p>",
        "id": 492747686,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1736435987
    },
    {
        "content": "<p>I assume you can get there by running <code>lake update</code> to update to mathlib master, then editing the lakefile and running <code>lake update mathlib</code> to downgrade to v4.15.0</p>",
        "id": 492750640,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736436728
    },
    {
        "content": "<p>Oh, I just tested it and I'm wrong. Sorry!</p>",
        "id": 492751467,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736436958
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/Proofwidgets.20now.20needs.20.60npm.60.3F/near/492747686\">said</a>:</p>\n<blockquote>\n<p>How did you end up in that state, through <code>lake update</code>? That would still be something worth investigating</p>\n</blockquote>\n<p>Unfortunately that might be self-inflicted - I was intending to be on 4.15.0 but something changed it to 4.16.0-rc1, and to downgrade I changed the SHAs in the manifest manually. And I presumably copied the wrong one for ProofWidgets, to end up with this error.</p>\n<p>I tried to reproduce what changed my toolchain (with Marc) but I've had no luck yet.</p>",
        "id": 493010703,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1736536397
    }
]