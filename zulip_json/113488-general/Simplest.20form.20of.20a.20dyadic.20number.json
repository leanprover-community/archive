[
    {
        "content": "<p>Given <code>x : Localization.Away (2 : ℤ)</code>, how can I recover the minimal <code>m</code> and <code>n</code> with <code>x = m / 2^n</code>?</p>",
        "id": 503507635,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741179751
    },
    {
        "content": "<p>I thought about using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Localization.awayLift#doc\">docs#Localization.awayLift</a>, but it's noncomputable...</p>",
        "id": 503511558,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741180663
    },
    {
        "content": "<p>The module doc of that file suggests <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=exists_reduced_fraction%27#doc\">docs#exists_reduced_fraction'</a> would be helpful</p>",
        "id": 503513772,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1741181122
    },
    {
        "content": "<p>It's a shame this operation isn't computable, but it's no deal breaker.</p>",
        "id": 503517232,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741181868
    },
    {
        "content": "<p>(Speaking of, it'd be nice to have a <code>DecidableEq</code> insteance on this type too.)</p>",
        "id": 503517348,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741181889
    },
    {
        "content": "<p>This solves your problem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toRat</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Away</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ha₂</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">b₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hb₂</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hd</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">powers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">powers_le_nonZeroDivisors_of_noZeroDivisors</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">zero_not_mem_nonZeroDivisors</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">div_eq_div_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">cast_ne_zero</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"n\">ha₂</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">cast_ne_zero</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"n\">hb₂</span><span class=\"o\">))]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_right_injective₀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">cast_ne_zero</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span>\n<span class=\"w\">    </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_left_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_right_comm</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 503520538,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741182582
    },
    {
        "content": "<p>Oh, clever! So I can pass to <code>ℚ</code> and then get the simplest form by using the existing API on rationals.</p>",
        "id": 503521400,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741182789
    },
    {
        "content": "<p>It'd be nice to have this as well</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">den_toRat_mem_powers</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Away</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"bp\">@</span><span class=\"n\">toRat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hn</span><span class=\"bp\">.</span><span class=\"n\">ne'</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">den</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">powers</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>This should follow from the fact that if <code>m / n</code> is a (not necessarily reduced) fraction where <code>n</code> is a power of <code>k</code>, then its (reduced) denominator is also a power of <code>k</code>. Do we have anything like this?</p>",
        "id": 503528398,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741184250
    },
    {
        "content": "<p>Probably you want something like <code>(a/b).den \\dvd b</code></p>",
        "id": 503529504,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741184483
    },
    {
        "content": "<p>There's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Rat.den_dvd#doc\">docs#Rat.den_dvd</a></p>",
        "id": 503529606,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741184507
    },
    {
        "content": "<p>Awesome!</p>",
        "id": 503530180,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741184614
    },
    {
        "content": "<p>I'm thinking about how to PR this. Presumably we can do something slightly more general? Namely, we can show that any localization of <code>ℤ</code> induces a <em>computable</em> monomorphism into <code>ℚ</code>. And we can use this to build the corresponding <code>DecidableEq</code> instance.</p>",
        "id": 503531367,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741184828
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Simplest.20form.20of.20a.20dyadic.20number/near/503528398\">said</a>:</p>\n<blockquote>\n<p>the fact that if <code>m / n</code> is a (not necessarily reduced) fraction where <code>n</code> is a power of <code>k</code>, then its (reduced) denominator is also a power of <code>k</code></p>\n</blockquote>\n<p>(Presumably <code>k</code> is prime)</p>",
        "id": 503532954,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741185128
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/113488-general/topic/Simplest.20form.20of.20a.20dyadic.20number/near/503531367\">said</a>:</p>\n<blockquote>\n<p>I'm thinking about how to PR this. Presumably we can do something slightly more general? Namely, we can show that any localization of <code>ℤ</code> induces a <em>computable</em> monomorphism into <code>ℚ</code>. And we can use this to build the corresponding <code>DecidableEq</code> instance.</p>\n</blockquote>\n<p>Would this be desirable in Mathlib?</p>",
        "id": 503566326,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741192046
    },
    {
        "content": "<p>I assume the computability issue arises from <code>IsLocalization</code> not actually holding the data needed to do anything computably?</p>",
        "id": 503566747,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741192118
    },
    {
        "content": "<p>The issue is that <code>IsUnit (f r)</code> does not give the data necessary to construct the inverse.</p>",
        "id": 503571602,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741193075
    },
    {
        "content": "<p>Is that from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalHom#doc\">docs#IsLocalHom</a> ?</p>",
        "id": 503588156,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741196590
    },
    {
        "content": "<p>I think that dyadic numbers are a sufficiently special case that we might want to treat them separately from general localizations.</p>",
        "id": 503588333,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741196643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/113488-general/topic/Simplest.20form.20of.20a.20dyadic.20number/near/503571602\">said</a>:</p>\n<blockquote>\n<p>The issue is that <code>IsUnit (f r)</code> does not give the data necessary to construct the inverse.</p>\n</blockquote>\n<p>That seems like a simple fix, could we just make a version of this function where you give an inverse explicitly?</p>",
        "id": 503593218,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741197840
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Simplest.20form.20of.20a.20dyadic.20number/near/503593218\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/113488-general/topic/Simplest.20form.20of.20a.20dyadic.20number/near/503571602\">said</a>:</p>\n<blockquote>\n<p>The issue is that <code>IsUnit (f r)</code> does not give the data necessary to construct the inverse.</p>\n</blockquote>\n<p>That seems like a simple fix, could we just make a version of this function where you give an inverse explicitly?</p>\n</blockquote>\n<p>Is this ok?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Away</span><span class=\"bp\">.</span><span class=\"n\">lift'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hinv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">powers</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Away</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">liftExpand</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">/ₚ</span><span class=\"w\"> </span><span class=\"n\">unitOfInvertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">divp_eq_divp_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">val_unitOfInvertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">smul_eq_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ac_rfl -- why does this fail?</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">one_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">liftExpand_of</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">divp_eq_iff_mul_eq</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ind</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"w\"> </span><span class=\"n\">a₂</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ind</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">b₁</span><span class=\"w\"> </span><span class=\"n\">b₂</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">oreDiv_mul_oreDiv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">liftExpand_of</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">field_simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b₁</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ore_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ac_rfl -- why does this fail?</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n<span class=\"w\">  </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">zero_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">liftExpand_of</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">divp_eq_iff_mul_eq</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ind</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a₁</span><span class=\"w\"> </span><span class=\"n\">a₂</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ind</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">b₁</span><span class=\"w\"> </span><span class=\"n\">b₂</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">oreDiv_add_oreDiv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">liftExpand_of</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">smul_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">smul_eq_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- why does this require `CommRing` when `CommSemiring` should do just fine</span>\n<span class=\"w\">    </span><span class=\"c1\">-- rw [Units.divp_add_divp]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">mul_right_inj_of_invertible</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">hinv</span><span class=\"w\"> </span><span class=\"n\">a₂</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hinv</span><span class=\"w\"> </span><span class=\"n\">b₂</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">    </span><span class=\"n\">field_simp</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">divp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">val_inv_unitOfInvertible</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_right_comm</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">⅟_</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">invOf_mul_cancel_right</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_invOf_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">map_add</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a₂</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b₁</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">mul_mul_mul_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">OreLocalization</span><span class=\"bp\">.</span><span class=\"n\">ore_eq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Away</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommSemiring</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hinv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Invertible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Away</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">→+*</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Localization</span><span class=\"bp\">.</span><span class=\"n\">Away</span><span class=\"bp\">.</span><span class=\"n\">lift'</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">r</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">invertiblePow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">copy</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">map_pow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">pow_coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">pow_log_eq_self</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 503619610,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741204394
    },
    {
        "content": "<p>Nice!</p>",
        "id": 503876107,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741290017
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 503876189,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741290048
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> Do you think you could PR this? It'd be really helpful.</p>",
        "id": 503877659,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1741290596
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22662\">#22662</a></p>",
        "id": 503904597,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741300585
    }
]