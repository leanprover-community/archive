[
    {
        "content": "<p>For the <code>ℝ</code> specifically, synthesis of <code>IsTopologicalRing ℝ</code> fails after declaring an instance of <code>TopologicalSpace X</code>, where <code>X</code> has no connection to <code>ℝ</code>.  (This problem does not persist if, e.g., we instead declare an instance of <code>Add X</code>.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Real</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsTopologicalRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"c1\">--set_option trace.Meta.synthInstance true</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsTopologicalRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"c1\">--ok</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsTopologicalRing</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"c1\">--ok</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsTopologicalRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"c1\">--ok</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">IsTopologicalRing</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"c1\">--fail</span>\n</code></pre></div>\n<p>Am I missing something here?</p>",
        "id": 518861610,
        "sender_full_name": "Caelan Ritter",
        "timestamp": 1747521606
    },
    {
        "content": "<p>You say X has no connection to \\R but X is a variable so it can equal \\R, hence your problem.</p>",
        "id": 518861769,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747521748
    },
    {
        "content": "<p>You've just dumped an undefined topological space structure on <em>every</em> type, so any type which had one already is now in a state unsupported by Lean's typeclass system, and if you ask for the topological space structure on such a space then you can't predict which one you're going to get. For the reals you seem to be getting your bad one.</p>",
        "id": 518861924,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747521892
    },
    {
        "content": "<p>Oh duh, that makes sense.  Thanks so much!</p>",
        "id": 518862076,
        "sender_full_name": "Caelan Ritter",
        "timestamp": 1747522022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"867636\">Caelan Ritter</span> has marked this topic as resolved.</p>",
        "id": 518862095,
        "sender_full_name": "Notification Bot",
        "timestamp": 1747522053
    }
]