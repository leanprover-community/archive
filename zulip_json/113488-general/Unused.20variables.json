[
    {
        "content": "<p>Prompted by a question of Bhavik (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/17178\">#17178</a>), I am trying to systematically find <code>variable</code>s that are unused.</p>",
        "id": 473506225,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727654004
    },
    {
        "content": "<p>It turns out that there are really a lot!  I suspect that quite a few are a consequence of splitting files and copying over <code>variable</code> commands where they are no longer needed.</p>",
        "id": 473506237,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727654015
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17261\">#17261</a> is a first batch of removals.</p>",
        "id": 473506256,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727654025
    },
    {
        "content": "<p>The linter that found them is still not really ready for review, since it currently is incapable of dealing with <code>def</code>s, but has still flagged thousands of candidates for removal.</p>",
        "id": 473506259,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727654030
    },
    {
        "content": "<p>Is this something that is desirable?</p>",
        "id": 473506263,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727654031
    },
    {
        "content": "<p>Can the same idea be adapted to find unused <code>open</code>s? That's something I wanted to think about for quite a while, but never got important enough...</p>",
        "id": 474866613,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1728061112
    },
    {
        "content": "<p>Yes, a similar strategy can also be used for unused <code>open</code>: the inclusion mechanism is different, but the kind of tracking is very similar.</p>",
        "id": 474895651,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728073163
    },
    {
        "content": "<p>I have been making progress towards a linter that catches <code>variable</code>s that can be removed.  It is not yet complete, but it has already found a lot of simplifications (many of which are already merged).</p>",
        "id": 475761115,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728455676
    },
    {
        "content": "<p>However, the current version find over 4k exceptions in mathlib (unfortunately, some of these are false positives and the corresponding variables are used, but I have not managed to find a good way of excluding them from the linter).</p>",
        "id": 475761331,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728455736
    },
    {
        "content": "<p>Would it be desirable to produce a version of the linter that is conservative, may not flag every unused variable, but certainly flags unused ones, and do a mass substitution?</p>",
        "id": 475761543,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728455784
    },
    {
        "content": "<p>This would still likely imply thousands of changes to hundreds, if not thousands of files.</p>",
        "id": 475761650,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728455808
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17566\">#17566</a> is the latest batch of removals, in case you are interested.</p>",
        "id": 475761834,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728455850
    },
    {
        "content": "<p>If you feel up for it, I'd lean towards reviewable chunks, but it sounds like that could keep you busy for quite a while. Alternatively you could land the linter off by default and we could spread the work around a bit.</p>",
        "id": 475765280,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1728456697
    },
    {
        "content": "<p>I'll PR a few more chunks for a while, at least until the linter is more reliable.  I'll probably switch to distributing the effort, once the linter is more \"independent\", though.</p>",
        "id": 475839888,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728474849
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17574\">#17574</a></p>",
        "id": 475839895,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728474852
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17579\">#17579</a></p>",
        "id": 475844290,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728476127
    },
    {
        "content": "<p>I cleaned up a little the linter and opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/17715\">#17715</a>.</p>",
        "id": 476651105,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728868250
    },
    {
        "content": "<p>This is by no means a final version, but it is there in case someone feels like checking out the branch, removing some unused variables and leave mathlib in a better shape!</p>",
        "id": 476651108,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1728868252
    }
]