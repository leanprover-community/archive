[
    {
        "content": "<p>The file <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/CharP/Two.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/CharP/Two.html</a> has more than 1,000 imports. Which I find quite amazing, considering its lemmas are all quite basic corollaries of characteristic two rings. Where are these imports coming from? Is it literally just the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=orderOf#doc\">docs#orderOf</a> import?</p>",
        "id": 571090917,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769795461
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20CharP.2ETwo.20so.20heavy.3F/near/571090917\">said</a>:</p>\n<blockquote>\n<p>has more than 1,000 imports</p>\n</blockquote>\n<p>does this mean \"directly imports\", \"is directly imported by\", \"transitively imports\" or \"is transitively imported by\" more than 1000 files?</p>",
        "id": 571092225,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1769795857
    },
    {
        "content": "<p>All I know is that it's been building for like 20 minutes<br>\n<a href=\"/user_uploads/3121/y7IEd5xGT8jegx8dtg_UVrih/imagen.png\">imagen.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/y7IEd5xGT8jegx8dtg_UVrih/imagen.png\" title=\"imagen.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"323x89\" src=\"/user_uploads/thumbnail/3121/y7IEd5xGT8jegx8dtg_UVrih/imagen.png/840x560.webp\"></a></div>",
        "id": 571092446,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769795927
    },
    {
        "content": "<p>That number includes batteries too, probably</p>",
        "id": 571092713,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769796017
    },
    {
        "content": "<p>I still think this number is way too high for the material it actually contains. I'd expect something closer to half.</p>",
        "id": 571092888,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769796059
    },
    {
        "content": "<p>also, the actual number is closer to 1200...</p>",
        "id": 571093145,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769796131
    },
    {
        "content": "<p>Maybe <a href=\"https://leanprover-community.github.io/mathlib4_docs/mathlib.html?highlight=Mathlib.Algebra.CharP.Two\">https://leanprover-community.github.io/mathlib4_docs/mathlib.html?highlight=Mathlib.Algebra.CharP.Two</a> is helpful</p>",
        "id": 571093998,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769796372
    },
    {
        "content": "<p>Ah, the highlight is the opposite of what you want</p>",
        "id": 571094363,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769796483
    },
    {
        "content": "<p>Does the import graph script still work?</p>",
        "id": 571099576,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769798312
    },
    {
        "content": "<p>Yeah, I wonder how much of that can be explained by <code>import Batteries; import Aesop; import Mathlib.Tactic.Linarith; import Mathlib.Tactic.Ring</code></p>",
        "id": 571108669,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1769801357
    },
    {
        "content": "<p>Yeah, those all seem somewhat heavy</p>",
        "id": 571117512,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1769804654
    },
    {
        "content": "<p>I think the OrderOfElement import is the big one, since that file is designed to be a one-stop shop for the theory of orders of elements in groups, which means that it pulls in all of the subgroup theory (via GroupTheory.Index) among other things</p>",
        "id": 571120983,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1769806031
    },
    {
        "content": "<p>Would it make sense to split OrderOfElement into a Defs file and one with the rest of the API?</p>",
        "id": 571136563,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769812861
    },
    {
        "content": "<p>And then CharP.Two hopefully only needs the former</p>",
        "id": 571136602,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769812883
    },
    {
        "content": "<p>Is this heavy dependency causing a problem?</p>",
        "id": 571138505,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769813973
    },
    {
        "content": "<p>Generally leaf files (like CharTwo) have much heavier dependencies than trunk files, because there's a tradeoff to be made between small dependencies and small number of files</p>",
        "id": 571138592,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1769814015
    },
    {
        "content": "<p>It's not a problem, but it is annoying. I use CharTwo somewhat heavily in the CGT repo and it's one of the heaviest imports in the files that use it.</p>",
        "id": 571138833,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769814147
    },
    {
        "content": "<p>I don't understand why that is annoying. What problems is it causing you?</p>",
        "id": 571141574,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769815976
    },
    {
        "content": "<p>It means that if I modify anything I have to wait for half an hour for everything to rebuild.</p>",
        "id": 571141622,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769816016
    },
    {
        "content": "<p>I'm still confused. I use a bazillion algebra files with thousands of transitive imports in FLT and I have never once found this fact annoying in any way. I modify FLT code all the time and I don't have to wait at all. What exactly are you modifying?</p>",
        "id": 571141720,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769816089
    },
    {
        "content": "<p>Well, a few hours ago I added a few new lemmas to the file, but my PR also added a new lemma in a very early file, which meant I had to compile most of these 1200 imports from scratch.</p>",
        "id": 571141807,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769816137
    },
    {
        "content": "<p>Wait -- you are modifying mathlib files within the CGT repo?</p>",
        "id": 571141862,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769816174
    },
    {
        "content": "<p>Why not just put your changes in the <code>Mathlib</code> or <code>ForMathlib</code> or whatever you're calling it directory in the CGT repo and then PR them?</p>",
        "id": 571141890,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769816201
    },
    {
        "content": "<p>then when the PR is merged you just bump and delete the files and get cache.</p>",
        "id": 571141957,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769816260
    },
    {
        "content": "<p>Sorry, let me word things better. It's annoying modifying that file when making Mathlib PRs because there's a lot to build. And I've had to modify that file a few times in the past because it's imported in the CGT repo.</p>",
        "id": 571142074,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769816340
    },
    {
        "content": "<p>I encountered this problem where in a mathlib branch (in preparation for a mathlib PR) I modified two files A and B, where B transitively imports A but along a super long chain. The build of file B takes forever and I wondered if there is a smarter way around this (other than splitting into two PRs)</p>",
        "id": 571142211,
        "sender_full_name": "Bryan Wang",
        "timestamp": 1769816431
    },
    {
        "content": "<p>Surely you don't mean \"it's annoying modifying that leaf file\", you mean \"it's annoying modifying a very early file and that leaf file at the same time\", but this is a special case of \"it's annoying modifying a very early file\" because this breaks not just your leaf file but pretty much everything.</p>\n<p>Does the module system not help here? Is there some clever public/private change which would make your life easier?</p>",
        "id": 571142458,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769816621
    },
    {
        "content": "<p>btw it has 948 imports in Mathlib (<a href=\"/user_uploads/3121/PFO41s144p5FfPN36dxYw_pR/PastedText.txt\">imports.txt</a>)</p>",
        "id": 571143050,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1769817022
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459227\">@Violeta Hernández</span>, do you know how to use <code>lake exe graph --from ... --to ... out.pdf</code>? I find this quite useful understand the import tangles in Mathlib.</p>",
        "id": 571149062,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769821142
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20CharP.2ETwo.20so.20heavy.3F/near/571142458\">said</a>:</p>\n<blockquote>\n<p>, but this is a special case of \"it's annoying modifying a very early file\" because this breaks not just your leaf file but pretty much everything.</p>\n</blockquote>\n<p>If I modify <em>only</em> a very early file in mathlib, I don't feel the pain as much because the slowness happens in github CI, and not on my machine <span aria-label=\"stuck out tongue closed eyes\" class=\"emoji emoji-1f61d\" role=\"img\" title=\"stuck out tongue closed eyes\">:stuck_out_tongue_closed_eyes:</span></p>",
        "id": 571154908,
        "sender_full_name": "Bryan Wang",
        "timestamp": 1769826210
    },
    {
        "content": "<p>Maybe there's a separate question I should be asking. Isn't minimizing imports of any given file generally a good thing? If there was some simple tweak I could do which halved the amount of imports of this file, would it not be a good change?</p>",
        "id": 571180198,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769851395
    },
    {
        "content": "<p>It would be a good change if it didn't involve an unnatural split of the file</p>",
        "id": 571180259,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1769851452
    },
    {
        "content": "<p>Then I'll try and if I can achieve that I'll PR it</p>",
        "id": 571180289,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1769851470
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/34663\">#34663</a> moves the lemmas about <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=orderOf#doc\">docs#orderOf</a> to <code>GroupTheory.OrderOfElement</code> and minimizes dependencies on <code>Algebra.CharP.Two</code>, so that reversing the import direction adds only one dependency to <code>GroupTheory.OrderOfElement</code>.</p>",
        "id": 571243887,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1769906886
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113488-general/topic/Why.20is.20CharP.2ETwo.20so.20heavy.3F/near/571099576\">said</a>:</p>\n<blockquote>\n<p>Does the import graph script still work?</p>\n</blockquote>\n<p>(I'd hope so! <a href=\"https://github.com/leanprover-community/import-graph/issues\">Report issues</a> if there are any doubts in it's functionality <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> )</p>",
        "id": 571290783,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1769956045
    }
]