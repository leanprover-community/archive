[
    {
        "content": "<p>I have an upcoming AI safety formalization project where I want to use Blueprint. Which is fun, as I haven’t used it before.</p>\n<p>It seems like the standard setup is Blueprint latex files which are separate from the .lean files. What’s the rationale there?</p>\n<p>And, depending on that rationale, I’m curious if it’s possible to do inline Blueprint somehow where a single file contains both. This would require either the Latex to be part of the docstrings, or a flipped version where a file that is “toplevel latex” has Lean blocks which can be compiled or interacted with via VSCode.</p>",
        "id": 496594990,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1738169935
    },
    {
        "content": "<p>See <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd?tab=readme-ov-file#use-of-latex-inside-lean\">https://github.com/AlexKontorovich/PrimeNumberTheoremAnd?tab=readme-ov-file#use-of-latex-inside-lean</a></p>",
        "id": 496598513,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738170988
    },
    {
        "content": "<p>Nice! It would be good if this was mentioned in the Blueprint repo it self: <a href=\"https://github.com/PatrickMassot/leanblueprint\">https://github.com/PatrickMassot/leanblueprint</a></p>",
        "id": 496600715,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1738171628
    },
    {
        "content": "<p>I am very much in two minds about this approach. The pros are that it makes it much easier for a language model to start filling in your proofs for you. The cons are that you lose all the quality-of-life tools which you get when writing LaTeX in a normal LaTeX-aware environment e.g. VS Code + LaTeX workshop extension.</p>",
        "id": 496620166,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738176019
    },
    {
        "content": "<p>^ It’s a shame one can’t have both! If they’re both VSCode setups, it seems not too far off to have them work together.</p>",
        "id": 496627887,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1738178743
    },
    {
        "content": "<p>It’s hard to get them both together. One approach that could work is an adaptation of Jupyter notebooks that  renders latex in place for latex cells and shows live infoview on lean cells. I think <span class=\"user-mention\" data-user-id=\"296911\">@Utensil Song</span> got a lean kernel working with Jupyter, but I don’t know if it shows the infoview on lean cells inline</p>",
        "id": 496650970,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1738188150
    },
    {
        "content": "<p>Link: <a href=\"https://github.com/utensil/lean4_jupyter\">https://github.com/utensil/lean4_jupyter</a></p>",
        "id": 496651596,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1738188387
    },
    {
        "content": "<p>A cheap hack might be to have a shell-script that converts back and forth between <code>.lean</code> and <code>.tex</code> files, inverting the set of marked-as-the-other-language lines.</p>",
        "id": 496711775,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738223512
    },
    {
        "content": "<p>The problem is that I can envisage in practice a lean file looking like tex then lean then tex then lean then..., and if you turn it into a Tex file and then edit it, it might be hard to turn it back into the modified lean file with just a shell script</p>",
        "id": 496712193,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738223713
    },
    {
        "content": "<p>Here's a very crude attempt. Consider the following Python script</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"ch\">#!/usr/bin/env python3</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">convert_tex_to_lean</span><span class=\"p\">(</span><span class=\"n\">input_stream</span><span class=\"p\">,</span> <span class=\"n\">output_stream</span><span class=\"p\">):</span>\n    <span class=\"n\">in_minted_block</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">input_stream</span><span class=\"p\">:</span>\n        <span class=\"n\">stripped_line</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"n\">stripped_line</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\\\</span><span class=\"s1\">begin</span><span class=\"si\">{minted}</span><span class=\"s1\">'</span><span class=\"p\">):</span>\n            <span class=\"n\">in_minted_block</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s1\">'-- &lt;/tex&gt;</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n            <span class=\"k\">continue</span>\n        <span class=\"k\">elif</span> <span class=\"n\">stripped_line</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\\\</span><span class=\"s1\">end</span><span class=\"si\">{minted}</span><span class=\"s1\">'</span><span class=\"p\">):</span>\n            <span class=\"n\">in_minted_block</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s1\">'-- &lt;tex&gt;</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n            <span class=\"k\">continue</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">in_minted_block</span><span class=\"p\">:</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">'-- </span><span class=\"si\">{</span><span class=\"n\">line</span><span class=\"si\">}</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">convert_lean_to_tex</span><span class=\"p\">(</span><span class=\"n\">input_stream</span><span class=\"p\">,</span> <span class=\"n\">output_stream</span><span class=\"p\">):</span>\n    <span class=\"n\">in_tex_block</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">input_stream</span><span class=\"p\">:</span>\n        <span class=\"n\">stripped_line</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"n\">stripped_line</span> <span class=\"o\">==</span> <span class=\"s1\">'-- &lt;tex&gt;'</span><span class=\"p\">:</span>\n            <span class=\"n\">in_tex_block</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\\\</span><span class=\"s1\">end</span><span class=\"si\">{minted}</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n            <span class=\"k\">continue</span>\n        <span class=\"k\">elif</span> <span class=\"n\">stripped_line</span> <span class=\"o\">==</span> <span class=\"s1\">'-- &lt;/tex&gt;'</span><span class=\"p\">:</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s1\">'</span><span class=\"se\">\\\\</span><span class=\"s1\">begin</span><span class=\"si\">{minted}{lean}</span><span class=\"se\">\\n</span><span class=\"s1\">'</span><span class=\"p\">)</span>\n            <span class=\"n\">in_tex_block</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"k\">continue</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">in_tex_block</span><span class=\"p\">:</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">:])</span>  <span class=\"c1\"># Remove the '-- ' prefix</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">output_stream</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s2\">\"__main__\"</span><span class=\"p\">:</span>\n    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s1\">'Convert between .tex and .lean files.'</span><span class=\"p\">)</span>\n    <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span><span class=\"p\">(</span><span class=\"s1\">'direction'</span><span class=\"p\">,</span> <span class=\"n\">choices</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">'t2l'</span><span class=\"p\">,</span> <span class=\"s1\">'l2t'</span><span class=\"p\">],</span> <span class=\"n\">help</span><span class=\"o\">=</span><span class=\"s1\">'Direction of conversion'</span><span class=\"p\">)</span>\n    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span><span class=\"p\">()</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"s1\">'t2l'</span><span class=\"p\">:</span>\n        <span class=\"n\">convert_tex_to_lean</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdin</span><span class=\"p\">,</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">direction</span> <span class=\"o\">==</span> <span class=\"s1\">'l2t'</span><span class=\"p\">:</span>\n        <span class=\"n\">convert_lean_to_tex</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdin</span><span class=\"p\">,</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>then you can run</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>cat<span class=\"w\"> </span>tmp/lean-tex-example.tex<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>./tmp/lean-tex.py<span class=\"w\"> </span>t2l<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>./tmp/lean-tex.py<span class=\"w\"> </span>l2t\n<span class=\"go\">\\documentclass{article}</span>\n<span class=\"go\">\\usepackage{minted}</span>\n\n<span class=\"go\">\\begin{document}</span>\n\n<span class=\"go\">\\section{Lean Code Example}</span>\n\n<span class=\"go\">Here is an example of a simple Lean function:</span>\n\n<span class=\"go\">\\begin{minted}{lean}</span>\n<span class=\"go\">def add (a b : Nat) : Nat :=</span>\n<span class=\"go\">  a + b</span>\n<span class=\"go\">\\end{minted}</span>\n\n<span class=\"go\">And here is a proof of a simple theorem:</span>\n\n<span class=\"go\">\\begin{minted}{lean}</span>\n<span class=\"go\">theorem add_comm (a b : Nat) : a + b = b + a :=</span>\n<span class=\"go\">  Nat.add_comm a b</span>\n<span class=\"go\">\\end{minted}</span>\n\n<span class=\"go\">\\end{document}</span>\n</code></pre></div>\n<p>which performed the identity transformation.</p>\n<p>The intermediate Lean file looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- \\documentclass{article}</span>\n<span class=\"c1\">-- \\usepackage{minted}</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- \\begin{document}</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- \\section{Lean Code Example}</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- Here is an example of a simple Lean function:</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- &lt;/tex&gt;</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"c1\">-- &lt;tex&gt;</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- And here is a proof of a simple theorem:</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- &lt;/tex&gt;</span>\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">add_comm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Nat.add_comm</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"c1\">-- &lt;tex&gt;</span>\n<span class=\"c1\">--</span>\n<span class=\"c1\">-- \\end{document}</span>\n</code></pre></div>",
        "id": 496782957,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738245541
    },
    {
        "content": "<p>There is certainly room for improvement here... I didn't think hard about it.</p>",
        "id": 496783069,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738245573
    },
    {
        "content": "<p>But we're talking about applications to blueprints, where there is no \\minted, there is \\lean{label} and \\leanOK etc, and you don't want the Lean code at all in the LaTeX. Maybe the idea is that you comment out the Lean proofs in the LaTeX?</p>",
        "id": 496789951,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738247246
    },
    {
        "content": "<p>Yeah, it's easy to swap out the <code>minted</code> for a block of comments.</p>",
        "id": 496793883,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738248294
    },
    {
        "content": "<p>I guess another issue would be that typically there might be many Lean files associated to one latex file, and even annoying cases like \"the arguments in this latex file are mostly in one lean file except that a couple of them in the middle are sufficiently useful that they are in the for_mathlib folder\"</p>",
        "id": 496794634,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738248498
    },
    {
        "content": "<p>Agreed. Although I think that issue doesn't play a role for projects like PNT+, where they start with Lean files that contain some TeX.</p>",
        "id": 496804002,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738250862
    },
    {
        "content": "<p>Is a polyglot document possible?</p>",
        "id": 496950833,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738311726
    },
    {
        "content": "<p>That is, have one file and switch between telling your editor whether to treat it as Lean or latex</p>",
        "id": 496950951,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738311770
    },
    {
        "content": "<p>There would be a certain amount of hackery involved in getting it to compile in both languages but as I say I'm not 100% happy with this kind of solution because I don't see why we want the linearity of the latex document to be forced on the lean code.</p>",
        "id": 496961856,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738315395
    }
]