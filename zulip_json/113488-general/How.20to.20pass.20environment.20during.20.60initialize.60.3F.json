[
    {
        "content": "<p>I'd like to write this bit of code at the top of my file: <code>initialize discard &lt;| registerParserCategory _ ``custom_parser ``customCat</code> where the typehole indicates the environment to which <code>registerParserCategory</code> adds the <code>custom_parser</code> attribute. How could I access the environment here to register this parser attribute? (context: I'm trying to implement an analog to <code>@[term_parser]</code> and <code>@[command_parser]</code> using my own syntax category)</p>",
        "id": 484422459,
        "sender_full_name": "nrs",
        "timestamp": 1732587279
    },
    {
        "content": "<p>the following might work. is it the only way? is there no way of doing this through <code>initialize</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"register_parser_cat\"</span><span class=\"w\"> </span><span class=\"n\">attrName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"n\">catName</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">attrName</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">catName</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">namea</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">nameb</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">getEnv</span>\n<span class=\"w\">    </span><span class=\"n\">setEnv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">registerParserCategory</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">namea</span><span class=\"w\"> </span><span class=\"n\">nameb</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"bad attrName or catName\"</span>\n\n<span class=\"n\">register_parser_cat</span><span class=\"w\"> </span><span class=\"n\">customparser</span><span class=\"w\"> </span><span class=\"n\">customCat</span>\n</code></pre></div>",
        "id": 484436464,
        "sender_full_name": "nrs",
        "timestamp": 1732597631
    }
]