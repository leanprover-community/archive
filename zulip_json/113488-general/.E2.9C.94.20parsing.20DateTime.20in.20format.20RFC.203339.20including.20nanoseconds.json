[
    {
        "content": "<p>I was wondering if lean can parse RFC 3339<br>\nThis represents time in the following format: 2025-06-24T16:49:32.123456789Z</p>\n<p>I see a lot of work has already happened on the time library in Lean, so this looks promising<br>\n<a href=\"https://github.com/leanprover/lean4/blob/9bf5fc2fd3771291589a95e764d5b1fce02927b7/src/Std/Time.lean#L107\">https://github.com/leanprover/lean4/blob/9bf5fc2fd3771291589a95e764d5b1fce02927b7/src/Std/Time.lean#L107</a></p>\n<p>But this example uses a comma instead of a <code>.</code> and does not include timezone information.</p>\n<p>A lot of languages do not support nanoseconds, but it seems that Lean is covering this base, but do not let me know if I misread the code.</p>\n<p>Additionally I am also interested in whether RFC 9557 is already supported. It is very new, so I don't expect it to be supported, but thought I would check. This parses times with named timezones, for example \"2022-07-08T00:14:07+01:00[Europe/Paris]\"</p>",
        "id": 525925329,
        "sender_full_name": "awalterschulze",
        "timestamp": 1750950144
    },
    {
        "content": "<p>You can write <code>zoned(\"2025-06-24T16:49:32.123456789Z\")</code> to get a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Time.ZonedDateTime#doc\">docs#Std.Time.ZonedDateTime</a>. Regarding your second question, at the moment we only parse either an offset or a time zone identifier. So you can write <code>zoned(\"2022-07-08T00:14:07+01:00\")</code> to get a <code>ZonedDateTime</code>, or you can write <code>zoned(\"2022-07-08T00:14:07[Europe/Paris]\")</code> which returns an <code>IO ZonedDateTime</code> that will look up the offset in the computer's time zone database.</p>",
        "id": 525931399,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1750951814
    },
    {
        "content": "<p>Well that is amazing and it keeps nanoseconds and it includes the non controversial parts of RFC 9557. I was not expecting as much, wow</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">ZonedDateTime</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">zoned</span><span class=\"o\">(</span><span class=\"s2\">\"2025-06-24T16:49:32.123456789Z\"</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">ZonedDateTime</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"n\">ofPlainDateTime</span>\n<span class=\"w\">  </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span><span class=\"bp\">.</span><span class=\"n\">ofYearMonthDayClip</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">2025</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">hour</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_3</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">minute</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_4</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_5</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">nanosecond</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Bounded</span><span class=\"bp\">.</span><span class=\"n\">LE</span><span class=\"bp\">.</span><span class=\"n\">ofNatWrapping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">123456789</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">._</span><span class=\"n\">proof_6</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">TimeZone</span><span class=\"bp\">.</span><span class=\"n\">ZoneRules</span><span class=\"bp\">.</span><span class=\"n\">ofTimeZone</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">second</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"+00:00\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">abbreviation</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"+00:00\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isDST</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>",
        "id": 525934970,
        "sender_full_name": "awalterschulze",
        "timestamp": 1750952976
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"557483\">awalterschulze</span> has marked this topic as resolved.</p>",
        "id": 525935096,
        "sender_full_name": "Notification Bot",
        "timestamp": 1750953015
    },
    {
        "content": "<p>Small addendum: you can parse both an offset and a zone identifier if you define your own format:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"w\"> </span><span class=\"n\">Time</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">rfc9557</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GenericFormat</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">datespec</span><span class=\"o\">(</span><span class=\"s2\">\"uuuu-MM-dd'T'HH:mm:ssZZZZZ'['zzzz']'\"</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">ofExcept</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rfc9557</span><span class=\"bp\">.</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"s2\">\"2022-07-08T00:14:07+01:00[Europe/Paris]\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Zone offset is {date.timezone.offset.second} seconds\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Zone name is {date.timezone.name}\"</span>\n</code></pre></div>\n<p>This prints</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Zone</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">3600</span><span class=\"w\"> </span><span class=\"n\">seconds</span>\n<span class=\"n\">Zone</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">Europe</span><span class=\"bp\">/</span><span class=\"n\">Paris</span>\n</code></pre></div>",
        "id": 526016503,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1751003434
    },
    {
        "content": "<p>Thank you this is very helpful. Really happy to see how far Lean has come with its standard library support</p>",
        "id": 526024969,
        "sender_full_name": "awalterschulze",
        "timestamp": 1751008447
    }
]