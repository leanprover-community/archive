[
    {
        "content": "<p>Is there a Lean way to parse JSON with comments? (Use case: for mathlib's directoryDependency linter, I'd like to convert a big list of exceptions from a manually defined map to a .json file. However, the source file has comments above some entries, which I'd like to keep.)</p>",
        "id": 520846122,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748425101
    },
    {
        "content": "<p>JSON with comments isn't JSON :)</p>",
        "id": 520848797,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748425850
    },
    {
        "content": "<p>There's no such thing as a JSON file with comments.</p>",
        "id": 520848815,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748425855
    },
    {
        "content": "<p>Just make a <code>_comment</code> field in your JSON file or something?</p>",
        "id": 520848968,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1748425899
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Parsing.20JSON.20with.20comments/near/520848815\">said</a>:</p>\n<blockquote>\n<p>There's no such thing as a JSON file with comments.</p>\n</blockquote>\n<p>That is correct, JSON does not support comments.</p>\n<p>A very popular alternative <a href=\"https://en.wikipedia.org/wiki/YAML\">Yet Another Markup Language</a> (YAML),  does support comments.</p>\n<p><a href=\"https://aws.amazon.com/compare/the-difference-between-yaml-and-json/\">Whatâ€™s the Difference Between YAML and JSON?</a></p>\n<p>One specification that uses both JSON and YAML is <a href=\"https://swagger.io/specification/\">OpenAPI spec</a> where the files can be distributed as either JSON or YAML. Many developers choose YAML so that comments can be added.</p>",
        "id": 520857489,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748428450
    },
    {
        "content": "<p>There is a certainly \"JSON with comments\", a <a href=\"https://www.w3resource.com/JSON/snippets/introduction-to-jsonc.php\">common JSON extension</a> --- but fair point, I'll use a small hack then.</p>",
        "id": 520859309,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748429087
    },
    {
        "content": "<p>Using yaml is not an option for me --- because Lean doesn't have a parser for. This is for good reasons, yaml has <a href=\"https://ruudvanasseldonk.com/2023/01/11/the-yaml-document-from-hell\">lots of subtle gotchas</a>.</p>",
        "id": 520859428,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748429128
    },
    {
        "content": "<p>Can you use TOML?</p>",
        "id": 520861521,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748429782
    },
    {
        "content": "<p>Sure, that should also work.</p>",
        "id": 520861596,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748429814
    },
    {
        "content": "<p>(I was thinking of \"a .json file, but lines starting with (whitespace and) <code>// </code> are removed before parsing\". I don't have a strong opinion either way.)</p>",
        "id": 520861722,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748429850
    },
    {
        "content": "<p>It would certainly be nice to support that, but there's already <code>toml</code> used in the lean ecosystem, so if you get to choose your own format that might be a good path.</p>",
        "id": 520862712,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748430164
    },
    {
        "content": "<p>So no end of line comments? I tend to recommend against using custom formats that are almost but not quite standard</p>",
        "id": 520866434,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1748431423
    },
    {
        "content": "<p>JSON with comments exists in the same way that a Group With (Absorbing) Zero exists. :)</p>",
        "id": 520945353,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748454379
    },
    {
        "content": "<p>(it's well-defined, used, and just happens to - as an artifact of English - not actually be a proper hyponym)</p>",
        "id": 520945512,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1748454458
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113488-general/topic/Parsing.20JSON.20with.20comments/near/520861722\">said</a>:</p>\n<blockquote>\n<p>(I was thinking of \"a .json file, but lines starting with (whitespace and) <code>// </code> are removed before parsing\". I don't have a strong opinion either way.)</p>\n</blockquote>\n<p>Maybe you could just manually strip them out as a preprocessing step</p>",
        "id": 521010929,
        "sender_full_name": "James Sully",
        "timestamp": 1748488711
    },
    {
        "content": "<p>Maybe you can try hjson <a href=\"https://hjson.github.io/\">https://hjson.github.io/</a></p>",
        "id": 521013065,
        "sender_full_name": "Jz Pan",
        "timestamp": 1748490200
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"621161\">James Sully</span> <a href=\"#narrow/channel/113488-general/topic/Parsing.20JSON.20with.20comments/near/521010929\">said</a>:</p>\n<blockquote>\n<p>Maybe you could just manually strip them out as a preprocessing step</p>\n</blockquote>\n<p>Annoyingly strings can contain <code>//</code>. I'm not sure there's any robust way to handle comments by preprocessing.</p>",
        "id": 521019175,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748494117
    },
    {
        "content": "<p>In my case, all strings are mathlib module names, which don't contain slashes - so for my use case, a small hack would be fine. (Or using toml.)</p>",
        "id": 521039162,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1748504911
    },
    {
        "content": "<p>only allowing comments on their own lines simplifies things as well</p>",
        "id": 521080010,
        "sender_full_name": "James Sully",
        "timestamp": 1748519888
    },
    {
        "content": "<p>Aside from YAML, JSONC, and HJSON, there's even more JSON super sets with comments: <a href=\"https://json5.org/\">JSON5</a> and <a href=\"https://github.com/lightbend/config/blob/main/HOCON.md\">HOCON</a></p>",
        "id": 521104916,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1748528576
    }
]