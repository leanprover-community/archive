[
    {
        "content": "<p>Is the following behavior  expected? (I'm aware that the theorem doesn't hold)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DivisionCommMonoid</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">@</span><span class=\"n\">DivisionMonoid</span><span class=\"bp\">.</span><span class=\"n\">toDivInvMonoid</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">DivisionCommMonoid</span><span class=\"bp\">.</span><span class=\"n\">toDivisionMonoid</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">instDivInvMonoid</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">type mismatch</span>\n<span class=\"cm\">  rfl</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  ?m.15 = ?m.15 : Prop</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  i.toDivInvMonoid = Real.instDivInvMonoid : Prop</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>I find the error message a bit surprising.</p>",
        "id": 523944236,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1749820636
    },
    {
        "content": "<p>What exactly is surprising?</p>",
        "id": 523944379,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749820678
    },
    {
        "content": "<p>Your theorem says that any structure of <code>DivisionCommMonoid</code> on <code>‚Ñù</code> is equal to the \"standard\" one. I guess this is not what you wanted to state.</p>",
        "id": 523945809,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749821149
    },
    {
        "content": "<p><code>by rfl</code> gives you a much better error, because it is a tactic not just a theorem</p>",
        "id": 523945859,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1749821166
    },
    {
        "content": "<p>Ah you're complaining about the <em>error</em>, sorry.</p>",
        "id": 523946027,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1749821211
    },
    {
        "content": "<p>I understand the complaint if you're comparing with the message generated by <code>by rfl</code>, but... I feel like they're really saying the same thing if you understand what <code>?</code> means</p>",
        "id": 523949249,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749822169
    },
    {
        "content": "<p>specifically, <code>?</code> is an attempt to unify expressions</p>",
        "id": 523949280,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749822181
    },
    {
        "content": "<p>I think what I find confusing is that if I assumed that what I'm proving is true, then my reading of the error message would be:</p>\n<blockquote>\n<p><code>i.toDivInvMonoid</code> is defeq to <code>Real.instDivInvMonoid</code>, so why doesn't <code>rfl</code> just unify both of those terms with <code>?m.15</code>?</p>\n</blockquote>",
        "id": 523951369,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1749822839
    },
    {
        "content": "<p>I see, now I understand.</p>",
        "id": 523951469,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1749822883
    },
    {
        "content": "<p>But to <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>'s point, <code>by rfl</code> produces a nice error message.</p>",
        "id": 523951536,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1749822906
    },
    {
        "content": "<p>It's too bad that when Lean tries unifying <code>@Eq A a b</code> with <code>@Eq X x y</code> that there's no partial progress. Either <code>A =?= X</code>, <code>a =?= x</code>, and <code>b =?= y</code> all succeed, or it fails.</p>\n<p>If there were partial progress (maybe with unification hints?) you would see</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">toDivInvMonoid</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">toDivInvMonoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">toDivInvMonoid</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">instDivInvMonoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>which is a little better.</p>",
        "id": 524028783,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749859570
    },
    {
        "content": "<p>Maybe it's better to say \"rfl <strong>probably</strong> has type\" in the error message indicating for uncertainty.</p>",
        "id": 524038682,
        "sender_full_name": "Jz Pan",
        "timestamp": 1749873732
    }
]