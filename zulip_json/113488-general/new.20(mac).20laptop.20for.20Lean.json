[
    {
        "content": "<p>I am getting greedy because I want to compile FLT faster, so I'm thinking of buying the fastest laptop available for compiling Lean code. Talking to several people this seems to mean the fastest mac. <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> I think you bought a mac relatively recently and were super-impressed by how quickly it could compile mathlib. But <span class=\"user-mention\" data-user-id=\"127136\">@Alex J. Best</span> you told me that you also had a recent mac and Lean was performing very poorly on it for reasons you couldn't fathom. Does anyone else have experience with new macs and Lean? Is there anything I should avoid? My plan is to get work to pay so price is not an issue, I just want to maximise speed.</p>",
        "id": 492340550,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736266368
    },
    {
        "content": "<p>I bought an M3 Max in late 2022 and it was able to compile Mathlib from scratch in about 20 minutes a year or so ago (I haven't tested it recently). I love it and find it extremely fast and a huge improvement to my quality of life etc.</p>",
        "id": 492341400,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1736266616
    },
    {
        "content": "<p>However unless you happen to like / be used to Apple's design (which I do and am) then a Mac is probably not the right call: I think you can get better compute for your buck elsewhere (albeit you'll have to live a cold dark life outside of the beautiful Apple ecosystem).</p>",
        "id": 492341511,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1736266652
    },
    {
        "content": "<p>Rereading your message, I see \"compute for your buck\" not really relevant. However I believe a stronger statement is true: even though these Macs are very fast, there exist faster (and as it happens cheaper) laptops. I'm afraid I don't know what brand though.</p>",
        "id": 492342019,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1736266801
    },
    {
        "content": "<p>The reason I suggested a mac is that when I finally got to meet <span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> recently he suggested that \"the fastest laptop is pretty much always the fastest mac\"</p>",
        "id": 492342626,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736266979
    },
    {
        "content": "<p>Are you sure you want a laptop?</p>",
        "id": 492342899,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1736267057
    },
    {
        "content": "<p>Or is a fast desktop machine also fine? And then you SSH into it.</p>",
        "id": 492342954,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1736267075
    },
    {
        "content": "<p>I just spent two hours in a coffee shop with no internet hacking on FLT and then 30 minutes on the London tube with no internet so maybe a laptop is better for me? Although I guess I already have a fast desktop and should probably talk to you offline about how to set this up</p>",
        "id": 492344470,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736267535
    },
    {
        "content": "<p>The short answer is: VScode SSH extension</p>",
        "id": 492345002,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1736267697
    },
    {
        "content": "<p>Note that AMD just announced the 9950X3D which is the successor of the CPU compiling Mathlib in 17min in the speedcenter, and also a mobile CPU variant that may be able to get close to that</p>",
        "id": 492345499,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1736267868
    },
    {
        "content": "<p>Let me second the desktop machine suggestion + remote access.</p>\n<p>You can leave your heavier, more expensive and energy consuming machine at home with proper cooling conditions and walk around with a lightweight (and cheaper) machine to serve as a \"graphical terminal\", if you consider solutions like the VS Code SSH extension that Johan suggested.</p>\n<p>This setup is more flexible, as it allows you to - practically speaking - have access to speedy compilation from arbitrary machines.</p>",
        "id": 492347488,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1736268480
    },
    {
        "content": "<p>In the same spirit, I'll throw this idea in case it applies to your use case, it might be worth for the FLT project to fund and acquire a machine (or maybe two machines?) so members can have access to it</p>",
        "id": 492348281,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1736268741
    },
    {
        "content": "<p>You can also rent a server for a month to see the desktop + remote access strategy suits you. For example, Oracle Cloud gives 3,000 free CPU hours per month, and they have some pretty cool 80-core Ampere Altras (of course, 80 cores * 720 hours in a month is more than 3,000, so if you don't want to pay anything you can either use fewer cores or not leave the machine running all the time). You'd need to set it up, though, which might be annoying.</p>",
        "id": 492349381,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736269150
    },
    {
        "content": "<p>But if price is not an issue, can't you get work to pay for a nice server and a nice laptop? :) Mac Minis are quite cheap, so the combined cost might not be too bad.</p>",
        "id": 492349473,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736269194
    },
    {
        "content": "<p>Does anyone know how long it takes for the cheapest M4 Mac Mini (600 dollars, 700 euros) to compile mathlib?</p>",
        "id": 492349817,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736269310
    },
    {
        "content": "<p>I think that a desktop is not a good fit for my situation. I already have a fast desktop. I am specifically interested in suggestions for a laptop which will compile mathlib in under 20 minutes.</p>",
        "id": 492353458,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736270592
    },
    {
        "content": "<p>Sorry, I now noticed you mentioned this already! I should have read the whole thread first.</p>",
        "id": 492354075,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736270815
    },
    {
        "content": "<p>Even if you obtain a fast laptop, you should still set up remote access via ssh to your desktop. That way, whenever you have internet (which you could probably have in a coffee shop via a wifi hotspot using your mobile?), you can have two full-blown FLT installations running simultaneously. The data transferred over ssh is minimal.</p>",
        "id": 492354440,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736270934
    },
    {
        "content": "<p>(and, by the way, it's super easy using Tailscale and the VS Code remote ssh extension)</p>",
        "id": 492354573,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736270988
    },
    {
        "content": "<p>I should say I fully agree with Kevin, working offline is typically a much better experience. Fewer distractions, fewer random failures, less latency, and so on.</p>",
        "id": 492354896,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736271103
    },
    {
        "content": "<p>I'm not arguing against buying a fast laptop, but a fast desktop (in addition to the laptop) on the university network is the best of both worlds, especially because it means my download speeds for the cache are ridiculously fast.</p>",
        "id": 492355422,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736271330
    },
    {
        "content": "<p>I just want to add a datapoint that i often work offline and I got a new MacBook this summer for lean and I’m quite satisfied with it.</p>",
        "id": 492363964,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1736274604
    },
    {
        "content": "<p>Yes I already have a fast desktop and a good latency, this is why I am specifically asking about a fast laptop. I think we all agree that having a fast desktop is a great idea. I also agree that hiding away in a coffeeshop away from all the people knocking on my office door and emailing me is a great idea.</p>",
        "id": 492366473,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736275594
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"439483\">Andrew Yang</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492363964\">said</a>:</p>\n<blockquote>\n<p>I just want to add a datapoint that i often work offline and I got a new MacBook this summer for lean and I’m quite satisfied with it.</p>\n</blockquote>\n<p>So is the answer \"just buy a new MacBook\"? What I was hoping to hear was comments on possible mistakes (e.g. \"avoid this specific chip/model\") and possible tips (e.g. \"make sure you get the one with extra foobars because this really makes a difference\")</p>",
        "id": 492366709,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736275681
    },
    {
        "content": "<p>All this discussion will make me happier when I wait for Lean to build. I’ll be able to think: every second I wait is some money I’m not giving to Apple.</p>",
        "id": 492367491,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736275950
    },
    {
        "content": "<p>My recommendation is that yes, it’s buy a Mac laptop, and specifically if you want the fastest one go with M4 Pro. M4 Max has more GPU cores but these are irrelevant for normal Lean use.</p>",
        "id": 492367793,
        "sender_full_name": "Geoffrey Irving",
        "timestamp": 1736276077
    },
    {
        "content": "<p>I think the issue with mine that I mentioned to you Kevin is likely insufficient ram, it is only 8gb despite being a relatively new machine. Lean is basically unusable locally for me. Other than that I'm very happy with it.</p>",
        "id": 492368098,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1736276199
    },
    {
        "content": "<p>Remember to buy one with enough disk space. My poor 512 GB laptop's disk is half eaten up by various mathlib caches.</p>",
        "id": 492370422,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736277065
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492366709\">said</a>:</p>\n<blockquote>\n<p>So is the answer \"just buy a new MacBook\"? What I was hoping to hear was comments on possible mistakes (e.g. \"avoid this specific chip/model\") and possible tips (e.g. \"make sure you get the one with extra foobars because this really makes a difference\")</p>\n</blockquote>\n<p>This is my only one so I can’t tell you what not to buy, but mine (M3 Max with 64GB ram and 2TB storage) is more than enough.</p>",
        "id": 492371833,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1736277622
    },
    {
        "content": "<p>A datapoint: I bought a new 14-in M4 Macbook Pro with 16 GB RAM in November and just tried building mathlib4 from scratch (<code>lake clean; lake build</code>) for the first time now and it took about 57 (!) minutes. It was much longer than I expected, but on the other hand I was doing various non-lean stuff in the background, including streaming videos and there wasn't any noticeable lag (and the laptop never got uncomfortably warm either). If I had to guess, if you'll be wanting to compile mathlib4 a lot, you'll probably want more RAM?</p>\n<p>Using lean4 in VS Code has been quite comfortable for me (but I'm not a heavy user and mostly rely on the cache).</p>",
        "id": 492372421,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1736277906
    },
    {
        "content": "<p>Interesting. That's slightly surprising, I think it takes around that long for me to compile even with 8GB RAM on my M3 MacMini. (About to try again, but yeah last time I measured it was around an hour.)</p>",
        "id": 492373320,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736278277
    },
    {
        "content": "<p>But yeah Kevin if you're willing to sell your soul to the closed source demons and money is close to no object, a 14\" MBP with M4 Max and upgrades to the 16 core chip, 64GB RAM and nano texture display is probably what I'd buy. Looks like £4K buys you entry to the club.</p>",
        "id": 492373733,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736278420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492370422\">said</a>:</p>\n<blockquote>\n<p>Remember to buy one with enough disk space. My poor 512 GB laptop's disk is half eaten up by various mathlib caches.</p>\n</blockquote>\n<p>Agreed on this. After many years of not really thinking about disk space, I now have to janitor my various elan toolchains, cache storage, projects with unpacked caches, etc.</p>",
        "id": 492375762,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736279166
    },
    {
        "content": "<p>I’m very satisfied with my “old” M2 Max. The 96gb ram especially is handy. But I’d get at least 2tb of storage since I usually only have 30gb free and I hate babysitting it. I highly recommend a MacBook, it’s really nice to have desktop level power without bothering with ssh.</p>",
        "id": 492377601,
        "sender_full_name": "Alok Singh",
        "timestamp": 1736279904
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492375762\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492370422\">said</a>:</p>\n<blockquote>\n<p>Remember to buy one with enough disk space. My poor 512 GB laptop's disk is half eaten up by various mathlib caches.</p>\n</blockquote>\n<p>Agreed on this. After many years of not really thinking about disk space, I now have to janitor my various elan toolchains, cache storage, projects with unpacked caches, etc.</p>\n</blockquote>\n<p>Likewise. Is it possible to get elan to automatically clean up old caches (which could always be redownloaded if needed again)?</p>",
        "id": 492384341,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1736282779
    },
    {
        "content": "<p>Elan has a <code>elan toolchain gc</code> command to view unused toolchains (and you can pass <code>--delete</code> to it)</p>",
        "id": 492384997,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736283056
    },
    {
        "content": "<p>Oh wait, it's not in a stable version yet, I think! I have it because nixpkgs builds elan from git. s/has/will have/</p>\n<p>Edit: It's now available in elan 4.0.0-rc1</p>",
        "id": 492385828,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736283387
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253861\">Thomas Browning</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492384341\">said</a>:</p>\n<blockquote>\n<p>Is it possible to get elan to automatically clean up old caches (which could always be redownloaded if needed again)?</p>\n</blockquote>\n<p>The reason why I have multiple copies of the mathlib cache is precisely because I don't want to spend so much time on waiting for <code>lake exe cache get</code> to finish when switching between branches or projects (not to mention the often necessary <code>rm -rf .lake</code>s in between)</p>",
        "id": 492386872,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736283770
    },
    {
        "content": "<p>If you want to go the other way, you can just use <code>git worktree</code> a lot</p>",
        "id": 492387193,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736283895
    },
    {
        "content": "<p>I already do this, but this does not deduplicate the ~5 GB mathlib cache.</p>",
        "id": 492388157,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736284275
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492372421\">said</a>:</p>\n<blockquote>\n<p>I bought a new 14-in M4 Macbook Pro with 16 GB RAM in November and just tried building mathlib4 from scratch (<code>lake clean; lake build</code>) for the first time now and it took about 57 (!) minutes. It was much longer than I expected, but on the other hand I was doing various non-lean stuff in the background, including streaming videos and there wasn't any noticeable lag (and the laptop never got uncomfortably warm either).</p>\n</blockquote>\n<p>This surprised me sufficiently that I ran my own experiment (M3 Max, 96GB RAM). I measured 27 minutes wall clock to build everything (on recent master <code>01e663839357f0acbf26e478a6e76f6f29e98ce4</code>). I did not have any other applications running and just left the laptop alone. After running <code>lake clean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>➜  mathlib4 git:(master) time lake build Mathlib\nBuild completed successfully.\nlake build Mathlib  18213.79s user 3256.97s system 1310% cpu 27:18.53 total\n</code></pre></div>",
        "id": 492388358,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1736284354
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> if you’d like I can do a test compile today on my MacBook Pro 16” M3 Max 64 GB memory and report back the time.</p>",
        "id": 492395907,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1736287541
    },
    {
        "content": "<p>I just re-ran a build on commit <code>01e663839</code> with <code>time lake build Mathlib</code> after <code>lake clean</code>, this time after closing all other apps and leaving my laptop alone and it finished in 41 minutes (M4 Pro, 16GB RAM):</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>lake build Mathlib  20415.68s user 3410.83s system 954% cpu 41:36.61 total\n</code></pre></div>",
        "id": 492396268,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1736287692
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">caffeinate</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"mf\">4268.45</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"w\">     </span><span class=\"mf\">23849.58</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\">      </span><span class=\"mf\">4578.14</span><span class=\"w\"> </span><span class=\"n\">sys</span>\n</code></pre></div>\n<p>(so yeah it's about 70 minutes here at this point on this mighty lil' 8GB machine).</p>",
        "id": 492401081,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736289900
    },
    {
        "content": "<p>Mathlib's build process is a bit \"interesting\" -- (and I know we're offtopic, and that there are lots of threads here where people have looked at this in more systematic and precise ways than my anecdotal comment is about to be) but basically from my recollection what I've seen is things proceed pretty quickly, and then around the last 2-300 files in the build, stuff slows to a crawl, perhaps on files in Mathlib that are really memory-bound and which then end up swapping lots on my 8GB machine (and presumably less on yours'es with your fancy normal amounts of RAM)</p>",
        "id": 492401425,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736290043
    },
    {
        "content": "<p>Note that as the transitive import set of a mathlib file grows bigger it's startup time also keeps getting slower. For example doc-gen running on the later files of mathlib to generate documentation spends 60% of its runtime per file setting up the imports and only 40% actually doc-genning</p>",
        "id": 492403646,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1736291083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492396268\">said</a>:</p>\n<blockquote>\n<p>[...] with <code>time lake build Mathlib</code> [...] this time after closing all other apps and leaving my laptop alone [...]</p>\n</blockquote>\n<p>on my new macbook pro with M4 Pro + 48GB memory it took 26min on a fresh clone (toolchain already downloaded before starting) :)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">    </span><span class=\"mf\">17092.07</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">3486.77</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1317</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">:</span><span class=\"mf\">01.57</span><span class=\"w\"> </span><span class=\"n\">total</span>\n</code></pre></div>",
        "id": 492407376,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1736293135
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492366473\">said</a>:</p>\n<blockquote>\n<p>hiding away in a coffeeshop away from all the people knocking on my office door and emailing me is a great idea.</p>\n</blockquote>\n<p>So this is where you have been <span aria-label=\"light bulb\" class=\"emoji emoji-1f4a1\" role=\"img\" title=\"light bulb\">:light_bulb:</span></p>",
        "id": 492411185,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1736295235
    },
    {
        "content": "<p>Yeah I installed you in my office to take messages</p>",
        "id": 492413840,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736296795
    },
    {
        "content": "<p>About mathlib cache, I will suggest something I suggested a while ago, hoping someone might pick up the task.</p>\n<p><code>cache</code> could run a counting routine to warn the user whenever more than X% of the cached files are orphan. This routine could be triggered after every call to the <code>get</code> command. This warn could</p>\n<ul>\n<li>Just suggest calling <code>cache clean</code> (which only gets rid of orphan files) or</li>\n<li>Prompt the user asking whether <code>cache clean</code> should run, as an y/n question</li>\n</ul>\n<p>Sorry for the tangent!</p>",
        "id": 492414538,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1736297190
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"416472\">Winston Yin (尹維晨)</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492395907\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> if you’d like I can do a test compile today on my MacBook Pro 16” M3 Max 64 GB memory and report back the time.</p>\n</blockquote>\n<p>Fresh mathlib build under realistic conditions (with dozens of Chrome tabs, VSCode, 6 different instant messaging apps, Mail, Slack open):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">17694.83</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">3313.07</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1471</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"mf\">47.48</span><span class=\"w\"> </span><span class=\"n\">total</span>\n</code></pre></div>",
        "id": 492462305,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1736327629
    },
    {
        "content": "<p>Please consider a laptop with a good battery life, as all the cores (16 on mine) are saturated during build, with power consumption sometimes exceeding 60W for the duration of the build.</p>",
        "id": 492462751,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1736327772
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492341400\">said</a>:</p>\n<blockquote>\n<p>I bought an M3 Max in late 2022 and it was able to compile Mathlib from scratch in about 20 minutes a year or so ago (I haven't tested it recently). I love it and find it extremely fast and a huge improvement to my quality of life etc.</p>\n</blockquote>\n<p>I have basically the same computer and I also find its really good and can compile mathlib in about 20 mins. I cant say I love mac software, but hardware seems good for lean.</p>",
        "id": 492495907,
        "sender_full_name": "Chris Birkbeck",
        "timestamp": 1736340041
    },
    {
        "content": "<p>Here is a glimpse into your future (14\", M1 Max, 64 Gb, with tons of applications running, and jacked into the grid)</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>build<span class=\"w\"> </span>Mathlib<span class=\"w\">  </span><span class=\"m\">20890</span>.21s<span class=\"w\"> </span>user<span class=\"w\"> </span><span class=\"m\">3474</span>.57s<span class=\"w\"> </span>system<span class=\"w\"> </span><span class=\"m\">815</span>%<span class=\"w\"> </span>cpu<span class=\"w\"> </span><span class=\"m\">49</span>:46.18<span class=\"w\"> </span>total\n</code></pre></div>\n<p>Other thoughts:</p>\n<ul>\n<li>I have never thought \"Jeez, I have too much memory\" or \"Jeez, I have too much storage\". 64 Gb was the maximum configurable then (Jan '22) and I feel good about that choice. I would max out both as much your budget allows if you plan on riding the machine until the wheels fall off. </li>\n<li>I have thought \"I wish I had more storage\". I have 1 Tb and it is 80-90% full preventing me from doing things like migrating away from Dropbox but still useable generally. </li>\n<li>As mentioned above, the battery life while building Mathlib is now pretty meager, about an hour or two at the most. </li>\n<li>14'' vs 16'' has its trade offs. 16'' has better thermals and a larger battery (and I believe overall longer life). 14'' is more portable.</li>\n</ul>",
        "id": 492500594,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1736341536
    },
    {
        "content": "<p>Given all of that, if I had to do it over again, I would buy some insane desktop box, slap a disposable OS on it, and ssh in from my iPad. Right now, I almost exclusively  ssh into my Mac while it rests at home.</p>",
        "id": 492502119,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1736342012
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492502119\">said</a>:</p>\n<blockquote>\n<p>Given all of that, if I had to do it over again, I would buy some insane desktop box, slap a disposable OS on it, and ssh in from my iPad. Right now, I almost exclusively  ssh into my Mac while it rests at home.</p>\n</blockquote>\n<p>How do you ssh from your iPad? Do you use vscode in the browser?</p>",
        "id": 492571592,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1736364816
    },
    {
        "content": "<p>Long ago before it became a subscription I purchased <a href=\"https://blink.sh\">https://blink.sh</a> I use neovim in that terminal emulator but they have since bundled in a copy of VS Code </p>\n<p>At least <a href=\"https://tailscale.com\">https://tailscale.com</a> is still free for very mild use.</p>",
        "id": 492573042,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1736365381
    },
    {
        "content": "<p>I made the switch from 14” to 16” and don’t regret the decrease in portability. The overall longer battery life and zero CPU throttling during the 23 min build time are some justifications for the price jump. If you go for the most powerful M[n] Max chip, you are more likely to utilise its full power on the 16”. I’ve seen reports that the 14” with M3 Max throttles, but also that the thermals may have improved with the 14” M4 Max model. I might add that even with the fan at full speed, my laptop does not sound like it’s trying to fly to the moon.</p>",
        "id": 492592686,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1736374786
    },
    {
        "content": "<p>The mac series laptops are awesome for lean and if anyone interested in a non-mac or relative low budget solution, I am currently using MSI alpha 17 C7VG with Ryzen 9 7945HX and 64GB ram. With it I am able to compile mathlib in about 20~30mins: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">30218.43</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">1692.51</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">2529</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">:</span><span class=\"mf\">01.66</span><span class=\"w\"> </span><span class=\"n\">total</span>\n</code></pre></div>",
        "id": 492879615,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1736486925
    },
    {
        "content": "<p>What OS do you have?</p>",
        "id": 492885653,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1736490935
    },
    {
        "content": "<p>It’s on Archlinux and the relatively low budget is a trade off for being more heavy and less portable and more complicated in setting the system up. Similar laptops with the same 7945HX CPU and ram should be similar in compiling mathlib I think</p>",
        "id": 492891913,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1736494239
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492345499\">said</a>:</p>\n<blockquote>\n<p>Note that AMD just announced the 9950X3D which is the successor of the CPU compiling Mathlib in 17min in the speedcenter, and also a mobile CPU variant that may be able to get close to that</p>\n</blockquote>\n<p>For example, <a href=\"https://rog.asus.com/laptops/rog-strix/rog-strix-g16-2025-g614/\">https://rog.asus.com/laptops/rog-strix/rog-strix-g16-2025-g614/</a> has the next generation of <span class=\"user-mention\" data-user-id=\"560873\">@Shanghe Chen</span>'s laptop's processor. I don't think it's for sale yet.</p>",
        "id": 492909437,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736501313
    },
    {
        "content": "<p>OK my new mac has arrived and I was going to run <code>time lake build</code> on mathlib4 but now I've realised that this is also timing things like cloning of aesop, building batteries etc; I've realised that I don't understand properly what the benchmark is.</p>",
        "id": 506718620,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742388461
    },
    {
        "content": "<p>In a more serious benchmark this may matter but at least for my part above I simply visually ignored this by seeing the cloning was done in a few seconds and that's negligible compared to the full timing. I'm curious to see what your results are, my new machine which also arrived yesterday is mid-building so I'll have timing numbers in a few minutes.</p>",
        "id": 506719345,
        "sender_full_name": "Julian Berman",
        "timestamp": 1742388646
    },
    {
        "content": "<p>I think as an end user, you should time it all.</p>",
        "id": 506726214,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742390247
    },
    {
        "content": "<p>Because basically that is what people will experience which is as important as benchmarking</p>",
        "id": 506726415,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742390303
    },
    {
        "content": "<p>Well yes, but at least the cloning part depends on network speed more than anything. Ideally lake would just print a summary of which steps took how long at the end</p>",
        "id": 506728343,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742390796
    },
    {
        "content": "<p>from start to finish it was</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">17133.38</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">4390.55</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1173</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">:</span><span class=\"mf\">34.13</span><span class=\"w\"> </span><span class=\"n\">total</span>\n</code></pre></div>",
        "id": 506728547,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742390846
    },
    {
        "content": "<p>How does your old machine compare?</p>",
        "id": 506728843,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1742390918
    },
    {
        "content": "<p>Here on my M2 mac mini (8GB) I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">     </span><span class=\"mf\">4335.98</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"w\">     </span><span class=\"mf\">25614.95</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\">      </span><span class=\"mf\">4021.91</span><span class=\"w\"> </span><span class=\"n\">sys</span>\n</code></pre></div>\n<p>and on my new M4 MBA (24GB) I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">     </span><span class=\"mf\">3723.75</span><span class=\"w\"> </span><span class=\"n\">real</span><span class=\"w\">     </span><span class=\"mf\">30203.72</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\">      </span><span class=\"mf\">3976.60</span><span class=\"w\"> </span><span class=\"n\">sys</span>\n</code></pre></div>\n<p>which is smaller than I expected the speedup to be honestly but watching btm as it built lean was at least pegging all the CPUs so at least I'm CPU bound for the build. Memory use was pretty low throughout the build, around 12GB.</p>",
        "id": 506748265,
        "sender_full_name": "Julian Berman",
        "timestamp": 1742395257
    },
    {
        "content": "<p>Doesn’t Mac mini have better cooling than an MBA?</p>",
        "id": 506763954,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742398863
    },
    {
        "content": "<p>It has fans whereas the MBA is fully passive IIRC -- but what are you suggesting? macOS throttling CPUs because of temp? I wouldn't bet on this having happened as my previous M2 MBA had similar timings to the mac mini. But given I still haven't sent the M2 MBA back as a trade in I can do a direct comparison with that as well just to triple check.</p>",
        "id": 506765778,
        "sender_full_name": "Julian Berman",
        "timestamp": 1742399266
    },
    {
        "content": "<p>Yes, I am suggesting throttling</p>",
        "id": 506769080,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742400030
    },
    {
        "content": "<p>I don't think the MBA was designed keeping heavy CPU workloads in mind. So I would definitely expect some throttling.</p>",
        "id": 506769156,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742400052
    },
    {
        "content": "<p>On an M1 ultra mac studio, where presumably heat/throttling isn't a concern: <br>\n<code>23454.05s user 4924.01s system 1610% cpu 29:22.02 total</code></p>",
        "id": 506772770,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1742400884
    },
    {
        "content": "<p>so an m4 Macbook pro outperformed an M1 ultra mac studio?</p>",
        "id": 506774955,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742401436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/506728343\">said</a>:</p>\n<blockquote>\n<p>Well yes, but at least the cloning part depends on network speed more than anything. Ideally lake would just print a summary of which steps took how long at the end</p>\n</blockquote>\n<p>I think one could first call <code>lake clean</code> in a freshly cloned mathlib. This seems to download all dependencies without building anythin.</p>",
        "id": 506832312,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1742420124
    },
    {
        "content": "<p>Huh, really?</p>",
        "id": 506835179,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742421342
    },
    {
        "content": "<p>not sure it's an intended/stable feature, but it does seem to work that way... Probably because <code>lake</code> clones all dependencies on the first call, regardless of what that call is and <code>lake clean</code> is just one call that doesn't do anything relevant in this case</p>",
        "id": 506837866,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1742422510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/506774955\">said</a>:</p>\n<blockquote>\n<p>so an m4 Macbook pro outperformed an M1 ultra mac studio?</p>\n</blockquote>\n<p>Yeah, I was a little surprised too. But I don’t understand what is happening with parallelism here. Certainly not all cores were being used.</p>",
        "id": 506850681,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1742429211
    },
    {
        "content": "<p>I recently got a new mac laptop so in the interest of collecting more data I will be building mathlib from scratch on both the new and the old one.</p>\n<p>Here is my old one's specs</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Hardware</span><span class=\"w\"> </span><span class=\"n\">Overview</span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">MacBook</span><span class=\"w\"> </span><span class=\"n\">Pro</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Identifier</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mac14</span><span class=\"o\">,</span><span class=\"mi\">6</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z1760005WLL</span><span class=\"bp\">/</span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"n\">Chip</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Apple</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"w\"> </span><span class=\"n\">Max</span>\n<span class=\"w\">  </span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">Cores</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"n\">efficiency</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Memory</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mi\">96</span><span class=\"w\"> </span><span class=\"n\">GB</span>\n<span class=\"w\">  </span><span class=\"n\">System</span><span class=\"w\"> </span><span class=\"n\">Firmware</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"mf\">10151.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">OS</span><span class=\"w\"> </span><span class=\"n\">Loader</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mf\">10151.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">Activation</span><span class=\"w\"> </span><span class=\"n\">Lock</span><span class=\"w\"> </span><span class=\"n\">Status</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">Disabled</span>\n</code></pre></div>\n<p>And the timing:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">mathlibcontribution</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">24081.24</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">3626.12</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1096</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">:</span><span class=\"mf\">07.25</span><span class=\"w\"> </span><span class=\"n\">total</span>\n\n<span class=\"bp\">~/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">mathlibcontribution</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">rev</span><span class=\"bp\">-</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">HEAD</span>\n\n<span class=\"n\">ede29a38dfb2b9841d4898ff4525e9504667a057</span>\n</code></pre></div>",
        "id": 527291392,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1751732831
    },
    {
        "content": "<p>And the new specs:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Hardware</span><span class=\"w\"> </span><span class=\"n\">Overview</span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">MacBook</span><span class=\"w\"> </span><span class=\"n\">Pro</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Identifier</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mac16</span><span class=\"o\">,</span><span class=\"mi\">8</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z1FE001BALL</span><span class=\"bp\">/</span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"n\">Chip</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Apple</span><span class=\"w\"> </span><span class=\"n\">M4</span><span class=\"w\"> </span><span class=\"n\">Pro</span>\n<span class=\"w\">  </span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">Cores</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"n\">efficiency</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Memory</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"n\">GB</span>\n<span class=\"w\">  </span><span class=\"n\">System</span><span class=\"w\"> </span><span class=\"n\">Firmware</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"mf\">11881.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">OS</span><span class=\"w\"> </span><span class=\"n\">Loader</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mf\">11881.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">Activation</span><span class=\"w\"> </span><span class=\"n\">Lock</span><span class=\"w\"> </span><span class=\"n\">Status</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">Disabled</span>\n</code></pre></div>\n<p>and the timing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">mathlibcontribution</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">ede29a38</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">19918.69</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">2673.53</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1099</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">:</span><span class=\"mf\">14.07</span><span class=\"w\"> </span><span class=\"n\">total</span>\n</code></pre></div>",
        "id": 527354215,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1751816106
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/stream/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/527291392\">said</a>:</p>\n<blockquote>\n<p>I recently got a new mac laptop so in the interest of collecting more data I will be building mathlib from scratch on both the new and the old one.</p>\n<p>Here is my old one's specs</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Hardware</span><span class=\"w\"> </span><span class=\"n\">Overview</span><span class=\"o\">:</span>\n\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">MacBook</span><span class=\"w\"> </span><span class=\"n\">Pro</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Identifier</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mac14</span><span class=\"o\">,</span><span class=\"mi\">6</span>\n<span class=\"w\">  </span><span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Z1760005WLL</span><span class=\"bp\">/</span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"n\">Chip</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Apple</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"w\"> </span><span class=\"n\">Max</span>\n<span class=\"w\">  </span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">Cores</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">performance</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"n\">efficiency</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">Memory</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mi\">96</span><span class=\"w\"> </span><span class=\"n\">GB</span>\n<span class=\"w\">  </span><span class=\"n\">System</span><span class=\"w\"> </span><span class=\"n\">Firmware</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"mf\">10151.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">OS</span><span class=\"w\"> </span><span class=\"n\">Loader</span><span class=\"w\"> </span><span class=\"n\">Version</span><span class=\"o\">:</span><span class=\"w\">    </span><span class=\"mf\">10151.121</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"w\">  </span><span class=\"n\">Activation</span><span class=\"w\"> </span><span class=\"n\">Lock</span><span class=\"w\"> </span><span class=\"n\">Status</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"n\">Disabled</span>\n</code></pre></div>\n<p>And the timing:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">mathlibcontribution</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">  </span><span class=\"mf\">24081.24</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"mf\">3626.12</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">system</span><span class=\"w\"> </span><span class=\"mi\">1096</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">:</span><span class=\"mf\">07.25</span><span class=\"w\"> </span><span class=\"n\">total</span>\n\n<span class=\"bp\">~/</span><span class=\"n\">Desktop</span><span class=\"bp\">/</span><span class=\"n\">mathlibcontribution</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">rev</span><span class=\"bp\">-</span><span class=\"n\">parse</span><span class=\"w\"> </span><span class=\"n\">HEAD</span>\n\n<span class=\"n\">ede29a38dfb2b9841d4898ff4525e9504667a057</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Am I reading this right - 96GB RAM?</p>",
        "id": 527354711,
        "sender_full_name": "Quang Dao",
        "timestamp": 1751816676
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246591\">Quang Dao</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/527354711\">said</a>:</p>\n<blockquote>\n<p>Am I reading this right - 96GB RAM?</p>\n</blockquote>\n<p>Yes, no idea why I got so much but that's indeed what my old laptop had.</p>",
        "id": 527367866,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1751830653
    },
    {
        "content": "<p>For those interested, here are the results (<code>time lake build</code> on latest <code>master</code>) on Unbutu 24.04.2 LTS with an AMD Ryzen 9950X and 48GB of RAM.</p>\n<p>First time including fetching the dependency repos:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">real</span><span class=\"w\">    </span><span class=\"mi\">17</span><span class=\"n\">m15</span><span class=\"bp\">.</span><span class=\"m\">375</span><span class=\"n\">s</span>\n<span class=\"n\">user</span><span class=\"w\">    </span><span class=\"mi\">436</span><span class=\"n\">m35</span><span class=\"bp\">.</span><span class=\"m\">777</span><span class=\"n\">s</span>\n<span class=\"n\">sys</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"n\">m39</span><span class=\"bp\">.</span><span class=\"m\">813</span><span class=\"n\">s</span>\n</code></pre></div>\n<p>Second time after <code>lake clean</code> without fetching the dependency repos:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">real</span><span class=\"w\">    </span><span class=\"mi\">16</span><span class=\"n\">m14</span><span class=\"bp\">.</span><span class=\"m\">758</span><span class=\"n\">s</span>\n<span class=\"n\">user</span><span class=\"w\">    </span><span class=\"mi\">437</span><span class=\"n\">m53</span><span class=\"bp\">.</span><span class=\"m\">617</span><span class=\"n\">s</span>\n<span class=\"n\">sys</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"n\">m57</span><span class=\"bp\">.</span><span class=\"m\">999</span><span class=\"n\">s</span>\n</code></pre></div>\n<p>In System Monitor I see all CPU cores are utilized most of the time:<br>\n<a href=\"/user_uploads/3121/kUudMry64F45SZ82qmgaC06m/Screenshot-from-2025-07-29-21-34-28.png\">Screenshot from 2025-07-29 21-34-28.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kUudMry64F45SZ82qmgaC06m/Screenshot-from-2025-07-29-21-34-28.png\" title=\"Screenshot from 2025-07-29 21-34-28.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"822x622\" src=\"/user_uploads/thumbnail/3121/kUudMry64F45SZ82qmgaC06m/Screenshot-from-2025-07-29-21-34-28.png/840x560.webp\"></a></div>",
        "id": 531622847,
        "sender_full_name": "Yongshun Ye",
        "timestamp": 1753798766
    },
    {
        "content": "<p>It takes me like 4 hours <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span></p>",
        "id": 531644742,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1753804297
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"374905\">Yongshun Shreck Ye</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/531622847\">said</a>:</p>\n<blockquote>\n<p>For those interested, here are the results (<code>time lake build</code> on latest <code>master</code>) on Unbutu 24.04.2 LTS with an AMD Ryzen 9950X and 48GB of RAM.</p>\n</blockquote>\n<p>That's an interesting result because at <a href=\"https://speed.lean-lang.org/mathlib4\">https://speed.lean-lang.org/mathlib4</a> we get  &lt;22min builds from a 7950X3D. So the 3D cache seems to more than equalize the generational gap.</p>",
        "id": 531770386,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1753861158
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> As Gemini explained to me, I think the number to be looking at for the actual time spent is the <code>real</code> one which is 17m/16m, <code>sys</code> is the total amount of CPU time spent in kernel mode of all cores added up. Somehow the output format of <code>time</code> is quite different on Ubuntu from macOS.</p>",
        "id": 531816666,
        "sender_full_name": "Yongshun Ye",
        "timestamp": 1753874675
    },
    {
        "content": "<p>Oops, I did focus on sys accidentally as it was formatted differently! That's good news about newer CPUs then</p>",
        "id": 531818096,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1753875135
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/492345499\">said</a>:</p>\n<blockquote>\n<p>Note that AMD just announced the 9950X3D which is the successor of the CPU compiling Mathlib in 17min in the speedcenter, and also a mobile CPU variant that may be able to get close to that</p>\n</blockquote>\n<p>Mathlib (commit 67006b84b492ebbc58d8d50dd3646048c8adc244) build times on a 9950X3D, after fetching dependency sources and running <code>lake clean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">7179</span><span class=\"w\"> </span><span class=\"n\">jobs</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n\n<span class=\"n\">real</span><span class=\"w\">    </span><span class=\"mi\">14</span><span class=\"n\">m48</span><span class=\"o\">,</span><span class=\"mi\">755</span><span class=\"n\">s</span>\n<span class=\"n\">user</span><span class=\"w\">    </span><span class=\"mi\">378</span><span class=\"n\">m57</span><span class=\"o\">,</span><span class=\"mi\">131</span><span class=\"n\">s</span>\n<span class=\"n\">sys</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"n\">m30</span><span class=\"o\">,</span><span class=\"mi\">177</span><span class=\"n\">s</span>\n</code></pre></div>",
        "id": 537560757,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1756937156
    },
    {
        "content": "<p>Hi, folks, </p>\n<p>just \"out of curiosity\" I also tried this <code>time lake build</code> after a previous \"fetching dependency sources\"  build and a <code>lake clean</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">7190</span><span class=\"w\"> </span><span class=\"n\">jobs</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n\n<span class=\"n\">real</span><span class=\"w\">    </span><span class=\"mi\">30</span><span class=\"n\">m8</span><span class=\"bp\">.</span><span class=\"m\">348</span><span class=\"n\">s</span>\n<span class=\"n\">user</span><span class=\"w\">    </span><span class=\"mi\">636</span><span class=\"n\">m5</span><span class=\"bp\">.</span><span class=\"m\">638</span><span class=\"n\">s</span>\n<span class=\"n\">sys</span><span class=\"w\">        </span><span class=\"mi\">43</span><span class=\"n\">m40</span><span class=\"bp\">.</span><span class=\"m\">425</span><span class=\"n\">s</span>\n</code></pre></div>\n<p>Agreed, 2x slower, but not too bad either ... (certainly not 4 hours).</p>\n<p><code>htop</code> showed that all 24 \"threads\" were very busy (close to 100%)</p>\n<p>I did this on a \"humble\" 2000 Euro, 13 inch Asus ProArt laptop that I merely bought because of its weight, OLED screen (I am an \"old guy\", and I can use it without wearing glasses), and GPU.</p>\n<p>I have a question: </p>\n<p>the 24 \"threads\" that htop showed me, are they also GPU related or only CPU related? If they are alse GPU related, then that could explain the \"reasonable\" result.</p>\n<p>Thx</p>\n<p>... not that it matter much, I am just curious ...</p>\n<p>Luc</p>",
        "id": 537706871,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1757001820
    },
    {
        "content": "<p>Lean does not interact with the GPU at all. It doesn't really have a workload that would be sensible for GPU compute.</p>",
        "id": 537709361,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1757002637
    },
    {
        "content": "<p>Thx Henrik, btw, is that not a \"missed opportunity\" now that GPU's are so powerful (and assuming that their treatment of parallelism is ok (?))</p>",
        "id": 537710150,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1757002952
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939867\">Luc Duponcheel</span> <a href=\"#narrow/channel/113488-general/topic/new.20.28mac.29.20laptop.20for.20Lean/near/537710150\">said</a>:</p>\n<blockquote>\n<p>Thx Henrik, btw, is that not a \"missed opportunity\" now that GPU's are so powerful (and assuming that their treatment of parallelism is ok (?))</p>\n</blockquote>\n<p>GPUs are only good for a very specific kind of computation. I haven't seen them used for compilers.</p>",
        "id": 537710574,
        "sender_full_name": "Thales Fragoso",
        "timestamp": 1757003100
    },
    {
        "content": "<p>GPU is good at performing the same task at large set of data. Type checking sounds like the exact opposite of it</p>",
        "id": 537710603,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1757003110
    },
    {
        "content": "<p>Has anyone been playing with the snapdragon elite chips? Clang compilation benchmarks seem to place them close to a M3 Pro. And with the Thinkpad t14s getting some decent Linux support, they start to get interesting.</p>",
        "id": 537710826,
        "sender_full_name": "Thales Fragoso",
        "timestamp": 1757003199
    },
    {
        "content": "<p>No, GPU compute is only effective for very particular numerical workloads. Lean's job as a program is mostly to go through trees, build new subtrees and make decisions based on looking at nodes in those trees. All of these are a very bad fit for GPUs.</p>\n<p>The compute model of a GPU is in essence that you get hundreds or even thousands, usually (compared to a CPU) quite slow, cores that mostly want to execute the same numerical program on different pieces of data in the memory of the GPU. If your computation is shaped like that a modern GPU can often outrun a modern CPU, if it is not the GPU will perform much worse than the CPU.</p>",
        "id": 537710959,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1757003252
    },
    {
        "content": "<p>Seeing <a href=\"https://gmplib.org/gmp-zen5\">this info</a> about possible incompatibilities between GMP and Zen 5 CPUs, I wonder if anything bad has been experienced using Lean on these devices, since now GMP is integrated.</p>",
        "id": 540670011,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1758473937
    },
    {
        "content": "<p>Almost no computations using GMP ever happen when you are using Lean. As long as your natural numbers stay below 2^63 everything is done using normal 64 bit integer operations. I would expect that nobody using Lean will ever experience something like this because of GMP, unless they are purposely working with large natural numbers.</p>",
        "id": 540671435,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1758475286
    }
]