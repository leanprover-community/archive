[
    {
        "content": "<p>Suppose I'm working in a project, let me call it A, downstream of Mathlib. Given a list of commands (or names corresponding to commands) in A, call it L, I want to create the minimal lean file satisfying the following four conditions:</p>\n<ul>\n<li>The Lean file runs without error (assuming A runs without error).</li>\n<li>Every command in the file corresponds to a command in A. </li>\n<li>Every command in L has a corresponding command in the file. </li>\n<li>The file only imports Mathlib files. </li>\n</ul>\n<p>Is there anything obvious I'm missing regarding e.g. metaprogramming which would make this unfeasible? </p>\n<p>The motivation is to create a file which can be imported into <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a> (so e.g. follow up results could be derived without installing A), and also understand the dependencies of the results in L. </p>\n<p>There is also a variation of this question for results in Mathlib, although I'm personally less interested in that.</p>",
        "id": 473777582,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1727711250
    },
    {
        "content": "<p>In general I think this is impossible, because the commands you run could make assertions about the current module name</p>",
        "id": 473798518,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727715720
    },
    {
        "content": "<p>But also, you'd need to be careful about <code>private def</code>s in different files that share a name, so would need to rewrite those</p>",
        "id": 473798685,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727715761
    },
    {
        "content": "<p>Maybe it's possible to write a <code>file_contents</code> macro that treats its contents as if it were the contents of an imported module?</p>",
        "id": 473798984,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1727715847
    },
    {
        "content": "<p>It's only somewhat related (in that it isn't Lean, and doesn't relate to your conditions) but I have <a href=\"https://github.com/JasonGross/coq-tools\">https://github.com/JasonGross/coq-tools</a> starred to look at at some point, I'm sure because someone here linked it as being useful in the Coq world, possibly Kevin.</p>",
        "id": 473799323,
        "sender_full_name": "Julian Berman",
        "timestamp": 1727715946
    },
    {
        "content": "<p>A few people have tried to write a minimizer, but this is actually quite involved.  I don't think that there is anything ready to be used for that.</p>",
        "id": 473831397,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727723933
    },
    {
        "content": "<p>I appreciate a minimizer is difficult, but I'd just like to add that I'd find it _incredibly_ valuable - about 70% of my Lean time is spent trying to isolate and minimize issues/bugs</p>",
        "id": 473875248,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1727735596
    },
    {
        "content": "<p>I'm pretty sure <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> or <span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> already built one? I forget the details</p>",
        "id": 473875824,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727735772
    },
    {
        "content": "<p>I remember a \"tree-shaking\" discussion with <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> writing a prototype.</p>",
        "id": 473876216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727735900
    },
    {
        "content": "<p>Ok, this is probably what I remember: <a href=\"#narrow/stream/113488-general/topic/Minimizer.20script\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Minimizer.20script</a>.</p>",
        "id": 473876488,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727735983
    },
    {
        "content": "<p>aha, good job me for remembering none of the people involved correctly</p>",
        "id": 473877783,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727736360
    },
    {
        "content": "<p>Anyway, I also tried this for a while, and it resulted in me learning about <code>find_home</code>, <code>minImports</code>, <code>Syntax</code> and <code>refactor</code>.</p>",
        "id": 473878169,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727736467
    },
    {
        "content": "<p>I think that I may give this another go, since I understand a bit more the involved pieces.</p>",
        "id": 473878276,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727736500
    },
    {
        "content": "<p>Someone is actively working on a test case reducer currently, and making rapid progress. They want to keep the project private for a bit longer, but David+Johan+I are actively talking to them and providing metaprogramming help where necessary.  (They are also making good use of lessons learned from <code>minImports</code>!)</p>",
        "id": 473893608,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727742506
    },
    {
        "content": "<p>I think everyone agrees this is a priority, and I'm really excite someone is seriously working on it.</p>",
        "id": 473893666,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727742526
    },
    {
        "content": "<p>If, for any reason, that project stalls out or needs help, we'll make sure to update everyone.</p>",
        "id": 473893725,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1727742543
    },
    {
        "content": "<p>Ok, thanks for the update: I will not look again into this, then -- at least until this project has any update.</p>",
        "id": 473898620,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1727744103
    },
    {
        "content": "<p>I've not needed to minimise stuff recently, but during the port and for the year or so afterwards when we were trying to understand the differences between lean 3 and lean 4's typeclass inference algorithms and I was often having to spend hours de-mathlibbing problems, so I'm very excited to hear that someone is thinking about this seriously :-) I've got extremely limited experience with using Coq so I was probably not recommending the tool, I was just pointing out that I was jealous of it :-) My answer to it was <a href=\"https://github.com/kbuzzard/MweSkeletons\">here</a> (building alg heirarchies from scratch) and it was still a huge pain to minimise.</p>",
        "id": 474789594,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728037087
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/Minimal.20lean.20file.20for.20a.20definition.20or.20theorem/near/473893608\">said</a>:</p>\n<blockquote>\n<p>Someone is actively working on a test case reducer currently, and making rapid progress. They want to keep the project private for a bit longer, but David+Johan+I are actively talking to them and providing metaprogramming help where necessary. </p>\n</blockquote>\n<blockquote>\n<p>If, for any reason, that project stalls out or needs help, we'll make sure to update everyone.</p>\n</blockquote>\n<p>Back in September someone was working on a test case reducer -- has this project seen any progress?  It would be very useful to have such a tool!</p>",
        "id": 484810045,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1732747237
    },
    {
        "content": "<p>Work is still happening! Not there yet, but progress...</p>",
        "id": 484839140,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732768306
    }
]