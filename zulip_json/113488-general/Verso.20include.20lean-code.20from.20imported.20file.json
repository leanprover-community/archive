[
    {
        "content": "<p>In Verso given the name of a definition or theorem, I know that Verso allows you to print the doc-string corresponding to that name. Is there a way to print the Lean code corresponding to that name without having to copy and paste it?</p>\n<p>For example I want something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">VersoManual</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Verso</span><span class=\"bp\">.</span><span class=\"n\">Genre</span><span class=\"w\"> </span><span class=\"n\">Verso</span><span class=\"bp\">.</span><span class=\"n\">Genre</span><span class=\"bp\">.</span><span class=\"n\">Manual</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Manual</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"Test\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n\n<span class=\"bp\">%%%</span>\n\n<span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Test\"</span>\n\n<span class=\"bp\">%%%</span>\n\n<span class=\"o\">{</span><span class=\"n\">docstring</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- shows doc-string</span>\n\n<span class=\"o\">{</span><span class=\"n\">leanCode</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- I want something like this to show lean code</span>\n</code></pre></div>",
        "id": 504545981,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741605423
    },
    {
        "content": "<p>I doubt it; the docstring is stored as part of the olean, the source is not. Maybe verso could use the declaration range and read the source file, but then it may be hard to elaboate it for all the nice hovers.</p>\n<p>It may work if the source file is already annotated by verso. We do that with the blog posts, where the code is processed by a different lean file, and support naming parts of the source file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"n\">mergeDef</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">acc</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">])</span>\n<span class=\"w\">        </span><span class=\"k\">else</span>\n<span class=\"w\">          </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">acc</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">])</span>\n<span class=\"w\">      </span><span class=\"k\">else</span>\n<span class=\"w\">        </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">:]</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">ys</span><span class=\"o\">[</span><span class=\"n\">j</span><span class=\"o\">:]</span>\n<span class=\"bp\">%</span><span class=\"kn\">end</span>\n</code></pre></div>\n<p>But this doesn’t work for definitions from normal libraries, I fear.</p>\n<p>(Just giving first approximations here, <span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span>  is the expert)</p>",
        "id": 504546989,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1741605662
    },
    {
        "content": "<p>Ok, thanks <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> ! This is roughly what I expected. I can probably settle for it without hovers - and I think I know how to do this using the declaration range.</p>",
        "id": 504548954,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741606117
    },
    {
        "content": "<p>This is correct. Right now, there 's two ways to get code into Verso:</p>\n<ol>\n<li>\n<p>Include it in the document itself. In these cases, the Lean process that's elaborating the document can be used to elaborate the code, saving the result. There's a lot of freedom to control this process as well, like using different scopes or environments for different blocks of code.</p>\n</li>\n<li>\n<p>Extract it from a complete Lean module using the <code>SubVerso</code> library, which is a tool for extracting metadata from Lean source code that's compatible with every Lean release going back to 4.0.0. It generates a JSON format that works in all those versions as well. It supports named examples (as <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> demonstrated) as well as extracting whole modules, but it doesn't have convenient support for saving certain named declarations. That would probably be fairly easy to add - I don't have the bandwidth right now to do it myself, however. You could also implement that as a separate tool built on the SubVerso library.</p>\n</li>\n</ol>\n<p>Basically, to get the nice highlighted code, you need to have an info tree and syntax. This means that the elaborator has to run right before the code is grabbed. But this can be done in lots of ways, and a tool that dumps a JSON object where keys are names, values are their source, and there's a separate table with docstrings would be both very doable and a nice way to implement what you're looking to do here.</p>",
        "id": 504576075,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1741612171
    }
]