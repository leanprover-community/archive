[
    {
        "content": "<p>This is the discussion thread of <strong>LeanSearch</strong> (<a href=\"https://leansearch.net/\">https://leansearch.net/</a>)<br>\nLooking forward to your feedback!</p>",
        "id": 455071884,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722329833
    },
    {
        "content": "<p>I love the \"Informal Statement\" section of the search, it gave accurate statements for the few tests that I did. Thank you for making this!</p>",
        "id": 455073083,
        "sender_full_name": "Rida Hamadani",
        "timestamp": 1722330124
    },
    {
        "content": "<p>Suggestion: from the list of results, it took me a while to find how I could go interact with it. I finally found that the number in the left column is a link to the Mathlib docs, but that number is small and the link is not easy to notice.<br>\nCould the whole formal statement box be made into a link?</p>",
        "id": 455074311,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1722330428
    },
    {
        "content": "<p>This is the first inaccurate statement that I've found:<br>\n<a href=\"/user_uploads/3121/9hOOu_o3Ii_VR1dkRFFNDbrA/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/9hOOu_o3Ii_VR1dkRFFNDbrA/image.png\" title=\"image.png\"><img data-original-dimensions=\"1698x78\" src=\"/user_uploads/thumbnail/3121/9hOOu_o3Ii_VR1dkRFFNDbrA/image.png/840x560.webp\"></a></div><p>Here what is meant by the theorem is that a complete graph is regular of degree equal to the number of vertices minus one, which is pretty far from the informal statement.</p>\n<p>Of course it is expected from a LLM to give some inaccurate statements, is there a place to submit feedback over such statements?</p>",
        "id": 455074622,
        "sender_full_name": "Rida Hamadani",
        "timestamp": 1722330517
    },
    {
        "content": "<p>The one thing I’m worried about projects like this, including <a href=\"http://Moogle.ai\">Moogle.ai</a> (which is great!), is that they have a tendency to fizzle out as the creators stop supporting them, so we get hooked and let down when they die.  (Last I checked <a href=\"http://Moogle.ai\">Moogle.ai</a> hasn’t kept up with changes in Lean.). But I look forward to trying it!</p>",
        "id": 455075728,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722330779
    },
    {
        "content": "<p>I just tried it on a couple of things I was looking for last night: \"the orbit stabilizer theorem\" and \"decompose List.range of a successor\". The answers I got were excellent; the suggestions were all relevant and the things I wanted were at the top.</p>",
        "id": 455079249,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1722331473
    },
    {
        "content": "<p>Just to check; this only searches theorems and not definitions?</p>",
        "id": 455085441,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722333199
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"350992\">Rémy Degenne</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455074311\">said</a>:</p>\n<blockquote>\n<p>Could the whole formal statement box be made into a link?</p>\n</blockquote>\n<p>Yes, that's a great UI suggestion! We will try to modify the link in the next version.</p>",
        "id": 455087444,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722333636
    },
    {
        "content": "<p>This is very nice. Thanks.</p>\n<p>However, one thing that will improve its value to me is if it searches for definitions as well as theorems. For example, responses to \"Remove an element from a list\" do not include <code>List.erase</code> but only theorems about it.</p>",
        "id": 455087867,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1722333762
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455085441\">said</a>:</p>\n<blockquote>\n<p>Just to check; this only searches theorems and not definitions?</p>\n</blockquote>\n<p>Ah yes for this version. Soon there will be a major update to include all definitions and instances. It's already on the schedule.</p>",
        "id": 455088623,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722334006
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 455088953,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1722334109
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"580947\">Rida Hamadani</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455074622\">said</a>:</p>\n<blockquote>\n<p>is there a place to submit feedback over such statements?</p>\n</blockquote>\n<p>I will discuss with the engineering team about this. It is valuable to collect human-corrected data, but it also requires some engineering work behind it.</p>",
        "id": 455089733,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722334372
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455075728\">said</a>:</p>\n<blockquote>\n<p>The one thing I’m worried about projects like this, including <a href=\"http://Moogle.ai\">Moogle.ai</a> (which is great!), is that they have a tendency to fizzle out as the creators stop supporting them, so we get hooked and let down when they die.  (Last I checked <a href=\"http://Moogle.ai\">Moogle.ai</a> hasn’t kept up with changes in Lean.). But I look forward to trying it!</p>\n</blockquote>\n<p>Moogle is scheduled to update in a some weeks (I asked). However I agree that it’s nice to have a similar tool run by a university lab, as I imagine it might be more likely to last, or at the very least to be more easily handed off to someone else in the future if need be (though of course I wish the best of luck to everyone at Morph labs!)</p>",
        "id": 455090285,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1722334581
    },
    {
        "content": "<p>Also since there are more details available about the implementation it should be more easy to duplicate too if necessary</p>",
        "id": 455090375,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1722334627
    },
    {
        "content": "<p>In the long run we need open models with openly accessible APIs. Otherwise we are dependent on what the investors in a company like.</p>",
        "id": 455102557,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1722339153
    },
    {
        "content": "<p>Another request: can we have an API for LeanSearch to use in other programs?</p>",
        "id": 455105474,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1722340244
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455105474\">said</a>:</p>\n<blockquote>\n<p>Another request: can we have an API for LeanSearch to use in other programs?</p>\n</blockquote>\n<p>Marc has been thinking about how to get the results of Loogle <del>and Moogle</del> \"closer to the code\" via some support from the VSCode extension. Minimising the disruption / change of focus away from VSCode required to ask a question seems very important for making search tools useful.</p>",
        "id": 455106407,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722340595
    },
    {
        "content": "<p>We would be happy to make LeanSearch completely open-sourced after the paper is published.</p>",
        "id": 455111793,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722342540
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <br>\nWe are happy to provide the API; however, there are cost and safety concerns.</p>\n<p>We are very excited about the possibility of integrating our search engine into VSCode extensions and would be very happy to provide the API for it. Additionally, for any research use, we would also be happy to provide our API. Please contact me if you wish to use it.</p>",
        "id": 455113558,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722343172
    },
    {
        "content": "<p>I have been wondering about the extension itself becoming rather complicated. Does it make sense to split these vscode search tools into their own extensions and make an extension pack? So people can either install the lot in one go or pick and choose which extensions they want and in case of payment, which ones they wish to pay for.</p>",
        "id": 455115964,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1722343932
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455113558\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <br>\nWe are happy to provide the API; however, there are cost and safety concerns.</p>\n<p>We are very excited about the possibility of integrating our search engine into VSCode extensions and would be very happy to provide the API for it. Additionally, for any research use, we would also be happy to provide our API. Please contact me if you wish to use it.</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span>. I will contact you and ask for API access once I have a concrete use case (should be not too far in the future).</p>",
        "id": 455116242,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1722344041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455115964\">said</a>:</p>\n<blockquote>\n<p>So people can either install the lot in one go or pick and choose which extensions they want and in case of payment, which ones they wish to pay for.</p>\n</blockquote>\n<p>We do not have enough people to make it into a separate VSCode extension...</p>",
        "id": 455118790,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722344799
    },
    {
        "content": "<p>I believe it is not necessary for your team to do this as long as an API is on offer. The extension is merely a front end to your search engine. In principle it can be embedded in vscode even without extra effort on your part for an API, as a webview. This is essentially what the extension's Loogle view and moogle's extension offer anyway</p>",
        "id": 455132919,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1722348864
    },
    {
        "content": "<p>I'm getting \"Error: No API found\". What could be the problem?</p>",
        "id": 455182984,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1722361572
    },
    {
        "content": "<p>I find the interface a bit hard to use on a phone.  (I guess most people use laptops but I find myself on my phone a lot looking stuff up and chatting on here and PA.SX.)  Also, it is strange you click on the number to go to mathlib’s docs.  I think if you adopted an interface more like Moogle or the other search which came out yesterday, where you click on the theorem identifier it would be better.</p>",
        "id": 455292533,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722406661
    },
    {
        "content": "<p>But, I really like the informal statement aspect.  That is a big value add.</p>",
        "id": 455292554,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722406671
    },
    {
        "content": "<p>Also, I wish this (or Moogle or the other new search engine or all three) would be added to mathlib’s <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a>. (With Moogle you can just call it with a URL with the query in the URL like google.  I don’t know how you would call this one right now.)</p>",
        "id": 455293006,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722406836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/455182984\">said</a>:</p>\n<blockquote>\n<p>I'm getting \"Error: No API found\". What could be the problem?</p>\n</blockquote>\n<p>Could you please more information? e.g. screenshots and information about your browser, ...</p>",
        "id": 455334424,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722419158
    },
    {
        "content": "<p>Damn, I stumbled upon the paper on this a few days ago while looking up <code>semantic search mathlib4</code> and I was wondering why I couldn't find the service, turns out it wasn't released yet <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span> <br>\nThank you so much for this. As someone who is new to Lean and have a ton of trouble finding everything I need, this is a true lifesaver. I was trying to use frontier LLMs to find theorems in Lean but it seems like they are not sufficiently up to date on Mathlib4. However, this provides me exactly the tool I needed. <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 455983309,
        "sender_full_name": "Victor Liu",
        "timestamp": 1722617194
    },
    {
        "content": "<p>Sometimes, I search many different queries in rapid succession, and would like to go back to the previous ones. It would be greatly appreciated if we could store previous few queries to be able to see them again. This could be adjusted in settings to reduce lag.</p>",
        "id": 456188219,
        "sender_full_name": "Victor Liu",
        "timestamp": 1722704074
    },
    {
        "content": "<p>Lean Search is down? \"503 Service Temporarily Unavailable\" displayed.<br>\n<a href=\"https://leansearch.net/\">https://leansearch.net/</a></p>",
        "id": 456276383,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722751537
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span></p>",
        "id": 456276440,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1722751571
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/456276383\">said</a>:</p>\n<blockquote>\n<p>Lean Search is down? \"503 Service Temporarily Unavailable\" displayed.<br>\n<a href=\"https://leansearch.net/\">https://leansearch.net/</a></p>\n</blockquote>\n<p>Yes, the issue is on the server side. Due to server reallocation, we encountered a problem that has temporarily made the service unavailable. We are working to resolve this issue as quickly as possible. I will post an update in this channel once it is fixed. Thank you very much for pointing it out.</p>",
        "id": 456289320,
        "sender_full_name": "Guoxiong Gao",
        "timestamp": 1722761440
    },
    {
        "content": "<p>The issue has been fixed. If you encounter any further problems, please reach out to me or <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> . We're happy to help!</p>",
        "id": 456298402,
        "sender_full_name": "Guoxiong Gao",
        "timestamp": 1722766522
    },
    {
        "content": "<p>A suggestion: should we make the search case-insensitive?  Searching for \"Caylay-Hamilton\" gives the expected results but a lower case \"caylay-hamilton\" will lead you to the wonderful world of modular forms.</p>",
        "id": 456756175,
        "sender_full_name": "Tony Beta Lambda",
        "timestamp": 1722914991
    },
    {
        "content": "<p>That wouldn't match the way the <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a> work, namely lowercase matches lowercase and uppercase, uppercase matches anything</p>",
        "id": 456775685,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722924193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"652127\">Tony Beta Lambda</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/456756175\">said</a>:</p>\n<blockquote>\n<p>A suggestion: should we make the search case-insensitive?  Searching for \"Caylay-Hamilton\" gives the expected results but a lower case \"caylay-hamilton\" will lead you to the wonderful world of modular forms.</p>\n</blockquote>\n<p>Hi, thank you for your suggestion! Currently, we use a large embedding model to turn a query into a semantic vector to find the most relevant theorems. So it depends on whether this embedding model thinks \"Caylay-Hamilton\" and \"caylay-hamilton\" are semantically near each other. Sometimes the upper-cased word does have a completely different meaning compared with the lower-cased one. I believe using the case that is common in mathematical literature gives the best result.</p>\n<p>Maybe what we can do is a button that enables you to toggle on/off case sensitivity by turning all input into lower-case.</p>",
        "id": 456798092,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1722933254
    },
    {
        "content": "<p>I'm a newbie. From a MLSYS point of view, I wonder what's the minimal computation that is needed to do search. Is it possible to have a small locally runnable implementation?</p>",
        "id": 456981544,
        "sender_full_name": "Xiyu Zhai",
        "timestamp": 1722991320
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/456798092\">said</a>:</p>\n<blockquote>\n<p>I believe using the case that is common in mathematical literature gives the best result.</p>\n<p>Maybe what we can do is a button that enables you to toggle on/off case sensitivity by turning all input into lower-case.</p>\n</blockquote>\n<p>Agreed, although I can't seem to think of an example where differently cased words mean significantly different things in math :)</p>",
        "id": 456998856,
        "sender_full_name": "Tony Beta Lambda",
        "timestamp": 1723000395
    },
    {
        "content": "<p>I believe the site is dead again on <a href=\"https://leansearch.net\">https://leansearch.net</a>?</p>\n<hr>\n<p>Update: reloaded in a few minutes and it worked for me, I think the service is intermittent.</p>",
        "id": 462197964,
        "sender_full_name": "Evgenia Karunus",
        "timestamp": 1723577548
    },
    {
        "content": "<p>Some theorem links give me 404  when I click on them, for example <code>div_pos</code> one.<br>\nI imagine that's because documentation updated, and there is no such theorem anymore.<br>\nMight it be sensible to link people to the github repo at a particular commit instead (the commit you gathered theorems from), if it's technically feasible?</p>\n<p><a href=\"/user_uploads/3121/NkEVN0aHMnC08BmKTaj9GAJg/image.png\">image.png</a> <br>\n<a href=\"/user_uploads/3121/t5mfVks7_WhnTaUmC9ldKuBA/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/NkEVN0aHMnC08BmKTaj9GAJg/image.png\" title=\"image.png\"><img data-original-dimensions=\"2084x962\" src=\"/user_uploads/thumbnail/3121/NkEVN0aHMnC08BmKTaj9GAJg/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/t5mfVks7_WhnTaUmC9ldKuBA/image.png\" title=\"image.png\"><img data-original-dimensions=\"2424x210\" src=\"/user_uploads/thumbnail/3121/t5mfVks7_WhnTaUmC9ldKuBA/image.png/840x560.webp\"></a></div>",
        "id": 468229823,
        "sender_full_name": "Evgenia Karunus",
        "timestamp": 1725639526
    },
    {
        "content": "<p>Oh thank you for the feedback! This is a very good idea!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"480079\">Evgenia Karunus</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468229823\">said</a>:</p>\n<blockquote>\n<p>Might it be sensible to link people to the github repo at a particular commit instead (the commit you gathered theorems from), if it's technically feasible?</p>\n</blockquote>",
        "id": 468230184,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725639654
    },
    {
        "content": "<p>I don't think the website is versioned, but what about using the same mechanism as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc\">docs#div_pos</a> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc\">https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc</a>) ?</p>",
        "id": 468334930,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1725680047
    },
    {
        "content": "<p>We are sorry the service is temporarily offline due to a major update. It will operate again once the update is finished. The update process should be finished in less than 24 hours if everything goes well.</p>",
        "id": 468421432,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725720419
    },
    {
        "content": "<p>Thanks for the suggestion, we will adopt it in this upgrade.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468334930\">said</a>:</p>\n<blockquote>\n<p>I don't think the website is versioned, but what about using the same mechanism as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc\">docs#div_pos</a> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc\">https://leanprover-community.github.io/mathlib4_docs/find/?pattern=div_pos#doc</a>) ?</p>\n</blockquote>",
        "id": 468529116,
        "sender_full_name": "Guo Zixun",
        "timestamp": 1725782155
    },
    {
        "content": "<p>What is the suggested workflow if I would like to be using this / trying it out, but don't want to leave VSCode?</p>",
        "id": 468641806,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725838987
    },
    {
        "content": "<p>Congrats with the release, happy the json api works now!</p>\n<p>Some thoughts about the new UI - in the old UI, I was able to read 5 or so theorems without scrolling after I click \"search\", now I see 1.5 theorems.<br>\nAlso - I was able to read the description of the theorem without clicking on anything (without compromising cleanliness/compactness!).<br>\nAnd I liked being able to read the theorem name together with its type on the same line.<br>\nI also enjoyed the fact that you saw the rank &amp; could click on it (though I understand from the comments above that some people didn't immediately see it as a link). It was clear what exactly is clickable in the interface and what is not.<br>\nI really enjoyed how clean/easy to read/concise the old interface was, maybe it's possible to integrate new functionality without compromising the compactness/simplicity of the old UI.</p>\n<p>Mild nitpick - in theorem statements, we get empty spaces like this \"<code>∀ {f f' : ℝ → ℝ} {a b : ℝ},   ContinuousOn f (Icc a b) →     (∀ x ∈ Ico a b, HasDerivWithinAt f (f' x) (Ici x) x) →       ∀ {B B' : ℝ → ℝ},         f a ≤ B a →           ContinuousOn B (Icc a b) →             (∀ x ∈ Ico a b, HasDerivWithinAt B (B' x) (Ici x) x) →               (∀ x ∈ Ico a b, f x = B x → f' x &lt; B' x) → ∀ ⦃x : ℝ⦄, x ∈ Icc a b → f x ≤ B x</code>\", maybe it makes sense to congeal multiple spaces into one space, or even into newlines.</p>",
        "id": 468648798,
        "sender_full_name": "Evgenia Karunus",
        "timestamp": 1725844449
    },
    {
        "content": "<p>The release is great, thanks! I have a minor comment on the name. The website is called <code>`Mathlib 4 Search</code> (according to the browser tab), the url says <code>leansearch</code>, the title of the page is \"Lean Search\" and the description begins with \"Find theorems in Mathlib4...\". Would it be possible to be more uniform (probably towards Mathlib)?</p>",
        "id": 468700814,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1725866393
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"480079\">Evgenia Karunus</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468648798\">said</a>:</p>\n<blockquote>\n<p>Congrats with the realease, happy the json api works now!</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> Where is the JSON API mentioned in the message documented?</p>",
        "id": 468746611,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725877229
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468746611\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> Where is the JSON API mentioned in the message documented?</p>\n</blockquote>\n<p>You can find an example using the API of LeanSearch <a href=\"https://github.com/yhtq/LeanSearchDocs\">here</a>.</p>",
        "id": 468755688,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725879724
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468700814\">said</a>:</p>\n<blockquote>\n<p>Would it be possible to be more uniform (probably towards Mathlib)?</p>\n</blockquote>\n<p>Thank you! We will probably make it more consistent in the next update. But I am quite fond of the name <code>LeanSearch</code>. <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>\n<p>I remember that there is another search tool called \"search-mathlib\". So we will probably try to avoid creating any confusion.</p>",
        "id": 468757961,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725880281
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468641806\">said</a>:</p>\n<blockquote>\n<p>What is the suggested workflow if I would like to be using this / trying it out, but don't want to leave VSCode?</p>\n</blockquote>\n<p>Maybe a potential solution is to make it into a vscode extension. Or like loogle, integrated as a part of the Lean vscode extension.</p>\n<p>I believe it would be fantastic if we could have such a vscode extension. However, we don't have enough personnel to work on this project...</p>",
        "id": 468760460,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725880937
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468755688\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468746611\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> Where is the JSON API mentioned in the message documented?</p>\n</blockquote>\n<p>You can find an example using the API of LeanSearch <a href=\"https://github.com/yhtq/LeanSearchDocs\">here</a>.</p>\n</blockquote>\n<p>Thanks. I am going to start using this immediately.</p>",
        "id": 468824873,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725893630
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468760460\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468641806\">said</a>:</p>\n<blockquote>\n<p>What is the suggested workflow if I would like to be using this / trying it out, but don't want to leave VSCode?</p>\n</blockquote>\n<p>Maybe a potential solution is to make it into a vscode extension. Or like loogle, integrated as a part of the Lean vscode extension.</p>\n<p>I believe it would be fantastic if we could have such a vscode extension. However, we don't have enough personnel to work on this project...</p>\n</blockquote>\n<p>An option is to have a Lean command that gives these options in the InfoView calling the API (maybe with TryThese as an option). </p>\n<p>I will be happy to implement this in a day or two.</p>",
        "id": 468825438,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725893753
    },
    {
        "content": "<p>Thank you for the tool!<br>\nOne question: With this query</p>\n<blockquote>\n<p>Positive and Negative Inequality: A positive number is not equal to its negative counterpart, meaning that if a number is greater than zero, it cannot be equal to the same number multiplied by negative one.</p>\n</blockquote>\n<p>I get suggested the following theorems:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">neg_ne_of_pos</span>\n<span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>which does not seem to exist. Am I missing something?<br>\n<a href=\"/user_uploads/3121/hHYiEHHQi77gyVgrLfYzPRLS/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/hHYiEHHQi77gyVgrLfYzPRLS/image.png\" title=\"image.png\"><img data-original-dimensions=\"2666x350\" src=\"/user_uploads/thumbnail/3121/hHYiEHHQi77gyVgrLfYzPRLS/image.png/840x560.webp\"></a></div>",
        "id": 468926579,
        "sender_full_name": "Xavier Généreux",
        "timestamp": 1725919730
    },
    {
        "content": "<p>This would be awesome. We should have <code>#leansearch</code>, <code>#moogle</code>, etc.</p>",
        "id": 468961580,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725936537
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>  I have made a first implementation for feedback and format. </p>\n<p>The current interface gives a command with a \"TryThis\" widget that allows one to replace the command with a \"#check\" statement. To avoid repeatedly calling, the API is called only when the input ends with a \".\" or \"?\". The following is an illustration:</p>\n<p><a href=\"/user_uploads/3121/_b6F2TIINlC0Iv_UC-dEWcHu/leansearch.gif\">leansearch.gif</a></p>\n<p>The code is at <a href=\"https://github.com/siddhartha-gadgil/MetaExamples/blob/main/MetaExamples/LeanSearch.lean\">https://github.com/siddhartha-gadgil/MetaExamples/blob/main/MetaExamples/LeanSearch.lean</a>. It is a very small amount of code so can just be pasted where needed. It is included below</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Cache.IO</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Cache.IO</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://leansearch.net/api/search\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.replace</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"s2\">\"%20\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"?query={s'}&amp;num_results={num_results}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">runCurl</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-X\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"GET\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Json.parse</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">js.getArr</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getCommandSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">js</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_name\"</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_type\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"docstring\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"doc_url\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">docurl</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" (link: {s})\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"#check {name}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" -- {s}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">preInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"/- {doc}{docurl}-/</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jsArr</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">jsArr.filterMap</span><span class=\"w\"> </span><span class=\"n\">getCommandSuggestion</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#lean_search\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Command.liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">lean_search</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code>\n</code></pre></div>",
        "id": 468992283,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725947964
    },
    {
        "content": "<p>A non-lean question: the \"gif\" above is not animating in preview while ones I posted earlier did. Does anyone know why?</p>",
        "id": 468993183,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725948368
    },
    {
        "content": "<p>Suggestions:</p>\n<ul>\n<li>inline <code>runCurl</code>, so this could even be standalone from Mathlib</li>\n<li>Since \"Try this:\" can show arbitary html, how about a hyperlink with the link, rather than the link text?</li>\n<li>Space after the docurl?</li>\n<li>Maybe put the #check before the doc-string?</li>\n<li>Do we actually need quotes here? I wonder if we can tell the parser to just take <em>anything</em> up to the newline.</li>\n<li>The behaviour requiring \".\" or \"?\" is really confusing, and we need a better solution here. Debouncing? Print a warning if the string doesn't end that way?</li>\n</ul>",
        "id": 468994224,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725948939
    },
    {
        "content": "<p>(this is really great, looking forward to using it all the time!)</p>",
        "id": 468994371,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725948999
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I have not inlined <code>getCurl</code> because I was worried about system independence (e.g. windows) and expected that cache has handled this. If you can suggest a robust way without Mathlib dependency I would be happy to do this.</p>\n<p>I will work on the other suggestions. I did not know arbitrary HTML works in the widget (I guess that is logical as the Infoview is a browser).</p>",
        "id": 468994815,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725949218
    },
    {
        "content": "<p>Nope, Cache just assumes it is there.</p>",
        "id": 468994926,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725949280
    },
    {
        "content": "<p>I see. Then I too will assume this. </p>\n<p>I also need help/references for the html link. Naively putting it as part of a string did not work. Is there something in which it should be enclosed?</p>",
        "id": 468995635,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725949624
    },
    {
        "content": "<p>I think the ProofWidget package provides a little DSL for building interactive things. I guess links are a very minimalistic form of interaction, but it might still be useful to pass through that API?</p>",
        "id": 468995913,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1725949707
    },
    {
        "content": "<p>I implemented the easy suggestions. Here is a new animation:<br>\n<a href=\"/user_uploads/3121/KxTJjxu0iZT4k3ZTaLz6Qksr/leansearch-2.gif\">leansearch-2.gif</a></p>\n<p>Implemented:</p>\n<ul>\n<li>Warning if the sentence does not end with \".\" or \"?\"</li>\n<li>Documentation after <code>#check</code></li>\n<li>Inlined <code>curl</code></li>\n</ul>\n<p>I do not know how to implement (but will continue searching):</p>\n<ul>\n<li>HTML links in <code>TryThis</code>.</li>\n<li>A parser that works without quotes up to end of  the line.</li>\n</ul>\n<p>For easy experimentation, here is the code to paste somewhere local (the webview will not handle <code>curl</code>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://leansearch.net/api/search\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.replace</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"s2\">\"%20\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"?query={s'}&amp;num_results={num_results}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO.Process.output</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"curl\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-X\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"GET\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">]}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Json.parse</span><span class=\"w\"> </span><span class=\"n\">s.stdout</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">js.getArr</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getCommandSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">js</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_name\"</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_type\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"docstring\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"doc_url\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">docurl</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"[docs](s)\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getD</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"#check {name}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" -- {s}\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">/- {doc}{docurl}-/</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jsArr</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">jsArr.filterMap</span><span class=\"w\"> </span><span class=\"n\">getCommandSuggestion</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#lean_search\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Command.liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">lean_search</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>",
        "id": 468999626,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725950852
    },
    {
        "content": "<p>I'm not sure how cancelling of commands works, if at all. Perhaps an experiment is worthwhile to see if just adding a 200ms delay before calling curl suffices to avoid sending a request on every keystroke?</p>",
        "id": 469004714,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725952298
    },
    {
        "content": "<p>I will work on some <code>Task</code> based polling to avoid frequent calls. Every time the elaborator is called the call time is noted as well as the prompt. The query goes only if enough time has passed after the last call.</p>",
        "id": 469018124,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725954945
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469018124\">said</a>:</p>\n<blockquote>\n<p>I will work on some <code>Task</code> based polling to avoid frequent calls. Every time the elaborator is called the call time is noted as well as the prompt. The query goes only if enough time has passed after the last call.</p>\n</blockquote>\n<p>I retract this. Something has to trigger the elaborator to show stuff after it is computed in the background. It can be a change somewhere else but that will be fiddly. It will also go against trying to cache more to avoid re-evaluating.</p>\n<p>For now, I feel having a clear warning to end with \".\" or \"?\" or some other terminator seems reasonably ergonomic and is easy.</p>",
        "id": 469024361,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725956275
    },
    {
        "content": "<p>About widgets showing arbitrary html: this is indeed nice, but please try to emit data in a structured way and then have the widget react code produce html. This way your widget can easily be implemented in other editors where the infoView is not a webpage.</p>",
        "id": 469028245,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1725957332
    },
    {
        "content": "<p>As of now I have no idea how to have the widget emit arbitrary html (I tried simply as a string and nothing happened).</p>",
        "id": 469029368,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725957678
    },
    {
        "content": "<p>I will try to give the data in a more structured form.</p>",
        "id": 469029659,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725957774
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/-eCWh-o4XHZ1Vlnioo6k6MGW/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/-eCWh-o4XHZ1Vlnioo6k6MGW/image.png\" title=\"image.png\"><img data-original-dimensions=\"867x622\" src=\"/user_uploads/thumbnail/3121/-eCWh-o4XHZ1Vlnioo6k6MGW/image.png/840x560.webp\"></a></div><p>The above is the modified view which I hope is more structured.</p>",
        "id": 469031237,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725958195
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"557459\">Xavier Généreux</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/468926579\">said</a>:</p>\n<blockquote>\n<p><code>Int.neg_ne_of_pos</code></p>\n</blockquote>\n<p>That's probably because, in the latest version of Mathlib, this theorem has changed its name or has been removed.</p>",
        "id": 469032621,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725958554
    },
    {
        "content": "<p>Don't worry about the html, I guess. But <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span>'s point is a good one: you should parse the JSON to a custom structure, and separately transform that structure to a <code>TryThis.Suggestion</code>, so that it is possible to consume it other ways.</p>",
        "id": 469035270,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725959144
    },
    {
        "content": "<p>I have refactored the code to separate the http query and extraction from JSON from generating and using the suggestion. Here is the new version.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Parser</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://leansearch.net/api/search\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.replace</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"s2\">\"%20\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"?query={s'}&amp;num_results={num_results}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO.Process.output</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"curl\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-X\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"GET\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">]}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Json.parse</span><span class=\"w\"> </span><span class=\"n\">s.stdout</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">js.getArr</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">js</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_name\"</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_type\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"docstring\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"doc_url\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"kind\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">query</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jsArr</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">jsArr.filterMap</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toCommandSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"· Description: {doc}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"· Type: {type}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"· URL: {docurl}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"#check {sr.name}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" -- {s}\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">{data}\"</span><span class=\"o\">}</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"n\">SearchResult.toCommandSuggestion</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#lean_search\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Command.liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">lean_search</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>",
        "id": 469049138,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725962518
    },
    {
        "content": "<p>I suggest removing <code>import Mathlib</code> here, or at least making sure that it works after commenting it out.</p>",
        "id": 469050229,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725962861
    },
    {
        "content": "<p>I tested that. It works in one sense and not another:</p>\n<ul>\n<li>The code works fine to generate the <code>TryMe</code> etc and clicking replaces (so all new code is fine).</li>\n<li>But usually when we replace by <code>#check ...</code> the theorem is not in scope so gives an error.</li>\n</ul>\n<p>So Mathlib is needed not for this code but at the user end.</p>",
        "id": 469050964,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725963093
    },
    {
        "content": "<p>The type is displayed twice, once as a <code>--</code> on the #check line, then again as a bullet.</p>",
        "id": 469051125,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725963140
    },
    {
        "content": "<p>Suggest getting rid of the URL entirely. It's useless?</p>",
        "id": 469051162,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725963156
    },
    {
        "content": "<p>Yes. Both seemed reasonable places for the type. <br>\nIf I get rid of the URL, then there is no need to have headers. Let me make the changes and post for comments.</p>",
        "id": 469051293,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725963209
    },
    {
        "content": "<p>How about we <em>also</em> make it parse as term? And \"Try this:\" just inserts the identifier.</p>",
        "id": 469051548,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725963297
    },
    {
        "content": "<p>It could also parse as a tactic and give three suggestions <code>apply foo</code>, <code>have := foo</code> and <code>rw [foo]</code>.</p>",
        "id": 469051623,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725963325
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469051548\">said</a>:</p>\n<blockquote>\n<p>How about we <em>also</em> make it parse as term? And \"Try this:\" just inserts the identifier.</p>\n</blockquote>\n<p>I will make another elaborator to parse as a term. The one issue is that we have to return something from the elaborator before the TryMe is used to choose. It seems that <code>sorry Prop</code> is a reasonable fallback. More precisely, if the type is known then <code>sorry type</code> else <code>sorry Prop</code>.</p>",
        "id": 469052169,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725963513
    },
    {
        "content": "<p>I will also make the tactics version.</p>",
        "id": 469052291,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725963561
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span>, could you remove all the <code>.proof_n</code> results? As far as I can see they are just noise.</p>",
        "id": 469052533,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725963644
    },
    {
        "content": "<p>Here is the info view cleaned up version of the command elaborator. Seems that this is enough info.<br>\n<a href=\"/user_uploads/3121/JO_3OHsGBmNmfBwyNM3aB1Rh/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/JO_3OHsGBmNmfBwyNM3aB1Rh/image.png\" title=\"image.png\"><img data-original-dimensions=\"880x406\" src=\"/user_uploads/thumbnail/3121/JO_3OHsGBmNmfBwyNM3aB1Rh/image.png/840x560.webp\"></a></div>",
        "id": 469052650,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725963699
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469052533\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"611077\">Jiang Jiedong</span>, could you remove all the <code>.proof_n</code> results? As far as I can see they are just noise.</p>\n</blockquote>\n<p>Thank you for your advice. We will definitely remove them in the next update.</p>",
        "id": 469075107,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1725970999
    },
    {
        "content": "<p>Looks really nice! Just the right amount of info now.</p>",
        "id": 469078738,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725971903
    },
    {
        "content": "<p>So where do we put this? I think either a separate repo imported into Mathlib, or just Mathlib, work fine. I have a slight preference for a separate repo, to be honest.</p>\n<p>(For slightly \"meta\" reasons. We need to get good at using separate repos, and if it's annoying at first, we will learn how to make it better.)</p>",
        "id": 469079196,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725972034
    },
    {
        "content": "<p>Separate repo sounds good. </p>\n<p>I am now working on the term and tactic versions. Once they are done I will make the repo.</p>",
        "id": 469079467,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725972117
    },
    {
        "content": "<p>For terms here is the view of suggestions. I am also giving the type as a suggestion and the term with type given explicitly.<br>\n<a href=\"/user_uploads/3121/z-3nf1NPmU2lAmFdCmPVUAus/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/z-3nf1NPmU2lAmFdCmPVUAus/image.png\" title=\"image.png\"><img data-original-dimensions=\"873x589\" src=\"/user_uploads/thumbnail/3121/z-3nf1NPmU2lAmFdCmPVUAus/image.png/840x560.webp\"></a></div><p>I added the other options because of misdiagnosing some low level errors (now fixed). I can remove them. I will anyway add configuration options so that they are not shown by default.</p>",
        "id": 469081583,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725972634
    },
    {
        "content": "<p>And the tactics infoview:<br>\n<a href=\"/user_uploads/3121/1YRu7bbarcIdGZIMDokcf3d7/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/1YRu7bbarcIdGZIMDokcf3d7/image.png\" title=\"image.png\"><img data-original-dimensions=\"873x663\" src=\"/user_uploads/thumbnail/3121/1YRu7bbarcIdGZIMDokcf3d7/image.png/840x560.webp\"></a></div>",
        "id": 469084582,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973308
    },
    {
        "content": "<p>I modified the term suggestions a bit as it will be useful for the user to know the type. I will do the same for the tactics.<br>\n<a href=\"/user_uploads/3121/vJEGGUVTgUqkVYEgc0OpbDh0/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/vJEGGUVTgUqkVYEgc0OpbDh0/image.png\" title=\"image.png\"><img data-original-dimensions=\"873x663\" src=\"/user_uploads/thumbnail/3121/vJEGGUVTgUqkVYEgc0OpbDh0/image.png/840x560.webp\"></a></div>",
        "id": 469085451,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973502
    },
    {
        "content": "<p>I think it's essential for both views that there is only one bullet symbol per result</p>",
        "id": 469085885,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973597
    },
    {
        "content": "<p>otherwise it is impossible to interpret quickly</p>",
        "id": 469085921,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973608
    },
    {
        "content": "<p>Sure.</p>",
        "id": 469085940,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973614
    },
    {
        "content": "<p>I still don't understand why you are showing three different things per result for term mode.</p>",
        "id": 469086067,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973649
    },
    {
        "content": "<p>There is only one bullet point per clickable result.</p>",
        "id": 469086105,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973659
    },
    {
        "content": "<p>?</p>",
        "id": 469086206,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973678
    },
    {
        "content": "<p>No, there is <code>FrequentlyOdd</code>, then its type, then the term with a type ascription.</p>",
        "id": 469086357,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973705
    },
    {
        "content": "<p>That's three bullet points per result.</p>",
        "id": 469086372,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973712
    },
    {
        "content": "<p>In term mode I think there should only be one clickable thing per search result.</p>",
        "id": 469086446,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973729
    },
    {
        "content": "<p>I mean clicking on each bullet point gives a different results. Per search result there are three (just as there are 4 for tactics).</p>",
        "id": 469086479,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973738
    },
    {
        "content": "<p>I do agree about the term mode.</p>",
        "id": 469086518,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973746
    },
    {
        "content": "<p>I will switch back. I did this because of a low level error which I thought could be avoided by giving the type explicitly. But that was for a different reason.</p>",
        "id": 469086784,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973797
    },
    {
        "content": "<p>For the tactic mode result it is essential that if we are given four alternatives that they are grouped together in some way</p>",
        "id": 469086972,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973828
    },
    {
        "content": "<p>This is what I meant by \"one bullet per result\" (result meaning search result, not clickable action)</p>",
        "id": 469087099,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725973857
    },
    {
        "content": "<p>So here is the new version for terms.<br>\n<a href=\"/user_uploads/3121/ZwH5PmAI4BXD3yE5US18zItK/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ZwH5PmAI4BXD3yE5US18zItK/image.png\" title=\"image.png\"><img data-original-dimensions=\"834x349\" src=\"/user_uploads/thumbnail/3121/ZwH5PmAI4BXD3yE5US18zItK/image.png/840x560.webp\"></a></div>",
        "id": 469087474,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973952
    },
    {
        "content": "<p>To group tactics (which I agree should be done) I will have to look at the implementation of <code>TryThis.addSuggestions</code>.</p>",
        "id": 469087583,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725973983
    },
    {
        "content": "<p>There was a quick option. Does it seem okay to start with (till better widget code is written).</p>\n<p><a href=\"/user_uploads/3121/XPbRj_HEPizVGHvTC8xlzH2h/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/XPbRj_HEPizVGHvTC8xlzH2h/image.png\" title=\"image.png\"><img data-original-dimensions=\"863x743\" src=\"/user_uploads/thumbnail/3121/XPbRj_HEPizVGHvTC8xlzH2h/image.png/840x560.webp\"></a></div>",
        "id": 469090396,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725974662
    },
    {
        "content": "<p>Actually <code>addSuggestions</code> is not much code. I will also work on a less hacky solution.</p>",
        "id": 469091072,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725974814
    },
    {
        "content": "<p>Somewhere out there there is a modification to this code that actually tries the tactics in the background and only reports the ones that worked. I forget who did this.</p>",
        "id": 469095043,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725975648
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469095043\">said</a>:</p>\n<blockquote>\n<p>Somewhere out there there is a modification to this code that actually tries the tactics in the background and only reports the ones that worked. I forget who did this.</p>\n</blockquote>\n<p>Will add this feature. I have done this sort of things a few times.</p>",
        "id": 469095736,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725975804
    },
    {
        "content": "<p>Indeed such a check is an example in the same repository where the lean_search code currently lives: <a href=\"https://github.com/siddhartha-gadgil/MetaExamples/blob/main/MetaExamples/CheckTactic.lean\">https://github.com/siddhartha-gadgil/MetaExamples/blob/main/MetaExamples/CheckTactic.lean</a></p>",
        "id": 469096792,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725975978
    },
    {
        "content": "<p>The above actually checks if the goal is closed. I mean a mild modification of that.</p>",
        "id": 469096987,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725976027
    },
    {
        "content": "<p>(Thank you for making this structured in a way we can use in Neovim land as well Siddhartha! I can confirm it already does <em>something</em> pretty reasonable:</p>\n<p><a href=\"/user_uploads/3121/ZyQMV2vQA3wIZZINYCHQIsj_/Screenshot-2024-09-10-at-11.12.07.png\">Screenshot-2024-09-10-at-11.12.07.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ZyQMV2vQA3wIZZINYCHQIsj_/Screenshot-2024-09-10-at-11.12.07.png\" title=\"Screenshot-2024-09-10-at-11.12.07.png\"><img data-original-dimensions=\"1280x793\" src=\"/user_uploads/thumbnail/3121/ZyQMV2vQA3wIZZINYCHQIsj_/Screenshot-2024-09-10-at-11.12.07.png/840x560.webp\"></a></div><p>and whenever we have something we know we need anyhow I think I can make it look essentially the same as your VSCode screenshot.)</p>",
        "id": 469126154,
        "sender_full_name": "Julian Berman",
        "timestamp": 1725981213
    },
    {
        "content": "<p>The filter seems to work though probably some cases are still wrong. Here is the view of suggested tactics in an example (I clicked many that passed the filter and they worked).<br>\n<a href=\"/user_uploads/3121/aZq59ZewSHk3Q5yOO5idQhS8/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/aZq59ZewSHk3Q5yOO5idQhS8/image.png\" title=\"image.png\"><img data-original-dimensions=\"1737x876\" src=\"/user_uploads/thumbnail/3121/aZq59ZewSHk3Q5yOO5idQhS8/image.png/840x560.webp\"></a></div>",
        "id": 469146393,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725985507
    },
    {
        "content": "<p>As my day gets over (in India), here is the code so far. Tomorrow I will put in a separate repository and try to make a few improvements.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://leansearch.net/api/search\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.replace</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"s2\">\"%20\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"?query={s'}&amp;num_results={num_results}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO.Process.output</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"curl\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-X\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"GET\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">]}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Json.parse</span><span class=\"w\"> </span><span class=\"n\">s.stdout</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">js.getArr</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">js</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_name\"</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_type\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"docstring\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"doc_url\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"kind\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">query</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jsArr</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">jsArr.filterMap</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toCommandSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"{doc}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"#check {sr.name}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" -- {s}\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">{data}\"</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toTermSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" (type: {type})\"</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.name</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toTacticSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"apply {sr.name}\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"have : {type} := {sr.name}\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"rw [{sr.name}]\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"rw [← {sr.name}]\"</span><span class=\"w\"> </span><span class=\"o\">}]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"n\">SearchResult.toCommandSuggestion</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryTermSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"n\">SearchResult.toTermSuggestion</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryTacticSuggestionGroups</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\">  </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fullName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"{sr.name} (type: {type})\"</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sr.name</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">fullName</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sr.toTacticSuggestions</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">defaultTerm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">type.hasExprMVar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">mkAppM</span><span class=\"w\"> </span><span class=\"ss\">``sorryAx</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">type</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``false</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``True.intro</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``True.intro</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">checkTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">target</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)(</span><span class=\"n\">tac</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"n\">TermElabM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">withoutModifyingState</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">try</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">goals</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">        </span><span class=\"n\">withoutErrToSorry</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">Elab.runTactic</span><span class=\"w\"> </span><span class=\"n\">goal.mvarId</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">tac</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">goals.length</span>\n<span class=\"w\">    </span><span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#lean_search\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">lean_search_cmd</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Command.liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">lean_search</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"lean_search#\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kd\">@[</span><span class=\"n\">term_elab</span><span class=\"w\"> </span><span class=\"n\">lean_search_term</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchTermImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TermElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">lean_search</span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryTermSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark.\"</span>\n<span class=\"w\">    </span><span class=\"n\">defaultTerm</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search_tactic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"lean_search?\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"kd\">@[</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">lean_search_tactic</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchTacticImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">withMainContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"n\">lean_search</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainTarget</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestionGroups</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryTacticSuggestionGroups</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">suggestionGroups</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">sg.filterM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sugTxt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.suggestion</span>\n<span class=\"w\">          </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sugTxt</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">          </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">string</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">            </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Checking tactic: {s}\"</span>\n<span class=\"w\">            </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Target: {← getMainTarget}\"</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">runParserCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ss\">`tactic</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">            </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">            </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">checkTactic</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">              </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">?.</span><span class=\"n\">isSome</span>\n<span class=\"w\">            </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.error</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Error: {e} while obtaining syntax tree\"</span>\n<span class=\"w\">              </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">        </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"From: {name}\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Lean Search Examples</span>\n\n<span class=\"cm\">An example of using the leansearch API. The search is triggered when the sentence ends with a full stop (period) or a question mark.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"bp\">#</span><span class=\"n\">lean_search</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many odd numbers\"</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lean_search</span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many odd numbers\"</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">lean_search</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"s2\">\"If a natural number n is less than m, then the successor of n is less than the successor of m\"</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 469147761,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1725985795
    },
    {
        "content": "<p>Suggestions: </p>\n<ul>\n<li>Just use <code>#lean_search</code> in all three positions. In each case it is transient, and about to disappear again. I appreciate this is not consonant with <code>exact?</code> and <code>simp?</code>, but the benefit is a user not having to learn (or distinguish) the punctuation required in different locations.</li>\n<li>Change <code>lean_search</code> to <code>leansearch</code> to match the URL?</li>\n<li>Can we add to the warning the text \"Note this command sends your query to an external service at <a href=\"https://leansearch.net/\">https://leansearch.net/</a>.\" This both warns users about potential privacy / data use issues, and gives more visibility to the people providing the backend!</li>\n<li>Reduce the default number of results, perhaps?</li>\n</ul>",
        "id": 469230515,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726009762
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469095736\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469095043\">said</a>:</p>\n<blockquote>\n<p>Somewhere out there there is a modification to this code that actually tries the tactics in the background and only reports the ones that worked. I forget who did this.</p>\n</blockquote>\n<p>Will add this feature. I have done this sort of things a few times.</p>\n</blockquote>\n<p>Oops, my apologies for saying \"I forget who did this\" to the person who did this!!! <span aria-label=\"woman facepalming\" class=\"emoji emoji-1f926-200d-2640\" role=\"img\" title=\"woman facepalming\">:woman_facepalming:</span></p>",
        "id": 469230637,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726009822
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Thanks for all the suggestions. I agree with them and have implemented them. I have also made the number of results configurable, but have a dummy for now so things can work in a single file, pasted below.</p>\n<p>I will create a separate repository not dependent on Mathlib for this. Should I add you as a collaborator? To keep in sync with toolchain updates I assume someone from the FRO should have access.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"c1\">-- import MetaExamples.Basic -- commented out for single file testing</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"https://leansearch.net/api/search\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.replace</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"s2\">\"%20\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">apiUrl</span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"?query={s'}&amp;num_results={num_results}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO.Process.output</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"curl\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-X\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"GET\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">]}</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">js</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Json.parse</span><span class=\"w\"> </span><span class=\"n\">s.stdout</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">js.getArr</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">get</span><span class=\"bp\">!</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"c1\">-- def queryNum : CoreM Nat := do</span>\n<span class=\"c1\">--   return leansearch.queries.get (← getOptions)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">queryNum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"c1\">-- fallback for single file testing</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">js</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Json</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_name\"</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"formal_type\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"docstring\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"doc_url\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">js.getObjValAs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"s2\">\"kind\"</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toOption</span>\n<span class=\"w\">      </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">doc_url</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">docurl</span><span class=\"bp\">?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"bp\">?</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">query</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">jsArr</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryJson</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">jsArr.filterMap</span><span class=\"w\"> </span><span class=\"n\">ofJson</span><span class=\"bp\">?</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toCommandSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.docString</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">doc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"{doc}</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"#check {sr.name}\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" -- {s}\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"</span><span class=\"se\">\\n</span><span class=\"s2\">{data}\"</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toTermSuggestion</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">postInfo</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\" (type: {type})\"</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sr.name</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">toTacticSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sr</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"apply {sr.name}\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"have : {type} := {sr.name}\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"rw [{sr.name}]\"</span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"o\">{</span><span class=\"n\">suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"rw [← {sr.name}]\"</span><span class=\"w\"> </span><span class=\"o\">}]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[]</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">SearchResult</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"n\">SearchResult.toCommandSuggestion</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryTermSuggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"n\">SearchResult.toTermSuggestion</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">getQueryTacticSuggestionGroups</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)(</span><span class=\"n\">num_results</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\">  </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">TryThis.Suggestion</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">searchResults</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">SearchResult.query</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">num_results</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">searchResults.map</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fullName</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sr.type</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"{sr.name} (type: {type})\"</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sr.name</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">fullName</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sr.toTacticSuggestions</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">defaultTerm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">type.hasExprMVar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">mkAppM</span><span class=\"w\"> </span><span class=\"ss\">``sorryAx</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">type</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``false</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``True.intro</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``True.intro</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">checkTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">target</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)(</span><span class=\"n\">tac</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"n\">TermElabM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">withoutModifyingState</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">try</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">goals</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">        </span><span class=\"n\">withoutErrToSorry</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">Elab.runTactic</span><span class=\"w\"> </span><span class=\"n\">goal.mvarId</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">tac</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">goals.length</span>\n<span class=\"w\">    </span><span class=\"n\">catch</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Command</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leansearch_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#leansearch\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n<span class=\"kd\">@[</span><span class=\"n\">command_elab</span><span class=\"w\"> </span><span class=\"n\">leansearch_cmd</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommandElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Command.liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">command</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryCommandSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">queryNum</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark. Note this command sends your query to an external service at https://leansearch.net/.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leansearch_term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#leansearch\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kd\">@[</span><span class=\"n\">term_elab</span><span class=\"w\"> </span><span class=\"n\">leansearch_term</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchTermImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TermElab</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getQueryTermSuggestions</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">queryNum</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">suggestions</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"Lean Search Results\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark. Note this command sends your query to an external service at https://leansearch.net/.\"</span>\n<span class=\"w\">    </span><span class=\"n\">defaultTerm</span><span class=\"w\"> </span><span class=\"n\">expectedType</span><span class=\"bp\">?</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leansearch_tactic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#leansearch\"</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"kd\">@[</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">leansearch_tactic</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">leanSearchTacticImpl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">withMainContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.getString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">s.endsWith</span><span class=\"w\"> </span><span class=\"s2\">\"?\"</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainTarget</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">suggestionGroups</span><span class=\"w\"> </span><span class=\"bp\">←</span>\n<span class=\"w\">          </span><span class=\"n\">getQueryTacticSuggestionGroups</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">queryNum</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">suggestionGroups</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\">  </span><span class=\"n\">sg.filterM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sugTxt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s.suggestion</span>\n<span class=\"w\">          </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">sugTxt</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">          </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">string</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">            </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Checking tactic: {s}\"</span>\n<span class=\"w\">            </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Target: {← getMainTarget}\"</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">runParserCategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"ss\">`tactic</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">            </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">            </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.ok</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">checkTactic</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n<span class=\"w\">              </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">?.</span><span class=\"n\">isSome</span>\n<span class=\"w\">            </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except.error</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">!</span><span class=\"s2\">\"Error: {e} while obtaining syntax tree\"</span>\n<span class=\"w\">              </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">          </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">        </span><span class=\"n\">TryThis.addSuggestions</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"n\">sg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">header</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">!</span><span class=\"s2\">\"From: {name}\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"Lean search query should end with a full stop (period) or a question mark. Note this command sends your query to an external service at https://leansearch.net/.\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Lean Search Examples</span>\n\n<span class=\"cm\">An example of using the leansearch API. The search is triggered when the sentence ends with a full stop (period) or a question mark.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many odd numbers\"</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many odd numbers\"</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">leansearch</span><span class=\"w\"> </span><span class=\"s2\">\"If a natural number n is less than m, then the successor of n is less than the successor of m\"</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 469260954,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726022841
    },
    {
        "content": "<p>Exciting! </p>\n<p><span class=\"user-mention\" data-user-id=\"116045\">@Jesse Michael Han</span>, I see that </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">www</span><span class=\"bp\">.</span><span class=\"n\">moogle</span><span class=\"bp\">.</span><span class=\"n\">ai</span><span class=\"bp\">/</span><span class=\"n\">api</span><span class=\"bp\">/</span><span class=\"n\">search'</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">content</span><span class=\"bp\">-</span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">application</span><span class=\"bp\">/</span><span class=\"n\">json'</span><span class=\"w\">  </span><span class=\"c1\">--data-raw '[{\"isFind\":false,\"contents\":\"infinitely many primes\"}]'</span>\n</code></pre></div>\n<p>works. Are we okay to send queries to that from an in-VSCode command?</p>\n<p>If so, <code>#moogle</code> can hopefully use the same infrastructure.</p>",
        "id": 469265921,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726024621
    },
    {
        "content": "<p>Awesome, I love that the tactic suggestions are filtered by applicability!</p>",
        "id": 469266116,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726024746
    },
    {
        "content": "<p>yes! we are actually about to add support for it in a form factor similar to Loogle in the official VSCode extension as well</p>",
        "id": 469266881,
        "sender_full_name": "Jesse Michael Han",
        "timestamp": 1726024924
    },
    {
        "content": "<p>(updates to the search index and search quality coming soon too)</p>",
        "id": 469266953,
        "sender_full_name": "Jesse Michael Han",
        "timestamp": 1726024946
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>. There are still some stray <code>logInfo</code>.</p>",
        "id": 469267546,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726025201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469267546\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span>. There are still some stray <code>logInfo</code>.</p>\n</blockquote>\n<p>Oops. I will clean up and also create the new repository.</p>",
        "id": 469267726,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726025279
    },
    {
        "content": "<p>I suggest the following order of operations:</p>\n<ul>\n<li>create a repo under your account</li>\n<li>add at least me with admin access</li>\n<li>make a PR to add this to Mathlib's imports</li>\n<li>discussion ensues...!</li>\n<li>assuming that we decide to proceed (I hope so), we can later migrate the repo to <code>leanprover-community</code> if that works for you.</li>\n</ul>",
        "id": 469267805,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726025290
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469267805\">said</a>:</p>\n<blockquote>\n<p>I suggest the following order of operations:</p>\n<ul>\n<li>create a repo under your account</li>\n<li>add at least me with admin access</li>\n<li>make a PR to add this to Mathlib's imports</li>\n<li>discussion ensues...!</li>\n<li>assuming that we decide to proceed (I hope so), we can later migrate the repo to <code>leanprover-community</code> if that works for you.</li>\n</ul>\n</blockquote>\n<p>Perfect.</p>",
        "id": 469267884,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726025315
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<ul>\n<li>I created a repository at <a href=\"https://github.com/siddhartha-gadgil/LeanSearchClient.git\">https://github.com/siddhartha-gadgil/LeanSearchClient.git</a> and invited you as a collaborator (I assume I can make you an admin only once you accept).</li>\n<li>I have made a pull request: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16695\">https://github.com/leanprover-community/mathlib4/pull/16695</a></li>\n</ul>\n<p>I am waiting CI but locally stuff is running fine.</p>",
        "id": 469297283,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726037371
    },
    {
        "content": "<p>(you linked to the PR twice, first link should be the repo)</p>",
        "id": 469301097,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726038686
    },
    {
        "content": "<p>I've initiated a discussion amongst the mathlib maintainers about the PR, specifically about allowing a new dependency. I think this one is quite low stakes, so hope that it will be okay.</p>",
        "id": 469302338,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726038967
    },
    {
        "content": "<p>I moved the examples file to <code>test/</code> and now CI is giving the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchExamples</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">produced</span><span class=\"o\">:</span>\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchExamples</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">LeanSearchClient'</span>\n</code></pre></div>\n<p>But things run file locally. This may be a CI configuration issue.</p>",
        "id": 469365964,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726053003
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/VJC8IOAeRF2fzWjZUbTyU21Z/leansearch_interactivecode_demo.png\">leansearch_interactivecode_demo.png</a><br>\nI've opened a PR to display the suggestions as clickable and hoverable expressions in the infoview: <a href=\"https://github.com/siddhartha-gadgil/LeanSearchClient/pull/1\">https://github.com/siddhartha-gadgil/LeanSearchClient/pull/1</a>.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/VJC8IOAeRF2fzWjZUbTyU21Z/leansearch_interactivecode_demo.png\" title=\"leansearch_interactivecode_demo.png\"><img data-original-dimensions=\"1648x370\" src=\"/user_uploads/thumbnail/3121/VJC8IOAeRF2fzWjZUbTyU21Z/leansearch_interactivecode_demo.png/840x560.webp\"></a></div>",
        "id": 469405406,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1726062892
    },
    {
        "content": "<p>A potential downside is that only suggestions that elaborate within the current scope get displayed, and the rest get discarded.</p>",
        "id": 469405665,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1726062955
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"303675\">@Anand Rao Tadipatri</span> It looks very nice but adds to the complexity especially of dependencies. If Mathlib is to depend on LeanSearchClient which depends on ProofWidgets we can easily have version clashes.</p>\n<p>It is not obvious to me that the extra info is that useful to a user. A user is looking for a theorem and should be able to see from the name and type whether the theorem is useful.</p>\n<p>For now I will leave the PR pending and once the discussion for the simpler form takes off this can be discussed based on that conversation.</p>",
        "id": 469447817,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726070309
    },
    {
        "content": "<p>We're going to have to learn to deal with diamond dependencies one day, but I guess not today. :-)</p>",
        "id": 469535524,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726107067
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469365964\">said</a>:</p>\n<blockquote>\n<p>I moved the examples file to <code>test/</code> and now CI is giving the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchExamples</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">produced</span><span class=\"o\">:</span>\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchExamples</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"kn\">prefix</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">LeanSearchClient'</span>\n</code></pre></div>\n<p>But things run file locally. This may be a CI configuration issue.</p>\n</blockquote>\n<p>Could you push or PR something so I can look?</p>",
        "id": 469535980,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726107210
    },
    {
        "content": "<p>The same PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16695\">https://github.com/leanprover-community/mathlib4/pull/16695</a> is now broken and gives the error message I mentioned.</p>",
        "id": 469536328,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726107328
    },
    {
        "content": "<p>The previous commit on that was fine.</p>",
        "id": 469536353,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726107337
    },
    {
        "content": "<p>I'm cleaning up now.</p>",
        "id": 469536510,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726107463
    },
    {
        "content": "<p>Will push shortly</p>",
        "id": 469536516,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726107466
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>, <a href=\"https://github.com/siddhartha-gadgil/LeanSearchClient/pull/2\">https://github.com/siddhartha-gadgil/LeanSearchClient/pull/2</a></p>",
        "id": 469537869,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726108174
    },
    {
        "content": "<p>Thanks. I have merged the PR, updated the Mathlib PR to use the newer version and pushed.</p>",
        "id": 469538282,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726108453
    },
    {
        "content": "<p>Let's remove the test file in Mathlib, now that CI is running that same test upstream.</p>",
        "id": 469538875,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726108845
    },
    {
        "content": "<p>Sounds good. Will do so.</p>",
        "id": 469538925,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726108882
    },
    {
        "content": "<p>I have removed and pushed. Hope CI runs fine now.</p>",
        "id": 469539010,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726108928
    },
    {
        "content": "<p>Okay, we should work out where this should be imported.</p>",
        "id": 469539185,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726109058
    },
    {
        "content": "<p>Let's add this in <code>Mathlib.Tactic.Common</code>.</p>",
        "id": 469539222,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726109089
    },
    {
        "content": "<p>Otherwise, I think we are okay. (Discussion amongst maintainers was positive.)</p>",
        "id": 469539266,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726109119
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469539222\">said</a>:</p>\n<blockquote>\n<p>Let's add this in <code>Mathlib.Tactic.Common</code>.</p>\n</blockquote>\n<p>Do you mean so that the command is available without <code>import LeanSearchClient</code>?</p>",
        "id": 469539349,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726109163
    },
    {
        "content": "<p>yes</p>",
        "id": 469539357,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726109169
    },
    {
        "content": "<p>I will add this.</p>",
        "id": 469539360,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726109173
    },
    {
        "content": "<p>Added and pushed.</p>",
        "id": 469539619,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726109306
    },
    {
        "content": "<p>Merged!</p>",
        "id": 469550835,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726115098
    },
    {
        "content": "<p>As soon as it lands and I've tested it on <a href=\"https://github.com/leanprover-community/mathlib4/tree/master\">branch#master</a>, I propose moving it to leanprover-community and updating the lakefile.</p>",
        "id": 469550877,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726115126
    },
    {
        "content": "<p>Then <a href=\"https://loogle.lean-lang.org/\">#loogle</a> and #moogle? :-)</p>",
        "id": 469550891,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726115135
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469550877\">said</a>:</p>\n<blockquote>\n<p>As soon as it lands and I've tested it on <a href=\"https://github.com/leanprover-community/mathlib4/tree/master\">branch#master</a>, I propose moving it to leanprover-community and updating the lakefile.</p>\n</blockquote>\n<p>Fine with me. I believe that I need to be made a member of leanprover-community to transfer it. If there is some other way that is also fine.</p>",
        "id": 469552404,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726115912
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469550891\">said</a>:</p>\n<blockquote>\n<p>Then <a href=\"https://loogle.lean-lang.org/\">#loogle</a> and #moogle? :-)</p>\n</blockquote>\n<p>Sure, if they provide JSON APIs.</p>",
        "id": 469552429,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726115928
    },
    {
        "content": "<p>One step we missed: <a href=\"https://github.com/leanprover-community/mathlib4/pull/16717\">#16717</a></p>",
        "id": 469569564,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726122613
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>, see my message <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469265921\">above</a> about the Moogle API endpoint, and Jesse's response approving that we use it.</p>",
        "id": 469569642,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726122635
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469569642\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span>, see my message <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469265921\">above</a> about the Moogle API endpoint, and Jesse's response approving that we use it.</p>\n</blockquote>\n<p>I will work on this. I think the type is useful to users so I will pick that from the environment (moogle does not seem to provide it). Otherwise the code can be mostly the same (should use a common abstraction for the core of search results).</p>",
        "id": 469571404,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726123086
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469552429\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469550891\">said</a>:</p>\n<blockquote>\n<p>Then <a href=\"https://loogle.lean-lang.org/\">#loogle</a> and #moogle? :-)</p>\n</blockquote>\n<p>Sure, if they provide JSON APIs.</p>\n</blockquote>\n<p>Loogle does: <a href=\"https://loogle.lean-lang.org/json?q=List%20?a%20-%3E%20(?a%20-%3E%20?b)%20-%3E%20List%20?b\">https://loogle.lean-lang.org/json?q=List%20?a%20-%3E%20(?a%20-%3E%20?b)%20-%3E%20List%20?b</a></p>\n<p>(Although for loogle I hope that eventually it can just run locally, so that it works offline, uses the precise version that you are using, and can index more than just mathlib.)</p>",
        "id": 469585583,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726127147
    },
    {
        "content": "<p>The<code>#moogle</code> cases are implemented and a PR is at <a href=\"https://github.com/siddhartha-gadgil/LeanSearchClient/pull/3\">https://github.com/siddhartha-gadgil/LeanSearchClient/pull/3</a> (PR for the client still).</p>",
        "id": 469613891,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726133193
    },
    {
        "content": "<p>The names are a bit asymetrical (default name for leansearch). I will fix this.</p>",
        "id": 469614028,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726133223
    },
    {
        "content": "<p>Names are now symmetric. I think it is ready to merge.</p>",
        "id": 469615664,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726133647
    },
    {
        "content": "<p>Left some minor comments.</p>",
        "id": 469616209,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726133792
    },
    {
        "content": "<p>The bigger refactor would be to combine the 6 elaboration functions into 1, with suitable switching.</p>",
        "id": 469616310,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726133811
    },
    {
        "content": "<p>e.g. pulling out the \"if ends with . or ?, else warning\" could be abstracted into a single function.</p>",
        "id": 469616394,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726133831
    },
    {
        "content": "<p>Not essential, but the code duplication costs in the long run.</p>",
        "id": 469616479,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726133850
    },
    {
        "content": "<p>I have made the minor changes. I will gradually get rid of the code duplication - there are too many pairs of functions among other things.</p>",
        "id": 469631932,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726137740
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I have avoided many methods that were pairs for the two cases. Some duplication remains - for example the <code>if</code> statements but may be a bit complex to remove as the types are different and need various typeclasses (to allow throw, TryThis etc).</p>\n<p>If things seem fine please merge. I will make a fresh PR on Mathlib updating this dependency.</p>",
        "id": 469659406,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726144285
    },
    {
        "content": "<p>I've merged.</p>",
        "id": 469836923,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726198546
    },
    {
        "content": "<p>You shouldn't need to make a PR to mathlib. It automatically bumps its dependencies every few hours.</p>",
        "id": 469837059,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726198564
    },
    {
        "content": "<p>I updated the github organization in the lakefile at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16750\">#16750</a></p>",
        "id": 469837128,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726198581
    },
    {
        "content": "<p>Once this lands it may be worth posting about the new commands in \"announce\". I can do so following the <a href=\"https://github.com/leanprover-community/LeanSearchClient/blob/main/README.md\">README</a>.</p>",
        "id": 469850561,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726203199
    },
    {
        "content": "<p>Definitely!</p>",
        "id": 469862560,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726208487
    },
    {
        "content": "<p>Are you planning on doing <code>#loogle</code> too? If we even get a locally running <code>#loogle</code> of course we'll then remove it.</p>",
        "id": 469862655,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726208508
    },
    {
        "content": "<p>(If so, it would be good to include the \"help text\" from <a href=\"http://loogle.com\">loogle.com</a> in the incomplete input warning.)</p>",
        "id": 469862790,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726208535
    },
    {
        "content": "<p>Yes, I will do loogle too. I assume you mean the text at the top: \"You can use Loogle from witin the Lean4 VSCode language extension using (by default) Ctrl-K Ctrl-S. You can also try the <a href=\"https://github.com/nomeata/loogle\">CLI version</a>, the <a href=\"https://marketplace.visualstudio.com/items?itemName=ShreyasSrinivas.loogle-lean\">Loogle VS Code extension</a>, the <a href=\"https://github.com/Julian/lean.nvim#features\"><code>lean.nvim</code> integration</a> or the <a href=\"https://github.com/nomeata/loogle#zulip-bot\">Zulip bot</a>.\"</p>",
        "id": 469863223,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726208643
    },
    {
        "content": "<p>No, I meant the entire usage text (5 bullet points)</p>",
        "id": 469864514,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726208938
    },
    {
        "content": "<p>Sure. I will include it.</p>",
        "id": 469864762,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726208989
    },
    {
        "content": "<p>Just to clarify, here is what I see on the loogle website:</p>\n<div class=\"codehilite\" data-code-language=\"Markdown\"><pre><span></span><code><span class=\"gu\">## Usage</span>\nLoogle finds definitions and lemmas in various ways:\n\n<span class=\"k\">1.</span> By constant:\n🔍 Real.sin\nfinds all lemmas whose statement somehow mentions the sine function.\n\n<span class=\"k\">2.</span> By lemma name substring:\n🔍 \"differ\"\nfinds all lemmas that have \"differ\" somewhere in their lemma name.\n\n<span class=\"k\">3.</span> By subexpression:\n🔍 _ * (_ ^ _)\nfinds all lemmas whose statements somewhere include a product where the second argument is raised to some power.\n\nThe pattern can also be non-linear, as in\n🔍 Real.sqrt ?a * Real.sqrt ?a\n\nIf the pattern has parameters, they are matched in any order. Both of these will find List.map:\n🔍 (?a -&gt; ?b) -&gt; List ?a -&gt; List ?b\n🔍 List ?a -&gt; (?a -&gt; ?b) -&gt; List ?b\n\n<span class=\"k\">4.</span> By main conclusion:\n🔍 |- tsum _ = _ * tsum _\nfinds all lemmas where the conclusion (the subexpression to the right of all → and ∀) has the given shape.\n\nAs before, if the pattern has parameters, they are matched against the hypotheses of the lemma in any order; for example,\n🔍 |- _ &lt; _ → tsum _ &lt; tsum _\nwill find tsum_lt_tsum even though the hypothesis f i &lt; g i is not the last.\n\nIf you pass more than one such search filter, separated by commas Loogle will return lemmas which match all of them. The search\n🔍 Real.sin, \"two\", tsum, _ * <span class=\"ge\">_, _</span> ^ <span class=\"ge\">_, |- _</span> &lt; _ → _\nwoould find all lemmas which mention the constants Real.sin and tsum, have \"two\" as a substring of the lemma name, include a product and a power somewhere in the type, and have a hypothesis of the form _ &lt; _ (if there were any such lemmas). Metavariables (?a) are assigned independently in each filter.\n</code></pre></div>\n<p>Shall I include all of this?</p>",
        "id": 469865213,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726209137
    },
    {
        "content": "<p>I think so.</p>",
        "id": 469867806,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726209739
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I implemented the loogle search on a branch, and I feel the same interface does not work well at all. </p>\n<p>The main difference is for natural language queries \"there are no stupid questions\" - anything has some answer, at worst not a useful one. On the other hand most Loogle queries are simply wrong syntax. So one really has to be able to interact well with the error messages.</p>\n<p>For example on Loogle I typed \"List ?a → (?a → ?b) → List b\" and got the error \"unknown identifier 'b'\". From that it is easy to see that the query should be \"\"List ?a → (?a → ?b) → List ?b\". </p>\n<p>I can of course include the error message but the code will be different in many places from the other two. I would be happy to do this given a documented JSON API if the loogle developers would like such an interface.</p>",
        "id": 469923861,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223124
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> I used the API as is last year, there are only four fields in the output</p>",
        "id": 469924510,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223307
    },
    {
        "content": "<p>You can see them all here: <a href=\"https://loogle.lean-lang.org/json?q=Real.sin\">https://loogle.lean-lang.org/json?q=Real.sin</a></p>",
        "id": 469924617,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223346
    },
    {
        "content": "<p>I saw the fields. But these are the four fields in the case of success.</p>",
        "id": 469924730,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223384
    },
    {
        "content": "<p>and these for the error case : <a href=\"https://loogle.lean-lang.org/json?q=nonsense\">https://loogle.lean-lang.org/json?q=nonsense</a></p>",
        "id": 469924739,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223387
    },
    {
        "content": "<p>I think I got all the success and error cases by clicking on the examples in the error page and then manipulating them to get the error cases.<br>\n<a href=\"https://loogle.lean-lang.org/json?q=|-+tsum+_+%3D+_+*+*tsum+_\">https://loogle.lean-lang.org/json?q=|-+tsum+_+%3D+_+*+*tsum+_</a></p>",
        "id": 469925271,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223541
    },
    {
        "content": "<p>I see.<br>\nThe point remains that Loogle is a different sort of beast from the natural language searches. So there will have to be a discussion on the interface and the code copied and modified.</p>",
        "id": 469925295,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223552
    },
    {
        "content": "<p>Happy to do this if people find it useful (even if temporarily, i.e., till the proper local loogle comes along).</p>",
        "id": 469925401,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223599
    },
    {
        "content": "<p>For implementing the loogle extension I followed the principle that there are either \"hits\" or \"suggestions\". I treated everything else as a generic error</p>",
        "id": 469925402,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223601
    },
    {
        "content": "<p><a href=\"https://github.com/Shreyas4991/loogle-lean/blob/main/src/loogle-api.ts\">https://github.com/Shreyas4991/loogle-lean/blob/main/src/loogle-api.ts</a></p>",
        "id": 469925691,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223697
    },
    {
        "content": "<p>Sorry this one: <a href=\"https://github.com/Shreyas4991/loogle-lean/blob/main/src/loogle-interface.ts\">https://github.com/Shreyas4991/loogle-lean/blob/main/src/loogle-interface.ts</a></p>",
        "id": 469925769,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223730
    },
    {
        "content": "<p>The core abstraction is also different here. In the other cases I had a <code>SearchResult</code> structure. Now I should have an inductive type for the two cases.</p>",
        "id": 469925801,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223736
    },
    {
        "content": "<p>The above info is enough to implement. Thanks.</p>",
        "id": 469925856,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223754
    },
    {
        "content": "<p>I will simply wait for a consensus on whether this is worthwhile.</p>",
        "id": 469925971,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726223785
    },
    {
        "content": "<p>Specifically the function you want to look for is loogle-interface.ts is <a href=\"https://github.com/Shreyas4991/loogle-lean/blob/aeda70a059589da9313a158ac4f0453c8ca1e17f/src/loogle-interface.ts#L65\">processLoogleJson</a></p>",
        "id": 469926476,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726223940
    },
    {
        "content": "<p>I would <em>definitely</em> appreciate <code>#loogle</code>. I use it far more than the natural language searches.</p>",
        "id": 469942062,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1726227455
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469942062\">said</a>:</p>\n<blockquote>\n<p>I would <em>definitely</em> appreciate <code>#loogle</code>. I use it far more than the natural language searches.</p>\n</blockquote>\n<p>Will implement now and ask for feedback on the interface.</p>",
        "id": 469945921,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726228497
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> : since I have some experience with the loogle API, I could make a PR to your repository if it is welcome</p>",
        "id": 469953751,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726230535
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469953751\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> : since I have some experience with the loogle API, I could make a PR to your repository if it is welcome</p>\n</blockquote>\n<p>I am halfway through the implementation since it is mostly copy-paste and modify. Once I have a first draft up feel free to suggest and/or PR improvements.</p>",
        "id": 469954064,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726230654
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"https://leanprover.zulipchat.com#narrow/stream/113488-general/topic/LeanSearch/near/469942062\">said</a>:</p>\n<blockquote>\n<p>I would <em>definitely</em> appreciate <code>#loogle</code>. I use it far more than the natural language searches.</p>\n</blockquote>\n<p>AFAIK you can run loogle locally (but <code>#loogle</code> is a good idea nonetheless)</p>",
        "id": 469954352,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1726230734
    },
    {
        "content": "<p>Inside tactic mode, would loogle do substantially better than refine?</p>",
        "id": 469954674,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726230855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469954352\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"https://leanprover.zulipchat.com#narrow/stream/113488-general/topic/LeanSearch/near/469942062\">said</a>:</p>\n<blockquote>\n<p>I would <em>definitely</em> appreciate <code>#loogle</code>. I use it far more than the natural language searches.</p>\n</blockquote>\n<p>AFAIK you can run loogle locally (but <code>#loogle</code> is a good idea nonetheless)</p>\n</blockquote>\n<p>Running loogle locally is possible but it does take a bit to spin up its search cache so starting it up with <code>#loogle</code> is going to have quite a bit of latency depending on how good your machine is. I think if local loogle becomes a thing that people want to use we would need something like a loogle daemon that you can send queries to.</p>",
        "id": 469954866,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1726230946
    },
    {
        "content": "<p>As it is a couple of hours to implement, it seems the best option is to just implement <code>#loogle</code> and see what parts are used. Its use is also transient so code rot is not a real danger.</p>",
        "id": 469955097,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726231037
    },
    {
        "content": "<p>I use my extension largely to do a quick search and in-place insert as well as a quick mathlib doc search</p>",
        "id": 469955283,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726231102
    },
    {
        "content": "<p>A loogle command in tactics will probably do similar things. What's nice about exact? simp? etc is that they also take local context into account</p>",
        "id": 469955408,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726231150
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469955097\">said</a>:</p>\n<blockquote>\n<p>As it is a couple of hours to implement, it seems the best option is to just implement <code>#loogle</code> and see what parts are used. Its use is also transient so code rot is not a real danger.</p>\n</blockquote>\n<p>There are advantages to having a local loogle that a web loogle cannot provide though. For example you can search your own libraries/forks etc. and also at versions that upstream loogle does not currently have. So in general there is a motivation to have local loogle, it's just not something that someone has done because it's not easy</p>",
        "id": 469959029,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1726232228
    },
    {
        "content": "<p>The command syntax is implemented. I have three different outputs for three cases:</p>\n<ul>\n<li>Success: a <code>TryThis</code> as with the other search engines.</li>\n<li>Error and no suggestions: Error message and loogle instructions</li>\n<li>Error with suggestions: Error message, loogle instruction and a TryThis for a <code>#loogle</code> command for each suggestion.</li>\n</ul>\n<p>The lean code giving these cases is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"s2\">\"List ?a → ?b\"</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"s2\">\"nonsense\"</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"s2\">\"?a → ?b\"</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>\n<p>Here are screenshots of part of the infoview in the three cases.<br>\n<a href=\"/user_uploads/3121/acSYXaTaUPz1mQ0HWer6-Bk2/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/acSYXaTaUPz1mQ0HWer6-Bk2/image.png\" title=\"image.png\"><img data-original-dimensions=\"865x651\" src=\"/user_uploads/thumbnail/3121/acSYXaTaUPz1mQ0HWer6-Bk2/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/rKycVDRjIL6BvACC11R3ldRR/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/rKycVDRjIL6BvACC11R3ldRR/image.png\" title=\"image.png\"><img data-original-dimensions=\"865x651\" src=\"/user_uploads/thumbnail/3121/rKycVDRjIL6BvACC11R3ldRR/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/S2PN2XdAEN-MNxC9mVh0PFqF/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/S2PN2XdAEN-MNxC9mVh0PFqF/image.png\" title=\"image.png\"><img data-original-dimensions=\"865x651\" src=\"/user_uploads/thumbnail/3121/S2PN2XdAEN-MNxC9mVh0PFqF/image.png/840x560.webp\"></a></div><p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> any suggestions about the interface. The other cases are essentially copy-paste from this (and the earlier code).</p>",
        "id": 469959818,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726232496
    },
    {
        "content": "<ol>\n<li>Is the loogle usage Info presented every time?</li>\n</ol>",
        "id": 469960187,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232607
    },
    {
        "content": "<ol start=\"2\">\n<li>I think I have an idea to unify these interfaces with a single client side API</li>\n</ol>",
        "id": 469960285,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232633
    },
    {
        "content": "<ol start=\"3\">\n<li>You might want to show the declaration type in a new line. How does it work for theorem names?</li>\n</ol>",
        "id": 469960498,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232690
    },
    {
        "content": "<p>Especially ones with long type signatures?</p>",
        "id": 469960591,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232714
    },
    {
        "content": "<ol start=\"4\">\n<li>I love the idea of waiting for a \"go\" at the end before a search begins</li>\n</ol>",
        "id": 469960890,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232796
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469960498\">said</a>:</p>\n<blockquote>\n<ol start=\"3\">\n<li>You might want to show the declaration type in a new line. How does it work for theorem names?</li>\n</ol>\n</blockquote>\n<p>I feel that looks like \"#check\". In any case that aspect was discussed extensively for <code>#leansearch</code>. The failure cases are what are different here.</p>\n<p>Not to say one cannot discuss formatting common to all cases. But maybe that is best done once the features are announced.</p>",
        "id": 469960942,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726232810
    },
    {
        "content": "<p>For now we can focus on where loogle differs from the others.</p>",
        "id": 469961041,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726232840
    },
    {
        "content": "<p>By the way, the \"go\" is a replacement for ending with \".\" or \"?\" which makes sense for natural language but not loogle.</p>",
        "id": 469961183,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726232879
    },
    {
        "content": "<p>A good test for error with suggestions is \"sin\"</p>",
        "id": 469961266,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232901
    },
    {
        "content": "<p>Because there are many <code>sin</code> functions</p>",
        "id": 469961293,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232909
    },
    {
        "content": "<p>Also \"Measurable\"</p>",
        "id": 469961397,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726232946
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469961266\">said</a>:</p>\n<blockquote>\n<p>A good test for error with suggestions is \"sin\"</p>\n</blockquote>\n<p>Thanks for this. I wanted a good test. Here is the result:<br>\n<a href=\"/user_uploads/3121/waCXAhils3RpaJs9VjclWtsr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/waCXAhils3RpaJs9VjclWtsr/image.png\" title=\"image.png\"><img data-original-dimensions=\"865x651\" src=\"/user_uploads/thumbnail/3121/waCXAhils3RpaJs9VjclWtsr/image.png/840x560.webp\"></a></div>",
        "id": 469961510,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726232981
    },
    {
        "content": "<p>The clicking worked, so perhaps this feature is useful.</p>",
        "id": 469961625,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726233009
    },
    {
        "content": "<p>For example, after a click:<br>\n<a href=\"/user_uploads/3121/G56hMNeE9S1kEKuUBdUkzn70/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/G56hMNeE9S1kEKuUBdUkzn70/image.png\" title=\"image.png\"><img data-original-dimensions=\"846x248\" src=\"/user_uploads/thumbnail/3121/G56hMNeE9S1kEKuUBdUkzn70/image.png/840x560.webp\"></a></div>",
        "id": 469961779,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726233054
    },
    {
        "content": "<p>Another test is to disconnect the wifi and try it</p>",
        "id": 469961949,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726233106
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469961949\">said</a>:</p>\n<blockquote>\n<p>Another test is to disconnect the wifi and try it</p>\n</blockquote>\n<p>To test what?</p>",
        "id": 469962043,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726233126
    },
    {
        "content": "<p>The error message and latency will tell you whether curl is correctly set up</p>",
        "id": 469962057,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726233131
    },
    {
        "content": "<p>Fair enough, but I will leave that system level testing to the experts. I am just making a \"curl\" command assuming it works.</p>",
        "id": 469962275,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726233193
    },
    {
        "content": "<p>I am talking about the command is called from the program. Max retries, timeouts, etc can be configured</p>",
        "id": 469962532,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726233248
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469962532\">said</a>:</p>\n<blockquote>\n<p>I am talking about the command is called from the program. Max retries, timeouts, etc can be configured</p>\n</blockquote>\n<p>For this and the other parts too, I welcome PRs once the main logic is stable to make this robust. It is not something I will manage particularly well.</p>",
        "id": 469962760,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726233305
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>, I will have a look later today!</p>",
        "id": 469963046,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1726233380
    },
    {
        "content": "<blockquote>\n<p><code>#loogle \"nonsense\" go</code></p>\n</blockquote>\n<p>This syntax is groublesome, since loogle queries often contain quotes itself. Why not</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>\n<p>where everything until <code>go</code> becomes the query?</p>\n<p>Else you can also embed loogle’s syntax parser in your command:<br>\n<a href=\"https://github.com/nomeata/loogle/blob/master/Loogle/Find.lean#L255-L264\">https://github.com/nomeata/loogle/blob/master/Loogle/Find.lean#L255-L264</a></p>",
        "id": 469966097,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726234067
    },
    {
        "content": "<p>Reading the code, I think we can have one command and some optional arguments that then searches and returns results from one or more search engines. This can exist along side the service specific commands</p>",
        "id": 469966589,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469966097\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p><code>#loogle \"nonsense\" go</code></p>\n</blockquote>\n<p>This syntax is groublesome, since loogle queries often contain quotes itself. Why not</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>\n<p>where everything until <code>go</code> becomes the query?</p>\n<p>Else you can also embed loogle’s syntax parser in your command:<br>\n<a href=\"https://github.com/nomeata/loogle/blob/master/Loogle/Find.lean#L255-L264\">https://github.com/nomeata/loogle/blob/master/Loogle/Find.lean#L255-L264</a></p>\n</blockquote>\n<p>The simple answer is I don't know how to write a parser for what you suggest. If you have sample code I can try</p>",
        "id": 469966619,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726234214
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> : In this case, it seems sufficient to accept a term and convert it to a faithful string representation</p>",
        "id": 469966808,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234268
    },
    {
        "content": "<blockquote>\n<p>The simple answer is I don't know how to write a parser for what you suggest. If you have sample code I can try</p>\n</blockquote>\n<p>As linked, it’s just</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">turnstyle</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">patternIgnore</span><span class=\"o\">(</span><span class=\"s2\">\"⊢ \"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"|- \"</span><span class=\"o\">)</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">find_filter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">turnstyle</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">find_filters</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">find_filter</span><span class=\"o\">,</span><span class=\"bp\">*</span>\n</code></pre></div>\n<p>(although of course could be extended in the future, but then we can update the code.)</p>",
        "id": 469967075,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726234343
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> one downside of a single command: users may not want to share their queries with all searches (e.g., maybe they trust Loogle but not Moogle, etc.). I'm fairly certain this would be true for some people.</p>",
        "id": 469967261,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1726234407
    },
    {
        "content": "<p>In my idea, you'll have something like <code>#search loogle \"something\"</code> or <code>#search all \"something\"</code></p>",
        "id": 469967519,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234465
    },
    {
        "content": "<p>or even <code>#search [loogle, leansearch] \"something\"</code></p>",
        "id": 469967640,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234491
    },
    {
        "content": "<p>It makes me think <span class=\"user-mention\" data-user-id=\"320882\">@Damien Thomine</span> wanted to know how to ask Loogle for something whose <em>assumption</em> contains something. And indeed we noticed that <code>term turnstyle</code> didn’t seem to work.</p>",
        "id": 469967979,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1726234552
    },
    {
        "content": "<p>Yes, the turnstyle means “don’t look in subexpressions”, and is maybe not the best symbol given that people expect stuff to the left of it. But off-topic in this already long topic :-)</p>",
        "id": 469968341,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726234616
    },
    {
        "content": "<p>I think I can refactor this code and make it more systematic and provide a uniform front facing API</p>",
        "id": 469969002,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234731
    },
    {
        "content": "<p>And also separate the service specific aspects</p>",
        "id": 469969102,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234746
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> : Is this welcome?</p>",
        "id": 469969140,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234753
    },
    {
        "content": "<p>Also is the loogle thing merged?</p>",
        "id": 469969679,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234837
    },
    {
        "content": "<p>I don't see it yet</p>",
        "id": 469969718,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726234842
    },
    {
        "content": "<p>It is on a branch called loogle</p>",
        "id": 469969948,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726234882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469969140\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> : Is this welcome?</p>\n</blockquote>\n<p>I am getting dinner. Will reply in a bit</p>",
        "id": 469970363,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726234949
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> I don't know if you have looked at the code but it does separate to some extent the server queries and the elaboration. For example, the following is part of the code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">search_cmd</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"#leansearch\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">search_cmd</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"#moogle\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">search_cmd</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">search_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">search_cmd</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n</code></pre></div>\n<p>I am sure more streamlining can be done and PRs improving the code (without changing behaviour) are always welcome. The bigger streamlining is avoiding duplication between the command, term and tactic elaborators. I did not try this because it seemed to involve monad polymorphim with signature including <code>MonadLog</code> and maybe a typeclass that says we can lift from <code>MetaM</code>. Anyone who can do this correctly is welcome to PR.</p>\n<p>As for syntax, we definitely do not want a common search for leansearch/moogle and loogle as the queries are very different. What I have done (as in the code above) is not very different from <code>#search moogle</code> and <code>#search leansearch</code>. Yes, the \"all\" option is not there but especially in term/tactic a single word is more readable. </p>\n<p>For loogle I will work on <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>'s suggestion and try to use the same syntax as <code>#find</code>.</p>",
        "id": 469981330,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237082
    },
    {
        "content": "<p>(NB: It’s not the same syntax as <code>#find</code>. Loogle evolved out of <code>#find</code>, hence <code>find_filters</code> in the name above, but it should really be <code>loogle_filters</code> instead.)</p>",
        "id": 469981700,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726237193
    },
    {
        "content": "<p>I will call it <code>loogle_filters</code>.</p>\n<p>As you are here <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> what is the recommended way I get a string from this? Is <code>Syntax.reprint</code> fine?</p>",
        "id": 469982125,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237301
    },
    {
        "content": "<p>I mean just a string to pass on to Loogle.</p>",
        "id": 469982244,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237322
    },
    {
        "content": "<p>In loogle I use this code t turn <code>sugg</code> into a string, not sure if’s the best way of doing it</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">ppCategory</span><span class=\"w\"> </span><span class=\"ss\">``Find.find_filters</span><span class=\"w\"> </span><span class=\"n\">sugg</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">pretty</span>\n</code></pre></div>",
        "id": 469982999,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726237449
    },
    {
        "content": "<p>But <code>reprint</code> may be just as fine</p>",
        "id": 469983345,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726237567
    },
    {
        "content": "<p>I used your code above and it works perfectly.</p>",
        "id": 469983395,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237592
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> : the syntax needn't be different with a nice API design. Firstly, loogle still accepts name queries. Further, a common search command would read the server responses and determine which results to show. </p>\n<p>To get into more detail, what I am proposing is a  code org principle, where a common client API exists with middleware for handling each service. This not only provides users a uniform interface to use them, but also in the medium term provides developers or search tools an idea for the desired shape of their API endpoints</p>",
        "id": 469983578,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726237657
    },
    {
        "content": "<p>And there is certainly a case to be made for a common search result type with an alt parameter. For moogle and leansearch, this is their error message. For loogle this is a type with error messages and a suggestion list</p>",
        "id": 469983959,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726237778
    },
    {
        "content": "<p>I understand the principle, but here there are only two services and a small amount of code. Still if the code looks better I will happily accept a PR.</p>",
        "id": 469983967,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237782
    },
    {
        "content": "<p>I have used common code for the success case of both Leansearch/Moogle and Loogle. The failures have a different nature.</p>",
        "id": 469984136,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237827
    },
    {
        "content": "<p>So the syntax now looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">nonsense</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>",
        "id": 469984220,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726237852
    },
    {
        "content": "<p>Does the middle part accept all common loogle things? i.e. also searching with \"quotes\" and having multiple constraints separated by comma?</p>",
        "id": 469984536,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1726237938
    },
    {
        "content": "<p>I will finish something by tonight. (It's 16:31 in CEST right now). Maybe that will give you a better picture of what I mean</p>",
        "id": 469984576,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726237951
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/469984536\">said</a>:</p>\n<blockquote>\n<p>Does the middle part accept all common loogle things? i.e. also searching with \"quotes\" and having multiple constraints separated by comma?</p>\n</blockquote>\n<p>If you have a specific example I can test. But my syntax definition is the following, using Loogle's own syntax so I expect things should work the same.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"n\">turnstyle</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">patternIgnore</span><span class=\"o\">(</span><span class=\"s2\">\"⊢ \"</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"|- \"</span><span class=\"o\">)</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"n\">loogle_filter</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">turnstyle</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"n\">loogle_filters</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">loogle_filter</span><span class=\"o\">,</span><span class=\"bp\">*</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">loogle_cmd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"#loogle\"</span><span class=\"w\"> </span><span class=\"n\">loogle_filters</span><span class=\"w\"> </span><span class=\"s2\">\"go\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span>\n</code></pre></div>",
        "id": 469984966,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726238067
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"s2\">\"sin\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">|-</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>",
        "id": 469985059,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726238100
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/jPQOpGp3xtHlaI6yjb3mSOrG/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jPQOpGp3xtHlaI6yjb3mSOrG/image.png\" title=\"image.png\"><img data-original-dimensions=\"875x607\" src=\"/user_uploads/thumbnail/3121/jPQOpGp3xtHlaI6yjb3mSOrG/image.png/840x560.webp\"></a></div><p>Seems fine.</p>",
        "id": 469985325,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726238165
    },
    {
        "content": "<p>Thanks all for the suggestions. Now the term, tactic and command modes are implemented and PRed. Some examples of Syntax are the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">go</span>\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">nonsense</span><span class=\"w\"> </span><span class=\"n\">go</span>\n<span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"s2\">\"sin\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">|-</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"n\">go</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">Nat.succ_le_succ</span><span class=\"w\"> </span><span class=\"n\">go</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">go</span>\n</code></pre></div>\n<ul>\n<li>In case of success, there are code actions to replace with search results (<code>#check ...</code> for command search, the term for term search and whichever of <code>apply</code>, <code>have</code>, <code>rw</code> are valid for tactic search).</li>\n<li>In case of error, the Loogle instructions are given.</li>\n<li>In case of error with suggestions, there are also TryThis options for the suggestions.</li>\n<li>As with the <code>#moogle</code> and <code>#leansearch</code> commands, in tactic mode only valid tactics are shown (an advantage over a web search).</li>\n</ul>\n<p>For the examples given above, here are screenshots of the infoview:</p>\n<p><a href=\"/user_uploads/3121/3j1bB6t94X0yDkwWZAvEMLp2/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/3j1bB6t94X0yDkwWZAvEMLp2/image.png\" title=\"image.png\"><img data-original-dimensions=\"718x620\" src=\"/user_uploads/thumbnail/3121/3j1bB6t94X0yDkwWZAvEMLp2/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/L8xRqM3I0k1_VIHS9gMN0CCN/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/L8xRqM3I0k1_VIHS9gMN0CCN/image.png\" title=\"image.png\"><img data-original-dimensions=\"745x623\" src=\"/user_uploads/thumbnail/3121/L8xRqM3I0k1_VIHS9gMN0CCN/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/XwzkH8t0-wZAcj5MoKGlBiS-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/XwzkH8t0-wZAcj5MoKGlBiS-/image.png\" title=\"image.png\"><img data-original-dimensions=\"745x623\" src=\"/user_uploads/thumbnail/3121/XwzkH8t0-wZAcj5MoKGlBiS-/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/67gl33DMHUATZ-HfYZJI-jW7/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/67gl33DMHUATZ-HfYZJI-jW7/image.png\" title=\"image.png\"><img data-original-dimensions=\"720x324\" src=\"/user_uploads/thumbnail/3121/67gl33DMHUATZ-HfYZJI-jW7/image.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/BNaqwoT3CQGLqpmhA1CCZbcB/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/BNaqwoT3CQGLqpmhA1CCZbcB/image.png\" title=\"image.png\"><img data-original-dimensions=\"720x324\" src=\"/user_uploads/thumbnail/3121/BNaqwoT3CQGLqpmhA1CCZbcB/image.png/840x560.webp\"></a></div>",
        "id": 470000294,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726242012
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> The automatic updating of dependencies is not happening. Maybe it does it only for those in a list and LeanSearchClient has to be added? I can just make a PR for updating.</p>\n<p>Also <code>#loogle</code> is implemented and PRed. There was a fair amount of discussion and the syntax is as suggested by <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> (who also gave the code for the parser for this).</p>",
        "id": 470073769,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726277917
    },
    {
        "content": "<p>It looks like the automated job has been <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10858384340/job/30136293565#step:7:42\">hitting an error</a> when it tries to run <code>lake update</code>: <code>error: leanprover-community/LeanSearchClient: could not materialize package: dependency has no explicit source and was not found on Reservoir</code>. (Unfortunately, I don't know enough about how lake works to say any more.)</p>",
        "id": 470075758,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1726279278
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470075758\">said</a>:</p>\n<blockquote>\n<p>It looks like the automated job has been <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10858384340/job/30136293565#step:7:42\">hitting an error</a> when it tries to run <code>lake update</code>: <code>error: leanprover-community/LeanSearchClient: could not materialize package: dependency has no explicit source and was not found on Reservoir</code>. (Unfortunately, I don't know enough about how lake works to say any more.)</p>\n</blockquote>\n<p>Thanks. Looks like I need to get <a href=\"https://github.com/leanprover-community/LeanSearchClient\">https://github.com/leanprover-community/LeanSearchClient</a> on Reservoir. Maybe the easiest way is to give it a star myself <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 470078790,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726281438
    },
    {
        "content": "<p>I've given it a star as well!</p>",
        "id": 470079007,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1726281633
    },
    {
        "content": "<p>Seems like the workflow is still getting <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10877863930/job/30179888756#step:7:42\">the same error</a> that LeanSearchClient was not found on Reservoir...</p>",
        "id": 470455043,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1726463468
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470455043\">said</a>:</p>\n<blockquote>\n<p>Seems like the workflow is still getting <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10877863930/job/30179888756#step:7:42\">the same error</a> that LeanSearchClient was not found on Reservoir...</p>\n</blockquote>\n<p>I am really sorry that LeanSearch is temporarily offline...</p>\n<p>The engineers are trying to reboot the service now. It may take about 24 hours.</p>",
        "id": 470455770,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1726463682
    },
    {
        "content": "<p>Ah, but I think this is an issue on Reservoir's side, not LeanSearch.</p>",
        "id": 470456190,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1726463785
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span>, multiple problems: it's also just down!</p>",
        "id": 470458922,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726464836
    },
    {
        "content": "<p>There was a reservoir update that did not pick up LeanSearchClient though (even though it met criteria).</p>",
        "id": 470459097,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726464888
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Shall I merge the loogle code and then have a PR to manually update the dependency in Mathlib (temporarily specify the path in the lakefile and run <code>lake update LeanSearchClient</code>)? Since the repo is not likely to be updated often, this may be easier that fixing everything in the path.</p>\n<p>Either way we should hold off the announcement till LeanSearch is back up.</p>",
        "id": 470459792,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726465136
    },
    {
        "content": "<p>Sorry, I'm confused, why is the automatic process not working?</p>",
        "id": 470460747,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726465482
    },
    {
        "content": "<p>(I'd prefer to fix the automatic process rather than work around it, if possible.)</p>",
        "id": 470460785,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726465500
    },
    {
        "content": "<p>Oh, I see, the problem is just that Reservoir has still not recognised LeanSearchClient exists at all.</p>",
        "id": 470461576,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726465787
    },
    {
        "content": "<p>For the automatic process to work Reservoir has to pick up the repository. It did not at first presumably because it had only one star. However, once it had three it still failed for unknown reasons. I reported this.</p>",
        "id": 470461584,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726465792
    },
    {
        "content": "<p>Maybe <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> can be alerted here.</p>",
        "id": 470461735,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726465841
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, do you know why this is? We really need an easy to find page on Reservoir \"why did reservoir not find package X\", and link to it from any failed search result.</p>",
        "id": 470461753,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726465850
    },
    {
        "content": "<p>Users are going to be pretty annoyed if they can't find out why their package doesn't appear.</p>",
        "id": 470461815,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726465871
    },
    {
        "content": "<p>The merging of loogle syntax is independent of this. I will go ahead if there is no issue.</p>",
        "id": 470461863,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726465888
    },
    {
        "content": "<p>But I will not try any manual updating. As LeanSearch is down anyway one can hope both issues get fixed over the next day or so.</p>",
        "id": 470462198,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726465996
    },
    {
        "content": "<p>The LeanSearch service has now been restored.</p>",
        "id": 470558981,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1726485715
    },
    {
        "content": "<p>And the CI for LeanSearchClient is green again. Still awaiting Reservoir though.</p>",
        "id": 470567746,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726487237
    },
    {
        "content": "<p>Could the <code>LeanSearchClient</code> set a custom User-Agent? Simply passing <code>#[\"--user-agent\", \"LeanSearchClient\"]</code> to curl should suffice. Bonus points if you include the version number of <code>LeanSearchClient</code> and the current toolchain (<code>Lean.versionString</code>) in the header (not sure if there is an easy way to get the version of the current project, if not, don’t worry about it)</p>",
        "id": 470590509,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726490815
    },
    {
        "content": "<p>does the toolchain string actually make sense?</p>",
        "id": 470590656,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726490847
    },
    {
        "content": "<p>loogle is using its own toolchain right?</p>",
        "id": 470590703,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726490858
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470590509\">said</a>:</p>\n<blockquote>\n<p>Could the <code>LeanSearchClient</code> set a custom User-Agent? Simply passing <code>#[\"--user-agent\", \"LeanSearchClient\"]</code> to curl should suffice. Bonus points if you include the version number of <code>LeanSearchClient</code> and the current toolchain (<code>Lean.versionString</code>) in the header (not sure if there is an easy way to get the version of the current project, if not, don’t worry about it)</p>\n</blockquote>\n<p>I don't know what a custom User-Agent is. What functionality do you want (I will google meanwhile)?</p>",
        "id": 470590993,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726490922
    },
    {
        "content": "<p>a user-agent is HTTP lingo for \"tell me what kind of a client you are\"</p>",
        "id": 470591091,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726490948
    },
    {
        "content": "<p><a href=\"https://reqbin.com/req/c-ekublyqq/curl-user-agent\">https://reqbin.com/req/c-ekublyqq/curl-user-agent</a></p>",
        "id": 470591232,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726490980
    },
    {
        "content": "<p>Found mdn docs <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent</a>. Will read and try to implement.</p>",
        "id": 470591234,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726490981
    },
    {
        "content": "<p>In practice this means inserting a string in the curl arguments list that indicates that leansearch is making the curl request. EDIT : for e.g. adding <code>\"-A \\\"leansearch\\\" \"</code> as an element in the list you build up for args</p>",
        "id": 470591456,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726491033
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>  I added a user agent. If you are logging at loogle there should be 3 calls with \"LeanSearchClient\" as the user agent.</p>",
        "id": 470593521,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726491384
    },
    {
        "content": "<p>Indeed:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mf\">49.206</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">114</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">16</span><span class=\"bp\">/</span><span class=\"n\">Sep</span><span class=\"bp\">/</span><span class=\"mi\">2024</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"o\">:</span><span class=\"mi\">03</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"mi\">0000</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"s2\">\"GET /json?q=List%20%3Fa%20%E2%86%92%20%3Fa HTTP/2.0\"</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"w\"> </span><span class=\"mi\">25612</span><span class=\"w\"> </span><span class=\"s2\">\"-\"</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span>\n<span class=\"mf\">49.206</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">114</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">16</span><span class=\"bp\">/</span><span class=\"n\">Sep</span><span class=\"bp\">/</span><span class=\"mi\">2024</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"o\">:</span><span class=\"mi\">09</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"mi\">0000</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"s2\">\"GET /json?q=List%20%3Fa%20%E2%86%92%20%3Fa HTTP/2.0\"</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"w\"> </span><span class=\"mi\">25612</span><span class=\"w\"> </span><span class=\"s2\">\"-\"</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span>\n<span class=\"mf\">49.206</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">114</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">16</span><span class=\"bp\">/</span><span class=\"n\">Sep</span><span class=\"bp\">/</span><span class=\"mi\">2024</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">55</span><span class=\"o\">:</span><span class=\"mi\">09</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"mi\">0000</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"s2\">\"GET /json?q=Nat.succ_le_succ HTTP/2.0\"</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"w\"> </span><span class=\"mi\">246</span><span class=\"w\"> </span><span class=\"s2\">\"-\"</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span>\n</code></pre></div>\n<p>thanks!</p>",
        "id": 470593861,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726491433
    },
    {
        "content": "<p>Just to point it out -- that will lose editor information unless LeanSearchClient provides a way to <em>configure</em> the user agent as well (e.g. you won't be able to tell whether it's LeanSearchClient within VSCode vs elsewhere)</p>",
        "id": 470597567,
        "sender_full_name": "Julian Berman",
        "timestamp": 1726492095
    },
    {
        "content": "<p>I have added a configurable option <code>leansearchclient.useragent</code> set by default to LeanSearchClient.</p>",
        "id": 470600169,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726492546
    },
    {
        "content": "<p>That's a thing you need to set in Lean though right? That means every <em>user</em> using LeanSearchClient will need to set it (which still seems useful to keep, so I would keep it as a setting well), but in order to be able to set it from e.g. editor plugins, or from someone writing a client on top of LeanSearchClient for whatever reason, it I think would also need to try to optionally look at the \"active\" LSP client configurations (and in that case e.g. the VSCode integration can set a default value for VSCode, I can set one for neovim, etc. such that users of the editors don't need to themselves set it). Perhaps this is overcomplicating things so feel free to ignore though, or to tell me I should help find exactly where that is exposed by the Lean server (I suspect it is, but I don't know where off hand)!</p>",
        "id": 470608304,
        "sender_full_name": "Julian Berman",
        "timestamp": 1726493880
    },
    {
        "content": "<p>I think we don’t need to worry about this. It’s already useful to roughly know which loogle UI people use, I don’t mind if I don’t know which editor those users that use <code>#loogle</code> are using.</p>",
        "id": 470608691,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726493953
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470461753\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span>, do you know why this is? We really need an easy to find page on Reservoir \"why did reservoir not find package X\", and link to it from any failed search result.</p>\n</blockquote>\n<p>The problem appears to simply be that Lean Search does not appear in the first 1000 code search results. 1000 is the rate limit for a batch of results (before needing ot wait for a reset). This can be improved by Reservoir staggering its requests to obtain more results, but the better long-term solution is a form of manual registration. I have a conceptual sketch of how to do this, I just need to have the time to dedicate to it.</p>",
        "id": 470646881,
        "sender_full_name": "Mac Malone",
        "timestamp": 1726500547
    },
    {
        "content": "<p>Given the current Reservoir limitations, it may be worth adding a disclaimer/note to the  Reservoir Inclusion Criteria to help users understand why their new package may not yet be included.</p>",
        "id": 470647157,
        "sender_full_name": "Mac Malone",
        "timestamp": 1726500610
    },
    {
        "content": "<p>The issue here is that <code>LeanCodeSearch</code> has been added as a Mathlib dependency with the standard format (formatted <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>) and this depends on it being in Reservoir.</p>",
        "id": 470647681,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726500729
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>  I take it that it will not be picked up soon.<br>\n<span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Then a manual update may be the best.</p>",
        "id": 470648276,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726500830
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"266304\">Siddhartha Gadgil</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470647681\">said</a>:</p>\n<blockquote>\n<p>The issue here is that <code>LeanCodeSearch</code> has been added as a Mathlib dependency with the standard format (formatted <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span>) and this depends on it being in Reservoir.</p>\n</blockquote>\n<p>It is possible to provide both a Reservoir require and Git source (which it wil fallback to if it cannot find it on Reservoir).</p>",
        "id": 470648662,
        "sender_full_name": "Mac Malone",
        "timestamp": 1726500902
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> Currently the line in lakefile is </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n</code></pre></div>\n<p>How do I add the explicit address <a href=\"https://github.com/leanprover-community/LeanSearchClient\">https://github.com/leanprover-community/LeanSearchClient</a>?</p>",
        "id": 470653145,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726501798
    },
    {
        "content": "<p>Append <code>from git \"https://github.com/leanprover-community/LeanSearchClient\" @ \"main\"</code></p>",
        "id": 470653511,
        "sender_full_name": "Mac Malone",
        "timestamp": 1726501873
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> Thanks.<br>\nThat seemed to work, but just to keep the lakefile clean, should I end with <code>.git</code>? I copied from the address bar not the git address?</p>",
        "id": 470655133,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726502165
    },
    {
        "content": "<p>I asked because of a change in lake-manifest, but this way seems consistent with the other entries. So I suppose without <code>.git</code> is correct.</p>",
        "id": 470655594,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726502262
    },
    {
        "content": "<p>Either should work.</p>",
        "id": 470655811,
        "sender_full_name": "Mac Malone",
        "timestamp": 1726502302
    },
    {
        "content": "<p>A PR is up at <a href=\"https://github.com/leanprover-community/mathlib4/pull/16857\">https://github.com/leanprover-community/mathlib4/pull/16857</a> just making this change and the corresponding change in the lake-manifest (by running <code>lake update LeanSearchClient</code>).</p>\n<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Can you please merge (or some other maintainer around if the change is fine)?</p>",
        "id": 470657665,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726502685
    },
    {
        "content": "<p>Ugh, I had really hoped that we would use this as an opportunity to unbreak Reservoir. I think it's essential that we stop working around limitations in Reservoir and instead get them fixed. :-(</p>",
        "id": 470779119,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726531860
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>, can we <em>at least</em> make sure that by v4.12.0 there is a <em>really clear</em> error message in this use case?</p>",
        "id": 470779403,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726531966
    },
    {
        "content": "<p>Users are going to (are already) writing </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"LeanSearchClient\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n</code></pre></div>\n<p>for repositories that Reservoir has failed to index.</p>\n<p>Possible solutions:</p>\n<ul>\n<li>Reservoir actually indexes everything.</li>\n<li>At least one of (and ideally all four):<ul>\n<li>The \"failed to materialize\" error contains a link to a manual registration page.</li>\n<li>The \"failed to materialize\" error contains a link to a page explaining why <em>that project</em> isn't available on reservoir.</li>\n<li>The \"failed to materialize\" error shows you exactly what to write to make things work anyway right now.</li>\n<li>The \"failed to materialize\" errors pings Reservoirs and tells it to go index the package, and tells the user to try again soon.</li>\n</ul>\n</li>\n</ul>",
        "id": 470780252,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726532280
    },
    {
        "content": "<p>Mathlib update is failing again. Errors such as <code>error: ././././Mathlib/Data/Nat/MaxPowDiv.lean:30:30: unexpected token 'go'; expected search_cmd</code> are causing the build to fail. Presumably one of the other dependencies changed in a way that needs update.</p>\n<p>I had forgotten to import the loogle syntax and updated this a couple of hours ago. Because of the build failures it is still not available (though the <code>#leansearch</code> and <code>#moogle</code> are fine).</p>",
        "id": 470861673,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726547034
    },
    {
        "content": "<p>This is preventing nightly-testing from compiling. :-(</p>",
        "id": 470899864,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726559844
    },
    {
        "content": "<p>My guess is that this is LeanSearch's fault.</p>",
        "id": 470900071,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726559904
    },
    {
        "content": "<p>Yes, you've made <code>go</code> a token, so no one downstream can use it as a function name.</p>",
        "id": 470900355,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726559969
    },
    {
        "content": "<p>I've reverted <code>nightly-testing</code> to 5f3c33d7f641d26bd013d8bb4cafcb5ccce53dc4, before loogle landed in <code>LeanSearchClient</code>.</p>",
        "id": 470900989,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560068
    },
    {
        "content": "<p>This will break Mathlib's auto-dependency update for now.</p>",
        "id": 470901054,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span>, will you have a chance to have a look at this? I might be able to in about 3 hours, not sure if I'll have time tonight.</p>",
        "id": 470901154,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560101
    },
    {
        "content": "<p>Oops, sorry.</p>",
        "id": 470901189,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560108
    },
    {
        "content": "<p>I saw the \"go\" in the error but did not realize it was mine. Will replace it by \"do\" which is already a token I assume.</p>",
        "id": 470901464,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560146
    },
    {
        "content": "<p>I would much prefer to see a debouncing solution rather than relying on a weird terminator.</p>",
        "id": 470903445,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560467
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I have replace \"go\" by \"do_search\" which I checked is nowhere is Mathlib. Not so elegant but hopefully will not break anything.</p>",
        "id": 470903621,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560492
    },
    {
        "content": "<p>Sorry, just saw your email.</p>",
        "id": 470903668,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560502
    },
    {
        "content": "<p>If we don't require a terminator, what actually happens to the earlier searches when you type the next keystroke. Does it get cancel, or does it live on? (Sorry, I can't remember what happens to commands calling IO... I fear that it lives on.)</p>",
        "id": 470903859,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560540
    },
    {
        "content": "<p>If it got cancelled, an easy solution here would be to just wait 200ms before calling curl.</p>",
        "id": 470903959,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560558
    },
    {
        "content": "<p>Actually, maybe we can do this with an IO.ref in any case.</p>",
        "id": 470904188,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560591
    },
    {
        "content": "<p>When the command is called, write the current time into an IO.ref. Then wait 200ms. Now read the ref again. If it has changed in the meantime, just stop. Otherwise, proceed with the search.</p>",
        "id": 470904576,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560648
    },
    {
        "content": "<p>I think it works fine. Only thing is partial syntax that is still valid triggers, but only if one pauses.</p>",
        "id": 470904578,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560649
    },
    {
        "content": "<p>What works fine?</p>",
        "id": 470904697,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726560670
    },
    {
        "content": "<p>I will test and confirm that just dropping the terminations works.</p>",
        "id": 470904702,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560671
    },
    {
        "content": "<p>The following examples work fine.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">a</span>\n\n\n<span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">loogle.queries</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">loogle</span><span class=\"w\"> </span><span class=\"n\">Nat.succ_le_succ</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 470905341,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560788
    },
    {
        "content": "<p>And I typed it out. The default delay is enough that things were not triggered.</p>",
        "id": 470905652,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560875
    },
    {
        "content": "<p>Does this syntax seem fine? I will push to LeanSearchClient.</p>",
        "id": 470905722,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560899
    },
    {
        "content": "<p>I have pushed. If things are fine can you restore the auto-update?</p>",
        "id": 470906005,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726560989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> I am afraid even the new Loogle syntax is breaking Mathlib. This time the culprit is the turnstile symbol which I copied from Loogle's own syntax as given by <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> </p>\n<p>For the present I will simply remove Loogle syntax so that the dependency update does not keep breaking.</p>",
        "id": 470936655,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726568132
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 470937828,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726568387
    },
    {
        "content": "<p>I realized that even though LoogleSyntax is not imported in <code>Mathlib.Tactic</code>, it can still be explicitly imported and works. So at present all syntax is available, but loogle needs an extra step.</p>",
        "id": 470941042,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726569386
    },
    {
        "content": "<p>The parsing still doesn't seem to work well -</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n</code></pre></div>\n<p>triggers it for example (and causes it to panic)</p>",
        "id": 470995394,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726582552
    },
    {
        "content": "<p>I think you are going to end up in a situation where loogle is flooded with requests if you don't have a terminating token</p>",
        "id": 470995667,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1726582594
    },
    {
        "content": "<p>You can try wrapping </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">turnstyle</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">patternIgnore</span><span class=\"o\">(</span><span class=\"n\">nonReservedSymbol</span><span class=\"o\">(</span><span class=\"s2\">\"⊢ \"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|&gt;</span><span class=\"w\"> </span><span class=\"n\">nonReservedSymbol</span><span class=\"o\">(</span><span class=\"s2\">\"|- \"</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>and the same for your <code>\"go\"</code>, this should then not break stuff downstream. I don't know how well it works for something you want to parse after an expression.</p>",
        "id": 471007996,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1726585270
    },
    {
        "content": "<p>Now the \"update mathlib dependency\" is running fine but the lake-manifest.json has not updated.</p>",
        "id": 471011469,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726586033
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470995394\">said</a>:</p>\n<blockquote>\n<p>The parsing still doesn't seem to work well -</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n</code></pre></div>\n<p>triggers it for example (and causes it to panic)</p>\n</blockquote>\n<p>Should I make an issue in the repository for this?</p>",
        "id": 471398784,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726720896
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/471398784\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/470995394\">said</a>:</p>\n<blockquote>\n<p>The parsing still doesn't seem to work well -</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n</code></pre></div>\n<p>triggers it for example (and causes it to panic)</p>\n</blockquote>\n<p>Should I make an issue in the repository for this?</p>\n</blockquote>\n<p>Sure. But do you know whether it is triggered by the new syntax? Please make an issue and I will test if it is.</p>",
        "id": 471399069,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726721042
    },
    {
        "content": "<p>Actually, could you replace <code>import Mathlib</code> by <code>import LeanSearchClient</code> and see if you get the same error?</p>",
        "id": 471399230,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726721109
    },
    {
        "content": "<p>I do, yes:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n</code></pre></div>",
        "id": 471399284,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726721139
    },
    {
        "content": "<p>Please make an issue then. I will work on miniming it. Thanks for flagging.</p>",
        "id": 471399407,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726721182
    },
    {
        "content": "<p>Actually, even</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSearchClient</span>\n\n<span class=\"n\">apple</span>\n</code></pre></div>\n<p>produces the \"wrong\" error message - \"unexpected identifier; expected search_cmd\" instead of what's produced without <code>import LeanSearchClient</code>, \"unexpected identifier; expected command\"</p>",
        "id": 471399471,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1726721218
    },
    {
        "content": "<p>Thanks. I see now the probable cause.</p>",
        "id": 471399575,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726721278
    },
    {
        "content": "<p>There are parsers that begin with the <code>search_cmd</code> syntax category that are triggered and then give errors. This was only to avoid code duplication. Will avoid this.</p>",
        "id": 471399773,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726721368
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span> This has been fixed in LeanSearchClient. The new dependency should make its way to Mathlib with the next update (in a couple of hours)</p>",
        "id": 471445563,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1726738325
    },
    {
        "content": "<p>Can you filter auxiliary theorems from the results of LeanSearch? <br>\nIf I search for <code>addition is continuous</code>  the first returned results are </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">stereoToFun</span><span class=\"bp\">.</span><span class=\"n\">proof_4</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">bernsteinApproximation</span><span class=\"bp\">.</span><span class=\"n\">proof_1</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">VectorFourier</span><span class=\"bp\">.</span><span class=\"n\">mul_L_schwartz</span><span class=\"bp\">.</span><span class=\"n\">proof_1</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Orientation</span><span class=\"bp\">.</span><span class=\"n\">areaForm'</span><span class=\"bp\">.</span><span class=\"n\">proof_4</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">ComplexMeasure</span><span class=\"bp\">.</span><span class=\"n\">equivSignedMeasure</span><span class=\"bp\">.</span><span class=\"n\">proof_2</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">VectorFourier</span><span class=\"bp\">.</span><span class=\"n\">mul_L</span><span class=\"bp\">.</span><span class=\"n\">proof_1</span><span class=\"w\"> </span><span class=\"c1\">-- ContinuousAdd ℝ</span>\n</code></pre></div>\n<p>and <code>Continuous.add</code> is not in the first 50 results.</p>",
        "id": 476773265,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728909413
    },
    {
        "content": "<p>Thank you for your feedback! We will definitely remove these generated auxiliary results in the next update.</p>",
        "id": 476773702,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1728909514
    },
    {
        "content": "<p>And a remark about LeanSearchClient: it should cache results from searches (at least when used as a command / used in the same context as a tactic). If I type above a <code>#leansearch</code> command it seems that the query gets sent many times.</p>",
        "id": 476774267,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728909639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/476774267\">said</a>:</p>\n<blockquote>\n<p>And a remark about LeanSearchClient: it should cache results from searches (at least when used as a command / used in the same context as a tactic). If I type above a <code>#leansearch</code> command it seems that the query gets sent many times.</p>\n</blockquote>\n<p>The requests can be reduced if a search terminator syntax is used. I recall that loogle can/(will be able to) cache search results when run locally</p>",
        "id": 476774787,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728909757
    },
    {
        "content": "<p>I think caching is more reliable though at avoiding repeated requests</p>",
        "id": 476775296,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1728909877
    },
    {
        "content": "<p>Can we re-purpose the DiscrTree that simp uses, to store search results and query them</p>",
        "id": 476777419,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1728910365
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/476774787\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/476774267\">said</a>:</p>\n<blockquote>\n<p>And a remark about LeanSearchClient: it should cache results from searches (at least when used as a command / used in the same context as a tactic). If I type above a <code>#leansearch</code> command it seems that the query gets sent many times.</p>\n</blockquote>\n<p>The requests can be reduced if a search terminator syntax is used. I recall that loogle can/(will be able to) cache search results when run locally</p>\n</blockquote>\n<p>This doesn't help if I write on a line <em>above</em> a query (with terminator).</p>",
        "id": 476780445,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728911012
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/113488-general/topic/LeanSearch/near/476774267\">said</a>:</p>\n<blockquote>\n<p>And a remark about LeanSearchClient: it should cache results from searches (at least when used as a command / used in the same context as a tactic). If I type above a <code>#leansearch</code> command it seems that the query gets sent many times.</p>\n</blockquote>\n<p>Agree. Will implement tomorrow</p>",
        "id": 476792513,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1728913831
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> I have implemented caching. There is only a single function that does the querying (independent of mode) so caching is done here by query.</p>",
        "id": 476810389,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1728919428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span>, <a href=\"http://leansearch.net\">leansearch.net</a> appears to be down.</p>",
        "id": 481531407,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731218646
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Sorry that currently, the engineers are redeploying the service. Before Monday the LeanSearch service will be online again.</p>",
        "id": 481531815,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1731219092
    },
    {
        "content": "<p>Leansearch seems to struggle today. It was down half an hour ago, and now whenever I search for something, I get the response <code>too fast</code>.</p>",
        "id": 486339908,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1733414469
    },
    {
        "content": "<p>I wonder if the FRO could host one of these NLP search engines directly</p>",
        "id": 486340647,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733414639
    },
    {
        "content": "<p>And open source the model</p>",
        "id": 486340714,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733414649
    },
    {
        "content": "<p>We might benefit from one of the smaller locally runnable models</p>",
        "id": 486340800,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733414672
    },
    {
        "content": "<p>Currently all NL search engines appear to be close sourced and privately hosted and we never know when they crash, why they crash, and when they get retrained</p>",
        "id": 486341047,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1733414732
    },
    {
        "content": "<p>Sorry that there is a problem with the LeanSearch server now. We are trying to fix it.</p>",
        "id": 486362327,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1733420846
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/113488-general/topic/LeanSearch/near/486340714\">said</a>:</p>\n<blockquote>\n<p>And open source the model</p>\n</blockquote>\n<p>That is a very good idea. The PKU team would like to open the pipeline to add new theorems to the model after we develop some new features for the LeanSearch engine in the future.</p>",
        "id": 486362942,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1733421013
    },
    {
        "content": "<p>After that, the FRO can maintain an always-up-to-date LeanSearch. Currently, the LeanSearch database is not updating frequently.</p>",
        "id": 486363326,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1733421154
    },
    {
        "content": "<p>Now LeanSearch is working again. <span aria-label=\"at work\" class=\"emoji emoji-2692\" role=\"img\" title=\"at work\">:at_work:</span></p>",
        "id": 486373079,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1733424765
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 486394051,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1733433092
    },
    {
        "content": "<p>Recently I've noticed that <a href=\"https://leansearch.net/\">leansearch</a> fails on queries that contain the <code>%</code> symbol, for example <code>(a + b) % n = ((a % n) + (b % n)) % n</code>.</p>",
        "id": 524069542,
        "sender_full_name": "David Renshaw",
        "timestamp": 1749912381
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243791\">David Renshaw</span> <a href=\"#narrow/channel/113488-general/topic/LeanSearch/near/524069542\">said</a>:</p>\n<blockquote>\n<p>Recently I've noticed that <a href=\"https://leansearch.net/\">leansearch</a> fails on queries that contain the <code>%</code> symbol, for example <code>(a + b) % n = ((a % n) + (b % n)) % n</code>.</p>\n</blockquote>\n<p>This issue has been fixed by <span class=\"user-mention\" data-user-id=\"652127\">@Tony Beta Lambda</span> .</p>",
        "id": 525053108,
        "sender_full_name": "Haocheng Ju",
        "timestamp": 1750429737
    },
    {
        "content": "<p>Is Leansearch down?</p>",
        "id": 526663644,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751394853
    },
    {
        "content": "<p>I've noticed it not giving me results today, just for a point of corroboration</p>",
        "id": 526672301,
        "sender_full_name": "Jason Reed",
        "timestamp": 1751398800
    },
    {
        "content": "<p>who should I ping?</p>",
        "id": 526726817,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751437057
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> ?</p>",
        "id": 526783025,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1751456965
    },
    {
        "content": "<p>I’ll contact <span class=\"user-mention\" data-user-id=\"652127\">@Tony Beta Lambda</span>  at once. He is the current maintainer of LeanSearch.</p>",
        "id": 526783930,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1751457329
    },
    {
        "content": "<p>I think it is up again</p>",
        "id": 526901509,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1751505805
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> <span class=\"user-mention\" data-user-id=\"652127\">@Tony Beta Lambda</span> Hello, the site currently won't load.</p>",
        "id": 527515657,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751905533
    },
    {
        "content": "<p>now the site becomes an IP address when i try to access it.</p>",
        "id": 528484255,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353913
    },
    {
        "content": "<p>Augmentation works, but search doesn't (500 Internal Server Error)</p>",
        "id": 529071230,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1752675598
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"652127\">@Tony Beta Lambda</span>, LeanSearch is working again now. Sorry for the inconvenience.</p>",
        "id": 529306173,
        "sender_full_name": "Jiang Jiedong",
        "timestamp": 1752766464
    },
    {
        "content": "<p>Search is down (500 Internal Server Error)</p>",
        "id": 535688585,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1755871150
    },
    {
        "content": "<p>For the uninitiated, can you provide a link to the project?</p>",
        "id": 564919923,
        "sender_full_name": "Scott Buckley",
        "timestamp": 1766358087
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"115259\">@Scott Buckley</span> I moved your question out of <a class=\"stream\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce\">#announce</a> and into this discussion thread where you can find the answer at the very top: it's <a href=\"https://leansearch.net/\">https://leansearch.net/</a> (I totally appreciate that you are new to the community BTW; thanks for asking).</p>",
        "id": 564920127,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766358338
    },
    {
        "content": "<p>Other semantic search engines for lean/mathlib are <a href=\"https://leandex.projectnumina.ai/\">https://leandex.projectnumina.ai/</a> and <a href=\"https://www.leanexplore.com/\">https://www.leanexplore.com/</a> and <a href=\"https://www.moogle.ai/\">https://www.moogle.ai/</a> but some of these engines are on more recent versions of mathlib than others, so one has to be careful. The point of the announcement is that leansearch is now more up to date than it was :-) In general my impression is that it is a lot of hard work to get these search engines up to date with mathlib so the pattern seems to be that something is up to date and then slowly rots and then gets bumped back up to date again.</p>",
        "id": 564920197,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1766358436
    }
]