[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> has a working implementation of something close to this. It remains high on my TODO list to actually try it out, and report on how useful it is re: <code>List</code> lemmas (which I've been working on). But it's been sitting on my TODO list for some time now. :-)</p>",
        "id": 463063538,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723938316
    },
    {
        "content": "<p>link?</p>",
        "id": 463065949,
        "sender_full_name": "Jared green",
        "timestamp": 1723938982
    },
    {
        "content": "<p>that sounds really interesting! looking forward to seeing more of that</p>",
        "id": 463146744,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1723978060
    },
    {
        "content": "<p><a href=\"https://github.com/nomeata/lean-simplc/blob/master/Simplc.lean\">https://github.com/nomeata/lean-simplc/blob/master/Simplc.lean</a><br>\nHappy to explain what I am doing, or help anyone to use it who wants to check their simp API’s for local confluence.</p>",
        "id": 463148445,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1723978535
    },
    {
        "content": "<p>I am finally trying this out. It's indeed very helpful. :-)</p>\n<p>It would be really nice if the output for <code>inspect</code> could also show what <code>simp</code> does to each of the results, in the case that joining fails. I think this would make it easier to identify missing lemmas.</p>\n<p>EDIT: oh, I was misread the output: the \"Joining failed with\" output essentially shows this.</p>",
        "id": 463381489,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724068175
    },
    {
        "content": "<p>Another thing that would be useful is for <code>simp_lc inspect</code> could show a warning if either of the named lemmas is not actually <code>@[simp]</code>.</p>\n<p>(Because I expect a typical workflow will be to remove some <code>@[simp]</code> statements, and then when returning to the <code>simp_lc</code> file there is an indication that that <code>inspect</code> line can now be removed.)</p>",
        "id": 463382790,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724068424
    },
    {
        "content": "<p>I was assuming that <code>simp_lc inspect </code>is only used while investigating a specific pair, but only <code>simp_lc whitelist</code>, <code>simp_lc ignore</code> and <code>simp_lc check</code> are non-termporary.</p>",
        "id": 463390155,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724070878
    },
    {
        "content": "<p>Could <code>whitelist</code> show a warning if there isn't actually a problem with that pair?</p>",
        "id": 463390348,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724070926
    },
    {
        "content": "<p>Otherwise if the problem goes away independently I will never know to delete that line.</p>",
        "id": 463390431,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724070944
    },
    {
        "content": "<p>That’s more plausible, at least until one starts using <code>simp_lc check [domain_specific_simpset]</code> or so. And then there could be variants, or an option to disable the warning.</p>",
        "id": 463390771,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724071021
    },
    {
        "content": "<p>Warning implemented and pushed</p>",
        "id": 463392861,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724071467
    },
    {
        "content": "<p>Maybe you didn't push? I don't see it.</p>",
        "id": 463393188,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071526
    },
    {
        "content": "<p>Now pushed for real</p>",
        "id": 463393329,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724071541
    },
    {
        "content": "<p>Also -- i'm finding that <code>try repeat simp_all</code> is often needed, and gives better results than <code>try simp_all</code></p>",
        "id": 463393413,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071552
    },
    {
        "content": "<p>Ever since I banned <code>lake</code> into a container that doesn’t have access to my ssh keys, I fall prey of <code>git push</code>–switch windows–missed the error message</p>",
        "id": 463393782,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724071593
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/knuth.20bendix.20completion/near/463393413\">said</a>:</p>\n<blockquote>\n<p>Also -- i'm finding that <code>try repeat simp_all</code> is often needed, and gives better results than <code>try simp_all</code></p>\n</blockquote>\n<p>Sounds like a bug in <code>simp_all</code>?</p>",
        "id": 463393831,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724071599
    },
    {
        "content": "<p>Yeah, I'm not certain. I think this has come up before and we decided it was not a bug, ...</p>",
        "id": 463394151,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071639
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">List</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">range'_head</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">range'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">range'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">[])</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 463394523,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071690
    },
    {
        "content": "<p>I agree that looks like <code>simp_all</code>'s fault.</p>",
        "id": 463394640,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071715
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/5094\">#5094</a></p>",
        "id": 463395710,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724071915
    },
    {
        "content": "<p>More likely <a href=\"https://github.com/leanprover/lean4/issues/5094\">https://github.com/leanprover/lean4/issues/5094</a></p>",
        "id": 463396359,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724072010
    },
    {
        "content": "<p>Oh, after encountering another instance of needing <code>simp_all; simp_all</code>, I am back to believing that this is the correct behaviour of <code>simp_all</code>.</p>\n<p>The point is that <code>simp_all</code> <em>first</em> tries to simp hypotheses, <em>then</em> the goal. The problem can be that if the goal depends on the hypotheses in interesting ways, this may block simplification of a hypothesis. When we then move to the goal, the dependency can be removed, but <code>simp_all</code> does not then go back to look at the hypotheses again.</p>",
        "id": 463559942,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724120377
    },
    {
        "content": "<p>Here's the other example that made it clear:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isSome</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">none</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h₂</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n</code></pre></div>",
        "id": 463559976,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724120393
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>, it would be helpful to be able to whitelist a lemma entirely. I'm finding some that I think I do want as  <code>@[simp]</code> lemmas, but I just don't care about the non-confluence that it produces.</p>",
        "id": 463599211,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724132935
    },
    {
        "content": "<p>I guess</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">head_mem</span><span class=\"w\"> </span><span class=\"n\">getLast_mem</span><span class=\"w\"> </span><span class=\"n\">get_find?_mem</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">simp_lc</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">List</span>\n</code></pre></div>\n<p>suffices for this</p>",
        "id": 463600643,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724133278
    },
    {
        "content": "<p>Doesn't <code>simp_lc ignore</code> do what you want?</p>",
        "id": 463610109,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724136949
    },
    {
        "content": "<p>Made it use <code>try repeat simp_all</code>. I hope that won’t run into too many loops.</p>",
        "id": 463611081,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724137159
    },
    {
        "content": "<p>Fantastic, thanks.</p>",
        "id": 463906192,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724202304
    },
    {
        "content": "<p>I would really like <code>whitelist</code> (or some other command) to still run the confluence check, and to give a warning if it is in fact confluent.</p>\n<p>Having the warning if one of the lemmas is not a <code>simp</code> lemma is great, but the problem is that if I've whitelisted something, and then add a simp lemma that would resolve it, I never know to remove the whitelist.</p>",
        "id": 463906198,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724202305
    },
    {
        "content": "<p>I could achieve this with <code>#guard_msgs</code>, but it's very verbose!</p>",
        "id": 463906256,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724202320
    },
    {
        "content": "<p>Also, for my use case at least, the \"Try this:\" message from <code>check</code> would actually be more useful if it produced <code>inspect</code> rather than <code>whitelist</code>. I understand the reasoning for making it whitelist, but my first step is always to mass edit it back to <code>inspect</code>...</p>",
        "id": 463906772,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724202440
    },
    {
        "content": "<p>I was worried about the cases where you whitelist something because it loops or crashes or so. But maybe that doesn't happen so often. And I can just make two commands.</p>",
        "id": 463980497,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724228525
    },
    {
        "content": "<p>Both implemented.  You even get a <code>Try this</code> action to remove the <code>whitelist</code> command. And an option to disable this check.</p>",
        "id": 464017161,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724238315
    },
    {
        "content": "<p>One more tiny request: can the message \"Checking 671 simp lemmas for critical pairs\" say how many confluent pairs it found?</p>",
        "id": 464259269,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724302776
    },
    {
        "content": "<p>Oh, yet another: can I write <code>simp_lc check in Foo Bar</code> to check lemmas in multiple namespaces.</p>",
        "id": 464260855,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724303174
    },
    {
        "content": "<p>In particular, two namespaces. Since we're doing pairwise checks on lemmas, in principle one could get complete coverage from doing pairwise checks on namespaces.</p>",
        "id": 464261112,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724303237
    },
    {
        "content": "<p>Sounds like we need a general algebra of lemma restrictions, for use in loogle and in tools like this :-)</p>",
        "id": 464270332,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724306892
    },
    {
        "content": "<p>Both implemented.</p>",
        "id": 464273294,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724308094
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span>, if you have a chance could you take a look at:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simp_lc</span><span class=\"w\"> </span><span class=\"n\">inspect</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">forall_mem_ne'</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"k\">forall</span><span class=\"w\"> </span><span class=\"c1\">-- stuck at solving universe constraint</span>\n</code></pre></div>",
        "id": 465053745,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724630604
    },
    {
        "content": "<p>Hmm, not sure if my tool can do much here: If you set this goal up manually you also get this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}):</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>produces</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stuck</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">solving</span><span class=\"w\"> </span><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">constraint</span>\n<span class=\"w\">  </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4466</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=?=</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4059</span>\n<span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">trying</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">unify</span>\n<span class=\"w\">  </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4466</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4466</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4059</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">4059</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>It helps to constrain <code>(α : Type u)</code> .</p>",
        "id": 465105775,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724657936
    },
    {
        "content": "<p>With that you can investigate the pair manually:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}):</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">}),</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">forall_mem_ne'</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"k\">forall</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 465106675,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724658202
    },
    {
        "content": "<p>That's fine. I can whitelist it with the option to disable whitelist checking.</p>",
        "id": 465135763,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724665481
    },
    {
        "content": "<p>Actually, that universe equation at least uniquely sets the first variable to 0. Should lean recognize this or is this equation too arcane?</p>",
        "id": 465137176,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724665987
    },
    {
        "content": "<p>I don't think it does: if it were <code>min</code> on the right hand side it would?</p>",
        "id": 465164567,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724674688
    },
    {
        "content": "<p>Ah, I keep making that mistake with <code>min</code> and <code>max</code> :-)</p>",
        "id": 465164975,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724674769
    },
    {
        "content": "<p>Could we make <code>simp_lc check in _root_</code> work, to ignore everything <em>in</em> a namespace?</p>",
        "id": 465302970,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724723376
    },
    {
        "content": "<p>It’s a bit odd since <code>in List</code> will include <code>List.Perm.foo</code> (should it?) but pragmatically: Sure.</p>",
        "id": 465389321,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724751946
    },
    {
        "content": "<p>Yeah, I agree it is weird, but I'm not really sure how else to partition up the work...</p>",
        "id": 465414649,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724757648
    },
    {
        "content": "<p>Oh, the feature request is fine, merely the syntax is a bit non-uniform. As mentioned before, a more expensive and well designed lemma filtering syntax would be useful, but not worth for just this ad-hoc tool. Maybe eventually for Loogle, and reusable here.</p>",
        "id": 465426353,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724760386
    },
    {
        "content": "<p>Added support for <code>in _root_</code></p>",
        "id": 465448293,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724764289
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 465634374,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724822697
    },
    {
        "content": "<p>Minor bug report: <code>simp_lc ignore X</code> silences <code>simp_lc inspect A X</code>, but not <code>simp_lc inspect X A</code>. Whatever the behaviour here, it should be the same in either order.</p>",
        "id": 465634600,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724822740
    },
    {
        "content": "<p>Which behavior would you prefer? Ignore <code>ignore</code> when using <code>inspect</code> explicitly, or adhere to it?</p>",
        "id": 465675236,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724831893
    },
    {
        "content": "<p>Ah, judging from the code I probably wanted to ignore only affect <code>simp_lc check</code>. Made that change (mostly untested). I think that’s the better choice.</p>",
        "id": 465676006,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724832000
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simp_lc</span><span class=\"w\"> </span><span class=\"n\">check</span>\n<span class=\"c1\">-- Checking 5753 simp lemmas for critical pairs</span>\n<span class=\"c1\">-- Investigated 6190 critical pairs</span>\n</code></pre></div>\n<p>We're getting there. There are still a few <code>whitelist</code>s that indicate problems about <code>Nat</code>/<code>Int</code>/<code>List</code>, but not many, and <code>BitVec</code> and <code>Fin</code> are really bad.</p>",
        "id": 466146600,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724985606
    },
    {
        "content": "<p>Happy to hear that it's working as intended, and to see the long list of improvements hitting the standard library that you have been producing this week.</p>\n<p>You have not looked at <code>Array</code> yet, I assume?</p>",
        "id": 466162074,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724994895
    },
    {
        "content": "<p><code>Array</code> was apparently confluent to begin with.</p>",
        "id": 466163426,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724995596
    },
    {
        "content": "<p>Now I wonder if my tool is buggy <span aria-label=\"cold sweat\" class=\"emoji emoji-1f630\" role=\"img\" title=\"cold sweat\">:cold_sweat:</span></p>",
        "id": 466166571,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1724997128
    }
]