[
    {
        "content": "<p>I am setting up a new lean project on <code>4.15.0</code> and want to build documentation pages in the new recommended way as described in the <a href=\"https://github.com/leanprover/doc-gen4?tab=readme-ov-file#usage\">README</a>, but I get the following error message after running <code>lake build foo:docs</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">facet</span><span class=\"w\"> </span><span class=\"ss\">`docs</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>To reproduce:</p>\n<ul>\n<li>Run</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>foo\n<span class=\"nb\">cd</span><span class=\"w\"> </span>foo\nlake<span class=\"w\"> </span>update\nmkdir<span class=\"w\"> </span>docbuild\n<span class=\"nb\">cd</span><span class=\"w\"> </span>docbuild\n</code></pre></div>\n<ul>\n<li>copy the <code>lakefile.toml</code> from the <code>README</code> to a new file <code>lakefile.toml</code>.</li>\n<li>replace <code>Your library name</code> with <code>foo</code> and <code>main</code> with <code>v4.15.0</code>.</li>\n<li>run <code>lake update doc-gen4</code></li>\n<li>run <code>lake build foo:docs</code></li>\n</ul>\n<p>What am I doing wrong?</p>",
        "id": 492329182,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736263009
    },
    {
        "content": "<p>I wouldn't say you're doing anything wrong per se, but when you do <code>lake new foo</code> (or <code>lake new Foo</code>), lake generates a file with a <code>lean_lib</code> target called <code>Foo</code> and a <code>lean_exe</code> target called <code>foo</code>. <code>docs</code> is a library facet (whatever that means), so you need to run <code>lake build Foo:docs</code>, not <code>lake build foo:docs</code>.</p>",
        "id": 492351623,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736269895
    },
    {
        "content": "<p>That being said, I get a bunch of panics when running <code>lake build Foo:docs</code> on an empty project created via <code>lake new foo</code>.</p>",
        "id": 492351790,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736269954
    },
    {
        "content": "<p>Thanks, that does something, but indeed, also for me it throws a lot of panics.</p>",
        "id": 492352787,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736270331
    },
    {
        "content": "<p>Maybe the distinction <code>foo:docs</code> vs <code>Foo:docs</code> could be added to the <code>README.md</code>?</p>",
        "id": 492352920,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736270386
    },
    {
        "content": "<p><del>I think doc-gen4 doesn't like <code>lean_exe</code> targets at all. If I delete that target, I don't get panics.</del></p>",
        "id": 492353390,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736270557
    },
    {
        "content": "<p><del>Easiest way to have a package without <code>lean_exe</code> targets is to create it via <code>lake new foo lib</code></del></p>",
        "id": 492353573,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736270638
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span></p>",
        "id": 492353825,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736270727
    },
    {
        "content": "<p>The panics are fixed in Lean v4.16.0-rc1 (<a href=\"https://github.com/leanprover/lean4/pull/6374\">lean4#6374</a>, fixed by <a href=\"https://github.com/leanprover/lean4/pull/6375\">lean4#6375</a>), and I think they can be ignored in previous Lean versions (the docs will be generated anyway). Of course, you shouldn't update to v4.16.0-rc1 if you depend on mathlib.</p>",
        "id": 492355385,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736271315
    },
    {
        "content": "<p>Now I am trying it on a project with mathlib dependency and it has 11690 build targets (roughly two times mathlib + my project) and throws a bunch of <code>WARNING: Failed to calculate equational lemmata for</code> warnings. Is this expected?</p>",
        "id": 492355743,
        "sender_full_name": "Christian Merten",
        "timestamp": 1736271462
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"648495\">Christian Merten</span> <a href=\"#narrow/channel/113488-general/topic/docgen.3A.20unkown.20facet.20.60foo.3Adocs.C2.B4/near/492355743\">said</a>:</p>\n<blockquote>\n<p>Now I am trying it on a project with mathlib dependency and it has 11690 build targets (roughly two times mathlib + my project) and throws a bunch of <code>WARNING: Failed to calculate equational lemmata for</code> warnings. Is this expected?</p>\n</blockquote>\n<p>Yes, most equational lemmas are too big to be computed in a resonable amount of time.</p>",
        "id": 492356206,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1736271627
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"325367\">Mauricio Collares</span> <a href=\"#narrow/channel/113488-general/topic/docgen.3A.20unkown.20facet.20.60foo.3Adocs.C2.B4/near/492355385\">said</a>:</p>\n<blockquote>\n<p>The panics are fixed in Lean v4.16.0-rc1 (<a href=\"https://github.com/leanprover/lean4/pull/6374\">lean4#6374</a>, fixed by <a href=\"https://github.com/leanprover/lean4/pull/6375\">lean4#6375</a>), and I think they can be ignored in previous Lean versions (the docs will be generated anyway). Of course, you shouldn't update to v4.16.0-rc1 if you depend on mathlib.</p>\n</blockquote>\n<p>Correct</p>",
        "id": 492356245,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1736271645
    }
]