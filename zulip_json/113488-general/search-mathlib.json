[
    {
        "content": "<p>Hi. I also made a webpage that can search for Mathlib theorems.<br>\n<a href=\"https://huggingface.co/spaces/dx2102/search-mathlib\">https://huggingface.co/spaces/dx2102/search-mathlib</a></p>\n<p><a href=\"/user_uploads/3121/liG_VukL-v-0nCVjdA9U-z80/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/liG_VukL-v-0nCVjdA9U-z80/image.png\" title=\"image.png\"><img data-original-dimensions=\"2704x1476\" src=\"/user_uploads/thumbnail/3121/liG_VukL-v-0nCVjdA9U-z80/image.png/840x560.webp\"></a></div><p>You can find the code and data I used here. I think the code is quite short. There is only one Lean file (about 100 lines) and two Python files (about 100 lines each).<br>\n<a href=\"https://huggingface.co/spaces/dx2102/search-mathlib/tree/main\">https://huggingface.co/spaces/dx2102/search-mathlib/tree/main</a></p>\n<p><a href=\"/user_uploads/3121/eJAjLjOO65sgz9xAVl-gXBt6/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/eJAjLjOO65sgz9xAVl-gXBt6/image.png\" title=\"image.png\"><img data-original-dimensions=\"2704x1476\" src=\"/user_uploads/thumbnail/3121/eJAjLjOO65sgz9xAVl-gXBt6/image.png/840x560.webp\"></a></div><p>Lean is a difficult language. I used this project as an exercise for my learning of Lean.</p>\n<p>I originally only knew that Lean had a searcher based on symbol matching from Loogle (<a href=\"https://loogle.lean-lang.org\">https://loogle.lean-lang.org</a>). It was not until I finished making this webpage that I realized there were similar natural language-based searchers like <a href=\"https://moogle.ai\">https://moogle.ai</a> and <a href=\"https://leansearch.net/\">https://leansearch.net/</a> which was also announced today ...</p>\n<p>I think the principle of my webpage should be similar to moogle and leansearch. I used the text embedding model in natural language processing. These neural networks convert any text into a vector (e.g. a 1024-dimensional vector, represented by 1024 floating point numbers). This high-dimensional vector represents the \"embedding\" of the text in R^1024. Any two pieces of text that are semantically close should correspond to similar vectors, as one of the training objectives of the embedding model. In other words, the angle or distance between the vectors should be small, where the angle is calculated by dot product. So this technique can now be used to help search (and other tasks, such as text classification, entity recognition, and helping chatbots).</p>\n<p>I found the text embedding API service provided by VoyageAI. They are ranked high on the MTEB leaderboard, and I can use their server GPU instead of preparing one myself. They gave everyone 50 million tokens of free usage. (1 token is about 4 English characters.) After embedding Mathlib's theorems, I still have 14 million tokens of free credits left. I think this is enough to run this web page for now.</p>\n<p>For each definition and theorem in Mathlib, I found its name, type, and comment, concatenated them together, and converted them into an embedding vector. At the same time, the user's search terms are also converted into vectors, and then dot-multiplied with these 300,000 theorems to find the most similar definitions and theorems.</p>\n<p>Finally, I will briefly explain my three code files. I hope this can help people who want to do similar things.</p>\n<p>extract.lean: This is the code I modified from lean-training-data (<a href=\"https://github.com/semorrison/lean-training-data\">https://github.com/semorrison/lean-training-data</a>). I recommend lean-training-data to others who want to extract information from Lean. lean-dojo seems to be another option. The main content of the code is to import Mathlib through <code>CoreM.withImportModules #[Mathlib] do ...</code>. Then use <code>let env &larr; getEnv</code> to view and print the information in the <code>Lean.Environment</code> data structure, including theorem name, type, document string, etc. This information is stored in theorems.txt. (The export takes about 15 minutes, and the progress will be displayed).</p>\n<p>embed.ipynb: This code will call the VoyageAI API, convert each item in theories.txt into a 1024-dimensional vector, and store it in embed_arr.npy. You can view the format of name, type, and docstring concatenation here.</p>\n<p>server.py: This code will mount a simple web page on the huggingface space server. It will also forward the user's search terms to VoyageAI, convert the search terms into vectors, and then match similar ones from the vectors of existing theorem definitions.</p>\n<p>I hope this page can help others who are learning Lean understand Mathlib faster.</p>",
        "id": 455149704,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722352928
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 455158913,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722355671
    },
    {
        "content": "<p>I like that your search engine supports searching definitions unlike <a href=\"http://leansearch.net\">leansearch.net</a>.  I also think this interface is better than <a href=\"http://leansearch.net\">leansearch.net</a>, but not as google as <a href=\"http://Moogle.ai\">Moogle.ai</a>.  (Interfaces are important to get users.)</p>",
        "id": 455290672,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722405725
    },
    {
        "content": "<p>I haven’t used yours or <a href=\"http://leansearch.net\">leansearch.net</a> enough to really stress test it, but it would be fun to compare all three engines to each other.</p>",
        "id": 455290683,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722405733
    },
    {
        "content": "<p>I think it would be nice to have one (or maybe all three of) these engines available to use in the search bar for Mathlib <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a>.</p>",
        "id": 455290693,
        "sender_full_name": "Jason Rute",
        "timestamp": 1722405736
    },
    {
        "content": "<p>We could have a \"one search-bar to rule them all, one query to bind them\". Which farms out searches to these (and loogle) and aggregates the results... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 455294614,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1722407325
    },
    {
        "content": "<p>What I really care about with all these search engines is that the usual stuff we have in <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a> stays available. This includes, but is not restricted to:</p>\n<ul>\n<li>Hover to see associativity</li>\n<li>Links to declarations mentioned</li>\n<li>The \"Instances\" and \"Instances for\" lists</li>\n<li>A link to the source code</li>\n<li>A non-eye bleeding color scheme</li>\n</ul>",
        "id": 455295302,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722407657
    },
    {
        "content": "<p>There are definitely a lot of improvements that can be made. My code is really just a small prototype...</p>\n<p>First, like leansearch, you could have a large language model write a natural language description for each Lean definition or theorem. This would definitely make the results better.</p>\n<p>Regarding the style and theme, I am partially referring to the design of Loogle. Like Loogle, the theorem names you see are actually links that should lead to mathlib4_docs. You can use the link if you want more information. Currently, the theorems types are just pretty-printed into plain text by calling ppExpr, I need to look at the code of doc-gen4 to turn these into interactive html.</p>",
        "id": 455321826,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722415654
    },
    {
        "content": "<p>Perhaps it would be better to integrate these Loogle symbolic matching, text embedding, and LLM description functions directly into the mathlib docs.</p>",
        "id": 455323045,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722416033
    }
]