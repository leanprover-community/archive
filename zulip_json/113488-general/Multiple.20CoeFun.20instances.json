[
    {
        "content": "<p>Is it possible to have multiple CoeFun instances? One concrete motivation would be functors that can be applied to both objects and morphisms:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">C₂</span>\n<span class=\"w\">  </span><span class=\"n\">Fₕ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"o\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">id</span><span class=\"w\">   </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C₁</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Fₕ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">C₂</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fₕ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Fₕ</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">Fₕ</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">60</span><span class=\"w\"> </span><span class=\"s2\">\" ⇒ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Functor</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₁</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₂</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"bp\">⇒</span><span class=\"w\"> </span><span class=\"n\">C₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C₁</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"n\">c₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">Fₒ</span><span class=\"w\"> </span><span class=\"n\">c₂</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">Fₕ</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₁</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">C₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">obj₂</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoeFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"bp\">⇒</span><span class=\"w\"> </span><span class=\"n\">C₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">C₁</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">C₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">Fₒ</span>\n</code></pre></div>",
        "id": 479854502,
        "sender_full_name": "David Holmqvist",
        "timestamp": 1730373497
    },
    {
        "content": "<p>Why don't you try it out? (In your example you don't seem to be using the same <code>Category</code> definition as Mathlib -- I'd recommend using it!)</p>",
        "id": 479855636,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730373959
    },
    {
        "content": "<p>it is possible, it just means that you're going against the assumption of <del><code>autoParam</code></del><code>outParam</code> that only one such instance will exist.</p>",
        "id": 479855815,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730374019
    },
    {
        "content": "<p>I'm not sure what you mean here, <span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span>, how does <code>autoParam</code> assume uniqueness of coercions?</p>",
        "id": 479856681,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730374355
    },
    {
        "content": "<p>in my understanding/interpretation, using <del><code>autoParam</code></del><code>outParam</code> for a class definition is basically promising that all other parameters completely determine this one?</p>",
        "id": 479856991,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730374470
    },
    {
        "content": "<p>and since <code>CoeFun</code> uses <del><code>autoParam</code></del><code>outParam</code> for the resulting (function)type, a (non-binding) promise is made that coercions are unique.</p>",
        "id": 479857365,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730374624
    },
    {
        "content": "<p>Are you thinking about <code>outParam</code>?</p>",
        "id": 479857595,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730374707
    },
    {
        "content": "<p><code>autoParam</code> is for defaults provided by tactics</p>",
        "id": 479857611,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730374715
    },
    {
        "content": "<p>ah right (oops) <span aria-label=\"clown\" class=\"emoji emoji-1f921\" role=\"img\" title=\"clown\">:clown:</span></p>",
        "id": 479857647,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730374728
    },
    {
        "content": "<p>in all cases i <em>meant</em> <code>outParam</code></p>",
        "id": 479857880,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1730374806
    },
    {
        "content": "<p>I did try, but it seemed to choose the most recently defined instance unfortunately… but yes, I’m using my own definition of category, I’ll take a look at the Mathlib one.</p>\n<p>But it sounds like in general this should be possible? As in, it won’t always choose the most recently defined instance?</p>",
        "id": 479858623,
        "sender_full_name": "David Holmqvist",
        "timestamp": 1730375104
    }
]