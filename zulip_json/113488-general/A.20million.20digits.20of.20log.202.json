[
    {
        "content": "<p>A mini announcement: <a href=\"https://github.com/CBirkbeck/LeanBridge/blob/b136733232e200c75fcc0c3e7ba50e35f4f8d204/LeanBridge/Compute/LogSmallBig.lean#L937\">Here I proved a rational approximation to log 2 up to about a million digits</a>. The code is pretty messy, but it originated in work I did in early 2023, then used in <a href=\"https://github.com/b-mehta/exponential-ramsey\">my Ramsey project</a> and then updated for <span class=\"user-mention silent\" data-user-id=\"389019\">Chris Birkbeck</span>'s LeanBridge project. (Neither of these projects needed close to this much precision, but I got a bit carried away <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span> ) The key part is the command on line  928, which finds and defines the rational approximation and verifies that it's correct up to about 3321929 binary digits. None of this uses ofReduceBool, just the usual three axioms.</p>",
        "id": 554784974,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762806238
    },
    {
        "content": "<p>How easy would it be to upstream this to mathlib? To what extent can this be generalised? A tactic to approximate logarithms would be pretty nice (especially coupled with an interval arithmetic tactic that the FRO is working on, if I remember correctly).</p>",
        "id": 554789241,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762807911
    },
    {
        "content": "<p>The method here is to approximate logs of 1+1/n for arbitrary positive naturals n, then this lemma</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">decompose</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">81</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>is used to generate an approximation of log 2. So, it generalises trivially to rationals 1+1/n, and can be generalised to work for rationals which can be written as a product of things of this form. <br>\nGetting other logs can also be done (as I did in the Ramsey project), but I haven't worked on getting it to high precision (my best so far is 30 digits, compiling in about 0.1 seconds).</p>\n<p>The aim here, however, was to get a <em>high</em> precision, at the potential cost of usability. My understanding is that the general interval arithmetic work should subsume this, and be strictly more general (since it's not just for logs!), but instead the aim here was a special-purpose setup. Indeed, while <code>bound_log2'%</code> is what's in the example for a million digits, the other version <code>bound_log2%</code> is faster for up to the tens of thousands of digits, but is too memory intensive to get much higher; so there's already a tradeoff between practicality and precision.</p>\n<p>As such, it's not clear to me that this should be in mathlib? Do we really want some file in mathlib taking 10 minutes to get a million digits of this specific constant? <br>\nAnd the FRO's work, in my understanding, will likely be faster for the kind of (more reasonable) precision useful in mathlib.</p>\n<p>All that said, I'd like to make this into a standalone repo with a friendlier interface that one could import if desired, and if there's general agreement that something like this should be in mathlib, I'm not really opposed to it.</p>",
        "id": 554793095,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762809400
    },
    {
        "content": "<p>And as an aside, I also proved some more wild decompositions of log 2, but ended up not using them:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">122324552</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">929166876</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">929166875</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mi\">75806406</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">920577798</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">920577797</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mi\">58834645</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">876219201</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">876219200</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">52889168</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">658831251</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">658831250</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mi\">9727598</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">611969281</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">611969280</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">90645248</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">591130375</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">591130374</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mi\">61102303</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">490145734</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">490145733</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">108313849</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">487530862</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">487530861</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">6176249</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">457318225</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">457318224</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mi\">29974075</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">415704576</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">415704575</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">23287250</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">382241601</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">382241600</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">64465156</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">370256250</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">370256249</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">11016954</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">308950929</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">308950928</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">12805279</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">293635441</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">293635440</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span>\n<span class=\"w\">             </span><span class=\"mi\">19164767</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">136835245</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">136835244</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"k\">calc</span>\n</code></pre></div>",
        "id": 554793210,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762809440
    },
    {
        "content": "<p>Here's a PR for the main bit of analysis (it's not much!) needed for this: <a href=\"https://github.com/leanprover-community/mathlib4/pull/31487\">#31487</a></p>",
        "id": 554796699,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762810821
    },
    {
        "content": "<p>Can you point to where <code>log2Approx3321929</code> is defined? <del>Github search isn't finding it for me</del> Oh, it comes from the meta code!</p>",
        "id": 554806943,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762815608
    },
    {
        "content": "<p>Yup, this is one of the things I'd like to change, it is confusing! Ultimately using eval% would be nicer here, but currently the code <em>finding</em> the approximation and <em>proving</em> it are very tightly linked, so for now I made it just one command.</p>",
        "id": 554808959,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1762816845
    }
]