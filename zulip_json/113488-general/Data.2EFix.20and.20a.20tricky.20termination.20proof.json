[
    {
        "content": "<p>a Hi all. I'm playing around with a way to encode <code>Fix</code> for types. (I see Mathlib has <code>Fix</code>, but I don't think that'd work if I wanted to actually run the fixed point? I want something like <code>Data.Fix</code> in Haskell.) I have the following so far, which seems like it should be a good start, but there are a couple of issues:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">instFunctorF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">instMembershipF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">unfoldStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">fixF</span>\n<span class=\"w\">  </span><span class=\"n\">foldStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">fixF</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DataFix</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">fixF</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"bp\">.</span><span class=\"n\">instFunctorBase</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DataFix</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"bp\">.</span><span class=\"n\">instFunctorF</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">LawfulDataFix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">unfoldStep_foldStep_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">LeftInverse</span><span class=\"w\"> </span><span class=\"n\">foldStep</span><span class=\"w\"> </span><span class=\"n\">unfoldStep</span>\n<span class=\"w\">  </span><span class=\"n\">foldStep_unfoldStep_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">RightInverse</span><span class=\"w\"> </span><span class=\"n\">foldStep</span><span class=\"w\"> </span><span class=\"n\">unfoldStep</span>\n<span class=\"w\">  </span><span class=\"n\">unfoldStep_size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">unfoldStep</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">DataFix</span><span class=\"bp\">.</span><span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LawfulDataFix</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fixF</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">alg</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"n\">alg</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">unfoldStep</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- apply LawfulDataFix.unfoldStep_size</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The first issue is that I'm not sure about the best way to say \"when you call <code>Functor.map</code> on this, everything you find will be smaller\" — I'm currently encoding it with <code>Membership</code> but I doubt that's correct. But there's also a more basic issue, which is that I don't actually know how to access my assumptions about <code>fixF</code> in the <code>decreasing_by</code> proof. Any advice, either about the mechanics or about the broader modeling question, would be much appreciated.</p>\n<p>EDIT: I managed to get it to work with <code>PFunctor</code>, which makes a lot of sense in retrospect.</p>",
        "id": 562464932,
        "sender_full_name": "Harry Goldstein",
        "timestamp": 1765200084
    }
]