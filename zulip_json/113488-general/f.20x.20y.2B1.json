[
    {
        "content": "<p>Hi all, is there some good way to avoid this footgun (other than being careful):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>The intention was of course to write <code>f x (y+1)</code>, while this gets parsed as <code>(f x y)+1</code>, and if everything is Nat, this compiles fine and does something very different from what was the intention. Can I somehow get e.g. a lint for stuff like this?</p>",
        "id": 490417254,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734900072
    },
    {
        "content": "<p>I don't think we have that at this point, though I'm not sure about \"of course\"</p>",
        "id": 490417491,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734900343
    },
    {
        "content": "<p>I guess I'd write spaces around <code>+</code> like <code>f x y + 1</code> if I ment <code>(f x y) + 1</code>? Or do Lean users actually write <code>f x y+1</code> intentionally?</p>",
        "id": 490417624,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734900475
    },
    {
        "content": "<p>(Sorry I'm very new, and confused about lots of things, including how one is expected to format Lean 4 code.)</p>",
        "id": 490417684,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734900513
    },
    {
        "content": "<p>Lots of users, so probably someone's written that to mean what it means now</p>",
        "id": 490417733,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734900587
    },
    {
        "content": "<p>I'd probably write the spaces as well, personally</p>",
        "id": 490417779,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734900604
    },
    {
        "content": "<p>I wrestled with this for a while when I came to Lean. The rule is that functions are greedy, they will eat the next thing they see if they want an input. More precisely the binding power of a function is something like 1024, whereas the binding power of things like addition is something like 50, so the function wins easily. This isn't really something we're going to be able to lint for, this is just some basic principle of functional programming which as a mathematician I'd never seen before but soon got used to.</p>",
        "id": 490422188,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734904998
    },
    {
        "content": "<p>Note that <code>y+1</code> is bad style, we always put spaces <code>y + 1</code>, and of course you can't hope that writing <code>y+1</code> magically means \"put brackets around this thing\", that's not how computers work I guess.</p>",
        "id": 490422279,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734905093
    },
    {
        "content": "<p>I wonder if there could be a lint at least saying it's bad style? :)</p>",
        "id": 490422545,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734905302
    },
    {
        "content": "<p>A human being that changes <code>f x y+1</code> to <code>f x y + 1</code> as a result of a lint warning might also much more easily spot the bug…</p>",
        "id": 490422710,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734905492
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/f.20x.20y.2B1/near/490422279\">said</a>:</p>\n<blockquote>\n<p>Note that <code>y+1</code> is bad style, we always put spaces <code>y + 1</code>, and of course you can't hope that writing <code>y+1</code> magically means \"put brackets around this thing\", that's not how computers work I guess.</p>\n</blockquote>\n<p>Well, I've been <a href=\"https://www.joachim-breitner.de/blog/730-Less_parentheses\">dreaming</a> about a language that works that way for a while, and others have built languages that do. But most don't, lean doesn't, and probably for the better :-)</p>",
        "id": 490422838,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1734905631
    },
    {
        "content": "<p>TIL Terence Tao isn't the only one with a blog on this zulip</p>",
        "id": 490424150,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734906845
    },
    {
        "content": "<p>This is the same syntax in Haskell so maybe folks there have some suggestions.</p>",
        "id": 490448409,
        "sender_full_name": "Trebor Huang",
        "timestamp": 1734928166
    },
    {
        "content": "<p>I sometimes write <code>f x y.succ</code> so that I don't have to write the parentheses.<br>\nWriting <code>f x y+1</code> to express <code>f x y + 1</code> is abomination.</p>",
        "id": 490471422,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1734941208
    },
    {
        "content": "<p>BTW this is the reason why reading AlphaProof's output is so painful for me.</p>",
        "id": 490471775,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1734941356
    },
    {
        "content": "<p>That said, it would be really difficult to lint against it.<br>\nTo make matters worse, I can imagine writing <code>f x (y+1)</code> without spaces (basically any time <code>y</code> is not a natural number) and not wanting any complains that <code>+</code> should have spaces around it.</p>",
        "id": 490510672,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1734957114
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113488-general/topic/f.20x.20y.2B1/near/490424150\">said</a>:</p>\n<blockquote>\n<p>TIL Terence Tao isn't the only one with a blog on this zulip</p>\n</blockquote>\n<p>Did you think we were all NPCs except for him?</p>",
        "id": 490510840,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1734957174
    },
    {
        "content": "<p>Do you mean NBC (Non-blogging characters)?</p>",
        "id": 490515036,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1734958868
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <br>\nnot at all. Am i an NPC because i don't have a blog?</p>",
        "id": 490516525,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734959453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"417654\">@Martin Dvořák</span> E.g. Python has some code style <em>recommendations</em> (PEP 8) basically saying that e.g. <code>a + b*c + d</code> is OK and <code>a + b * c + d</code> is of course also OK but stuff like <code>a+b * c+d</code> is bad. That is, if you omit spaces, you can't do it in places in which spacing \"goes against precedence\". Your example would be similar. But I tried to find a Python linter that implements exactly this recommendation correctly, and failed. :)</p>",
        "id": 490564999,
        "sender_full_name": "Jukka Suomela",
        "timestamp": 1734979292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"733738\">Jukka Suomela</span> <a href=\"#narrow/channel/113488-general/topic/f.20x.20y.2B1/near/490564999\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> E.g. Python has some code style <em>recommendations</em> (PEP 8) basically saying that e.g. <code>a + b*c + d</code> is OK and <code>a + b * c + d</code> is of course also OK but stuff like <code>a+b * c+d</code> is bad. </p>\n</blockquote>\n<p>This is exactly aligned with my philosophy.</p>\n<p>However, writing such a linter for Lean would be even more difficult than for Python.</p>",
        "id": 490643729,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1735026403
    },
    {
        "content": "<p>There is a linter by <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> with a \"pedantic linter\" / \"pp-roundtrip-linter\" which seems to be somewhat what's asked here: lint anything which is pretty-printed differently than it was written.</p>\n<p>I think it's activated by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">ppRoundtrip</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 490652235,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1735031771
    },
    {
        "content": "<p>Does it trigger on things that get pretty-printed incorrectly?</p>",
        "id": 490652328,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1735031835
    },
    {
        "content": "<p>I think it compares the pretty-printed code with what's written originally and marks any difference. Kinda a first iteration of a tool like python's PEP-8.</p>\n<p>But yes, there are false-positives where the pretty-printing is not correct yet. One reason it is off by default</p>",
        "id": 490661982,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1735037658
    },
    {
        "content": "<p>I'm late to this, but what Jon said is almost exactly what the linter does: it compares the string that has been typed, with the output of pretty-printing it, allowing some slack for where to place paragraph breaks.  Besides that, it will flag any difference.  The output should not be taken too seriously, but does flag some common mistakes (as well as flagging things that it should not flag).</p>",
        "id": 491733234,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735898486
    }
]