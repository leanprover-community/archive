[
    {
        "content": "<p>Hello! I'm trying to use the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Std/Internal/Parsec/Basic.html#Std.Internal.Parsec\">Std.Internal.Parsec</a>. A very common thing is that mutual recursions and array accessing creates problems with terminations. </p>\n<p>But.. The Parsec itself is used as a monad so.. There's a more practical way to dealing with these situations or to avoiding them? Currently i am dealing with this termination problem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">pfunCall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">pcamelCase</span>\n\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">(</span><span class=\"bp\">';</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">pexpr</span><span class=\"w\"> </span><span class=\"n\">sepBy</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">,</span><span class=\"bp\">';</span>\n<span class=\"w\">  </span><span class=\"n\">skipChar</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"o\">)</span><span class=\"bp\">';</span>\n\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">EFunCall</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">args</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">pexpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">    </span><span class=\"n\">pliteral</span>\n<span class=\"w\">  </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pfunCall</span>\n<span class=\"w\">  </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pvar</span>\n<span class=\"w\">  </span><span class=\"o\">]</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>I am getting this output from lean:<br>\n\"fail to show termination for<br>\n  pfunCall<br>\n  pexpr<br>\nwith errors<br>\nfailed to infer structural recursion:<br>\nno parameters suitable for structural recursion<br>\nwell-founded recursion cannot be used, 'pfunCall' does not take any (non-fixed) arguments\"</p>\n<p>So.. because parser is a monad, how i could get fixed arguments right? I think that, this time, it should terminate because all the inputs are finite :p. </p>\n<p>~ Ty</p>",
        "id": 543947747,
        "sender_full_name": "lorã",
        "timestamp": 1760013305
    },
    {
        "content": "<p>Just make it <code>partial def</code>, the parser monad is not build for reasoning</p>",
        "id": 543948654,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1760013498
    }
]