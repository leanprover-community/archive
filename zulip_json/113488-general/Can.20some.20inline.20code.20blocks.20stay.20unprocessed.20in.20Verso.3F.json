[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span>'s <a href=\"https://github.com/teorth/analysis\">Analysis Lean companion</a> is using Verso to generate the <a href=\"https://teorth.github.io/analysis/\">website</a>. The source of truth are <a href=\"https://github.com/teorth/analysis/tree/main/analysis/Analysis\">these sheets</a> with definitions and exercise which the reader can work through in a local VS Code checkout. It's nice to be able to generate the site from them directly, but there is also a minor issue.</p>\n<p>The issue is that Verso parses the docstring and tries to interpret everything inside backticks as something resolvable. For example, consider this intro text from <a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Section_3_4.lean\">this file</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Analysis I, Section 3.4: Images and inverse images</span>\n\n<span class=\"cm\">Main constructions and results of this section:</span>\n\n<span class=\"cm\">- Images and inverse images of (Mathlib) functions, within the framework of Section 3.1 set</span>\n<span class=\"cm\">  theory. (The Section 3.3 functions are now deprecated and will not be used further.)</span>\n<span class=\"cm\">- Connection with Mathlib's image `f '' S` and preimage `f ⁻¹' S` notions.</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>In the <a href=\"https://teorth.github.io/analysis/sec34/\">generated Verso page</a>, <code>f</code> and <code>S</code> appear kind of broken:</p>\n<p><a href=\"/user_uploads/3121/GP7oNgVqjom6-PE-0KKDEqaA/Screenshot-2025-08-01-at-19.48.33.png\">Screenshot 2025-08-01 at 19.48.33.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GP7oNgVqjom6-PE-0KKDEqaA/Screenshot-2025-08-01-at-19.48.33.png\" title=\"Screenshot 2025-08-01 at 19.48.33.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1446x432\" src=\"/user_uploads/thumbnail/3121/GP7oNgVqjom6-PE-0KKDEqaA/Screenshot-2025-08-01-at-19.48.33.png/840x560.webp\"></a></div><p>It is technically possible to placate verso by literally defining them as <code>variable</code>s:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>However, they would serve no purpose for the rest of the section and pollute the tactic state scope in every theorem (which is why I <a href=\"https://github.com/teorth/analysis/pull/256\">removed them</a>). Another alternative I considered was wrapping that <code>variable</code> and the docstring into its own <code>section</code>, but this would look a bit noisy in the Verso page and probably not much less confusing. Yet another option is to rephrase such terms to avoid specific variables, e.g. write <code>Set.image</code> and <code>Set.preimage</code> instead. However, that is sometimes inconvenient. And of course one could omit the backticks altogether, but this would look worse in VS Code. This looks nice and readable:</p>\n<p><a href=\"/user_uploads/3121/LTcIHzACOZSR8fPPO0Rk5eQM/Screenshot-2025-08-01-at-19.52.29.png\">Screenshot 2025-08-01 at 19.52.29.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/LTcIHzACOZSR8fPPO0Rk5eQM/Screenshot-2025-08-01-at-19.52.29.png\" title=\"Screenshot 2025-08-01 at 19.52.29.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1782x428\" src=\"/user_uploads/thumbnail/3121/LTcIHzACOZSR8fPPO0Rk5eQM/Screenshot-2025-08-01-at-19.52.29.png/840x560.webp\"></a></div><p>Is there a nice way to get around this? What would be the idiomatic suggestion from someone familiar with how Verso is intended to be used?</p>\n<p>Thanks!</p>",
        "id": 532361742,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1754074413
    },
    {
        "content": "<p>I believe </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"n\">lit</span><span class=\"o\">}</span><span class=\"ss\">`f</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>should do what you want here. That said, I haven't tested this in the analysis project, but if not then I think it shouldn't be too hard to write a role expander for this</p>",
        "id": 532363240,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1754075024
    },
    {
        "content": "<p>I think what we want is a similar option like logInlines from one of the existing genres. As I understand it, it would do a best effort elaboration and just not show the errors. </p>\n<p>This is nice, because it will then still link constants, but not complain if stuff is not fully typed.</p>\n<p>I've been a bit busy with other projects, so feel free to remove the sections and/or apply Bhaviks suggestion in the mean time.</p>\n<p>(As a side note, maybe this thread would be better suited in the Analysis book stream.)</p>",
        "id": 532484914,
        "sender_full_name": "Pim Otte",
        "timestamp": 1754165903
    },
    {
        "content": "<p>I couldn't get <code>{lit}</code> working in the analysis project (maybe it has the wrong genre?) but I put up a <a href=\"https://github.com/teorth/analysis/pull/264\">PR</a> to at least disable the wavy underline. (The hovers don't seem to be configurable via CSS)</p>",
        "id": 532521019,
        "sender_full_name": "Li Xuanji",
        "timestamp": 1754199689
    },
    {
        "content": "<p>I just saw this thread - sorry for not seeing it before. The right short-term solution here is to have Verso's heuristic attempt to interpret Markdown just give up in these cases, rather than rendering an error message, like <span class=\"user-mention\" data-user-id=\"519269\">@Pim Otte</span> is suggesting.</p>\n<p>I'm working on bringing Verso syntax to docstrings, and that will solve the problem - fundamentally, the issue here is that Markdown provides no way to say which code elements are intended to be references, and which aren't.  Then something like <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>'s suggestion will work.</p>",
        "id": 532931005,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754404679
    },
    {
        "content": "<p>Thanks! I’m not sure if <code>{lit}</code> is a bit heavy-handed syntax wise. Part of the point is to make reading in the editor intuitive, and unusual syntax may raise more questions. Not that I have a better suggestion.</p>",
        "id": 532932950,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1754405342
    },
    {
        "content": "<p>That syntax won't be necessary. It's used in the various Verso books because there's a linter that attempts to suggest various things that a backticked element could be (e.g. variable, tactic name, keyword) and suggests annotating it as such, and <code>{lit}</code> silences the linter and says \"no, this is really just plain monospace text\". It would work equally well to disable that linter.</p>",
        "id": 532935983,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754406260
    }
]