[
    {
        "content": "<p>Hi, <br>\nI'm working through implmenting the do unchained paper, and the lean compiler seems to be saying that I haven't implemented an elaborator even though i did implment it.</p>\n<p>Here's a mwe to reproduce the bug.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"do'\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"d!\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n<span class=\"c1\">-- (D1)</span>\n<span class=\"n\">macro_rules</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"expand!\"</span><span class=\"w\"> </span><span class=\"n\">expander</span><span class=\"w\"> </span><span class=\"s2\">\"in\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"n\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return'\"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n<span class=\"c1\">-- (1')</span>\n<span class=\"n\">macro_rules</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ExceptCpsT.runCatch</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">expand</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">))</span>\n\n<span class=\"c1\">-- (R1)</span>\n<span class=\"n\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">stmt</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">expand</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id.run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">expand</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return'</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">elaboration function for 'termD!_' has not been implemented</span>\n<span class=\"cm\">  d! expand! return in return' 10</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 476185360,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1728581456
    },
    {
        "content": "<p>Macro expansion works top-down, so no rule is applicable at the given term. Nested macros need to be expanded recursively as in <a href=\"https://github.com/Kha/do-supplement/blob/master/Do/Basic.lean\">https://github.com/Kha/do-supplement/blob/master/Do/Basic.lean</a>.</p>",
        "id": 476209810,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728588879
    },
    {
        "content": "<p>How come when I set it up like this I still get the same error?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"do'\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"d!\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"expand!\"</span><span class=\"w\"> </span><span class=\"n\">expander</span><span class=\"w\"> </span><span class=\"s2\">\"in\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return'\"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n\n<span class=\"kn\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">stmt</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- (1')</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- (D1)</span>\n\n<span class=\"kn\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ExceptCpsT</span><span class=\"bp\">.</span><span class=\"n\">runCatch</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- (R1)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return'</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">elaboration function for 'termD!_' has not been implemented</span>\n<span class=\"cm\">  d! expand! return in return' 10</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 476211616,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1728589518
    },
    {
        "content": "<p>The order of rules doesn't matter when there are no overlapping patterns. What I mean by top-down is that expansion starts of the root of the syntax tree but there is no rule that matches <code>d! expand! ...</code></p>",
        "id": 476212986,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728589999
    },
    {
        "content": "<p>k thxs that makes a lot of sense.<br>\nNow i can get the elaboration to work but it won't recognize throw for some reason</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"do'\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"d!\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"expand!\"</span><span class=\"w\"> </span><span class=\"n\">expander</span><span class=\"w\"> </span><span class=\"s2\">\"in\"</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">expander</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"return\"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stmt</span>\n\n<span class=\"c1\">-- helper function; see usage below</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">expandStmt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`stmt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MacroM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`stmt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">expandMacros</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">Macro</span><span class=\"bp\">.</span><span class=\"n\">throwUnsupported</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"c1\">-- There is no static guarantee that `expandMacros` stays in the `stmt` category,</span>\n<span class=\"w\">    </span><span class=\"c1\">-- but it is true for all our macros</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">TSyntax</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">s'</span>\n\n<span class=\"kn\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">stmt</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- (1')</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"c1\">-- fallback rule: try to expand abbreviation</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">expandStmt</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">    </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"kn\">macro_rules</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ExceptCpsT</span><span class=\"bp\">.</span><span class=\"n\">runCatch</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">s</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- (R1)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">d!</span><span class=\"w\"> </span><span class=\"n\">expand!</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">  elaboration function for 'termD!_' has not been implemented</span>\n<span class=\"cm\">  d! throw✝ 10</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 476214836,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1728590550
    },
    {
        "content": "<p>why is throw getting shadowed?</p>",
        "id": 476214887,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1728590568
    },
    {
        "content": "<p>Likely your rule 1' is creating an invalid syntax tree as it returns a term where a stmt is expected - while it is possible to <em>embed</em> the former into the latter, the former is not structurally a subset of the latter. <code> `(stmt| throw $e) </code> might work.</p>",
        "id": 476216476,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1728591180
    },
    {
        "content": "<p>yeah that fixed it thanks.<br>\nnow im getting<br>\n<code>failed to synthesize instance\n  MonadExcept ?m.10774 Id</code><br>\nwhat is an example of a monad that actually supports throw? would <code>ExceptT Nat</code> work?</p>",
        "id": 476217369,
        "sender_full_name": "Frederick Pu",
        "timestamp": 1728591529
    }
]