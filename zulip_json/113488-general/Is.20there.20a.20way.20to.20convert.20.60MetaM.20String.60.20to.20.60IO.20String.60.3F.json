[
    {
        "content": "<p>Is there a way to convert <code>MetaM String</code> to <code>IO String</code>?</p>",
        "id": 511796363,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744452010
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">TrainingData</span><span class=\"bp\">.</span><span class=\"n\">Frontend</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">TrainingData</span><span class=\"bp\">.</span><span class=\"n\">InfoTree</span><span class=\"bp\">.</span><span class=\"n\">ToJson</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">CoreM</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Cli</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"w\"> </span><span class=\"n\">System</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fun1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fun2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">fun1</span>\n</code></pre></div>\n<p>Like this, how to solve the error?</p>",
        "id": 511796609,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744452243
    },
    {
        "content": "<p>There is a monad map in the mathlib4 wiki page: I'm on mobile and find it hard to give a link, though.</p>",
        "id": 511796833,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1744452406
    },
    {
        "content": "<p>There you can probably find a path of <code>lift</code> and <code>run</code> that might take you from one monad to the other.</p>",
        "id": 511796879,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1744452439
    },
    {
        "content": "<p>This? <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Monad-map\">https://github.com/leanprover-community/mathlib4/wiki/Monad-map</a></p>",
        "id": 511796920,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744452482
    },
    {
        "content": "<p>Yes, that's what I had in mind!</p>",
        "id": 511797137,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1744452664
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> It is still difficult for me <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 511799001,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744454224
    },
    {
        "content": "<p>This topic was also discussed here: <a href=\"#narrow/channel/270676-lean4/topic/MetaM.20String.20-.3E.20IO.20String\">#lean4 &gt; MetaM String -&gt; IO String</a></p>",
        "id": 511801192,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1744455907
    },
    {
        "content": "<p>One way of doing this would be to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.MetaM.toIO#doc\">docs#Lean.Meta.MetaM.toIO</a></p>",
        "id": 511801460,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1744456106
    },
    {
        "content": "<p>Using <code>Meta.toIO</code> probably won’t get you far because you need the core state and context. I suggest using <code>withImports…</code> as mentioned in the discussion in the first link Paul mentioned.</p>",
        "id": 511846361,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1744493431
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376152\">@Paul Lezeau</span>  <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span>  It is solved, thank you!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">TrainingData</span><span class=\"bp\">.</span><span class=\"n\">Frontend</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">TrainingData</span><span class=\"bp\">.</span><span class=\"n\">InfoTree</span><span class=\"bp\">.</span><span class=\"n\">ToJson</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">CoreM</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Cli</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"w\"> </span><span class=\"n\">System</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CoreM</span><span class=\"bp\">.</span><span class=\"n\">withImportModules</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`Mathlib</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">run'</span>\n\n<span class=\"c1\">-- #eval foo &lt;| show MetaM Unit from do</span>\n<span class=\"c1\">--   let env ← getEnv</span>\n<span class=\"c1\">--   println! env.constants.toList.length</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fun1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fun2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">fun1</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">s</span>\n</code></pre></div>",
        "id": 511865942,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744512152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> has marked this topic as resolved.</p>",
        "id": 511867278,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744513555
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> has marked this topic as unresolved.</p>",
        "id": 511879765,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744525175
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376152\">@Paul Lezeau</span> <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span> By the way, Is there a way to convert <code>TacticM String</code> to <code>IO String</code>?</p>",
        "id": 511879841,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744525227
    },
    {
        "content": "<p>As Kyle mentionned in the other thread, there are ways to run TacticM from within MetaM, but it’s possible those aren’t exactly what you’re looking for - would you mind saying a little more about what you’re trying to do?</p>",
        "id": 511902129,
        "sender_full_name": "Paul Lezeau",
        "timestamp": 1744545506
    }
]