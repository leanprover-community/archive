[
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> , how to use <a href=\"https://github.com/leanprover/lean4/blob/master/script/Shake.lean\">https://github.com/leanprover/lean4/blob/master/script/Shake.lean</a> ? <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> mentioned the tool in <a href=\"https://sites.google.com/view/lean-at-googl-2025/home\">his talk</a>, but I didn't understand how to 'add' this script in a project. I downloaded the file, added </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">lean_exe</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"shake\"</span>\n<span class=\"n\">root</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Shake\"</span>\n<span class=\"n\">supportInterpreter</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>in my <code>lakefile.toml</code> but I am getting a lot of errors </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">shake</span>\n<span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Shake</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">LEAN_PATH</span><span class=\"bp\">=/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Cli</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">Qq</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">aesop</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">importGraph</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">LeanSearchClient</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">plausible</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/</span><span class=\"n\">r</span><span class=\"bp\">/</span><span class=\"n\">bignum</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">ar</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.26.0-rc2/bin/lean /Users/ar/r/bignum/Shake.lean -o /Users/ar/r/bignum/.lake/build/lib/lean/Shake.olean -i /Users/ar/r/bignum/.lake/build/lib/lean/Shake.ilean -c /Users/ar/r/bignum/.lake/build/ir/Shake.c --setup /Users/ar/r/bignum/.lake/build/ir/Shake.setup.json --json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Shake</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">334</span><span class=\"o\">:</span><span class=\"mi\">27</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">identifier</span><span class=\"w\"> </span><span class=\"ss\">`indirectModUseExt.getState</span><span class=\"bp\">`</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Shake</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">411</span><span class=\"o\">:</span><span class=\"mi\">39</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Use</span><span class=\"w\"> </span><span class=\"ss\">`String.Pos.Raw</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">instead</span>\n</code></pre></div>",
        "id": 563908590,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1765827263
    },
    {
        "content": "<p>We have shake running in CI already.</p>",
        "id": 563908899,
        "sender_full_name": "Chris Henson",
        "timestamp": 1765827352
    },
    {
        "content": "<p>I recently added description at the bottom of CONTRIBUTING.md, it is just run via <code>lake exe shake</code>.</p>",
        "id": 563910722,
        "sender_full_name": "Chris Henson",
        "timestamp": 1765827896
    },
    {
        "content": "<p>I got it <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> , I am asking about how to make it run in a fresh project...    It seems the Shake.lean file I mentioned is different from the one in the Batteries (batteries/Shake/Main.lean).</p>",
        "id": 563911397,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1765828104
    },
    {
        "content": "<p>I assumed this was a CSLib question given the channel.</p>",
        "id": 563913965,
        "sender_full_name": "Chris Henson",
        "timestamp": 1765828910
    },
    {
        "content": "<p>My advice would be to add batteries as a dependency and run <code>lake exe shake</code> as usual.</p>",
        "id": 563914090,
        "sender_full_name": "Chris Henson",
        "timestamp": 1765828943
    },
    {
        "content": "<p>(assuming it is not available by default)</p>",
        "id": 563914490,
        "sender_full_name": "Chris Henson",
        "timestamp": 1765829089
    },
    {
        "content": "<p>Yes, you are right. My fault for reusing the thread. Thank you for the advice.</p>",
        "id": 563914491,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1765829089
    },
    {
        "content": "<p>8 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"513188\" href=\"/#narrow/channel/513188-CSLib/topic/Upcoming.20closure.20results.20for.20regular.20languages.20in.20mathlib/with/563079020\">#CSLib &gt; Upcoming closure results for regular languages in mathlib</a> by <span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span>.</p>",
        "id": 564155030,
        "sender_full_name": "Notification Bot",
        "timestamp": 1765931636
    },
    {
        "content": "<p>Reporting what I understood. <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>  mentioned the latest version of Shake in his talk at <a href=\"https://sites.google.com/view/lean-at-googl-2025/\">https://sites.google.com/view/lean-at-googl-2025/</a>. The file is <a href=\"https://github.com/leanprover/lean4/blob/master/script/Shake.lean\">here</a>.</p>\n<p>But apparently, another old version of Shake already exists in Batteries! Any project that imports Batteries already has the command below available.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>shake\n</code></pre></div>\n<p>To use this latest version, I downloaded it and saved it at the root of my project. Then I added to <code>lakefile.toml</code>:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[lean_exe]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"sh\"</span>\n<span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Shake\"</span>\n</code></pre></div>\n<p>I used the name<code>sh</code>, so that Lake executes this file and not <code>./.lake/packages/batteries/Shake/Main.lean</code>. Does it make sense?</p>",
        "id": 564248691,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1765977306
    },
    {
        "content": "<p>If it works, sure. And then we'll figure out the rest when packaging it for Mathlib.</p>",
        "id": 564287292,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1765987355
    }
]