[
    {
        "content": "<p>How to get current date by Lean?</p>\n<h3>Background</h3>\n<p>I'm working CLI tool in Lean. I don't want to specify version info manually.<br>\nSo, I came up with the idea of making the result of running <code>--version</code> be (the Lean version) + (the release date). That way, there should be no need to specify the output of <code>--version</code> manually.</p>\n<p>see <a href=\"https://github.com/Seasawher/mdgen/issues/106\">https://github.com/Seasawher/mdgen/issues/106</a> for more detail</p>",
        "id": 543055413,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759549370
    },
    {
        "content": "<p>Are you looking for something like what <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Time.Timestamp.now#doc\">docs#Std.Time.Timestamp.now</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Time.DateTime.now#doc\">docs#Std.Time.DateTime.now</a> gives?</p>",
        "id": 543055940,
        "sender_full_name": "Chris Henson",
        "timestamp": 1759550113
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 543056282,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759550528
    },
    {
        "content": "<p>But how can I convert the current time, which is wrapped in the IO monad, into a String…?</p>",
        "id": 543056690,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759550952
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Std.Time.DateTime, String</p>",
        "id": 543057092,
        "sender_full_name": "Chris Henson",
        "timestamp": 1759551423
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Std/Time/Format/Basic.html#Std.Time.GenericFormat.format\">Std.Time.GenericFormat.format</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Std/Time/Format.html#Std.Time.DateTime.toAscTimeString\">Std.Time.DateTime.toAscTimeString</a>, and <a href=\"https://loogle.lean-lang.org/?q=Std.Time.DateTime%2C%20String\">10 more</a></p>",
        "id": 543057096,
        "sender_full_name": "loogle",
        "timestamp": 1759551425
    },
    {
        "content": "<p>We need to write elaborator to get a String representing current date…?</p>",
        "id": 543057153,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759551506
    },
    {
        "content": "<p>Oh, I see. From the link above, you want this to go inside the <code>Cli</code> DSL? I've not used that library before, sorry.</p>",
        "id": 543057469,
        "sender_full_name": "Chris Henson",
        "timestamp": 1759551948
    },
    {
        "content": "<p>Yes!</p>",
        "id": 543057538,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759552029
    },
    {
        "content": "<p>is <br>\n<code>let now := (← Std.Time.PlainDate.now) |&gt;.format \"uuuu-MM-dd\"</code><br>\nwhat you want? That's run in the  <code>IO</code> monad</p>",
        "id": 543180982,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1759685992
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> </p>\n<p>Thank you. I will try this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Get the release date of the project -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getReleaseDate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"bp\">.</span><span class=\"n\">PlainDate</span><span class=\"bp\">.</span><span class=\"n\">now</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"bp\">.</span><span class=\"n\">format</span><span class=\"w\"> </span><span class=\"s2\">\"uuuu-MM-dd\"</span>\n\n<span class=\"sd\">/-- version message of `mdgen --version` -/</span>\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">versionMsg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">dateExcept</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unsafeIO</span><span class=\"w\"> </span><span class=\"n\">getReleaseDate</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">dateExcept</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">date</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"unknown date\"</span>\n<span class=\"w\">  </span><span class=\"n\">s!</span><span class=\"s2\">\"{Lean.versionString} (released on {date})\"</span>\n\n<span class=\"sd\">/-- API definition of `mdgen` command -/</span>\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkMdgenCmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">Cli</span><span class=\"bp\">|</span>\n<span class=\"w\">  </span><span class=\"n\">mdgen</span><span class=\"w\"> </span><span class=\"n\">VIA</span><span class=\"w\"> </span><span class=\"n\">runMdgenCmd</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">versionMsg</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"s2\">\"mdgen is a tool to generate .md files from .lean files.\"</span>\n\n<span class=\"w\">  </span><span class=\"n\">FLAGS</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"Counts the total number of characters in the input Lean files. However, please be aware that the output may not be entirely accurate.\"</span>\n<span class=\"w\">    </span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exercise</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"Erases parts of Lean code and replaces them with sorry.\"</span>\n\n<span class=\"w\">  </span><span class=\"n\">ARGS</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">input_dir</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"The directory containing the input Lean files.\"</span>\n<span class=\"w\">    </span><span class=\"n\">output_dir</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"The directory to write the markdown files.\"</span>\n<span class=\"o\">]</span>\n</code></pre></div>",
        "id": 543191520,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759696624
    },
    {
        "content": "<p>Usually version dates indicate when the code was changed, not when it was compiled</p>",
        "id": 543193607,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759699187
    },
    {
        "content": "<p>Especially since Lean projects are almost always shipped as source</p>",
        "id": 543193636,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759699215
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> Thanks.</p>\n<p>How about this? This code get release date from git.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Get the release date of the project -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getReleaseDate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Process</span><span class=\"bp\">.</span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"git\"</span>\n<span class=\"w\">    </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"log\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"-1\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"--format=%cs\"</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">trimRight</span>\n\n<span class=\"sd\">/-- version message of `mdgen --version` -/</span>\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">versionMsg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">dateExcept</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unsafeIO</span><span class=\"w\"> </span><span class=\"n\">getReleaseDate</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">dateExcept</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">date</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">date</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"unknown date\"</span>\n<span class=\"w\">  </span><span class=\"n\">s!</span><span class=\"s2\">\"{Lean.versionString} (released on {date})\"</span>\n\n<span class=\"sd\">/-- API definition of `mdgen` command -/</span>\n<span class=\"n\">unsafe</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkMdgenCmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cmd</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">Cli</span><span class=\"bp\">|</span>\n<span class=\"w\">  </span><span class=\"n\">mdgen</span><span class=\"w\"> </span><span class=\"n\">VIA</span><span class=\"w\"> </span><span class=\"n\">runMdgenCmd</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">versionMsg</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"s2\">\"mdgen is a tool to generate .md files from .lean files.\"</span>\n\n<span class=\"w\">  </span><span class=\"n\">FLAGS</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"Counts the total number of characters in the input Lean files. However, please be aware that the output may not be entirely accurate.\"</span>\n<span class=\"w\">    </span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exercise</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"Erases parts of Lean code and replaces them with sorry.\"</span>\n\n<span class=\"w\">  </span><span class=\"n\">ARGS</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">input_dir</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"The directory containing the input Lean files.\"</span>\n<span class=\"w\">    </span><span class=\"n\">output_dir</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"s2\">\"The directory to write the markdown files.\"</span>\n<span class=\"o\">]</span>\n</code></pre></div>",
        "id": 543193660,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759699262
    },
    {
        "content": "<p>That's a little better, but calling git every time your binary is invoked sounds like a bad idea</p>",
        "id": 543193793,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759699441
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> </p>\n<p>so you mean \"getting version info automatically\" is bad idea?</p>",
        "id": 543193840,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759699519
    },
    {
        "content": "<p>Well, ideally you would only call git when you pass the<code>--version</code> flag, so as not to slow things down</p>",
        "id": 543194204,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759699948
    },
    {
        "content": "<p>But yes, doing this automatically seems fishy to me</p>",
        "id": 543194247,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1759700011
    },
    {
        "content": "<p>ok, I should check version info automatically when developing it?</p>",
        "id": 543194326,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1759700094
    }
]