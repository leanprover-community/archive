[
    {
        "content": "<p>What is the difference between <code>always_inline</code>, and  <code>inline</code> in function definitions?</p>",
        "id": 480262011,
        "sender_full_name": "Carbon",
        "timestamp": 1730593480
    },
    {
        "content": "<p>It looks like the only difference is that one day <code>inline</code> might be conditional on some sort of quota.</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Compiler.LCNF.Simp.inlineCandidate%3F#doc\">docs#Lean.Compiler.LCNF.Simp.inlineCandidate?</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">alwaysInlineAttr</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">      </span><span class=\"c1\">-- TODO: check inlining quota</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">inlineAttr</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">inlineIfReduceAttr</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 480262887,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730594291
    },
    {
        "content": "<p>That sounds quite hard to implement correctly, since mismatching <code>inline</code> attributes were the cause of a performance bug <a href=\"#narrow/channel/270676-lean4/topic/Compiler.20inserts.20.60instDecidableCoprime.60.3F/near/444763735\">here</a></p>",
        "id": 480264070,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730595546
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/stream/113488-general/topic/Function.20inlining/near/480262887\">said</a>:</p>\n<blockquote>\n<p>It looks like the only difference is that one day <code>inline</code> might be conditional on some sort of quota.</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Compiler.LCNF.Simp.inlineCandidate%3F#doc\">docs#Lean.Compiler.LCNF.Simp.inlineCandidate?</a></p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">alwaysInlineAttr</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">      </span><span class=\"c1\">-- TODO: check inlining quota</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">inlineAttr</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"bp\">.</span><span class=\"n\">inlineIfReduceAttr</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Note that you are looking at new compiler code, this is not the logic that is currently implemented</p>",
        "id": 480299272,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1730632344
    },
    {
        "content": "<p>Do you know what the current logic is <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> ?</p>",
        "id": 480315889,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730648113
    },
    {
        "content": "<p>It's somewhere in the C++ part of the old compiler but I don't know by heart hwere</p>",
        "id": 480315978,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1730648175
    }
]