[
    {
        "content": "<p>Since yesterday I've been having problems with the workflows in <a href=\"https://github.com/HEPLean/PhysLean\">PhysLean</a>. The workflow in question is controlled by  <a href=\"https://github.com/HEPLean/PhysLean/blob/master/.github/workflows/build.yml\">this yml file</a>.</p>\n<p>The problem I am having is that the following step does not terminate:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">PhysLean</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{{</span><span class=\"w\"> </span><span class=\"n\">always</span><span class=\"o\">()</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">steps</span><span class=\"bp\">.</span><span class=\"n\">build</span><span class=\"bp\">.</span><span class=\"n\">outcome</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">success'</span><span class=\"w\"> </span><span class=\"bp\">||</span><span class=\"w\"> </span><span class=\"n\">steps</span><span class=\"bp\">.</span><span class=\"n\">build</span><span class=\"bp\">.</span><span class=\"n\">outcome</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">failure'</span><span class=\"w\"> </span><span class=\"o\">}}</span>\n<span class=\"w\">        </span><span class=\"n\">id</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lint</span>\n<span class=\"w\">        </span><span class=\"n\">uses</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">liskin</span><span class=\"bp\">/</span><span class=\"n\">gh</span><span class=\"bp\">-</span><span class=\"n\">problem</span><span class=\"bp\">-</span><span class=\"n\">matcher</span><span class=\"bp\">-</span><span class=\"n\">wrap</span><span class=\"bp\">@</span><span class=\"n\">v3</span>\n<span class=\"w\">        </span><span class=\"k\">with</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"n\">linters</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gcc</span>\n<span class=\"w\">          </span><span class=\"n\">run</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">PhysLean</span>\n</code></pre></div>\n<p>In <a href=\"https://github.com/HEPLean/PhysLean/pull/777\">PhysLean#777</a> it worked (i.e. terminated) on one commit and then stopped working after that. On another PR it did not work yesterday, worked once this morning, and then didn't again. </p>\n<p>Caveat: I did update the linters on PhysLean, but this was as done in reaction to this problem, and is not the cause of it. </p>\n<p>I am pretty confused with what is happening here. Has anyone experienced anything similar? I think it is likely a github workflow problem, but it seems odd it is always happening on the same part of the workflow. Alternatively it could be something to do with the recent bump to Lean. </p>\n<p>(I am aware of lean-action, and know we should really be using that, there are just a lot of custom things we want for PhysLean currently).</p>",
        "id": 546385810,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761118956
    },
    {
        "content": "<p>Simplifying the above step to the following: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">PhysLean</span>\n<span class=\"w\">        </span><span class=\"n\">run</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span>\n<span class=\"w\">          </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">runLinter</span><span class=\"w\"> </span><span class=\"n\">PhysLean</span>\n</code></pre></div>\n<p>Still leads to non-terminating runs. Locally everything runs fine.</p>",
        "id": 546421343,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761129534
    },
    {
        "content": "<p>I have been doing some testing with this and the short conclusion of my results is: </p>\n<p>I can't seem to get <code>lake exe runLinter PhysLean</code> to work consistently in a github workflow, no matter what I try. It always fluctuates from working on one run to not terminating on others. </p>\n<p>Thus, I took an extreme option and made a new version of the runLinter script that is stripped down to the bare necessities. This can be found at this PR <a href=\"https://github.com/HEPLean/PhysLean/pull/786\">PhysLean#786</a>. This stripped down version appears to run correctly every time, it does not have this problem where it doesn't terminate as described above. (Although I'm still holding my breath). </p>\n<p>Comparing my stripped down <a href=\"https://github.com/HEPLean/PhysLean/blob/4dff21f807e7c07c5f4fdbab789220f7ee8f5de3/scripts/MetaPrograms/runPhysLeanLinters.lean\">version</a>, with the actual runLinter <a href=\"https://github.com/leanprover-community/batteries/blob/main/scripts/runLinter.lean\">script</a>, the main differences appear to be down to reading json files and resolving the modules to lint. This is the limit of my investigation thus far.</p>",
        "id": 546934304,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761322459
    },
    {
        "content": "<p>Just linking <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/CI.20stuck.20at.20Lint.20project.20step/with/554276945\">#general &gt; CI stuck at Lint project step</a>  which seems to be another instance of the same problem.</p>",
        "id": 554699497,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1762781018
    }
]