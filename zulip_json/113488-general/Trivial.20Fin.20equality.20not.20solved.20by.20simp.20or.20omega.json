[
    {
        "content": "<p>I found neither simp nor omega were able to solve a seemingly trivial Fin equality. Shouldn't omega be able to solve this? Is there a missing simp theorem?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- unsolved goal</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"w\"> </span><span class=\"c1\">-- omega could not prove the goal</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- ok</span>\n</code></pre></div>",
        "id": 476816103,
        "sender_full_name": "Francisco Giordano",
        "timestamp": 1728921562
    },
    {
        "content": "<p>Uint8 is not yet included in the scope of omega. That could change in the future, I don't know about the exact plans here</p>",
        "id": 476820230,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1728923232
    },
    {
        "content": "<p>Omega or not, I'm surprised there isn't a simp lemma for this</p>",
        "id": 476833216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728929603
    },
    {
        "content": "<p>After looking at this a bit more I can't come up with a reasonable simp lemma that would help here. I was trying something like this but it's too specific and I can't even get it to work with the [simp] attribute:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val_ofNat_eq_ofNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 477067883,
        "sender_full_name": "Francisco Giordano",
        "timestamp": 1729025153
    },
    {
        "content": "<p>You need</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val_ofNat_eq_ofNat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt8</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">no_index</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 477077688,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729029644
    },
    {
        "content": "<p>There is a library note in mathlib about this, search for \"no_index around OfNat.ofNat\"</p>",
        "id": 477077779,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729029688
    },
    {
        "content": "<p>Unfortunately these don't yet surface in the docs</p>",
        "id": 477077797,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729029697
    },
    {
        "content": "<p>Wow, that does fix it! Thanks.</p>\n<p>Link for others: <a href=\"https://github.com/leanprover-community/mathlib4/blob/af9a9c9ca2d15cc943a98510094e76a55cd8d988/Mathlib/Data/Nat/Cast/Defs.lean#L60-L66\">https://github.com/leanprover-community/mathlib4/blob/af9a9c9ca2d15cc943a98510094e76a55cd8d988/Mathlib/Data/Nat/Cast/Defs.lean#L60-L66</a></p>",
        "id": 477078565,
        "sender_full_name": "Francisco Giordano",
        "timestamp": 1729030077
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>, I don't want to PR this because you are about to change UInt, but could you arrange that <code>UIntX.val_ofNat</code> is available as appropriate?</p>",
        "id": 477089643,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1729035784
    },
    {
        "content": "<p>Yes</p>",
        "id": 477130223,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1729059329
    },
    {
        "content": "<p>Done in <a href=\"https://github.com/leanprover/lean4/pull/5735\">https://github.com/leanprover/lean4/pull/5735</a></p>",
        "id": 477191517,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1729078268
    }
]