[
    {
        "content": "<p>The link appears to be dead for me - am I just too keen?</p>",
        "id": 522528876,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749111595
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/113486-announce/topic/v4.2E21.2E0-rc3/near/522528876\">said</a>:</p>\n<blockquote>\n<p>The link appears to be dead for me - am I just too keen?</p>\n</blockquote>\n<p>Sorry, a copy/paste error. Thanks for spotting, should be fixed now!</p>",
        "id": 522529054,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1749111648
    },
    {
        "content": "<p>2 messages were moved here from <a class=\"stream-topic\" data-stream-id=\"113486\" href=\"/#narrow/channel/113486-announce/topic/v4.2E21.2E0-rc3/with/522528603\">#announce &gt; v4.21.0-rc3</a> by <span class=\"user-mention silent\" data-user-id=\"238446\">Anne Baanen</span>.</p>",
        "id": 522529099,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749111662
    },
    {
        "content": "<p>Oh, apologies for replying in the wrong place! Thanks for the fix.</p>",
        "id": 522529197,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749111692
    },
    {
        "content": "<p>No worries at all! We like to keep the announce threads short, but it was better to get this fixed quickly :)</p>",
        "id": 522529571,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1749111786
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/8291\">lean4#8291</a> is nice</p>",
        "id": 522529617,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749111800
    },
    {
        "content": "<p>... though I would argue that <code>zero_lt_one</code> and <code>castSucc_one</code> could have been changed.</p>",
        "id": 522529863,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749111862
    },
    {
        "content": "<p>I adore all the improvements in <code>Array</code> in the last year or so.</p>",
        "id": 522531768,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1749112421
    },
    {
        "content": "<p>I think the release notes are missing <a href=\"https://github.com/leanprover/lean4/pull/7428\">lean#7428</a>. This is what gave the major simp performance improvement.</p>",
        "id": 522551382,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1749117986
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span>, could you track down why this is missing in the release notes, and make sure it gets in? We definitely want to acknowledge that one!</p>",
        "id": 522561683,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749121188
    },
    {
        "content": "<p>Likely because it doesn't have a <code>changelog-</code> label. We don't force one for <code>perf:</code> commit... yet?</p>",
        "id": 522564459,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1749122140
    },
    {
        "content": "<p>Yes, let's. It's a shame to miss these from the release notes.</p>",
        "id": 522565353,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1749122451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E21.2E0-rc3/near/522551382\">said</a>:</p>\n<blockquote>\n<p>I think the release notes are missing <a href=\"https://github.com/leanprover/lean4/pull/7428\">lean#7428</a>. This is what gave the major simp performance improvement.</p>\n</blockquote>\n<p>We should definitely include that! I have opened a PR to mention this in the release notes. If it looks good to you, feel free to rebase-merge: <a href=\"https://github.com/leanprover/reference-manual/pull/462\">https://github.com/leanprover/reference-manual/pull/462</a></p>",
        "id": 522579531,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1749126483
    },
    {
        "content": "<h1>v4.21.0</h1>",
        "id": 526346913,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1751272380
    },
    {
        "content": "<p>I encountered a weird issue I had never seen before. Here is how to reproduce:</p>\n<ol>\n<li>Clone <a href=\"https://github.com/YaelDillies/Toric\">https://github.com/YaelDillies/Toric</a></li>\n<li>Checkout <code>6537a03</code></li>\n<li>Pin the version of mathlib to <code>v4.21.0</code> in the TOML</li>\n<li>Run <code>lake update</code></li>\n<li>Run <code>lake build</code></li>\n</ol>",
        "id": 526347262,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1751272504
    },
    {
        "content": "<p>Instead of building Toric as expected, it rebuilds batteries, mathlib, etc...</p>",
        "id": 526347348,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1751272532
    },
    {
        "content": "<p>If you further do:</p>\n<ol start=\"6\">\n<li>Cancel the build</li>\n<li><code>rm -rf .lake</code></li>\n<li><code>lake exe cache get</code></li>\n<li><code>lake build</code></li>\n</ol>",
        "id": 526347458,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1751272566
    },
    {
        "content": "<p>then things work as expected. What's going on?</p>",
        "id": 526347498,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1751272578
    },
    {
        "content": "<p>Same in PNT+ and sphere-eversion (though I used <code>get!</code> in 8 without trying plain <code>get</code> first)</p>",
        "id": 526348136,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751272778
    },
    {
        "content": "<p>I'll try reproducing but in the meantime - what's the previous version you know that worked, 4.20.0?</p>",
        "id": 526349808,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751273313
    },
    {
        "content": "<p>I bumped straight from 4.20.0, yeah</p>",
        "id": 526350665,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1751273568
    },
    {
        "content": "<p>I can reproduce with the added step <code>lake exe cache get</code> between steps 2 and 3</p>",
        "id": 526352199,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751273976
    },
    {
        "content": "<p>As far as I can tell, this is because leantar started skipping files that look up to date, but they only do so when looking at the githash and not the release string:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>lean<span class=\"w\"> </span>+4.21.0<span class=\"w\"> </span>--version\n<span class=\"go\">Lean (version 4.21.0, x86_64-unknown-linux-gnu, commit 6741444a63ee, Release)</span>\n<span class=\"gp\">$ </span>lean<span class=\"w\"> </span>+4.21.0-rc3<span class=\"w\"> </span>--version\n<span class=\"go\">Lean (version 4.21.0-rc3, x86_64-unknown-linux-gnu, commit 6741444a63ee, Release)</span>\n</code></pre></div>\n<p>/cc <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span>  - it's hard to say which component is even at fault here but I believe the best fix would be to ensure different releases are never created from the same commit; they create different .oleans after all.</p>",
        "id": 526357659,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751275621
    },
    {
        "content": "<p>For now, the simplest workaround is <code>lake exe cache unpack!</code></p>",
        "id": 526357712,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751275633
    },
    {
        "content": "<p>Yes to \"ensure different releases are never created from the same commit\", this caused problems once in the past</p>",
        "id": 526377149,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751282440
    },
    {
        "content": "<p>leantar uses the lake trace for its up-to-date determination</p>",
        "id": 526377275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751282486
    },
    {
        "content": "<p>I think this is the fault of <code>cache</code>, which uses a hash which includes the githash but not the version string</p>",
        "id": 526377400,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751282538
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E21.2E0-rc3/near/526377149\">said</a>:</p>\n<blockquote>\n<p>Yes to \"ensure different releases are never created from the same commit\", this caused problems once in the past</p>\n</blockquote>\n<p>This check should probably be a build step in the release workflow</p>",
        "id": 526377544,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751282587
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E21.2E0-rc3/near/526377400\">said</a>:</p>\n<blockquote>\n<p>I think this is the fault of <code>cache</code>, which uses a hash which includes the githash but not the version string</p>\n</blockquote>\n<p>As of <a href=\"https://github.com/leanprover-community/mathlib4/pull/25639\">#25639</a> it doesn't include the githash either.</p>",
        "id": 526379420,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1751283275
    },
    {
        "content": "<p>I don't understand how that can be correct at all <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span></p>",
        "id": 526379688,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751283379
    },
    {
        "content": "<p>Well it still includes <code>lean-toolchain</code>, no? So I don't think cache is the issue here</p>",
        "id": 526386497,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751285529
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 526389935,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1751286618
    }
]