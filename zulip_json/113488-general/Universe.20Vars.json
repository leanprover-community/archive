[
    {
        "content": "<p>It seems I don't understand universe variables (universe parameters?) correctly. In the following example, everything works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n</code></pre></div>\n<p>Here, <code>h</code> has type <code>Type ?u.3477 → True</code> -- that is, the universe level is a level mvar.<br>\nNow if I try to replace the <code>_</code> with a universe variable, things don't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"c1\">--                  ^^^</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">application type mismatch</span>\n<span class=\"cm\">  h Nat</span>\n<span class=\"cm\">argument</span>\n<span class=\"cm\">  Nat</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  Type : Type 1</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  Type u : Type (u + 1)</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>Here, <code>h</code> has type <code>Type u → True</code>. I don't understand what that's supposed to mean, because I thought universe variables like <code>u</code> only made sense wrt. to a definition.</p>",
        "id": 484678197,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1732700738
    },
    {
        "content": "<p><code>u</code> is a <em>fixed</em> universe, it can be <code>Type</code> but it can be anything else, while <code>Nat : Type</code>, this is why Lean is complaining.</p>",
        "id": 484678782,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732700889
    },
    {
        "content": "<p>Note that you cannot quantify over universes, so you cannot say \"for all <code>u</code> blah blah\"</p>",
        "id": 484678857,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732700918
    },
    {
        "content": "<p>What probably confuses you is that things like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n</code></pre></div>\n<p><em>do</em> work. This is because in this case Lean actually create a family of axioms <code>h.{u}</code>, one for each universe <code>u</code>, giving the impression that <code>h</code> starts with <code>∀ u, ... </code>, but technically this is not the case.</p>",
        "id": 484681132,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732701621
    },
    {
        "content": "<p>so: universes in the type of <em>arguments</em> are fixed (in the content of your <code>def</code>/<code>theorem</code>, that is), while universes in the type of <em>declarations</em> are variables.</p>",
        "id": 484681789,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732701833
    },
    {
        "content": "<p>This is my mental model (not sure if it is 100% correct)</p>",
        "id": 484682060,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732701924
    },
    {
        "content": "<p>i'm pretty sure it's correct, that's why i summarised</p>",
        "id": 484682151,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732701952
    },
    {
        "content": "<p>Also, concerning your first example,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>does <em>not</em> work, since <code>_</code> is a metavariable, and Lean waits to give it a value. After the first <code>h Nat</code>, <code>_</code> is <code>0</code> and so you cannot write <code>h Type</code>.</p>",
        "id": 484685964,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732703011
    },
    {
        "content": "<p>While</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>is OK.</p>",
        "id": 484686194,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732703077
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/113488-general/topic/Universe.20Vars/near/484685964\">said</a>:</p>\n<blockquote>\n<p>Also, concerning your first example,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>does <em>not</em> work, since <code>_</code> is a metavariable, and Lean waits to give it a value. After the first <code>h Nat</code>, <code>_</code> is <code>0</code> and so you cannot write <code>h Type</code>.</p>\n</blockquote>\n<p>I am not 100% sure that this has to do with metavariables, because this works</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">True.intro</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">⟩</span>\n</code></pre></div>\n<p>(and <code>_</code>is also a metavariable); I think this is again related to what <span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span> was saying about the role of universes in arguments vs. in declarations...</p>",
        "id": 484690800,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1732704457
    },
    {
        "content": "<p><code>variable</code>s aren't declarations? they are arguments.</p>",
        "id": 484692615,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705035
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> I think your example works because Lean creates a family of <code>def</code>, each one with a metavariable</p>",
        "id": 484695521,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732705975
    },
    {
        "content": "<p>But I can very well be wrong here</p>",
        "id": 484695572,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732705993
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113488-general/topic/Universe.20Vars/near/484692615\">said</a>:</p>\n<blockquote>\n<p><code>variable</code>s aren't declarations? they are arguments.</p>\n</blockquote>\n<p>Then I do not understand your answer above </p>\n<blockquote>\n<p>so: universes in the type of <em>arguments</em> are fixed (in the content of your <code>def</code>/<code>theorem</code>, that is), while universes in the type of <em>declarations</em> are variables.</p>\n</blockquote>",
        "id": 484696390,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1732706264
    },
    {
        "content": "<p>what i mean, is that if you have <code>def foo : Type u</code>, you get <code>foo.{u} : Type u</code> for any <code>u</code>, so it is variable. however, in the content of <code>def foo (x:Type u) : _ := bla</code>, at <code>bla</code> you dont get to choose the level <code>u</code> anymore.</p>",
        "id": 484696815,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732706392
    },
    {
        "content": "<p>the argument <code>(x:Type u)</code> has fixed universe <code>u</code>, and so does <code>variable (x:Type u)</code> (since they're both arguments)</p>",
        "id": 484697340,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732706551
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/113488-general/topic/Universe.20Vars/near/484695521\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> I think your example works because Lean creates a family of <code>def</code>, each one with a metavariable</p>\n</blockquote>\n<p>It seems that when you have a level wildcard in a <code>def</code>, then Lean does not create a level mvar for it, but instead creates a universe parameter for it. That is, hovering over the definition of <code>h</code> gives <code>h.{u_1} (α : Type u_1) : True</code>.<br>\nI guess that makes sense, because it would feel kind of strange to have a definition with lingering mvars.</p>",
        "id": 484701692,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1732708094
    },
    {
        "content": "<p>Ah yes, sure.</p>",
        "id": 484707111,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732709826
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"372804\">@Marcus Rossel</span> The rules are basically (1) \"each lingering level metavariable at the end of elaborating the \"header\" of a declaration (the binders and the resulting type) is replaced with a fresh level parameter\" and (2) \"when a constant is elaborated, its level parameters get instantiated with fresh level metavariables\".</p>\n<p>Rule 2 should be thought of as being like how implicit arguments work. Implicit parameters get instantiated with fresh expression metavariables when an application is being elaborated.</p>",
        "id": 484812518,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732748808
    }
]