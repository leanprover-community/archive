[
    {
        "content": "<p>With this library you can mark functions with @[rpc] to expose them as JSON-RPC endpoints via HTTP.</p>\n<p>GitHub: <a href=\"https://github.com/oOo0oOo/LeanRPC\">https://github.com/oOo0oOo/LeanRPC</a></p>\n<p>Here is an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanRPC</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanSerde</span><span class=\"bp\">.</span><span class=\"n\">SnapshotTypes</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">LeanRPC</span><span class=\"bp\">.</span><span class=\"n\">Server</span>\n\n<span class=\"c1\">-- Mark functions as RPC methods</span>\n<span class=\"kd\">@[</span><span class=\"n\">rpc</span><span class=\"kd\">]</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">collatzSequence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">reverse</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"s2\">\"Start number must be positive\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">[]))</span>\n\n<span class=\"c1\">-- Example for stateful methods: Simple REPL</span>\n<span class=\"c1\">-- Note: LeanSnapshot requires `supportInterpreter = true` in `lakefile.toml`</span>\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">replState</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">Ref</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">LeanSerde</span><span class=\"bp\">.</span><span class=\"n\">LeanSnapshot</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">mkRef</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">rpc</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repl_reset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">replState</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">LeanSerde</span><span class=\"bp\">.</span><span class=\"n\">LeanSnapshot</span><span class=\"bp\">.</span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">rpc</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repl_command</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">replState</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">userError</span><span class=\"w\"> </span><span class=\"s2\">\"REPL not initialized\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">snapshot</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">snapshot'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">snapshot</span><span class=\"bp\">.</span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">cmd</span>\n<span class=\"w\">    </span><span class=\"n\">replState</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">snapshot'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">snapshot'</span><span class=\"bp\">.</span><span class=\"n\">goals</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">rpc</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">repl_tactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">replState</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">userError</span><span class=\"w\"> </span><span class=\"s2\">\"REPL not initialized\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">snapshot</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">snapshot'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">snapshot</span><span class=\"bp\">.</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"w\">    </span><span class=\"n\">replState</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">snapshot'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">snapshot'</span><span class=\"bp\">.</span><span class=\"n\">goals</span>\n\n<span class=\"c1\">-- Initialize the function registry</span>\n<span class=\"n\">init_RPC</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Interactions to try:\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"curl -X POST -H 'Content-Type: application/json' -d '{</span><span class=\"se\">\\\"</span><span class=\"s2\">jsonrpc</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">2.0</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">method</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">collatzSequence</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">params</span><span class=\"se\">\\\"</span><span class=\"s2\">:[50],</span><span class=\"se\">\\\"</span><span class=\"s2\">id</span><span class=\"se\">\\\"</span><span class=\"s2\">:1}' http://localhost:8080</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"curl -X POST -H 'Content-Type: application/json' -d '{</span><span class=\"se\">\\\"</span><span class=\"s2\">jsonrpc</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">2.0</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">method</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">repl_reset</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">params</span><span class=\"se\">\\\"</span><span class=\"s2\">:[[</span><span class=\"se\">\\\"</span><span class=\"s2\">List.cons</span><span class=\"se\">\\\"</span><span class=\"s2\">, [</span><span class=\"se\">\\\"</span><span class=\"s2\">Init</span><span class=\"se\">\\\"</span><span class=\"s2\">]]],</span><span class=\"se\">\\\"</span><span class=\"s2\">id</span><span class=\"se\">\\\"</span><span class=\"s2\">:2}' http://localhost:8080</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"curl -X POST -H 'Content-Type: application/json' -d '{</span><span class=\"se\">\\\"</span><span class=\"s2\">jsonrpc</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">2.0</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">method</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">repl_command</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">params</span><span class=\"se\">\\\"</span><span class=\"s2\">:[</span><span class=\"se\">\\\"</span><span class=\"s2\">theorem my_theorem : 1 + 1 = 2 := by sorry</span><span class=\"se\">\\\"</span><span class=\"s2\">],</span><span class=\"se\">\\\"</span><span class=\"s2\">id</span><span class=\"se\">\\\"</span><span class=\"s2\">:3}' http://localhost:8080</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"curl -X POST -H 'Content-Type: application/json' -d '{</span><span class=\"se\">\\\"</span><span class=\"s2\">jsonrpc</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">2.0</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">method</span><span class=\"se\">\\\"</span><span class=\"s2\">:</span><span class=\"se\">\\\"</span><span class=\"s2\">repl_tactic</span><span class=\"se\">\\\"</span><span class=\"s2\">,</span><span class=\"se\">\\\"</span><span class=\"s2\">params</span><span class=\"se\">\\\"</span><span class=\"s2\">:[</span><span class=\"se\">\\\"</span><span class=\"s2\">simp</span><span class=\"se\">\\\"</span><span class=\"s2\">],</span><span class=\"se\">\\\"</span><span class=\"s2\">id</span><span class=\"se\">\\\"</span><span class=\"s2\">:4}' http://localhost:8080</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Start server (buildRPC is created during init_RPC)</span>\n<span class=\"w\">  </span><span class=\"n\">startRPCServer</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">port</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">8080</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">buildRPC</span>\n</code></pre></div>\n<p>Any feedback, suggestions or contributions welcome!</p>",
        "id": 532706750,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1754306742
    }
]