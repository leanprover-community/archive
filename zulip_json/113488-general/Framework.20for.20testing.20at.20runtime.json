[
    {
        "content": "<p>I have been enjoying runtime Lean but miss a more streamlined testing experience.<br>\nUsers of runtime Lean, what have you been using for testing?</p>\n<p>After some planning, I want to implement the following API to fit my needs.<br>\nWould this also fit your projects? Any oversights, name collisions, or additions?</p>\n<p><strong>Test Definition</strong></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanTest</span>\n\n<span class=\"c1\">-- BASIC TESTING</span>\n<span class=\"bp\">#</span><span class=\"n\">test_eq</span><span class=\"w\"> </span><span class=\"s2\">\"named test\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"s2\">\"custom error message\"</span>\n<span class=\"bp\">#</span><span class=\"n\">test_eq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ne</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_true</span><span class=\"w\"> </span><span class=\"n\">condition</span>\n<span class=\"bp\">#</span><span class=\"n\">test_false</span><span class=\"w\"> </span><span class=\"n\">condition</span>\n\n<span class=\"c1\">-- GROUPING</span>\n<span class=\"bp\">#</span><span class=\"n\">test_group</span><span class=\"w\"> </span><span class=\"s2\">\"name\"</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- tests</span>\n\n<span class=\"c1\">-- PROPERTY TESTING</span>\n<span class=\"bp\">#</span><span class=\"n\">test_forall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cases</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">seed</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">generator</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">custom_gen</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">property</span>\n<span class=\"bp\">#</span><span class=\"n\">test_forall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">generators</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">custom_gen</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">custom_gen2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">property</span>\n\n<span class=\"c1\">-- EQUALITY ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_eq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ne</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_beq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_bne</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c1\">-- ORDERING ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_lt</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_le</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_gt</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ge</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c1\">-- MEMBERSHIP ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_member</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">xs</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_member</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">xs</span>\n<span class=\"bp\">#</span><span class=\"n\">test_subset</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"n\">ys</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_subset</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"n\">ys</span>\n<span class=\"bp\">#</span><span class=\"n\">test_divides</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_divides</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"c1\">-- RELATIONAL ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_rel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_rel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"bp\">#</span><span class=\"n\">test_pred</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_pred</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"c1\">-- COLLECTION ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_empty</span><span class=\"w\"> </span><span class=\"n\">collection</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_empty</span><span class=\"w\"> </span><span class=\"n\">collection</span>\n<span class=\"bp\">#</span><span class=\"n\">test_size</span><span class=\"w\"> </span><span class=\"n\">collection</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"c1\">-- NUMERIC ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_approx</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">ε</span>\n\n<span class=\"c1\">-- OPTION ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some</span><span class=\"w\"> </span><span class=\"n\">opt</span>\n<span class=\"bp\">#</span><span class=\"n\">test_none</span><span class=\"w\"> </span><span class=\"n\">opt</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_eq</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">expected</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_ne</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">forbidden</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_lt</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_le</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_gt</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_ge</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_pred</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">predicate</span>\n<span class=\"bp\">#</span><span class=\"n\">test_some_not_pred</span><span class=\"w\"> </span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">predicate</span>\n\n<span class=\"c1\">-- EXCEPT ASSERTIONS</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok</span><span class=\"w\"> </span><span class=\"n\">result</span>\n<span class=\"bp\">#</span><span class=\"n\">test_error</span><span class=\"w\"> </span><span class=\"n\">result</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_eq</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">expected</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_ne</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">forbidden</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_lt</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_le</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_gt</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_ge</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">bound</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_pred</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">predicate</span>\n<span class=\"bp\">#</span><span class=\"n\">test_ok_not_pred</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">predicate</span>\n<span class=\"bp\">#</span><span class=\"n\">test_error_eq</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">expected_error</span>\n<span class=\"bp\">#</span><span class=\"n\">test_error_ne</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">forbidden_error</span>\n<span class=\"bp\">#</span><span class=\"n\">test_error_pred</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">error_predicate</span>\n\n<span class=\"c1\">-- EXCEPTION TESTING</span>\n<span class=\"bp\">#</span><span class=\"n\">test_throws</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n<span class=\"bp\">#</span><span class=\"n\">test_not_throws</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n<span class=\"bp\">#</span><span class=\"n\">test_panic</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n\n<span class=\"c1\">-- PERFORMANCE TESTING</span>\n<span class=\"bp\">#</span><span class=\"n\">test_time</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">runs</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">timeout</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ms</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">expr</span>\n\n<span class=\"c1\">-- CONFIGURATION</span>\n<span class=\"bp\">#</span><span class=\"n\">test_config</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">??</span><span class=\"w\"> </span><span class=\"n\">parallel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bool</span>\n<span class=\"w\">  </span><span class=\"n\">seed</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p><strong>Setup and Execution</strong></p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanTest\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/.../LeanTest\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n\n<span class=\"n\">testDriver</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanTest/driver\"</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span><span class=\"nb\">test</span>\nlake<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>File.lean\nlake<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>--watch\n??<span class=\"w\"> </span>lake<span class=\"w\"> </span><span class=\"nb\">test</span><span class=\"w\"> </span>--junit-xml<span class=\"o\">=</span>report.xml\n</code></pre></div>\n<p><strong>Example Output</strong></p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>MathTests.lean [3 tests, 1 failed]\n------------------------------\n✗ simple_addition (MathTests.lean:12)\n  expected: 5\n  actual:   4\n\nAlgebraTests.lean [3 tests, 1 failed]\n------------------------------\nquadratic_formula [1 test, 1 failed]\n  ✗ solve_quadratic (AlgebraTests.lean:27)\n    property failed for inputs: x = 0, -1, 2\n    smallest failing case: x = 0\n    seed: 42\n    generator: small_ints\n\nLogicTests.lean [2 tests, 1 failed]\n------------------------------\n✗ boolean_logic_test (LogicTests.lean:18)\n  expected: true\n  actual:   false\n\nPerformanceTests.lean [2 tests, 1 failed]\n------------------------------\n✗ fast_function (PerformanceTests.lean:40)\n  test_time exceeded timeout\n  measured time: 0.08s (timeout: 0.05s)\n\ntime_measurement_example (PerformanceTests.lean:45)\n  measured time per call: 0.03s\n\nUtilityTests.lean [2 tests, 0 failed]\n------------------------------\n\n10 tests, 3 failed (0.56s)\n</code></pre></div>",
        "id": 535092777,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1755597088
    },
    {
        "content": "<p>We (<code>argumentcomputer</code>) use <a href=\"https://github.com/argumentcomputer/LSpec/\">LSpec</a></p>",
        "id": 535097681,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1755599023
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"451983\">Arthur Paulino</span> <a href=\"#narrow/channel/113488-general/topic/Framework.20for.20testing.20at.20runtime/near/535097681\">said</a>:</p>\n<blockquote>\n<p>We (<code>argumentcomputer</code>) use <a href=\"https://github.com/argumentcomputer/LSpec/\">LSpec</a></p>\n</blockquote>\n<p>Thanks, somehow I missed this on my (admittedly short) search. LSpec does a lot of what I was missing.<br>\nI'm looking through your yatima tests to see it in action now.</p>",
        "id": 535098859,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1755599554
    },
    {
        "content": "<p><code>yatima</code> is no longer maintained and uses an old version of LSpec.<br>\n<a href=\"https://github.com/argumentcomputer/ix\"><code>ix</code></a> serves as a better example</p>",
        "id": 535099578,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1755599866
    }
]