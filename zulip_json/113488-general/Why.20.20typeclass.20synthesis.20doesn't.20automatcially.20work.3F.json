[
    {
        "content": "<p>I recently suffered from Lean4's typeclass synthesis problem. It doesn't work in seemingly obvious case. </p>\n<p>Here's the minimal reproducing example. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">down</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">down2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">down</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n</code></pre></div>\n<p>Definition down2 fails because it cannot synthesize LE T.  However,  it's obvious that if there's an order on type T, then you can compare which one is less than or equal to other. Actually I find such thing is already implemented. </p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/Ord.html#Ord.toLE\">https://leanprover-community.github.io/mathlib4_docs/Init/Data/Ord.html#Ord.toLE</a></p>\n<p>How can I make Lean know the fact that <code>Ord T</code> includes <code>LE T</code> ?</p>",
        "id": 535961297,
        "sender_full_name": "Hyunwoo Lee",
        "timestamp": 1756103536
    },
    {
        "content": "<p><code>Ord</code> <em>does not</em> include <code>LE</code> automatically, you need to explicitly tell it to use <code>Ord.toLE</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">down</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">&lt;=</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">down2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leOfOrd</span>\n<span class=\"w\">  </span><span class=\"n\">down</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n</code></pre></div>\n<p>Specifically, typeclass search will only search through instances; but <code>Ord.toLE</code>  and <code>leOfOrd</code> are <code>def</code>s</p>",
        "id": 535964034,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756104848
    },
    {
        "content": "<p>Thank you. Now I understand def and instance are different. Then is it possible to define this if I only want to use LE instance generated from Ord instance?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">leFromOrd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leOfOrd</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n</code></pre></div>",
        "id": 535967121,
        "sender_full_name": "Hyunwoo Lee",
        "timestamp": 1756106317
    },
    {
        "content": "<p>For a general type, that seems like a bad idea</p>",
        "id": 535967466,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756106483
    },
    {
        "content": "<p>Maybe you want to use directly <code>[PartialOrder α]</code> or <code>[LinearOrder α]</code>.</p>",
        "id": 535967757,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1756106608
    },
    {
        "content": "<p>you can also <code>attribute [local instance] leOfOrd</code> in files where you need it to make sure this doesn't become an instance when it shouldn't be</p>",
        "id": 535974999,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756109471
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@Sébastien Gouëzel</span> You are right. I was confused between <code>Ord α</code> and <code>LinearOrder α</code>. Thank you!</p>",
        "id": 536336118,
        "sender_full_name": "Hyunwoo Lee",
        "timestamp": 1756259677
    }
]