[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> </p>\n<p>Since the transition to the verso version, copying and pasting FPiL (Functional Programming in Lean) code causes formatting issues. It would be great if you could make the code easier to copy.</p>",
        "id": 532418396,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754112131
    },
    {
        "content": "<p>this is a typical copy-paste result:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">insertSorted</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ord</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">arr</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span>\n\n\n<span class=\"n\">omega</span>\n\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">Ord</span><span class=\"bp\">.</span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lt</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">arr</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">gt</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">insertSorted</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"n\">i'</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i'</span><span class=\"o\">,</span>\n<span class=\"k\">by</span>\n\n<span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">*</span><span class=\"o\">]</span>\n<span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 532418431,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754112156
    },
    {
        "content": "<p>Will do!</p>",
        "id": 532830379,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754367356
    },
    {
        "content": "<p>Thank you!!</p>",
        "id": 532832510,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754368643
    },
    {
        "content": "<p>OK, a fix is deployed in Verso. I'm out of time to get it deployed in the books today, but I'll do it tomorrow. Thanks for pointing this out!</p>",
        "id": 532941530,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754408089
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> </p>\n<p>Thank you very much. I have one more request.</p>\n<p>I feel that the syntax highlighting is somewhat insufficient for me:</p>\n<ul>\n<li>\n<p>The highlighting is mostly in black and white, making it hard to read due to a lack of color.</p>\n</li>\n<li>\n<p>In particular, it's difficult to distinguish between comments and non-comment code.</p>\n</li>\n<li>\n<p>While it's understandable that commands introduced via macros may not be recognized as such, I would like to see proper highlighting at least for the standard Lean commands that are built into the language.</p>\n</li>\n</ul>\n<p>I apologize in advance if this is a difficult request.</p>",
        "id": 533124756,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754493196
    },
    {
        "content": "<p>While it's true that there aren't presently colors in the highlighting, it does already distinguish the categories that you're asking for (with the exception of comments, which I'll look into soon). It uses boldface for keywords/atoms (e.g. <code>if</code>, <code>#eval</code>, <code>def</code>), italic for local bindings (function parameters, <code>let</code>-bindings, section variables), and upright normal-weight font for constants. What further distinctions are missing?</p>\n<p>Unlike a regexp-based post-hoc solution, Verso's highlighted code uses Lean's understanding of the code. That means that the <code>cases</code> tactic is highlighted as a tactic name, while a local variable called <code>cases</code> is highlighted as a local variable, and it means that commands introduced by macros are indeed recognized as such.</p>",
        "id": 533213574,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754539974
    },
    {
        "content": "<blockquote>\n<p>What further distinctions are missing?</p>\n</blockquote>\n<p>I liked how the previous mdbook version of FPiL made it easy to distinguish between code and prose. The colorful syntax highlighting made it clear, even from a distance, which parts were code. With Verso's code rendering, the background of the code blocks is transparent and the code itself is not colored, making it hard to tell them apart from the surrounding text. I feel this makes documents rendered with Verso harder to read.</p>\n<p>I don't think differences like bold or italic fonts are very easy to notice. Using color allows for a wider range of syntactic elements to be distinguished, and I think it's also easier to perceive those differences.</p>\n<blockquote>\n<p>Unlike a regexp-based post-hoc solution, Verso's highlighted code uses Lean's understanding of the code.</p>\n</blockquote>\n<p>I didn't know Verso was that sophisticated. Sorry for not realizing that. Thank you for letting me know.</p>",
        "id": 533280936,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754568982
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> (missing ping)</p>",
        "id": 533281116,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754569053
    },
    {
        "content": "<p>Thanks for expanding on your experience. I've got one more follow-up question, just to make sure I work on the right problems: in your last message, it sounded like the biggest challenge was telling comments apart from other code, and to a lesser extent distinguishing keywords from other tokens. In this message, it sounds like it's telling code apart from the other text in the book. Have I misunderstood something?</p>",
        "id": 533281578,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754569218
    },
    {
        "content": "<p>I want to second that using different colors for different language token kinds is better than using different typography styles. That's how I believe most of us have been reading code on several different programming platforms. Bold/boxed/italic styles could be reserved for code comments, since Lean comments are sensitive to markdown syntax (at least on VSCode).</p>",
        "id": 533282186,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1754569462
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> </p>\n<p>Sorry if my opinion was unclear. Let me try to summarize it myself as follows:</p>\n<ol>\n<li>\n<p>I want it to be easy to distinguish between comments and non-comment parts within code.</p>\n</li>\n<li>\n<p>I want there to be a clear stylistic difference between code blocks and prose.</p>\n</li>\n<li>\n<p>When it comes to showing syntactic distinctions—such as keywords—within code, using font differences like bold or italic isn't very visually clear. Using color seems to be a better option.</p>\n</li>\n</ol>",
        "id": 533282414,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754569548
    },
    {
        "content": "<p>Out of curiosity, would you want the same for math mode?</p>",
        "id": 533283126,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754569848
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"354934\">@David Thrane Christiansen</span> </p>\n<p>I understand that \"math mode\" refers to TeX notation.<br>\nAs for the TeX parts, I personally don’t feel they need to be colored differently from the rest.<br>\nUnlike code, I prefer that TeX expressions blend in naturally with the surrounding text.</p>\n<p>It might seem inconsistent to treat code and mathematical expressions differently.<br>\nEven I’m not entirely sure why I feel this way.<br>\nHowever, code often needs to be copied for local execution, whereas mathematical expressions don’t usually have that use case.<br>\nBecause of this, code needs to be more clearly distinguishable, and I also feel that, compared to math, code is harder to read when displayed without color.</p>",
        "id": 533284514,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754570356
    },
    {
        "content": "<p>As your resident colorblind person, I must remind you that using <em>color</em> as a mean to carry syntactic information must be done parcimoniously. Grayscale is fine, however, for example code blocks could very feasibly be slightly grayed out</p>",
        "id": 533285044,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754570556
    },
    {
        "content": "<p>One of the big reasons I haven't put lots of color on it yet is that any scheme needs to be widely accessible. Don't worry, there will always be redundant signalling of information beyond just color - the bold and italic aren't going away, though they may be augmented with color as well.</p>",
        "id": 533285338,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754570670
    },
    {
        "content": "<p>Another challenging aspect of color scheme selection is that we need to be able to signal focus too (like \"the proof state for the highlighted region looks like THIS\" or \"the syntax for anonymous functions extends out to the enclosing parentheses, as highlighted here:\"), and these combinations need to have enough contrast and be accessible. That's why it's super valuable to hear concrete difficulties from a variety of people - thanks again  <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> and <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span></p>",
        "id": 533286257,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754570969
    },
    {
        "content": "<p>In this regard, the doc-gen3 system we had for focus was amazing. <br>\n<a href=\"/user_uploads/3121/kYx9SBoveXFDpOcz01qCUt9m/image.png\">Excerpt from</a> <a href=\"https://leanprover-community.github.io/mathlib_docs/find/mul_assoc\">docs3#mul_assoc</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kYx9SBoveXFDpOcz01qCUt9m/image.png\" title=\"Excerpt from\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"612x78\" src=\"/user_uploads/thumbnail/3121/kYx9SBoveXFDpOcz01qCUt9m/image.png/840x560.webp\"></a></div>",
        "id": 533286817,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754571179
    },
    {
        "content": "<p>That is really great - I'd really like to get something like that in Verso. But it's different from writing a document that's directing the readers to look at a particular point in the code, and then highlighting it to attract attention.</p>",
        "id": 533287153,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754571309
    },
    {
        "content": "<p>Oh I see! I thought the process was going the other way around, ie where the reader was trying to get more information from a specific part of the code</p>",
        "id": 533287535,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1754571441
    },
    {
        "content": "<p>Also important!</p>",
        "id": 533287811,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1754571553
    },
    {
        "content": "<p>Couldn’t we get different CSS sheets for different people, with a dropdown menu somewhere to choose?</p>",
        "id": 533534158,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1754690785
    }
]