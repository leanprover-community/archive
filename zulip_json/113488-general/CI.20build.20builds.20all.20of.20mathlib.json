[
    {
        "content": "<p>Currently I understand that on a math project, <code>lake build</code> will only build that part of mathlib which is directly in the dependency of the project. But on the CI (at least in lean blueprint), the entirety of mathlib and mathlib docs seems to be getting built. Is there a way to restrict CI to build binaries and docs just for the dependency tree?</p>",
        "id": 506472279,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742302442
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/CI.20build.20builds.20all.20of.20mathlib\">#lean4 &gt; CI build builds all of mathlib</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 506472697,
        "sender_full_name": "Notification Bot",
        "timestamp": 1742302545
    },
    {
        "content": "<p>This sounds like a question about a particular CI setup, which is hard to answer without seeing that setup. Can you link to a job where this happens?</p>",
        "id": 506472833,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742302571
    },
    {
        "content": "<p>It’s the default lean blueprint setup. We had the same thing happen in equational theories.</p>",
        "id": 506473110,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742302639
    },
    {
        "content": "<p>Some things that CI tests are global though. So only testing on the pieces that need to be rebuilt does not mean everything is fine. The canonical example is the <code>simpNF </code>linter.</p>",
        "id": 506475529,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1742303232
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span>, please link to the actual job doing the \"building all of mathlib\"</p>",
        "id": 506477951,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742303861
    },
    {
        "content": "<p>This one my friend set up just now : <a href=\"https://github.com/Shreyas4991/DGAlgorithms/actions/runs/13923235440/job/38961202690\">https://github.com/Shreyas4991/DGAlgorithms/actions/runs/13923235440/job/38961202690</a></p>",
        "id": 506487424,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742306049
    },
    {
        "content": "<p>This one : <a href=\"https://github.com/teorth/equational_theories/actions/runs/13884571087/job/38847545038\">https://github.com/teorth/equational_theories/actions/runs/13884571087/job/38847545038</a></p>",
        "id": 506487572,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742306092
    },
    {
        "content": "<p>In all cases, mathlib is \"built\" by fetching the entire cache.</p>",
        "id": 506487657,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742306111
    },
    {
        "content": "<p>And the docs are built for all of mathlib.</p>",
        "id": 506487701,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742306121
    },
    {
        "content": "<p>In the second one, I am specifically looking at this line : <a href=\"https://github.com/teorth/equational_theories/actions/runs/13884571087/job/38847545038#step:9:1\">https://github.com/teorth/equational_theories/actions/runs/13884571087/job/38847545038#step:9:1</a></p>",
        "id": 506488215,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1742306235
    },
    {
        "content": "<p>So this is separate questions of:</p>\n<ul>\n<li>\"how can I fetch less with <code>lake exe cache get</code>\" (answer: there is a PR in the works for this)</li>\n<li>\"how can I build docs for less than all of mathlib\" (answer: probably something to do with how you are asking the docs to be generated in your CI)</li>\n</ul>",
        "id": 506489425,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1742306490
    },
    {
        "content": "<p>I'm not sure I've seen a solution for (2) yet. Maybe <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> knows</p>",
        "id": 506553138,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742322988
    },
    {
        "content": "<p>Yeah, it's easy: don't <code>import Mathlib</code>, doc-gen already knows not to generate documentation for files that aren't imported</p>",
        "id": 506553274,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1742323037
    },
    {
        "content": "<p>Okay, but I was thinking more about reusing the docs that mathlib already builds rather than having fewer docs - though that also helps</p>",
        "id": 506556580,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742323910
    },
    {
        "content": "<p>Oh, that's theoretically possible, but the docs are currently not cached anywhere. It's also unclear to me that all the mathlib commits your project could depend on have ever had docs built for them (because docs are only built for the head commits)</p>",
        "id": 506557033,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1742324004
    },
    {
        "content": "<p>Yeah, there's that (and on a timer, too)</p>",
        "id": 506558628,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742324498
    }
]