[
    {
        "content": "<p>A simple question: when instantiating some class for a <code>protected</code> definition, why doesn’t the auto-generated instance name respect the <code>protected</code> qualifier? I know there’s some history here—like the problem of instance names getting too long, which was improved in the past—but personally I’d prefer if it did respect <code>protected</code>.</p>\n<p>My personal context is that I have a large number of definitions spread across multiple files, and I rely on auto-generated instance names. When importing those files, the names inevitably clash. Manually naming each instance isn’t very appealing in terms of code size.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span>\n\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Variable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span>\n\n<span class=\"c1\">-- Auto generated name is `instInhabitedVariable`</span>\n<span class=\"c1\">-- But it should be `instInhabitedBarVariable` if it respected the protected name?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">Variable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨∅⟩</span>\n</code></pre></div>",
        "id": 540912677,
        "sender_full_name": "SnO2WMaN",
        "timestamp": 1758588446
    },
    {
        "content": "<p>Instance names simply never include namespaces; that's just how it works. But you should probably not rely on auto-generated names in your case, just</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instInhabitedBarVariable</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">Variable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨∅⟩</span>\n</code></pre></div>",
        "id": 541013374,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758633735
    },
    {
        "content": "<p>That's kinda gross, honestly; I'd certainly prefer automatic names to respect protected to having to name instances that I don't intend to refer to</p>",
        "id": 541375893,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1758780618
    },
    {
        "content": "<p>Oh wait maybe I misunderstood; normally it should automatically use <code>instInhabitedVariable_1</code> if <code>instInhabitedVariable</code> already exists; the import structure may make this a bit difficult though. I guess if you have clashing instance names you can have one module import the other?</p>",
        "id": 541458107,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758806851
    },
    {
        "content": "<p>Or, you know, put the instance within a namespace</p>",
        "id": 541458188,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758806871
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"359992\">Robert Maxton</span> <a href=\"#narrow/channel/113488-general/topic/instance.20name.20auto-generating.20does.20not.20respect.20.60protected.60.3F/near/541375893\">said</a>:</p>\n<blockquote>\n<p>That's kinda gross, honestly; I'd certainly prefer automatic names to respect protected to having to name instances that I don't intend to refer to</p>\n</blockquote>\n<p>I agree this opinion. My adhoc fix for this problem with adding namespace to protect, but we have 20 more defs, tbh, it's cumbersome.</p>",
        "id": 541535754,
        "sender_full_name": "SnO2WMaN",
        "timestamp": 1758830380
    },
    {
        "content": "<p>The intended way to do this is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span>\n\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Variable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Variable</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">Variable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨∅⟩</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Variable</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"bp\">.</span><span class=\"n\">Bar</span>\n</code></pre></div>\n<p>The automatic instance name system is not designed to put the instance into a different namespace. It always puts the instances into the current namespace.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"543250\">SnO2WMaN</span> <a href=\"#narrow/channel/113488-general/topic/instance.20name.20auto-generating.20does.20not.20respect.20.60protected.60.3F/near/540912677\">said</a>:</p>\n<blockquote>\n<p>I’d prefer if it did respect <code>protected</code></p>\n</blockquote>\n<p>How do you imagine this would work? What does \"respect\" mean to you? Would you want the automatic instance name system to use an ad hoc rule to decide what the typeclass is \"about\" and copy the <code>protected</code> modifier? How would this work in the root namespace?</p>",
        "id": 541898699,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1759071738
    }
]