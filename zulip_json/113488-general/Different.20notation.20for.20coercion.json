[
    {
        "content": "<p>MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">GroupTheory</span><span class=\"bp\">.</span><span class=\"n\">GroupAction</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MulAction</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stabilizer</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ↥(stabilizer G a) : Type u_1</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">orbit</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ↑(orbit G a) : Type u_2</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixedPoints</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- ↑(fixedPoints G α) : Type u_2</span>\n</code></pre></div>\n<p>Why is <code>↥</code> used in the first coercion, while the normal up arrow is used for the other two?</p>",
        "id": 516856762,
        "sender_full_name": "Peiran Wu",
        "timestamp": 1746698494
    },
    {
        "content": "<p>There is not much documentation for  <code>↥</code> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=coeSortNotation#doc\">docs#coeSortNotation</a>. I could deduce from the name that it is perhaps intended for <code>CoeSort</code>. But for example <code>orbit G a</code> is a set, and the coercion from a set to a type is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.instCoeSortType#doc\">docs#Set.instCoeSortType</a>, yet <code>↑</code> is used.</p>",
        "id": 516858339,
        "sender_full_name": "Peiran Wu",
        "timestamp": 1746699046
    },
    {
        "content": "<p>Well, the way coercions are shown is defined by <code>Lean.Meta.coeExt</code>, registerable using <code>Lean.Meta.registerCoercion</code>. This process is completely disconnected from the coercions themselves, that is, defining a <code>CoeSort</code> instances still makes it display without the coercion arrow. To make sure the coercions are shown as such, usually the attribute <code>@[coe]</code> is used; however, this variant always registers them as <code>↑</code>. To register them as <code>↥</code> notation, one needs to write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_meta</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">registerCoercion</span><span class=\"w\"> </span><span class=\"ss\">``Set.Elem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">numArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coercee</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">coeSort</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>This effort was apparently not done for <code>Set.Elem</code>. For <code>Subgroup</code> a completely different approach is used, using a custom delaborator:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">app_delab</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">delabSubtypeSetLike</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Delab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">whenPPOption</span><span class=\"w\"> </span><span class=\"n\">getPPNotation</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">↥$</span><span class=\"n\">S</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 516865847,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746701560
    },
    {
        "content": "<p>Aha, thanks! This confirms my suspicion that it's an inconsistency in implementation, although the mechanism sounds a bit more complicated that I would have imagined.</p>\n<p>Could we make it easier to maintain consistency? Would an alternative attribute <code>@[coe_sort]</code> make sense?</p>\n<p>What's the mechanism behind the notation for <code>CoeFun</code>? It seems very consistent.</p>",
        "id": 516868910,
        "sender_full_name": "Peiran Wu",
        "timestamp": 1746702581
    },
    {
        "content": "<p>Same thing:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_cmd</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">liftTermElabM</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">registerCoercion</span><span class=\"w\"> </span><span class=\"ss\">``DFunLike.coe</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">numArgs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">coercee</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">coeFun</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>(see <code>Mathlib.Data.FunLike.Basic</code>). The only difference I think is that <code>DFunLike</code> and <code>FunLike</code> are used more consistently.</p>",
        "id": 516871751,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746703565
    }
]