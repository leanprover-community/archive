[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> recently <a href=\"#narrow/stream/287929-mathlib4/topic/lake.20update.20not.20working/near/437569083\">recommended</a> to me that I use <a href=\"https://github.com/leanprover/lean-action\"><code>lean-action</code></a> to CI my lean project. This seems to be working well, kudos to <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> for making it. I have a few questions:</p>\n<ul>\n<li>Who pays for the compute to run this action? Is there a limit to how many times I can run it per month?</li>\n<li>Is there an example of a repo with testing set up, so that I can get testing to work?</li>\n</ul>\n<p>Thanks!</p>",
        "id": 439409873,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1716095872
    },
    {
        "content": "<p>You may check out <a href=\"https://github.com/leanprover-community/aesop/pull/135\">leanprover-community/aesop#135</a> and <a href=\"https://github.com/leanprover-community/aesop/pull/136\">leanprover-community/aesop#136</a> .</p>\n<p>Your own Github account pays for the compute, which is free for public repo.</p>",
        "id": 439419792,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716106022
    },
    {
        "content": "<blockquote>\n<ul>\n<li>Is there an example of a repo with testing set up, so that I can get testing to work?</li>\n</ul>\n</blockquote>\n<p>In addition to  aesop, <a href=\"https://github.com/leanprover-community/import-graph/pull/9\">import-graph</a> also uses <code>lean-action</code> to run <code>lake test</code>. I just created a PR to add these examples to the README.md.</p>",
        "id": 439432139,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716118903
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"282271\">@Bolton Bailey</span> As lean users start to use the alpha version, we want to collect feedback to improve.  If you experience issues or have recommendations for how we could improve docs/setup/usage let us know! You can <a href=\"https://github.com/leanprover/lean-action/issues\">create an issue</a> or message on Zulip.</p>",
        "id": 439432236,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716119042
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> My personal feedback is it would be nice to support specifying the directory of the Lean project,  <a href=\"https://github.com/cedar-policy/cedar-spec/tree/main/cedar-lean\">https://github.com/cedar-policy/cedar-spec/tree/main/cedar-lean</a> is one such example.</p>\n<p>This would also support multiple Lean projects in one repo, via multiple lean-action steps.</p>",
        "id": 439435485,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716122355
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"296911\">@Utensil Song</span> Thanks for pointing this out. I created <a href=\"https://github.com/leanprover/lean-action/issues/34\">an issue</a> to support this use case.</p>",
        "id": 439451967,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716138226
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/439409873\">said</a>:</p>\n<blockquote>\n<ul>\n<li>Is there an example of a repo with testing set up, so that I can get testing to work?</li>\n</ul>\n</blockquote>\n<p>Batteries now uses <code>lake test</code>, and <a href=\"https://github.com/leanprover-community/mathlib4/pull/12943\">#12943</a> is the Mathlib PR (awaiting-review for 4 days, hint hint) that will enable <code>lake test</code> in Mathlib.</p>\n<p>We need to make a few changes in Lake that will not land until at least <code>v4.9.0-rc1</code>, but we are hoping that <code>lake test</code> (and lean-action) will be viable for everyone soon, and indeed that <code>lake new</code> will set up your project to use <code>lean-action</code>.</p>",
        "id": 439473574,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716159973
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/439451967\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> Thanks for pointing this out. I created <a href=\"https://github.com/leanprover/lean-action/issues/34\">an issue</a> to support this use case.</p>\n</blockquote>\n<p>Thanks for the issue, per my test with lean-action, <code>working-directory</code> doesn't work with <code>use</code>, it only works with <code>run</code> etc.</p>",
        "id": 439512774,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716188111
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/439512774\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/439451967\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> Thanks for pointing this out. I created <a href=\"https://github.com/leanprover/lean-action/issues/34\">an issue</a> to support this use case.</p>\n</blockquote>\n<p>Thanks for the issue, per my test with lean-action, <code>working-directory</code> doesn't work with <code>use</code>, it only works with <code>run</code> etc.</p>\n</blockquote>\n<p>Ah okay. In that case we can definitely create an input that allows users to specify a Lean directory directly.</p>",
        "id": 439550315,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716203006
    },
    {
        "content": "<p>For those who are already trying out <code>lean-action</code>, <code>v1-beta</code> is now available <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> </p>\n<p><code>v1-beta</code> includes usability improvements and a new <code>build-args</code> input to support additional use cases, such as <code>batteries</code> <code>lake build -Kwerror</code>.</p>\n<p>The <a href=\"https://github.com/leanprover/lean-action/releases\">release notes</a> are on GitHub.</p>",
        "id": 439910313,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716327428
    },
    {
        "content": "<p>Related,  I just opened a <a href=\"https://github.com/leanprover-community/batteries/pull/805\">PR</a> to use <code>lean-action</code> in <code>batteries</code>.</p>",
        "id": 439910371,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716327453
    },
    {
        "content": "<p>Also, thank you to <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> for driving many of the improvements in this version!</p>",
        "id": 439914161,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716328834
    },
    {
        "content": "<p>Thanks for doing this!</p>\n<p>For me the main regression is that the CI output is less easily interpretable.</p>\n<p>Can we achieve separate top level items for build, test, etc? I'm not sure how that would be done, at this point.</p>",
        "id": 439925479,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716333419
    },
    {
        "content": "<p>Further, could you run some tests in which you break the build, break a test, and break the linter, and them link from the PR description to the build outputs, so we can see what they each look like?</p>",
        "id": 439925528,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716333456
    },
    {
        "content": "<p>(i.e. do these just by pushing commits to the PR itself; we squash merge in the end, so once they are reverted after CI has run, these commits can harmlessly stay in the PR history)</p>",
        "id": 439925608,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716333490
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> design the desired user interface that is best for those who will use the tooling and we can make it happen! Not everything is possible but most things are. What exact details should be seen and where should they be seen?</p>\n<p>Actions can output information in three ways: <strong>logs</strong>, <strong>annotations</strong> and <strong>summaries</strong>. </p>\n<ul>\n<li>The log unavoidably contains a lot of lines of info and so is not useful as an overview.</li>\n<li>Annotations are displayed on the job summary page and are of type (notice | warning | error). (This is the place where all the \"Node.js 16 actions are deprecated\" messages are written.) Annotations can have links to files and lines within those files. Creating the action we have total control on exactly what the annotations are.</li>\n<li><a href=\"https://github.blog/2022-05-09-supercharging-github-actions-with-job-summaries/\">Summaries</a> give the most flexibility. This is markdown formatted, appears on the job summary page and we have total control on what is written there. Possibly a table displaying the steps and concise (and colourful) info on the results from each? </li>\n</ul>\n<p>Additionally the action could produce a markdown formatted summary which is then used by another action to be sent as a message some place if that happens to be useful for the particular PR / reviewing setup.</p>",
        "id": 440026618,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1716360891
    },
    {
        "content": "<p>Okay! :-)</p>\n<p>My basic complaint is that pre-<code>lean-action</code>, we can easily see whether a PR failed at build, test, or lint, as soon as we click through to the build output, e.g.</p>\n<p><a href=\"/user_uploads/3121/0BmKPRqm7Xt96uAXt8s4BNGa/Screenshot-2024-05-22-at-5.01.07PM.png\">Screenshot-2024-05-22-at-5.01.07PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/0BmKPRqm7Xt96uAXt8s4BNGa/Screenshot-2024-05-22-at-5.01.07PM.png\" title=\"Screenshot-2024-05-22-at-5.01.07PM.png\"><img src=\"/user_uploads/3121/0BmKPRqm7Xt96uAXt8s4BNGa/Screenshot-2024-05-22-at-5.01.07PM.png\"></a></div><p>from <a href=\"https://github.com/leanprover-community/batteries/actions/runs/9143437388/job/25140072702?pr=782\">https://github.com/leanprover-community/batteries/actions/runs/9143437388/job/25140072702?pr=782</a></p>\n<p>vs</p>\n<p><a href=\"/user_uploads/3121/3KkLpzTQstu9aE5VhHzZZ8Ul/Screenshot-2024-05-22-at-5.01.25PM.png\">Screenshot-2024-05-22-at-5.01.25PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/3KkLpzTQstu9aE5VhHzZZ8Ul/Screenshot-2024-05-22-at-5.01.25PM.png\" title=\"Screenshot-2024-05-22-at-5.01.25PM.png\"><img src=\"/user_uploads/3121/3KkLpzTQstu9aE5VhHzZZ8Ul/Screenshot-2024-05-22-at-5.01.25PM.png\"></a></div><p>from <a href=\"https://github.com/leanprover-community/batteries/actions/runs/9181778942/job/25249274199?pr=805\">https://github.com/leanprover-community/batteries/actions/runs/9181778942/job/25249274199?pr=805</a> where all the good stuff is hidden in the lean-action step, and even when we open that we only get</p>\n<p><a href=\"/user_uploads/3121/RNn_NcrAN6TdOH8eNVZqj_es/Screenshot-2024-05-22-at-5.01.36PM.png\">Screenshot-2024-05-22-at-5.01.36PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/RNn_NcrAN6TdOH8eNVZqj_es/Screenshot-2024-05-22-at-5.01.36PM.png\" title=\"Screenshot-2024-05-22-at-5.01.36PM.png\"><img src=\"/user_uploads/3121/RNn_NcrAN6TdOH8eNVZqj_es/Screenshot-2024-05-22-at-5.01.36PM.png\"></a></div><p>where it is not at all obvious where the build / test /lint segments of the output start and stop.</p>",
        "id": 440027866,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716361491
    },
    {
        "content": "<p>It's true that \"The log unavoidably contains a lot of lines of info\", but I don't think it's true that \"and so is not useful as an overview\". Just plain text section headings separating things would help.</p>\n<p>But really we want separate sections on the build output screen, which I think can only be achieved by having separate steps.</p>",
        "id": 440028096,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716361571
    },
    {
        "content": "<p>Is there something fundamental that the step sections can do that the nested groups can't? If the output was cleaned up into</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Build</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Lint</span>\n</code></pre></div>\n<p>would that be sufficient?</p>",
        "id": 440033844,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1716363795
    },
    {
        "content": "<p>One way is to make it to have more action steps like <a href=\"https://github.com/quarto-dev/quarto-actions\">https://github.com/quarto-dev/quarto-actions</a>, so the user can choose to run all step or organize the steps as how they would like it.</p>",
        "id": 440034112,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716363884
    },
    {
        "content": "<p>There is also one clear limitation of having separate steps: they are run in order. Really for the highest possible throughput, all (expensive) CI actions would have to be modeled as Lake build targets that are scheduled in parallel as determined by Lake. If the output of such an approach that does not allow for linear section names is not sufficiently clear, we should look at how to improve it.</p>",
        "id": 440035206,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1716364305
    },
    {
        "content": "<p>Another choice may be using <a href=\"https://github.blog/2022-02-10-using-reusable-workflows-github-actions/\">Reusable workflows</a> to have all these steps run in one go but logged as separate steps.</p>\n<p><a href=\"/user_uploads/3121/GyuQwkXqv4ov1-V7fbCY8uBv/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GyuQwkXqv4ov1-V7fbCY8uBv/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/GyuQwkXqv4ov1-V7fbCY8uBv/image.png\"></a></div>",
        "id": 440035385,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716364377
    },
    {
        "content": "<p>Nesting is I think fine.</p>",
        "id": 440037837,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716365291
    },
    {
        "content": "<p>There seems to be <a href=\"https://github.com/actions/toolkit/pull/1001\">actions/toolkit#1001</a> regarding nested groups.</p>",
        "id": 440044020,
        "sender_full_name": "Utensil Song",
        "timestamp": 1716367469
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/440035385\">said</a>:</p>\n<blockquote>\n<p>Another choice may be using <a href=\"https://github.blog/2022-02-10-using-reusable-workflows-github-actions/\">Reusable workflows</a> to have all these steps run in one go but logged as separate steps.</p>\n</blockquote>\n<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> that would give the separate steps and currently lean-action is a composite action so adapting one to the other is straight forward. I'm not aware of possible downsides except that it couldn't be listed on Github Marketplace and couldn't later become a fully fledged javascript or docker action.</p>",
        "id": 440046651,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1716368461
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/440044020\">said</a>:</p>\n<blockquote>\n<p>There seems to be <a href=\"https://github.com/actions/toolkit/pull/1001\">actions/toolkit#1001</a> regarding nested groups.</p>\n</blockquote>\n<p>Nesting a grouping in the github actions log is a bit primitive. It would be possible to just add blank lines and headers to separate the text a bit. But doesn't seem the perfect solution.</p>",
        "id": 440047125,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1716368617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"296911\">Utensil Song</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/440034112\">said</a>:</p>\n<blockquote>\n<p>One way is to make it to have more action steps like <a href=\"https://github.com/quarto-dev/quarto-actions\">https://github.com/quarto-dev/quarto-actions</a>, so the user can choose to run all step or organize the steps as how they would like it.</p>\n</blockquote>\n<p>Structuring the workflow like this or, more or less equivalently, like <a href=\"https://github.com/microsoft/action-python\">action-python</a> does have the benefit of all the steps being separate and the use totally customizable. </p>\n<p>Then again, could more functionality be built into lake and so each desired step is already very concise?</p>",
        "id": 440048348,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1716369068
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/440046651\">said</a>:</p>\n<blockquote>\n<p>except that it couldn't be listed on Github Marketplace</p>\n</blockquote>\n<p>I'd prefer we avoid that.</p>",
        "id": 440057161,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716372088
    },
    {
        "content": "<p>Let's not add too much technology here. I think just plain text headers and blank lines is a great start, and we can iteratively ask for changes in <code>lake</code> output too, if needed.</p>",
        "id": 440057353,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716372152
    },
    {
        "content": "<p>One thing to note is that when there is a failure, the log group where the failure occurred is automatically expanded. I added links to examples on the <a href=\"https://github.com/leanprover-community/batteries/pull/805\">batteries pr</a>. This isn't as clear as the multi-step workflow, but it is better than manually expanding the log groups.</p>\n<p>I agree with <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> that summaries and annotations could complement the logs. To give an idea of what this would look like, <a href=\"https://github.com/leanprover/lean-action/pull/31#issuecomment-2119024832\">here</a> is the <code>lean-action</code> PR for adding <code>lake check-test</code> where we used a summary to surface the reason for the workflow failure to the user.</p>",
        "id": 440087663,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716383202
    },
    {
        "content": "<p>I have created a PR to improve the log group headers and add blank lines <a href=\"https://github.com/leanprover/lean-action/pull/41\">here</a>.</p>\n<p>This is what the log output looks like now: <br>\n<a href=\"/user_uploads/3121/5XB5F91VPFrb8t5lVZZHeVXy/2024-05-22-090841-screenshot.png\">2024-05-22-090841-screenshot.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5XB5F91VPFrb8t5lVZZHeVXy/2024-05-22-090841-screenshot.png\" title=\"2024-05-22-090841-screenshot.png\"><img src=\"/user_uploads/3121/5XB5F91VPFrb8t5lVZZHeVXy/2024-05-22-090841-screenshot.png\"></a></div><p>There is still room for improvement. I haven't figured out how to control the log output of the <code>actions/cache</code> steps, but there may be a workaround. I used a workaround I found <a href=\"https://github.com/actions/runner/issues/1877#issuecomment-1987226919\">here</a> to change some of the log group names.</p>",
        "id": 440089177,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716383643
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> Thanks for doing this! I've updated most of my active repos to use lean-actions today and it works totally fine so far.</p>",
        "id": 440093454,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1716384926
    },
    {
        "content": "<p>Yay! I am glad it is working well <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 440194941,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716416723
    },
    {
        "content": "<p>Thanks for the links to the failure mode logs. They look good. I added a suggestion for a name for the build step (users reading the log care what it is doing, not what the action is called).</p>\n<p>If that looks good, I propose we merge!</p>",
        "id": 440196333,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716417316
    },
    {
        "content": "<p>Good point. The new name looks good to me! I have updated the PR.</p>",
        "id": 440202997,
        "sender_full_name": "Austin Letson",
        "timestamp": 1716420079
    },
    {
        "content": "<p>Merged. Let's keep an eye on it!</p>",
        "id": 440203789,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1716420401
    },
    {
        "content": "<p>How can I use lean-actions to do lake update but not lake build?</p>",
        "id": 445880720,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1718897345
    },
    {
        "content": "<p>Currently lean-action always runs lake build. We are currently working on supporting use cases which don't include lake build. This functionality will likely be available in the next couple of weeks.</p>",
        "id": 445890651,
        "sender_full_name": "Austin Letson",
        "timestamp": 1718900122
    },
    {
        "content": "<h1>v1-beta.1 Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h1>\n<p>v1-beta.1 adds new features and improvements to <code>lean-action</code>:</p>\n<ul>\n<li>\n<p>new <code>lake-package-directory</code> input to specify the directory to run Lake commands. <br>\nThis input will enable users to use <code>lean-action</code> when Lake packages are contained in repository subdirectories.</p>\n</li>\n<li>\n<p>new <code>use-github-cache</code> input to specify if <code>lean-action</code> should use <code>actions/cache</code> to cache the <code>.lake</code> folder (useful for debugging and testing)</p>\n</li>\n<li><code>build-status</code> and <code>test-status</code> output parameters to use in subsequent workflow steps</li>\n</ul>\n<p>Additionally, <code>lean-action</code> now supports a fully automated functional test suite to ensure that future improvements and changes don't break existing functionality.</p>\n<p>You can view the full release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1-beta.1\">here</a>.</p>\n<h2>Upgrading to v1-beta.1</h2>\n<p>All workflows with<code>- uses: leanprover/lean-action@v1-beta</code> will automatically start using <code>v1-beta.1</code> instead of <code>v1-beta.0</code>, so no action is required to upgrade to <code>v1-beta.1</code>.</p>\n<p>If you have any questions or encounter any issues, you can post in this Zulip thread or create an issue on GitLab.</p>\n<p>Thank you to <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, and <span class=\"user-mention\" data-user-id=\"296911\">@Utensil Song</span> for feedback and help with this release.</p>",
        "id": 446073722,
        "sender_full_name": "Austin Letson",
        "timestamp": 1718973155
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span>, thanks so much for this great work on a foundational tool for the ecosystem!</p>",
        "id": 446192052,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719011131
    },
    {
        "content": "<p>A milestone I'm really excited about is getting <code>lake new</code> to include a Github workflow running <code>lean-action</code>.</p>\n<p>Do we still have technical blockers for this? Or is it a matter of writing the PR that adds to the <code>lake new</code> templates?</p>",
        "id": 446192244,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719011185
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/446192244\">said</a>:</p>\n<blockquote>\n<p>A milestone I'm really excited about is getting <code>lake new</code> to include a Github workflow running <code>lean-action</code>.</p>\n<p>Do we still have technical blockers for this? Or is it a matter of writing the PR that adds to the <code>lake new</code> templates?</p>\n</blockquote>\n<p>I am excited about this milestone as well! I recommend waiting until the <code>v1</code> release of <code>lean-action</code> to ship it with <code>lake new/init</code>. <code>v1</code> will likely not be backward compatible with the beta versions. There are a few outstanding issues that I would like to complete for <code>v1</code> (<a href=\"https://github.com/leanprover/lean-action/issues?q=is%3Aopen+is%3Aissue+label%3Av1-release\">link to the filtered list on GitHub</a>). One issue already has <a href=\"https://github.com/leanprover/lean-action/pull/61\">a PR</a>. This PR will impact the user experience, so I have added you as a reviewer.</p>\n<p>All this being said, I estimate <code>v1</code> will be ready in 2-3 weeks, and I see no reason why we couldn't work on adding the functionality to Lake in parallel. Should I create an issue on leanprover/lean4 to add a <code>lake new</code> template?</p>",
        "id": 446263130,
        "sender_full_name": "Austin Letson",
        "timestamp": 1719055085
    },
    {
        "content": "<p>Another related note: When writing the functional tests for <code>lean-action</code>, my primary focus has been testing <code>lean-action</code>on packages created with <code>lake new/init</code>. For example, in the <a href=\"https://github.com/leanprover/lean-action/actions/runs/9612611445\">test run for <code>v1-beta.1</code></a> the <code>lake-init-success</code> matrix runs <code>lean-action</code> on packages created with <code>lake init standalone</code>, <code>lake init mathdep math</code>, and <code>lake init tomltest .toml</code>. Other tests run <code>lake init</code> and then introduce a change to the Lake file, e.g., adding a <code>@[test_driver]</code> or an obvious syntax error and confirming <code>lean-action</code> behaves correctly.</p>\n<p>Expanding our functional tests with more scenarios shouldn't take much effort and will allow us to identify issues users may encounter when using <code>lean-action</code> out of the box with <code>lake new</code>. I welcome any suggestions for additional test cases. Also tagging <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> for his input.</p>",
        "id": 446264111,
        "sender_full_name": "Austin Letson",
        "timestamp": 1719055874
    },
    {
        "content": "<p>I created an <a href=\"https://github.com/leanprover/lean4/issues/4606\">issue</a> and corresponding <a href=\"https://github.com/leanprover/lean4/pull/4608\">draft PR</a> to add a lean-action workflow on <code>lake new/init</code>.</p>",
        "id": 448312705,
        "sender_full_name": "Austin Letson",
        "timestamp": 1719836083
    },
    {
        "content": "<p>Mac is on vacation this week, but looking forward to discussing this when he is back!</p>",
        "id": 448312842,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1719836126
    },
    {
        "content": "<p>Sounds good!</p>",
        "id": 448313705,
        "sender_full_name": "Austin Letson",
        "timestamp": 1719836334
    },
    {
        "content": "<p>Quick question: now that Lake supports <code>@[lint_driver]</code> and <code>lake lint</code> I was planning on removing the direct integration of <code>lean-action</code> and the <code>Batteries</code> linting framework in favor of a more general option to run <code>lake lint</code> as part of <code>lean-action</code>. This seems more flexible and users can still run the <code>Batteries</code> linting framework from the lint driver. Does this seem like the right approach to others?</p>",
        "id": 452555574,
        "sender_full_name": "Austin Letson",
        "timestamp": 1721390325
    },
    {
        "content": "<p>Yes, thanks!</p>",
        "id": 452557303,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721390992
    },
    {
        "content": "<h1>v1.0.0  Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h1>\n<p><code>v1.0.0</code> is the first non-beta release of <code>lean-action</code> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> . You can read the full release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1.0.0\">here</a>. As always, if you have any feedback or issues, don't hesitate to respond in the <code>lean-action</code> Zulip topic or <a href=\"https://github.com/leanprover/lean-action/issues\">create an issue on the <code>lean-action</code> repo</a>.<br>\nThank you to everyone for the feedback on the beta releases, specifically <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>, <span class=\"user-mention\" data-user-id=\"543250\">@SnO2WMaN</span>, and <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>.</p>\n<h2>New features</h2>\n<ul>\n<li><strong><code>lake lint</code> support</strong>. <code>lean-action</code> can now run <code>lake lint</code> in your CI pipeline, either automatically (see bellow) or by using the new <code>lint</code> input.</li>\n<li><strong>Automatic CI feature detection using the Lake workspace</strong>. <code>lean-action</code> now uses the Lake workspace to automatically determine which CI features to run, i.e., <code>lake build</code>, <code>lake test</code>, <code>lake lint</code>. Users can still specify exactly which steps should run with <code>build</code>, <code>test</code>, and <code>lint</code> inputs as well as disabling automatic configuration with <code>auto-config: false</code>.</li>\n<li><strong>Improved testing of <code>lean-action</code> itself</strong>. Maintainers of <code>lean-action</code> can now run the functional test suite on a specific Lean toolchain. This means we can easily run tests with each new Lean core release candidate and identify/fix issues early to avoid disrupting users' workflows.</li>\n</ul>\n<h2>Upgrading to <code>v1</code></h2>\n<p>If you have been using a previous release of <code>lean-action</code> in your repo, you will need to manually upgrade to <code>v1</code> by updating your yaml workflow to:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">leanprover/lean-action@v1</span>\n</code></pre></div>\n<h3>Breaking changes</h3>\n<ul>\n<li>The direct integration with the <code>Batteries</code> linting framework was removed. Users should now use a <code>@[lint_driver]</code> in their lean file in combination with <code>lake lint</code> to run the <code>Batteries</code> linting framework.</li>\n</ul>",
        "id": 452836437,
        "sender_full_name": "Austin Letson",
        "timestamp": 1721479241
    },
    {
        "content": "<h1>v1.0.1 Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h1>\n<h2>Improvements</h2>\n<ul>\n<li><code>lean-action</code> now supports macOS runners <span aria-label=\"apple\" class=\"emoji emoji-1f34e\" role=\"img\" title=\"apple\">:apple:</span></li>\n<li><code>lean-action</code> now uses the <code>lake-manifest.json</code> instead of the <code>lakefile.{lean, toml}</code> to detect mathlib dependency, which is more robust and easier to maintain. Specifically, this fixes an issue when using the new reservoir require Lake file syntax introduced in Lean 4.10.</li>\n</ul>\n<h2>Upgrading to v1.0.1</h2>\n<p><code>v1.0.1</code> is a minor release of <code>lean-action</code>, so you don't need to do anything to upgrade if your workflow uses <code>- uses: leanprover/lean-action@v1</code>. If you have specified a more specific version in your workflow (e.g. <code>  - uses: leanprover/lean-action@v1.0.0</code>), you will need the specific version or use the major version tag.</p>\n<p>You can read the full release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1.0.1\">here</a>.</p>",
        "id": 463874283,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724189435
    },
    {
        "content": "<p>Fantastic, thanks for this!</p>",
        "id": 463900649,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724200806
    },
    {
        "content": "<p>I can open an issue about this, but maybe some first discussion is warranted.</p>\n<p>I still find the CI workflow output from <code>lean-action</code> pretty confusing, and hard to locate where the failure is. Just to take an example, here's the latest failure on the current PR list: <a href=\"https://github.com/leanprover-community/batteries/actions/runs/10436378305/job/28901375546?pr=925\">https://github.com/leanprover-community/batteries/actions/runs/10436378305/job/28901375546?pr=925</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">action</span><span class=\"bp\">@</span><span class=\"n\">v1</span>\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Install</span><span class=\"w\"> </span><span class=\"n\">Elan</span>\n<span class=\"n\">Elan</span><span class=\"w\"> </span><span class=\"n\">Installation</span><span class=\"w\"> </span><span class=\"n\">Output</span>\n\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Configure</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Action</span>\n<span class=\"n\">Configure</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">action</span>\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"n\">actions</span><span class=\"bp\">/</span><span class=\"n\">cache</span><span class=\"bp\">@</span><span class=\"n\">v4</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">Size</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"n\">MB</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">46612293</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">xf</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">runner</span><span class=\"bp\">/</span><span class=\"n\">work</span><span class=\"bp\">/_</span><span class=\"n\">temp</span><span class=\"bp\">/</span><span class=\"mi\">697</span><span class=\"n\">e5926</span><span class=\"bp\">-</span><span class=\"n\">a3ea</span><span class=\"bp\">-</span><span class=\"mi\">4</span><span class=\"n\">e6b</span><span class=\"bp\">-</span><span class=\"mi\">87</span><span class=\"n\">d6</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"n\">ffd033214a8</span><span class=\"bp\">/</span><span class=\"n\">cache</span><span class=\"bp\">.</span><span class=\"n\">tzst</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">runner</span><span class=\"bp\">/</span><span class=\"n\">work</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"bp\">/</span><span class=\"n\">batteries</span><span class=\"w\"> </span><span class=\"c1\">--use-compress-program unzstd</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">restored</span><span class=\"w\"> </span><span class=\"n\">successfully</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">restored</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">Linux</span><span class=\"bp\">-</span><span class=\"mi\">35</span><span class=\"n\">bbb9cdd70d826478d2df7bbf453c1aeb7b32f970cc509538c2e946395c254e</span><span class=\"bp\">-</span><span class=\"n\">e503a2d63ec7774f5baf6891f61ee3154b09e948bf29ec62baae194489642e73</span><span class=\"bp\">-</span><span class=\"mi\">328</span><span class=\"n\">eaed87117a8608f10e51432a2f84d3fe3eef0</span>\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Detect</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"n\">Detect</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"w\"> </span><span class=\"n\">Output</span>\n\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Build</span>\n<span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">Output</span>\n\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"n\">actions</span><span class=\"bp\">/</span><span class=\"n\">cache</span><span class=\"bp\">/</span><span class=\"n\">save</span><span class=\"bp\">@</span><span class=\"n\">v4</span>\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">tar</span><span class=\"w\"> </span><span class=\"c1\">--posix -cf cache.tzst --exclude cache.tzst -P -C /home/runner/work/batteries/batteries --files-from manifest.txt --use-compress-program zstdmt</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">Size</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"n\">MB</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">46650665</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">saved</span><span class=\"w\"> </span><span class=\"n\">successfully</span>\n<span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">saved</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">Linux</span><span class=\"bp\">-</span><span class=\"mi\">35</span><span class=\"n\">bbb9cdd70d826478d2df7bbf453c1aeb7b32f970cc509538c2e946395c254e</span><span class=\"bp\">-</span><span class=\"n\">e503a2d63ec7774f5baf6891f61ee3154b09e948bf29ec62baae194489642e73</span><span class=\"bp\">-</span><span class=\"n\">d9faee2ee14144d5bca60fa9ff7ad59361621bf6</span>\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n<span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">Output</span>\n\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Lint</span>\n<span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">Lint</span><span class=\"w\"> </span><span class=\"n\">Output</span>\n\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mf\">1.</span>\n<span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"n\">Parameters</span>\n<span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"n\">Parameters</span>\n</code></pre></div>\n<p>It's not terrible: the <code>Error</code> line is written in red, so at least my eye jumps pretty quickly there. However the error line itself is not at all informative. I've learnt to read up a few lines the find the previous \"Run\" statement, but it's not as intuitive as it could be. (And definitely not as helpful as the CI output at Mathlib, where everything is a separate step, so the Github interface itself shows a big red cross at the failing step --- indeed even before the output the unfolds automatically.)</p>\n<p>I don't have a concrete suggestion here, but I would love to see the UX around \"understand where the problem is asap\" improved. No one enjoys spending time reading workflow output. :-)</p>",
        "id": 463901307,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724201071
    },
    {
        "content": "<p>GitHub workflows have annotation support: <a href=\"https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/workflow-commands-for-github-actions#setting-an-error-message\">https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/workflow-commands-for-github-actions#setting-an-error-message</a></p>",
        "id": 463908959,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1724203386
    },
    {
        "content": "<p>Thanks for sharing this, <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> ! UX is an area where there is room for improvement. </p>\n<p>First, I am sad that GitHub isn't automatically expanding the log group containing a failure. This seems like a regression because I thought an earlier version of lean action had this working. I might have broken it when consolidating some of the scripts. I want to get this working because I know it is frustrating not to know which log to expand.</p>\n<p>Beyond expanding the logs, there are some other options:</p>\n<p>As Yakov mentioned, we could improve the error annotations. This would have the most significant impact if we also fix the log group expansion issue, because otherwise, the errors get lost within the groups. I believe these annotations allow you to give a link to the line that caused the problem, which could be great for improving UX.</p>\n<p>Additionally, we could use the job summary feature, which essentially allows you to display an arbitrary markdown document at the summary level. Especially for common issues, this would be a quick way for users to understand the issue without diving into the logs at all. Here is a screenshot of what that might look like for lake lint. Obviously, we would want a more detailed description based on the actual issue:</p>\n<p><a href=\"/user_uploads/3121/C86QFek43aFCBr39rBLXD1bW/2024-08-21-114756-screenshot.png\">2024-08-21-114756-screenshot.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/C86QFek43aFCBr39rBLXD1bW/2024-08-21-114756-screenshot.png\" title=\"2024-08-21-114756-screenshot.png\"><img data-original-dimensions=\"1864x901\" src=\"/user_uploads/thumbnail/3121/C86QFek43aFCBr39rBLXD1bW/2024-08-21-114756-screenshot.png/840x560.webp\"></a></div><p>Another option would be to allow users to split lean-action usage across multiple steps, bringing it closer to the Mathlib CI. This is already possible to some extent by using the <code>auto-config: false</code> option, however, we would want to make sure that caching and elan installation play nice with this usage if we are going to recommend it. Something like:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">leanprover/lean-action@v1</span>\n<span class=\"w\">    </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">      </span><span class=\"nt\">auto-config</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">false</span>\n<span class=\"w\">      </span><span class=\"nt\">build</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n<span class=\"w w-Error\"> </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">leanprover/lean-action@v1</span>\n<span class=\"w\">    </span><span class=\"l l-Scalar l-Scalar-Plain\">with</span><span class=\"p p-Indicator\">:</span>\n<span class=\"w\">      </span><span class=\"nt\">auto-config</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">false</span>\n<span class=\"w\">      </span><span class=\"nt\">test</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n<span class=\"w\"> </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">leanprover/lean-action@v1</span>\n<span class=\"w\">    </span><span class=\"l l-Scalar l-Scalar-Plain\">with</span><span class=\"p p-Indicator\">:</span>\n<span class=\"w\">      </span><span class=\"nt\">auto-config</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">false</span>\n<span class=\"w\">      </span><span class=\"nt\">lint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n</code></pre></div>\n<p>For advanced projects, I am not convinced that this usage of lean action is better than having users use <code>lean-action</code> to set up their CI and environment and then create their own steps that run <code>lake build</code>, <code>lake test</code>, etc..</p>\n<p>I can play around with these options and come back with more concrete demos, but I am also open to other ideas.</p>",
        "id": 464099926,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724256388
    },
    {
        "content": "<p>Yes, I agree we should aim for \"most users have a single step, that just does the best possible\", and \"for users who need lots of configuration, <code>lean-action</code> will only to the initial setup\".</p>",
        "id": 464187123,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724280997
    },
    {
        "content": "<blockquote>\n<p>for users who need lots of configuration, <code>lean-action</code> will only to the initial setup\".</p>\n</blockquote>\n<p>Should we have a separate <code>setup-lean</code> action for this, to match <code>setup-python</code> etc?</p>",
        "id": 464189934,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724281595
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/464189934\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>for users who need lots of configuration, <code>lean-action</code> will only to the initial setup\".</p>\n</blockquote>\n<p>Should we have a separate <code>setup-lean</code> action for this, to match <code>setup-python</code> etc?</p>\n</blockquote>\n<p>This is a good point, considering the <code>setup-*</code> pattern is so common. This wouldn't be hard to pull out into its own action.</p>\n<p>Alternatively, we could make the input API of <code>lean-action</code> more obvious, having a <code>setup-only: true</code> input instead of <code>auto-config: false</code>. Or even having users opt in to <code>lean-action</code> running <code>lake build</code>, <code>lake test</code>, etc... Note we could opt in automatically when generating a CI yml with <code>lake init</code>so that users would get the benefits of the \"does the best possible functionality\". </p>\n<p>There is a risk right now of users building/testing/linting their project twice, by adding <code>lean-action</code> at the top of their CI and then running the same CI in subsequent steps. I ran into this when <a href=\"https://github.com/leanprover/LNSym/pull/102#event-13964309079\">working with the maintainers of LNSym to add <code>lean-action</code> to their workflow</a>.</p>",
        "id": 464385994,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724334829
    },
    {
        "content": "<p>I think mixing setup-only and setup-plus-do-stuff in the same package name probably just increases the risk of things being run twice. If you put things in a <code>lean-setup</code> action, then <code>lean-action</code> can use that as its first step, right?</p>",
        "id": 464421539,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1724343041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/464421539\">said</a>:</p>\n<blockquote>\n<p>I think mixing setup-only and setup-plus-do-stuff in the same package name probably just increases the risk of things being run twice. If you put things in a <code>lean-setup</code> action, then <code>lean-action</code> can use that as its first step, right?</p>\n</blockquote>\n<p>I agree. It seems more straightforward to separate the setup-only from the setup-plus-do-stuff. That adheres to the <code>setup-*</code> pattern and if someone simply needs Lean setup in their workflow, they don't have to worry about <code>lean-action</code> doing something unexpected.</p>",
        "id": 464443603,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724348760
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> is this in use: <a href=\"https://github.com/Julian/setup-lean\">https://github.com/Julian/setup-lean</a></p>",
        "id": 464443821,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724348840
    },
    {
        "content": "<p>It seems close to what we are discussing <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>",
        "id": 464444732,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724349154
    },
    {
        "content": "<p>Kind of. It's used by <code>lean.nvim</code> but no one else, likely because I 1) didn't advertise it, 2) it doesn't do much! It's like 4 lines. I'm very happy for it to disappear or get taken over or to do whatever with it.</p>",
        "id": 464445158,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724349295
    },
    {
        "content": "<p>I agree though that I would generally expect any language to have some action called <code>setup-&lt;language&gt;</code> which does not much more than \"install the language for me\" typically.</p>",
        "id": 464445296,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724349335
    },
    {
        "content": "<h2>v1.0.2 Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h2>\n<p>This is a minor release motivated by the fix for the log expansion issue flagged by <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>. Moving forward, when a Lake command fails, GitHub should automatically expand the log group corresponding to the failing step. This means users will hopefully spend less time reading workflow output :)</p>\n<p>If anyone encounters other log group issues or UX annoyances, please message here or create an issue on GitHub. There is still room for improvement in this area.</p>\n<p>No action is needed to upgrade to this release as long as you are using the <code>leanprover/lean-action@v1</code>. You can read the release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1.0.2\">here</a>.</p>",
        "id": 465163002,
        "sender_full_name": "Austin Letson",
        "timestamp": 1724674151
    },
    {
        "content": "<h2>v1.1.0 Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h2>\n<p>Thank you <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> and <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, for the help with adding Windows runner support!</p>\n<h2>Improvements</h2>\n<ul>\n<li><code>lean-action</code> now supports Windows runners <span aria-label=\"window\" class=\"emoji emoji-1fa9f\" role=\"img\" title=\"window\">:window:</span> </li>\n<li>removed redundant cache checks</li>\n</ul>\n<p>You can view the full release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1.1.0\">here</a>.</p>",
        "id": 470590743,
        "sender_full_name": "Austin Letson",
        "timestamp": 1726490869
    },
    {
        "content": "<p>It would be useful to have an action which can be set to run on a schedule in GitHub actions which sends an automated PR running <code>lake update</code> if doing so produces changes, i.e. if there's a dependency to update (perhaps even configurably automerging the PR if CI passes, though this could be done by the user of the action). This effectively reimplements dependabot for Lean project dependencies (hoping for new dependabot-supported languages usually isn't fruitful as we've discussed previously).</p>\n<p>I think ages ago there used to be an action that did this specifically for Mathlib in Lean 3 -- has this kind of functionality been discussed anywhere recently, either within the scope of <code>lean-action</code> or otherwise in general?</p>",
        "id": 471495939,
        "sender_full_name": "Julian Berman",
        "timestamp": 1726755090
    },
    {
        "content": "<p>In case it's helpful, in the mathlib4 repo, we have the <a href=\"https://github.com/leanprover-community/mathlib4/blob/8e9838b850aee39812977a1cd4ad9f4b7c67cc06/.github/workflows/update_dependencies.yml\">update_dependencies.yml</a> workflow for this; it relies a bit on the details of our labeling scheme though.</p>",
        "id": 471497199,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1726755460
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> </p>\n<p>We have already such an github action!<br>\nDo you know lean-update action? <a href=\"https://github.com/oliver-butterley/lean-update\">https://github.com/oliver-butterley/lean-update</a></p>",
        "id": 471498186,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726755736
    },
    {
        "content": "<p>I did not! I was only aware of the Mathlib workflow. That does look exactly like what I want, thanks. The description in GitHub says \"update Lean and mathlib\", but hopefully it means any dependencies of a project, right?</p>",
        "id": 471498715,
        "sender_full_name": "Julian Berman",
        "timestamp": 1726755893
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> This action update any lean libraries including mathlib.</p>",
        "id": 471498836,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726755933
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>, <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span>, what are the prospects for rolling this into <code>lean-action</code> (and possibly even turning it on by default)? It would be great if merely typing <code>lake new</code> gave you this functionality!</p>",
        "id": 471579176,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726789378
    },
    {
        "content": "<p>Separately, can we replace the Mathlib workflow with this?</p>",
        "id": 471579191,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726789390
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/471579176\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span>, <span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span>, what are the prospects for rolling this into <code>lean-action</code> (and possibly even turning it on by default)? It would be great if merely typing <code>lake new</code> gave you this functionality!</p>\n</blockquote>\n<p>We discussed combining them a few months ago but I believe we decided then to wait until both were more fleshed out. Now that it is easier to separate the functionality of <code>lean-action</code> into separate workflows triggered by PRs and cron jobs, I think we could combine them without too much difficulty.</p>\n<p>What do you think <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>?</p>",
        "id": 471582679,
        "sender_full_name": "Austin Letson",
        "timestamp": 1726791865
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<blockquote>\n<p>what are the prospects for rolling this into <code>lean-action</code> (and possibly even turning it on by default)? It would be great if merely typing <code>lake new</code> gave you this functionality!</p>\n</blockquote>\n<p>I think it's nice idea!</p>",
        "id": 471610724,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1726806582
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/471582679\">said</a>:</p>\n<blockquote>\n<p>We discussed combining them a few months ago but I believe we decided then to wait until both were more fleshed out. Now that it is easier to separate the functionality of <code>lean-action</code> into separate workflows triggered by PRs and cron jobs, I think we could combine them without too much difficulty.</p>\n<p>What do you think <span class=\"user-mention silent\" data-user-id=\"613177\">Oliver Butterley</span>?</p>\n</blockquote>\n<p><code>lean-update</code> is now rather fleshed out although I would say it is still short of the quality of a v1 release. It covers the use cases we could think about and it has been tested in various places but not very extensively used as yet. </p>\n<p>I had planned to substantially improve the reporting of problems when they happen and improve the way that commits/PRs/issues are done by the action if such is selected by the user. Also functionality like updating deprecations. However in the last months I had zero spare time for any of this. I also planned to  rewrite it as a javascript action since it was getting more complicated and that would make the code more maintainable.</p>\n<p>Within a month I should again have time to polish the parts that need it to get it up to release quality. Or if anyone else wants to take it over and/or incorporate such functionality in lean-action that would be great!</p>",
        "id": 472079493,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1727035269
    },
    {
        "content": "<blockquote>\n<p>Within a month I should again have time to polish the parts that need it to get it up to release quality. Or if anyone else wants to take it over and/or incorporate such functionality in lean-action that would be great!</p>\n</blockquote>\n<p>Although lean-update is incomplete at the moment, it still implements key features and could be incorporated into lean-action. I can help with the work.</p>",
        "id": 472107063,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1727054181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/472107063\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Within a month I should again have time to polish the parts that need it to get it up to release quality. Or if anyone else wants to take it over and/or incorporate such functionality in lean-action that would be great!</p>\n</blockquote>\n<p>Although lean-update is incomplete at the moment, it still implements key features and could be incorporated into lean-action. I can help with the work.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, given that you have experience working on both <code>lean-action</code> and <code>lean-update</code>, would you be willing to write an issue on the <code>lean-action</code> repo outlining a high-level plan on how we would incorporate <code>lean-update</code> into <code>lean-action</code>? </p>\n<p>Specifically, it would be great if you could address: </p>\n<ol>\n<li>Architectural updates needed in <code>lean-action</code> to support this new use case </li>\n<li>Recommendations for integrating the new <code>lake update</code> feature into <code>lean-action</code>'s existing user interface</li>\n</ol>\n<p>This would serve as an excellent starting point and help us determine if we need additional input from the community before implementing the <code>lake update</code> functionality.</p>",
        "id": 472675949,
        "sender_full_name": "Austin Letson",
        "timestamp": 1727264437
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> </p>\n<p>Thank you. Review work was carried out.<br>\nMy opinion is here: <a href=\"https://github.com/leanprover/lean-action/pull/105\">https://github.com/leanprover/lean-action/pull/105</a></p>",
        "id": 472784650,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1727304431
    },
    {
        "content": "<h2>v1.1.1 Release of <code>lean-action</code> <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></h2>\n<p>Thank you, <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> and <span class=\"user-mention\" data-user-id=\"417967\">@Abdalrhman M Mohamed</span>, for filing bug reports!</p>\n<h3>Fixed</h3>\n<ul>\n<li>fix bug with passing multiple arguments to <code>lake build</code> via <code>build-args</code> input</li>\n<li>fix false feature flag logic when using <code>auto-config: true</code></li>\n</ul>\n<p>This is a bug-fix release. No action is needed to update. You can view the full release notes <a href=\"https://github.com/leanprover/lean-action/releases/tag/v1.1.1\">here</a>.</p>",
        "id": 484065238,
        "sender_full_name": "Austin Letson",
        "timestamp": 1732368674
    },
    {
        "content": "<p>Hi, should lean action catch <code>warning: [file]: declaration uses 'sorry'</code> and mark the \"build\" action as failed?</p>",
        "id": 484660345,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732694897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/484660345\">said</a>:</p>\n<blockquote>\n<p>Hi, should lean action catch <code>warning: [file]: declaration uses 'sorry'</code> and mark the \"build\" action as failed?</p>\n</blockquote>\n<p>By default, <code>lean-action</code> runs <code>lake build</code>without any parameters, which does not result in a failure for any warnings. You can configure Lake as you would through the command line with the <code>build-args</code> input. For example, to run <code>lean-action</code> with <code>lake build --fail-level=warning</code>:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">leanprover/lean-action@v1</span>\n<span class=\"w\">  </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nt\">build-args</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"--fail-level=warning\"</span>\n</code></pre></div>\n<p><a href=\"https://github.com/leanprover-community/batteries/blob/main/.github/workflows/build.yml#L19\">This is what batteries does.</a></p>\n<p>This would cause <code>lean-action</code> to fail on all warnings, not just <code>declaration uses 'sorry'</code>. I don't know if there is a lake option to specify specific warnings that should cause failure.</p>",
        "id": 484703902,
        "sender_full_name": "Austin Letson",
        "timestamp": 1732708810
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> </p>\n<p>by the way what happened to the lean-update action?</p>",
        "id": 484704154,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1732708880
    },
    {
        "content": "<p>Is there a way to keep building but still report an error, or should I add a step to grep the output?</p>",
        "id": 484742549,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732720109
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/484704154\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span> </p>\n<p>by the way what happened to the lean-update action?</p>\n</blockquote>\n<p>I promised to do a complete overhaul of lean-update, both improving reporting and code structure. However I started only recently because of various other commitments. I expect to get it done soon!</p>",
        "id": 484765717,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1732727485
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span>  Thank you! Sorry I've been so forgetful.</p>",
        "id": 484902111,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1732794216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/484742549\">said</a>:</p>\n<blockquote>\n<p>Is there a way to keep building but still report an error, or should I add a step to grep the output?</p>\n</blockquote>\n<p>Without <code>--fail-level=warning</code>, the error is still reported in the workflow log files. <a href=\"https://github.com/austinletson/warningtest/actions/runs/12049622291/job/33596754339#step:3:74\">Here</a> is an example run where <code>lake build</code> found sorrys but continued.  </p>\n<p>However, this information is buried in the log file and isn't particularly helpful, for instance, if you want to be notified on a PR that the proposed changes contain a sorry but still finish the build. What is the use case you're looking to address?</p>",
        "id": 484904860,
        "sender_full_name": "Austin Letson",
        "timestamp": 1732795148
    },
    {
        "content": "<p>Grepping the output may currently be the best solution. In the past, we have discussed creating a better integration between Lake warnings/errors and the GitHub actions messaging API. Maybe it is time to add this feature.</p>",
        "id": 484904959,
        "sender_full_name": "Austin Letson",
        "timestamp": 1732795183
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> </p>\n<p>Hello,<br>\nI have taken over the work from the busy Oliver and refactored the <em>lean-update</em>(  <a href=\"https://github.com/Seasawher/lean-update\">https://github.com/Seasawher/lean-update</a> ) action. I rewrote some Bash scripts in PowerShell, added several features, and improved some messages.</p>\n<p>In my opinion, I am ready to hand over the work to you, Austin! This is something that Oliver and I have built together, but we are prepared to transfer ownership to <em>leanprover</em> organization if it helps more people use this GitHub Action. This GitHub Action is really useful and has become an essential part of my development life. I believe the same is true for quite a few Lean users as well!</p>\n<p>I would love to hear Austin's thoughts!</p>",
        "id": 502147693,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740605360
    },
    {
        "content": "<p>Does the fact that it is uses PowerShell mean that it only works on Windows runners?</p>",
        "id": 502249420,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740652540
    },
    {
        "content": "<p>Can one configure whether to run <code>lake build</code> + <code>lake test</code> + <code>lake lint</code> to determine success of the update? What about configuring other scripts to run to validate?</p>",
        "id": 502249712,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740652600
    },
    {
        "content": "<p>Could you clarify the meaning of <a href=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L21\">https://github.com/Seasawher/lean-update/blob/main/action.yml#L21</a>, it is not obviously to me what this setting does?</p>",
        "id": 502249887,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740652647
    },
    {
        "content": "<p>The README needs to show how to configure it.</p>",
        "id": 502249933,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740652662
    },
    {
        "content": "<p>Can we decide an active repo to try this out in? Any volunteers (Carleson, infinity-cosmos, FLT??)</p>",
        "id": 502250048,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740652689
    },
    {
        "content": "<blockquote>\n<p>Does the fact that it is uses PowerShell mean that it only works on Windows runners?</p>\n</blockquote>\n<p>No. PowerShell Core runs on Ubuntu, and <code>pwsh</code> works on popular Ubuntu images used in GitHub Actions.</p>",
        "id": 502251100,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740652987
    },
    {
        "content": "<blockquote>\n<p>Can one configure whether to run <code>lake build</code> + <code>lake test</code> + <code>lake lint</code> to determine success of the update? What about configuring other scripts to run to validate?</p>\n</blockquote>\n<p>You can configure what to pass to the <code>build-args</code> of <code>lean-action</code>. Therefore, it is possible to treat warnings as failures. Whether to run <code>lake test</code> or <code>lake lint</code> is determined by <code>lean-action</code>.</p>",
        "id": 502251755,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740653162
    },
    {
        "content": "<blockquote>\n<p>Could you clarify the meaning of <a href=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L21\">https://github.com/Seasawher/lean-update/blob/main/action.yml#L21</a>, it is not obviously to me what this setting does?</p>\n</blockquote>\n<p>Sorry for the lack of explanation. The README is also lacking details, but I believe the description section of <code>action.yml</code> should be sufficient for understanding. I'll add more details to improve it.</p>",
        "id": 502252183,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740653280
    },
    {
        "content": "<blockquote>\n<p>The README needs to show how to configure it.</p>\n</blockquote>\n<p>I'll add how to setup later.</p>",
        "id": 502252360,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740653317
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/lean-action/near/502250048\">said</a>:</p>\n<blockquote>\n<p>Can we decide an active repo to try this out in? Any volunteers (Carleson, infinity-cosmos, FLT??)</p>\n</blockquote>\n<p>lean-update is used in FLT. <a href=\"https://github.com/ImperialCollegeLondon/FLT/blob/main/.github%2Fworkflows%2Fupdate-dependencies.yml#L19\">link to workflow</a></p>\n<p><a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/303\">Here</a> is a link to an automated update PR created by lean-update.</p>",
        "id": 502252636,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740653402
    },
    {
        "content": "<blockquote>\n<p>Can we decide an active repo to try this out in? Any volunteers (Carleson, infinity-cosmos, FLT??)</p>\n</blockquote>\n<p>At the moment, I am testing this GitHub Action in my actively developed repository.<br>\nHowever, it should indeed be tested in many use cases.<br>\nRegarding this, I would like to hear <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span>'s  opinion.</p>",
        "id": 502252767,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740653428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> could  you outline the differences between your fork and Oliver's lean-update?</p>\n<p>I agree that the README should show configuration options and usage examples.</p>",
        "id": 502255856,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740654356
    },
    {
        "content": "<p>Is it possible to reuse parts of the README that Oliver wrote?</p>",
        "id": 502257017,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740654712
    },
    {
        "content": "<p>Hi everyone! </p>\n<p>I'm sorry for any inconvenience I might have inadvertently caused, I genuinely thought I would get some time to do the overhaul of lean-update I claimed I would do but then life happened, months passed and I still didn't get the spare time. </p>\n<p>I keep no hold on it, if it is useful and someone has time to improve it then that's great. If I should put a notice on my repo about it moving to another place for active development then let me know.</p>",
        "id": 502257118,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1740654739
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span>  <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<blockquote>\n<p>could you outline the differences between your fork and Oliver's lean-update?</p>\n</blockquote>\n<p>The differences between Oliver's action and my fork are minor, but there are a few distinctions:</p>\n<ul>\n<li>It does not display todo messages. Instead, when an issue is raised due to a failed update, it notifies which files were updated.</li>\n<li>A new option called <code>what_to_update</code> has been added. This allows the action to trigger notifications or pull requests only when the Lean version changes. This feature was primarily developed for repositories that depend on Mathlib. Such repositories need to frequently check for updates to ensure existing code is not broken, but they do not necessarily want to update the code unless a breakage occurs. This is because updating Mathlib requires rebuilding the environment locally each time.</li>\n<li>A new option called <code>build_args</code> has been added. This allows passing the <code>--fail-level=warning</code> option to <code>lean-action</code>, treating warnings as update failures.</li>\n</ul>",
        "id": 502257134,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740654744
    },
    {
        "content": "<blockquote>\n<p>I agree that the README should show configuration options and usage examples.</p>\n</blockquote>\n<p>OK! wait a minute.</p>",
        "id": 502257239,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740654788
    },
    {
        "content": "<blockquote>\n<p>Is it possible to reuse parts of the README that Oliver wrote?</p>\n</blockquote>\n<p>I think so, maybe</p>",
        "id": 502257295,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740654805
    },
    {
        "content": "<p>No worries <span class=\"user-mention\" data-user-id=\"613177\">@Oliver Butterley</span>! Thank you for your work on this. As mentioned above FLT is already getting a lot of use out of the tool.</p>",
        "id": 502257660,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740654908
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502257239\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>I agree that the README should show configuration options and usage examples.</p>\n</blockquote>\n<p>OK! wait a minute.</p>\n</blockquote>\n<p>Sorry! haha. I missed your response to this above</p>",
        "id": 502257689,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740654922
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> what do you think about testing your fork in FLT since Kevin and Pietro have already adopted a workflow that includes lean-update? They may also have some useful feedback after using alpha version.</p>",
        "id": 502259203,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740655455
    },
    {
        "content": "<blockquote>\n<p>what do you think about testing your fork in FLT since Kevin and Pietro have already adopted a workflow that includes lean-update? They may also have some useful feedback after using alpha version.</p>\n</blockquote>\n<p>I think it's a good idea. <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 502261410,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740656223
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>README has been updated. <a href=\"https://github.com/Seasawher/lean-update\">https://github.com/Seasawher/lean-update</a></p>",
        "id": 502265165,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740657494
    },
    {
        "content": "<p>My goal is to ensure that when <code>lake new</code> is executed, <code>lean-update</code> or its successor action is generated simultaneously. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 502268472,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740658557
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span>, what do you think about switching to this fork?</p>",
        "id": 502382921,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740692781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, is it necessarily to include</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">permissions</span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">contents</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span>\n<span class=\"w\">      </span><span class=\"n\">pull</span><span class=\"bp\">-</span><span class=\"n\">requests</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span>\n<span class=\"w\">      </span><span class=\"n\">issues</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">write</span>\n</code></pre></div>\n<p>in the config files? What happens if these are omitted?</p>",
        "id": 502386742,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693064
    },
    {
        "content": "<p>Why does the README recommend the line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">        </span><span class=\"n\">id</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"bp\">-</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">mathlib</span>\n</code></pre></div>\n<p>This is just a generic thing: if the example setup isn't making use of it, let's leave it out. If we have an example where a later step makes use of the id, let's have that as a later example in the docs.</p>",
        "id": 502388075,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693153
    },
    {
        "content": "<p>The second example is missing the comment <code># allows workflow to be triggered manually</code></p>",
        "id": 502389230,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693218
    },
    {
        "content": "<p>Could you clarify in \"However, you can configure what build arguments are passed to lean-action using the <code>build_args</code> option.\" that these arguments are passed direct to <code>lake build</code>, not to anything else in <code>lean-action</code>?</p>",
        "id": 502391345,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693302
    },
    {
        "content": "<p>I think we should rename the <code>what_to_update</code> field. What about <code>update_if_modified</code>? Currently it reads as an instruction: please modify this file, rather than a condition: please take some action if this file is modified by <code>lake update</code>.</p>",
        "id": 502394023,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693411
    },
    {
        "content": "<p>I propose we change the default value of <code>what_to_update</code> to <code>lake-manifest.json</code>, and in the first example, remove this field (i.e. take advantage of the default value).</p>",
        "id": 502395837,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693496
    },
    {
        "content": "<p>I would really like to also see a <code>zulip</code> option for both <code>on_update_succeeds</code> and <code>on_update_fails</code>, configurable with a stream/topic/api key. This would allow us to replace Mathlib's existing automatic update with this action.</p>",
        "id": 502398821,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693621
    },
    {
        "content": "<p>The zulip option should probably be <em>in addition</em> to the current alternative actions, rather than a replacement.</p>",
        "id": 502399640,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693655
    },
    {
        "content": "<p>The choice of Powershell doesn't seem very friendly to other potential contributors. Why not go with the Actions lingua franca, JS?</p>",
        "id": 502399920,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1740693666
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502399920\">said</a>:</p>\n<blockquote>\n<p>The choice of Powershell doesn't seem very friendly to other potential contributors. Why not go with the Actions lingua franca, JS?</p>\n</blockquote>\n<p>Yes, please. I hesitated to say this above, because I'm happy to see work being done on this and didn't want to discourage, but if this is going to be adopted widely it's really going to have to be JS.</p>",
        "id": 502401572,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693738
    },
    {
        "content": "<p>(<a href=\"https://claude.ai/share/cb6518eb-41a3-4fce-a678-c9d29860f5d1\">https://claude.ai/share/cb6518eb-41a3-4fce-a678-c9d29860f5d1</a> might suffice :-)</p>",
        "id": 502405027,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693896
    },
    {
        "content": "<p>Actually looking at the code now, I don't see any validation that the field <code>what_to_update</code> is one of the two allowed options. There should be an actionable error message in this case.</p>",
        "id": 502406465,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740693953
    },
    {
        "content": "<blockquote>\n<p>is it necessarily to include ...<br>\nin the config files? What happens if these are omitted?</p>\n</blockquote>\n<p>I tested it and it worked without it. It seems unnecessary. done!</p>\n<blockquote>\n<p>Why does the README recommend the line ..<br>\nThis is just a generic thing: if the example setup isn't making use of it, let's leave it out. If we have an example where a later step makes use of the id, let's have that as a later example in the docs.</p>\n</blockquote>\n<p>Oh, sorry. done!</p>\n<blockquote>\n<p>The second example is missing the comment <code># allows workflow to be triggered manually</code></p>\n</blockquote>\n<p>done!</p>\n<blockquote>\n<p>Could you clarify in \"However, you can configure what build arguments are passed to lean-action using the build_args option.\" that these arguments are passed direct to <code>lake build</code>, not to anything else in lean-action?</p>\n</blockquote>\n<p>done!</p>\n<blockquote>\n<p>I think we should rename the what_to_update field. What about update_if_modified? Currently it reads as an instruction: please modify this file, rather than a condition: please take some action if this file is modified by lake update.</p>\n</blockquote>\n<p>nice idea! done!</p>\n<blockquote>\n<p>I propose we change the default value of what_to_update to lake-manifest.json, and in the first example, remove this field (i.e. take advantage of the default value).</p>\n</blockquote>\n<p>That might be more intuitive. done!</p>\n<blockquote>\n<p>I would really like to also see a zulip option for both on_update_succeeds and on_update_fails, configurable with a stream/topic/api key. This would allow us to replace Mathlib's existing automatic update with this action.</p>\n</blockquote>\n<p>wait a minute, please <span aria-label=\"construction zone\" class=\"emoji emoji-1f6a7\" role=\"img\" title=\"construction zone\">:construction_zone:</span> </p>\n<blockquote>\n<p>The choice of Powershell doesn't seem very friendly to other potential contributors. Why not go with the Actions lingua franca, JS?</p>\n</blockquote>\n<p>wait a minute, please <span aria-label=\"construction zone\" class=\"emoji emoji-1f6a7\" role=\"img\" title=\"construction zone\">:construction_zone:</span></p>",
        "id": 502493530,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740717374
    },
    {
        "content": "<p>Thanks!!</p>",
        "id": 502493617,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740717447
    },
    {
        "content": "<blockquote>\n<p>The choice of Powershell doesn't seem very friendly to other potential contributors. Why not go with the Actions lingua franca, JS?</p>\n</blockquote>\n<p>done!</p>",
        "id": 502496232,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740719041
    },
    {
        "content": "<p>If you're interested in implementing the zulip messaging, there are examples e.g. in mathlib's <code>.github/workflows/nightly_detect_failure.yml</code>.</p>",
        "id": 502496331,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740719103
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>If I implement the <code>zulip</code> option in a straightforward way, it might end up being an option exclusive to Mathlib.<br>\nWhat kind of specifications would be suitable to make it a more general-purpose implementation?</p>",
        "id": 502497641,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740719868
    },
    {
        "content": "<p>You should be able to specify the stream, topic, and which API key to use.</p>",
        "id": 502497953,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740720089
    },
    {
        "content": "<p>The key shouldn't be specified directly in the configuration file, just the name of the GitHub secret containing it.</p>",
        "id": 502497978,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740720112
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <br>\nWouldn't it be more natural to make this action return the appropriate output and pass it to <code>zulip/github-actions-zulip/send-message</code>?</p>",
        "id": 502501263,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740722309
    },
    {
        "content": "<p>I thought that if I pass the information about whether this action's update process succeeded or failed, <code>zulip/github-actions-zulip/send-message</code> should be able to handle the rest. What do you think?</p>",
        "id": 502502620,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740723044
    },
    {
        "content": "<p>I thought it would be a good idea to include an example in this Action's README for notifying Zulip...?</p>",
        "id": 502503233,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740723421
    },
    {
        "content": "<p>zulip action test: update succeed! </p>\n<p>(this is automatedly sent)</p>",
        "id": 502510346,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740727312
    },
    {
        "content": "<p>Here is a sample</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">actions/checkout@v4</span>\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Update Lean project</span>\n<span class=\"w\">        </span><span class=\"nt\">id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">lean-update</span>\n<span class=\"w\">        </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Seasawher/lean-update@main</span>\n<span class=\"w\">        </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"nt\">update_if_modified</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">lean-toolchain</span>\n\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Zulip Notifycation</span>\n<span class=\"w\">        </span><span class=\"nt\">if</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">steps.lean-update.outputs.result == 'update-success'</span>\n<span class=\"w\">        </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">zulip/github-actions-zulip/send-message@v1</span>\n<span class=\"w\">        </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"nt\">api-key</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">${{ secrets.ZULIP_API_KEY }}</span>\n<span class=\"w\">          </span><span class=\"nt\">email</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"tellagoodstory@icloud.com\"</span>\n<span class=\"w\">          </span><span class=\"nt\">organization-url</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">'https://leanprover.zulipchat.com'</span>\n<span class=\"w\">          </span><span class=\"nt\">to</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"general\"</span>\n<span class=\"w\">          </span><span class=\"nt\">type</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"stream\"</span>\n<span class=\"w\">          </span><span class=\"nt\">topic</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"lean-action\"</span>\n<span class=\"w\">          </span><span class=\"nt\">content</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"zulip</span><span class=\"nv\"> </span><span class=\"s\">action</span><span class=\"nv\"> </span><span class=\"s\">test:</span><span class=\"nv\"> </span><span class=\"s\">update</span><span class=\"nv\"> </span><span class=\"s\">succeed!\"</span>\n</code></pre></div>",
        "id": 502510735,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740727488
    },
    {
        "content": "<p>hmm, it seems to be required to return whether “update if modified” was triggered…<br>\nbut what will I name the result…?</p>",
        "id": 502672428,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740779267
    },
    {
        "content": "<p>I'm a bit late for the party but I'm passing here just to thank everyone involved in making this <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 502683968,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1740785073
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502382921\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span>, what do you think about switching to this fork?</p>\n</blockquote>\n<p>Sure, I'll do it on all the projects I (co-)maintain giving higher priority to the LeanProject template.</p>\n<p>I assume <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> would like to remove the <code>-R -Kenv=dev</code> in <code>lake -R -Kenv=dev update</code> that is run by the <code>lean-update</code> action, right? <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<p><a class=\"stream\" data-stream-id=\"442935\" href=\"/#narrow/channel/442935-Carleson\">#Carleson</a> and <a class=\"stream\" data-stream-id=\"416277\" href=\"/#narrow/channel/416277-FLT\">#FLT</a>  don't need it anymore, but others such as <a class=\"stream\" data-stream-id=\"458659\" href=\"/#narrow/channel/458659-Equational\">#Equational</a> and <a class=\"stream\" data-stream-id=\"455414\" href=\"/#narrow/channel/455414-Infinity-Cosmos\">#Infinity-Cosmos</a> still do. It can be easily resolved with a new release removing the <code>-R -Kenv=dev</code> in such a way that those projects can continue using the older version for a while. </p>\n<p>LeanProject must wait for LeanBlueprint to be updated in order to accomodate for such a change though.</p>",
        "id": 502684844,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740785598
    },
    {
        "content": "<p>Done <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span></p>",
        "id": 502688045,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740787523
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"556875\">Pietro Monticone</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502684844\">said</a>:</p>\n<blockquote>\n<p>I assume @Kim Morrison would like to remove the <code>-R -Kenv=dev</code> in <code>lake -R -Kenv=dev update</code> that is run by the <code>lean-update</code> action, right? <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<p><a href=\"#narrow/channel/442935-Carleson\">#Carleson</a> and <a href=\"#narrow/channel/416277-FLT\">#FLT</a> don't need it anymore, but others such as <a href=\"#narrow/channel/458659-Equational\">#Equational</a> and <a href=\"#narrow/channel/455414-Infinity-Cosmos\">#Infinity-Cosmos</a> still do. It can be easily resolved with a new release removing the <code>-R -Kenv=dev</code> in such a way that those projects can continue using the older version for a while.</p>\n</blockquote>\n<p>Yes, please! <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, does this make sense?</p>",
        "id": 502690490,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740789066
    },
    {
        "content": "<p><a href=\"https://github.com/Seasawher/lean-update/pull/3\">Here</a> is the related PR. Please consider tagging a (<code>0.0.1</code>?) release before merging this PR.</p>",
        "id": 502691536,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740789798
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span> Could you please use the standard <code>v0.0.1</code> as the release tag and title?</p>",
        "id": 502707124,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740801525
    },
    {
        "content": "<p>done!</p>",
        "id": 502707268,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740801633
    },
    {
        "content": "<p>Thanks. I'll add it to all the projects who requires <code>-R -Kenv=dev</code> now.</p>",
        "id": 502707308,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740801674
    },
    {
        "content": "<p>Done <span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span></p>",
        "id": 502707656,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1740801899
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>Sorry, I forgot something very important.</p>\n<p>When running <code>lake update</code>, does lake automatically upgrade from a stable version like v4.16.0 to a pre-release version like v4.17.0-rc1?</p>",
        "id": 502714526,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740808205
    },
    {
        "content": "<p>Sure</p>",
        "id": 502725711,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1740818588
    },
    {
        "content": "<blockquote>\n<p>When running <code>lake update</code>, does lake automatically upgrade from a stable version like v4.16.0 to a pre-release version like v4.17.0-rc1?</p>\n</blockquote>\n<p>No! If the version of <code>lake</code> is outdated, updates may not work as expected.</p>",
        "id": 502735460,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740826898
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>  What do you think of lean-update serving as the reminder/automation to create tags for new tool chains. lean-update could tag the first commit after <code>lake update</code> with the corresponding toolchain-tag.</p>\n<p>Note, <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span>'s LeanProject <a href=\"https://github.com/pitmonticone/LeanProject/blob/main/.github/workflows/create-release.yml\">create-release</a> workflow does this already, but it is triggered off of modifications to <code>lean-toolchain</code>.</p>",
        "id": 502735517,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740826928
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502735460\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>When running <code>lake update</code>, does lake automatically upgrade from a stable version like v4.16.0 to a pre-release version like v4.17.0-rc1?</p>\n</blockquote>\n<p>No! If the version of <code>lake</code> is outdated, updates may not work as expected.</p>\n</blockquote>\n<p>From the <a href=\"https://lean-lang.org/doc/reference/latest//Build-Tools-and-Distribution/Lake/#automatic-toolchain-updates\">Lake section of the Reference</a>:</p>\n<blockquote>\n<p>The lake update command checks for changes to dependencies, fetching their sources and updating the manifest accordingly. By default, lake update also attempts to update the root package's toolchain file when a new version of a dependency specifies an updated toolchain. This behavior can be disabled with the --keep-toolchain flag.</p>\n</blockquote>\n<p>I think this means that <code>lake update</code> would only update from v4.16.0 to v4.17.0-rc1, if the root package depends on a package that uses v4.17.0-rc1.</p>",
        "id": 502736488,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740827724
    },
    {
        "content": "<blockquote>\n<p>No! If the version of <code>lake</code> is outdated, updates may not work as expected.</p>\n</blockquote>\n<p>This issue has been resolved. I have used old solution which I used for Oliver's Action...<br>\nGet all release of Lean, and sort them, and rewrite lean-toolchain!</p>",
        "id": 502736609,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740827826
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> </p>\n<blockquote>\n<p>What do you think of lean-update serving as the reminder/automation to create tags for new tool chains. lean-update could tag the first commit after <code>lake update</code> with the corresponding toolchain-tag.</p>\n</blockquote>\n<p>I can't imagine what you mean, so please explain more specifically what it will be used for.</p>",
        "id": 502736750,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740827951
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 502736892,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740828080
    },
    {
        "content": "<p>For example, taking the Qq library as a case, does this mean setting up lean-update for the Qq library so that a release tag is assigned the moment a PR is merged after a notification about the Qq library's lean-toolchain update?</p>",
        "id": 502737194,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740828320
    },
    {
        "content": "<p>I see. If that works, then simply merging a PR from GitHub Mobile would automatically complete the release process. That feature would certainly be convenient for me as well.<br>\nHowever, I'm still not sure whether it should be a feature included in lean-update.</p>",
        "id": 502737375,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740828477
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502736750\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"699684\">Austin Letson</span> </p>\n<blockquote>\n<p>What do you think of lean-update serving as the reminder/automation to create tags for new tool chains. lean-update could tag the first commit after <code>lake update</code> with the corresponding toolchain-tag.</p>\n</blockquote>\n<p>I can't imagine what you mean, so please explain more specifically what it will be used for.</p>\n</blockquote>\n<p>Lean packages can have tags for each compatible toolchain so that users can use the version of the package that corresponds to a specific toolchain. <a href=\"https://lean-lang.org/lean4/doc/dev/release_checklist.html\">This is done for several core projects when a new version of Lean is released</a>, however it would be useful for other projects to automatically get toolchain tags. For example, this came up recently when discussing how to use Pantograph with a specific version of Lean to scrape sorry statements from projects across different toolchains (<a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Incentives.20.26.20sorry-filling.20leaderboard/near/501439043\">link to zulip thread</a>).</p>",
        "id": 502737510,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740828518
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502737194\">said</a>:</p>\n<blockquote>\n<p>For example, taking the Qq library as a case, does this mean setting up lean-update for the Qq library so that a release tag is assigned the moment a PR is merged after a notification about the Qq library's lean-toolchain update?</p>\n</blockquote>\n<p>Yes, exactly!</p>",
        "id": 502737657,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740828607
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502737375\">said</a>:</p>\n<blockquote>\n<p>I see. If that works, then simply merging a PR from GitHub Mobile would automatically complete the release process. That feature would certainly be convenient for me as well.<br>\nHowever, I'm still not sure whether it should be a feature included in lean-update.</p>\n</blockquote>\n<p>Yes, I am not sure if this should be included in Lean update or be a separate tool. It seems very related to lean-update's behavior, however I would defer to others who are actively maintaining larger scale Lean projects.</p>",
        "id": 502737720,
        "sender_full_name": "Austin Letson",
        "timestamp": 1740828682
    },
    {
        "content": "<p>I think it's fine to finish lean-update silently and then handle the release process in a later step.<br>\nfor example:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Update Lean package</span>\n<span class=\"w\">        </span><span class=\"nt\">id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">update</span>\n<span class=\"w\">        </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Seasawher/lean-update@main</span>\n<span class=\"w\">        </span><span class=\"nt\">with</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"nt\">on_update_succeeds</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"silent\"</span>\n<span class=\"w\">          </span><span class=\"nt\">update_if_modified</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"lean-toolchain\"</span>\n\n<span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">commit with tag, and create release</span>\n<span class=\"w\">        </span><span class=\"nt\">if</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">steps.update.outputs.result == 'update-success'</span>\n<span class=\"w\">        </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span>\n<span class=\"w\">          </span><span class=\"no\">foo bar baz....</span>\n</code></pre></div>\n<p>(I think notifications to Zulip can be handled in the same way.)</p>",
        "id": 502737735,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740828704
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>update! see: <a href=\"https://github.com/Seasawher/lean-update?tab=readme-ov-file#if-you-want-to-receive-notifications-on-zulip-when-the-update-fails\">https://github.com/Seasawher/lean-update?tab=readme-ov-file#if-you-want-to-receive-notifications-on-zulip-when-the-update-fails</a></p>\n<p>I've added an example workflow to send zulip notification</p>",
        "id": 502777319,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740856352
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> <br>\nI made it possible to obtain the latest Lean release from the output of this action. Wouldn't this allow for the implementation of automatic releases?</p>",
        "id": 502782322,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740859579
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> </p>\n<p>It must be annoying to have the update workflow running even when you are working at fork repository.<br>\nWhat do you think?<br>\nIf I fork, GitHub Action will be disabled?</p>",
        "id": 502786643,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740862411
    },
    {
        "content": "<p>I agree it is best that <code>lean-update</code> itself doesn't do the zulip notification or toolchain release tagging. But we may want to package these steps as actions, too!</p>",
        "id": 502788875,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740863826
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Is it not enough to add an example to the README?</p>",
        "id": 502788931,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740863880
    },
    {
        "content": "<p>Because no one should ever have to read the README, or know the repository exists. All this infrastructure needs to be deployed by <code>lake new</code>, and the only configuration required to uncommenting some lines. We don't want to be copy-pasting these configuration blocks into everyone's lake projects if they can be factored out into a centrally updatable action.</p>",
        "id": 502789072,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740863986
    },
    {
        "content": "<p>Let's be more helpful in the line about registering your zulip API key. That text should explain or link to:</p>\n<ul>\n<li>how to create/obtain such a key</li>\n<li>the URL <a href=\"https://github.com/&lt;YOUR-ORG&gt;/&lt;YOUR-REPO&gt;/settings/secrets/actions\">https://github.com/&lt;YOUR-ORG&gt;/&lt;YOUR-REPO&gt;/settings/secrets/actions</a> where the secret needs to be installed. </li>\n<li>doesn't need the word SECRETS capitalized?</li>\n</ul>",
        "id": 502789210,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864078
    },
    {
        "content": "<p>The line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zulip</span><span class=\"w\"> </span><span class=\"n\">Notifycation</span>\n</code></pre></div>\n<p>should be \"Notification\"</p>",
        "id": 502789230,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864094
    },
    {
        "content": "<p>The example \"content\" is wrong. It's not that the latest CI failed, but that an update failed.</p>",
        "id": 502789267,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864117
    },
    {
        "content": "<p>I think we also need to add some functionality to avoid creating duplicate issues and/or PRs. If this github action starts spamming multiple issues and PRs, people will hate it.</p>",
        "id": 502789448,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864233
    },
    {
        "content": "<p>We'd need to detect if there is an existing open issue or PR. Then there's a question: do we update that existing one, or just do nothing?</p>",
        "id": 502789531,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864267
    },
    {
        "content": "<p>Let's change the text:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">commit</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">silently</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">files</span>\n</code></pre></div>\n<p>to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">commit</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"w\"> </span><span class=\"n\">files</span>\n</code></pre></div>\n<p>(It's confusing to use the work \"silently\" when there is a separate option called \"silent\".)</p>",
        "id": 502789603,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864316
    },
    {
        "content": "<p>In the line</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Therefore</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">affect</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">behavior</span><span class=\"w\"> </span><span class=\"n\">when</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">test</span><span class=\"bp\">/</span><span class=\"n\">lint</span><span class=\"w\"> </span><span class=\"n\">fail</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>I think \"therefore\" is the wrong word, and could be confusing. Just remove \"therefore\"?</p>",
        "id": 502789709,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864404
    },
    {
        "content": "<p>\"will not skip updates as long as\" has an unnecessary double negative. Just write as \"will perform an update if\"</p>",
        "id": 502789759,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864448
    },
    {
        "content": "<p>At <a href=\"https://github.com/Seasawher/lean-update/blob/main/scripts/checkChanges.js#L16\">https://github.com/Seasawher/lean-update/blob/main/scripts/checkChanges.js#L16</a>, the error message refers to <code>UPDATE_IF_MODIFIED</code>, but the option name should not be capitalized.</p>",
        "id": 502789881,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864547
    },
    {
        "content": "<p>What is <code>postMerge.ps1</code>? Again, let's avoid powershell.</p>",
        "id": 502789910,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864584
    },
    {
        "content": "<p>There are several comments in <a href=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L127\">https://github.com/Seasawher/lean-update/blob/main/action.yml#L127</a> of <code># bat</code>. Perhaps remove? Or change to <code># bash script</code>?</p>",
        "id": 502790068,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864697
    },
    {
        "content": "<p>I just realised that <code>lean-update</code> contains the <code>getLatest.js</code> script and is manually updating the <code>lean-toolchain</code>.</p>\n<p>I think we should <em>not</em> be doing this unless the repository has no dependencies. Remember that <code>lake update</code> will update the <code>lean-toolchain</code> itself if all upstream repositories have moved to a new toolchain.</p>",
        "id": 502790208,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740864813
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/502789531\">said</a>:</p>\n<blockquote>\n<p>We'd need to detect if there is an existing open issue or PR. Then there's a question: do we update that existing one, or just do nothing?</p>\n</blockquote>\n<p>I think <code>peter-evans/create-pull-request@v7</code> supports just updating the existing one. This is what the current Mathlib auto-update action does. See <code>update_dependencies.yml</code>.</p>",
        "id": 502790519,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740865026
    },
    {
        "content": "<p>When creating a PR and/or issue, it would be good to include some additional information.</p>\n<ul>\n<li>At least, today's date, so it is easy for humans to dismiss old issues/PRs</li>\n<li>Ideally, either the title or body would state the new toolchain, if that was being modified</li>\n<li>Possibly, the body should include a list of dependencies which were being modified (nice to have, but certainly not essential --- but if we don't want to implement this now, let's create an issue for the future)</li>\n</ul>",
        "id": 502790690,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740865134
    },
    {
        "content": "<p>It might be nice (very optional) to allow customizing the github author and email associated with commits (just noticing that the existing Mathlib-specific action does this).</p>",
        "id": 502790864,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740865235
    },
    {
        "content": "<p>(Sorry to spam you with requests like this! I'm really happy to see this being implemented. Don't worry about anything you don't have time/inclination for, I can come back later and create issues etc.)</p>",
        "id": 502795920,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1740869331
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>Thanks for the detailed review. Now I am busy, so if you could make an issue it would be very helpful.</p>",
        "id": 502831739,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740900080
    },
    {
        "content": "<p>I'll respond to the ones I can respond to right away.</p>\n<blockquote>\n<p>What is <code>postMerge.ps1</code>? Again, let's avoid powershell.</p>\n</blockquote>\n<p>This is just a development script that runs on my end. I'll make it a bash script.</p>\n<blockquote>\n<p>There are several comments in <a href=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L127\" title=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L127\">https://github.com/Seasawher/lean-update/blob/main/action.yml#L127</a> of <code># bat</code>. Perhaps remove? Or change to <code># bash script</code>?</p>\n</blockquote>\n<p>It's a setup to use the extension harrydowning.yaml-embedded-languages. This makes it easier to see bash scripts etc. embedded in yaml scripts.</p>\n<blockquote>\n<p>I just realised that <code>lean-update</code> contains the <code>getLatest.js</code> script and is manually updating the <code>lean-toolchain</code>.</p>\n<p>I think we should <em>not</em> be doing this unless the repository has no dependencies. Remember that <code>lake update</code> will update the <code>lean-toolchain</code> itself if all upstream repositories have moved to a new toolchain.</p>\n</blockquote>\n<p>I thought so too, but it seems that if the Lean version of the repository to be updated is older, the update with lake update may not work.</p>",
        "id": 502951970,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740984192
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Thanks a lot for your review. But Zulip makes it hard to manage, so next time I want reviews to be submitted to PR or issue</p>",
        "id": 502953320,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1740984840
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <br>\nI would like to continually test the ability to notify zulip, is there a thread I can use as I please?</p>",
        "id": 504387169,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741521887
    },
    {
        "content": "<p>fwiw, you could have a bot send a DM</p>",
        "id": 504390432,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741524527
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span> Do I prepare a bot and then send the DM from the bot to me?</p>",
        "id": 504391787,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741525551
    },
    {
        "content": "<p>yea</p>",
        "id": 504391860,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741525586
    },
    {
        "content": "<p>i did a similar thing when i was testing how to escape <code>` </code> in messages to zulip</p>",
        "id": 504391910,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741525629
    },
    {
        "content": "<p>(apparently it's still non-trivial <span aria-label=\"smiling face with tear\" class=\"emoji emoji-1f972\" role=\"img\" title=\"smiling face with tear\">:smiling_face_with_tear:</span> )</p>",
        "id": 504392004,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741525700
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span> Thank you. your idea works well</p>",
        "id": 505093555,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741776535
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> </p>\n<p>I have added an option to run <code>lake -R -Kenv=dev update</code> instead of <code>lake update</code>. If possible, please test lean-update action using the latest version!</p>",
        "id": 505759794,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1741983474
    },
    {
        "content": "<p>Ok, I'll do it as soon as I find the time. Thanks.</p>",
        "id": 505840168,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1742039314
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> Thank you!!</p>",
        "id": 505857091,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742051731
    },
    {
        "content": "<p>Done in <a class=\"stream\" data-stream-id=\"458659\" href=\"/#narrow/channel/458659-Equational\">#Equational</a> and <a class=\"stream\" data-stream-id=\"455414\" href=\"/#narrow/channel/455414-Infinity-Cosmos\">#Infinity-Cosmos</a>.</p>",
        "id": 505857243,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1742051862
    },
    {
        "content": "<p><a href=\"https://github.com/Seasawher/lean-update/releases/tag/v0.2.0\">https://github.com/Seasawher/lean-update/releases/tag/v0.2.0</a></p>\n<p>I've implemented the feature to avoid creating duplicate issue/PR!</p>",
        "id": 505993984,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742157295
    },
    {
        "content": "<p>Added <code>lake build</code> output to the body of the issue. This allows us to know why the update failed to some extent without having to retry.</p>\n<p><a href=\"/user_uploads/3121/k6cQtf0nhrfyuUfLXcWqYE5L/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/k6cQtf0nhrfyuUfLXcWqYE5L/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"969x768\" src=\"/user_uploads/thumbnail/3121/k6cQtf0nhrfyuUfLXcWqYE5L/image.png/840x560.webp\"></a></div>",
        "id": 506646071,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742366529
    },
    {
        "content": "<p>I think I have implemented all of the features I wanted to implement in my use.</p>",
        "id": 506646131,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742366564
    },
    {
        "content": "<p>I think v1 release of lean-update would come soon…!</p>",
        "id": 506883627,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742449061
    },
    {
        "content": "<p>What's the status of my suggestions starting at <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/lean-action/near/502789072\">#general &gt; lean-action @ 💬</a> ?</p>",
        "id": 506925174,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742464716
    },
    {
        "content": "<p><del>see issue, please!</del> <br>\nsome of them are resolved</p>",
        "id": 506927179,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742465278
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 506938023,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742467941
    },
    {
        "content": "<p><strong>zulip notification</strong></p>\n<blockquote>\n<p>I agree it is best that <code>lean-update</code> itself doesn't do the zulip notification or toolchain release tagging. But we may want to package these steps as actions, too!</p>\n</blockquote>\n<p>As for having this lean-update action have the ability to send messages to Zulip, it is not yet implemented. I am still on the fence about whether this functionality should be implemented. However, I have included a working example in the README and explained it a bit more carefully.</p>",
        "id": 506947029,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470597
    },
    {
        "content": "<p><strong>Notifycation typo</strong></p>\n<blockquote>\n<p>should be \"Notification\"</p>\n</blockquote>\n<p>fixed!</p>",
        "id": 506947190,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470654
    },
    {
        "content": "<p><strong>avoid creating duplicate issue/PR</strong></p>\n<blockquote>\n<p>I think we also need to add some functionality to avoid creating duplicate issues and/or PRs.</p>\n</blockquote>\n<p>resolved!!</p>",
        "id": 506947317,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470690
    },
    {
        "content": "<p><strong>description of <code>commit</code> option</strong></p>\n<blockquote>\n<p>It's confusing to use the work \"silently\" when there is a separate option called \"silent\".</p>\n</blockquote>\n<p>done!</p>",
        "id": 506947382,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470717
    },
    {
        "content": "<p><strong>remove double negative</strong></p>\n<blockquote>\n<p>\"will not skip updates as long as\" has an unnecessary double negative. Just write as \"will perform an update if\"</p>\n</blockquote>\n<p>done!</p>",
        "id": 506947700,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470842
    },
    {
        "content": "<p><strong>avoid pwsh</strong></p>\n<blockquote>\n<p>What is <code>postMerge.ps1</code>? Again, let's avoid powershell.</p>\n</blockquote>\n<p>this is for development purpose only. (this is run in my local environment only)</p>",
        "id": 506947833,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470890
    },
    {
        "content": "<p><strong>comment in action.yml</strong></p>\n<blockquote>\n<p>There are several comments in <a href=\"https://github.com/Seasawher/lean-update/blob/main/action.yml#L127\">https://github.com/Seasawher/lean-update/blob/main/action.yml#L127</a> of <code># bat</code>. Perhaps remove? Or change to <code># bash script</code>?</p>\n</blockquote>\n<p>these comment is for syntax highlighting. see: <a href=\"https://marketplace.visualstudio.com/items?itemName=harrydowning.yaml-embedded-languages\">https://marketplace.visualstudio.com/items?itemName=harrydowning.yaml-embedded-languages</a></p>",
        "id": 506948182,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742470991
    },
    {
        "content": "<p><strong>manually update lean-toolchain</strong></p>\n<blockquote>\n<p>I just realised that <code>lean-update</code> contains the <code>getLatest.js</code> script and is manually updating the <code>lean-toolchain</code>.</p>\n</blockquote>\n<p>No real harm has been done, so it is left as it is.</p>",
        "id": 506948557,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742471107
    },
    {
        "content": "<p><strong>additional info</strong></p>\n<blockquote>\n<ul>\n<li>At least, today's date, so it is easy for humans to dismiss old issues/PRs</li>\n</ul>\n</blockquote>\n<p>As a feature of GitHub, the creation date of an issue or PR can usually be checked. Do we need to implement it?</p>\n<blockquote>\n<ul>\n<li>Ideally, either the title or body would state the new toolchain, if that was being modified</li>\n</ul>\n</blockquote>\n<p>not implemented! I agree this is a wanted feature.</p>\n<blockquote>\n<ul>\n<li>Possibly, the body should include a list of dependencies which were being modified (nice to have, but certainly not essential --- but if we don't want to implement this now, let's create an issue for the future)</li>\n</ul>\n</blockquote>\n<p>not implemented! I agree this is a wanted feature.</p>\n<blockquote>\n<p>t might be nice (very optional) to allow customizing the github author and email associated with commits (just noticing that the existing Mathlib-specific action does this).</p>\n</blockquote>\n<p>not implemented! Do we even want this?</p>",
        "id": 506948869,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742471186
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<p>I have already implemented the minimum functionality I want in lean-update. So I have a question.</p>\n<p>I would like to see lean-update incorporated into lake new, but people will be annoyed if I die or lose touch and there is no maintainer. So you would clone it under the leanprover organization, right? When will that be done? Who will be the new maintainer?</p>",
        "id": 506951123,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742471581
    },
    {
        "content": "<p>Yes, I'm sure we can adopt this under the <code>leanprover-community</code> organization. Personally, I'd be very happy if you'd continue as a maintainer of the repo, of course. We'll give people access as needed (at least people doing the monthly releases) or requested!</p>",
        "id": 507085646,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742509179
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/506948869\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>It might be nice (very optional) to allow customizing the github author and email associated with commits (just noticing that the existing Mathlib-specific action does this).</p>\n</blockquote>\n<p>not implemented! Do we even want this?</p>\n</blockquote>\n<p>We don't need to do this now. Might not hurt to open an issue about it, perhaps labelled <code>help-wanted</code>, to provide an easy place for someone new to get involved!</p>",
        "id": 507085859,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742509279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/506948869\">said</a>:</p>\n<blockquote>\n<blockquote>\n<ul>\n<li>Ideally, either the title or body would state the new toolchain, if that was being modified</li>\n</ul>\n</blockquote>\n<p>not implemented! I agree this is a wanted feature.</p>\n</blockquote>\n<p>Could you create an issue for this?</p>",
        "id": 507085889,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742509300
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626349\">Asei Inoue</span> <a href=\"#narrow/channel/113488-general/topic/lean-action/near/506948869\">said</a>:</p>\n<blockquote>\n<blockquote>\n<ul>\n<li>Possibly, the body should include a list of dependencies which were being modified (nice to have, but certainly not essential --- but if we don't want to implement this now, let's create an issue for the future)</li>\n</ul>\n</blockquote>\n<p>not implemented! I agree this is a wanted feature.</p>\n</blockquote>\n<p>Also this.</p>",
        "id": 507085904,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742509308
    },
    {
        "content": "<p>Once we at least have the tracking issues up for those, I'm happy if you want to transfer to the leanprover-community organisation. I can click \"accept\" at the other end and give you maintainer status there.</p>",
        "id": 507086006,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742509349
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<blockquote>\n<p>Once we at least have the tracking issues up for those, I'm happy if you want to transfer to the leanprover-community organisation. I can click \"accept\" at the other end and give you maintainer status there.</p>\n</blockquote>\n<p>I tried, but it seems that it is not possible to transfer to a leanprover without the permission to create a public repository in the leanprover.</p>\n<p>It would be necessary to create a new repository under leanprover by simply cloning &amp; pushing.</p>",
        "id": 507212129,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742543929
    },
    {
        "content": "<p>Can you make me an admin of your existing repo? Then I can transfer it.</p>",
        "id": 507212215,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742543966
    },
    {
        "content": "<p>It looks like you only gave me write access. I'd need admin access to transfer it.</p>",
        "id": 507212793,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544140
    },
    {
        "content": "<p>how to add admin access? I cannot edit collaborator access right.</p>",
        "id": 507213310,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544296
    },
    {
        "content": "<p><a href=\"https://github.com/Seasawher/lean-update/settings/access\">https://github.com/Seasawher/lean-update/settings/access</a></p>",
        "id": 507213429,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544337
    },
    {
        "content": "<p>I added you from the page.</p>",
        "id": 507213502,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544361
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/O1KVNfqYZtFhBb8NXYLaTK7u/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/O1KVNfqYZtFhBb8NXYLaTK7u/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"801x435\" src=\"/user_uploads/thumbnail/3121/O1KVNfqYZtFhBb8NXYLaTK7u/image.png/840x560.webp\"></a></div>",
        "id": 507213694,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544423
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/lJNt0ndpp7UuNqtVMSHymOgJ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/lJNt0ndpp7UuNqtVMSHymOgJ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"787x270\" src=\"/user_uploads/thumbnail/3121/lJNt0ndpp7UuNqtVMSHymOgJ/image.png/840x560.webp\"></a></div>",
        "id": 507213751,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544444
    },
    {
        "content": "<p>Hmm, okay, that's different from what I'm used to.</p>",
        "id": 507213809,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544468
    },
    {
        "content": "<p>Did you try transferring it to <code>leanprover-community</code>? Maybe it will ask someone to confirm? Sorry, I've forgotten how to do this, and will have to run in a moment.</p>",
        "id": 507214094,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544549
    },
    {
        "content": "<p><a href=\"https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-user-account-settings/permission-levels-for-a-personal-account-repository\">A github repository owned by a personal account has only two permission levels: repository owner and collaborators.</a></p>",
        "id": 507214131,
        "sender_full_name": "Oliver Butterley",
        "timestamp": 1742544563
    },
    {
        "content": "<p>Let's just try transferring it then.</p>",
        "id": 507214192,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544579
    },
    {
        "content": "<blockquote>\n<p>Did you try transferring it to <code>leanprover-community</code>?</p>\n</blockquote>\n<p>I don't have right creating public repository in leanprover-community...</p>",
        "id": 507214329,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544619
    },
    {
        "content": "<p>But does it actually error? I know it says that in the text, but I remember the past that there was a mechanism where the owner initiates the transfer, then we have to accept.</p>",
        "id": 507214401,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544653
    },
    {
        "content": "<p>But I may be misremembering!</p>",
        "id": 507214412,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544657
    },
    {
        "content": "<p>Have to go!</p>",
        "id": 507214425,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742544663
    },
    {
        "content": "<p>I can't :(</p>\n<p><a href=\"/user_uploads/3121/eopAE3y21CoIjrvG9L9pvofZ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/eopAE3y21CoIjrvG9L9pvofZ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"855x674\" src=\"/user_uploads/thumbnail/3121/eopAE3y21CoIjrvG9L9pvofZ/image.png/840x560.webp\"></a></div>",
        "id": 507214653,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742544739
    },
    {
        "content": "<p>I think you can transfer it to Kim first, and they can transfer to the org</p>",
        "id": 507217251,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742545580
    },
    {
        "content": "<blockquote>\n<p>I think you can transfer it to Kim first, and they can transfer to the org</p>\n</blockquote>\n<p>nice idea! I've tried and succeed!</p>",
        "id": 507217438,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742545642
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> please accept transfer request</p>",
        "id": 507371701,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742592922
    },
    {
        "content": "<p>I think Kim might be out for the weekend, but I expect they'll see it when they get back</p>",
        "id": 507371852,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742593000
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"626349\">@Asei Inoue</span>, I'm sorry, I was too slow and the transfer has expired. If you'd like to try again I should be able to respond quickly this week.</p>",
        "id": 507626024,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742778984
    },
    {
        "content": "<p>I’ve sent invitation again!</p>",
        "id": 507633421,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1742783309
    },
    {
        "content": "<p>Thanks. I've transferred it on to leanprover-community. I then re-added you with maintenance access, you'll need to check you email inbox to accept that.</p>",
        "id": 507641415,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1742788123
    },
    {
        "content": "<p>With the release of v4.19.0-rc2, a number of bugs were found in the lean-update, all of which have been fixed! I think the development is going well.</p>",
        "id": 510199814,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1743772516
    },
    {
        "content": "<p>This topic might be of interest <a href=\"#narrow/stream/479953-PhysLean/topic/Bumps.20of.20PhysLean.2E\">https://leanprover.zulipchat.com/#narrow/stream/479953-PhysLean/topic/Bumps.20of.20PhysLean.2E</a></p>",
        "id": 511010431,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1744140418
    }
]