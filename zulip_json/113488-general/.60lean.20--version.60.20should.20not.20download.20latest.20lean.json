[
    {
        "content": "<p>running <code>lean --version</code> command invoke start downloading latest stable Lean.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>‚ùØ<span class=\"w\"> </span>lean<span class=\"w\"> </span>--version\ninfo:<span class=\"w\"> </span>downloading<span class=\"w\"> </span>https://releases.lean-lang.org/lean4/v4.24.0/lean-4.24.0-windows.tar.zst\n<span class=\"m\">274</span>.5<span class=\"w\"> </span>MiB<span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"m\">436</span>.6<span class=\"w\"> </span>MiB<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"m\">63</span><span class=\"w\"> </span>%<span class=\"o\">)</span><span class=\"w\">   </span><span class=\"m\">8</span>.5<span class=\"w\"> </span>MiB/s<span class=\"w\"> </span>ETA:<span class=\"w\">  </span><span class=\"m\">19</span><span class=\"w\"> </span>s\n</code></pre></div>\n<p>but this is unexpected behavior to user.</p>",
        "id": 546128211,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1761009928
    },
    {
        "content": "<p>Users (including me) expect <code>lean --version</code> should simply return the current lean version.</p>",
        "id": 546128258,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1761009984
    },
    {
        "content": "<p>Is it inside a package?</p>",
        "id": 546132167,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761013041
    },
    {
        "content": "<p>If not, then <code>lean</code> downloads the default version and runs it.</p>",
        "id": 546132205,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761013076
    },
    {
        "content": "<p>outside of package</p>",
        "id": 546132346,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1761013143
    },
    {
        "content": "<p>As Yury said, if you're not inside a directory with a <code>lean-toolchain</code> file, then the \"current\" Lean version is the default toolchain as set via <code>elan default</code>. The default toolchain is usually going to be something like <code>stable</code> or <code>nightly</code> which will resolve to a toolchain like <code>leanprover/lean4:v4.24.0</code> at a certain point in time.</p>\n<p>So if you run <code>lean --version</code> with the default toolchain set to <code>stable</code>, then you are explicitly asking <code>elan</code> to run the <code>lean</code> binary of the toolchain <code>leanprover/lean4:v4.24.0</code>. If do not have this toolchain, then downloading the toolchain is the only thing that <code>elan</code> can do.</p>\n<p>What you can do instead is run <code>elan show</code>, which will show you which toolchain <code>elan</code> will want to use when you invoke <code>lean</code>. Look for the <code>active toolchain</code> at the bottom of the output. On my machine, with the <code>stable</code> toolchain configured as the default toolchain, it shows</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">active</span><span class=\"w\"> </span><span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">24</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">resolved</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">stable'</span><span class=\"o\">)</span>\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.24</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"bp\">-</span><span class=\"n\">unknown</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">-</span><span class=\"n\">gnu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"mi\">797</span><span class=\"n\">c613eb9b6d4ec95db23e3e00af9ac6657f24b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>If I change the default toolchain to <code>nightly</code> using <code>elan default nightly</code>, it shows</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">active</span><span class=\"w\"> </span><span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"o\">:</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">10</span><span class=\"bp\">-</span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">resolved</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">nightly'</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">installed</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This works without having to download the latest nightly (but of course it does need to make a network request to figure out what the latest nightly is).</p>",
        "id": 546147620,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761025758
    },
    {
        "content": "<p>Since the most common reason for calling <code>lean</code> (or really, <code>lake</code>) outside a project is to create a new project, I think this \"use the latest stable version\" behavior is the right default</p>",
        "id": 546176644,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761036650
    },
    {
        "content": "<p>Thank you all!</p>",
        "id": 546178132,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1761037066
    }
]