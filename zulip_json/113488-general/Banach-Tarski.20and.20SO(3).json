[
    {
        "content": "<p>Hi folks,</p>\n<p>I’m nearing the end of a formalization of the Banach-Tarski theorem.</p>\n<p>Some project-level definitions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">R3_raw</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\">  </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">sphere</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">MAT</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n\n<span class=\"c1\">-- The standard action given by matrix multiplication.</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">SO3_action_on_R3_raw</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"n\">R3_raw</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mulVec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">one_smul</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">one_mulVec</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"w\">  </span><span class=\"n\">mul_smul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mulVec_mulVec</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">SO3_action_on_R3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n</code></pre></div>\n<p>I have completed what I think should be most of the hard parts, and all that remains is to represent members of SO(3).  </p>\n<p>Strictly speaking, I need <code>def rot (ax: S2) (θ:ℝ) : SO3 :=...</code> allowing me to prove some fairly basic geometric lemmas.</p>\n<p>My current approach is to use the standard Rodrigues rotation matrices as rotation matrices:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Rodrigues' formula for the rotation matrix :  I + (sin θ)K + (1-cosθ)K²</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">K_mat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">MAT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">;</span>\n<span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">rot_mat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ax</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">θ</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MAT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">MAT</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sin</span><span class=\"w\"> </span><span class=\"n\">θ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">K_mat</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">θ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">((</span><span class=\"n\">K_mat</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ax</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">θ</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rot_mat</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"w\"> </span><span class=\"n\">θ</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">M_is_special</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mem_specialOrthogonalGroup_iff</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mem_orthogonalGroup_iff</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"c1\">-- M * Mᵀ = 1</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- M.det = 1</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">M</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">M_is_special</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I honestly find these computations are pretty nasty for a generic matrix, but I am still relatively new to Lean.</p>\n<p>I need to be able to prove results like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rot_fixed_back_gen_z_single</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"o\">):</span>\n<span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"n\">z_axis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z_ang_diff</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>where</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">z_ang_diff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Angle</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- NOTE! Projects down to the  z = 0 plane</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!₂</span><span class=\"o\">[(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!₂</span><span class=\"o\">[(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"n\">oangle</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"n\">t2</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rot_comp_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ax</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"w\"> </span><span class=\"n\">t1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"n\">ax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rot_fixed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">axis</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R3</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"n\">k</span><span class=\"o\">:</span><span class=\"n\">ℤ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>And to talk about changes of basis</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">COB_to_Z</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">axis</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"n\">dite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">≠</span><span class=\"n\">z_axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">≠</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">z_axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s2_cross</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"w\"> </span><span class=\"n\">z_axis</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">unsigned_ang</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"w\"> </span><span class=\"n\">z_axis</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">dite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">=</span><span class=\"n\">z_axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SO3</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">rot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x_axis</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">pi</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>allowing results like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">ctza_def</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">axis</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S2</span><span class=\"o\">):</span><span class=\"w\">   </span><span class=\"o\">(</span><span class=\"n\">COB_to_Z</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">z_axis</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I have dug into Mathlib quite a bit, but most of the rotation-focused results seem to be for two-dimensional vector spaces.</p>\n<p>I’m sure it’s possible to grind through each of these remaining sorrys,  but I want to make sure first that I’m not missing anything, or whether anyone knows of any other libraries that handle allow manipulating members of SO(3) as rotations.</p>\n<p>The repo is here: </p>\n<p><a href=\"https://github.com/aetilley/banach-tarski\">https://github.com/aetilley/banach-tarski</a></p>\n<p>Thanks,<br>\nArthur</p>",
        "id": 562833413,
        "sender_full_name": "Arthur Tilley",
        "timestamp": 1765327941
    },
    {
        "content": "<p>I haven't looked at your repo, and it's a little tricky to give feedback on your message contents without seeing your definition of <code>S2</code> etc, but one small bit of feedback; <code>dite P (fun p ↦ x) (fun p ↦ y)</code> is much more idiomatic as <code>if p : P then x else y</code> or even just <code>if P then x else y</code>.</p>",
        "id": 562837547,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1765330199
    },
    {
        "content": "<p>Hi, congratulations on almost finishing this. Myself, I wouldn't know some parts of how to do Banach-Tarski (why the rotations form a free group).</p>\n<p>I understand you have all in your repo but it would be helpful if you paste here all the auxiliary definitions (<code>MAT</code>, <code>S2</code>, ...), so people can play with it immediatelly.</p>\n<p>I am rather surprised if you need some calculations manually multiplying 3 x 3 matrices. My approach would be to try to have</p>\n<ul>\n<li>Some conversion matrix in SO3 that aligns a variable axis with a specific axis such as z = (0,0,1), a composition of two rotations around z, and around x.</li>\n<li>Rotation around that z,  so essentially a 2d-rotation -- there I could compose angles, as well as argue that it doesn't matter which way I moved my arbitrary axis to z, because rotations in 2d commute.</li>\n<li>If I need to obtain an axis of an arbitrary element of SO3, I would hope to get it as the eigen-vector.</li>\n</ul>\n<p>On the other hand, I am not an expert in matrices in Lean, so I might be wrong...</p>",
        "id": 562837685,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765330281
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> <br>\nI have added some auxilliary definitiions to hopefully make it more understandable.<br>\nI'm walking a fine line here by both 1) not wanting people to <em>have</em> to look at my code and 2) not wanting my first post on general to be a book.</p>\n<p><span class=\"user-mention\" data-user-id=\"133339\">@Mirek Olšák</span> Don't worry about the free group stuff.  That's done.  Really all that is remaining is to prove some basic geometry concerning about rotations in SO3.  What you mention at the end is part of it.   It's just that but proving theorems that involve an arbitrary rotation matrix (for a given axis and angle) turns into a mess.  I'm crossing my fingers that there may be a library somewhere.  Or maybe some matlib theorems that I'm missing.</p>",
        "id": 562841027,
        "sender_full_name": "Arthur Tilley",
        "timestamp": 1765332041
    },
    {
        "content": "<p>I wanted to translate any rotation to a 2d rotation. (or composition of them)</p>",
        "id": 562842172,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765332557
    },
    {
        "content": "<p>Actually, I realized, it probably doesn't have to be a composition of rotation along <code>x</code> &amp; <code>z</code>. It should be possible to take a subspace generated with <code>axis</code> and <code>z</code>, rotate <code>axis</code> to <code>z</code> there, and then extend it with <code>LinearIsometry.extend</code></p>",
        "id": 562842612,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765332799
    },
    {
        "content": "<p>But I would try to stay abstract, ideally without explicitly writing <code>3x3</code> matrices.</p>",
        "id": 562842740,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765332882
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> wrote some code for this for the sphere eversion project: it's in <a href=\"https://github.com/leanprover-community/sphere-eversion/blob/master/SphereEversion/ToMathlib/Analysis/InnerProductSpace/Rotation.lean\">https://github.com/leanprover-community/sphere-eversion/blob/master/SphereEversion/ToMathlib/Analysis/InnerProductSpace/Rotation.lean</a></p>",
        "id": 562920087,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765362295
    },
    {
        "content": "<p>If that code is useful, a PR adding it to mathlib would be welcome.</p>",
        "id": 562920122,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765362310
    },
    {
        "content": "<p>(Perhaps it should be generalised to n dimensions first. I'm unsure about that part.)</p>",
        "id": 562920179,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1765362327
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> This looks like it could be very helpful.  Thanks so much.</p>",
        "id": 563005661,
        "sender_full_name": "Arthur Tilley",
        "timestamp": 1765386017
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 563087467,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765414879
    },
    {
        "content": "<p>For me the natural abstract approach for rotations in arbitrary dimensions starts with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Orientation.rotation#doc\">docs#Orientation.rotation</a> (2d rotation) which we already have (plus the identity <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearIsometryEquiv.refl#doc\">docs#LinearIsometryEquiv.refl</a> on subspaces where you're not rotating) and then combines the isometries on orthogonal subspaces into an isometry of the whole space.</p>\n<p>Combining isometries on subspaces (which in general applies to both isometries and isometric equivalences, and with domain and codomain that need not be the same) also decomposes into smaller operations. One operation takes a pair or indexed family of isometries or isometric equivalences and produces an isometry or isometric equivalent of the pairwise or indexed product spaces (the <code>WithLp 2</code> / <code>PiLp 2</code> versions thereof, that is). The other operation is an isometric equivalence between an inner product space and the pairwise or indexed product of subspaces that are orthogonal and span the whole space.</p>\n<p>(Then if you wish you could show that all orientation-preserving linear isometric equivalences of a finite-dimensional real inner product space can be constructed this way from 2d rotations on orthogonal subspaces, though you probably don't need that for this application.)</p>",
        "id": 563092894,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1765418713
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> It sounds like you and <span class=\"user-mention\" data-user-id=\"133339\">@Mirek Olšák</span> might be talking about roughly the same approach?  That is to define a rotation in the (2d) space orthogonal to the axis then extend that iso <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/PiL2.html#LinearIsometry.extend\">LinearIsometry.extend</a></p>\n<p>I might give this a go.  </p>\n<p>While the code that <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> links is in the same direction, it's a bit hard for my small brain to be able to generalize what is being done there to other results that I need talking about exactly which isometries take some vector v to some vector w.</p>\n<p>Also in places I think I need to talk about oriented angle between two vectors, and I think that a definition for that is currently only defined for two dimensional spaces.</p>",
        "id": 563247579,
        "sender_full_name": "Arthur Tilley",
        "timestamp": 1765474464
    },
    {
        "content": "<p>The documentation for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearIsometry.extend#doc\">docs#LinearIsometry.extend</a> suggests it's an <em>arbitrary</em> extension of an isometry from a subspace to the whole space. In the case of an isometry mapping the subspace to itself I think it <em>will</em> end up extending by the identity on the orthogonal subspace, but you'd be relying on the choice of junk values that isn't currently documented and doesn't currently have any API lemmas to say what that choice is.</p>",
        "id": 563285027,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1765488237
    },
    {
        "content": "<p>Oriented angles are only meaningful in two dimensions. You can of course put an orientation on a two-dimensional subspace and then take angles between vectors in that subspace.</p>",
        "id": 563285253,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1765488319
    },
    {
        "content": "<p>Oriented angles are also meaningful if you have an orientation on the fixed subspace (which you do in 3d, if the axis is represented with an element of the unit sphere).</p>",
        "id": 563301705,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1765497247
    },
    {
        "content": "<p>I think of that as a matter of API for combining orientations on subspaces. Given orientations of two spaces, you can map them to an orientation of the product space (indexed by the sum of the index types of the two subspace orientations) in the obvious way, and there is also a reverse operation that you can use to map from an orientation of the product space and an orientation of one of the two spaces to an orientation of the other one of the two spaces. In particular, an orientation of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n+2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>-space and one of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>-space yield an orientation of the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>-space in which the rotation takes place. (If those orientations are indexed by <code>Fin (n + 2)</code>, <code>Fin n</code> and <code>Fin 2</code>, this also involves a choice of equivalence <code>Fin (n + 2) ≃ (Fin n ⊕ Fin 2)</code>.)</p>",
        "id": 563313996,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1765505651
    }
]