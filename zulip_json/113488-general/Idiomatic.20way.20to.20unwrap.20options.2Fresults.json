[
    {
        "content": "<p>Is there a general idiomatic way to take an Option or Result value, and extract the inner value or crash? Something like the rust <code>unwrap</code> function?</p>",
        "id": 486940565,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733735139
    },
    {
        "content": "<p>I guess you could do </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">optionalValue</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">panic</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span>\n</code></pre></div>\n<p>But this only works with <code>do</code> notation. So you would need a <code>Id.run</code> or similar.</p>\n<p>If the monad you're working under impements <code>Alternative</code> though, you could do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">optionalValue</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">failure</span>\n</code></pre></div>\n<p>I learned of this syntax not too long ago, doing Advent of Code, and I'm not yet sure if it's idiomatic. But it's definitely concise</p>",
        "id": 486941175,
        "sender_full_name": "Ayhon",
        "timestamp": 1733735320
    },
    {
        "content": "<p>You can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Option.get%21#doc\">docs#Option.get!</a>.</p>",
        "id": 486941705,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1733735473
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/113488-general/topic/Idiomatic.20way.20to.20unwrap.20options.2Fresults/near/486941705\">said</a>:</p>\n<blockquote>\n<p>You can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Option.get%21#doc\">docs#Option.get!</a>.</p>\n</blockquote>\n<p>looks like this only works if the type is <code>Inhabited</code>, and it just returns a default if the option is none.</p>",
        "id": 486942190,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733735621
    },
    {
        "content": "<p>Indeed it looks like <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/Option/BasicAux.html#Option.get\">https://leanprover-community.github.io/mathlib4_docs/Init/Data/Option/BasicAux.html#Option.get</a>! has different semantics than other <code>get!</code> functions defined on other types</p>",
        "id": 486942409,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733735676
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"785542\">Greg Shuflin</span> <a href=\"#narrow/channel/113488-general/topic/Idiomatic.20way.20to.20unwrap.20options.2Fresults/near/486942190\">said</a>:</p>\n<blockquote>\n<p>looks like this only works if the type is <code>Inhabited</code>, and it just returns a default if the option is none.</p>\n</blockquote>\n<p>It think this restriction comes from the fact that <code>panic</code> requires <code>Inhabitted</code>, not that it returns a default value. That would be more <code>getD</code></p>",
        "id": 486943236,
        "sender_full_name": "Ayhon",
        "timestamp": 1733735924
    },
    {
        "content": "<p>I don't think it's different from the <code>get!</code> functions on other types. In Lean, a panic does not actually terminate the program unless a specific command line argument is given, see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=panic#doc\">docs#panic</a>. Since Lean is a total language, even a panic has to produce a value of the expected type (even if it is never executed), otherwise Lean's type system would be unsound. For this reason, <code>panic</code> requires the type to be inhabited and returns the default value of the type.</p>",
        "id": 486943546,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1733736026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/113488-general/topic/Idiomatic.20way.20to.20unwrap.20options.2Fresults/near/486943546\">said</a>:</p>\n<blockquote>\n<p>I don't think it's different from the <code>get!</code> functions on other types. In Lean, a panic does not actually terminate the program unless a specific command line argument is given, see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=panic#doc\">docs#panic</a>. Since Lean is a total language, even a panic has to produce a value of the expected type (even if it is never executed), otherwise Lean's type system would be unsound. For this reason, <code>panic</code> requires the type to be inhabited and returns the default value of the type.</p>\n</blockquote>\n<p>So, is there a reasonable way to create an <code>Inhabited</code> variant of random custom types, purely for the purpose of making panic-causing unwraps work?</p>",
        "id": 487148990,
        "sender_full_name": "Greg Shuflin",
        "timestamp": 1733800300
    },
    {
        "content": "<p>You can try <code>deriving Inhabited</code>, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span>\n</code></pre></div>",
        "id": 487164961,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1733808689
    }
]