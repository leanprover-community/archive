[
    {
        "content": "<p>If <code>let s : someStructure := &lt;2, fun x =&gt; Fin x&gt;</code>, we have that <code>#reduce (types := true) s.2 7</code> will produce <code>Fin 7</code>. Is there a rewrite rule that I could use to reduce <code>x : s.2 7</code> in my proof state to <code>x : Fin 7</code>? I would be looking for a lemma like <code>s.2 7 = (fun x =&gt; Fin x) 7 = Fin 7</code>, but is there one similar to this that is either automatically generated (similarly to <code>.eq_def</code>) or that can be inferred somehow?</p>",
        "id": 485665261,
        "sender_full_name": "nrs",
        "timestamp": 1733157469
    },
    {
        "content": "<p>If you wrote the structure then why don't you just write the lemma yourself and prove it with <code>rfl</code>?</p>",
        "id": 485667031,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733158031
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Rewrite.20rule.20corresponding.20to.20.60.23reduce.20.28types.20.3A.3D.20true.29.60.3F/near/485667031\">said</a>:</p>\n<blockquote>\n<p>If you wrote the structure then why don't you just write the lemma yourself and prove it with <code>rfl</code>?</p>\n</blockquote>\n<p>Yeah I've been doing this but I thought, any such reduction rule is probably generated by Lean itself when it evaluates <code>#reduce</code> right?</p>",
        "id": 485667341,
        "sender_full_name": "nrs",
        "timestamp": 1733158123
    },
    {
        "content": "<p>In case anyone has a similar issue: the <code>reduce</code> tactic can be used for this purpose. If you're in term mode and don't want to enter tactics mode, and if <code>x : s.2 7</code> is in your context, you can use <code>let x := beta% clear% by reduce at x; exact x</code>, which will give you a term <code>x : Fin 7</code> which is defeq to the previous one</p>",
        "id": 485737999,
        "sender_full_name": "nrs",
        "timestamp": 1733190466
    },
    {
        "content": "<p>You say \"if you don't want enter tactic mode\" but that <code>by</code> puts you into tactic mode.</p>",
        "id": 485784509,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733214407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Rewrite.20rule.20corresponding.20to.20.60.23reduce.20.28types.20.3A.3D.20true.29.60.3F/near/485784509\">said</a>:</p>\n<blockquote>\n<p>You say \"if you don't want enter tactic mode\" but that <code>by</code> puts you into tactic mode.</p>\n</blockquote>\n<p>Yeah I meant for the rest of the proof (in general, once you enter tactic mode with a <code>by</code> at top of your declaration, you can't leave it, right?). I'm working on an elaborator to avoid it entirely, just for metaprogramming practice, but here's how you can keep in term mode after using it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">beta</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">clear</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 485859559,
        "sender_full_name": "nrs",
        "timestamp": 1733234372
    },
    {
        "content": "<p><code>exact</code> takes you back into term mode. In Lean 3 it was pretty common to see things like <code>by classical; exact...</code> to switch classical mode on.</p>",
        "id": 485882463,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733239755
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Rewrite.20rule.20corresponding.20to.20.60.23reduce.20.28types.20.3A.3D.20true.29.60.3F/near/485882463\">said</a>:</p>\n<blockquote>\n<p><code>exact</code> takes you back into term mode. In Lean 3 it was pretty common to see things like <code>by classical; exact...</code> to switch classical mode on.</p>\n</blockquote>\n<p>woah! I've never encountered using <code>exact</code> like this before, only <code>exact t</code> with a term ending the proof, thanks a lot for that tip!</p>",
        "id": 485883338,
        "sender_full_name": "nrs",
        "timestamp": 1733239952
    },
    {
        "content": "<p>FYI it's <code>by classical exact</code> in lean 4</p>",
        "id": 485883422,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733239980
    },
    {
        "content": "<p>because <code>classical</code> is a tactic combinator, not a tactic (anymore)</p>",
        "id": 485883487,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733239996
    },
    {
        "content": "<p>I see ty!!</p>",
        "id": 485883570,
        "sender_full_name": "nrs",
        "timestamp": 1733240020
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749978\">nrs</span> <a href=\"#narrow/channel/113488-general/topic/Rewrite.20rule.20corresponding.20to.20.60.23reduce.20.28types.20.3A.3D.20true.29.60.3F/near/485883338\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Rewrite.20rule.20corresponding.20to.20.60.23reduce.20.28types.20.3A.3D.20true.29.60.3F/near/485882463\">said</a>:</p>\n<blockquote>\n<p><code>exact</code> takes you back into term mode. In Lean 3 it was pretty common to see things like <code>by classical; exact...</code> to switch classical mode on.</p>\n</blockquote>\n<p>woah! I've never encountered using <code>exact</code> like this before, only <code>exact t</code> with a term ending the proof, thanks a lot for that tip!</p>\n</blockquote>\n<p>I remember Mario telling me this in 2017 and it blowing my mind too :-)</p>",
        "id": 485902014,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733244536
    }
]