[
    {
        "content": "<p>I asked this over in #mathlib4 the other day, but maybe this is a better place to ask.</p>\n<p>I'm trying to prove this theorem about the way Traversables interact with Options, and I'm stuck on both directions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">sequence_some</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Traversable</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">LawfulTraversable</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"c\">/-</span>\n<span class=\"cm\">    case mp</span>\n<span class=\"cm\">    ...</span>\n<span class=\"cm\">    h : sequence t = some t'</span>\n<span class=\"cm\">    ⊢ t = some &lt;$&gt; t'</span>\n<span class=\"cm\">    NOTE: Might not be true?</span>\n<span class=\"cm\">    -/</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">comm</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c\">/-</span>\n<span class=\"cm\">    case mpr</span>\n<span class=\"cm\">    ...</span>\n<span class=\"cm\">    ⊢ some t' = sequence (some &lt;$&gt; t')</span>\n<span class=\"cm\">    NOTE: Should follow by naturality?</span>\n<span class=\"cm\">    -/</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>The right to left direction is really the one I'm asking for help with: I know it should follow from naturality, but I can't seem to get the types to line up. Does someone have a minute to help me wrangle the implicits?</p>\n<p>The left to right direction I'm actually not sure is true, but if anyone has an idea for how to prove that I'd also really appreciate it.</p>",
        "id": 489593580,
        "sender_full_name": "Harry Goldstein",
        "timestamp": 1734480265
    },
    {
        "content": "<p>Please don't double post; I think the <a href=\"#narrow/channel/287929-mathlib4/topic/.E2.9C.94.20Traversable.20and.20Option/near/489283844\">original thread's location in mathlib4</a> was best, since <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Traversible#doc\">docs#Traversible</a> is part of mathlib</p>",
        "id": 489594731,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734480885
    },
    {
        "content": "<p>Sorry about that! I figured it might be the wrong place since my posts here usually get responses in minutes and that one had been untouched for over a day. But OK, I'll delete this.</p>",
        "id": 489594892,
        "sender_full_name": "Harry Goldstein",
        "timestamp": 1734480968
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"686704\">Harry Goldstein</span> has marked this topic as resolved.</p>",
        "id": 489595102,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734481090
    }
]