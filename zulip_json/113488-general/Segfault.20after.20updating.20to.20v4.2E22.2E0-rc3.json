[
    {
        "content": "<p>After updating Lean from v4.21.0-rc3 to v4.22.0-rc3, our project's executable immediately segfaults when run. We reduced the issue to a minimal example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Disjoint</span>\n\n<span class=\"c1\">-- Copied from Mathlib.Order.PropInstances</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"bp\">.</span><span class=\"n\">instBoundedOrder</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BoundedOrder</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"w\">  </span><span class=\"n\">le_top</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"n\">bot</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"w\">  </span><span class=\"n\">bot_le</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">False</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"ok\"</span>\n</code></pre></div>\n<p>This example works in v4.21.0-rc3 but segfaults in v4.22.0-rc3 without output. However, commenting out the <code>Prop.instBoundedOrder</code> instance prevents the crash.</p>\n<p>We are actively investigating this and would welcome suggestions on where to look. Could this be related to our configuration, or might it indicate a regression in v4.22?</p>\n<p>OS: Windows 10<br>\nLake: 5.0.0-src+7c3ca70<br>\nMathlib: ab35957594546b036883f7a882015d6fa2d650bf</p>",
        "id": 528449350,
        "sender_full_name": "Vlad",
        "timestamp": 1752317155
    },
    {
        "content": "<p>See <a href=\"#narrow/channel/287929-mathlib4/topic/.60import.20Mathlib.2EOrder.2EPropInstances.60.20causing.20segment.20fault\">#mathlib4 &gt; &#96;import Mathlib.Order.PropInstances&#96; causing segment fault</a></p>",
        "id": 528449631,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1752317505
    },
    {
        "content": "<p>There are other threads about it, but the summary is that this is fixed by <a href=\"https://github.com/leanprover/lean4/pull/9310\">lean4#9310</a>, which will be backported to the 4.22 branch</p>",
        "id": 528449653,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1752317533
    },
    {
        "content": "<p>This is fixed on <code>v4.22.0-rc4</code> now.</p>",
        "id": 530684767,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1753414123
    }
]