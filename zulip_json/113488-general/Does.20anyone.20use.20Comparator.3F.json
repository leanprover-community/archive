[
    {
        "content": "<p>The Lean FRO, specifically <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>, made a tool called Comparator (<a href=\"https://github.com/leanprover/comparator\">https://github.com/leanprover/comparator</a>, <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/FRO.27s.20new.20verifier/with/546672858\">#lean4 &gt; FRO's new verifier</a>) which is for checking the correctness of “challenge” problems.  These are exactly the sort of problems we see now in AI applications and vibe coding, where one has a target theorem they want to prove and a human or AI supplies the proof.  I think we absolutely need tools like this, and I want to encourage people to use them (if they are ready).  I know the current version is, at best, a beta version, but I assume stress testing it will make it better.  So does anyone actually use it?</p>\n<ul>\n<li><span class=\"user-mention\" data-user-id=\"644040\">@George Tsoukalas</span> Do you use Comparator to check PutnamBench submissions?</li>\n<li><span class=\"user-mention\" data-user-id=\"1004587\">@Koishi Chan</span>  and <span class=\"user-mention\" data-user-id=\"607118\">@Lawrence Wu (llllvvuu)</span>, I’ve noticed you two have been using AI to solve Erdos problems. Do you use Comparator to check the results?</li>\n<li><span class=\"user-mention\" data-user-id=\"890706\">@Zeyu Zheng</span>, for Seed Prover 1.5, did you use Comparitor to check your benchmark results?</li>\n<li><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> Have you been using Comparator to check any of the above results?</li>\n</ul>",
        "id": 565536487,
        "sender_full_name": "Jason Rute",
        "timestamp": 1766879029
    },
    {
        "content": "<p>Sorry for the annoying post.  I assume the answer is no, that no one uses it.  If the answer is yes,</p>\n<ul>\n<li>Is it user-friendly?</li>\n<li>Does it have problems with false negatives as mentioned by <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> in <a class=\"stream-topic\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Tool.20to.20verify.20a.20solution.20solves.20the.20actual.20problem.3F/with/562625113\">#Machine Learning for Theorem Proving &gt; Tool to verify a solution solves the actual problem?</a>?</li>\n<li>Does it fit common use cases, or does it have too many restrictions?</li>\n<li>Is it usable for benchmark problems?  For problems in the formal conjectures project?  For blueprint projects?</li>\n</ul>",
        "id": 565536493,
        "sender_full_name": "Jason Rute",
        "timestamp": 1766879043
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 565692029,
        "sender_full_name": "Jason Rute",
        "timestamp": 1767023879
    },
    {
        "content": "<p>I have done a bunch of Erdős problem+AI stuff, and I would generally like to use a tool like this.  However, to answer the question: I have not used Comparator.</p>",
        "id": 565712030,
        "sender_full_name": "Boris Alexeev",
        "timestamp": 1767035476
    },
    {
        "content": "<p>I do verify all of the proofs I upload, but I either do it manually or with my own script (which is definitely easily exploitable).</p>",
        "id": 565712100,
        "sender_full_name": "Boris Alexeev",
        "timestamp": 1767035527
    },
    {
        "content": "<p>I think I could try using Comparator, and it might even be productive for my use case, but there is one thing that catches my attention:</p>\n<p>The site lists this as an assumption:</p>\n<blockquote>\n<p>You have not previously tried to compile the <code>Solution</code> file (as that might compromise your <code>Challenge</code> file to make it seem like you are looking for a different proof than you actually are)</p>\n</blockquote>\n<p>But that doesn't match my use case at all.  I'm often working with parts of the solution file for a long time before it's done, so I've probably previously tried compiling it.</p>\n<p>I assume that for my non-adversarial use case, it would still be okay to use Comparator?  But still, it gives me pause.</p>",
        "id": 565712540,
        "sender_full_name": "Boris Alexeev",
        "timestamp": 1767035847
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"419930\">@Boris Alexeev</span> I personally think that Comparator is making a bunch of assumptions that are probably not realistic in practice.  I think they assume you have a Challenge and Solution file, where some independent entity came up with the Challenge file (say that Erdos problem was formalized as part of the formal conjecture project).  Then you make a matching solution file (which you can compile locally all you want, as long as the challenge file lives somewhere safe like in a github repo).   Then ideally if someone wants the purest check possible, they would combine the challenge and solution file together on a fresh machine, never running the solution file in that machine  (except in a sandboxed environment) which is what Comparator does) to make sure the Solution files don't do anything crazy (like hack into the Challenge file and change it.</p>\n<p>But I think we shouldn't let absolute perfect security be the enemy of reasonable security.   For modern concerns, I think there is still a lot of value to you taking your solution, abstracting out a challenge file after the fact, and running Comparator to check the results.  That way, you have a Challenge file which contains an easy-to-inspect version of your theorem statement, and a tripled checked Solution proof.  Comparator, even if you violate the compiling requirements, will still be the best possible checker out their for Lean.  It will check for axioms, for full correctness, and that your challenge and solution match at the term level.  The do-not-compile requirements are to prevent very sophisticated hacking that I think is beyond current AI and beyond almost all current Lean users.  (To be clear, this is my opinion, and I suspect <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>  may disagree with me on this.)</p>",
        "id": 565727098,
        "sender_full_name": "Jason Rute",
        "timestamp": 1767048020
    },
    {
        "content": "<p>So I decided I should actually try to use Comparator myself.  I'll report back what I find.  (The <code>landrun</code> requirement is quite onerous, because nothing else in the Lean ecosystem requires golang, or requires pure Linux, but I think I have figured that out.)</p>",
        "id": 565727297,
        "sender_full_name": "Jason Rute",
        "timestamp": 1767048250
    },
    {
        "content": "<p>I don't understand the hesitancy around having not previously compiled. To comply with this, it seems you can just delete <code>.lake</code> or in a CI setting have this running in a fresh clone, right?</p>",
        "id": 565728083,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767049161
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> is worried about the most sophisticated level of attack where a tactic or IO code modifies files on the file system including the challenge file.  But I see no reason the person writing the code can’t compile it and also run Comparator.</p>",
        "id": 565729481,
        "sender_full_name": "Jason Rute",
        "timestamp": 1767050689
    },
    {
        "content": "<p>I wouldn't say that's the most sophisticated level of attack I can think of but that is what this advice is guarding against yes.</p>",
        "id": 565729519,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767050748
    },
    {
        "content": "<p>Is there an example of the setup you need to use Comparator? The readme on the Github repo mentions modules. Are these the kind of modules you need to set <code>experimental.module</code> to <code>true</code> in order to use?</p>",
        "id": 566037076,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767345930
    },
    {
        "content": "<p>No, module is just the name for a singular Lean file and has always been. The module system naming confusion is a bit unfortunate here.</p>",
        "id": 566044125,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767350750
    },
    {
        "content": "<p>Thank you, but how are the files supposed to be arranged? I've tried putting the challenge and solution files both in a separate Lean project and in the Comparator folder itself and <code>lake env .lake/build/bin/comparator comparator.json</code> keeps failing with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Challenge</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"ss\">`Challenge</span><span class=\"bp\">`</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Child</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 566088041,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767378338
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">ls</span>\n<span class=\"n\">Challenge</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">  </span><span class=\"n\">config</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">toml</span><span class=\"w\">  </span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">manifest</span><span class=\"bp\">.</span><span class=\"n\">json</span><span class=\"w\">  </span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span><span class=\"w\">  </span><span class=\"n\">Notacheater</span><span class=\"w\">  </span><span class=\"n\">Notacheater</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\">  </span><span class=\"n\">README</span><span class=\"bp\">.</span><span class=\"n\">md</span><span class=\"w\">  </span><span class=\"n\">Solution</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">toml</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"notacheater\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"Notacheater\"</span><span class=\"o\">]</span>\n\n<span class=\"o\">[[</span><span class=\"n\">lean_lib</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Solution\"</span>\n\n<span class=\"o\">[[</span><span class=\"n\">lean_lib</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Challenge\"</span>\n<span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">Challenge</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">Solution</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hpq</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n\n<span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"bp\">.</span><span class=\"n\">json</span>\n<span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"s2\">\"challenge_module\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Challenge\"</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"s2\">\"solution_module\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Solution\"</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"s2\">\"theorem_names\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"mp\"</span><span class=\"o\">],</span>\n<span class=\"w\">    </span><span class=\"s2\">\"permitted_axioms\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"propext\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Quot.sound\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Classical.choice\"</span><span class=\"o\">]</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 566097635,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767385148
    },
    {
        "content": "<p>Thank you but it's now complaining that <code>Challenge.olean</code> has an 'incompatible header'</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Challenge</span>\n<span class=\"bp\">⚠</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Replayed</span><span class=\"w\"> </span><span class=\"n\">Challenge</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Challenge</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"n\">uses</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"gr\">sorry</span><span class=\"bp\">'</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"n\">jobs</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Exporting</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">mp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">propext</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choice</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Challenge</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">landrun'</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">james</span><span class=\"bp\">/</span><span class=\"n\">Notacheater</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">Challenge</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">incompatible</span><span class=\"w\"> </span><span class=\"n\">header</span>\n</code></pre></div>",
        "id": 566103464,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767390038
    },
    {
        "content": "<p>Could this be because I have Notacheater and Comparator on different versions of the Lean toolchain?</p>",
        "id": 566103560,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767390119
    },
    {
        "content": "<p>No, that doesn't seem to be the issue. I adjusted them to be the same and I'm getting the same error.</p>",
        "id": 566103786,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767390393
    },
    {
        "content": "<p>lean4export needs to be built with the same toolchain as well</p>",
        "id": 566104175,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1767390782
    },
    {
        "content": "<p>I think I have all three on <code>v4.27.0-rc1</code>, but I'm still getting the same error. Is it possible to make the errors more verbose?</p>",
        "id": 566104879,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767391378
    },
    {
        "content": "<p>Okay I was able to get it to work by going back to <code>v4.26.0-rc2</code>. Perhaps this was because lean4export is using something from Mathlib?</p>",
        "id": 566107233,
        "sender_full_name": "James E Hanson",
        "timestamp": 1767393552
    },
    {
        "content": "<p>We did not use Comparator or SafeVerify for Seed-Prover, but we may look into it in the future. I think one thing that would lower the barrier for people to use it (assuming it is already production ready) is to have tagged releases for every toolchain version.</p>\n<p>For our benchmark results, we use a crude check of \"no sorry warnings + no errors + only the 3 standard axioms\" first, and for the final submission result we also check that the type of the proved theorem is defeq to the original sorried theorem. The latter gave some false negatives in very limited cases (eg adding \"open Classical\" as a standard header before the theorem statement might change the statement in a non-definitionally-equal way) that we inspect manually are not hacks.</p>",
        "id": 566248734,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1767559092
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"631691\">Thomas Zhu</span> <a href=\"#narrow/channel/113488-general/topic/Does.20anyone.20use.20Comparator.3F/near/566248734\">said</a>:</p>\n<blockquote>\n<p>I think one thing that would lower the barrier for people to use it (assuming it is already production ready) is to have tagged releases for every toolchain version.</p>\n</blockquote>\n<p>I have created a <code>v4.27.0-rc1</code> tag for both <code>lean4export</code> and <code>comparator</code>, and <a href=\"https://github.com/leanprover/lean4/pull/11899\">lean#11899</a> will ensure that all future version releases also create tagged versions of these repositories with the latest toolchain.</p>",
        "id": 566261697,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1767574865
    }
]