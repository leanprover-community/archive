[
    {
        "content": "<p>I often have complex looking types that are actually really easy if you evaluate them. Is there a way for Lean to simplify types before printing them. </p>\n<p>A simple example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>I'd like the type of <code>x</code> to be shown as <code>Fin 6</code>, but it shows as <code>Fin (4 + 2)</code> instead. How can this be done? I tried <code>set_option pp.beta true</code>, but it doesn't work.</p>\n<p>(I previously asked this on stackoverflow but felt like I didn't get a good answer: <a href=\"https://stackoverflow.com/questions/79279223/simplify-types-in-lean\">https://stackoverflow.com/questions/79279223/simplify-types-in-lean</a>)</p>",
        "id": 528961544,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1752625090
    },
    {
        "content": "<p>why do you want this?</p>",
        "id": 528961652,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752625199
    },
    {
        "content": "<p>Can you give an example of some of the complex types you have and why you want to simplify them?</p>",
        "id": 528961775,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752625330
    },
    {
        "content": "<p><code>#check cast (by conv =&gt; norm_num) x</code> is one option here</p>",
        "id": 528961880,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752625441
    },
    {
        "content": "<p>I have a library like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ExecutionType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">recipe</span><span class=\"o\">:</span><span class=\"n\">Recipe</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">recipe</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">recipe</span><span class=\"o\">:</span><span class=\"n\">Recipe</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExecutionType</span><span class=\"w\"> </span><span class=\"n\">recipe</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n\n<span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"n\">Recipe</span><span class=\"bp\">.</span><span class=\"n\">concat</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n</code></pre></div>\n<p>Right now, users of my library get an error like:</p>\n<p><code>execute</code> is passed <code>String</code> and <code>Nat</code> but is expected <code>ExecutionType Recipe.concat</code>. This is really hard to understand what's going on. It would be much nicer if it said: <code>execute</code> has type <code>String -&gt; String -&gt; String</code> but you passed <code>String -&gt; Nat -&gt; X</code> or something like that.</p>",
        "id": 528962369,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1752625843
    },
    {
        "content": "<p>oh this is tricky</p>",
        "id": 528962611,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752625989
    },
    {
        "content": "<p>I'm aware of time formatting in Std which has something like this</p>",
        "id": 528962647,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752625999
    },
    {
        "content": "<p>I think in this case you should get a \"type mismatch\" error which tells you everything you need to know</p>",
        "id": 528962800,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752626087
    },
    {
        "content": "<p>or a \"cannot synthesize <code>OfNat String 5</code>\" maybe</p>",
        "id": 528962851,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752626126
    },
    {
        "content": "<p>Here I think you should just make <code>ExecutionType </code> an <code>abbrev</code></p>",
        "id": 528963334,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752626506
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  I just tried, but it doesn't seem to do anything. At least If you pass the wrong arguments, you still get a very hard to understand type error message. That said, my actual definition of <code>ExecutionType</code> is also recursive, so maybe that's why it doesn't work.</p>",
        "id": 528965477,
        "sender_full_name": "Konstantin Weitz",
        "timestamp": 1752628497
    },
    {
        "content": "<p>Can you share the actual definition?</p>",
        "id": 528965681,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752628703
    }
]