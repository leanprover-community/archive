[
    {
        "content": "<p>I just saw on <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a> that auto implicit variables are automatically shown in grey!  This is amazing.  I’ve been asking for something like this for years.  (IntelliJ has a feature like this for Scala implicits, which are more related to type classes, but I thought it would be good for Lean implicit variables too!)</p>",
        "id": 503254457,
        "sender_full_name": "Jason Rute",
        "timestamp": 1741091401
    },
    {
        "content": "<p>Yes, this is the inlay hint feature at work!</p>",
        "id": 503258035,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741092423
    },
    {
        "content": "<p>There's a small bug in this feature. When I click on the autoimplicit inlay to add the variable explicitly, I get a second copy of the inlay as in the screenshot below:</p>\n<p><a href=\"/user_uploads/3121/lEYRdl0ZaUvny2nRpvAOpWB1/Screenshot-from-2025-03-04-14-51-35.png\">Screenshot from 2025-03-04 14-51-35.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/lEYRdl0ZaUvny2nRpvAOpWB1/Screenshot-from-2025-03-04-14-51-35.png\" title=\"Screenshot from 2025-03-04 14-51-35.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"716x85\" src=\"/user_uploads/thumbnail/3121/lEYRdl0ZaUvny2nRpvAOpWB1/Screenshot-from-2025-03-04-14-51-35.png/840x560.webp\"></a></div>",
        "id": 503272918,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1741096360
    },
    {
        "content": "<p>CC : <span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span></p>",
        "id": 503272998,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1741096386
    },
    {
        "content": "<p>Is this in the web editor?</p>",
        "id": 503273938,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741096640
    },
    {
        "content": "<p>I can't reproduce the issue in VS Code.</p>",
        "id": 503274376,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741096743
    },
    {
        "content": "<p>Yeah web editor</p>",
        "id": 503289773,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1741100476
    },
    {
        "content": "<p>Can reproduce: <a href=\"https://live.lean-lang.org/#codez=KYDwhgtgDgNsAEBvAzvALvAXPQjcAF8tcsBeeZAewCdKBPIA\">https://live.lean-lang.org/#codez=KYDwhgtgDgNsAEBvAzvALvAXPQjcAF8tcsBeeZAewCdKBPIA</a></p>",
        "id": 503297739,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1741102280
    },
    {
        "content": "<p>If I open that link, wait for the grey {α} to appear, then insert a line break before <code>example</code>, then after a second or two the {α} moves and I see <code>exampl {α}e</code></p>",
        "id": 503299064,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1741102643
    },
    {
        "content": "<p>Iterating keeps moving <code> {α}</code> one character to the left.</p>",
        "id": 503318740,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1741107646
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span>  If inlay hints are broken in Monaco, maybe there is some option to deactivate them?</p>",
        "id": 503319141,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741107736
    },
    {
        "content": "<p>It looks like the inlay hints do not use the \"current\" edit-state of the file, but the filemap at the time of last saving.</p>",
        "id": 503320490,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741108116
    },
    {
        "content": "<p>This makes me want to turn auto-implicit on in Mathlib again (although I never wanted to turn it off <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span>)</p>",
        "id": 503323638,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1741109057
    },
    {
        "content": "<p>Yes, this will allow us to get the best of both options.</p>",
        "id": 503329388,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741110833
    },
    {
        "content": "<p>We still lose out when reviewing on github, where inlay hints aren't a thing</p>",
        "id": 503334694,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741112513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503319141\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span>  If inlay hints are broken in Monaco, maybe there is some option to deactivate them?</p>\n</blockquote>\n<p>I'm afraid I currently don't know what the issue is. I can't reproduce it in <a href=\"https://github.com/hhu-adam/lean4monaco\">lean4monaco</a> where everything seems to work fine, so must be something particular to <code>lean4web</code>. Maybe about how the editor content is handled in React...?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503320490\">said</a>:</p>\n<blockquote>\n<p>It looks like the inlay hints do not use the \"current\" edit-state of the file, but the filemap at the time of last saving.</p>\n</blockquote>\n<p>what do you mean by this observation?</p>",
        "id": 503352009,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741118092
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> I think we figured out what the issue is. It likely has to do with the way that the Live setup works.</p>",
        "id": 503352146,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741118140
    },
    {
        "content": "<p>What I meant, is that it looks like the position where the inlay is displayed is the same as it was before you started editing the file.  Subsequent edits do not alter the position, it just keeps being displayed at the same <code>String.pos</code> as in the original setup.</p>",
        "id": 503354958,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741119057
    },
    {
        "content": "<p>Inlay hints should work correctly again on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>.</p>",
        "id": 503357137,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741119765
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503334694\">said</a>:</p>\n<blockquote>\n<p>We still lose out when reviewing on github, where inlay hints aren't a thing</p>\n</blockquote>\n<p>I really don’t think this is enough motivation. I was already not convinced to give up auto-implicit before inlay hints, but here the argument becomes really really weak.</p>",
        "id": 503357242,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741119806
    },
    {
        "content": "<p>Auto-implicits don't enforce that similar lemmas in sections use the same variable names</p>",
        "id": 503357429,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741119860
    },
    {
        "content": "<p>Yes, that’s indeed one more argument in favor of auto-implicit: we can choose variable names more freely.</p>",
        "id": 503357592,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1741119930
    },
    {
        "content": "<p>Do inlay hints have neovim / emacs support? (I know this matters much less for beginners than vscode)</p>",
        "id": 503359988,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741120761
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503357137\">said</a>:</p>\n<blockquote>\n<p>Inlay hints should work correctly again on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>.</p>\n</blockquote>\n<p>The inlay seems to be fixed, but not the insertion (double click to insert)</p>",
        "id": 503360221,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741120837
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503359988\">said</a>:</p>\n<blockquote>\n<p>Do inlay hints have neovim / emacs support? (I know this matters much less for beginners than vscode)</p>\n</blockquote>\n<p>Yes they are supported in neovim, I know emacs has the appropriate options and infrastructure on its side though I haven't seen for myself that it works so only 99% ^^</p>",
        "id": 503360321,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1741120884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360221\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503357137\">said</a>:</p>\n<blockquote>\n<p>Inlay hints should work correctly again on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>.</p>\n</blockquote>\n<p>The inlay seems to be fixed, but not the insertion (double click to insert)</p>\n</blockquote>\n<p>Do you have an MWE?</p>",
        "id": 503360481,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741120936
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360221\">said</a>:</p>\n<blockquote>\n<p>The inlay seems to be fixed, but not the insertion (double click to insert)</p>\n</blockquote>\n<p>Seems to work fine for me on <a href=\"https://live.lean-lang.org/#codez=KYDwhgtgDgNsAEBvAzvALvAXPQjcAF8tcsBeeZAewCdKBPIA\">the example above</a></p>",
        "id": 503360979,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741121134
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503359988\">said</a>:</p>\n<blockquote>\n<p>Do inlay hints have neovim / emacs support? (I know this matters much less for beginners than vscode)</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> helped test inlay hints in NeoVim before the release. AFAICT the Emacs plugin is practically unmaintained at this point and has been broken in several ways for a long time.</p>",
        "id": 503361444,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741121308
    },
    {
        "content": "<p>Here's a fairly unimportant issue but one that I think would be nice for hovering on the inlay hints:</p>\n<p>At the moment, I can hover over an inlay hint for an implicit parameter and it says, for example, <code>α : Sort u_1</code>. But when there are multiple implicit parameters, if after hovering on one, I move my cursor to the other, it does not update this information. Or even with just a single implicit parameter, if I go from hovering over the inlay hint generally to actually on that parameter, it does not update to its information.</p>\n<p>(I've only tested this in the web editor)</p>",
        "id": 503361618,
        "sender_full_name": "Eric Paul",
        "timestamp": 1741121381
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360481\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360221\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503357137\">said</a>:</p>\n<blockquote>\n<p>Inlay hints should work correctly again on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>.</p>\n</blockquote>\n<p>The inlay seems to be fixed, but not the insertion (double click to insert)</p>\n</blockquote>\n<p>Do you have an MWE?</p>\n</blockquote>\n<p><a href=\"/user_uploads/3121/VB0fS_PNooxLgHByi3Q2FUEv/Lean-4-Web-Google-Chrome-2025-03-04-15-53-12.mp4\">Lean 4 Web - Google Chrome 2025-03-04 15-53-12.mp4</a></p>\n<div class=\"message_inline_image message_inline_video\"><a href=\"/user_uploads/3121/VB0fS_PNooxLgHByi3Q2FUEv/Lean-4-Web-Google-Chrome-2025-03-04-15-53-12.mp4\" title=\"Lean 4 Web - Google Chrome 2025-03-04 15-53-12.mp4\"><video preload=\"metadata\" src=\"/user_uploads/3121/VB0fS_PNooxLgHByi3Q2FUEv/Lean-4-Web-Google-Chrome-2025-03-04-15-53-12.mp4\"></video></a></div>",
        "id": 503362330,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741121653
    },
    {
        "content": "<p>Yup I can get that to happen too now</p>",
        "id": 503362671,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1741121783
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503362330\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360481\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503360221\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"221921\">Marc Huisinga</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503357137\">said</a>:</p>\n<blockquote>\n<p>Inlay hints should work correctly again on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>.</p>\n</blockquote>\n<p>The inlay seems to be fixed, but not the insertion (double click to insert)</p>\n</blockquote>\n<p>Do you have an MWE?</p>\n</blockquote>\n<p><a href=\"/user_uploads/3121/VB0fS_PNooxLgHByi3Q2FUEv/Lean-4-Web-Google-Chrome-2025-03-04-15-53-12.mp4\">Lean 4 Web - Google Chrome 2025-03-04 15-53-12.mp4</a></p>\n</blockquote>\n<p>Thanks, I can reproduce this. The issue appears to occur when attempting to apply the inlay hint during the edit delay. I'll look into it.</p>",
        "id": 503362755,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741121828
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"512030\">Eric Paul</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E18.2E0.20-.20inlay.20hints/near/503361618\">said</a>:</p>\n<blockquote>\n<p>Here's a fairly unimportant issue but one that I think would be nice for hovering on the inlay hints:</p>\n<p>At the moment, I can hover over an inlay hint for an implicit parameter and it says, for example, <code>α : Sort u_1</code>. But when there are multiple implicit parameters, if after hovering on one, I move my cursor to the other, it does not update this information. Or even with just a single implicit parameter, if I go from hovering over the inlay hint generally to actually on that parameter, it does not update to its information.</p>\n<p>(I've only tested this in the web editor)</p>\n</blockquote>\n<p>This is a bug in VS Code as well. Perhaps we should just display all auto-implicits and their types in the same hover to work around it.</p>",
        "id": 503363092,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741121955
    },
    {
        "content": "<p>The insertion issue appears to be yet another VS Code / Monaco bug. I'll see if we can somehow work around it.</p>",
        "id": 503372618,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741125558
    },
    {
        "content": "<p>Btw, for lean4web it's useful if you test wether things work as expected in you local VSCode and then if it's a bug which is only appearing in lean4web, append it here: <a href=\"https://github.com/leanprover-community/lean4web/issues/55\">lean4web#55</a></p>\n<p>I'll try to fix all these then at some point, but it's useful if Marc can first fix anything that's not web-related.</p>",
        "id": 503393421,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741134903
    },
    {
        "content": "<p>PR to fix the inlay hint insertion issue: <a href=\"https://github.com/leanprover/lean4/pull/7343\">lean4#7343</a><br>\nPR to combine auto-implicit inlay hint tooltips into one to work around buggy VS Code inlay hint hover behavior: <a href=\"https://github.com/leanprover/lean4/pull/7344\">lean4#7344</a></p>",
        "id": 503481750,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1741172478
    }
]