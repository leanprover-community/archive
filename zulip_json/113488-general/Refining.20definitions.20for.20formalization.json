[
    {
        "content": "<p>Hi all,</p>\n<p>I'm writing a survey paper exploring how definitions get refined and selected for formalizations. Choosing the right definition is one of those hurdles that causes Lean to have a fairly steep learning curve for new users, so I'd like to see what I can do to distill observations about this process and do a few case studies (e.g. how the algebra library definitions are approached vs the graph theory library). I've seen a few papers that talk about this, and I'm looking through the Zulip for examples of this exact sort of conversation, but does anyone have any insights or specific personal experiences they'd like to talk about when it comes to this? Doesn't necessarily have to be formalizations included in mathlib, but mathlib is what I'll probably focus on more because of familiarity. Thanks!</p>",
        "id": 504436749,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1741558047
    },
    {
        "content": "<p>Did you see <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span>'s Lean Together talk on this topic? That had a nice example for root systems</p>",
        "id": 504442900,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741562899
    },
    {
        "content": "<p>Ooh no, don't think I have. This looks like an excellent source, thank you!!</p>",
        "id": 504454360,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1741571262
    },
    {
        "content": "<p>My recent paper with <span class=\"user-mention silent\" data-user-id=\"268315\">Anatole Dedecker</span> focuses on the process of refining a particular definition in much the same way as Oliver's talk. It can be found at <a href=\"https://arxiv.org/abs/2501.15639\">arXiv: 2501.15639</a></p>",
        "id": 504643268,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1741626312
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/113488-general/topic/Refining.20definitions.20for.20formalization/near/504643268\">said</a>:</p>\n<blockquote>\n<p>My recent paper with <span class=\"user-mention silent\" data-user-id=\"268315\">Anatole Dedecker</span> focuses on the process of refining a particular definition in much the same way as Oliver's talk. It can be found at <a href=\"https://arxiv.org/abs/2501.15639\">arXiv: 2501.15639</a></p>\n</blockquote>\n<p>Ah, I might finally figure out what the CFC is about. (Do you take typo reports?)</p>",
        "id": 504653477,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741629396
    },
    {
        "content": "<p>There are some good examples of this in category theory. The first that comes to mind is how sometimes \"redundant\" variants of the typeclass fields in the definition of a category can make it easier to get definitionally equality when working with dual categories. Likewise it tends to be helpful to not try to define constructions by their dual. Good references for these are <a href=\"https://doi.org/10.1007/978-3-319-08970-6_18\">Experience Implementing a Performant Category-Theory Library in Coq</a> and <a href=\"https://doi.org/10.1145/3437992.3439922\">Formalizing category theory in Agda</a>. There is also some discussion in these of typeclass bundling decisions and choosing definitions to avoid certain universe issues.</p>",
        "id": 504661493,
        "sender_full_name": "Chris Henson",
        "timestamp": 1741631745
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/113488-general/topic/Refining.20definitions.20for.20formalization/near/504653477\">said</a>:</p>\n<blockquote>\n<p>Ah, I might finally figure out what the CFC is about. (Do you take typo reports?)</p>\n</blockquote>\n<p>Sure. Probably won't update immediately, but happy to receive them via DM, or a new thread.</p>",
        "id": 504696790,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1741644498
    },
    {
        "content": "<p>I find Lean formalisation tricky because it actually involves two steps:</p>\n<ol>\n<li>expressing the structure / statement in dependent type theory</li>\n<li>finding the best implementation of the type theoretic statement using the particular language features of Lean</li>\n</ol>\n<p>Perhaps point 1 is what's been keeping a lot of differential geometry from being formalised, since you have to deal with subsets a lot. Jumping directly to 2 naively will work initially but it quickly pollutes downstream proofs.</p>\n<p>There was the famous problem of nested subalgebras in early mathlib that was solved with <code>IsScalarTower</code>. That seems more like point 1 than point 2. Analogous solutions for other mathematical structures likely exist but have not been found.</p>",
        "id": 504699926,
        "sender_full_name": "Winston Yin (尹維晨)",
        "timestamp": 1741645707
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"416472\">Winston Yin (尹維晨)</span> <a href=\"#narrow/channel/113488-general/topic/Refining.20definitions.20for.20formalization/near/504699926\">said</a>:</p>\n<blockquote>\n<p>I find Lean formalisation tricky because it actually involves two steps:</p>\n<ol>\n<li>expressing the structure / statement in dependent type theory</li>\n<li>finding the best implementation of the type theoretic statement using the particular language features of Lean</li>\n</ol>\n<p>Perhaps point 1 is what's been keeping a lot of differential geometry from being formalised, since you have to deal with subsets a lot. Jumping directly to 2 naively will work initially but it quickly pollutes downstream proofs.</p>\n<p>There was the famous problem of nested subalgebras in early mathlib that was solved with <code>IsScalarTower</code>. That seems more like point 1 than point 2. Analogous solutions for other mathematical structures likely exist but have not been found.</p>\n</blockquote>\n<p>Yeah, that's roughly what I've observed as well - there are usually some number of mathematically equivalent definitions to choose from (and it takes some trial and error to figure out which one to formalize, and the best way to express them in type theory), and then the implementation in Lean specifically usually takes a couple attempts to work out as well. The hope is that compiling some case studies and examining common pitfalls in early definition attempts can help define a kind of rule set for definitions, or at least things to keep in mind.</p>",
        "id": 504738119,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1741667242
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"303889\">@Alena Gusakov</span> I would be curious to know if you find anywhere in your survey where someone has come up with a word/phase to describe this process. I've taken to using the phrase \"user proof interface\" myself, for this idea of the back and forth between mathematically equivalent definitions and the experience of actually formalizing them as a practical matter.</p>",
        "id": 504936743,
        "sender_full_name": "Chris Henson",
        "timestamp": 1741721966
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> I don't think I've really seen anyone use a specific term for it yet, I've just been thinking of it as refining or weeding out definitions.</p>",
        "id": 504947530,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1741724649
    },
    {
        "content": "<p>Hey everyone, I wanted to ask a follow-up question. Does anyone have examples of weird or hacky workarounds for definitions that end up being the only thing that work in Lean's type theory for that definition? Things along the lines of <span class=\"user-mention\" data-user-id=\"329425\">@Peter Nelson</span> 's thread about formalizing matroids <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/The.20design.20of.20matroids/with/452697958\">#mathlib4 &gt; The design of matroids</a>. I'm writing a section on how occasionally, trying to avoid type theory problems can restrict one's ability to properly express mathematical concepts, and I want to write up some case studies on those kinds of problems and what some of the community-approved solutions can look like.</p>\n<p>I assume there are probably multiple examples like this but I haven't been super active here lately so I don't know where to look. Thanks!</p>",
        "id": 515570682,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1746129081
    },
    {
        "content": "<p>Hopefully this is extremely rare. The ordinary situation is that Lean forces to clean up definitions and the Lean definitions end up being nicer than the paper ones.</p>",
        "id": 515573152,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1746130036
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/113488-general/topic/Refining.20definitions.20for.20formalization/near/515573152\">said</a>:</p>\n<blockquote>\n<p>Hopefully this is extremely rare. The ordinary situation is that Lean forces to clean up definitions and the Lean definitions end up being nicer than the paper ones.</p>\n</blockquote>\n<p>I'll try to stress that it's rare in the survey then - most of my paper so far talks about how people typically clean up definitions and what things to keep in mind, and this section where I talk about the matroid theory formalization difficulties is at the end.</p>",
        "id": 515584238,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1746134527
    },
    {
        "content": "<p>Are you looking for things like <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>''s shift functor / chain complex thing, or maybe some stuff from my paper on graded rings? Both are (different) approaches to dealing with dependent types when they get in the way.</p>",
        "id": 516010450,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746350045
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> Oh thank you, that's exactly what I'm looking for!</p>",
        "id": 516271798,
        "sender_full_name": "Alena Gusakov",
        "timestamp": 1746470537
    }
]