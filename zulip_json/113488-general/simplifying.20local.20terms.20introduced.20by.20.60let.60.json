[
    {
        "content": "<p>If I have a local definition in a proposition, introduced by <code>let</code> like the following.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">aux</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">aux</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">natAbs</span>\n<span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">aux</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>How can I simplify <code>aux</code> in each branch of the <code>if</code>? Understandably, <code>simp</code> only works at the type level, but I would like to invoke it at the \"value\" level of the <code>let</code> definition.</p>",
        "id": 505665025,
        "sender_full_name": "Ayhon",
        "timestamp": 1741956125
    },
    {
        "content": "<p><code>simp [h, aux] at *</code>, assuming your Lean is sufficiently new</p>",
        "id": 505667420,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741956855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/simplifying.20local.20terms.20introduced.20by.20.60let.60/near/505667420\">said</a>:</p>\n<blockquote>\n<p><code>simp [h, aux] at *</code>, assuming your Lean is sufficiently new</p>\n</blockquote>\n<p>That might be the problem then. I'm using <code>4.16.0-rc2</code></p>",
        "id": 505667487,
        "sender_full_name": "Ayhon",
        "timestamp": 1741956879
    },
    {
        "content": "<p>It works with 4.17.0 in the playground</p>",
        "id": 505667604,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741956911
    },
    {
        "content": "<p><code>unfold</code> may be an alternative</p>",
        "id": 505667687,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741956936
    },
    {
        "content": "<p>But that would just substitute the definition of <code>aux</code> in my current goal or proposition I chose, no?</p>",
        "id": 505667853,
        "sender_full_name": "Ayhon",
        "timestamp": 1741956977
    },
    {
        "content": "<p>Oh, you want to simplify the RHS of aux without substituting it?</p>",
        "id": 505668123,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741957066
    },
    {
        "content": "<p>Yes, indeed</p>",
        "id": 505668152,
        "sender_full_name": "Ayhon",
        "timestamp": 1741957076
    },
    {
        "content": "<p>I'm actually using these <code>let</code> definitions as a way of managing the readability of my proof state. So far I've found that using <code>generalize x_def: rhs = x</code> works for my use case, but it introduces two elements to my local context, <code>x</code> and <code>x_def</code>, which I would prefer to prevent. I was wondering if there was a way of doing so</p>",
        "id": 505668550,
        "sender_full_name": "Ayhon",
        "timestamp": 1741957189
    },
    {
        "content": "<p>But that is likely the right way to do it as then you can rewrite in <code>x_def</code> without affecting anyone else. With <code>let</code>, you can only do defeq transformations in general because dependent terms may otherwise become type-incorrect.</p>",
        "id": 505669056,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741957315
    },
    {
        "content": "<p>I see. In that case I will use <code>generalize</code> instead, or something based upon it. Another perceived advantage of introducing these terms with let is that I could define them in the proposion I'm trying to prove and simply introduce them with <code>intro</code>, without having to explicitly set the term I'm substituting. But I can imagine having some kind of <code>intro'</code> which introduces let bindings in this way.</p>\n<p>As an illustrating example, here I don't have to do <code>generalize tree'_def: tree.delete_rebalance target = tree'</code>, but just <code>intro tree'</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"bp\">.</span><span class=\"n\">BSTree</span><span class=\"bp\">.</span><span class=\"n\">delete_rebalance</span><span class=\"bp\">.</span><span class=\"n\">spec</span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">][</span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"o\">{</span><span class=\"n\">tree</span><span class=\"w\"> </span><span class=\"n\">tree'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BSTree</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}{</span><span class=\"n\">target</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span>\n<span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"bp\">.</span><span class=\"n\">is_avl</span>\n<span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">tree'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"bp\">.</span><span class=\"n\">delete_rebalance</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"w\">  </span><span class=\"n\">tree'</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"bp\">.</span><span class=\"n\">toSet</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">target</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">  </span><span class=\"n\">tree'</span><span class=\"bp\">.</span><span class=\"n\">is_avl</span>\n</code></pre></div>",
        "id": 505670090,
        "sender_full_name": "Ayhon",
        "timestamp": 1741957582
    },
    {
        "content": "<p>Arguably, if you want to set the equality from the proof, you'd do so as a proposition directly, so perhaps it's not even that useful to have such an <code>intro'</code> if you write the proposition correctly.</p>",
        "id": 505672729,
        "sender_full_name": "Ayhon",
        "timestamp": 1741958347
    }
]