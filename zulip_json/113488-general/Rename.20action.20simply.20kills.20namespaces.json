[
    {
        "content": "<p>Currently the LSP rename action (invoced by pressing <code>F2</code> or <code>Right-Click -&gt; Rename Symbol</code> is in a poor state.<br>\nRenaming a namespaced Definition <code>myfun</code> to <code>myfun2</code> will replace everything with <code>myfun2</code>, regardless of wether it was used as <code>myfun</code>, <code>Namespace1.myfun</code> or <code>Namespace2.Namespace1.myfun</code>, therefore breaking code everywhere.</p>\n<p>Consider the following concrete examples</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> Renaming `myfun` at the definition breaks all of the other usages below. -/</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Innernamespace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Innernamespace</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span>\n\n\n<span class=\"c1\">-- Scenario 1: Fully Qualified Usage</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testFull</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Outernamespace</span><span class=\"bp\">.</span><span class=\"n\">Innernamespace</span><span class=\"bp\">.</span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n\n\n<span class=\"c1\">-- Scenario 2: Partially Qualified Usage (opening the outer namespace)</span>\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">PartialOpen</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testPartial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Innernamespace</span><span class=\"bp\">.</span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"mi\">20</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">PartialOpen</span>\n\n\n<span class=\"c1\">-- Scenario 3: Unqualified Usage (opening the exact namespace)</span>\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">FullOpen</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span><span class=\"bp\">.</span><span class=\"n\">Innernamespace</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testUnqualified</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"mi\">30</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">FullOpen</span>\n\n\n<span class=\"c1\">-- Scenario 4: Usage within the same namespace hierarchy</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span>\n<span class=\"w\">  </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testInternal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Innernamespace</span><span class=\"bp\">.</span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"mi\">40</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span>\n\n\n<span class=\"c1\">-- Scenario 5: Usage via export</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Wrapper</span>\n<span class=\"w\">  </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Outernamespace</span><span class=\"bp\">.</span><span class=\"n\">Innernamespace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myfun</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Wrapper</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">testExported</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Wrapper</span><span class=\"bp\">.</span><span class=\"n\">myfun</span><span class=\"w\"> </span><span class=\"mi\">50</span>\n\n\n\n\n\n<span class=\"sd\">/-- Rename `Button` here. It breaks the definition below. -/</span>\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Button</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">primary</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">secondary</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myButton</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Button</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Button</span><span class=\"bp\">.</span><span class=\"n\">primary</span>\n</code></pre></div>\n<p>There is a Lean <a href=\"https://github.com/leanprover/lean4/issues/2936\">issue</a> existing for this since 2023  and i really think this deserves more attention.<br>\nRenaming lemmas and definitions is a very important part of maintaining and writing new APIs and as such a core editing experience.<br>\nI think a slightly more robust solution would save us lots of time fixing renamings every day every user.</p>",
        "id": 575178348,
        "sender_full_name": "Moritz R",
        "timestamp": 1771782199
    },
    {
        "content": "<p>At this point, would new upvotes on this issue give it any new attention?</p>",
        "id": 575178382,
        "sender_full_name": "Moritz R",
        "timestamp": 1771782239
    },
    {
        "content": "<p>Let me state a bold conjecture: I think the Lean team is actually aware of this issue.</p>",
        "id": 575179442,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1771783354
    },
    {
        "content": "<p>The issue has been triaged as <code>P-medium</code> so probably it's behind the 44 <code>P-high</code> issues.</p>",
        "id": 575179574,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1771783420
    },
    {
        "content": "<p>Maybe i just want to argue that it should be a <code>P-high</code> then ;)</p>",
        "id": 575184322,
        "sender_full_name": "Moritz R",
        "timestamp": 1771787309
    },
    {
        "content": "<p>Right, but it is the FRO who is making these decisions, and probably without any new evidence to change their previous decision, it will stay at P-medium. One person saying \"actually I agree\" probably isn't enough to swing it. Just give the issue a thumbs up and try and encourage others to do so.</p>",
        "id": 575190848,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1771793208
    },
    {
        "content": "<p>This particular issue is in my backlog, and it is currently lower priority than the auto-formatter for Lean that I am working on :-)<br>\nAfter the code formatter, if nothing else comes up, we will invest more time into refining code action support in core and re-thinking the renaming mechanism will be a part of that.</p>",
        "id": 575252270,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1771837545
    }
]