[
    {
        "content": "<p>I want to like aesop and start using it more often. But usually when I do there is still some very low-level reasoning that <code>aesop</code> doesn't do which I expected it to do. I thought it might be good to start a list, which can be hopefully used to improve aesop.</p>\n<p>here is a first one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 474794620,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728038835
    },
    {
        "content": "<p>probably quite tricky</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- rw [← or_iff_not_imp_left] at h2 h3; -- aesop works with this uncommented</span>\n<span class=\"w\">  </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 474806387,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728042697
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Common</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">aesop</span>\n</code></pre></div>",
        "id": 474807022,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1728042939
    },
    {
        "content": "<p>I feel the same way, and my recent example is <a href=\"#narrow/stream/113488-general/topic/aesop.20and.20set.20.20inclusions/near/473220670\">here</a>.</p>",
        "id": 474823776,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728048543
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n</code></pre></div>\n<p>I sometimes have things like this and I'm surprised aesop struggles, not sure if I'm expecting too much of it though.</p>",
        "id": 474885053,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1728068903
    },
    {
        "content": "<p>Another example of a similar form, except this one is minimised from one that game up in practice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">aesop</span>\n</code></pre></div>\n<p>Note that doing <code>specialize ht x hx</code> before the aesop makes it work. I wonder if an unsafe 5% <code>specialize</code> would fix these two without breaking much else</p>",
        "id": 475298188,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1728307878
    },
    {
        "content": "<p>Thank you for the examples! User feedback like this is very valuable. I don't have time right now to make bigger changes to Aesop (other than the ones I'm currently working on), but I'll save this thread and come back to it.</p>\n<p><span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> the first two examples could be solved by teaching the rule that applies local hypotheses to apply conjunctions. This is definitely doable. I'll make a student project out of this or implement it when I have a moment.</p>\n<p>The third example can be solved by locally adding a low-priority transitivity rule (<code>aesop (add 1% le_trans)</code>). This is not a good global rule because it applies to any goal <code>x &lt; y</code> and introduces metavariables, which slow down Aesop. But adding it locally should be fine. Alternatively, <code>le_trans</code> could be added as a forward rule. Then any hypotheses <code>a &lt; b</code> and <code>b &lt; c</code> in the context would be combined into <code>a &lt; c</code>. This seems generally sensible, but only works for local hyps.</p>\n<p><span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span> these examples would be solved with a rule that performs forward reasoning with all hypotheses in the context (up to some depth limit). I'm currently working on a big overhaul of Aesop's forward reasoning and this is something I've wanted to do anyway, so it's going to happen eventually.</p>",
        "id": 475596371,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1728401395
    },
    {
        "content": "<p>It seems that for many questions, there's a trick of the form \"do <code>aesop (add some trick here)</code>\". But the comment above seems to indicate that it's not wise to make a PR to make aesop always do this trick (at least in the example being talked about). My conclusion is that we as aesop users are supposed to start learning these tricks (which is fine by me, indeed right now this is the key take-home message I've learnt from asking questions of the form \"why doesn't <code>aesop</code> do this?\").</p>",
        "id": 475598906,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728401856
    },
    {
        "content": "<p>Maybe this is the same question as Kevin's, or maybe this is precisely the wrong thread for this, but is there a good reference for the exact opposite of these failures, i.e. \"here's some kinds of goals you should expect aesop to handle perfectly <em>in the context of Mathlib</em>\"? I know the README covers ideas behind it, and I can of course jump back and forth looking for places where <code>aesop</code> is used in Mathlib, but given I don't feel like I have good intuition for  when I should try<code>aesop</code> I'd love to see like 5 or 6 \"this is exactly what it's made for\" kinds of goals.</p>",
        "id": 475599762,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728402076
    },
    {
        "content": "<p>I often write things like <code>aesop (add simp [...])</code>, where the <code>[...]</code> are filled in with 1-3 simple lemmas which shouldn't be simp in general, but are what I'd rewrite/apply with if I had to prove this manually. And today I also wrote <code>aesop (add unsafe apply le_of_lt)</code>, which is a bad aesop rule for the same le_trans reason as above, but was convenient in my particular case</p>",
        "id": 475608780,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1728404368
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475298188\">said</a>:</p>\n<blockquote>\n<p>Another example of a similar form, except this one is minimised from one that game up in practice:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Aesop</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">aesop</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Note that this is solved (quickly) by <code>duper [*]</code> (<span class=\"user-mention\" data-user-id=\"436568\">@Josh Clune</span>'s superposition prover).  Maybe <code>aesop</code> is just the wrong general-purpose tactic for this kind of problem?</p>",
        "id": 475615887,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1728405950
    },
    {
        "content": "<p>Yes, <code>duper</code> ought to be much better on pure logic + equality. That's what its calculus excels at.</p>",
        "id": 475619582,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1728407112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475598906\">said</a>:</p>\n<blockquote>\n<p>My conclusion is that we as aesop users are supposed to start learning these tricks [...].</p>\n</blockquote>\n<p>Yes. By design, stock Aesop is fairly weak. It becomes much stronger if Mathlib adds a bunch of rules, either globally (as is currently done in parts of the library, notably category theory) or locally for specific proofs.</p>\n<p>If I can help with this, please let me know! I don't currently have time to experiment with different global rules in Mathlib, but I'd be very happy to advise. (One of these days, I'll also make the Aesop docs more comprehensible. Having everything in one README is maybe not ideal.)</p>",
        "id": 475620835,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1728407525
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475599762\">said</a>:</p>\n<blockquote>\n<p>\"here's some kinds of goals you should expect aesop to handle perfectly <em>in the context of Mathlib</em>\"?</p>\n</blockquote>\n<p>As a somewhat crude heuristic: if a theorem can be proved by a sequence of</p>\n<ul>\n<li><code>apply foo</code> (<code>apply</code> rules)</li>\n<li><code>have := foo a ... z</code> (<code>forward</code>/<code>destruct</code> rules)</li>\n<li><code>simp_all</code> (<code>simp</code> rules)</li>\n<li><code>cases</code> (<code>cases</code> rules)</li>\n<li><code>subst</code></li>\n<li><code>ext</code></li>\n<li><code>rfl</code></li>\n<li><code>split</code></li>\n</ul>\n<p>then it should be possible to make Aesop prove it.</p>\n<p>However, Mathlib could also experiment with additional tactic-based rules. For example, Aesop could be taught to apply <code>linarith</code>, <code>omega</code> or <code>positivity</code> on goals of a specific form. The only question is whether this makes Aesop too slow.</p>",
        "id": 475622040,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1728407901
    },
    {
        "content": "<p>And the <code>a..z</code> in the <code>have</code> example are expected to be somehow destructed from the current goal state right? <code>aesop</code> isn't going to synthesize terms that don't appear somewhere?</p>",
        "id": 475624513,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728408617
    },
    {
        "content": "<p>The <code>a ... z</code> are hypotheses that already appear in the context (or that Aesop has added to the context through other rules).</p>",
        "id": 475628342,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1728409481
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"256311\">Jannis Limperg</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475620835\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475598906\">said</a>:</p>\n<blockquote>\n<p>My conclusion is that we as aesop users are supposed to start learning these tricks [...].</p>\n</blockquote>\n<p>Yes. By design, stock Aesop is fairly weak. It becomes much stronger if Mathlib adds a bunch of rules, either globally (as is currently done in parts of the library, notably category theory) or locally for specific proofs.</p>\n</blockquote>\n<p>Yeah I hadn't realised this; I thought that the idea was that people just slowly tagged every lemma in mathlib with aesop and then it could prove everything, so I've never paid too much attention to the actual instructions, I've just typed <code>aesop</code> and then moaned when it didn't work. I had not properly understood how to use the tool so this thread has been very helpful!</p>",
        "id": 475635532,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1728411483
    },
    {
        "content": "<p>I think having actual examples of <code>aesop</code> calls with parameters would be very helpful.</p>",
        "id": 475656134,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1728416921
    },
    {
        "content": "<p>Last time I checked the README, it was non-trivial to understand how to tell aesop about a bunch of lemmas it may use.</p>",
        "id": 475656249,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1728416952
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span> <a href=\"#narrow/stream/113488-general/topic/aesop.20failures/near/475615887\">said</a>:</p>\n<blockquote>\n<p>Note that this is solved (quickly) by <code>duper [*]</code> (<span class=\"user-mention silent\" data-user-id=\"436568\">Josh Clune</span>'s superposition prover).  Maybe <code>aesop</code> is just the wrong general-purpose tactic for this kind of problem?</p>\n</blockquote>\n<p>Perhaps, although this example came from something where aesop did quite a bit of work (in the form Jannis described earlier), but then \"got stuck\" at a goal like this, so actually using duper here would mean writing a bunch of tactics before it gets down to a pure logic + equality goal</p>",
        "id": 475834886,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1728473620
    }
]