[
    {
        "content": "<p>Where could I go about finding instructions for updating an existing repo that uses mathlib?</p>",
        "id": 537400516,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756875429
    },
    {
        "content": "<p><code>lake update</code> doesn't seem to change anything.</p>",
        "id": 537401703,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756875977
    },
    {
        "content": "<p>I guess I need to remove the tagged revision from mathlib.</p>",
        "id": 537401958,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756876135
    },
    {
        "content": "<p>I changed the revision in <code>lean-toolchain</code> to <code>leanprover/lean4:v4.22.0</code> and the revision tag for mathlib in <code>lakefile.toml</code> to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.22.0\"</span>\n</code></pre></div>\n<p>and tried <code>lake build</code>, but it gave a lot of errors.</p>",
        "id": 537402780,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756876746
    },
    {
        "content": "<p>I think I see. I think maybe I have to update my external library first.</p>",
        "id": 537404649,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756878289
    },
    {
        "content": "<p>You do need <code>lake update</code> after changing <code>lakefile.tomp</code>, though I would recommend only changing one minor version at a time (i.e. 15 → 16 → 17 → ···)</p>",
        "id": 537420604,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756886292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"139442\">Paige Thomas</span> <a href=\"#narrow/stream/113488-general/topic/updating.20from.20leanprover.2Flean4.3Av4.2E15.2E0/near/537404649\">said</a>:</p>\n<blockquote>\n<p>I think I see. I think maybe I have to update my external library first.</p>\n</blockquote>\n<p>one major pitfall with multiple dependencies is that there is only ever one version  of each (secondary) dependency. So if another dependency also requires e.g. <code>batteries</code> but at a different commit than mathlib does, then you will get countless errors as it tries to build <code>mathlib</code> on this wrong <code>batteries</code> version. It's kind of your responsibility to ensure all required dependencies are compatible. Best to update your external library to stable releases and tag them with e.g. <code>v4.22.0</code> too</p>",
        "id": 537454806,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1756899038
    },
    {
        "content": "<p>I see. I think that is probably what is going on. Thank you.</p>",
        "id": 537533923,
        "sender_full_name": "Paige Thomas",
        "timestamp": 1756924429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> <a href=\"#narrow/channel/113488-general/topic/updating.20from.20leanprover.2Flean4.3Av4.2E15.2E0/near/537454806\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"139442\">Paige Thomas</span> <a href=\"#narrow/stream/113488-general/topic/updating.20from.20leanprover.2Flean4.3Av4.2E15.2E0/near/537404649\">said</a>:</p>\n<blockquote>\n<p>I think I see. I think maybe I have to update my external library first.</p>\n</blockquote>\n<p>one major pitfall with multiple dependencies is that there is only ever one version  of each (secondary) dependency. So if another dependency also requires e.g. <code>batteries</code> but at a different commit than mathlib does, then you will get countless errors as it tries to build <code>mathlib</code> on this wrong <code>batteries</code> version. It's kind of your responsibility to ensure all required dependencies are compatible. Best to update your external library to stable releases and tag them with e.g. <code>v4.22.0</code> too</p>\n</blockquote>\n<p>Does the FRO have plans to address this/can it be addressed? This has bitten me and is an especially vexing paper cut.</p>",
        "id": 537575709,
        "sender_full_name": "Alok Singh",
        "timestamp": 1756949477
    },
    {
        "content": "<p>Yes, we're definitely thinking about it, and Mac has been working on it.</p>\n<p>I think if you are careful <em>not</em> to include any transitively implied dependencies in your lakefile, then the current system usually works okay: pin each dependency to a <code>v4.X.0</code> tag, and specify the same in <code>lean-toolchain</code>. If there are examples of this not working (i.e. incompatibilities between libraries at the same toolchain tag), please highlight them.</p>",
        "id": 537582365,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1756955389
    }
]