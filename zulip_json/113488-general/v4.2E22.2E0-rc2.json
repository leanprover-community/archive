[
    {
        "content": "<p>This thread is for discussion of the <code>v4.22.0-rc2</code> release.</p>\n<p>(I anticipate that there'll be discussion in other threads about <code>grind</code> -- please try to use those for <code>grind</code> specific questions.)</p>",
        "id": 526509809,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751333378
    },
    {
        "content": "<p>Other thread about grind: <a href=\"#narrow/channel/287929-mathlib4/topic/.60grind.60.20is.20available.2E.20What.20should.20Mathlib.20users.20expect.3F/near/526510080\">#mathlib4 &gt; &#96;grind&#96; is available. What should Mathlib users expect? @ üí¨</a></p>",
        "id": 526512148,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751335063
    },
    {
        "content": "<p>my lean-update action is no longer needed?<br>\n(sorry for late developing)</p>",
        "id": 526525890,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1751346625
    },
    {
        "content": "<p>Is there an example for new monadic verification framework?</p>",
        "id": 526528521,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1751348634
    },
    {
        "content": "<p>What is \"the new module system\"? What even is a module?</p>",
        "id": 526536774,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751353006
    },
    {
        "content": "<p>I‚Äôm interested in new module system, too.<br>\nCould you show us an code example?</p>",
        "id": 526538476,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1751353665
    },
    {
        "content": "<p>As far as I understand (from having used Agda and Idris) a module is an extension of a namespace but which can be parametrized. The parameters will be like <code>variable</code> statements from within the module but when a module is imported specific values can be plugged in. For instance, a module about graphs may have <code>V</code> and <code>E</code> as parameters.</p>",
        "id": 526553312,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1751358516
    },
    {
        "content": "<p>No, that's not it.</p>",
        "id": 526557035,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751359651
    },
    {
        "content": "<p>I'm not going to write the explanation now, sorry, but perhaps someone else will soon :-). It is a collection of keywords associated to <code>import</code> statements that control the visibility of declarations and their bodies in downstream files. Looking at <code>src/Init/</code> in the Lean repository, where this is already being deployed, is the best I can offer at this moment.</p>",
        "id": 526557364,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751359736
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> </p>\n<blockquote>\n<p>my lean-update action is no longer needed?<br>\n(sorry for late developing)</p>\n</blockquote>",
        "id": 526574683,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1751365237
    },
    {
        "content": "<p>Trying to update my project I am running into <code>PANIC at _private.Lean.Environment.0.Lean.AsyncConsts.add Lean.Environment:464:4: duplicate normalized declaration name endNodesOf vs. endNodesOf</code> where <code>endNodesOf</code> is a definition in my file. Are there known issues related to this? Should I upload the backtrace somewhere to debug this? Or better wait for a non-rc version?</p>",
        "id": 526600403,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1751374063
    },
    {
        "content": "<p>I don't know of any open issues related to that, please open one!</p>",
        "id": 526600819,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751374192
    },
    {
        "content": "<p>Ok, I fear making an MWE will be tricky, so I'll first try to at least reproduce it in the CI of my project.</p>",
        "id": 526601991,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1751374553
    },
    {
        "content": "<p><a href=\"https://github.com/m4lvin/lean4-pdl/actions/runs/16000924061/job/45135399192#step:6:22\">Here</a> is the <code>PANIC</code> in a CI action that does <code>lake build Bml</code>. Just above it there is this error which makes me wonder if something that previously could \"see\" that <code>LR = (LR.1, LR.2)</code> now got more strict <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bml</span><span class=\"bp\">/</span><span class=\"n\">Tableau</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">706</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cannot</span><span class=\"w\"> </span><span class=\"n\">derive</span><span class=\"w\"> </span><span class=\"n\">endNodesOf</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span>\n<span class=\"w\">  </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">    </span><span class=\"n\">endNodesOf</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span><span class=\"w\"> </span><span class=\"n\">LR</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">ruleA</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c_inhas</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">lengthOfTNode</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">lengthOfTNode</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LR</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LR</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">    </span><span class=\"n\">lengthOfTNode</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">lengthOfTNode</span><span class=\"w\"> </span><span class=\"n\">LR</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>and below it there is a long backtrace.</p>\n<p>(I hope the CI action log is public, it seems GitHub does not show it when I am not logged in.)</p>\n<p>Update: I managed to <a href=\"https://github.com/m4lvin/lean4-pdl/commit/f7e3ed4591364a61c56e2b78c60c2f40af63aa4e\">work around this problem by replacing</a> <code>c</code> with <code>(c.1, c.2)</code> and similar things, but I have no idea why this helps. And <a href=\"https://github.com/m4lvin/lean4-pdl/actions/runs/16001993320/job/45139096970#step:6:78\">here</a> is a similar <code>PANIC</code> that I ran into next.</p>\n<p>Update update: maye related <a href=\"https://github.com/leanprover/lean4/issues/8627\">https://github.com/leanprover/lean4/issues/8627</a></p>",
        "id": 526613283,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1751377736
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/526557035\">said</a>:</p>\n<blockquote>\n<p>No, that's not it.</p>\n</blockquote>\n<p>I really wish that were it, though! Maybe one day we'll have parameterized modules</p>",
        "id": 526660884,
        "sender_full_name": "ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí",
        "timestamp": 1751393598
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> drawing your attention to <a href=\"https://github.com/leanprover-community/mathlib4/pull/26564#discussion_r2176248010\">this</a>.</p>",
        "id": 526661026,
        "sender_full_name": "ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí",
        "timestamp": 1751393657
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">ùö†ùöòùöìùöåùöíùöéùöåùöë ùöóùöäùö†ùöõùöòùöåùöîùöí</span> <a href=\"#narrow/stream/113488-general/topic/v4.2E22.2E0-rc2/near/526661026\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> drawing your attention to <a href=\"https://github.com/leanprover-community/mathlib4/pull/26564#discussion_r2176248010\">this</a>.</p>\n</blockquote>\n<p>Thanks, it has since been fixed. I had everything pointing to nightly-testing versions of dependencies.</p>",
        "id": 526696639,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751412647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/526536774\">said</a>:</p>\n<blockquote>\n<p>What is \"the new module system\"? What even is a module?</p>\n</blockquote>\n<p>Sebastian has been working on documentation, it will be coming soon!</p>",
        "id": 526770595,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751452656
    },
    {
        "content": "<p>\"The module system is an experimental feature that allows for more fine-grained control over what information is exported from, and imported into, modules.\"</p>\n<p>I am still at a loss about what a \"module\" is. Sorry for my ignorance!</p>",
        "id": 526770914,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751452771
    },
    {
        "content": "<p>A module is simply a lean file that begins with the <code>module</code> keyword. It then affects (more specifically, allows you to control) what information from that file is available in other modules which import it.</p>",
        "id": 526771084,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751452830
    },
    {
        "content": "<p>by \"import (a module)\" you just mean \"import the file\"?</p>",
        "id": 526771208,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751452872
    },
    {
        "content": "<p>Yes</p>",
        "id": 526771224,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751452880
    },
    {
        "content": "<p>I see, so for example I can't make any file in FLT into a module right now because I'm typically importing thousands of mathlib files which are not modules.</p>",
        "id": 526771478,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751452964
    },
    {
        "content": "<p>Yes.</p>",
        "id": 526771510,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751452974
    },
    {
        "content": "<p>We're not anticipating mathematicians will be significant users of this feature in the near term.</p>",
        "id": 526771572,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751452993
    },
    {
        "content": "<p>Oh! Anyway thanks for the link, I now feel like I understand much better what's going on.</p>",
        "id": 526771615,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751453013
    },
    {
        "content": "<p>All of Batteries, and probably the Logic and Data (or at least, what <em>should</em> be in Data) directories of Mathlib should become modules asap. This will unblock non-mathematical users adopting <code>module</code>.</p>",
        "id": 526771747,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751453057
    },
    {
        "content": "<p>Using <code>module</code> all through Mathlib is eventually a great idea. But we will need more tooling help to make this viable. It is at least as difficult a task as carefully deciding what should be irreducible, which we're already years behind on.</p>",
        "id": 526771865,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751453093
    },
    {
        "content": "<p>Aah the penny is dropping -- this is the solution to \"I want about 3 things from mathlib in my project but I really don't want to depend on mathlib because it's massive\".</p>",
        "id": 526771902,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751453101
    },
    {
        "content": "<p>I'm not sure if it's \"the solution\", but it does help.</p>",
        "id": 526771974,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751453122
    },
    {
        "content": "<p>A really important feature of the module system is that it allows you to approximate \"non-transitive imports\", i.e. to import a file, in a way that doesn't mean that downstream files can see.</p>",
        "id": 526772987,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751453445
    },
    {
        "content": "<p>Not sure if this is the place to ask, but I noticed that upgrading from 4.21.0 to 4.22.0-rc1/-rc2 seems to have broken my ‚áì notation: the following used to parse fine</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"s2\">\"‚áì\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚áì</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>but now requires parentheses around <code>(Nat.add n 0)</code>. (fwiw the error message is <code>unexpected token ':='; expected '‚Ü¶', '=&gt;'</code>, which doesn't make sense to me.) None of my other infix notations are broken, so I assume this notation is shadowed somewhere, but I'm not importing Mathlib or anything else, and not even setting <code>(priority := high)</code> (or any other big number, idk how high they go) works. Is there some way around this so that I don't have to add the parentheses in? Or should I file an issue?</p>",
        "id": 527084351,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1751583714
    },
    {
        "content": "<p>looks like we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.Do.Syntax.totalPostCond#doc\">docs#Std.Do.Syntax.totalPostCond</a> now, I have no idea what it's supposed to do</p>",
        "id": 527084775,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751584040
    },
    {
        "content": "<p>hmm. Okay so I do import <code>Lean.Elab.Tactic.Induction</code> somewhere for something else, which I suppose must import <code>Lean.Elab.Tactic.Do</code>. Why can't I override the notation? I also can't find any info about <code>builtin_term_parser</code> or <code>meta def</code> in the language ref or in the search</p>",
        "id": 527085782,
        "sender_full_name": "Jonathan Chan",
        "timestamp": 1751584944
    },
    {
        "content": "<p>You'd have to ping <span class=\"user-mention\" data-user-id=\"130195\">@Sebastian Graf</span> here; this is notation use by the new monadic verification framework.</p>\n<p>I think the answer may just be \"Lean core is claiming this notation; sorry\".</p>",
        "id": 527093683,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751592349
    },
    {
        "content": "<p>Is it possible to have notation that is only scoped to <code>do</code> blocks, or is that not how things work?</p>",
        "id": 527094237,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751592834
    },
    {
        "content": "<p>This notation appears in theorem statements using Hoare triples, not inside <code>do</code> blocks. But I'll leave this to Sebastian to answer.</p>",
        "id": 527096451,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751594910
    },
    {
        "content": "<p>Sorry about breaking your notation. I'll scope it to <code>Std.Do</code>, like a lot of other notation. Won't be fixed in time for 4.22.0 though.</p>",
        "id": 527106659,
        "sender_full_name": "Sebastian Graf",
        "timestamp": 1751604846
    },
    {
        "content": "<p>Mathlib (and upstream repositories) are now all on <code>v4.22.0-rc3</code>, which includes many <code>grind</code> and compiler bug fixes.</p>",
        "id": 527118512,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751612334
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/v8azOWn4WnFlBAGXvLOKm0DO/Screenshot_04-Jul_09-35-11_25073.png\">Screenshot_04-Jul_09-35-11_25073.png</a><br>\nThanks for fixing the issue with <code>@[grind ‚Üê=]</code>! Works like a charm now.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/v8azOWn4WnFlBAGXvLOKm0DO/Screenshot_04-Jul_09-35-11_25073.png\" title=\"Screenshot_04-Jul_09-35-11_25073.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1504x846\" src=\"/user_uploads/thumbnail/3121/v8azOWn4WnFlBAGXvLOKm0DO/Screenshot_04-Jul_09-35-11_25073.png/840x560.webp\"></a></div>",
        "id": 527123281,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1751614605
    },
    {
        "content": "<p>Thank you very much to the whole team! This release is so much packed with fantastic new features that having many release candidates isn‚Äôt surprising at all.</p>",
        "id": 527123866,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1751614874
    },
    {
        "content": "<p>Can I request that <a href=\"https://github.com/leanprover/lean4/pull/9181\">https://github.com/leanprover/lean4/pull/9181</a> make it into rc4, on the assumption such an RC is created?</p>",
        "id": 527143858,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751621839
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/526770595\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/526536774\">said</a>:</p>\n<blockquote>\n<p>What is \"the new module system\"? What even is a module?</p>\n</blockquote>\n<p>Sebastian has been working on documentation, it will be coming soon!</p>\n</blockquote>\n<p>The docs are now available at <a href=\"https://lean-reference-manual-review.netlify.app/The-Module-System/#module-system\">https://lean-reference-manual-review.netlify.app/The-Module-System/#module-system</a></p>",
        "id": 527272625,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751714281
    },
    {
        "content": "<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myInternalHelper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"n\">public</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">myInternalHelper</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n</blockquote>\n<p>What is the meaning of <code>private</code> in this code? I would think that since <code>myInternalHelper</code> is already public with private body (the default), this would do nothing</p>",
        "id": 527287385,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751728259
    },
    {
        "content": "<p>or maybe I'm misreading it and that <code>private</code> is not term operator like <code>unsafe</code> and that's just where you put the modifier for private fields (which I find a bit weird, considering that most other modifiers come before the identifier like <code>private toString := ...</code>)</p>",
        "id": 527287495,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751728383
    },
    {
        "content": "<p>Is</p>\n<blockquote>\n<p><code>abbrev</code> and <code>instance</code> always expose their body. For <code>instance</code>, individual field values can be marked <code>private</code>, which can be useful for programming purposes</p>\n</blockquote>\n<p>not clear? Private is only the default for <code>def</code></p>",
        "id": 527287570,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751728480
    },
    {
        "content": "<p>Making instance implementations private by default felt like too much of a gotcha as they often <em>must</em> participate in unfolding. Even when purely programming, people usually keep the code inline inside instances small, so not much is lost by exposing it by default.</p>",
        "id": 527287735,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751728644
    },
    {
        "content": "<p>(and speaking of \"inline\", inlining them during codegen is usually important as well, though that is not necessarily linked to language-leve visibility)</p>",
        "id": 527287759,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751728669
    },
    {
        "content": "<p>I understood that part and don't object to the design decision, I'm just wondering about the syntax <code>toString x := private myInternalHelper</code></p>",
        "id": 527287937,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751728871
    },
    {
        "content": "<p>which to my eye has a <code>private</code> in a strange place</p>",
        "id": 527287953,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751728888
    },
    {
        "content": "<p>Ah, I misread your comment. Note that <code>myInternalHelper</code> is private, which is the default in <code>module</code>s outside <code>public section</code>!</p>\n<p>As for <code>:= private</code>, it does not have any pendant to existing syntax but as it semantically belongs to the body and <code>private</code> in front of a field name already exists anyway with a quite different meaning, I believe it is the most sensible placement.</p>",
        "id": 527288224,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729196
    },
    {
        "content": "<blockquote>\n<p>The module system's <code>import all</code> is more powerful than <code>import</code> without the module system. It makes imported private definitions accessible directly by name, as if they were defined in the current module. Thus another use case of <code>import all</code> is to make declarations available that need to be used in multiple modules but should not leak outside the current library.</p>\n</blockquote>\n<p>It sounds like this is going to be an alternative to <code>open private</code>. Any advice on which one to use when? (Notwithstanding that <code>open private</code> is not officially supported by core, it has use cases that can't be done otherwise and I'm glad this is being recognized.)</p>",
        "id": 527288235,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729210
    },
    {
        "content": "<p>Do non-modules also have \"public and private scope\" since <code>private</code> is also legal in non-modules?</p>",
        "id": 527288273,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729244
    },
    {
        "content": "<p>in general, how do non-modules work with the module system?</p>",
        "id": 527288299,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729267
    },
    {
        "content": "<blockquote>\n<p>Non-<code>module</code>s can import <code>module</code>s and will ignore all module-system-specific annotations.</p>\n</blockquote>\n<p>So really the only relevant thing to them is <code>private</code> (or non-<code>public</code> outside public sections), which for them has the same meaning as before; no new checks outside <code>module</code> as demonstrated by 4.22.0 not breaking the world</p>",
        "id": 527288412,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729392
    },
    {
        "content": "<p>no I'm asking the other way around, what happens when a module imports a non-module</p>",
        "id": 527288475,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729465
    },
    {
        "content": "<p>They don't:</p>\n<blockquote>\n<p><code>module</code>s can only import other <code>module</code>s so adoption has to be done top-down</p>\n</blockquote>",
        "id": 527288519,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729523
    },
    {
        "content": "<p>oh so adoption is really forced then...</p>",
        "id": 527288534,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729537
    },
    {
        "content": "<p>There is no sound way around that</p>",
        "id": 527288559,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729567
    },
    {
        "content": "<p>?</p>",
        "id": 527288566,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729572
    },
    {
        "content": "<p>is it really impossible to have a default moduleish behavior for non-modules?</p>",
        "id": 527288588,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729592
    },
    {
        "content": "<p>or a combination of special scopes to make it possible to exactly represent non-module semantics from within the module system</p>",
        "id": 527288639,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729647
    },
    {
        "content": "<p><code>public @[expose] section</code> gets you close. After that most breakage comes from now-detected-ill-scoped use of <code>private</code> and necessary <code>meta import</code>s, which are comparatively small hurdles</p>",
        "id": 527288761,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729771
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527288519\">said</a>:</p>\n<blockquote>\n<p>They don't:</p>\n<blockquote>\n<p><code>module</code>s can only import other <code>module</code>s so adoption has to be done top-down</p>\n</blockquote>\n</blockquote>\n<p>I'd argue this should say \"bottom up\", but it's a matter of interpretation</p>",
        "id": 527288844,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751729885
    },
    {
        "content": "<p>Your leaves are at the top!?</p>",
        "id": 527288887,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751729928
    },
    {
        "content": "<p>sometimes my leaves are at the bottom too</p>",
        "id": 527288903,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751729943
    },
    {
        "content": "<p>but it's not starting from the leaves, it's starting from init</p>",
        "id": 527288907,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729945
    },
    {
        "content": "<p>we would not usually call <code>Init.Prelude</code> a leaf file</p>",
        "id": 527288942,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751729984
    },
    {
        "content": "<p>Now you got me confused as well for a moment, hah... edited</p>",
        "id": 527288979,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751730024
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527288887\">said</a>:</p>\n<blockquote>\n<p>Your leaves are at the top!?</p>\n</blockquote>\n<p><span aria-label=\"tree\" class=\"emoji emoji-1f333\" role=\"img\" title=\"tree\">:tree:</span>, <span aria-label=\"evergreen tree\" class=\"emoji emoji-1f332\" role=\"img\" title=\"evergreen tree\">:evergreen_tree:</span>, and <span aria-label=\"palm tree\" class=\"emoji emoji-1f334\" role=\"img\" title=\"palm tree\">:palm_tree:</span> suggest this is a reasonable interpretation :)</p>",
        "id": 527288983,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751730032
    },
    {
        "content": "<p>I hear \"downstream\" and \"upstream\" often so if a river flows downhill then the leaves are at the bottom</p>",
        "id": 527289037,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751730084
    },
    {
        "content": "<p>The <code>meta import</code> section is a bit incomplete, it doesn't cover all the ways one can combine meta and non-meta imports or declarations. IIRC there was a module doc (ha!) which covers this better</p>",
        "id": 527289071,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730124
    },
    {
        "content": "<p>Perhaps \"by upstream files before downstream ones\" would resolve my confusion. I assume this was quoted from the release notes / docs?</p>",
        "id": 527289078,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751730130
    },
    {
        "content": "<blockquote>\n<p>In this case, there is no readily available trace for debugging; consider using <code>@[expose] section</code>s generously on the closure of relevant modules.</p>\n</blockquote>\n<p>this is going to be fun when we port mathlib to the module system</p>",
        "id": 527289222,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730303
    },
    {
        "content": "<p>How many proof-by-reflection-like tactics are there in Mathlib? How many where the extent of reduction is not immediately clear?</p>",
        "id": 527289409,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751730521
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527288761\">said</a>:</p>\n<blockquote>\n<p><code>public @[expose] section</code> gets you close. After that most breakage comes from now-detected-ill-scoped use of <code>private</code> and necessary <code>meta import</code>s, which are comparatively small hurdles</p>\n</blockquote>\n<p>I think you misunderstand. I want a way to add a dependency which maybe I don't want to touch and which is not upgraded to the module system, without needing to debug it, while my own code is using the module system. So I want lean to apply the necessary shimming automatically when I import a non-module</p>",
        "id": 527289441,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730567
    },
    {
        "content": "<p>without this, we get into a bad situation where any library not on the module system is now unable to work with clients on the module system, and so clients may decide against upgrading in order to use a dependency, slowing adoption</p>",
        "id": 527289521,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527289222\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>In this case, there is no readily available trace for debugging; consider using <code>@[expose] section</code>s generously on the closure of relevant modules.</p>\n</blockquote>\n<p>this is going to be fun when we port mathlib to the module system</p>\n</blockquote>\n<p>But in general, yes, we'll have to see what becomes an issue and what not. There should be various ways we can support problematic porting parts via changes in core.</p>",
        "id": 527289544,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751730702
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527289409\">said</a>:</p>\n<blockquote>\n<p>How many proof-by-reflection-like tactics are there in Mathlib? How many where the extent of reduction is not immediately clear?</p>\n</blockquote>\n<p>main source of this kind of reduction is proofs by <code>decide</code> and <code>rfl</code></p>",
        "id": 527289576,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730744
    },
    {
        "content": "<p>and lots of code in mathlib is implicated, in principle anything that is not <code>noncomputable</code></p>",
        "id": 527289584,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730763
    },
    {
        "content": "<p>in general I expect mathlib will almost always want to <code>@[expose]</code></p>",
        "id": 527289632,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730820
    },
    {
        "content": "<p>we might even want to make it a project level default if possible</p>",
        "id": 527289655,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730844
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/527289409\">said</a>:</p>\n<blockquote>\n<p>How many proof-by-reflection-like tactics are there in Mathlib? How many where the extent of reduction is not immediately clear?</p>\n</blockquote>\n<p><code>git grep -o \"by decide\" Mathlib/* | find /c /v \"\"</code> gives me 400</p>",
        "id": 527289683,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751730891
    },
    {
        "content": "<p>those are the uses, you have to look at the things those uses reduce</p>",
        "id": 527289699,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730914
    },
    {
        "content": "<p>Both these tactics reduce in the elaborator first, so the specific issue quoted does not apply. That controlling unfolding will need annotations and thinking about them is still true of course.</p>",
        "id": 527289713,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751730925
    },
    {
        "content": "<p>I assume the error will still happen, but you are saying the message is better?</p>",
        "id": 527289739,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751730963
    },
    {
        "content": "<p>I don't think mathlib ever does proofs by reduction that aren't elaborator checked</p>",
        "id": 527289785,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751731019
    },
    {
        "content": "<p>You can use traces and we have better options to improve the message, yes. <code>decide</code> already does a lot of reduction debugging.</p>",
        "id": 527289838,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751731093
    },
    {
        "content": "<p>something which might be nice is if <code>#check</code> or <code>#print</code> displays all these properties of declarations. similarly, maybe <code>#where</code> can show what import is what kind, what kind of section the command is in, etc? i imagine that might help with debugging?</p>",
        "id": 527289953,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1751731219
    },
    {
        "content": "<p>Certainly! <code>#print</code> already shows most of these. For keeping track of sections I recommend the sticky scroll feature in VS Code but extending <code>#where</code> makes sense as well.</p>",
        "id": 527290304,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1751731558
    },
    {
        "content": "<p>5 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/unused.20simp.20argument.20linter.20feedback/with/528456054\">#general &gt; unused simp argument linter feedback</a> by <span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span>.</p>",
        "id": 528456080,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752324386
    },
    {
        "content": "<p>I just noticed that the speedcenter graph says there is a noticeable performance drop in v4.22.0; is it easy to locate the exact numbers for that commit? (edit: <a href=\"https://speed.lean-lang.org/mathlib4/run-detail/d4940bc7-6be5-4345-b3ff-515909855d8b\">here</a>, via <a class=\"message-link\" href=\"/#narrow/channel/116290-rss/topic/Benchmark.20results.20for.20mathlib4/near/526511213\">#rss &gt; Benchmark results for mathlib4 @ üí¨</a> )</p>",
        "id": 528548820,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752432075
    },
    {
        "content": "<p>Is the performance drop due to switching to the new compiler and reenabling compilation of a lot of previously noncomputable stuff?</p>",
        "id": 528594312,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1752475333
    },
    {
        "content": "<p>The build time of my repository has increased from <a href=\"https://github.com/astrainfinita/Algorithm/actions/runs/16482954870/job/46601622915\">36s</a> to <a href=\"https://github.com/astrainfinita/Algorithm/actions/runs/16483152862/job/46602246720\">56s</a>.</p>\n<p>upd: It turned out that the reason was that I forgot to update a <code>get_elem_tactic_trivial</code> to <code>get_elem_tactic_extensible</code> <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span> .</p>",
        "id": 532514925,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1754194698
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113486-announce/topic/v4.2E22.2E0/near/534404161\">said</a>:</p>\n<blockquote>\n<ul>\n<li>there is a¬†<code>v4.21.0</code>¬†tag</li>\n</ul>\n</blockquote>\n<p>This is a typo, right?</p>",
        "id": 534418531,
        "sender_full_name": "Harald Husum",
        "timestamp": 1755157073
    },
    {
        "content": "<p>Some more <code>grind</code> love: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25836/files/8fe8fdcdb90c2ee6b593e40e134a3e32f9d0006a..44ab3f6559fd46c5c82ba041bebbd33fc9adeff3\">https://github.com/leanprover-community/mathlib4/pull/25836/files/8fe8fdcdb90c2ee6b593e40e134a3e32f9d0006a..44ab3f6559fd46c5c82ba041bebbd33fc9adeff3</a></p>",
        "id": 535666504,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1755863381
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Ya√´l Dillies</span> <a href=\"#narrow/channel/113488-general/topic/v4.2E22.2E0-rc2/near/535666504\">said</a>:</p>\n<blockquote>\n<p>Some more <code>grind</code> love: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25836/files/8fe8fdcdb90c2ee6b593e40e134a3e32f9d0006a..44ab3f6559fd46c5c82ba041bebbd33fc9adeff3\">https://github.com/leanprover-community/mathlib4/pull/25836/files/8fe8fdcdb90c2ee6b593e40e134a3e32f9d0006a..44ab3f6559fd46c5c82ba041bebbd33fc9adeff3</a></p>\n</blockquote>\n<p>We've also had some PRs this week to use <code>grind</code> in CSLib, such as <a href=\"https://github.com/leanprover/cslib/pull/35\">cslib#35</a>. It's been great for simplifying proofs.</p>",
        "id": 535674597,
        "sender_full_name": "Chris Henson",
        "timestamp": 1755866467
    },
    {
        "content": "<p>The better handling of dots in <a href=\"https://github.com/leanprover/lean4/pull/8784\">lean#8784</a> is very nice, and means that we can drop the parentheses in <code>‚à´ x in (0)..a, f x</code> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/29017\">#29017</a>)</p>",
        "id": 536387891,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1756289540
    }
]