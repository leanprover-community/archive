[
    {
        "content": "<p>For example, i would like to write a <code>log</code> function that accepts only positive Float as a base.</p>",
        "id": 490023968,
        "sender_full_name": "Mykhailo Dm",
        "timestamp": 1734632297
    },
    {
        "content": "<p>You can specify the domain of a function to be any type you want. But note that if <code>f</code> it is defined on positive real numbers and <code>x</code> is a real number that you know to be positive, then <code>f x</code> does not make sense (there are ways to make it work in a certain sense, but it is annoying). The usual solution is to define <code>f x</code> for any <code>x</code>, using a junk value in the non positive case.</p>",
        "id": 490025517,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1734632939
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">log</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Lean complains here that:</span>\n\n<span class=\"cm\">unused variable `hx`</span>\n<span class=\"cm\">note: this linter can be disabled with `set_option linter.unusedVariables false`-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">log</span>\n</code></pre></div>",
        "id": 490025815,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734633044
    },
    {
        "content": "<p>It's probably a good idea to read this <a href=\"https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/\">https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/</a></p>",
        "id": 490025850,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1734633058
    },
    {
        "content": "<p>But yes, I agree with Riccardo, you probably just want <code>Float.log</code> (espcially because you can't prove anything about <code>Float</code> since it is <code>opaque</code>.</p>",
        "id": 490025945,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1734633092
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20make.20a.20function.20that.20accepts.20only.20positive.20Float.3F/near/490025815\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">log</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Lean complains here that:</span>\n\n<span class=\"cm\">unused variable `hx`</span>\n<span class=\"cm\">note: this linter can be disabled with `set_option linter.unusedVariables false`-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">log</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Trying to <code>#eval</code> any of these (<code>#eval Float.log' (10.)</code>) with both positive and negative values gives me an errors. Am I doing something wrong here or i have to call them somehow a bit in a special way?</p>",
        "id": 490028019,
        "sender_full_name": "Mykhailo Dm",
        "timestamp": 1734634000
    },
    {
        "content": "<p>These expect a proof that <code>10</code> is positive. That is, you need to put something in place of <code>sorry</code> here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log''</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>However, like Jireh said, Float is opaque, so this isn't something that can be proved, as far as I know.</p>",
        "id": 490028834,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734634325
    },
    {
        "content": "<p>If you are OK with trusting the Lean compiler as part of the trusted code base, you can use <code>native_decide</code> to calculate that it is in bounds:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log''</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 490029151,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734634456
    },
    {
        "content": "<p><code>native_decide</code> uses the runtime characteristics of Float rather than any theoretical specification</p>",
        "id": 490029232,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734634496
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20make.20a.20function.20that.20accepts.20only.20positive.20Float.3F/near/490029151\">said</a>:</p>\n<blockquote>\n<p>If you are OK with trusting the Lean compiler as part of the trusted code base, you can use <code>native_decide</code> to calculate that it is in bounds:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Float</span><span class=\"bp\">.</span><span class=\"n\">log''</span><span class=\"w\"> </span><span class=\"mf\">10.0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Yay, it works, thanks!! But this isn't \"compile time\", right?</p>",
        "id": 490032000,
        "sender_full_name": "Mykhailo Dm",
        "timestamp": 1734635530
    },
    {
        "content": "<p><code>by native_decide</code> is a compile-time check. It only works for compile-time constants. (More specifically, it is \"elaboration time\" in Lean terminology)</p>\n<p>It's possible to do run-time checking too, using a different method (<code>if h : ... then ... else ...</code> syntax)</p>",
        "id": 490033571,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734636153
    }
]