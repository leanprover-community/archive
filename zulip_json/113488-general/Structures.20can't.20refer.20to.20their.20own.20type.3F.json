[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">children</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'Node'</span>\n</code></pre></div>\n<p>There are many scenarios like this - and where you don't want to use inductive, because there are dozens of fields and you want it to count as a type and you are using it as a base structure for inheritance etc..</p>\n<p>Is there no way to have this working? I thought perhaps the <code>mutual</code> keyword, but that seems to only work for inductives.</p>",
        "id": 574642007,
        "sender_full_name": "Marvin",
        "timestamp": 1771470263
    },
    {
        "content": "<p>Works for me in the playground, where are you seeing this error?</p>",
        "id": 574644623,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771472175
    },
    {
        "content": "<p>FWIW I was going to point out that this might be related to <a href=\"https://counterexamples.org/currys-paradox.html\">Curry's paradox</a>, but then the error didn't reproduce</p>",
        "id": 574644673,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771472220
    },
    {
        "content": "<p>see <a href=\"https://github.com/leanprover/lean4/pull/2512\">lean4#2512</a></p>",
        "id": 574645394,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1771472839
    },
    {
        "content": "<p>You want an inductive type that isn't an inductive? Huh?</p>",
        "id": 574645949,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1771473354
    },
    {
        "content": "<p>It's perhaps worth noting that structures in Lean are just a special case of inductive types, namely, those with a single constructor. So whatever you think you're avoiding, you really are not.</p>",
        "id": 574646077,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1771473454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Structures.20can't.20refer.20to.20their.20own.20type.3F/near/574645949\">said</a>:</p>\n<blockquote>\n<p>You want an inductive type that isn't an inductive? Huh?</p>\n</blockquote>\n<p>I want a Record where one of the fields is a list of more of its kind. I am trying to create a faithful binding for javascript DOM.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nodeName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Node</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">innerHTML</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Element</span>\n</code></pre></div>",
        "id": 574648122,
        "sender_full_name": "Marvin",
        "timestamp": 1771475335
    },
    {
        "content": "<p>Your code runs fine on latest Lean. Are you on a very old version of Lean?</p>",
        "id": 574648449,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1771475499
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/113488-general/topic/Structures.20can't.20refer.20to.20their.20own.20type.3F/near/574648449\">said</a>:</p>\n<blockquote>\n<p>Your code runs fine on latest Lean. Are you on a very old version of Lean?</p>\n</blockquote>\n<p>Yes, 4.6.1 as that has a web assembly build. Looking online now, im not finding any recent versions with this</p>",
        "id": 574653954,
        "sender_full_name": "Marvin",
        "timestamp": 1771479909
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1027767\">Marvin</span> <a href=\"#narrow/channel/113488-general/topic/Structures.20can't.20refer.20to.20their.20own.20type.3F/near/574653954\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/113488-general/topic/Structures.20can't.20refer.20to.20their.20own.20type.3F/near/574648449\">said</a>:</p>\n<blockquote>\n<p>Your code runs fine on latest Lean. Are you on a very old version of Lean?</p>\n</blockquote>\n<p>Yes, 4.6.1 as that has a web assembly build. Looking online now, im not finding any recent versions with this</p>\n</blockquote>\n<p>Does this work? It's essentially the same thing.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Node</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Node</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"bp\">.</span><span class=\"n\">children</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">l</span>\n</code></pre></div>",
        "id": 574811650,
        "sender_full_name": "James E Hanson",
        "timestamp": 1771530913
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1027767\">Marvin</span> <a href=\"#narrow/channel/113488-general/topic/Structures.20can't.20refer.20to.20their.20own.20type.3F/near/574648122\">said</a>:</p>\n<blockquote>\n<p>I want a Record where one of the fields is a list of more of its kind. I am trying to create a faithful binding for javascript DOM.</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nodeName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Node</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">innerHTML</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Element</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Others have already pointed out that Lean does have recursive structures (they've existed since Lean 4.14 I believe; they work in <code>mutual</code> blocks too).</p>\n<p>However, even on a newer version this particular set of structures won't do what you intend: when you <code>extend</code>, it will still be a <code>childNodes : List Node</code> field. Presumably you want this to be a <code>childNodes : List HTMLElement</code> field in <code>HTMLElement</code>?</p>\n<p>You have to do something like this to make the node type parametric, then use an auxiliary type to \"close the loop\":</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nodeName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">N</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Element'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node'</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">innerHTML</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HTMLElement'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Element'</span><span class=\"w\"> </span><span class=\"n\">N</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">el</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HTMLElement'</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This should work even in older Lean versions; this is the pattern Lean core used before recursive <code>structure</code>s. If this were 4.14 onward, you'd be able to use a <code>structure</code> instead of <code>inductive</code>.</p>\n<p>I should also warn you that <code>extends</code> isn't for object-oriented-style polymorphism for <code>structure</code>s. There are some limited facilities for auto-projecting to parent <code>structure</code>s for resolving dot notation. Maybe this <code>N</code> parameter will be enough for you, but possibly you'll need some typeclasses too, depending on what kind of polymorphism you're wanting to achieve.</p>\n<p>If you ever go to a more recent Lean, it's worth knowing you can do recursion in the <code>extends</code> clause. This means dot notation on <code>HTMLElement</code> can resolve in the <code>Node'</code>, <code>Element'</code>, and <code>HTMLElement'</code> namespaces.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nodeName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">N</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Element'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node'</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">innerHTML</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HTMLElement'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Element'</span><span class=\"w\"> </span><span class=\"n\">N</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">HTMLElement'</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span>\n</code></pre></div>\n<p>(<span class=\"user-mention\" data-user-id=\"904624\">@James E Hanson</span> Defining an <code>inductive</code> might be <em>essentially</em> the same thing, but practically you lose out on <code>{...}</code> notation and <code>extends</code>.)</p>",
        "id": 574814181,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771531967
    },
    {
        "content": "<p>Is there no way to say</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>Basically, not just \"some Type\",  but \"some Type extending Node\"<br>\nin Scala you can do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"o\">[</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"o\">](</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"o\">[</span><span class=\"n\">N</span><span class=\"o\">])</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"o\">[</span><span class=\"n\">Element</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 574864043,
        "sender_full_name": "Marvin",
        "timestamp": 1771561200
    },
    {
        "content": "<p>No, not with <code>structure</code>. There's no subtyping or inheritance.</p>\n<p>It's possible to use <code>class</code>es to do some kinds of inheritance though, but you need to define classes and structures in parallel to simulate inheritance. The idea is you'd have a <code>NodeClass</code> class that defines what you need to implement for something to be a <code>Node</code>, then you make implementations of this class for everything in the <code>Node</code> hierarchy.</p>",
        "id": 574864609,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771561662
    },
    {
        "content": "<p>(A <code>class</code> in Lean isn't like <code>class</code> in Scala. You can think of Lean's as being <em>just</em> the vtable, minus the object, if you want.)</p>",
        "id": 574864682,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771561729
    },
    {
        "content": "<p>Here's an example of just the <code>class</code> part.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nodeName</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">N</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">innerHTML</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HTMLElement</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">numChildNodes</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Node</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">childNodes</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span>\n</code></pre></div>",
        "id": 574865136,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771561913
    },
    {
        "content": "<p>You'd then need to add some concrete implementation to actually use it, but the point is that <code>numChildNodes</code> will work for a type where you've implemented an <code>HTMLElement</code> instance.</p>",
        "id": 574865238,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771561951
    },
    {
        "content": "<p>I guess Java interfaces are a reasonable comparison point.</p>",
        "id": 574865257,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1771561961
    },
    {
        "content": "<p>Rust's instances are basically one to one</p>",
        "id": 574900127,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1771580418
    }
]