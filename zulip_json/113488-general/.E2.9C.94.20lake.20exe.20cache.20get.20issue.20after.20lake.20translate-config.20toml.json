[
    {
        "content": "<p>I'm trying to update my local (forked) mathlib and ran into issues with <code>lake exe cache get</code>.</p>\n<p>It was originally giving me this message: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"n\">Using</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">upstream</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n<span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">6943</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">6943</span><span class=\"bp\">/</span><span class=\"mi\">6943</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">success</span><span class=\"o\">)</span>\n<span class=\"n\">Warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">were</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"bp\">.</span>\n<span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">usually</span><span class=\"w\"> </span><span class=\"n\">means</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">diverged</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">upstream</span><span class=\"bp\">.</span>\n<span class=\"n\">If</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">commits</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CI</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">oleans</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">they</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"w\"> </span><span class=\"n\">later</span><span class=\"bp\">.</span>\n<span class=\"n\">Alternatively</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">pushed</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">commits</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">CI</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"bp\">-</span><span class=\"n\">way</span><span class=\"w\"> </span><span class=\"n\">through</span><span class=\"w\"> </span><span class=\"n\">building</span><span class=\"bp\">.</span>\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">decompress</span>\n</code></pre></div>\n<p>I found <a href=\"#narrow/channel/113488-general/topic/Updating.20to.204.2E15.2E0/near/492174105\">this thread</a> and ran <code>lake translate-config toml</code>. The <code>lakefile.toml</code> file generates alright, but then when I run <code>lake exe cache get</code> again it simply doesn't recognize it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">\\</span><span class=\"n\">mathlib4</span><span class=\"bp\">\\</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n</code></pre></div>\n<p>Any suggestions on how to fix this?</p>",
        "id": 528354187,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752244924
    },
    {
        "content": "<p>current lake version:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n\n<span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">5.0</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">src</span><span class=\"bp\">+</span><span class=\"mi\">7</span><span class=\"n\">c3ca70</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.22</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc3</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and running <code>lake update</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">update</span>\n\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span>\n</code></pre></div>",
        "id": 528354463,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752245016
    },
    {
        "content": "<p>here's the full <code>lakefile.toml</code> file if that helps:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>lakefile.toml</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>name = \"mathlib\"<br>\ntestDriver = \"MathlibTest\"<br>\ndefaultTargets = [\"Mathlib\"]</p>\n<p>[[require]]<br>\nname = \"batteries\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#main\"</p>\n<p>[[require]]<br>\nname = \"Qq\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#master\"</p>\n<p>[[require]]<br>\nname = \"aesop\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#master\"</p>\n<p>[[require]]<br>\nname = \"proofwidgets\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#v0.0.67\"<br>\noptions = {errorOnBuild = \"ProofWidgets not up-to-date. Please run <code>lake exe cache get</code> to fetch the latest ProofWidgets. If this does not work, report your issue on the Lean Zulip.\"}</p>\n<p>[[require]]<br>\nname = \"importGraph\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#main\"</p>\n<p>[[require]]<br>\nname = \"LeanSearchClient\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#main\"</p>\n<p>[[require]]<br>\nname = \"plausible\"<br>\nscope = \"leanprover-community\"<br>\nversion = \"git#main\"</p>\n<p>[[lean_lib]]<br>\nname = \"Mathlib\"<br>\nleanOptions = {pp.unicode.fun = true, autoImplicit = false, maxSynthPendingDepth = 3, weak.linter.mathlibStandardSet = true, weak.linter.style.longFile = 1500}</p>\n<p>[[lean_lib]]<br>\nname = \"Cache\"</p>\n<p>[[lean_lib]]<br>\nname = \"LongestPole\"</p>\n<p>[[lean_lib]]<br>\nname = \"MathlibTest\"<br>\nglobs = [\"MathlibTest.+\"]</p>\n<p>[[lean_lib]]<br>\nname = \"Archive\"<br>\nleanOptions = {pp.unicode.fun = true, autoImplicit = false, maxSynthPendingDepth = 3, weak.linter.mathlibStandardSet = true, weak.linter.style.longFile = 1500}</p>\n<p>[[lean_lib]]<br>\nname = \"Counterexamples\"<br>\nleanOptions = {pp.unicode.fun = true, autoImplicit = false, maxSynthPendingDepth = 3, weak.linter.mathlibStandardSet = true, weak.linter.style.longFile = 1500}</p>\n<p>[[lean_lib]]<br>\nname = \"docs\"</p>\n<p>[[lean_exe]]<br>\nname = \"autolabel\"<br>\nsrcDir = \"scripts\"</p>\n<p>[[lean_exe]]<br>\nname = \"cache\"<br>\nroot = \"Cache.Main\"</p>\n<p>[[lean_exe]]<br>\nname = \"«check-yaml»\"<br>\nsrcDir = \"scripts\"<br>\nsupportInterpreter = true</p>\n<p>[[lean_exe]]<br>\nname = \"mk_all\"<br>\nsrcDir = \"scripts\"<br>\nsupportInterpreter = true<br>\nweakLinkArgs = [\"-lLake\"]</p>\n<p>[[lean_exe]]<br>\nname = \"shake\"<br>\nroot = \"Shake.Main\"<br>\nsupportInterpreter = true</p>\n<p>[[lean_exe]]<br>\nname = \"«lint-style»\"<br>\nsrcDir = \"scripts\"<br>\nsupportInterpreter = true<br>\nweakLinkArgs = [\"-lLake\"]</p>\n<p>[[lean_exe]]<br>\nname = \"pole\"<br>\nroot = \"LongestPole.Main\"<br>\nsupportInterpreter = true<br>\nweakLinkArgs = [\"-lLake\"]</p>\n<p>[[lean_exe]]<br>\nname = \"unused\"<br>\nroot = \"LongestPole.Unused\"<br>\nsupportInterpreter = true<br>\nweakLinkArgs = [\"-lLake\"]</p>\n<p>[[lean_exe]]<br>\nname = \"mathlib_test_executable\"<br>\nroot = \"MathlibTest.MathlibTestExecutable\"</p>\n</div></div>",
        "id": 528355212,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752245248
    },
    {
        "content": "<p>You should never be running lake update and you should never be changing the toml; that's the job of the mathlib maintainers.</p>",
        "id": 528364046,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752248065
    },
    {
        "content": "<p>The thread you linked to is all about how to bump mathlib in a project which depends on mathlib, not what to do with mathlib itself. The people asking questions in that thread are maintainers of a library downstream from mathlib.</p>",
        "id": 528364208,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752248140
    },
    {
        "content": "<p>What is the output of <code>git status</code> in your forked repo?</p>",
        "id": 528364367,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752248200
    },
    {
        "content": "<p>I think I figured it out, I did a <code>git reset --hard upstream/master</code> and everything seem to work after restarting vscode.</p>",
        "id": 528366094,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752248831
    },
    {
        "content": "<p>but thank you for the explanation, that makes things a lot clearer :)</p>",
        "id": 528366133,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752248849
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"890057\">ZhiKai Pong</span> has marked this topic as resolved.</p>",
        "id": 528366143,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752248853
    }
]