[
    {
        "content": "<p>Hello folks,</p>\n<p>I have a question about how to get started with<br>\ncalculational proofs of laws of my <code>PSBP</code> library.</p>\n<p>Below is minimal documented code that illustrates<br>\nwhat I want to do.</p>\n<p>I know that there are tactics like <code>simp</code> to let<br>\n<code>Lean</code> do the details, but I first want to write <br>\ncalculational proofs myself.</p>\n<p>All comments are welcome. </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code listing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c\">/-</span>\n\n<span class=\"cm\">two type classes specifying that</span>\n\n<span class=\"cm\">functions can, somehow, be used as programs</span>\n<span class=\"cm\">programs can be composed sequentially</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Functional</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Sequential</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span>\n\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">andThen</span><span class=\"o\">)</span>\n\n<span class=\"kd\">infixl</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;=&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">andThen</span>\n\n<span class=\"c\">/-</span>\n\n<span class=\"cm\">two type class instances implementing the</span>\n<span class=\"cm\">specifications above as computation valued functions</span>\n\n<span class=\"cm\">functions can, somehow, be used as programs</span>\n<span class=\"cm\">programs can be composed sequentially</span>\n\n<span class=\"cm\">note the program composition order is</span>\n<span class=\"cm\">first left and then right,</span>\n<span class=\"cm\">while the function composition order is</span>\n<span class=\"cm\">right left and then left</span>\n\n<span class=\"cm\">... just a choice ...</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toComputationValuedFunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Functional</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Sequential</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">andThen</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">αfcβ</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">βfcγ</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">αfcβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"n\">βfcγ</span><span class=\"o\">⟩</span>\n\n<span class=\"c\">/-</span>\n\n<span class=\"cm\">type class specifying</span>\n<span class=\"cm\">the equational relationship between</span>\n<span class=\"cm\">sequential function composition and</span>\n<span class=\"cm\">sequential program composition</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">LawfulFunctional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"n\">where</span>\n\n<span class=\"w\">  </span><span class=\"n\">asProgram_sequential</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">program</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span>\n\n<span class=\"cm\">the code below illustrates</span>\n<span class=\"cm\">the calculational proof steps</span>\n<span class=\"cm\">of a theorem proving</span>\n<span class=\"cm\">law asProgram_sequential of LawfulFunctional</span>\n<span class=\"cm\">using pure_bind law of LawfulMonad</span>\n<span class=\"cm\">as a</span>\n\n<span class=\"cm\">I simply put the steps in a list</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">asList</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span>\n<span class=\"w\">    </span><span class=\"c1\">-- definition asProgram</span>\n<span class=\"w\">    </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">⟩</span>\n<span class=\"w\">    </span><span class=\"c1\">-- definition &gt;=&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">⟩</span>\n<span class=\"w\">    </span><span class=\"c1\">-- pure_bind law of LawfulMonad</span>\n<span class=\"w\">    </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)⟩</span>\n<span class=\"w\">    </span><span class=\"c1\">-- definition ∘</span>\n<span class=\"w\">    </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">⟩</span>\n<span class=\"w\">    </span><span class=\"c1\">-- definition asProgram</span>\n<span class=\"w\">    </span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">asProgram_sequential_theorem_1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">   </span><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"w\">   </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"w\">   </span><span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"w\">   </span><span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"w\">   </span><span class=\"o\">[</span><span class=\"n\">LawfulFunctional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"w\">   </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">          </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">          </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">        </span><span class=\"c1\">-- calc</span>\n<span class=\"w\">        </span><span class=\"c1\">--   left = (⟨λ α =&gt; pure $ αfβ α⟩ &gt;=&gt; ⟨λ β =&gt; pure $ βfγ β⟩) := rfl</span>\n<span class=\"w\">        </span><span class=\"c1\">--   _    = ⟨λ α =&gt; (pure $ αfβ α) &gt;&gt;= λ β =&gt; pure $ βfγ β⟩   := rfl</span>\n<span class=\"w\">        </span><span class=\"c1\">--   _    = ⟨λ α =&gt; pure $ βfγ (αfβ α)⟩                       := pure_bind</span>\n<span class=\"w\">        </span><span class=\"c1\">--   _    = ⟨λ α =&gt; pure $ ((βfγ ∘ αfβ) α)⟩                   := rfl</span>\n<span class=\"w\">        </span><span class=\"c1\">--   _    = right                                             := rfl</span>\n</code></pre></div>\n</div></div>",
        "id": 533640747,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754820301
    },
    {
        "content": "<p>The proof would like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">asProgram_sequential_theorem_1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LawfulMonad</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"n\">βfγ</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">asProgram</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">&gt;=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"bp\">⟩</span><span class=\"w\">   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">αfβ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"w\">                       </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">funext</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure_bind</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟨λ</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">βfγ</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">αfβ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"w\">                   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\">    </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\">                                             </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Note:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Applicative</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">]</span>\n<span class=\"o\">[</span><span class=\"n\">Functional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n<span class=\"o\">[</span><span class=\"n\">Sequential</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FromComputationValuedFunction</span><span class=\"w\"> </span><span class=\"n\">computation</span><span class=\"o\">)]</span>\n</code></pre></div>\n<p>can already be determined from <code>Monad computation</code> so you basically declare 3 instances that might be completely different from the implementations above (so you'd have to prove \"this works for any exotic <code>Functional (FromComputationValuedFunction computation)</code> instance\" which would be false).<br>\nAlso, you need to specify <code>[LawfulMonad computation]</code> to get <code>pure_bind</code>. The actual application of <code>pure_bind</code> gets a bit more complicated then but you can basically use <code>congrArg</code> to go inside of the <code>⟨...⟩</code> and <code>funext</code> to go into the <code>λ α =&gt; ...</code></p>",
        "id": 533641634,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754821233
    },
    {
        "content": "<p>Robin, thanks for the reply, gonna try it out asap (gonna first do some race bycicle cycling (good weather)). Of course, already knew that <code>Monad computation</code> implied <code>Applicative computation</code>. Without any <code>[...]</code>'s,  <code>Lean</code> suggested me <code>Functional (FromComputationValuedFunction computation)</code> and I simply forgot to remove  them afterwards, sorry.</p>",
        "id": 533643706,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754823424
    },
    {
        "content": "<p>Robin,  about <code>congrArg</code>,  and <code>funext</code>, ok, that was the thing I was wondering how to do. I knew about <code>congrArg</code> (but <code>&gt;=&gt;</code> is an operation with 2 arguments, not 1, therefore the extra underscore <code>_</code> I suppose ), but I did not know about <code>funext</code> (and how to glue everything together). </p>\n<p>Thanks so much, now I can start with all the laws of my <code>PSBP</code> library!</p>\n<p>(but first some <span aria-label=\"cyclist\" class=\"emoji emoji-1f6b4\" role=\"img\" title=\"cyclist\">:cyclist:</span>)</p>\n<p>Cool</p>",
        "id": 533644140,
        "sender_full_name": "Luc Duponcheel",
        "timestamp": 1754823906
    },
    {
        "content": "<p>To be precise, it's <code>congrArg FromComputationValuedFunction.mk _</code> here which turns <code>a = b</code> into <code>FromComputationValuedFunction.mk a = FromComputationValuedFunction.mk b</code> (i.e. <code>⟨a⟩ = ⟨b⟩</code>) and then <code>funext</code> turns <code>∀ a, x[a] = y[a]</code> into <code>(λ a, x[a]) = λ a, y[a]</code></p>",
        "id": 533644742,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754824606
    }
]