[
    {
        "content": "<p>I encountered the following weird issue on <a href=\"https://live.lean-lang.org\">https://live.lean-lang.org</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"c1\">-- can't synthesize</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n</code></pre></div>\n<p>This should follow from <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Normed/Field/Lemmas.html#NormedDivisionRing.to_continuousInv%E2%82%80\">NormedDivisionRing.to_continuousInv₀</a> right?</p>",
        "id": 575022863,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1771619172
    },
    {
        "content": "<p>Yes, it kind of does: here's an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> for you</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">NormedDivisionRing</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: failed to synthesize</span>\n<span class=\"sd\">  ContinuousInv₀ ℝ</span>\n\n<span class=\"sd\">Hint: Additional diagnostic information may be available using the `set_option diagnostics true` command.</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">NormedDivisionRing</span><span class=\"bp\">.</span><span class=\"n\">to_continuousInv₀</span>\n</code></pre></div>",
        "id": 575023766,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1771619602
    },
    {
        "content": "<p>(I'm not sure why this is, and don't have time to debug this right now.)</p>",
        "id": 575023797,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1771619620
    },
    {
        "content": "<p><code>set_option backward.isDefEq.respectTransparency false</code> causes <code>#synth ContinuousInv₀ ℝ</code> to succeed; here's the relevant synthInstance trace:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">❌️</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">▼</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">▶</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">❌️</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">IsTopologicalDivisionRing</span><span class=\"bp\">.</span><span class=\"n\">toContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">▶</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">❌️</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">NormedDivisionRing</span><span class=\"bp\">.</span><span class=\"n\">to_continuousInv₀</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">▼</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">tryResolve</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">❌️</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">≟</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">5</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">❌️</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">IsStrictOrderedRing</span><span class=\"bp\">.</span><span class=\"n\">toContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">▶</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">not</span><span class=\"bp\">-</span><span class=\"n\">available</span><span class=\"bp\">&gt;</span>\n</code></pre></div>",
        "id": 575024575,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1771619984
    },
    {
        "content": "<p>That was going to be my guess. It's still set by default in mathlib, right?</p>",
        "id": 575024699,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771620040
    },
    {
        "content": "<p>Perhaps we should set it by default on the web editor too</p>",
        "id": 575024715,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771620049
    },
    {
        "content": "<p>(Also, I should note that the most-nested <code>≟</code> failure in full is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">instZero</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">instInv</span><span class=\"w\"> </span><span class=\"n\">PseudoMetricSpace</span><span class=\"bp\">.</span><span class=\"n\">toUniformSpace</span><span class=\"bp\">.</span><span class=\"n\">toTopologicalSpace</span>\n<span class=\"w\">  </span><span class=\"bp\">≟</span>\n<span class=\"bp\">@</span><span class=\"n\">ContinuousInv₀</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">toNonAssocRing</span><span class=\"bp\">.</span><span class=\"n\">toNonUnitalNonAssocSemiring</span><span class=\"bp\">.</span><span class=\"n\">toMulZeroClass</span><span class=\"bp\">.</span><span class=\"n\">toZero</span>\n<span class=\"w\">  </span><span class=\"n\">DivisionMonoid</span><span class=\"bp\">.</span><span class=\"n\">toDivInvOneMonoid</span><span class=\"bp\">.</span><span class=\"n\">toInvOneClass</span><span class=\"bp\">.</span><span class=\"n\">toInv</span><span class=\"w\"> </span><span class=\"n\">PseudoMetricSpace</span><span class=\"bp\">.</span><span class=\"n\">toUniformSpace</span><span class=\"bp\">.</span><span class=\"n\">toTopologicalSpace</span>\n</code></pre></div>\n<p>I would guess these instances would be defeq if we filled the mvar, but I'm not familiar with the hierarchy here. And also am too busy to debug further <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span>)</p>",
        "id": 575025581,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1771620428
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113488-general/topic/can't.20synthesize.20ContinuousInv.E2.82.80.20.E2.84.9D/near/575024715\">said</a>:</p>\n<blockquote>\n<p>Perhaps we should set it by default on the web editor too</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/lean4web/issues/89\">https://github.com/leanprover-community/lean4web/issues/89</a> could be relevant (but won't help new members)</p>",
        "id": 575031336,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1771623208
    },
    {
        "content": "<p>Or maybe a more global fix; release a Lean 4.28.0rc2 with this option set to <code>false</code> by default, since this kind of thing is just broken for everyone</p>",
        "id": 575046864,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771633032
    },
    {
        "content": "<p>I would hope for rc2 to actually solve the issues with <code>respectTransparency</code>, not just hide them!</p>",
        "id": 575064187,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1771653842
    },
    {
        "content": "<p>I agree, but an rc2 that hides them might take the pressure off for an rc3 that fixes them!</p>",
        "id": 575067543,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771658371
    }
]