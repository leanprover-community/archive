[
    {
        "content": "<p>Hi everyone. I'm trying to prove something akin to the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">let_fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"n\">complicated</span><span class=\"w\"> </span><span class=\"n\">expression</span><span class=\"bp\">&gt;;</span>\n<span class=\"w\">       </span><span class=\"n\">let_fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">long</span><span class=\"w\"> </span><span class=\"n\">complicated</span><span class=\"w\"> </span><span class=\"n\">expression</span><span class=\"bp\">&gt;;</span>\n<span class=\"w\">       </span><span class=\"bp\">&lt;</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">mentions</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Normally when I encounter something like this I would use the <code>intro</code> tactic to get access to <code>b</code> and <code>c</code> so that I could use them when proving <code>&lt;result ...&gt;</code>. The issue with doing that here is that these <code>let_fun</code>s are nested inside of an <code>=</code> expression. Doing <code>intro b c</code> complains about an <code>insufficient number of binders</code>, which makes sense because the <code>let_fun</code>s are not at the top level of the expression I'm trying to prove, so <code>intro</code> can't see them.</p>\n<p>I could use <code>simp</code>, but then I would not be able to use the definitions of <code>b</code> and <code>c</code> in my proof because simp would get rid of them. In my actual code, if I use <code>simp</code>, I get the following ugly mess:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">loopRight</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"n\">start₁</span><span class=\"w\"> </span><span class=\"n\">start₂</span><span class=\"w\"> </span><span class=\"n\">end₂</span><span class=\"w\"> </span><span class=\"n\">k₁</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">aux</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H₄Right</span><span class=\"bp\">.</span><span class=\"n\">mk_i_lt_aux_size</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"n\">aux</span><span class=\"w\"> </span><span class=\"n\">start₁</span><span class=\"w\"> </span><span class=\"n\">start₂</span><span class=\"w\"> </span><span class=\"n\">end₂</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">k₁</span><span class=\"w\"> </span><span class=\"n\">k₂</span><span class=\"w\"> </span><span class=\"n\">h₄Right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of_eq_true</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">18419</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"o\">[</span><span class=\"n\">k₂</span><span class=\"o\">])</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k₂</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H₄Right</span><span class=\"bp\">.</span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"n\">aux</span><span class=\"w\"> </span><span class=\"n\">start₁</span><span class=\"w\"> </span><span class=\"n\">start₂</span><span class=\"w\"> </span><span class=\"n\">end₂</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">k₁</span><span class=\"w\"> </span><span class=\"n\">k₂</span><span class=\"w\"> </span><span class=\"n\">h₄Right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of_eq_true</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">18419</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n</code></pre></div>\n<p>I don't want to use <code>have</code> statements in my proof to manually give definitions for <code>a</code> and <code>b</code> given that the <code>let_fun</code>s are already there. Is there any way to get access to these definitions so they can be used in the rest of the proof despite being on the RHS of the <code>=</code>-sign?</p>",
        "id": 452911502,
        "sender_full_name": "Michael MacLeod",
        "timestamp": 1721517640
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"730008\">Michael MacLeod</span> has marked this topic as resolved.</p>",
        "id": 452912934,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721519300
    },
    {
        "content": "<p>I managed to sidestep this issue by making the arguments of my proof implicit so they could be automatically supplied, thus eliminating the need for introducing variable names.</p>",
        "id": 452912960,
        "sender_full_name": "Michael MacLeod",
        "timestamp": 1721519377
    },
    {
        "content": "<p>I think <code>lift_lets</code> (from mathlib) would help</p>",
        "id": 452930283,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721531081
    },
    {
        "content": "<p>Oh, never mind, <code>lift_lets</code> doesn't know about <code>let_fun</code> yet.</p>",
        "id": 452930337,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721531117
    },
    {
        "content": "<p>Thanks, I didn't know about that. Maybe it will come in useful in some other circumstance.</p>",
        "id": 452936773,
        "sender_full_name": "Michael MacLeod",
        "timestamp": 1721534727
    }
]