[
    {
        "content": "<p>Starting today, when I tried to check out the new rc mathlib, I began to get <code>ld</code> errors. I switched to an older branch, ran <code>lake exe cache get</code>, and got this <code>ld</code> error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">12</span><span class=\"bp\">/</span><span class=\"mi\">12</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">yakov</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0-rc1/bin/clang -o ././.lake/build/bin/cache ././.lake/build/ir/Cache/Main.c.o.export ././.lake/build/ir/Cache/Lean.c.o.export ././.lake/build/ir/Cache/IO.c.o.export ././.lake/build/ir/Cache/Hashing.c.o.export ././.lake/build/ir/Cache/Requests.c.o.export --sysroot /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1 -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc/libc_nonshared.a /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc/libpthread_nonshared.a -Wl,--as-needed -Wl,-Bstatic -lgmp -lunwind -luv -Wl,-Bdynamic -Wl,--no-as-needed -fuse-ld=lld -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/lean -Wl,--start-group -lleancpp -lLean -Wl,--end-group -lStd -Wl,--start-group -lInit -lleanrt -Wl,--end-group -Wl,-Bstatic -lc++ -lc++abi -Wl,-Bdynamic -lLake -Wl,--as-needed -lgmp -luv -lpthread -ldl -lrt -Wl,--no-as-needed -lm -ldl -pthread</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l_instInhabitedError</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">initialize_Cache_IO</span><span class=\"o\">)</span>\n\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3114____spec__1</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__5</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__7</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__7</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">times</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">yakov</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0-rc1/bin/clang' exited with code 1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>Starting a new shell didn't help.</p>",
        "id": 503396453,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741136516
    },
    {
        "content": "<p>Uninstalling the v4.17.0-rc1 and v4.18.0-rc1 toolchains and rerunning didn't help.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">list</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">releases</span><span class=\"o\">:</span><span class=\"n\">pr</span><span class=\"bp\">-</span><span class=\"n\">release</span><span class=\"bp\">-</span><span class=\"mi\">6800</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">12</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">13</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">13</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc3</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">14</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">15</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">16</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">16</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc2</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">18</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">uninstall</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">uninstalling</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1'</span><span class=\"w\"> </span><span class=\"n\">uninstalled</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">uninstall</span><span class=\"w\"> </span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">18</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">uninstalling</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">18</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">18</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1'</span><span class=\"w\"> </span><span class=\"n\">uninstalled</span>\n<span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">download</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mf\">4.17</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">zst</span>\n<span class=\"mf\">279.9</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mf\">279.9</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"bp\">%</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"mf\">42.3</span><span class=\"w\"> </span><span class=\"n\">MiB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">ETA</span><span class=\"o\">:</span><span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">yakov</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0-rc1</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">12</span><span class=\"bp\">/</span><span class=\"mi\">12</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">yakov</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0-rc1/bin/clang -o ././.lake/build/bin/cache ././.lake/build/ir/Cache/Main.c.o.export ././.lake/build/ir/Cache/Lean.c.o.export ././.lake/build/ir/Cache/IO.c.o.export ././.lake/build/ir/Cache/Hashing.c.o.export ././.lake/build/ir/Cache/Requests.c.o.export --sysroot /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1 -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc/libc_nonshared.a /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/glibc/libpthread_nonshared.a -Wl,--as-needed -Wl,-Bstatic -lgmp -lunwind -luv -Wl,-Bdynamic -Wl,--no-as-needed -fuse-ld=lld -L /home/yakov/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/lib/lean -Wl,--start-group -lleancpp -lLean -Wl,--end-group -lStd -Wl,--start-group -lInit -lleanrt -Wl,--end-group -Wl,-Bstatic -lc++ -lc++abi -Wl,-Bdynamic -lLake -Wl,--as-needed -lgmp -luv -lpthread -ldl -lrt -Wl,--no-as-needed -lm -ldl -pthread</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l_instInhabitedError</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">initialize_Cache_IO</span><span class=\"o\">)</span>\n\n<span class=\"n\">ld</span><span class=\"bp\">.</span><span class=\"n\">lld</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3114____spec__1</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__5</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__7</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\">               </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">Requests</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"kn\">export</span><span class=\"o\">:(</span><span class=\"n\">l_Cache_Requests_downloadFiles___lambda__7</span><span class=\"o\">)</span>\n<span class=\"bp\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">referenced</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">times</span>\n<span class=\"n\">clang</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">external</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">yakov</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0-rc1/bin/clang' exited with code 1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">cache</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>",
        "id": 503396779,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741136685
    },
    {
        "content": "<p>Deleting <code>.lake</code> fixed it: <code>$ rm -rf .lake</code></p>",
        "id": 503397258,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741136937
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> Could we be missing a dependency edge on the Lean version here?</p>",
        "id": 503441968,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741160268
    },
    {
        "content": "<p>I ran into this as well</p>",
        "id": 503455321,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741164950
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> Possibly, but that would be suprising. Module elaboration, C compilaiton, and executable linking should all include the Lean trace. It also is not quite clear to me what the incompability is from these error reports. </p>\n<p>Does anyone know what changed in cache between  <code>v4.17.0-rc1</code> and <code>v4.18.0-rc1</code> that is triggering this incompatiblity? (If not, I will take a look myself when possible, though I am currently otherwise occupied.)</p>",
        "id": 503673404,
        "sender_full_name": "Mac Malone",
        "timestamp": 1741225288
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113488-general/topic/ld.20undefined.20symbol.20on.20.60exe.20cache.60/near/503455321\">said</a>:</p>\n<blockquote>\n<p>I ran into this as well</p>\n</blockquote>\n<p>Me too. A reliable workaround seems to be to run <code>lake clean</code>; the <code>lake exe cache (whatever)</code> works again.</p>",
        "id": 503727845,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1741248790
    },
    {
        "content": "<p>I mean there's a been a few refactors to <code>cache</code> recently, see <a href=\"https://github.com/leanprover-community/mathlib4/pull/21238\">#21238</a>. I don't think anything concerning <code>Json.getObjValAs?</code> or <code>IO.instInhabitedError</code> has been touched though. Maybe imports: <a href=\"https://github.com/leanprover-community/mathlib4/pull/21666/files\">this PR</a> changed some imports that seem relevant. Could that be a source of the issue?</p>",
        "id": 503732501,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741250212
    },
    {
        "content": "<p>ok I can reproduce this consistently:</p>\n<p>Use a random branch on <code>v4.17</code> like <code>eugster/cache_parse_args</code> and make sure your <code>master</code> is up-to-date with <code>origin/master</code>. Then:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">eugster</span><span class=\"bp\">/</span><span class=\"n\">cache_parse_args</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">cp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">good_lake_v4_17</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">cp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">good_lake_v4_18</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">eugster</span><span class=\"bp\">/</span><span class=\"n\">cache_parse_args</span>\n<span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">cp</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">bad_lake_v4_17</span>\n</code></pre></div>\n<p>Now comparing the these lakefolders reveals:</p>\n<ul>\n<li><code>diff -rq bad_lake_v4_17 good_lake_v4_17</code> shows tons of <code>.hash</code> changes first one for example <code>Files bad_lake_v4_17/build/bin/cache.hash and good_lake_v4_17/build/bin/cache.hash differ</code></li>\n<li><code>diff -rq bad_lake_v4_17 good_lake_v4_18</code> no difference in <code>.hash</code> files, only a few changes, like <code>Files bad_lake_v4_17/build/ir/Cache/Hashing.c.o.export.trace and good_lake_v4_18/build/ir/Cache/Hashing.c.o.export.trace differ</code></li>\n</ul>\n<p>Not sure yet what to make of it all...</p>",
        "id": 503740311,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741252508
    },
    {
        "content": "<p>(and probably this difference in <code>.hash</code> files is a red hering since I think it's <code>lake exe cache</code> trying to download these)</p>",
        "id": 503741547,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741252825
    },
    {
        "content": "<p>Maybe the more important question is why</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Files</span><span class=\"w\"> </span><span class=\"n\">bad_lake_v4_17</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">and</span>\n<span class=\"w\">    </span><span class=\"n\">good_lake_v4_17</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">ir</span><span class=\"bp\">/</span><span class=\"n\">Cache</span><span class=\"bp\">/</span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">differ</span>\n</code></pre></div>",
        "id": 503742224,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741253028
    },
    {
        "content": "<p>Ok. <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> I think the build path changed between <code>v4.17</code> and <code>v4.18</code> from <code>.lake/build/lib/</code> to <code>.lake/build/lib/lean/</code>. Is this deliberate? Ofc <code>cache</code> would be sensible to that but here is - I think - code to demonstrate this without <code>cache</code>:</p>",
        "id": 503758327,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741257547
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">mk_all</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">lean</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span>\n<span class=\"n\">Mathlib</span><span class=\"w\">         </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">        </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">   </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">        </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">   </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"mi\">5269898</span><span class=\"n\">d6a51d047931107c8d72d934d8d5d3753</span><span class=\"w\">   </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">mk_all</span>\n<span class=\"o\">[</span><span class=\"bp\">...</span><span class=\"o\">]</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span>\n<span class=\"n\">Mathlib</span><span class=\"w\">         </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"w\">        </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">ilean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">   </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"w\">        </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">olean</span><span class=\"bp\">.</span><span class=\"n\">hash</span><span class=\"w\">   </span><span class=\"n\">mk_all</span><span class=\"bp\">.</span><span class=\"n\">trace</span>\n<span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span>\n<span class=\"n\">ls</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>",
        "id": 503758905,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741257723
    },
    {
        "content": "<p>Although if I move the files outside that new <code>lean</code> folder, I get a bit of a more instructive, but equally weird error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>✖ [2/12] Building Cache.Lean\ntrace: .&gt; LEAN_PATH=././.lake/packages/Cli/.lake/build/lib:././.lake/packages/batteries/.lake/build/lib:././.lake/packages/Qq/.lake/build/lib:././.lake/packages/aesop/.lake/build/lib:././.lake/packages/proofwidgets/.lake/build/lib:././.lake/packages/importGraph/.lake/build/lib:././.lake/packages/LeanSearchClient/.lake/build/lib:././.lake/packages/plausible/.lake/build/lib:././.lake/build/lib DYLD_LIBRARY_PATH= /Users/me/.elan/toolchains/leanprover--lean4---v4.17.0-rc1/bin/lean ././././Cache/Lean.lean -R ./././. -o ././.lake/build/lib/Cache/Lean.olean -i ././.lake/build/lib/Cache/Lean.ilean -c ././.lake/build/ir/Cache/Lean.c --json\nerror: ././././Cache/Lean.lean:7:0: object file '././.lake/packages/batteries/.lake/build/lib/Lean/Util/Paths.olean' of module Lean.Util.Paths does not exist\n</code></pre></div>\n<p>Why would it try to import <code>Lean.Util.Paths</code> from <code>batteries</code> <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> ?</p>",
        "id": 503763580,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741259077
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> sorry for all the noise. Here is a fully reconstructable MWE without <code>Mathlib</code> or <code>Cache</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>new<span class=\"w\"> </span>Debug\n<span class=\"nb\">cd</span><span class=\"w\"> </span>Debug\n<span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover/lean4:v4.18.0-rc1\"</span><span class=\"w\"> </span>&gt;<span class=\"w\"> </span>lean-toolchain\ncat<span class=\"w\"> </span>lean-toolchain\n<span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"\\nimport Lean.Util.Paths\\n\"</span><span class=\"w\"> </span>&gt;&gt;<span class=\"w\"> </span>Debug.lean\nlake<span class=\"w\"> </span>build\n<span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover/lean4:v4.17.0\"</span><span class=\"w\"> </span>&gt;<span class=\"w\"> </span>lean-toolchain\ncat<span class=\"w\"> </span>lean-toolchain\nlake<span class=\"w\"> </span>build\n</code></pre></div>\n<p>outputs the following error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">18</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">rc1</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Debug</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">previous</span><span class=\"w\"> </span><span class=\"n\">manifest</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">creating</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">scratch</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">updated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">already</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"bp\">-</span><span class=\"n\">to</span><span class=\"bp\">-</span><span class=\"n\">date</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">17</span><span class=\"bp\">.</span><span class=\"m\">0</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">8</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">Debug</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">LEAN_PATH</span><span class=\"bp\">=././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"n\">DYLD_LIBRARY_PATH</span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"o\">[</span><span class=\"n\">user</span><span class=\"o\">]</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.17.0/bin/lean ././././Debug.lean -R ./././. -o ././.lake/build/lib/Debug.olean -i ././.lake/build/lib/Debug.ilean -c ././.lake/build/ir/Debug.c --json</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">Debug</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Lean</span><span class=\"bp\">/</span><span class=\"n\">Util</span><span class=\"bp\">/</span><span class=\"n\">Paths</span><span class=\"bp\">.</span><span class=\"n\">olean'</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Util</span><span class=\"bp\">.</span><span class=\"n\">Paths</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">exist</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Debug</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>I think with that I stop debugging for now :)</p>",
        "id": 503769821,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1741260947
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span> So this is a problem with downgrading from 4.18 to 4.17? I was under the impression the original problem was the inverse (i.e., upgrading from 4.17 to 4.18). Thanks for the report! From this, I know what the problem is.</p>",
        "id": 503928970,
        "sender_full_name": "Mac Malone",
        "timestamp": 1741311970
    },
    {
        "content": "<p>With this problem, deleting the Lake directory or running <code>lake clean</code> when downgrading from Lean v4.18 is the most effective solution. Lake could change the default build directory again to avoid this downgrade issue, but that is largely a workaround (and would not fix users who already have a <code>lib/lean</code>). Thus, it is not clear that there is a better solution.</p>",
        "id": 503945361,
        "sender_full_name": "Mac Malone",
        "timestamp": 1741321634
    },
    {
        "content": "<p>Remember that some people (particularly people doing reviewing work) may be \"downgrading\" several times per day, as many Mathlib branches will still be on an old toolchain. We need to make things smooth even in this scenario!</p>",
        "id": 503945494,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1741321716
    },
    {
        "content": "<p>I would love to! It is unfortunate that there is no real way to patch such old versions of Mathlib/Lake/Lean to make them forward-compatible (for this or any other forward-compatibility issues).</p>",
        "id": 503946719,
        "sender_full_name": "Mac Malone",
        "timestamp": 1741322462
    },
    {
        "content": "<p>On current master I get</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\n<span class=\"go\">✖ [12/12] Building cache</span>\n<span class=\"go\">trace: .&gt; /home/jmc/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/cc -o ././.lake/build/bin/cache ././.lake/build/ir/Cache/Main.c.o.export ././.lake/build/ir/Cache/Lean.c.o.export ././.lake/build/ir/Cache/IO.c.o.export ././.lake/build/ir/Cache/Hashing.c.o.export ././.lake/build/ir/Cache/Requests.c.o.export -L /home/jmc/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/lib/lean -Wl,--start-group -lleancpp -lLean -Wl,--end-group -lStd -Wl,--start-group -lInit -lleanrt -Wl,--end-group -Wl,-Bstatic -lc++ -lc++abi -Wl,-Bdynamic -lLake -Wl,--as-needed -lgmp -luv -lpthread -ldl -lrt -Wl,--no-as-needed -lm -ldl -pthread</span>\n<span class=\"go\">info: stderr:</span>\n<span class=\"go\">/nix/store/bwkb907myixfzzykp21m9iczkhrq5pfy-binutils-2.43.1/bin/ld: ././.lake/build/ir/Cache/IO.c.o.export: in function `initialize_Cache_IO':</span>\n<span class=\"go\">IO.c:(.text+0x363f4): undefined reference to `l_IO_instInhabitedError'</span>\n<span class=\"go\">/nix/store/bwkb907myixfzzykp21m9iczkhrq5pfy-binutils-2.43.1/bin/ld: ././.lake/build/ir/Cache/Requests.c.o.export: in function `l_Cache_Requests_downloadFiles___lambda__5':</span>\n<span class=\"go\">Requests.c:(.text+0x3cab): undefined reference to `l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3070____spec__1'</span>\n<span class=\"go\">/nix/store/bwkb907myixfzzykp21m9iczkhrq5pfy-binutils-2.43.1/bin/ld: ././.lake/build/ir/Cache/Requests.c.o.export: in function `l_Cache_Requests_downloadFiles___lambda__7':</span>\n<span class=\"go\">Requests.c:(.text+0x47bb): undefined reference to `l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3070____spec__1'</span>\n<span class=\"go\">/nix/store/bwkb907myixfzzykp21m9iczkhrq5pfy-binutils-2.43.1/bin/ld: Requests.c:(.text+0x4ba7): undefined reference to `l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3070____spec__1'</span>\n<span class=\"go\">/nix/store/bwkb907myixfzzykp21m9iczkhrq5pfy-binutils-2.43.1/bin/ld: Requests.c:(.text+0x4f66): undefined reference to `l_Lean_Json_getObjValAs_x3f___at___private_Lean_Message_0__Lean_fromJsonBaseMessage____x40_Lean_Message___hyg_3070____spec__1'</span>\n<span class=\"go\">collect2: error: ld returned 1 exit status</span>\n<span class=\"go\">error: external command '/home/jmc/.elan/toolchains/leanprover--lean4---v4.18.0-rc1/bin/cc' exited with code 1</span>\n<span class=\"go\">Some required builds logged failures:</span>\n<span class=\"go\">- cache</span>\n<span class=\"go\">error: build failed</span>\n</code></pre></div>",
        "id": 505671938,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741958134
    },
    {
        "content": "<p>(restoring this probably not relevant comment because Johan reponded to it) Current mathlib master <code>cc7963812d581a6f867de0121bf3e06e2a66d67e</code> working fine for me after <code>lake exe cache get</code> and <code>lake build</code>, is this a nix issue? But now I see that you're talking about Lean not mathlib.</p>",
        "id": 505674563,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741958794
    },
    {
        "content": "<p>Yeah, I'm also on <code>cc7963812d5</code></p>",
        "id": 505675079,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741958918
    },
    {
        "content": "<p>It might be a nix issue...</p>",
        "id": 505675228,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741958955
    },
    {
        "content": "<p>Isn't that the same error as above, i.e. try <code>lake clean</code>?</p>",
        "id": 505676774,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741959344
    },
    {
        "content": "<p>Weird... I thought I had tried that. But I tried a bit too many things...</p>",
        "id": 505678301,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741959731
    },
    {
        "content": "<p>It seems to be working again! Merci</p>",
        "id": 505678330,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741959741
    },
    {
        "content": "<p>To be fair, the error message <em>is</em> a bit different because Nix elan uses a different linker</p>",
        "id": 505678936,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1741959909
    },
    {
        "content": "<p>I'm running into this in FLT right now:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>git<span class=\"w\"> </span>checkout<span class=\"w\"> </span>main\n$<span class=\"w\"> </span><span class=\"c1\">## now on v4.18.0-rc1</span>\n$<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\n$<span class=\"w\"> </span><span class=\"c1\">## works fine, so let's review a PR</span>\n$<span class=\"w\"> </span>gh<span class=\"w\"> </span>pr<span class=\"w\"> </span>checkout<span class=\"w\"> </span><span class=\"m\">373</span>\n$<span class=\"w\"> </span><span class=\"c1\">## this PR was made on v4.17.0-rc1</span>\n$<span class=\"w\"> </span>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get\n...\nld.lld:<span class=\"w\"> </span>error:<span class=\"w\"> </span>undefined<span class=\"w\"> </span>symbol:<span class=\"w\"> </span>l_instInhabitedError\n...\n</code></pre></div>\n<p>Easily fixed with a <code>lake clean</code>.</p>",
        "id": 508403098,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743035506
    },
    {
        "content": "<p>Just pinging <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> in case he can think of a way <code>lake</code> could detect this condition itself, without the user needing the guess they have to run <code>lake clean</code>.</p>",
        "id": 508408482,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1743038855
    }
]