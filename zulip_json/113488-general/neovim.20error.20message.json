[
    {
        "content": "<p>I'm trying to test lean with vim, and I get an error message I don't understand.</p>\n<blockquote>\n<p>LSP[leanls]: Error ON_ATTACH_ERROR: \"vim/keymap.lua:0: rhs: expected string|function, got nil\"</p>\n</blockquote>\n<p>(I just followed the instructions about how to install it from <a href=\"https://github.com/Julian/lean.nvim\">lean.nvim</a>, and I used <code>vim-plug</code>.)</p>",
        "id": 456538498,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722862811
    },
    {
        "content": "<p><code>vim</code> or <code>nvim</code>?</p>",
        "id": 456546855,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722864143
    },
    {
        "content": "<p><code>nvim</code>, indeed.</p>",
        "id": 456550282,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722864287
    },
    {
        "content": "<p>Do you already have an <code>on_attach</code> function? If not, <a href=\"https://github.com/Julian/lean.nvim/wiki/Getting-Started-From-the-Ground-Up#configuration-files\">here</a> is the one I copied into my <code>init.lua</code>. (I have no organization in <code>.config/nvim/</code>)</p>",
        "id": 456569642,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722865094
    },
    {
        "content": "<p>Also, I am not sure if this should \"just work\" now. My initial install is long in the past.</p>",
        "id": 456570962,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722865242
    },
    {
        "content": "<p>(Hooray, another vulnerable convert <span aria-label=\"smiling devil\" class=\"emoji emoji-1f608\" role=\"img\" title=\"smiling devil\">:smiling_devil:</span>)</p>\n<p>That error message would sound like somewhere you have <code>vim.keymap.set('n', 'bla', nil)</code></p>",
        "id": 456570987,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722865246
    },
    {
        "content": "<p>Can you share your setup Antoine?</p>",
        "id": 456571007,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722865254
    },
    {
        "content": "<p>I'm on MacOS (12.7.5), running <code>nvim</code>version  <code>v0.10.1</code>.<br>\nI downloaded <a href=\"https://github.com/junegunn/vim-plug\">plug.vim</a> to <code>$(HOME)/.vim/autoload</code>, added the suggested lines, launched <code>`:PlugUpdate</code> after restarting <code>nvim</code>, and added a long <code>~/.config/nvim/plugin/lean.lua</code> that starts with <code>require('lean').setup{ mappings = true }</code>.</p>",
        "id": 456578346,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722866918
    },
    {
        "content": "<p>Are there any <code>vim.keymap</code> lines in the <code>lean.lua</code> file?</p>",
        "id": 456578539,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722866969
    },
    {
        "content": "<p>I added what Matthew suggested above from <a href=\"https://github.com/Julian/lean.nvim/wiki/Getting-Started-From-the-Ground-Up#configuration-files\">here</a>  hence I have such a line in the definition of <code>on_attach</code>, but I'm not even sure that file is loaded.</p>",
        "id": 456579246,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867141
    },
    {
        "content": "<p>What surprises me is that when I do <code>:healthcheck</code>, I get an error message from   <code>$HOME/.local/share/nvim/plugged/lean.nvim/lua/lean/_util.lua</code>at line 74:</p>\n<blockquote>\n<p>\"lean\" exited with non-zero exit status 1.</p>\n</blockquote>",
        "id": 456579980,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867263
    },
    {
        "content": "<p>You can put <code>print(\"HELLO\")</code> at the top of the file  if you want to see whether it's loaded, you should then see that when you start nvim -- but could you perhaps pastebin its entire contents, I'm not sure whether you're saying you have <code>require('lean').setup{ mappings = true }</code> in it once or twice (it should be only once).</p>",
        "id": 456580100,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722867280
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456579980\">said</a>:</p>\n<blockquote>\n<p>What surprises me is that when I do <code>:healthcheck</code>, I get an error message from   <code>$HOME/.local/share/nvim/plugged/lean.nvim/lua/lean/_util.lua</code>at line 74:</p>\n<blockquote>\n<p>\"lean\" exited with non-zero exit status 1.<br>\n</p>\n</blockquote>\n</blockquote>\n<p>that would sound interesting too yeah, what happens if you run <code>:!lean --version</code> from within neovim?</p>",
        "id": 456580250,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722867304
    },
    {
        "content": "<blockquote>\n<p>:!lean --version<br>\nerror: toolchain 'leanprover/lean4:v4.7.0-rc1' is not installed<br>\ninfo: caused by: not a directory: '/Users/chambert/.elan/toolchains/leanprover--lean4---v4.7.0-rc1'</p>\n</blockquote>\n<p>Oops…</p>",
        "id": 456580719,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867382
    },
    {
        "content": "<p>I have the exact content of the file there. (Before your remark, I had the <code>mappings = true</code> twice, but that doesn't change anything…)</p>",
        "id": 456581238,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867510
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/qnJxBihf58Xbocv6YhihRsl4/lean.lua\">lean.lua</a></p>",
        "id": 456581363,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456580719\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>:!lean --version<br>\nerror: toolchain 'leanprover/lean4:v4.7.0-rc1' is not installed<br>\ninfo: caused by: not a directory: '/Users/chambert/.elan/toolchains/leanprover--lean4---v4.7.0-rc1'</p>\n</blockquote>\n<p>Oops…</p>\n</blockquote>\n<p>I assume you're using elan right? I don't have elan handy, does it actually exit with nonzero status for <code>lean --version</code> if it hasn't yet installed the toolchain?  Can you try <code>lean --version; echo $?</code> in a shell in that same project perhaps? That would be slightly surprising behavior, but if so probably nothing to worry about, as when it's really time to start the language server I assume then it would download it and all would be fine.</p>",
        "id": 456582677,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722867764
    },
    {
        "content": "<p>I solved that. (In the main directory,the default version of <code>lean</code> was that obsolete one I had deleted, but I made it to a stable one.</p>\n<blockquote>\n<p>(16:22) pro-acl &gt; elan show<br>\ninstalled toolchains</p>\n<hr>\n<p>leanprover/lean4:stable (default)<br>\nleanprover/lean4:v4.10.0<br>\nleanprover/lean4:v4.10.0-rc2<br>\nleanprover/lean4:v4.7.0<br>\nleanprover/lean4:v4.8.0-rc2</p>\n<p>active toolchain</p>\n<hr>\n<p>leanprover/lean4:stable (default)<br>\nLean (version 4.6.1, x86_64-apple-darwin21.6.0, commit dac66e47e32f, Release)<br>\n</p>\n</blockquote>",
        "id": 456583103,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867834
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456581363\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/qnJxBihf58Xbocv6YhihRsl4/lean.lua\">lean.lua</a></p>\n</blockquote>\n<p>OK yeah that doesn't seem like anything is wrong there. I am going to take my puppy out and make some coffee and then be back -- can you try perhaps removing the body of the <code>on_attach</code> function (or otherwise removing lines) until the error message goes away? Just keep the <code>lean.setup{}</code> line. If that works we can add it back.</p>",
        "id": 456583393,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722867879
    },
    {
        "content": "<p>The error message disappeared after commenting out the body of <code>on_attach</code>.</p>",
        "id": 456583888,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722867992
    },
    {
        "content": "<p>Oh! Your file differs from what Matthew shared.</p>",
        "id": 456592662,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722868927
    },
    {
        "content": "<p>Probably it was from before I fixed it for newer neovims like 0.10.</p>",
        "id": 456592691,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722868937
    },
    {
        "content": "<p>Specifically you have <code>    cmd('n', '&lt;leader&gt;q', vim.lsp.diagnostic.set_loclist)</code> -- but that's now called <code>vim.diagnostic.setloclist</code></p>",
        "id": 456592772,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722868964
    },
    {
        "content": "<p>what?!</p>",
        "id": 456592898,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722869004
    },
    {
        "content": "<p>If you make that change to <code>cmd('n', '&lt;leader&gt;q', vim.diagnostic.setloclist)</code> all should work</p>",
        "id": 456592911,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869008
    },
    {
        "content": "<p>Yeah! thanks!</p>",
        "id": 456593700,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722869203
    },
    {
        "content": "<p>Great, please provide any feedback :) -- including now you're going to motivate me to get back to writing a bit more of <a href=\"https://github.com/Julian/lean.nvim/wiki/The-lean.nvim-Manual\">https://github.com/Julian/lean.nvim/wiki/The-lean.nvim-Manual</a> to replace that Getting Started page.</p>",
        "id": 456593885,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869259
    },
    {
        "content": "<p>I use vim for all the rest of my editing tasks and I was fed up of vscode for day 1. Moreover, my computer is not so fast for new software (it's  a 2015 MacBook Pro), and I observe that <code>lean</code> with <code>nvim</code>is much more reactive. (Also, the <code>vim</code> plugin in <code>vscode</code> is not good enough for me.)</p>",
        "id": 456594795,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722869420
    },
    {
        "content": "<p>To add feedback: I still don't understand how to have the <code>hover</code> stuff, nor how to use the output of <code>apply?</code>, or <code>simp?</code>. (Still, I can copy-paste)</p>",
        "id": 456596777,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722869526
    },
    {
        "content": "<p>For hover, the mapping is <code>K</code>. So put your cursor somewhere and hit K and you should see a popup with the same as what you'd see in VSCode. (This K mapping is nvim-wide and should work in any language server).</p>",
        "id": 456599982,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869778
    },
    {
        "content": "<p>(Of course you can add another one if you prefer something else -- or you can add an autocmd which automatically shows the hover if you leave your cursor in the same spot. Let me know if you want instructions for that.)</p>",
        "id": 456600120,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869805
    },
    {
        "content": "<p>I'm not sure that's useful for me. Automatically hovering windows are sometimes a nuisance, I'll try to see if <code>K</code>is sufficient for me.</p>",
        "id": 456600739,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722869898
    },
    {
        "content": "<p>(I agree FWIW.)</p>",
        "id": 456601075,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869933
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456596777\">said</a>:</p>\n<blockquote>\n<p>nor how to use the output of <code>apply?</code>, or <code>simp?</code>.</p>\n</blockquote>\n<p>These are called code actions -- and it looks like we didn't add a mapping in the page you were using. I'll be sure to both update that as well as update the new manual page. You can add:</p>\n<div class=\"codehilite\" data-code-language=\"Lua\"><pre><span></span><code>      <span class=\"n\">cmd</span><span class=\"p\">(</span><span class=\"s1\">'n'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;leader&gt;a'</span><span class=\"p\">,</span> <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">lsp</span><span class=\"p\">.</span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">code_action</span><span class=\"p\">)</span>\n      <span class=\"n\">cmd</span><span class=\"p\">(</span><span class=\"s1\">'i'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;C-a&gt;'</span><span class=\"p\">,</span> <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">lsp</span><span class=\"p\">.</span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">code_action</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>at which point you then can activate them with <code>&lt;leader&gt;a</code> in normal mode or ctrl-a in insert mode.</p>",
        "id": 456601754,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722869989
    },
    {
        "content": "<p>neovim 0.11 will bind some keys by default to do this, I think the new mapping will live on <code>gra</code>, but I like my suggestion better :)</p>",
        "id": 456602906,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722870032
    },
    {
        "content": "<p>Also, I quite like <a href=\"https://github.com/aznhe21/actions-preview.nvim\">https://github.com/aznhe21/actions-preview.nvim</a>, so you might look at that as well -- basically it will show you what <code>apply?</code> etc. will replace as a diff, before you actually select which one you want. (That uses telescope, so you'd be adding telescope to your setup as well if you haven't already.) But of course none of that is required if you're happy with the simple UI that <code>vim.lsp.buf.code_action()</code> has by default.</p>",
        "id": 456605248,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722870120
    },
    {
        "content": "<p>I've only got </p>\n<div class=\"codehilite\" data-code-language=\"Lua\"><pre><span></span><code>  <span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">api</span><span class=\"p\">.</span><span class=\"n\">nvim_buf_set_keymap</span><span class=\"p\">(</span><span class=\"n\">bufnr</span><span class=\"p\">,</span> <span class=\"s1\">'n'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;leader&gt;ca'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;CR&gt;'</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>and it seems enough for me. </p>\n<p><code>K</code> is something I use all the time. You can also use return in the infoview (or at least I can and I can't see where I set it). </p>\n<p>Another thing I use all the time is jumping to the next trace/warning/error:</p>\n<div class=\"codehilite\" data-code-language=\"Lua\"><pre><span></span><code><span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">api</span><span class=\"p\">.</span><span class=\"n\">nvim_set_keymap</span><span class=\"p\">(</span><span class=\"s1\">'n'</span><span class=\"p\">,</span> <span class=\"s1\">'[d'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;'</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"n\">noremap</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"n\">silent</span> <span class=\"o\">=</span> <span class=\"kc\">true</span> <span class=\"p\">})</span>\n<span class=\"n\">vim</span><span class=\"p\">.</span><span class=\"n\">api</span><span class=\"p\">.</span><span class=\"n\">nvim_set_keymap</span><span class=\"p\">(</span><span class=\"s1\">'n'</span><span class=\"p\">,</span> <span class=\"s1\">']d'</span><span class=\"p\">,</span> <span class=\"s1\">'&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;'</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"n\">noremap</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"n\">silent</span> <span class=\"o\">=</span> <span class=\"kc\">true</span> <span class=\"p\">})</span>\n</code></pre></div>\n<p>Though maybe these are already standard. I should probably clean my key mappings up.</p>",
        "id": 456622158,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722870820
    },
    {
        "content": "<p>For <code>apply?</code>, the buffer gets pretty crowded with all the choices.</p>",
        "id": 456623497,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722870897
    },
    {
        "content": "<p>That <code>nvim_buf_set_keymap</code> is basically equivalent -- looks like you have only a normal mode mapping -- whether you want an insert mode one too is obviously up to you, but I think it's useful e.g. when you're typing out a structure and you know that the skeleton expansion code action exists, so you don't need to exit insert mode to trigger it.</p>",
        "id": 456629675,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722871814
    },
    {
        "content": "<p>The ]d mappings are yeah now automatic in 0.10 though there's no harm in keeping that.</p>",
        "id": 456629733,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722871825
    },
    {
        "content": "<p>I think telescope (via the thing I linked) helps a bit with the crowding, as you can then type to filter the choices further.</p>",
        "id": 456629869,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722871858
    },
    {
        "content": "<p>Also since you mentioned it, my ]d mapping is a bit more nuanced so maybe someone will like that -- <a href=\"https://github.com/Julian/dotfiles/blob/96340aa51972ec1bf5fa6f3e2d91309780b16723/.config/nvim/init.lua#L357-L370\">https://github.com/Julian/dotfiles/blob/96340aa51972ec1bf5fa6f3e2d91309780b16723/.config/nvim/init.lua#L357-L370</a> it does what yours does (what the default does) but it only shows a popup if the diagnostic isn't just likely to be what you already see in the virtual text, which is a bit pointless to show twice for short Lean (or whatever) diagnostics.</p>",
        "id": 456630353,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722871951
    },
    {
        "content": "<p>While we’re here, is there a filler for the diagnostics returning only the errors?</p>",
        "id": 456631841,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722872279
    },
    {
        "content": "<p><code>vim.diagnostic.goto_next{ severity = vim.diagnostic.severity.ERROR }</code></p>",
        "id": 456634153,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722872757
    },
    {
        "content": "<p>Is there a default binding for that now?</p>",
        "id": 456635423,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722873014
    },
    {
        "content": "<p>Nope -- the ones that exist are <a href=\"https://github.com/neovim/neovim/blob/fd1d84c705128372dc25e3a833e9a1dc6b9e81e0/runtime/lua/vim/_defaults.lua#L177-L208\">https://github.com/neovim/neovim/blob/fd1d84c705128372dc25e3a833e9a1dc6b9e81e0/runtime/lua/vim/_defaults.lua#L177-L208</a></p>",
        "id": 456636518,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722873282
    },
    {
        "content": "<p>(That's for 0.11 / nightly, to be clear.)</p>",
        "id": 456636613,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722873308
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 456637385,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722873503
    },
    {
        "content": "<p>New questions: in the default install I came up to yesterday, there's supposed to be a way to go the next/prev line with a diagnostic message, but I can't understand what <code>&lt;leader&gt;</code> has been assigned to. </p>\n<blockquote>\n<p>-- &lt;leader&gt;n will jump to the next Lean line with a diagnostic message on it<br>\n    -- &lt;leader&gt;N will jump backwards<br>\n    cmd('n', '&lt;leader&gt;n', function() vim.diagnostic.goto_next{popup_opts = {show_header = false}} end)<br>\n    cmd('n', '&lt;leader&gt;N', function() vim.diagnostic.goto_prev{popup_opts = {show_header = false}} end)</p>\n</blockquote>",
        "id": 456814248,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722938436
    },
    {
        "content": "<p>Space?</p>",
        "id": 456819620,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722940379
    },
    {
        "content": "<p>You mean, I just type ' n', and it goes to the next Lean line with a diagnostic message?</p>",
        "id": 456829859,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722943819
    },
    {
        "content": "<p><code>&lt;leader&gt;</code> is a general vim concept not specific to Lean. You can show the leader you have configured using <code>:show mapleader</code>. If it is undefined, then the default value is <code>\\</code>. So typing <code>\\n</code> should jump to the next diagnostic message.</p>",
        "id": 456831914,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1722944312
    },
    {
        "content": "<p>Yeah -- <code>\\</code> is pretty awkward to type (probably on both US and AIUI french keyboards) so space is usually what I'd recommend. You can add <code>vim.g.mapleader = ' '</code> to the top of your <code>init.lua</code> to change that to space if so.</p>",
        "id": 456853830,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722950058
    },
    {
        "content": "<p>Also, like Matthew mentioned elsewhere, neovim now also automatically defines <code>]d</code> and <code>[d</code>for this by default as well, so those keyboard shortcuts may work for you too (I use them now).</p>",
        "id": 456853982,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722950107
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 456873221,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722954996
    },
    {
        "content": "<p>By the way, I just got a bizarre error message :</p>\n<blockquote>\n<p>Error executing vim.schedule lua callback: vim/inspect.lua:0: attempt to compare number with nil<br>\nstack traceback:<br>\n        vim/inspect.lua: in function 'putValue'<br>\n        vim/inspect.lua: in function 'putValue'<br>\n        vim/inspect.lua: in function 'putValue'<br>\n        vim/inspect.lua: in function 'putValue'<br>\n        vim/inspect.lua: in function 'inspect'<br>\n        ...lar/neovim/0.10.1/share/nvim/runtime/lua/vim/lsp/rpc.lua:292: in function 'notify'<br>\n        .../neovim/0.10.1/share/nvim/runtime/lua/vim/lsp/client.lua:784: in function 'notify'<br>\n        ...ert/.local/share/nvim/plugged/lean.nvim/lua/lean/rpc.lua:101: in function 'release_now'<br>\n        ...ert/.local/share/nvim/plugged/lean.nvim/lua/lean/rpc.lua:117: in function ''<br>\n        vim/_editor.lua: in function ''<br>\n        vim/_editor.lua: in function &lt;vim/_editor.lua:0&gt;<br>\n</p>\n</blockquote>",
        "id": 456873351,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722955015
    },
    {
        "content": "<blockquote>\n<p>LSP[leanls]: Error NO_RESULT_CALLBACK_FOUND: {<br>\n  error = {<br>\n    code = -32601,<br>\n    message = \"No RPC method 'Lean.Widget.getInteractiveDiagnostics' found\"<br>\n  },<br>\n  id = 443278,<br>\n  jsonrpc = \"2.0\"<br>\n}</p>\n</blockquote>",
        "id": 456873584,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722955066
    },
    {
        "content": "<p>I get the last one (or something similar) if I let things sit around too long untouched</p>",
        "id": 456873980,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722955155
    },
    {
        "content": "<p>That's OK. I'll try to think and type faster.</p>",
        "id": 456876645,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722955816
    },
    {
        "content": "<p>I mean ~ 30 minutes of inactivity.</p>",
        "id": 456876856,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722955874
    },
    {
        "content": "<p>Yeah I've seen that one too and haven't looked into it carefully, let's see now if I can either reproduce or fix it.</p>",
        "id": 456881396,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722957005
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456605248\">said</a>:</p>\n<blockquote>\n<p>Also, I quite like <a href=\"https://github.com/aznhe21/actions-preview.nvim\">https://github.com/aznhe21/actions-preview.nvim</a>, so you might look at that as well -- basically it will show you what <code>apply?</code> etc. will replace as a diff, before you actually select which one you want. </p>\n</blockquote>\n<p>Ooo. This is nice.</p>",
        "id": 456882291,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1722957227
    },
    {
        "content": "<p>It's in the readme, and I mentioned it in the other thread, but let me know if you have suggestions for more effective ways to announce that sort of thing. I guess at some point hopefully I'll write up lean.nvim release notes, and do this \"pRoPerLY\" which will make it easier to mention nice new things.</p>",
        "id": 456882550,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722957285
    },
    {
        "content": "<p>There's an annoying behaviour at end of lines: if I enter &lt;return&gt; just after a character, neovim tries to complete, which forces me to enter &lt;space&gt;, bringing trailing spaces at end of lines, or &lt;shift-return&gt;, which I'm not used to.<br>\nIs there a possibility to match &lt;tab&gt; for autocompletion and have &lt;enter&gt; just<br>\npass to the next line?</p>",
        "id": 456955698,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722978510
    },
    {
        "content": "<p>This is with <code>cmp</code> presumably?</p>",
        "id": 456957000,
        "sender_full_name": "Julian Berman",
        "timestamp": 1722979025
    },
    {
        "content": "<p>presumably, and in the <code>init.lua</code> file, I just made this modification</p>\n<blockquote>\n<div class=\"codehilite\"><pre><span></span><code>  [&#39;&lt;Tab&gt;&#39;] = cmp.mapping.confirm({ select = true }),\n</code></pre></div>\n\n</blockquote>\n<p>and it seems to do what I expected.</p>",
        "id": 456965211,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1722981548
    },
    {
        "content": "<p>There is tension here that I understand very well. Like Antoine, I’ve been using vim for all my editing for more than twenty years. So it is very frustrating to use VSCode for Lean, and we expect that lean.nvim will be very easy to use for us. But we are old school vim users who don’t know much about the modern (and much better!) vim style that is used here. I spent some time investing in learning a bit about modern vim, and I don’t regret it. It made vim even better also for my old uses. </p>\n<p>Something that does not change with modern vim is that vim is still an editor for people who like to customize their editing experience. This is partly unavoidable because of the emphasis on keyboard use. There are simply too many things people could want to do vim their vim, so there is no way to assign default keybindings to everything (whereas you can always add menu item in mouse-based software like VSCode). Note however that more and more people try to package pre-configured vim that are meant to be usable out of the box. For instance lazyvim, nvchad, LunarVim, AstroVim… But for some reason they don’t seem to have realized yet that lean.nvim should be part of their story.</p>",
        "id": 457100493,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723035056
    },
    {
        "content": "<p>Antoine, something else you can explore is starting from someone else’s config. GitHub is full of those. Julian’s one can be found at <a href=\"https://github.com/Julian/dotfiles/tree/main/.config/nvim\">https://github.com/Julian/dotfiles/tree/main/.config/nvim</a>, mine is at <a href=\"https://github.com/PatrickMassot/neovim_config\">https://github.com/PatrickMassot/neovim_config</a>. The issue with that strategy is that it can be hard to untangle what you are interested in from stuff you don’t need (or even stuff that would clash with your other settings).</p>",
        "id": 457101094,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723035285
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/113488-general/topic/neovim.20error.20message/near/456605248\">said</a>:</p>\n<blockquote>\n<p>Also, I quite like <a href=\"https://github.com/aznhe21/actions-preview.nvim\">https://github.com/aznhe21/actions-preview.nvim</a>, so you might look at that as well -- basically it will show you what <code>apply?</code> etc. will replace as a diff, before you actually select which one you want. (That uses telescope, so you'd be adding telescope to your setup as well if you haven't already.) But of course none of that is required if you're happy with the simple UI that <code>vim.lsp.buf.code_action()</code> has by default.</p>\n</blockquote>\n<p>The issue is this is obviously not Lean aware. It will show you what the tactic script would become, but in many cases (for instance after a <code>apply?</code>, you are mostly interested in what the tactic state would become.</p>",
        "id": 457101468,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1723035421
    }
]