[
    {
        "content": "<p>Hi, I want to have style checks like the ones in Mathlib in my own Lean repo (for example to check line length). I tried using <code>leanprover-community/lint-style-action</code>, but it says that it runs <code>lake exe lint-style</code>, and I don't get <code>lake exe lint-style</code> to give me any error no matter how bad I format my code (not even with very long lines)<br>\nDo you know what I have to do so that <code>lake exe lint-style</code> gives me errors of code style?</p>",
        "id": 569708072,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769172873
    },
    {
        "content": "<p>Does your project use/import Mathlib? What does your <code>lakefile.toml</code> look like? In my project with <a href=\"https://github.com/m4lvin/lean4-pdl/blob/main/lakefile.toml\">this toml file</a> I can run <code>lake exe lint-style</code> without any further changes.</p>\n<p>Just guessing, but does <code>lake build</code> compile all the files you want it to? / Do you have<code>defaultTargets</code> set in the toml file? (You can also try <code>lake exe lint-style MyModuleName</code> it seems.)</p>",
        "id": 569857846,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1769253569
    },
    {
        "content": "<p>It does use Mathlib. This is my lakefile (almost the default):</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanOJProblems\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">keywords</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"math\"</span><span class=\"p\">]</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"LeanOJProblems\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[leanOptions]</span>\n<span class=\"n\">pp</span><span class=\"p\">.</span><span class=\"n\">unicode</span><span class=\"p\">.</span><span class=\"n\">fun</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"c1\"># pretty-prints `fun a ↦ b`</span>\n<span class=\"n\">relaxedAutoImplicit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">weak</span><span class=\"p\">.</span><span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">mathlibStandardSet</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n<span class=\"n\">maxSynthPendingDepth</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span>\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"v4.26.0\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanOJProblems\"</span>\n<span class=\"n\">globs</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"LeanOJProblems.*\"</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>I tryed adding the <code>lintDriver</code> option that you have, and the <code>weak.linter.flexible</code> option, but it also does not give any error.<br>\nAnd this is a Lean file that I think should give a style error of having a line to long:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Sqrt</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">solution</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"bp\">√</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>But even if I put that in <code>LeanOJProblems/Basic</code> and I do <code>lake exe lint-style LeanOJProblems.Basic</code> I don't get anything</p>",
        "id": 569859231,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769254886
    },
    {
        "content": "<p>The long line linter happens under <code>lake build</code>, not <code>lake exe lint-style</code>.</p>",
        "id": 569859581,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769255263
    },
    {
        "content": "<p>Oh, I see, that was my problem</p>",
        "id": 569859726,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255421
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 569859729,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255423
    },
    {
        "content": "<p>So what does <code>lake exe lint-style</code> checks?</p>",
        "id": 569859757,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255451
    },
    {
        "content": "<p>Spaces before/after <code>;</code> for example.</p>",
        "id": 569859784,
        "sender_full_name": "Malvin Gattinger",
        "timestamp": 1769255472
    },
    {
        "content": "<blockquote>\n<p>claude -p 'What does lake exe lint-style check for?'</p>\n</blockquote>",
        "id": 569859825,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769255509
    },
    {
        "content": "<p>What is claude -p?</p>",
        "id": 569859955,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255624
    },
    {
        "content": "<p>I'm trying to teach you how to fish. If in 2026 you haven't worked out how to use Claude Code, you really really should. :-)</p>",
        "id": 569860029,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769255685
    },
    {
        "content": "<p>The command above, run in the Mathlib repo (but probably would work fine anywhere downstream of Mathlib), outputs a moment later:</p>\n<blockquote>\n<p><code>lake exe lint-style</code> runs text-based style linters on Lean files. It checks for:</p>\n<p><strong>Line-level checks:</strong></p>\n<ol>\n<li><strong>Adaptation notes</strong> (<code>ERR_ADN</code>) - Flags \"Adaptation note\" strings; should use <code>#adaptation_note</code> command instead</li>\n<li><strong>Windows line endings</strong> (<code>ERR_WIN</code>) - Flags <code>\\r\\n</code> line endings; should use Unix <code>\\n</code></li>\n<li><strong>Trailing whitespace</strong> (<code>ERR_TWS</code>) - Flags lines ending with spaces</li>\n<li><strong>Space before semicolon</strong> (<code>ERR_SEM</code>) - Flags <code> ;</code> patterns</li>\n<li><strong>Disallowed Unicode</strong> (<code>ERR_UNICODE</code>) - Flags blocklisted Unicode characters</li>\n</ol>\n<p><strong>Module-level checks:</strong></p>\n<ol start=\"6\">\n<li><strong>UpperCamelCase naming</strong> - Module names must be UpperCamelCase (with some exceptions like <code>lpSpace</code>)</li>\n<li><strong>Windows-forbidden filenames</strong> - No CON, PRN, AUX, NUL, COM1-9, LPT1-9 as components</li>\n<li><strong>Forbidden characters</strong> - No <code>!</code>, <code>.</code>, <code>&lt;</code>, <code>&gt;</code>, <code>\"</code>, <code>/</code>, <code>\\</code>, <code>|</code>, <code>?</code>, <code>*</code>, or whitespace in module names</li>\n</ol>\n<p><strong>Mathlib-specific checks:</strong></p>\n<ol start=\"9\">\n<li><strong><code>Mathlib.Init</code> imports</strong> - Every Mathlib file must transitively import <code>Mathlib.Init</code></li>\n<li><strong>Scripts documentation</strong> - Every file in <code>scripts/</code> must be documented in <code>scripts/README.md</code></li>\n</ol>\n<p><strong>Usage:</strong></p>\n<ul>\n<li><code>lake exe lint-style</code> - lint default Lake targets</li>\n<li><code>lake exe lint-style --fix</code> - auto-fix fixable errors</li>\n<li><code>lake exe lint-style --github</code> - output for GitHub problem matchers</li>\n<li><code>lake exe lint-style Mathlib.Foo</code> - lint specific module and its imports</li>\n</ul>\n</blockquote>",
        "id": 569860109,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769255746
    },
    {
        "content": "<p>Helpful, no?</p>",
        "id": 569860115,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769255753
    },
    {
        "content": "<p>I was using Github Copilot and ChatGPT, but I was not able to solve any Lean configuration things with them. Maybe I should try this</p>",
        "id": 569860232,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255865
    },
    {
        "content": "<p>Thank you</p>",
        "id": 569860238,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769255869
    },
    {
        "content": "<p>I see interesting analogies with a couple of decades ago, when there were two kinds of people in the world: those who had realised that asking google was a good way to get general information, and those that continued to ask easily google-able questions on forums and were occasionally being redirected to google by people for whom the penny had dropped.</p>",
        "id": 569862229,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1769257367
    },
    {
        "content": "<p>One more question, how can I get the style warnings of <code>lake build</code> to be errors? (for CI to fail)<br>\nAI suggested to use <code>moreLeanArgs = [\"-werror\"]</code> in the lakefile, or <code>moreLeanArgs = [\"--warningAsError\"]</code> or <code>moreLeanArgs = [\"--wErr\"]</code>, but it does not work (also it does not work passing <code>-werror</code>, <code>--warningAsError</code> or <code>--wErr</code> to the command when running it from the command line)</p>",
        "id": 569873291,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769265918
    },
    {
        "content": "<p>Until about November 2025 it was nothing, but then Claude + Opus 4.5 stepped up the quality: for coding, and astonishingly it's also good enough to Lean-formalize undergrad proofs. I make a plan with Gemini (because no one beats Google with web search) and feed the plan to Claude.</p>",
        "id": 569878913,
        "sender_full_name": "Ralf Stephan",
        "timestamp": 1769270563
    },
    {
        "content": "<p>I also found <code>--wfail</code> and <code>--fail-level==warning</code> in the documentation, but these are accepted by lake, but do not seem to work<br>\nAny way, I would need something that accepts sorrys, which produce a warning</p>",
        "id": 569884678,
        "sender_full_name": "Iván Renison",
        "timestamp": 1769271743
    }
]