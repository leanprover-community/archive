[
    {
        "content": "<p>When running the following code, it produces the error \"unknown identifier 'Unexpander'\".<br>\nHowever, the actual cause of the error is the <code>in</code> at the end of the <code>set_option</code> line.<br>\nIf you remove the <code>in</code>, the error disappears.<br>\nThis error message is hard to understand, in my opinion.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unexpander</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unexpander</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>",
        "id": 527049828,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1751565722
    },
    {
        "content": "<p>It fails to parse but doesn't throw an error???</p>",
        "id": 527050652,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751566068
    },
    {
        "content": "<p>Is this caused by the fact that the <code>in</code> makes the <code>open</code> finish its scope as soon as it's over?</p>",
        "id": 527062349,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751571291
    },
    {
        "content": "<p>So then Unexpanded is unknown, since it is missing some namespace?</p>",
        "id": 527062419,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751571324
    },
    {
        "content": "<p>A good mental model for <code>in</code> is that it wraps the following command inside a <code>section</code>/<code>end</code> pair, so the <code>open</code> command is only opening the namespaces in a very very very narrow margin.</p>",
        "id": 527062582,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751571410
    },
    {
        "content": "<p>It looks like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">PrettyPrinter</span>\n</code></pre></div>\n<p>is one command</p>",
        "id": 527063101,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751571691
    },
    {
        "content": "<p>I agree, and the command is roughly equivalent to <code>section (...) end</code>.</p>",
        "id": 527063491,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1751571917
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/113488-general/topic/Unclear.20Error.20Message/near/527063491\">schrieb</a>:</p>\n<blockquote>\n<p>I agree, and the command is roughly equivalent to <code>section (...) end</code>.</p>\n</blockquote>\n<p>Not just roughly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">builtin_macro</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.«</span><span class=\"n\">in</span><span class=\"bp\">»</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">expandInCmd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Macro</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">cmd₁</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"bp\">%$</span><span class=\"n\">tk</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">cmd₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Limit ref variability for incrementality; see Note [Incremental Macros]</span>\n<span class=\"w\">    </span><span class=\"n\">withRef</span><span class=\"w\"> </span><span class=\"n\">tk</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">cmd₁</span><span class=\"o\">:</span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">cmd₂</span><span class=\"w\"> </span><span class=\"kn\">end</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\">                 </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Macro</span><span class=\"bp\">.</span><span class=\"n\">throwUnsupported</span>\n</code></pre></div>",
        "id": 527066520,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1751573445
    }
]