[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<p>In the code below, I'm getting the <code>motive is not type</code> error above. What does the notation <code>_a</code> in <code>Fin2 _a</code> mean, and why does Lean expect <code>Fin2 _a</code> instead of <code>sig.toP.β x</code> here?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ar</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">ar</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">induction'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">ground</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">elems</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fin2</span><span class=\"bp\">.</span><span class=\"n\">instFintype</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inverse1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)]:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Signature</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp!</span>\n<span class=\"w\">  </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"c1\">-- error here</span>\n</code></pre></div>",
        "id": 486741902,
        "sender_full_name": "nrs",
        "timestamp": 1733640361
    },
    {
        "content": "<p>You're quoting just part of the error message — the entire error message explains this. Could you say what about the error message is unclear?</p>",
        "id": 486743398,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733641793
    },
    {
        "content": "<p>From what I understand, it means that the greater expression depends on the piece I'm trying to rewrite, but doesn't a rewrite just unfold an expression? I'd expect my rewrite to just also rewrite those other parts that depend on the smaller part I'm trying to rewrite</p>",
        "id": 486744380,
        "sender_full_name": "nrs",
        "timestamp": 1733642702
    },
    {
        "content": "<p>I don't understand the message very well, suggestions/resources on how rewriting works more in depth also work! reading more closely did clear up the part on the notation <code>_a</code> however</p>",
        "id": 486744849,
        "sender_full_name": "nrs",
        "timestamp": 1733643160
    },
    {
        "content": "<p>In case this helps someone, </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inverse1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)]:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Signature</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp!</span>\n<span class=\"w\">  </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">this</span>\n</code></pre></div>\n<p>closes the goal, but I have no clue why we have to take this route. I got to this by trying <code>exact this</code> first, seeing a different typeclass synthesized between the goal and <code>this</code> and thinking <code>convert</code> might automatically determine their exact differences. Any explanations for why the problem occurred (and why <code>convert</code> works without generating new goals) would be highly appreciated, the totality of context is given by the code above</p>",
        "id": 486768624,
        "sender_full_name": "nrs",
        "timestamp": 1733663273
    },
    {
        "content": "<p>Guessing based on the partial code you pasted: <code>Fintype</code> contains a list (well, <code>Finset</code>) of elements of the type, so there can be different instances with different underlying lists, but <code>convert</code> can deal with that</p>",
        "id": 486769450,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733664009
    },
    {
        "content": "<p>ah that makes a lot of sense, I encountered a similar phenomenon when proving <code>FintFin2Card</code>, it seems <code>Fin</code> doesn't have the same issue (or automation works a bit better for it). thanks for the reply!</p>",
        "id": 486769530,
        "sender_full_name": "nrs",
        "timestamp": 1733664120
    },
    {
        "content": "<p><code>convert</code> knows about <code>Subsingleton.elim</code> and these data-carrying typeclasses like <code>Fintype</code> often have subsingleton instances associated with them.</p>",
        "id": 486769608,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733664174
    },
    {
        "content": "<p>I think <code>convert</code> may have specific code for <code>Fintype</code>, but the high-level idea is the same: <code>convert</code> says \"this is a dumb goal, I'll handle it\"</p>",
        "id": 486769765,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733664321
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Interpreting.20.60motive.20is.20not.20type.20correct.60/near/486769608\">said</a>:</p>\n<blockquote>\n<p><code>convert</code> knows about <code>Subsingleton.elim</code> and these data-carrying typeclasses like <code>Fintype</code> often have subsingleton instances associated with them.</p>\n</blockquote>\n<p>I see, the subsingleton in question here is <code>Finset.univ</code>, right?</p>",
        "id": 486769871,
        "sender_full_name": "nrs",
        "timestamp": 1733664415
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> All <code>convert</code> knows about <code>Fintype</code> is <code>Subsingleton.elim</code>, like Kevin said. However, it uses <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.FastSubsingleton#doc\">docs#Lean.Meta.FastSubsingleton</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=FastSubsingleton.helim#doc\">docs#FastSubsingleton.helim</a> so it doesn't get bogged down with the general <code>Subsingleton</code> class. (The <code>subsingleton</code> tactic can be used to handle lingering expensive subsingleton goals.)</p>",
        "id": 486788479,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733679679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749978\">nrs</span> <a href=\"#narrow/channel/113488-general/topic/Interpreting.20.60motive.20is.20not.20type.20correct.60/near/486769871\">said</a>:</p>\n<blockquote>\n<p>I see, the subsingleton in question here is <code>Finset.univ</code>, right?</p>\n</blockquote>\n<p>Not quite, it would be the <code>Fintype</code> instance itself. As a consequence any two <code>Finset.univ</code>s for the same type are equal.</p>",
        "id": 486788553,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733679728
    },
    {
        "content": "<p>Okay, then I was just confused :)</p>",
        "id": 486788832,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733680004
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749978\">nrs</span> <a href=\"#narrow/channel/113488-general/topic/Interpreting.20.60motive.20is.20not.20type.20correct.60/near/486744380\">said</a>:</p>\n<blockquote>\n<p>doesn't a rewrite just unfold an expression?</p>\n</blockquote>\n<p>Let's take a look at all of the error message. The very first part is explaining the motive:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rewrite'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span>\n</code></pre></div>\n<p>Call this <code>m</code>. The rest of the error message explains that rewriting by <code>LHS = RHS</code> works by trying to find an <code>m</code> where <code>m LHS</code> is the current goal. If it's possible to find such an <code>m</code>, then rewriting can replace the goal with <code>m RHS</code>. However, rewrite's algorithm to come up with a motive failed — the motive is failing to typecheck.</p>\n<p>\"Just\" unfolding would be to replace a constant with the body of the definition. Your <code>FintFin2Card</code> would not be considered to be unfolding anything. (If your theorems are definitional equalities, the <code>dsimp</code> tactic is a way to do such rewrites, \"definitional simp\".)</p>",
        "id": 486788841,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733680012
    },
    {
        "content": "<p>If you do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inverse1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"bp\">.</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)]:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Signature</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp!</span>\n<span class=\"w\">  </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>instead of <code>convert FintFin2Card (sig.arity x)</code>, it reveals</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"bp\">.</span><span class=\"n\">instFintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inst</span><span class=\"bp\">✝</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>In particular, you somehow have two different Fintype instances. This can be hard to avoid (hence why we have tactics like <code>convert</code>/<code>congr!</code>).</p>",
        "id": 486789225,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733680325
    },
    {
        "content": "<p>If you use <code>convert FintFin2Card (sig.arity x) using 0</code> you can see the initial goal it sets up, which it passes to <code>congr!</code>. The option <code>set_option trace.congr! true</code> gives an idea of the steps it uses.</p>",
        "id": 486789392,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733680462
    },
    {
        "content": "<p>I see! that makes a lot of sense, thank you very much for taking the time! the <code>congr!</code> trace option in particular is super useful</p>",
        "id": 486790411,
        "sender_full_name": "nrs",
        "timestamp": 1733681193
    },
    {
        "content": "<p>I'd also like to point out the nuclear option: <code>subst</code> will never fail, so if all else doesn't work, you can prove an auxiliary lemma of the form <code>a = b -&gt; ...</code> and apply it to whatever you want to prove.</p>",
        "id": 486807941,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1733696112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/113488-general/topic/Interpreting.20.60motive.20is.20not.20type.20correct.60/near/486807941\">said</a>:</p>\n<blockquote>\n<p>I'd also like to point out the nuclear option: <code>subst</code> will never fail, so if all else doesn't work, you can prove an auxiliary lemma of the form <code>a = b -&gt; ...</code> and apply it to whatever you want to prove.</p>\n</blockquote>\n<p>strikingly <code>subst</code> fails in the above case, even thought <code>this</code> and the goal have the exact same type</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inverse1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Signature</span><span class=\"bp\">.</span><span class=\"n\">toP</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sig</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">toSignature</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp!</span>\n<span class=\"w\">  </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"c1\">--convert (FintFin2Card (sig.arity x))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">FintFin2Card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sig</span><span class=\"bp\">.</span><span class=\"n\">arity</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">this</span>\n</code></pre></div>",
        "id": 486808164,
        "sender_full_name": "nrs",
        "timestamp": 1733696311
    },
    {
        "content": "<p>I wanted to ask in fact if anyone knows how to change a goal <code>f x = y</code> into a goal to <code>@f x z  = y</code> where <code>z</code> is an argument previously implicit? in this case it would have permitted seeing that the goal was hiding an implicit argument that made rewriting fail</p>",
        "id": 486808426,
        "sender_full_name": "nrs",
        "timestamp": 1733696550
    },
    {
        "content": "<p><code>set_option pp.explicit true</code></p>",
        "id": 486808642,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733696754
    },
    {
        "content": "<p>thank you!!</p>",
        "id": 486808710,
        "sender_full_name": "nrs",
        "timestamp": 1733696782
    },
    {
        "content": "<p>With Violeta's suggestion, it never fails <em>if it's the sort of hypothesis that <code>subst</code> can handle</em></p>",
        "id": 486808725,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733696796
    },
    {
        "content": "<p>It has to be an equality with a variable on at least one side.</p>",
        "id": 486808741,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733696813
    }
]