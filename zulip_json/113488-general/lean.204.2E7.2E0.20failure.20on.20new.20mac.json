[
    {
        "content": "<p>I just tried to create a new Lean game following instructions <a href=\"https://github.com/leanprover-community/lean4game/blob/main/doc/create_game.md\">here</a>; I used the game skeleton template to make a new repo, cloned it locally and typed <code>lake update -R &amp;&amp; lake build</code> and I got the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% lake update -R &amp;&amp; lake build\ninfo: downloading https://releases.lean-lang.org/lean4/v4.7.0/lean-4.7.0-darwin_aarch64.tar.zst\nTotal: 159.3 MiB Speed:  14.1 MiB/s\ninfo: installing /Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0\nGameServer: cloning https://github.com/leanprover-community/lean4game.git to './.lake/packages/GameServer'\nstd: cloning https://github.com/leanprover/std4.git to './.lake/packages/std'\ni18n: cloning https://github.com/hhu-adam/lean-i18n.git to './.lake/packages/i18n'\nimportGraph: cloning https://github.com/leanprover-community/import-graph to './.lake/packages/importGraph'\nCli: cloning https://github.com/mhuisi/lean4-cli to './.lake/packages/Cli'\nwarning: Cli: ignoring missing dependency manifest './.lake/packages/Cli/lake-manifest.json'\nGameServer: running post-update hooks\n[0/18] Building GameServer.Utils\n[0/18] Building GameServer.Graph\n[0/23] Building GameServer.Structures\n[0/23] Compiling time.cpp\n[0/37] Building Std.Tactic.OpenPrivate\n[0/41] Building GameServer.Tactic.LetIntros\n[0/74] Building GameServer.Options\n[1/74] Compiling GameServer.Tactic.LetIntros\n[2/74] Compiling Std.Tactic.OpenPrivate\n[2/74] Building GameServer.Helpers.PrettyPrinter\n[2/74] Building GameServer.ImportModules\n[3/74] Compiling GameServer.ImportModules\n[4/74] Compiling GameServer.Structures\n[4/74] Building GameServer.InteractiveGoal\n[5/74] Compiling GameServer.Options\n[6/74] Compiling GameServer.InteractiveGoal\n[7/74] Compiling GameServer.Graph\n[8/74] Compiling GameServer.Utils\n[8/74] Building GameServer.AbstractCtx\n[9/74] Compiling GameServer.AbstractCtx\n[9/74] Building GameServer.Hints\n[10/74] Compiling GameServer.Helpers.PrettyPrinter\n[10/74] Building GameServer.Helpers\n[11/74] Building GameServer.EnvExtensions\n[11/74] Compiling GameServer.Hints\n[12/74] Compiling GameServer.Helpers\n[22/74] Building GameServer.Inventory\n[22/74] Compiling GameServer.EnvExtensions\n[25/74] Compiling GameServer.Inventory\n[26/74] Creating libleanTime.a\n[27/74] Linking libleanTime.dylib\n[28/74] Building Time.Basic\n[28/74] Building I18n.Language\n[28/74] Building I18n.Utils\nerror: &gt; LEAN_PATH=./.lake/packages/std/.lake/build/lib:./.lake/packages/Cli/.lake/build/lib:./.lake/packages/i18n/.lake/build/lib:./.lake/packages/importGraph/.lake/build/lib:./.lake/packages/GameServer/server/.lake/build/lib:./.lake/build/lib DYLD_LIBRARY_PATH=./.lake/packages/i18n/.lake/build/lib:./.lake/packages/i18n/.lake/build/lib /Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/bin/lean ./.lake/packages/i18n/././I18n/Utils.lean -R ./.lake/packages/i18n/./. -o ./.lake/packages/i18n/.lake/build/lib/I18n/Utils.olean -i ./.lake/packages/i18n/.lake/build/lib/I18n/Utils.ilean -c ./.lake/packages/i18n/.lake/build/ir/I18n/Utils.c --load-dynlib=./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib\nerror: stderr:\nlibc++abi: terminating due to uncaught exception of type lean::exception: error loading library, dlopen(./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib, 0x0009): tried: './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/System/Volumes/Preboot/Cryptexes/OS./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/lib/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/lib/lean/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/usr/lib/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file, not in dyld cache), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/Users/buzzard/Lean/Projects/SquareRootOfTwo/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/System/Volumes/Preboot/Cryptexes/OS/Users/buzzard/Lean/Projects/SquareRootOfTwo/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/Lean/Projects/SquareRootOfTwo/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag)\n</code></pre></div>\n<p>(and then several more errors). What am I doing wrong?</p>",
        "id": 531316761,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753694268
    },
    {
        "content": "<p>Further analysis shows that this is not the fault of the game skeleton -- I cannot even get <code>lean4game</code> working on my mac laptop (Sequoia 15.5). <code>npm install</code> works fine but when I run <code>npm start</code> to start the server I get the same error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[client]   ➜  Local:   http://localhost:3000/\n[client]   ➜  Network: http://192.0.0.2:3000/\n[client]   ➜  Network: http://100.64.0.1:3000/\n[client] [vite-plugin-static-copy] Collected 7 items.\n[server] error: &gt; LEAN_PATH=./.lake/packages/std/.lake/build/lib:./.lake/packages/Cli/.lake/build/lib:./.lake/packages/i18n/.lake/build/lib:./.lake/packages/importGraph/.lake/build/lib:./.lake/build/lib DYLD_LIBRARY_PATH=./.lake/packages/i18n/.lake/build/lib:./.lake/packages/i18n/.lake/build/lib /Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/bin/lean ./.lake/packages/i18n/././time/Time/Basic.lean -R ./.lake/packages/i18n/././time -o ./.lake/packages/i18n/.lake/build/lib/Time/Basic.olean -i ./.lake/packages/i18n/.lake/build/lib/Time/Basic.ilean -c ./.lake/packages/i18n/.lake/build/ir/Time/Basic.c --load-dynlib=./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib\n[server] error: stderr:\n[server] libc++abi: terminating due to uncaught exception of type lean::exception: error loading library, dlopen(./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib, 0x0009): tried: './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/System/Volumes/Preboot/Cryptexes/OS./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/lib/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/lib/lean/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/usr/lib/./.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file, not in dyld cache), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), './.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/Users/buzzard/Lean/Projects/lean4game/server/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag), '/System/Volumes/Preboot/Cryptexes/OS/Users/buzzard/Lean/Projects/lean4game/server/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (no such file), '/Users/buzzard/Lean/Projects/lean4game/server/.lake/packages/i18n/.lake/build/lib/libleanTime.dylib' (__DATA_CONST segment missing SG_READ_ONLY flag)\n[server] error: external command `/Users/buzzard/.elan/toolchains/leanprover--lean4---v4.7.0/bin/lean` exited with code 134\n</code></pre></div>\n<p>I also cannot compile NNG4 on this machine -- same error. Compiling mathlib/FLT etc works fine. Any ideas on how to debug?</p>",
        "id": 531369108,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753708947
    },
    {
        "content": "<p>You need a newer Lean version, that is the only fix</p>",
        "id": 531371958,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1753709649
    },
    {
        "content": "<p>So I cannot do game development on my new mac right now? Wow. What's the minimum version of Lean that I need to pester <span class=\"user-mention\" data-user-id=\"129120\">@Alexander Bentkamp</span> to bump lean4game to before I can supervise this summer student that I've just taken on, on how to make a Lean game?</p>",
        "id": 531374284,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753710211
    },
    {
        "content": "<p>Yep, not much we can do to foresee future operating system versions breaking things unfortunately. You need 4.20.0+.</p>",
        "id": 531377290,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1753710965
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/lean.204.2E7.2E0.20failure.20on.20new.20mac/near/531374284\">said</a>:</p>\n<blockquote>\n<p>So I cannot do game development on my new mac right now? Wow. What's the minimum version of Lean that I need to pester <span class=\"user-mention silent\" data-user-id=\"129120\">Alexander Bentkamp</span> to bump lean4game to before I can supervise this summer student on how to make a Lean game?</p>\n</blockquote>\n<p>You can do this yourself on a fork</p>",
        "id": 531379505,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1753711456
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I've been able to get rid of similar issues with old Lean on new Mac OS by disabling precompiled modules. Upgrading your Lean version is by far the better approach, but if that can't happen, then this might be a workaround.</p>",
        "id": 531382706,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1753712285
    },
    {
        "content": "<p>I have just updated lean4game to v4.21.0. Its not yet live, but you should be able to use it locally already.</p>",
        "id": 531392130,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1753714719
    },
    {
        "content": "<p>GameSkeleton has not yet been updated. Jon created a bump-v4.21.0 branch. I am not sure whether its working.</p>",
        "id": 531392839,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1753714891
    },
    {
        "content": "<p>Does this mean that other games on the game server will need to be updated?</p>",
        "id": 531418534,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1753722593
    },
    {
        "content": "<p>A more precise question: if the maintainer of a game hosted by <a href=\"http://adam.math.hhu.de\">adam.math.hhu.de</a> decides to add new material but not bump the repo to the latest Lean, will the deployment of the new version to the website still work?</p>",
        "id": 531419597,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753722941
    },
    {
        "content": "<p>No, nobody will be forced to update, and yes, you will be able to add new material while using old lean versions.</p>",
        "id": 531424487,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1753724550
    },
    {
        "content": "<p>Ok, the <code>bump-v4.21.0</code> of GameSkeleton works. And the <a href=\"http://adam.math.hhu.de\">adam.math.hhu.de</a> will probably be updated on Monday.</p>",
        "id": 531457080,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1753735033
    },
    {
        "content": "<p>Thanks so much for your prompt action! I had a two-week summer project thrown into temporary chaos by this!</p>",
        "id": 531465087,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753737917
    },
    {
        "content": "<p>The update is live on <a href=\"http://adam.math.hhu.de\">adam.math.hhu.de</a> now, by the way.</p>",
        "id": 533351841,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1754594962
    },
    {
        "content": "<p>Thanks! An update from my side: I managed to bump both the server and my game repo to 4.21 and can compile it locally, but CI on my game repo is failing with the attached error.</p>\n<p><a href=\"/user_uploads/3121/ye9cR1VYEHUwz6m65X0DxTet/Screenshot-2025-08-08-at-12.10.51.png\">Screenshot 2025-08-08 at 12.10.51.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ye9cR1VYEHUwz6m65X0DxTet/Screenshot-2025-08-08-at-12.10.51.png\" title=\"Screenshot 2025-08-08 at 12.10.51.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1708x414\" src=\"/user_uploads/thumbnail/3121/ye9cR1VYEHUwz6m65X0DxTet/Screenshot-2025-08-08-at-12.10.51.png/840x560.webp\"></a></div><p>Any ideas? I thought I had made all the changes which were made on the skeleton.</p>",
        "id": 533443742,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754651535
    },
    {
        "content": "<p><a href=\"https://github.com/hhu-adam/GameSkeleton/commit/be14d11d65be7601c613036ae455ce6553a82803\">https://github.com/hhu-adam/GameSkeleton/commit/be14d11d65be7601c613036ae455ce6553a82803</a></p>",
        "id": 533446288,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1754652725
    },
    {
        "content": "<p>Maybe this change was made only after you checked.</p>",
        "id": 533446343,
        "sender_full_name": "Alexander Bentkamp",
        "timestamp": 1754652748
    },
    {
        "content": "<p>Yep that's one of the slightly subideal things about that setup. There are several meta-/config-/...-files which need to be copy-pasted from the GameSkeleton into your own game. Anything under <code>.github/</code> and potential fixes in the <code>lakefile.lean</code> are only two examples.</p>\n<p>Btw <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, NNG is already bumped but I'd like to only deploy it to the server once we've tested some more for potential bugs.</p>",
        "id": 533469902,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1754661595
    },
    {
        "content": "<p>CI is passing on my game repo now, thanks all!</p>",
        "id": 533470064,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754661640
    }
]