[
    {
        "content": "<p>I'm solving Advent of Code in Lean this year. Is anyone else trying program verification for these, as an exercise? For a beginner like me, they are plenty complicated. I'd love to hang out in a chat where people are doing this... as things stand, I feel pretty alone :)</p>",
        "id": 563637077,
        "sender_full_name": "Jason Orendorff",
        "timestamp": 1765648412
    },
    {
        "content": "<p>There's one difficulty: a proof is not very useful when the specification and the code are basically the same. This is a common problem with AoC.</p>\n<p>But some problems can be fun to verify, like <a href=\"https://adventofcode.com/2025/day/5\">https://adventofcode.com/2025/day/5</a>. In part 2 of this day the naive solution is not feasible, but a with a bit of thinking you can solve it quite elegantly.</p>",
        "id": 563638120,
        "sender_full_name": "suhr",
        "timestamp": 1765649553
    },
    {
        "content": "<p>And these bits of thinking demand a proof.</p>",
        "id": 563638135,
        "sender_full_name": "suhr",
        "timestamp": 1765649574
    },
    {
        "content": "<p>By the way, here's my solution in K: <a href=\"https://gist.github.com/suhr/4dde948d1d138d56fcc27da892bdb5b8\">https://gist.github.com/suhr/4dde948d1d138d56fcc27da892bdb5b8</a>. Which is basically an application of <a href=\"https://www.jsoftware.com/papers/50/50_05.htm\">https://www.jsoftware.com/papers/50/50_05.htm</a>.</p>",
        "id": 563638240,
        "sender_full_name": "suhr",
        "timestamp": 1765649696
    },
    {
        "content": "<p>Even when specification and the code are basically the same, you can still prove well-formedness, e.g. that you doesn't lookup array outside it bounds.</p>",
        "id": 563640235,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765652083
    },
    {
        "content": "<p>Also, you can do things like, write a program that can enumerate all possible (or some subset of) problems together with their solutions, and then you can prove that your program finds the solution for every problem.</p>",
        "id": 563640383,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765652254
    },
    {
        "content": "<p>The specification of generating a problem from a solution, can be different, then that of finding a solution, so you get an extra check, that these two specification you wrote coincide.</p>",
        "id": 563640445,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765652340
    },
    {
        "content": "<p>Though, in some cases, enumerating possible problems for a given solution can be much more difficult then finding a solution. .-.</p>",
        "id": 563640767,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765652714
    },
    {
        "content": "<p>The problem, properly expressed, is not the same as my solution for any of the problems this year except day 1. Finding a reasonable way to express the spec is the first problem, for me...</p>\n<p>(although the problem for day 12 is NP-complete, so... maybe set that aside for now)</p>",
        "id": 563643219,
        "sender_full_name": "Jason Orendorff",
        "timestamp": 1765655908
    },
    {
        "content": "<p>Jakub, i don't understand - all my solutions give the puzzle input a type, so the possibility space is clearly enumerable (?)</p>",
        "id": 563643290,
        "sender_full_name": "Jason Orendorff",
        "timestamp": 1765656027
    },
    {
        "content": "<p>The problem I've been thinking about today is <a href=\"https://adventofcode.com/2025/day/3\">day 3</a>. It talks about \"the largest possible\" something. The use of the definite article in the question implies at least one such something exists, and that the set is finite...</p>\n<p>Mapping that to Lean isn't super easy</p>",
        "id": 563643543,
        "sender_full_name": "Jason Orendorff",
        "timestamp": 1765656393
    },
    {
        "content": "<p><code>largest (x: α) (p: α → Prop) := p x ∧ ∀y, p y → y ≤ x</code></p>",
        "id": 563643649,
        "sender_full_name": "suhr",
        "timestamp": 1765656581
    },
    {
        "content": "<p>If <code>987654321111111</code> is an a list of digits, then what needed is sublist of a certain length which then is turned into a number.</p>",
        "id": 563643869,
        "sender_full_name": "suhr",
        "timestamp": 1765656927
    },
    {
        "content": "<p>A useful way to think about sublist in this case is selection (as in <a href=\"https://mlochbaum.github.io/BQN/doc/select.html\">https://mlochbaum.github.io/BQN/doc/select.html</a>).</p>",
        "id": 563643976,
        "sender_full_name": "suhr",
        "timestamp": 1765657105
    },
    {
        "content": "<p>Then you basically take advantage of order relation on both indicies (more specifically, remaining choices) and digits.</p>",
        "id": 563644115,
        "sender_full_name": "suhr",
        "timestamp": 1765657302
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306644\">Jason Orendorff</span> <a href=\"#narrow/channel/113488-general/topic/Advent.20of.20Code.20program.20verification.3F/near/563643219\">said</a>:</p>\n<blockquote>\n<p>The problem, properly expressed, is not the same as my solution for any of the problems this year except day 1.</p>\n</blockquote>\n<p>Funny enough, I wrote an informal proof for part 2 in order to debug my solution. It was not effective though, since the bug was in the code, not in how I solved the problem.</p>",
        "id": 563644350,
        "sender_full_name": "suhr",
        "timestamp": 1765657576
    },
    {
        "content": "<p>Here it is: <a href=\"https://gist.github.com/suhr/70f87b73e763b6238403f0abeaa2d675\">https://gist.github.com/suhr/70f87b73e763b6238403f0abeaa2d675</a></p>",
        "id": 563644471,
        "sender_full_name": "suhr",
        "timestamp": 1765657720
    },
    {
        "content": "<p>ok you would not believe what i was doing before, trying to write a spec for day 3, but now I have this</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Spec for Day 3</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Day03</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isLargest</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isSubsequence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ys</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ys</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">decimalValue</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">digits</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">digits</span><span class=\"bp\">.</span><span class=\"n\">reverse</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">zipWith</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"n\">digits</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">sum</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">spec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">candidate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">answers</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isLargest</span><span class=\"w\"> </span><span class=\"n\">answers</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">subs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">isSubsequence</span><span class=\"w\"> </span><span class=\"n\">subs</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">subs</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">decimalValue</span><span class=\"w\"> </span><span class=\"n\">subs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">answers</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">candidate</span><span class=\"w\"> </span><span class=\"n\">input</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">solve1_correct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">spec</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">solve1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">solve2_correct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Input</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">spec</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">solve2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n</div></div>",
        "id": 563646179,
        "sender_full_name": "Jason Orendorff",
        "timestamp": 1765659886
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306644\">Jason Orendorff</span> <a href=\"#narrow/channel/113488-general/topic/Advent.20of.20Code.20program.20verification.3F/near/563643290\">said</a>:</p>\n<blockquote>\n<p>Jakub, i don't understand - all my solutions give the puzzle input a type, so the possibility space is clearly enumerable (?)</p>\n</blockquote>\n<p>Enumerating just inputs will only let you check that the program is well-formed.</p>\n<p>Let's say, you have types <code>Statement</code> and <code>Solution</code> for the input and output of the solution program. So the solution code would be a function <code> solution : Statement → Solution</code>. Nothing interesting so far. Now, what you could do, is write a function <code>statements : Solution → Set Statement</code>. Function <code>statements</code>, given the solution, would generate some statements, for a particular given solution. With these two functions, you can prove <code>∀ sol : Solution, ∀ stmt ∈ statements sol, solution stmt = sol</code>.</p>\n<p>Creating <code>Set Statement</code> of all statements is usually easy. Creating <code>Solution → Set Statement</code> that enumerates all statements for a given solution, is often not easy.</p>\n<p>Of course, you could define <code>statements sol := { stmt : Statement | solution stmt = sol }</code>, but then, the aforementioned proof is just tautology. The point is to write it independently.</p>",
        "id": 563695029,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765725273
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 563695135,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1765725446
    }
]