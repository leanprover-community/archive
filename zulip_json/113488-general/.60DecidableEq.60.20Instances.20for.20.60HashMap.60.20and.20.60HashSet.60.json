[
    {
        "content": "<p>As shown in the code below, <code>HashMap</code> and <code>HashSet</code> do not have <code>DecidableEq</code> instances. I believe it should be possible to provide them (theoretically), but is there any particular reason why they haven't been defined?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Std</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sample1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HashMap</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"s2\">\"hello\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">)]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sample2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HashMap</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"s2\">\"hoge\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> failed to synthesize</span>\n<span class=\"cm\">  Decidable (sample1 = sample2) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">sample1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sample2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sample3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HashSet</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sample4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HashSet</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> failed to synthesize</span>\n<span class=\"cm\">  Decidable (sample3 = sample4) -/</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">sample3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">sample4</span>\n</code></pre></div>",
        "id": 531737187,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1753845030
    },
    {
        "content": "<p>These wouldn't be too hard to add, but equality of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashMap#doc\">docs#Std.HashMap</a> isn't a very useful concept because there can be maps that contain the same mappings but have different internal representations. Are you sure that you want this?</p>\n<p>So perhaps what you are really after is decidability for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashMap.Equiv#doc\">docs#Std.HashMap.Equiv</a>, which is the same as decidable equality on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.ExtHashMap#doc\">docs#Std.ExtHashMap</a>. Adding this is part of the FRO's TODO list for later this year (or if anyone is interested in working on this, feel free to send me a message).</p>",
        "id": 531745568,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1753849935
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> </p>\n<p>Thank you. It seems I didn't understand the difference between <code>ExtHashMap</code> and <code>HashMap</code>.</p>",
        "id": 531761530,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1753858002
    },
    {
        "content": "<p>I cannot resolve this zulip topic...?</p>",
        "id": 531767599,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1753860261
    },
    {
        "content": "<p>We don't use the \"resolve\" feature on this zulip</p>",
        "id": 531767746,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753860313
    },
    {
        "content": "<p>Ruben means: “we no longer use…”. This is a fairly recent change.</p>",
        "id": 531795444,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753868275
    },
    {
        "content": "<p>I’m writing this only to make sure Asei doesn’t think he suddenly became mad after playing too much with Lean.</p>",
        "id": 531795604,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1753868316
    },
    {
        "content": "<p>Decidable equality instance for Std.ExtDHashMap:<br>\n<a href=\"https://gist.github.com/vllladd/bb6b7a284d5d17a95696638ea19c82b2\">https://gist.github.com/vllladd/bb6b7a284d5d17a95696638ea19c82b2</a></p>",
        "id": 532515312,
        "sender_full_name": "Vlad",
        "timestamp": 1754195078
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"934540\">@Vlad</span> nice!!</p>",
        "id": 532515369,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1754195129
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"934540\">Vlad</span> <a href=\"#narrow/channel/113488-general/topic/.60DecidableEq.60.20Instances.20for.20.60HashMap.60.20and.20.60HashSet.60/near/532515312\">said</a>:</p>\n<blockquote>\n<p>Decidable equality instance for Std.ExtDHashMap:<br>\n<a href=\"https://gist.github.com/vllladd/bb6b7a284d5d17a95696638ea19c82b2\">https://gist.github.com/vllladd/bb6b7a284d5d17a95696638ea19c82b2</a></p>\n</blockquote>\n<p>is ithis demonstration true for any alpha and beta ?<br>\n<a href=\"/user_uploads/3121/Bv4Sh88TIIMWwt2Ruc98OMAZ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Bv4Sh88TIIMWwt2Ruc98OMAZ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"498x90\" src=\"/user_uploads/thumbnail/3121/Bv4Sh88TIIMWwt2Ruc98OMAZ/image.png/840x560.webp\"></a></div>",
        "id": 532793197,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754339611
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">ecyrbe</span> <a href=\"#narrow/channel/113488-general/topic/.60DecidableEq.60.20Instances.20for.20.60HashMap.60.20and.20.60HashSet.60/near/532793197\">said</a>:</p>\n<blockquote>\n<p>is ithis demonstration true for any alpha and beta ?</p>\n</blockquote>\n<p><code>toList_empty</code> can be proved with only <code>[BEq α] [Hashable α]</code>, but doing so requires digging into the internal implementation.</p>",
        "id": 532827151,
        "sender_full_name": "Vlad",
        "timestamp": 1754364682
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"934540\">Vlad</span><br>\n<code>toList_empty</code> can be proved with only <code>[BEq α] [Hashable α]</code>, but doing so requires digging into the internal implementation.</p>\n<p>I have trouble doing so. I feel so dumb to not be able to come up to such a simple proof. i tried digging up to the internals with no luck. Because at some point, internals use do notation. And then it becomes a nightmare (for me) :(</p>",
        "id": 532902855,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754395842
    },
    {
        "content": "<p>(isn't it <code>rfl</code>?)</p>",
        "id": 532903215,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1754395957
    },
    {
        "content": "<p>i wish :)</p>",
        "id": 532903323,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754395984
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Hashable</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∅</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">EmptyCollection</span><span class=\"bp\">.</span><span class=\"n\">emptyCollection</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">foldRev_cons</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 532905658,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1754396786
    },
    {
        "content": "<p><code>rfl</code> seems to fail due to <code>Std.DHashMap.Internal.numBucketsForCapacity</code> being private/opaque or something like that...</p>",
        "id": 532906838,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1754397200
    },
    {
        "content": "<p>or at least, that's where i stopped being able to unfold definitions</p>",
        "id": 532906878,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1754397218
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/blob/09e8079ea3a7dd9a57cae5b417c7f2d84c8fcb81/src/Std/Data/DHashMap/Internal/Defs.lean#L158-L160\">https://github.com/leanprover/lean4/blob/09e8079ea3a7dd9a57cae5b417c7f2d84c8fcb81/src/Std/Data/DHashMap/Internal/Defs.lean#L158-L160</a></p>",
        "id": 532907672,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754397537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/113488-general/topic/.60DecidableEq.60.20Instances.20for.20.60HashMap.60.20and.20.60HashSet.60/near/532905658\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Lemmas</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Hashable</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∅</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">EmptyCollection</span><span class=\"bp\">.</span><span class=\"n\">emptyCollection</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">DHashMap</span><span class=\"bp\">.</span><span class=\"n\">Internal</span><span class=\"bp\">.</span><span class=\"n\">Raw</span><span class=\"bp\">.</span><span class=\"n\">foldRev_cons</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>thanks, but i need any beta</p>\n<p>edit: sorry, seems good for my need</p>",
        "id": 532909767,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754398275
    }
]