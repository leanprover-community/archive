[
    {
        "content": "<p>Given the immediate success of my <a href=\"#narrow/channel/113488-general/topic/.60.23where.60.20and.20comments\">previous teaching inspired question</a>, let me try something else.</p>\n<p>This is about hover and, specifically, the <code>declModifier</code> hover and the <code>protected</code> hover in the code below:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"sd\">/-- This is just the multiplication of a group -/</span><span class=\"w\">  </span><span class=\"c1\">-- &lt;--- hover for information about `docComment`</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">MyGroup</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\">  </span><span class=\"c1\">-- &lt;--- hover for information about `declModifiers`</span>\n<span class=\"w\">    </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">G</span>\n</code></pre></div>",
        "id": 479874288,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730380332
    },
    {
        "content": "<p>Here are my observations/questions/feature requests:</p>\n<ul>\n<li>the hover information is great, I really love it and I wish it was available everywhere in the world!</li>\n<li>I would have liked that <code>protected</code> had some \"<code>protected</code>-specific\" hover -- I may PR something for that, since it is likely just a matter of adding a doc-string <a href=\"https://github.com/leanprover/lean4/blob/01d414ac36dc28f3e424dabd36d818873fea655c/src/Lean/Parser/Command.lean#L61-L61\">here</a>.</li>\n<li>However, if I did that, where would I be able to see the very useful <code>declModifiers</code> doc-string?</li>\n</ul>",
        "id": 479874315,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730380347
    },
    {
        "content": "<p>This is where this question turns into a feature request: is there a way of getting a \"primary\" doc-string that would show what a <code>docComment</code> is when hovering over it, but also give the option of clicking/expanding a hover about <code>declModifiers</code>?</p>",
        "id": 479874345,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730380356
    },
    {
        "content": "<p>Ideally, <em>every</em> <code>declModifier</code> would have a doc-string, and then the <code>declModifier</code> doc-string would never show up in a hover!</p>",
        "id": 479874364,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730380362
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/113488-general/topic/Showing.20two.20doc-string/near/479874345\">said</a>:</p>\n<blockquote>\n<p>This is where this question turns into a feature request: is there a way of getting a \"primary\" doc-string that would show what a <code>docComment</code> is when hovering over it, but also give the option of clicking/expanding a hover about <code>declModifiers</code>?</p>\n</blockquote>\n<p>Not right now, no.</p>\n<p>In VS Code, enabling HTML support in the LSP client would enable us to put <code>&lt;details&gt;</code> tags in hovers which could then perhaps be used by the language server to hide optional \"secondary\" hover information (unclear what that would look like as of now). With enabled HTML support, we can already try the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">A short description of `foo`</span>\n\n<span class=\"sd\">&lt;details&gt;</span>\n<span class=\"sd\">&lt;summary&gt;This unfolds a bunch of details about `foo`&lt;/summary&gt;</span>\n\n<span class=\"sd\">A</span>\n\n<span class=\"sd\">bunch</span>\n\n<span class=\"sd\">of</span>\n\n<span class=\"sd\">details</span>\n\n<span class=\"sd\">about</span>\n\n<span class=\"sd\">`foo`</span>\n<span class=\"sd\">&lt;/details&gt;</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>\n<p>Unfortunately, the UX of collapsed text in hovers in VS Code is pretty bad. On hover, we get the following hover panel:<br>\n<a href=\"/user_uploads/3121/rtAAqlbBS6tWyv9PXw4p3QPm/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/rtAAqlbBS6tWyv9PXw4p3QPm/image.png\" title=\"image.png\"><img data-original-dimensions=\"318x94\" src=\"/user_uploads/thumbnail/3121/rtAAqlbBS6tWyv9PXw4p3QPm/image.png/840x560.webp\"></a></div><p>Clicking the button changes the hover panel to the following:<br>\n<a href=\"/user_uploads/3121/flMZBMnisV9UUTTg7CE8eWL-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/flMZBMnisV9UUTTg7CE8eWL-/image.png\" title=\"image.png\"><img data-original-dimensions=\"318x98\" src=\"/user_uploads/thumbnail/3121/flMZBMnisV9UUTTg7CE8eWL-/image.png/840x560.webp\"></a></div><p>Note that we can't see the unfolded text because VS Code did not resize the hover panel to fit the content after we expanded the <code>&lt;details&gt;</code> tag.<br>\nWe first need to manually resize the hover panel by dragging the top right corner of the hover panel to see the hidden details:<br>\n<a href=\"/user_uploads/3121/iivR2vParqwZcapNXVSvdwmH/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/iivR2vParqwZcapNXVSvdwmH/image.png\" title=\"image.png\"><img data-original-dimensions=\"324x266\" src=\"/user_uploads/thumbnail/3121/iivR2vParqwZcapNXVSvdwmH/image.png/840x560.webp\"></a></div><p>So, this is technically possible, but the VS Code UX for it is pretty bad. It's also not clear to me whether other editors (e.g. NeoVim) will be able to work with HTML output by the language server.</p>",
        "id": 479883666,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1730382965
    },
    {
        "content": "<p>Ok, thanks for investigating this so quickly!  I agree that the screenshots that you showed are not a clear improvement and the hovers are currently great, so I would not want to switch to something not as good!</p>",
        "id": 479885102,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730383313
    },
    {
        "content": "<p>I think that, very soon, the specific docstring for <code>protected</code> can contain a link to <a href=\"https://lean-lang.org/doc/reference/latest/find/?domain=Verso.Genre.Manual.section&amp;name=declaration-modifiers\">this page</a>, which will be able to provide further information.</p>",
        "id": 479896651,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1730386538
    },
    {
        "content": "<p>Generally, I think hovers are great for a quick reminder about what something does, but a more in-depth description quickly outgrows them. Would something like that work for you too?</p>",
        "id": 479896833,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1730386580
    },
    {
        "content": "<p>Ah, the verso-way!  That would be also a great addition and would indeed be a perfect answer to my hover question!</p>",
        "id": 479896923,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730386614
    },
    {
        "content": "<p>Great to hear! I'll get back to work :-)</p>",
        "id": 479897027,
        "sender_full_name": "David Thrane Christiansen",
        "timestamp": 1730386645
    },
    {
        "content": "<p>I agree that hovers are more like bookmarks, so if they come with links to actual documentation that would be perfect.</p>",
        "id": 479897054,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1730386653
    }
]