[
    {
        "content": "<p>While preparing a lecture for students, I was surprised that <code>exact?</code> and <code>apply?</code> couldn't find <code>Tendsto.add</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Instances</span><span class=\"bp\">.</span><span class=\"n\">Real</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- apply?</span>\n<span class=\"w\">  </span><span class=\"c1\">-- exact?</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n</code></pre></div>\n<p>I was also surprised that it came up 10th on leansearch with \"If f tends to a and g tends to b then f + g tends to a + b,\" and, as far as I can tell, it doesn't come up on Loogle with the query <code>\"Tendsto\", \"add\" </code>, though Loogle finds lots of other matches. Does anyone have any guesses as to what is going on here?</p>\n<p>By the way, taken together, these search engines represent a quantum leap in usability since I last taught the course two years ago. They are really great. That's why I am surprised they failed me in this case.</p>",
        "id": 479705881,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1730301408
    },
    {
        "content": "<p><code>exact?</code> works on</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Instances</span><span class=\"bp\">.</span><span class=\"n\">Real</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>so I guess the problem is that it cannot see that <code>fun x ↦ f x + g x</code> is the same as <code>f + g</code>.</p>",
        "id": 479707022,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1730301715
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> Filter.Tendsto _ _ (nhds (_ + _))</p>",
        "id": 479707675,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730301886
    },
    {
        "content": "<p><span aria-label=\"search\" class=\"emoji emoji-1f50d\" role=\"img\" title=\"search\">:search:</span> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/Monoid.html#Filter.Tendsto.add_const\">Filter.Tendsto.add_const</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/Monoid.html#Filter.Tendsto.const_add\">Filter.Tendsto.const_add</a>, and <a href=\"https://loogle.lean-lang.org/?q=Filter.Tendsto%20_%20_%20%28nhds%20%28_%20%2B%20_%29%29\">4 more</a></p>",
        "id": 479707679,
        "sender_full_name": "loogle",
        "timestamp": 1730301887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/113488-general/topic/.60exact.3F.60.20and.20.60apply.3F.60.20with.20.60Tendsto.2Eadd.60/near/479707022\">said</a>:</p>\n<blockquote>\n<p>so I guess the problem is that it cannot see that <code>fun x ↦ f x + g x</code> is the same as <code>f + g</code>.</p>\n</blockquote>\n<p>We're quite inconsistent across the filter / derivative library on which spelling we use</p>",
        "id": 479707805,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730301922
    },
    {
        "content": "<p>This also works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">atTop</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">eta_expand</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"n\">exact?</span>\n</code></pre></div>",
        "id": 479708276,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730302029
    },
    {
        "content": "<p>This is an issue with how discrimination trees currently work. <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span>'s refined discrimination tree can deal with this.</p>",
        "id": 479772236,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1730326355
    },
    {
        "content": "<p>Isn't this arguably working as intended, since Pi.instAdd is not reducible, and so <code>fun x ↦ f x + g x</code> matches <code>f + g</code> no more than <code>(a, b) + (c, d)</code> matches <code>(a + c, b + d)</code></p>",
        "id": 479778216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1730330190
    },
    {
        "content": "<p>Would you like to have a version of <code>apply?</code> in mathlib that works with my discrimination tree, similar to my <code>rw??</code> alternative to <code>rw?</code>?</p>",
        "id": 479986040,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1730428044
    }
]