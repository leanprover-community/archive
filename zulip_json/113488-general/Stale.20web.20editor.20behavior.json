[
    {
        "content": "<p>I'm seeing some confusing behavior in the web editor on mathlib stable, where</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"4.13.0\"</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"4.13.0\"</span>\n</code></pre></div>\n<p>shows the <code>eval</code> as being true, but fails the <code>#guard</code></p>",
        "id": 484184322,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486571
    },
    {
        "content": "<p>The UI also seems confused:</p>\n<p><a href=\"/user_uploads/3121/dySFwXpDzhq-12Zl0GNkXPSH/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dySFwXpDzhq-12Zl0GNkXPSH/image.png\" title=\"image.png\"><img data-original-dimensions=\"719x209\" src=\"/user_uploads/thumbnail/3121/dySFwXpDzhq-12Zl0GNkXPSH/image.png/840x560.webp\"></a></div>",
        "id": 484184332,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486592
    },
    {
        "content": "<p>Refreshing and adjusting the dropdown seems to reliably reproduce</p>",
        "id": 484184347,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486612
    },
    {
        "content": "<p>I just tried opening that on the playground and consistently got a <code>false</code> from eval and a failure of the guard</p>",
        "id": 484184440,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732486709
    },
    {
        "content": "<p>Even after switching the playground to \"mathlib stable\"?</p>",
        "id": 484184454,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486729
    },
    {
        "content": "<p>oh, I missed that dropdown</p>",
        "id": 484184474,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732486753
    },
    {
        "content": "<p>with it, both seem to say true</p>",
        "id": 484184478,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732486759
    },
    {
        "content": "<p>I think the failing sequence is:</p>\n<ul>\n<li>Open the example above with the default version</li>\n<li>Switch the dropdown to \"stable\"</li>\n<li>Refresh the page</li>\n</ul>",
        "id": 484184492,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486781
    },
    {
        "content": "<p>indeed, it seems there are now two LSPs running on both versions</p>",
        "id": 484184562,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732486840
    },
    {
        "content": "<p>(where step 3 often happens because I forgot about the tab for a while, and the server shutdown in the meantime)</p>",
        "id": 484184567,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486844
    },
    {
        "content": "<p>I've seen this error a few times now. Somehow there's a second LSP that gives additional underlines, but you <em>don't</em> get messages from it. There's no error message on the <code>#guard</code>, right? just the red squiggle?</p>",
        "id": 484184591,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732486880
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113488-general/topic/Stale.20web.20editor.20behavior/near/484184562\">said</a>:</p>\n<blockquote>\n<p>indeed, it seems there are now two LSPs running on both versions</p>\n</blockquote>\n<p>Ah, you're right; editing the code leads to up-to-date printouts from both versions, not just stale printouts from the old version</p>",
        "id": 484184605,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486903
    },
    {
        "content": "<p>If I do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"4.13.0\"</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">versionString</span><span class=\"w\"> </span><span class=\"bp\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"4.13.0\"</span>\n</code></pre></div>\n<p>I get red squiggles from both</p>",
        "id": 484184654,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1732486926
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>: it looks like the editor is connected to both LSPs, but the infoview is connected to only the right one</p>",
        "id": 484184662,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732486938
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> was guessing that it has to do with <a href=\"https://github.com/leanprover-community/lean4web/issues/41\">https://github.com/leanprover-community/lean4web/issues/41</a></p>",
        "id": 484184670,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732486953
    },
    {
        "content": "<p>Indeed, and <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span>  mentioned that heâ€™ll have a bit more time to work on lean-related stuff the coming weeks.</p>",
        "id": 484238260,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1732524523
    }
]