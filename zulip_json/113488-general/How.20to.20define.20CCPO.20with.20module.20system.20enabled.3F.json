[
    {
        "content": "<p>I defined a CCPO for a custom type and I am trying to port the code to use the module system. However, this does not work at the moment since <code>is_sup</code> and <code>chain</code> are not exposed and I don't see any lemmas for them. The following code illustrates the problem. Is there a way to define a custom CCPO with the module system enabled?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">module</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Order</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MyType</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">MyType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">rel_refl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">rel_trans</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">rel_antisymm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: Tactic `unfold` failed to unfold `is_sup` in</span>\n<span class=\"sd\">  is_sup c ?w</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CCPO</span><span class=\"w\"> </span><span class=\"n\">MyType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">has_csup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"c1\">-- how to proceed? the following fails</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">is_sup</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">error: Tactic `unfold` failed to unfold `chain` in</span>\n<span class=\"sd\">  chain c</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CCPO</span><span class=\"w\"> </span><span class=\"n\">MyType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">has_csup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">   </span><span class=\"c1\">-- how to use hc? the following fails</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">chain</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n</code></pre></div>",
        "id": 571813131,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1770178113
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130195\">@Sebastian Graf</span>, I think this question is for you!</p>",
        "id": 571817221,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1770180912
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> is in a better position to answer :)</p>",
        "id": 571835229,
        "sender_full_name": "Sebastian Graf",
        "timestamp": 1770190893
    },
    {
        "content": "<p>I think it would be up to <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span> to make that call for his API! But given the simplicity of the definitions, I don't see a reason not to.</p>",
        "id": 571850951,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1770195449
    },
    {
        "content": "<p>Yeah, you could just <code>import all Init.Internal.Order.Basic</code> in the meantime but <code>@[expose]</code>ing the relevant definitions would probably also be a good idea</p>",
        "id": 571851563,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770195614
    },
    {
        "content": "<p>Thanks for being “early adoptor” for defining your own CCPO.</p>\n<p>Just to confirm: <span class=\"user-mention\" data-user-id=\"574718\">@Michael Sammler</span> , you are instantiating this type class for the purpose of <code>partial_fixpoint</code>, and not because you want to do general domain theory, right?</p>\n<p>But yes, I admit I didn't think about this use case too much when writing the file. Anyone here interested in writing a PR to identify and expose the relevant bits? (there is also a test or two in the lean repo instantiating CCPO, so maybe make that a <code>module</code> as part of the PR)</p>",
        "id": 571853884,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1770196115
    },
    {
        "content": "<p>Thank you all for the quick responses!</p>\n<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20define.20CCPO.20with.20module.20system.20enabled.3F/near/571853884\">said</a>:</p>\n<blockquote>\n<p>Just to confirm: <span class=\"user-mention silent\" data-user-id=\"574718\">Michael Sammler</span> , you are instantiating this type class for the purpose of <code>partial_fixpoint</code>, and not because you want to do general domain theory, right?</p>\n</blockquote>\n<p>Yes. I have a custom library for co-inductive types in Lean and by defining a custom CCPO instance one can write recursive definitions of these co-inductive types in a very nice way. I think <code>partial_fixpoint</code> is a really cool feature of Lean and it would be sad to lose it by the switch to the module system.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/113488-general/topic/How.20to.20define.20CCPO.20with.20module.20system.20enabled.3F/near/571853884\">said</a>:</p>\n<blockquote>\n<p>But yes, I admit I didn't think about this use case too much when writing the file. Anyone here interested in writing a PR to identify and expose the relevant bits? (there is also a test or two in the lean repo instantiating CCPO, so maybe make that a <code>module</code> as part of the PR)</p>\n</blockquote>\n<p>If nobody beats me to it, I would be happy to create this PR.</p>",
        "id": 571854984,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1770196404
    },
    {
        "content": "<p>Thanks! Ping me on it and I’ll review it.</p>",
        "id": 571855195,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1770196453
    },
    {
        "content": "<p>Done in <a href=\"https://github.com/leanprover/lean4/pull/12311\">https://github.com/leanprover/lean4/pull/12311</a></p>",
        "id": 571918344,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1770213747
    }
]