[
    {
        "content": "<p>Why does Lean show me the goal <code>bla = </code>bla` and not what i think to have specified?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"c1\">-- opaque P : Calculus -&gt; Prop</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n\n\n\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"sd\">/-- A base spec is made a calculus by extending it with some arbitrary parameter</span>\n<span class=\"sd\">      and converting that. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toExtendSpecification</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toExtendSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span>\n\n\n<span class=\"c1\">-- i originally wanted to use this as a simp lemma, but i think it doesn't prove what i think it does..</span>\n<span class=\"c1\">-- goal and theorem hover shows `⊢ P e.toCalc ↔ P e.toCalc`</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>If one makes <code>P</code> opaque, then the proof by rfl doesnt go through, but i still get the wrong goal and the wrong theorem.<br>\nI wanted to use this theorem for rewriting, but it gets simplified to <code>bla = bla</code> somehow</p>",
        "id": 576096491,
        "sender_full_name": "Moritz R",
        "timestamp": 1772130912
    },
    {
        "content": "<p><code>toCalc</code> elaborates to your rhs under the hood, there is no difference between the two (when using projections of the parent of a structure that was defined with <code>structure Foo extends Bar</code> implicitly resolving to a chain of projections is the intended behavior). The infoview recovers the goals you can see by looking at elaborated low level expressions (after all not all expressions in a goal are created from syntax but usually directly through meta programs) and trying to guess a syntax that could've produced this low level expression. Because both terms elaborate to the exact same expression it guesses the same resulting expression.</p>",
        "id": 576097352,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772131188
    },
    {
        "content": "<p>I guess there is an argument to be made to change the parent projection elaborator to not do this but the goal its showing is at least faithful to what is actually happening^^</p>",
        "id": 576097727,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772131297
    },
    {
        "content": "<p>It is faithful in the sense of showing defeq things, but that really is not faithful</p>",
        "id": 576098262,
        "sender_full_name": "Moritz R",
        "timestamp": 1772131477
    },
    {
        "content": "<p>No this is not about definitional equality, they are <em>syntactically equal</em> at the <code>Expr</code> level</p>",
        "id": 576098522,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772131547
    },
    {
        "content": "<p>oh what</p>",
        "id": 576098666,
        "sender_full_name": "Moritz R",
        "timestamp": 1772131596
    },
    {
        "content": "<p>That's what I was trying to get at, the declaration <code>ExtendedSpecification.toCalc</code> <em>syntactically</em> elaborates to <code>BaseSpecification.toCalc e.toBaseSpecification</code>, there is no difference on the <code>Expr</code> level.</p>",
        "id": 576098805,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772131635
    },
    {
        "content": "<p>Sorry i don't get how lean does this.<br>\nIf i instead inline the definition i get the goal that i expect</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toExtendSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Why is the goal here different?</p>",
        "id": 576102494,
        "sender_full_name": "Moritz R",
        "timestamp": 1772132698
    },
    {
        "content": "<p>this sounds very suspicious</p>",
        "id": 576103464,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772133030
    },
    {
        "content": "<p>Maybe the difference  has to do with parsing of dot notation? Maybe som <code>fun</code> is inserted which makes the terms not elab identically?</p>",
        "id": 576103547,
        "sender_full_name": "Moritz R",
        "timestamp": 1772133061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20shows.20me.20the.20wrong.20goal.3F/near/576098805\">said</a>:</p>\n<blockquote>\n<p>That's what I was trying to get at, the declaration <code>ExtendedSpecification.toCalc</code> <em>syntactically</em> elaborates to <code>BaseSpecification.toCalc e.toBaseSpecification</code>, there is no difference on the <code>Expr</code> level.</p>\n</blockquote>\n<p>This is false, they are different terms but are pretty printing the same</p>",
        "id": 576103933,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772133194
    },
    {
        "content": "<p>Interesting, David recently told me about this behavior and added special support for it in doc-gen because he observed that behavior.</p>",
        "id": 576104068,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772133235
    },
    {
        "content": "<p>if you have <code>a : A</code> and a function <code>B.foo</code> and <code>A extends B</code> then <code>B.foo a.toB</code> will pretty print as <code>a.foo</code></p>",
        "id": 576104213,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772133284
    },
    {
        "content": "<p>in this case <code>A.foo</code> also exists and <code>A.foo a</code> also pretty prints as <code>a.foo</code></p>",
        "id": 576104405,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1772133348
    },
    {
        "content": "<p>Ah, david told me about a feature very specifically related to projections where this happens</p>",
        "id": 576104768,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772133461
    },
    {
        "content": "<p>I had mistakenly assumed without reading enough that toCalc is a projection where this would indeed be true. But here the expression is actually different then. Regardless the root cause for why you see a funny goal remains the same, the delaborator guesses the same syntax.</p>",
        "id": 576104905,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772133514
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toA</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>this is the specific situation I had in mind (and accidentally pattern matched on to*)</p>",
        "id": 576105370,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772133681
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20shows.20me.20the.20wrong.20goal.3F/near/576105370\">schrieb</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toA</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>this is the specific situation I had in mind (and accidentally pattern matched on to*)</p>\n</blockquote>\n<p>I think for this situation it makes a lot of sense</p>",
        "id": 576105924,
        "sender_full_name": "Moritz R",
        "timestamp": 1772133849
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20shows.20me.20the.20wrong.20goal.3F/near/576104213\">schrieb</a>:</p>\n<blockquote>\n<p>if you have <code>a : A</code> and a function <code>B.foo</code> and <code>A extends B</code> then <code>B.foo a.toB</code> will pretty print as <code>a.foo</code></p>\n</blockquote>\n<p>But i think this is a bit dangerous</p>",
        "id": 576105974,
        "sender_full_name": "Moritz R",
        "timestamp": 1772133864
    },
    {
        "content": "<p>I agree, there is probably some heuristic in the delaborator for dot notation on structures that's messing up to differentiate these situations a bit better. Maybe <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> has an idea for what to do here?</p>",
        "id": 576108211,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772134549
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/channel/113488-general/topic/Lean.20shows.20me.20the.20wrong.20goal.3F/near/576104068\">said</a>:</p>\n<blockquote>\n<p>Interesting, David recently told me about this behavior and added special support for it in doc-gen because he observed that behavior.</p>\n</blockquote>\n<p>Could you point me to this change?</p>",
        "id": 576112225,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1772135906
    },
    {
        "content": "<p>That was a wrong asessment by me only related to this type of behavior:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">toA</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>the <code>to*</code> functions above are not the ones auto derived for extends but manually written out so my comment doesn't apply.</p>",
        "id": 576112402,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772135968
    },
    {
        "content": "<p>What's the pretty printer getting wrong? Both of these are true:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 576112975,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1772136149
    },
    {
        "content": "<p>By the way, you can use <code>set_option pp.fieldNotation false</code> rather than <code>pp.raw</code> to debug dot notation issues. It's a lot easier to read!</p>",
        "id": 576113031,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1772136168
    },
    {
        "content": "<p>Certainly for <code>simp</code> purposes it's inconvenient that the pretty printed form isn't reducibly defeq:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">with_reducible</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">with_reducible</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 576113677,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1772136390
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>in this statement the <code>ExtendedSpecification.toCalc</code> is not necessarily the same as the <code>BaseSpecification.toCalc</code> (they are two different functions that could have different bodies) but if you inspect the pretty printed goal you see <code>P e.toCalc ↔ P e.toCalc</code>. Consider this version where the theorem is not provable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">c2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toExtendSpecification</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">extra</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Calculus</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">c2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExtendedSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">BaseSpecification</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toBaseSpecification</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>the goal still reads</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ExtendedSpecification</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toCalc</span>\n</code></pre></div>",
        "id": 576114134,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1772136545
    }
]