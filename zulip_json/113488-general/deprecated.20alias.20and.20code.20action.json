[
    {
        "content": "<p>It looks like a line like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2024-07-20\"</span><span class=\"o\">)</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">pow_ne_one_of_lt_orderOf'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pow_ne_one_of_lt_orderOf</span>\n</code></pre></div>\n<p>has the effect to get a yellow squiggle and a black strike-through in VS-code (and a message) when the deprecated name is used, but instead of offering to replace by the new name, the pop-up says \"No quick fix available\" (this is on VSCode). I remember that some time ago, one could get the replacement by clicking on a \"quick fix\" message. Could this be reinstated?</p>",
        "id": 452890108,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721503828
    },
    {
        "content": "<p>I thought that was supposed to work, yeah</p>",
        "id": 452890215,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1721503884
    },
    {
        "content": "<p>Are you sure you aren't using <code>to_additive</code> simultaneously?</p>",
        "id": 452890346,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1721503924
    },
    {
        "content": "<p>Something like <code>@[to_additive, deprecated (since := \"2024-07-20\")] alias pow_ne_one_of_lt_orderOf' := pow_ne_one_of_lt_orderOf</code> will NOT register the additive alias as a deprecated version of the additive lemma</p>",
        "id": 452890404,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1721503972
    },
    {
        "content": "<p>It is not specific to this precise renaming. (And the corresponding line for the additive version is also there.)</p>",
        "id": 452890415,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721503979
    },
    {
        "content": "<p>In fact, I had it happen with <code>ZMod.nat_cast_zmod_eq_zero_iff_dvd</code>--&gt; <code>ZMod.natCast_zmod_eq_zero_iff_dvd</code> just now.</p>",
        "id": 452890527,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721504033
    },
    {
        "content": "<p>The pop-up message says</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>`ZMod.nat_cast_zmod_eq_zero_iff_dvd` has been deprecated, use `ZMod.natCast_zmod_eq_zero_iff_dvd` insteadLean 4\nZMod.nat_cast_zmod_eq_zero_iff_dvd (a b : ℕ) : ↑a = 0 ↔ b ∣ a\nAlias of ZMod.natCast_zmod_eq_zero_iff_dvd.\n\nimport Mathlib.Data.ZMod.Basic\n\nNo quick fixes available\n</code></pre></div>",
        "id": 452890683,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721504110
    },
    {
        "content": "<p>I.e., it \"knows\" what the fix would be, but doesn't provide a one-click option to perform it.</p>",
        "id": 452890729,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721504140
    },
    {
        "content": "<p>are you importing <code>Batteries.CodeAction</code>?</p>",
        "id": 452891495,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721504807
    },
    {
        "content": "<p>Is this implied by <code>import Mathlib.Tactic</code>?</p>",
        "id": 452892828,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721505709
    },
    {
        "content": "<p>Anyway, adding the import does not change this behavior.</p>",
        "id": 452893096,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721505854
    },
    {
        "content": "<p>MWE?</p>",
        "id": 452939423,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1721536464
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Alias</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n</code></pre></div>\n<p>Infoview: <code> `bar` has been deprecated, use `foo` instead</code></p>\n<p>Hover (on <code>bar</code> in the example):</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>`bar` has been deprecated, use `foo` instead       Lean 4\nbar : True\nAlias of foo.\n\nView Problem (Alt + F8)         No quick fixes available\n</code></pre></div>",
        "id": 452958355,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721549686
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> <code>#min_imports</code> didn't do anything here (with <code>import Mathlib</code> at the beginning).</p>",
        "id": 452960767,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721551962
    },
    {
        "content": "<p>(The <code>(since := ...)</code> part is not relevant. Removed in the MWE above.)</p>",
        "id": 452960916,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721552055
    },
    {
        "content": "<p>The new command needs <code>import Mathlib.Tactic.MinImports</code> and then it is per declaration and with <code>in</code>, so <code>#min_imports in ...</code> and examples are only supported for syntax/tactics currently.</p>",
        "id": 452962026,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721553012
    },
    {
        "content": "<p>The per file new <code>#min_imports</code> is a linter, but is still in development.</p>",
        "id": 452962060,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721553054
    },
    {
        "content": "<p>Here is an extended example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c1\">-- `#min_imports in` really likes `Lean.Parser.Command`:</span>\n<span class=\"c1\">-- I know about this, but have not managed to fix it yet</span>\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\">  </span><span class=\"c1\">-- import Lean.Parser.Command</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\">  </span><span class=\"c1\">-- import Batteries.Tactic.Alias</span>\n<span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"c1\">-- `example`s do not leave a trace in the environment,</span>\n<span class=\"c1\">-- so `#min_imports (in)` does not detect their `Expr` information</span>\n<span class=\"c1\">-- I plan to fix this for `#min_imports in`, so that it can detect</span>\n<span class=\"c1\">-- when `example`s increase the imports</span>\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\">  </span><span class=\"c1\">-- import Lean.Parser.Command</span>\n\n<span class=\"c1\">-- import Batteries.Tactic.PermuteGoals</span>\n<span class=\"c1\">-- import Mathlib.Tactic.ExtractGoal</span>\n<span class=\"c1\">-- import Mathlib.Data.Nat.Notation</span>\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\">  </span><span class=\"c1\">-- still sees the tactic/Syntax information</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">extract_goal</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">on_goal</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n\n<span class=\"c1\">-- nothing</span>\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span>\n</code></pre></div>",
        "id": 452969814,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721557604
    },
    {
        "content": "<p>I was just trying <code>#min_imports</code> at the end of the file. I need to get used to <code>#min_imports in</code>, I guess <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 452976300,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721563028
    },
    {
        "content": "<p>In case you find it useful, <code>#min_imports in</code> just received an upgrade: now it should handle better instances (named or nameless) and attributes.</p>",
        "id": 452990930,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1721571786
    },
    {
        "content": "<p>Another observation: in the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>VSCode would shoe a blue lightbulb with code actions (like inserting a skeleton for the structure) on the left on top of <code>example</code>. Now I get the error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>don't know how to synthesize placeholder\ncontext:\n⊢ A\n</code></pre></div>\n<p>How do I get the blue lightbulb back?</p>",
        "id": 452999954,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721576425
    },
    {
        "content": "<p>I think I may have broken this by replacing an <code>import Batteries</code> with finer imports. I'm still away from a computer, but if you could check whether adding <code>import Batteries</code> fixes this minimisation that would be great.</p>",
        "id": 453027462,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721588549
    },
    {
        "content": "<p>If so, let's work out the exact import required, add that back to something like <code>Tactic.Basic</code> (or even lower?), and ideally even comment the import explaining which code action it enables so I don't accidentally remove it again!</p>",
        "id": 453027463,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1721588549
    },
    {
        "content": "<p><code>import Batteries</code> indeed fixes the problem with the missing blue lightbulb.</p>",
        "id": 453031205,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721590274
    },
    {
        "content": "<p>(I had assumed that <code>Mathlib</code> imports (all of) <code>Batteries</code>, but it seems I'm mistaken.)</p>",
        "id": 453031277,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721590313
    },
    {
        "content": "<p><code>import Batteries.CodeAction</code> is sufficient.</p>",
        "id": 453031354,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1721590351
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/113488-general/topic/deprecated.20alias.20and.20code.20action/near/453027463\">said</a>:</p>\n<blockquote>\n<p>If so, let's work out the exact import required, add that back to something like <code>Tactic.Basic</code> (or even lower?), and ideally even comment the import explaining which code action it enables so I don't accidentally remove it again!</p>\n</blockquote>\n<p>Done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/15003\">#15003</a></p>",
        "id": 453099956,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1721632586
    }
]