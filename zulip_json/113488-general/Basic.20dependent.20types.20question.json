[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">()</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>Why does <code>f</code> typecheck, but <code>f'</code> doesn't?</p>",
        "id": 520994261,
        "sender_full_name": "James Sully",
        "timestamp": 1748477286
    },
    {
        "content": "<p><code>match</code> replaces <code>b</code> in the expected type with each case, but for <code>if</code> the expected type is <code>T b</code> in both cases. When <code>b</code> is replaced with <code>true</code>/<code>false</code>, then <code>T b</code> reduces to <code>Nat</code> or <code>Unit</code>.</p>",
        "id": 520994446,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748477397
    },
    {
        "content": "<p>Thanks. Is there some reason <code>if</code> can't do the same thing?</p>",
        "id": 520994568,
        "sender_full_name": "James Sully",
        "timestamp": 1748477475
    },
    {
        "content": "<p>workaround:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hNat</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hUnit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hUnit</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>",
        "id": 520995034,
        "sender_full_name": "James Sully",
        "timestamp": 1748477794
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"621161\">James Sully</span> <a href=\"#narrow/channel/113488-general/topic/Basic.20dependent.20types.20question/near/520994568\">said</a>:</p>\n<blockquote>\n<p>Is there some reason <code>if</code> can't do the same thing?</p>\n</blockquote>\n<p>The basic reason is that <code>if</code> is not encoded in a way where the return type can depend on the condition value.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">ite</span>\n<span class=\"c1\">-- ite.{u} {α : Sort u} (c : Prop) [h : Decidable c] (t e : α) : α</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">dite</span>\n<span class=\"c1\">-- dite.{u} {α : Sort u} (c : Prop) [h : Decidable c] (t : c → α) (e : ¬c → α) : α</span>\n</code></pre></div>\n<p>It's just <code>α</code> no matter what <code>c</code>, <code>t</code>, and <code>e</code> are.</p>",
        "id": 520995714,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748478232
    },
    {
        "content": "<p>then you can do <code>#print f'</code> to check what the term actually was</p>",
        "id": 520995773,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748478246
    },
    {
        "content": "<p>recall that tactics are just fancy ways to generate terms</p>",
        "id": 520995834,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748478290
    },
    {
        "content": "<p>The <code>if</code> <em>could</em> insert casts in the <code>t</code> and <code>e</code> cases, but casts make reasoning harder.</p>\n<p>Plus, <code>b</code> is a bool and <code>if</code> expects a Prop, so <code>b</code> is 'actually' <code>b = true</code>. Should <code>if</code> have special knowledge of bool and undo the coercion to find <code>b</code> and then look for occurrences of <code>b</code> in the expected types to replace with <code>true</code>/<code>false</code>? How often do arbitrary <code>if</code> conditions appear in expected types?</p>",
        "id": 520995914,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748478361
    },
    {
        "content": "<p>For <code>match</code>, the usual case is matching on a variable. For <code>if</code>, the usual case is a complex condition.</p>",
        "id": 520996036,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748478427
    },
    {
        "content": "<p>Thanks, that's helpful, although I don't fully grasp what's going on.</p>",
        "id": 521008564,
        "sender_full_name": "James Sully",
        "timestamp": 1748487032
    }
]