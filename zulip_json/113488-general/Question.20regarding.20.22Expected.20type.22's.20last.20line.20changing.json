[
    {
        "content": "<p>Hi, this is my first message on zulip and I'm not sure if this is the appropriate place to ask a noob question. Please move or remove if this is not the right place.</p>\n<p>The question is about why the last line of the \"Expected type\" message changes when you are inside a <code>calc</code> block.</p>\n<p>I'm following <a href=\"https://www.youtube.com/playlist?list=PLqzHL8yKB2U_gwPqQDfDSD0d_t3RtoiaM\">this YouTube series about Lean</a> and in the 6th chapter they use <a href=\"https://live.lean-lang.org/#code=import%20Mathlib.Tactic%0D%0A%0D%0Aexample%20%7Ba%20b%20%3A%20%E2%84%A4%7D%20%28h1%20%3A%20a%20%3D%20b%20%2B%201%29%20%28h2%3A%20b%20-%201%20%3D%200%29%20%3A%20a%20%3D%202%20%3A%3D%0D%0A%20%20have%20h3%3A%20b%20%3D%201%20%3A%3D%20by%20linarith%20%5Bh2%5D%0D%0A%20%20calc%0D%0A%20%20%20%20a%20%3D%20b%20%2B%201%20%3A%3D%20by%20rw%20%5Bh1%5D%0D%0A%20%20%20%20_%20%3D%201%20%2B%201%20%3A%3D%20by%20rw%20%5Bh3%5D%0D%0A%20%20%20%20_%20%3D%202%20%3A%3D%20by%20norm_num%0D%0A\">this very simple example</a>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h3</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>I noticed that when you are in a line inside a 'calc' block: the last line changes from the goal \"⊢ a = 2\" to \"⊢ ℤ\".<br>\nI guess it's because the calc block only \"needs\" (&lt;- not sure what the correct term is) that the result is an integer, because we've declared 'a' as an integer, and the \"Expected type\" shows the \"subtype\" (again, not sure the correct terms) of the 'calc' block. Is that right?</p>\n<p><a href=\"https://www.youtube.com/watch?v=uC-vc8cWmMc&amp;lc=Ugw8khRpsfIdgMFtEgB4AaABAg\">I posted the question on the YT video</a> and they sent me here. Thanks for the help!</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"uC-vc8cWmMc\" href=\"https://www.youtube.com/watch?v=uC-vc8cWmMc&amp;lc=Ugw8khRpsfIdgMFtEgB4AaABAg\"><img src=\"https://uploads.zulipusercontent.net/74b23354ee535a09169a1119cfeccaa5e4701806/68747470733a2f2f692e7974696d672e636f6d2f76692f75432d76633863576d4d632f64656661756c742e6a7067\"></a></div>",
        "id": 465036774,
        "sender_full_name": "Crul",
        "timestamp": 1724613538
    },
    {
        "content": "<p>It depends on where your cursor is inside the calc block.<br>\nTry putting your cursor at the very beginning of a line in the calc block and moving it to right and watch as the expected type changes.</p>",
        "id": 465041574,
        "sender_full_name": "Eric Paul",
        "timestamp": 1724618277
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"512030\">@Eric Paul</span> Yeah, I realized it changes in other places, but I preferred to keep the question simple.<br>\nSeeing what happens when I move the cursor reinforces my intuition that the \"Expected type\" depends on the context (closure?) but I would prefer to read a technical explanation and learn the proper terms so I can better search for help when needed.<br>\nThanks.</p>",
        "id": 465081508,
        "sender_full_name": "Crul",
        "timestamp": 1724647797
    },
    {
        "content": "<p>I too am interested in this question.</p>",
        "id": 465730406,
        "sender_full_name": "rzeta0",
        "timestamp": 1724842933
    },
    {
        "content": "<p>I'm not sure what the question is, beyond what Eric Paul has already answered above. Could you clarify?</p>",
        "id": 465868391,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1724889774
    },
    {
        "content": "<p>Probably I don't know enough to understand something that is very obvious for mathematicians; Eric Paul just said that \"it depends on where the cursor is\", which I already knew and that I should try moving the cursor, which I already did but I did not understand the underlying logic.</p>\n<p>I'm not even sure I know enough to properly formulate the question, but I will give it another try:</p>\n<ul>\n<li>When you move the cursor, the [last line of the] \"Expected type\" message changes. What is the underlying logic to determine it?</li>\n</ul>\n<p>Thanks!</p>",
        "id": 465905908,
        "sender_full_name": "Crul",
        "timestamp": 1724906812
    },
    {
        "content": "<p>In order for lean to successfully parse what you are writing, it should be type-correct.  Whenever lean is expecting a specific type, since otherwise it knows that it will be a type error, it tells you what it expects at that point.</p>\n<p>Does this help?</p>",
        "id": 465912908,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1724910392
    },
    {
        "content": "<p>Kind-of ... I just realized that Lean is based on dependent type theory, which is something I still don't understand. So that explains why I'm so lost.</p>\n<p>I will try again once I have some idea about dependent type theory.<br>\nThanks again.</p>",
        "id": 465913658,
        "sender_full_name": "Crul",
        "timestamp": 1724910825
    }
]