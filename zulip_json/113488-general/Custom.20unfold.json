[
    {
        "content": "<p>Hello,</p>\n<p>for my library on <a href=\"https://github.com/ecyrbe/lean-units/tree/main\">dimensional analysis and units</a>, i have used <code>@[simp]</code> to allow to unfold derived definitions for simp, like this :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inch</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineDerivedUnit</span><span class=\"w\"> </span><span class=\"s2\">\"in\"</span><span class=\"w\"> </span><span class=\"n\">meter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Conversion</span><span class=\"bp\">.</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">254</span><span class=\"bp\">/</span><span class=\"mi\">10000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">))</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foot</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineDerivedUnit</span><span class=\"w\"> </span><span class=\"s2\">\"ft\"</span><span class=\"w\"> </span><span class=\"n\">inch</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Conversion</span><span class=\"bp\">.</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">))</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">yard</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineDerivedUnit</span><span class=\"w\"> </span><span class=\"s2\">\"yd\"</span><span class=\"w\"> </span><span class=\"n\">foot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Conversion</span><span class=\"bp\">.</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">))</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mile</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineDerivedUnit</span><span class=\"w\"> </span><span class=\"s2\">\"mi\"</span><span class=\"w\"> </span><span class=\"n\">yard</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Conversion</span><span class=\"bp\">.</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1760</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>And i use it to unfold the definition, so that simp will unfold the <code>derived units</code> into their <code>base units</code> recusively automatically to be able to have a simple tactic that simplify the units and apply <code>module</code> tactic in the end.<br>\nlike this :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"auto_dim\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">           </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ùíü</span><span class=\"o\">,</span><span class=\"n\">HasDimension</span><span class=\"bp\">.</span><span class=\"n\">dimension</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">instHMul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">instHDiv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">instHPow</span><span class=\"o\">,</span>\n<span class=\"w\">                      </span><span class=\"n\">HasEquiv</span><span class=\"bp\">.</span><span class=\"n\">Equiv</span><span class=\"o\">,</span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">instSetoidUnit</span><span class=\"o\">]</span>\n<span class=\"w\">             </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"w\">    </span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Is there a way to evoid using <code>@[simp]</code> or have a custom <code>@[simp-derived]</code> so that i can run <code>simp</code> with only the definitions marked with it ?</p>",
        "id": 537152555,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756749240
    },
    {
        "content": "<p>Take a look at custom simp sets</p>\n<p>All you have to do is write something like this in one module</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">mySimpSetExt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpExtension</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span>\n<span class=\"w\">  </span><span class=\"n\">registerSimpAttr</span><span class=\"w\"> </span><span class=\"ss\">`my_simp_set</span>\n<span class=\"w\">    </span><span class=\"s2\">\"lemmas for my application\"</span>\n</code></pre></div>\n<p>and then in another module start using <code>@[my_simp_set]</code> and <code>simp [my_simp_set]</code>. It has to be imported, it can't be done in the same module.</p>",
        "id": 537152970,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756749440
    },
    {
        "content": "<p>Thank you very much, exactly what i need!</p>",
        "id": 537153050,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756749492
    }
]