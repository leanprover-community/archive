[
    {
        "content": "<p>For a talk, I made an animation of the elaboration of <a href=\"https://gist.github.com/hrmacbeth/6709e6fd768e75afb0ddf44a2f9502e3\">this definition</a> (which is a toy model for Mathlib's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContinuousLinearMap.adjoint#doc\">docs#ContinuousLinearMap.adjoint</a>).  It is a time-lapse of the assignment of metavariables.</p>\n<p><a href=\"/user_uploads/3121/1ojan1q8dn2bYKVnqpHzfpG3/elaboration.gif\">elaboration.gif</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/1ojan1q8dn2bYKVnqpHzfpG3/elaboration.gif\" title=\"elaboration.gif\"><img data-animated=\"true\" data-original-dimensions=\"1166x945\" src=\"/user_uploads/thumbnail/3121/1ojan1q8dn2bYKVnqpHzfpG3/elaboration.gif/840x560-anim.webp\"></a></div>",
        "id": 479126770,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730029199
    },
    {
        "content": "<p>This is really nice! Is the information about how elaboration proceeds here extracted from something Lean is actually doing? If so, can you share how you extracted it?</p>",
        "id": 479183735,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1730080373
    },
    {
        "content": "<p>Thanks!  Yes, I went through the output of <code>trace.profiler</code> to get this.  The information isn't available directly but I was able to guess it.  For example, from</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[Elab.step] [0.001040] expected type: LinearIsometryEquiv ?m.1450 ?m.1451 ?m.1453, term\n    postcompose _ _ (compose (riesz F) (postcompose _ _ conj))\n</code></pre></div>\n<p>...</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>  [Meta.isDefEq] [0.000073] ✅️ LinearIsometryEquiv ?m.1450 ?m.1451\n        ?m.1453 =?= LinearIsometryEquiv (LinearMap ?m.1465 ?m.1466 ?m.1468) (LinearMap ?m.1465 ?m.1467 ?m.1470)\n        ?m.1469\n</code></pre></div>\n<p>(which was the first appearance of the metavariables ?m.1465, ?m.1466, ?m.1467, ?m.1468, ?m.1469 and ?m.1470) I guessed that those metavariables were created as placeholders on the top left usage of <code>postcompose</code>, and that the first thing happening there was that it was being unified with the pattern coming from its parent in the tree.  Same ideas to guess the \"position\" for all the other metavariables.</p>\n<p>A few lines later we have</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>[Meta.isDefEq.assign] [0.000006] ✅️ ?m.1465 := E\n[Meta.isDefEq.assign] [0.000005] ✅️ ?m.1466 := F\n[Meta.isDefEq.assign] [0.000005] ✅️ ?m.1468 := pos\n[Meta.isDefEq.assign] [0.000012] ✅️ ?m.1451 := LinearMap ?m.1465 ?m.1467 ?m.1470\n[Meta.isDefEq.assign] [0.000005] ✅️ ?m.1453 := ?m.1469\n</code></pre></div>\n<p>showing that that particular unification step resulted in the assignment of the metavariables ?m.1465, ?m.1466, ?m.1468, ?m.1451, ?m.1453.  I tracked this kind of thing throughout by extracting the full list of <code>Meta.isDefEq.assign</code> steps.</p>\n<p>Finally I subtracted 1450 from every metavariable's name so that the numbers were smaller :-)</p>",
        "id": 479269283,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730120217
    },
    {
        "content": "<p>I had <a href=\"#narrow/channel/113488-general/topic/Metavariables.20in.20profiler\">asked</a> last week about tracing this, and it indeed seems that there is no direct tool, but I got a lot of hints about using the profiler better.</p>",
        "id": 479269634,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1730120319
    }
]