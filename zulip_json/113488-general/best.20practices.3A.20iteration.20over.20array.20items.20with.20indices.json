[
    {
        "content": "<p>What's the most idiomatic way of iterating over all array items with their corresponding index? Something akin to Python's <code>enumerate(array, 1)</code>.<br>\nOne way is the following, but I can't help wondering if there's something better.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"c1\">-- work with index and item</span>\n<span class=\"w\">    </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 467830376,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1725536776
    },
    {
        "content": "<p>Take a look at the Lean tutorial <a href=\"https://lean-lang.org/functional_programming_in_lean/title.html#functional-programming-in-lean\">Functional Programming in Lean</a>, in particular the section titled <a href=\"https://lean-lang.org/functional_programming_in_lean/programs-proofs/arrays-termination.html#proving-termination\">Proving Termination</a>.</p>\n<p>Yes you may have to read the entire tutorial to understand the noted section but if you plan to create programs with Lean it is worth the effort even if it takes a few days or more.</p>",
        "id": 467835169,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1725537908
    },
    {
        "content": "<p>I think that you might get some suggestions from <a href=\"#narrow/stream/270676-lean4/topic/improving.20Array.20indexing.20in.20for.20loops\">this topic</a>.</p>",
        "id": 467837092,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1725538401
    },
    {
        "content": "<p>Thanks to both of you! I'm going with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">array</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"o\">[</span><span class=\"n\">idx</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- work with index and item</span>\n</code></pre></div>",
        "id": 467865366,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1725544393
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array.zipWithIndex#doc\">docs#Array.zipWithIndex</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">item</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">array.zipWithIndex</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>(untested)</p>",
        "id": 468232833,
        "sender_full_name": "Jz Pan",
        "timestamp": 1725640523
    },
    {
        "content": "<p>Strangely,  <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.enum#doc\">docs#List.enum</a> puts the pairs in the opposite order</p>",
        "id": 468537469,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725787387
    },
    {
        "content": "<p>It is possibly not too late to fix that. I'm starting soon on making the <code>List</code>/<code>Array</code> APIs more consistent. Besides the churn, does anyone see a downside of flipping <code>List.enum</code>?</p>",
        "id": 468638393,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725836164
    },
    {
        "content": "<p>(I recall finding the current order slightly unergonomic recently, but can't remember where.)</p>",
        "id": 468638412,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725836186
    },
    {
        "content": "<p>The nice thing about the current order is that you get an obvious lex order on the elements of the attach subtype</p>",
        "id": 468639054,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1725836717
    },
    {
        "content": "<p><code>enum</code> also matches the order of Python's <code>enumerate</code></p>",
        "id": 468639216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725836842
    },
    {
        "content": "<p>Perhaps the only reason for the disparity is that it is hard to say \"indexWithZip\" because of English word order. :-)</p>",
        "id": 468640299,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1725837800
    },
    {
        "content": "<p>Taking a step back: is <code>array.zipWithIndex</code> actually an efficient way to do this looping? In python, <code>enumerate</code> returns an iterator, not an <code>list</code> - presumably allocating an <code>Array</code> of pairs is wasteful here?</p>",
        "id": 468640561,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1725838025
    },
    {
        "content": "<p>What about the best practice for tracking indices in a general for-in loop, such as over MLList?</p>",
        "id": 468644122,
        "sender_full_name": "Thomas Zhu",
        "timestamp": 1725840818
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113488-general/topic/best.20practices.3A.20iteration.20over.20array.20items.20with.20indices/near/468640561\">said</a>:</p>\n<blockquote>\n<p>Taking a step back: is <code>array.zipWithIndex</code> actually an efficient way to do this looping?</p>\n</blockquote>\n<p>Since <code>array.zipWithIndex</code> is <code>constexpr</code> (C++ sense), the best bet is that a very good optimize compiler will reorder loop operations.</p>\n<blockquote>\n<p>In python, <code>enumerate</code> returns an iterator, not an <code>list</code> - presumably allocating an <code>Array</code> of pairs is wasteful here?</p>\n</blockquote>\n<p>Perhaps we should add a <code>array.forWithIndexM</code>.</p>",
        "id": 469183514,
        "sender_full_name": "Jz Pan",
        "timestamp": 1725994262
    },
    {
        "content": "<p>I think we could even provide a <code>ForIn</code> instance that returns pairs.</p>",
        "id": 469230965,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1726010034
    }
]