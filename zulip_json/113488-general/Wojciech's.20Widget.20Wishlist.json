[
    {
        "content": "<p>Hi! I am one of the developers of <a href=\"https://lean-lang.org/examples/1900-1-1-widgets/\">user widgets</a> and <a href=\"https://github.com/leanprover-community/ProofWidgets4\">ProofWidgets4</a>. While I was working on these systems, I have accumulated a wishlist of features related to Lean's UI/UX that could improve everyone's experience. In this post I wish to share the list with the Lean commmunity. While I do not have time to implement most of the items there, I am happy to provide mentoring, review PRs, etc. So if you are interested, do pick up an item, post here or DM me if you have questions, and write some code :)</p>\n<p>The items are listed below; feel free to react to ones you would find most useful.</p>\n<p>Please note that for items that touch core Lean and don't already have an issue assigned, an RFC must be made first in accordance with the <a href=\"https://github.com/leanprover/lean4/blob/master/CONTRIBUTING.md\">contribution guidelines</a>.</p>",
        "id": 533850347,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754938841
    },
    {
        "content": "<p>Could I suggest splitting these into separate messages in this thread to collect reactions on each?</p>",
        "id": 533879582,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754952488
    },
    {
        "content": "<h2>Structure-aware syntax editing</h2>\n<p>All widgets and code actions that modify code in some way currently operate on strings; e.g. when we edit <code>apply?</code> to <code>apply theBestLemma</code> via a code action, we produce the <em>string</em> <code>\"apply theBestLemma\"</code> together with positioning information regarding where to insert it. While we do have to produce a string eventually as that is what editors expect, it is tragic that this is also the high-level API in widget/code action implementations; instead, there should be an API that allows users to conveniently modify structured <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Syntax#doc\">docs#Lean.Syntax</a> objects and generate stringly-typed edits from that (e.g. by diffing two <code>Syntax</code> objects). A reasonable starting point might be to look at any tactic which directly produces strings representing source code - e.g. <a href=\"https://github.com/leanprover-community/mathlib4/blob/d678e826fd1adcb1a13a14f217d6a2226e36fbb0/Mathlib/Tactic/Widget/Conv.lean#L116\">conv?</a> - and see what it would take to operate on structured syntax there.</p>\n<p>Repos: mathlib4/possibly upstream to lean4</p>",
        "id": 533881346,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953574
    },
    {
        "content": "<h2>Commutative diagrams</h2>\n<p>Mathlib contains a commutative diagram widget (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Tactic.Widget.mkCommDiag#doc\">docs#Mathlib.Tactic.Widget.mkCommDiag</a>) which is not used by anyone, including the author (me). The task is to write a replacement with better UX, addressing the issues described <a href=\"https://voidma.in/assets/papers/2024nawrocki_auto_visualization_commutative_diagrams_lean_4_workgroup_report.pdf\">here</a>, and bring it to mathlib. A starting point might be <a href=\"https://github.com/sinhp/Poly/blob/ac204d4a69f4a13d9801c132b29f6bb4894eb931/Poly/Widget/CommDiag.lean\">this widget</a> which I have written for myself while working on polynomial functors. I have found it more useful than the mathlib version.</p>\n<p>Repos: mathlib4/possibly ProofWidgets4</p>",
        "id": 533881362,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953585
    },
    {
        "content": "<h2>Semantic highlighting in the tactic state</h2>\n<p>It's 2025, yet types in the infoview are still black-and-white. Add support for semantic highlighting of syntax there. Likely requires somewhat invasive changes to the infoview extension and the RPC method signatures. One idea would be to extend <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Widget.CodeWithInfos#doc\">docs#Lean.Widget.CodeWithInfos</a> to use tags in <code>SubexprInfo | SemanticToken</code>. <a href=\"https://davidchristiansen.dk/drafts/final-pretty-printer-draft.pdf\">The Final Pretty Printer</a> may contain good ideas on how to structure something like this.</p>\n<p>Repos: lean4/vscode-lean4</p>",
        "id": 533881374,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953593
    },
    {
        "content": "<h2>Finer-grained visual diffs</h2>\n<p>The diffing algorithm for goals is useful, but coarse. For instance, in</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>the entire goal, rather than just the subterm <code>10</code>, is highlighted in red. The task is to identify where finer/more accurate diffs can be provided, and then do so. See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Widget.exprDiffCore#doc\">docs#Lean.Widget.exprDiffCore</a>.</p>\n<p>Repos: lean4/maybe vscode-lean4</p>",
        "id": 533881393,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953607
    },
    {
        "content": "<h2>Visual diffs for expected/actual type</h2>\n<p>The 'has type <code>A</code> but is expected to have type <code>B</code>' error message does a lot of heavy lifting when informing users about mistakes. Although Lean does a relatively good job of filling in implicit parameters so that the difference between <code>A</code> and <code>B</code> can be found, this is still not an easy task when the two types are long. We already have an expression diffing algorithm - the red/green highlights on tactic states - and components to display diffs visually. The task is to bring this to the 'has type .. but is expected to have type ..' message, perhaps hidden behind an option for users who do not want it. This may be implementable using a <a href=\"http://github.com/leanprover/lean4/issues/2064\">widget message</a>.</p>\n<p>Repos: lean4/vscode-lean4</p>",
        "id": 533881404,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953617
    },
    {
        "content": "<h2>Widget to debug unification failures</h2>\n<p>In a similar spirit to the issue above, improve the UX for 'could not unify the type of <code>t</code> <code>A</code> with the goal <code>B</code>'. Straightforward diffing probably does not make sense here because <code>A</code> often contains metavariables, but it could be useful to gain the ability to, for example, click on a subterm of <code>A</code> and a subterm of <code>B</code> and see why they could not be unified. (Tracing <code>trace.Meta.isDefEq</code> can already help here to an extent, but it would be more efficient to click around. The widget might also auto-scroll to the relevant subtrace of <code>trace.Meta.isDefEq</code> when we click on a subterm of <code>A</code> or <code>B</code>.)</p>\n<p>Repos: lean4/vscode-lean4</p>",
        "id": 533881432,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953624
    },
    {
        "content": "<h2>Allow widgets to modify the selection context</h2>\n<p>Goals in the infoview come with an associated <em>selection context</em> - a list of terms selected by the user with shift-click or the right-click menu (see section 3.2. of <a href=\"https://voidma.in/assets/papers/23nawrocki_extensible_user_interface_lean_4.pdf\">our paper</a>). Right now, user widget JS code may not modify the selection context. This makes building visual provers such as <a href=\"https://github.com/leanprover-community/ProofWidgets4/blob/1253a071e6939b0faf5c09d2b30b0bfc79dae407/ProofWidgets/Demos/Euclidean.lean\">EuclideanConstructions</a> awkward because the user may not select a circle <code>C</code> by clicking on it in the plane, but rather has to click on <code>C</code> in the tactic state. The task is to allow widgets to modify selection contexts. This probably requires a technical understanding of the infoview code, in particular regarding how goals and the tactic state are represented.</p>\n<p>This task is also a key enabler for fully custom tactic states, i.e., widgets that replace the tactic state entirely. Selection contexts must be widget-modifiable for that to work.</p>\n<p>Repos: vscode-lean4</p>",
        "id": 533881442,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953633
    },
    {
        "content": "<p>Finally, I wanted to highlight some tasks that already have issues assigned.</p>\n<h2>Clickable infoview links</h2>\n<p>Implement <a href=\"https://github.com/leanprover-community/vscode-lean4/pull/631\">vscode-lean4#631</a>.</p>\n<p>Repos: vscode-lean4</p>",
        "id": 533881454,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953646
    },
    {
        "content": "<h2>Make 'Try this' use a widget message</h2>\n<p>Implement <a href=\"https://github.com/leanprover/lean4/pull/4551\">lean4#4551</a>.</p>\n<p>Repos: lean4</p>",
        "id": 533881458,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1754953651
    },
    {
        "content": "<p>(If/when anyone works on any of the UI-side parts of these I'd certainly also appreciate a ping on the PR so I can bring them to lean.nvim as well.)</p>",
        "id": 533960802,
        "sender_full_name": "Julian Berman",
        "timestamp": 1754998321
    }
]