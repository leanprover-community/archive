[
    {
        "content": "<p>I would like to get a PC for Lean 4, to be as fast as possible.<br>\nThe budget is 2000 € (i.e., approximately 2000 $).<br>\nI expect it to be a \"tower\" PC.<br>\nAny recommendations?</p>",
        "id": 498192878,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738869094
    },
    {
        "content": "<p>I think that you can go all out on a CPU with a 2000€ budget. The flagship AMD CPU is the ryzen 9950X (with a massive 32 threads!), it costs about 650€ - 700€. I think it even has built-in graphics, so you wouldn't even need an external GPU. The best (consumer) intel CPU is in a similar price and performance range (I don't know which one would be better for lean).</p>",
        "id": 498206132,
        "sender_full_name": "Christian K",
        "timestamp": 1738874151
    },
    {
        "content": "<p>Yeah, AMD 9950X3D is on my radar.</p>",
        "id": 498206780,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738874425
    },
    {
        "content": "<p>And probably throw as much as you can at RAM</p>",
        "id": 498206970,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738874500
    },
    {
        "content": "<p>I guess I won't need more than 32 GM RAM, so should I aim for 32 GB but as fast RAM as possible?</p>",
        "id": 498207047,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738874523
    },
    {
        "content": "<p>You could also take a look at the AMD Threadripper CPUs, although I think at some point, single core performance is more important for lean than just adding more cores</p>",
        "id": 498207086,
        "sender_full_name": "Christian K",
        "timestamp": 1738874538
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498207047\">said</a>:</p>\n<blockquote>\n<p>I guess I won't need more than 32 GM RAM, so should I aim for 32 GB but as fast RAM as possible?</p>\n</blockquote>\n<p>This makes sense, I think using two 16 GB sticks is a bit faster than one 32 GB</p>",
        "id": 498207332,
        "sender_full_name": "Christian K",
        "timestamp": 1738874668
    },
    {
        "content": "<p>I don't know anything about speed differences for RAM, but 32G of RAM sounds like a good plan</p>",
        "id": 498207425,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738874712
    },
    {
        "content": "<p>Yeah, gone are the days when 640 kB was enough for everybody.</p>",
        "id": 498207700,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738874822
    },
    {
        "content": "<p>Is there a general consensus on what makes a good machine if your goal is \"compile mathlib as fast and painlessly as possible\"? I would assume it's just a big SSD and as much RAM as you can buy.</p>",
        "id": 498207863,
        "sender_full_name": "Nick Ward",
        "timestamp": 1738874888
    },
    {
        "content": "<p>Can anyone comment if Lean 4 is typically bound to a single processor core/thread/etc? I know that with Prolog unless I specifically write the code for multiple threads one core  is carrying all the load and the others are practically idle working on non-Prolog tasks.</p>\n<p>If Lean 4 uses just one core then I would look for a CPU that has at least  a few cores that can run extremely fast for a long time and not idle down for heat.</p>",
        "id": 498207899,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738874903
    },
    {
        "content": "<p>Also consider the configuration. With Windows many of my tasks are often causing the antivirus checker to kick in which then slows things down. I don't know which OS you plan to pick but do keep that in mind.</p>",
        "id": 498208488,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738875130
    },
    {
        "content": "<p>i suspect it <em>is</em> using multiple threads... for me, a common message when building is <code>building Mathlib.Foo.Bar (+ 11 more)</code></p>",
        "id": 498208620,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738875188
    },
    {
        "content": "<p>Yes, I think for mathlib, more threads are generally better, but when working in a single file in vscode, lean probably uses only one thread.</p>",
        "id": 498208713,
        "sender_full_name": "Christian K",
        "timestamp": 1738875240
    },
    {
        "content": "<p>or thereabouts. So either lake is lying, or building is done multithreaded</p>",
        "id": 498208721,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738875241
    },
    {
        "content": "<p>But when you build your own projects (according to my experience), the amount of threads that can be used depends on how flat the import structure is.</p>",
        "id": 498209125,
        "sender_full_name": "Christian K",
        "timestamp": 1738875413
    },
    {
        "content": "<p>As for memory I would even suggest going to 64GB, I can't count how many times I think I buy enough then a few years latter it is never enough. I currently have 16 GB on my machine and regret not going for 32GB.</p>",
        "id": 498209216,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738875458
    },
    {
        "content": "<p><code>lake</code> certainly builds files in parallel, and I believe there's been work recently to do concurrent work within one file as well</p>",
        "id": 498210476,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738875988
    },
    {
        "content": "<p>If you are getting a tower and don't have an Uninterruptible Power Supply <a href=\"https://en.wikipedia.org/wiki/Uninterruptible_power_supply\">UPS</a>, then consider tossing that into the budget.</p>\n<p>Obviously laptops use the battery for that purpose but I remember the days before laptops and power going out. <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 498211700,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738876567
    },
    {
        "content": "<p>Single file parallelism will improve significantly over the next few months. Certainly for building Mathlib, many cores is great. Downstream projects tend to have more linear import structures, so currently there's less parallelism available, but improving.</p>",
        "id": 498227506,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738883180
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366057\">Eric Taucher</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498209216\">said</a>:</p>\n<blockquote>\n<p>As for memory I would even suggest going to 64GB, I can't count how many times I think I buy enough then a few years latter it is never enough. I currently have 16 GB on my machine and regret not going for 32GB.</p>\n</blockquote>\n<p>Thanks for the tip! I nevertheless feel like 32 GB is almost too much. Can you give me one scenario where more than 32 GB would be useful?</p>",
        "id": 498276210,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738913836
    },
    {
        "content": "<p>Memory is cheap. You can extend later</p>",
        "id": 498288172,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738918297
    },
    {
        "content": "<p>Also, memory gets cheaper with time. There's a chance it will be even cheaper when you want/need to extend it</p>\n<p>So I would say get your 32GBs of RAM, then spend more on CPU. And the rest on peripherals for ergonomics, like a good monitor, a good keyboard and even a proper chair (gaming chairs are terrible in my experience). Though chairs are obnoxiously expensive assets... you might want to leave that for the next budget</p>",
        "id": 498288408,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738918379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/stream/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498276210\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"366057\">Eric Taucher</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498209216\">said</a>:</p>\n<blockquote>\n<p>As for memory I would even suggest going to 64GB, I can't count how many times I think I buy enough then a few years latter it is never enough. I currently have 16 GB on my machine and regret not going for 32GB.</p>\n</blockquote>\n<p>Thanks for the tip! I nevertheless feel like 32 GB is almost too much. Can you give me one scenario where more than 32 GB would be useful?</p>\n</blockquote>\n<p>I have 32 GB and I regularly whish I had more, Firefox consumes a lot of memory, it can easily reach 10-15 GB. If you add one or two lean processes to that, you reach the limit quite fast.</p>",
        "id": 498297051,
        "sender_full_name": "Christian Merten",
        "timestamp": 1738921065
    },
    {
        "content": "<p>Does the speed of my SSD play an important role for Lean?</p>",
        "id": 498298613,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1738921537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498276210\">said</a>:</p>\n<blockquote>\n<p>Thanks for the tip! I nevertheless feel like 32 GB is almost too much. Can you give me one scenario where more than 32 GB would be useful?</p>\n</blockquote>\n<p>On Windows to run a Linux OS typically Windows Subsystem for Linux (<a href=\"https://learn.microsoft.com/en-us/windows/wsl/about\">WSL</a>) is used and that allocates a block of memory, e.g. 8GB, so if you want to run two or more such Linux instance on the same PC then more memory is better. While I have started Linux on WSL with 8GB, 16GB is nicer. So if you get 32GB and then start a Linux on WSL allocating 16GB to that instance, the WIndows OS is now limited to 16GB. </p>\n<p>Since you plan to get a tower, if  you do get 32GB check to make sure that at least 2 memory slots are left empty to allow you to upgrade latter.</p>",
        "id": 498306311,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738923944
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498227506\">said</a>:</p>\n<blockquote>\n<p>Single file parallelism will improve significantly over the next few months. Certainly for building Mathlib, many cores is great. Downstream projects tend to have more linear import structures, so currently there's less parallelism available, but improving.</p>\n</blockquote>\n<p>It's also worth adding that parallelism already plays a significant role when using Lean interactively.</p>\n<ul>\n<li>Task cancellation is (necessarily) cooperative in Lean. So when you add a character to a document, whatever long-running tactic is currently running must periodically check that it should stop. This isn't always guaranteed for every tactic that people write, so we can't immediately terminate the previous elaboration run immediately. Instead of waiting for the previous elaboration run to complete, which would significantly increase the latency in the language server, we immediately launch another elaboration run in parallel.</li>\n<li>There is a separate process for every single file that is open, so interaction with multiple files at once is parallel.</li>\n<li>When the language server calls Lake to build the dependencies of a file, Lake is also run in a separate process.</li>\n<li>Language server requests are processed in parallel, e.g. semantic highlighting, auto-completion, etc.</li>\n<li>Several of the language server I/O operations are run in parallel.</li>\n<li>When launching the language server, the .ilean files are loaded in parallel so that it doesn't block the rest of the language server from functioning.</li>\n</ul>",
        "id": 498307600,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1738924352
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498298613\">said</a>:</p>\n<blockquote>\n<p>Does the speed of my SSD play an important role for Lean?</p>\n</blockquote>\n<p>For me personally having used spinning disk hard drives for decades, an SSD is so much faster that the differences in speed between one SSD and another is not something I focus on since SSD became the norm. </p>\n<p>I don't know how much faster a <a href=\"https://en.wikipedia.org/wiki/RAM_drive\">RAM drive</a> would be over an SSD, but it is something to consider if you have the memory to spare.</p>",
        "id": 498309288,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738924924
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417654\">Martin Dvořák</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498276210\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"366057\">Eric Taucher</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498209216\">said</a>:</p>\n<blockquote>\n<p>As for memory I would even suggest going to 64GB, I can't count how many times I think I buy enough then a few years latter it is never enough. I currently have 16 GB on my machine and regret not going for 32GB.</p>\n</blockquote>\n<p>Thanks for the tip! I nevertheless feel like 32 GB is almost too much. Can you give me one scenario where more than 32 GB would be useful?</p>\n</blockquote>\n<p>In 2020 4 gig was hopeless but 8 gigs was OK for running Lean. Today 8 gigs is pretty bad, 16 gigs is usually fine but Lean still occasionally takes my laptop down if I start messing with stuff at the beginnings of mathlib or if I'm live streaming and hacking. 32 gigs is always fine. But in 5 years' time 16 gigs will probably be a disaster, and maybe even 32 gigs might not always be fine. Are you planning on throwing the machine away in 2 years or do you want it to be a bit more future-proof? It's not just about what works today.</p>",
        "id": 498333212,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738932564
    },
    {
        "content": "<p>You don't necessarily need to throw your machine away if you need more RAM<br>\n<a href=\"https://www.ecosia.org/search?method=index&amp;q=buy+ram\">https://www.ecosia.org/search?method=index&amp;q=buy+ram</a></p>",
        "id": 498339988,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1738934656
    },
    {
        "content": "<p>i hear you can download that nowadays? <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 498340236,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738934739
    },
    {
        "content": "<p>One comment about the \"Buy 32 now, extend to 64 later\" strategy: If you choose to go with the 9950x (or its predecessor the 7950x), then it's documented that they don't behave great with 4 sticks of RAM (on the connectivity part of: <a href=\"https://www.amd.com/en/products/processors/desktops/ryzen/9000-series/amd-ryzen-9-9950x.html\">https://www.amd.com/en/products/processors/desktops/ryzen/9000-series/amd-ryzen-9-9950x.html</a>, or any number of forum threads if you google 9950x memory controllers). </p>\n<p>I'm not sure about the tradeoff of memory size and memory speed for Lean compilation, but 2x32gb is roughly the same price as 4x16gb, more stable, and faster so I'd say there's no reason not to do it.</p>",
        "id": 498340881,
        "sender_full_name": "Matej Penciak",
        "timestamp": 1738934924
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"455674\">Matej Penciak</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498340881\">said</a>:</p>\n<blockquote>\n<p>then it's documented that they don't behave great with 4 sticks of RAM</p>\n</blockquote>\n<p>Thanks. Will be keeping that in mind for my next computer.</p>\n<p>Found this <a href=\"https://www.youtube.com/watch?v=-UkGu6A-6sQ\">video</a> by Gamers Nexus from 4 years ago. So yes, a point to pay attention to and so forget what I noted about keeping 2 slots open. New advise, do the research from scratch about the memory options as what use to be a constant is not. Learned something new today.</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"-UkGu6A-6sQ\" href=\"https://www.youtube.com/watch?v=-UkGu6A-6sQ\"><img src=\"https://uploads.zulipusercontent.net/0b93fc4c8dff1bce90b8d9aa4582f052601bdb9f/68747470733a2f2f692e7974696d672e636f6d2f76692f2d556b477536412d3673512f64656661756c742e6a7067\"></a></div>",
        "id": 498365877,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1738942108
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498333212\">said</a>:</p>\n<blockquote>\n<p>In 2020 4 gig was hopeless but 8 gigs was OK for running Lean. Today 8 gigs is pretty bad, 16 gigs is usually fine but Lean still occasionally takes my laptop down if I start messing with stuff at the beginnings of mathlib or if I'm live streaming and hacking. 32 gigs is always fine. But in 5 years' time 16 gigs will probably be a disaster, and maybe even 32 gigs might not always be fine. Are you planning on throwing the machine away in 2 years or do you want it to be a bit more future-proof? It's not just about what works today.</p>\n</blockquote>\n<p>I'd argue that we should strongly endeavor for this to not be the case—why are you expecting this? Is it merely from Mathlib growing?</p>",
        "id": 498603106,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1739110516
    },
    {
        "content": "<p>Because I remember when my computer had 12k of memory in total and no disc, and this was fine? (edit for <span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> : it was an <a href=\"https://en.wikipedia.org/wiki/Acorn_Atom\">Acorn Atom</a>)</p>",
        "id": 498605541,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1739112439
    },
    {
        "content": "<p>The other monorepo (Google's) gave up on local builds a long time ago, and hosts everything on the cloud instead. Perhaps Gitpod is the future <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 498606468,
        "sender_full_name": "Chris Wong",
        "timestamp": 1739113110
    },
    {
        "content": "<p>Gitpod is dead in two months <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> (or rather we won't be able to use it anymore)</p>",
        "id": 498606664,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1739113288
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498605541\">said</a>:</p>\n<blockquote>\n<p>12k of memory</p>\n</blockquote>\n<p>I can't figure out which computer commonly had 12K. I was thinking maybe an <a href=\"https://www.nutsvolts.com/magazine/article/micro_memories_200301\">Altair 8080</a> but that came with 256 bytes of RAM. Or perhaps a computer job run on an IBM mainframe in the late 70's with <a href=\"https://en.wikipedia.org/wiki/Job_Control_Language\">JCL</a>, but even those used about 32K.</p>",
        "id": 498606744,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1739113338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"294142\">Chris Wong</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498606468\">said</a>:</p>\n<blockquote>\n<p>The other monorepo (Google's) gave up on local builds a long time ago, and hosts everything on the cloud instead. Perhaps Gitpod is the future <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>'everything hosted in the cloud' is not really how it works. You essentially have a cached NFS-like mounted directory for google3, so it's just a local directory like any other and building/testing locally works just like normal. Of course, you wouldn't want to needlessly build the entire repo, just what you're working on.</p>\n<p>Also, there are many monorepo projects. For example, LLVM is open source, much larger than mathlib, and works just fine as a monorepo.</p>",
        "id": 498613409,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1739118585
    },
    {
        "content": "<p>Once mathlib gets to the size of all of google's code, we can reconsider :)</p>",
        "id": 498614007,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1739119034
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"451983\">Arthur Paulino</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498288408\">said</a>:</p>\n<blockquote>\n<p>And the rest on peripherals for ergonomics, like a good monitor, a good keyboard and even a proper chair (gaming chairs are terrible in my experience). Though chairs are obnoxiously expensive assets... you might want to leave that for the next budget</p>\n</blockquote>\n<p>New chairs are <em>extremely expensive</em>, but second-hand chairs are merely <em>expensive</em>; in London you can get an Aeron for a few hundred GBP on eBay or whatever.</p>",
        "id": 498644983,
        "sender_full_name": "Patrick Stevens",
        "timestamp": 1739144148
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366057\">Eric Taucher</span> <a href=\"#narrow/channel/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498309288\">said</a>:</p>\n<blockquote>\n<p>I don't know how much faster a <a href=\"https://en.wikipedia.org/wiki/RAM_drive\">RAM drive</a> would be over an SSD, but it is something to consider if you have the memory to spare.</p>\n</blockquote>\n<p>Just learned of Ramfs, OS specific alternative, but would not be surprised if the idea was reimplemented on other OSes.</p>\n<p><a href=\"https://wiki.debian.org/ramfs\">Ramfs</a> is a very simple <a href=\"https://wiki.debian.org/FileSystem\">FileSystem</a> that exports Linux's disk caching mechanisms (the page cache and dentry cache) as a dynamically resizable ram-based filesystem.</p>\n<p>Discovered while reading</p>\n<p><a href=\"https://www.feldera.com/blog/cutting-down-rust-compile-times-from-30-to-2-minutes-with-one-thousand-crates\">Cutting Down Rust Compile Times From 30 to 2 Minutes With One Thousand Crates</a></p>",
        "id": 512840530,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1744900097
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/113488-general/topic/Recommend.20me.20a.20PC.20under.202000.20.E2.82.AC/near/498614007\">said</a>:</p>\n<blockquote>\n<p>Once mathlib gets to the size of all of google's code, we can reconsider :)</p>\n</blockquote>\n<p>This is a poor threshold, since thanks to alphaproof Google's monorepo includes mathlib!</p>",
        "id": 512863165,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744905849
    }
]