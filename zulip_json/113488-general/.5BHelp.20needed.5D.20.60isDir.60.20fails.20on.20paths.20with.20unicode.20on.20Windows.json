[
    {
        "content": "<p><strong>Update</strong>  With more digging around, I found that <code>System.FilePath.isDir</code> on <code>doug-demo</code> received</p>\n<div class=\"codehilite\" data-code-language=\"Batchfile\"><pre><span></span><code>C<span class=\"p\">:</span><span class=\"nl\">\\Users\\username\\clouddrive_root\\��\\�ҵ����Ͽ�\\fpil\\...</span>\n</code></pre></div>\n<p>which it passed to <code>pathExists</code> who returned false.</p>\n<hr>\n<p>Using <code>isDir</code> in Windows on paths that contain unicode characters always returns <code>false</code>; can I configure my Lean toolchain to correct this issue?</p>\n<h3>Background</h3>\n<p>I'm trying to follow <a href=\"https://leanprover.github.io/functional_programming_in_lean/monad-transformers/reader-io.html\">FPIL §7.1</a>, where an executable called <code>doug</code> is created.</p>\n<p>My project layout looks like this (created with <code>lake new doug</code>):</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell Session\"><pre><span></span><code><span class=\"go\">fpil/cpt7/doug (main ~)&gt; tree /F \"../doug\"</span>\n</code></pre></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>&lt;output&gt;</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Terminfo\"><pre><span></span><code><span class=\"nt\">Folder</span><span class=\"na\"> PATH listing for volume Drive1</span>\n<span class=\"na\">Volume serial number is ****-****</span>\n<span class=\"na\">C:\\USERS\\USERNAME\\CLOUDDRIVE_ROOT\\用户名\\资料库\\FPIL\\CPT7\\DOUG</span>\n<span class=\"na\">│   .gitignore</span>\n<span class=\"na\">│   changes.zip</span>\n<span class=\"na\">│   Doug.lean</span>\n<span class=\"na\">│   lake-manifest.json</span>\n<span class=\"na\">│   lakefile.toml</span>\n<span class=\"na\">│   lean-toolchain</span>\n<span class=\"na\">│   Main.lean</span>\n<span class=\"na\">│   README.md</span>\n<span class=\"na\">│</span>\n<span class=\"na\">├───.changes</span>\n<span class=\"na\">├───.changes</span>\n<span class=\"na\">├───.github</span>\n<span class=\"na\">│   └───workflows</span>\n<span class=\"na\">├───.lake</span>\n<span class=\"na\">│   ├───build</span>\n<span class=\"na\">│   │   ├───bin</span>\n<span class=\"na\">│   │   │       doug.exe</span>\n<span class=\"na\">│   │   │       doug.exe.hash</span>\n<span class=\"na\">│   │   │       doug.exe.rsp</span>\n<span class=\"na\">│   │   │       doug.exe.trace</span>\n<span class=\"na\">│   │   ├───ir</span>\n<span class=\"na\">│   │   │   └───Doug</span>\n<span class=\"na\">│   │   └───lib</span>\n<span class=\"na\">│   │       └───lean</span>\n<span class=\"na\">│   │           └───Doug</span>\n<span class=\"na\">│   └───packages</span>\n<span class=\"na\">├───.vscode</span>\n<span class=\"na\">│       settings.json</span>\n<span class=\"na\">│</span>\n<span class=\"na\">├───demo</span>\n<span class=\"na\">│   └───a</span>\n<span class=\"na\">│       ├───b</span>\n<span class=\"na\">│       │   │   hello</span>\n<span class=\"na\">│       │   │</span>\n<span class=\"na\">│       │   └───c</span>\n<span class=\"na\">│       ├───d</span>\n<span class=\"na\">│       │       another-file</span>\n<span class=\"na\">│       │</span>\n<span class=\"na\">│       └───e</span>\n<span class=\"na\">│           │   still-another-file-again</span>\n<span class=\"na\">│           │</span>\n<span class=\"na\">│           └───f</span>\n<span class=\"na\">└───Doug</span>\n<span class=\"na\">        Basic.lean</span>\n<span class=\"na\">        Config.lean</span>\n</code></pre></div>\n</div></div>\n<p>I'm at the end of the <a href=\"https://leanprover.github.io/functional_programming_in_lean/monad-transformers/reader-io.html#implementation\">implementation</a> subsection and the start of the <a href=\"https://leanprover.github.io/functional_programming_in_lean/monad-transformers/reader-io.html#using-a-custom-monad\">Using a custom monad</a> part.</p>\n<p>With</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell Session\"><pre><span></span><code><span class=\"go\">  $OutputEncoding = [Console]::OutputEncoding = [Text.Encoding]::UTF8</span>\n<span class=\"go\">  $doug_dir=pwd</span>\n<span class=\"go\">  $doug_exe=(lake query -d=\"$doug_dir\")</span>\n</code></pre></div>\n<p>Running the artifact returns</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell Session\"><pre><span></span><code><span class=\"gp\">PS&gt; </span> <span class=\"n\">powershell</span> <span class=\"n\">-NoProfile</span> <span class=\"n\">-Command</span> <span class=\"s2\">\"cd </span><span class=\"se\">`\"</span><span class=\"s2\">doug-demo</span><span class=\"se\">`\"</span><span class=\"s2\">; $doug_exe\"</span>\n<span class=\"go\">Debug: \"doug-demo\" is a file</span>\n<span class=\"go\">├── doug-demo</span>\n</code></pre></div>\n<p>where the debug output comes from my modified <code>toEntry</code>function</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>&lt;def toEntry ... IO.eprintln s!\"Debug: ...&gt;</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toEntry</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">System</span><span class=\"bp\">.</span><span class=\"n\">FilePath</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Entry</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">components</span><span class=\"bp\">.</span><span class=\"n\">getLast?</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"s2\">\".\"</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"s2\">\"..\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pathIsDir</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">isDir</span>\n<span class=\"w\">    </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">eprintln</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"Debug: </span><span class=\"se\">\\\"</span><span class=\"s2\">{name}</span><span class=\"se\">\\\"</span><span class=\"s2\"> is a {if pathIsDir then \"</span><span class=\"n\">directory</span><span class=\"s2\">\" else \"</span><span class=\"n\">file</span><span class=\"s2\">\"}\"</span>\n<span class=\"w\">    </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">pathIsDir</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"o\">))</span>\n</code></pre></div>\n</div></div>\n<p>Moving <code>doug-demo/</code> to the <code>C:\\</code> root yields</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell Session\"><pre><span></span><code><span class=\"gp\">PS&gt; </span><span class=\"n\">powershell</span> <span class=\"n\">-NoProfile</span> <span class=\"n\">-Command</span> <span class=\"s2\">\"cd </span><span class=\"se\">`\"</span><span class=\"s2\">C:\\temp\\doug-demo</span><span class=\"se\">`\"</span><span class=\"s2\">; $doug_exe\"</span>\n<span class=\"go\">Debug: \"doug-demo\" is a directory</span>\n<span class=\"go\">├── doug-demo/</span>\n<span class=\"go\">Debug: Found 1 entries in demo</span>\n<span class=\"go\">Debug: \"a\" is a directory</span>\n<span class=\"go\">│   ├── a/</span>\n<span class=\"go\">Debug: Found 3 entries in a</span>\n<span class=\"go\">Debug: \"b\" is a directory</span>\n<span class=\"go\">│   │   ├── b/</span>\n<span class=\"go\">Debug: Found 2 entries in b</span>\n<span class=\"go\">Debug: \"c\" is a directory</span>\n<span class=\"go\">│   │   │   ├── c/</span>\n<span class=\"go\">Debug: Found 0 entries in c</span>\n<span class=\"go\">Debug: \"hello\" is a file</span>\n<span class=\"go\">│   │   │   ├── hello</span>\n<span class=\"go\">Debug: \"d\" is a directory</span>\n<span class=\"go\">│   │   ├── d/</span>\n<span class=\"go\">Debug: Found 1 entries in d</span>\n<span class=\"go\">Debug: \"another-file\" is a file</span>\n<span class=\"go\">│   │   │   ├── another-file</span>\n<span class=\"go\">Debug: \"e\" is a directory</span>\n<span class=\"go\">│   │   ├── e/</span>\n<span class=\"go\">Debug: Found 2 entries in e</span>\n<span class=\"go\">Debug: \"f\" is a directory</span>\n<span class=\"go\">│   │   │   ├── f/</span>\n<span class=\"go\">Debug: Found 0 entries in f</span>\n<span class=\"go\">Debug: \"still-another-file-again\" is a file</span>\n<span class=\"go\">│   │   │   ├── still-another-file-again</span>\n</code></pre></div>\n<p>Which is what's intended sans the debug messages</p>",
        "id": 536053074,
        "sender_full_name": "Gravifer",
        "timestamp": 1756136471
    },
    {
        "content": "<p>clouddrive_root makes me worry that somehow this is a buggy filesystem provided by your cloud provider</p>",
        "id": 536110701,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756156647
    },
    {
        "content": "<p>Are you saying everything works outside of it?</p>",
        "id": 536110789,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756156684
    },
    {
        "content": "<p>I <a href=\"https://github.com/Gravifer/lean-mathlib-1stproj/tree/main/LeanMathlib1stproj/fpil/cpt7/doug\">added some other dummy files</a> and tested in <code>C:/temp</code>:</p>\n<div class=\"codehilite\" data-code-language=\"PowerShell Session\"><pre><span></span><code><span class=\"gp\">PS&gt; </span><span class=\"n\">doug</span>\n<span class=\"go\">├── doug-demo/</span>\n<span class=\"go\">│   ├── .h/</span>\n<span class=\"go\">│   │   ├── ordinaryFileInHiddenDirectory.txt</span>\n<span class=\"go\">│   ├── a/</span>\n<span class=\"go\">│   │   ├── b/</span>\n<span class=\"go\">│   │   │   ├── c/</span>\n<span class=\"go\">│   │   │   │   ├── .g</span>\n<span class=\"go\">│   │   │   ├── hello</span>\n<span class=\"go\">│   │   ├── d/</span>\n<span class=\"go\">│   │   │   ├── another-file</span>\n<span class=\"go\">│   │   ├── e/</span>\n<span class=\"go\">│   │   │   ├── f/</span>\n<span class=\"go\">│   │   │   ├── still-another-file-again</span>\n<span class=\"go\">│   │   ├── ����.txt</span>\n<span class=\"go\">│   ├── Ŀ¼dir/</span>\n<span class=\"go\">│   │   ├── fileInChineseDir.txt</span>\n<span class=\"gp\">&gt; </span><span class=\"n\">tree</span> <span class=\"p\">/</span><span class=\"n\">F</span> <span class=\"s2\">\"C:/temp/doug-demo\"</span>\n<span class=\"go\">Folder PATH listing for volume Blade 17</span>\n<span class=\"go\">Volume serial number is 8EDE-A9AD</span>\n<span class=\"go\">C:\\TEMP\\DOUG-DEMO</span>\n<span class=\"go\">├───.h</span>\n<span class=\"go\">│       ordinaryFileInHiddenDirectory.txt</span>\n<span class=\"go\">│</span>\n<span class=\"go\">├───a</span>\n<span class=\"go\">│   │   中文.txt</span>\n<span class=\"go\">│   │</span>\n<span class=\"go\">│   ├───b</span>\n<span class=\"go\">│   │   │   hello</span>\n<span class=\"go\">│   │   │</span>\n<span class=\"go\">│   │   └───c</span>\n<span class=\"go\">│   │           .g</span>\n<span class=\"go\">│   │</span>\n<span class=\"go\">│   ├───d</span>\n<span class=\"go\">│   │       another-file</span>\n<span class=\"go\">│   │</span>\n<span class=\"go\">│   └───e</span>\n<span class=\"go\">│       │   still-another-file-again</span>\n<span class=\"go\">│       │</span>\n<span class=\"go\">│       └───f</span>\n<span class=\"go\">└───目录dir</span>\n<span class=\"go\">        fileInChineseDir.txt</span>\n</code></pre></div>",
        "id": 536112372,
        "sender_full_name": "Gravifer",
        "timestamp": 1756157438
    },
    {
        "content": "<p>I managed to <a href=\"https://github.com/Gravifer/lean-mathlib-1stproj/tree/main/LeanMathlib1stproj/fpil/cpt7/doug\">complete the exercise</a> apart from this unicode path quirk.<br>\nNevertheless, I really want to understand the current state of the issue in the Lean toolchain.</p>",
        "id": 536124246,
        "sender_full_name": "Gravifer",
        "timestamp": 1756163960
    },
    {
        "content": "<p>This is a known issue, namely <a href=\"https://github.com/leanprover/lean4/pull/2554\">lean4#2554</a>.</p>",
        "id": 536170420,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1756191117
    },
    {
        "content": "<p>Thanks! I tried really hard but couldn't find the related entry.</p>",
        "id": 536188101,
        "sender_full_name": "Gravifer",
        "timestamp": 1756198141
    },
    {
        "content": "<p>Only now did I find out that the version of FPIL hosted on <a href=\"http://leanprover.github.io\">leanprover.github.io</a> is outdated, and the latest version is at <a href=\"http://lean-lang.org\">lean-lang.org</a>.<br>\nRight now learner resources are distributed on these domains together with <a href=\"http://leanprover-community.github.io\">leanprover-community.github.io</a> ; can someone tell me the best practice reaching up-to-date material? Thanks in advance</p>",
        "id": 536238934,
        "sender_full_name": "Gravifer",
        "timestamp": 1756215427
    },
    {
        "content": "<p>I am confused about your message: for me, your first link is a redirect to your second.</p>",
        "id": 536245790,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1756217253
    },
    {
        "content": "<p>Can confim. Nevertheless, the subrout doesn't redirect <a href=\"https://leanprover.github.io/functional_programming_in_lean\">https://leanprover.github.io/functional_programming_in_lean</a> (Microsoft commissioned version, 2023 @lean4.1.0)<br>\nLatest: <a href=\"https://lean-lang.org/functional_programming_in_lean\">https://lean-lang.org/functional_programming_in_lean</a> (2025, @lean4.21.0)<br>\nLooks like I fell into a weird gap <span aria-label=\"smiling face with tear\" class=\"emoji emoji-1f972\" role=\"img\" title=\"smiling face with tear\">:smiling_face_with_tear:</span></p>",
        "id": 536247097,
        "sender_full_name": "Gravifer",
        "timestamp": 1756217632
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260921\">Markus Himmel</span> <a href=\"#narrow/channel/113488-general/topic/.5BHelp.20needed.5D.20.60isDir.60.20fails.20on.20paths.20with.20unicode.20on.20Windows/near/536170420\">said</a>:</p>\n<blockquote>\n<p>This is a known issue, namely <a href=\"https://github.com/leanprover/lean4/pull/2554\">lean4#2554</a>.</p>\n</blockquote>\n<p>Quick update on this: the bug was fixed (by <span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span>). The fix will be part of Lean 4.24.0.</p>",
        "id": 536409921,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1756298063
    },
    {
        "content": "<p>Saw it on github just now. Really fine work! Amazing community</p>",
        "id": 536572800,
        "sender_full_name": "Gravifer",
        "timestamp": 1756375463
    }
]