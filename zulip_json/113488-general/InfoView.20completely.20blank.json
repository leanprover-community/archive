[
    {
        "content": "<p>Since updating to v4.28-rc1, every few seconds in my project the infoview goes blank on me. Reopening it works, but it fails soon again.<br>\n<a href=\"/user_uploads/3121/dERz5eRKHpf-7g5a3jkrVPP1/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dERz5eRKHpf-7g5a3jkrVPP1/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"3828x1926\" src=\"/user_uploads/thumbnail/3121/dERz5eRKHpf-7g5a3jkrVPP1/image.png/840x560.webp\"></a></div>",
        "id": 571009393,
        "sender_full_name": "Moritz R",
        "timestamp": 1769774498
    },
    {
        "content": "<p>Holdup, i have some custom css in the <code>Lean4 Infoview: Style</code> setting, maybe that broke. Let me test that</p>",
        "id": 571009560,
        "sender_full_name": "Moritz R",
        "timestamp": 1769774547
    },
    {
        "content": "<p>It is not the css</p>",
        "id": 571014203,
        "sender_full_name": "Moritz R",
        "timestamp": 1769775912
    },
    {
        "content": "<p>:(</p>",
        "id": 571014225,
        "sender_full_name": "Moritz R",
        "timestamp": 1769775917
    },
    {
        "content": "<p>Does the developer console contain any errors? 'Developer: Toggle Developer Tools'</p>",
        "id": 571014746,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1769776069
    },
    {
        "content": "<p>No new messages from the point where it went grey</p>",
        "id": 571015679,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776326
    },
    {
        "content": "<p>These are the messages i get (which i think are probably unrelated) before. Then i waited ~40seconds and the infoview went gray without any new messages<br>\n<a href=\"/user_uploads/3121/Z6PJDAb2gzGYdb5d9lcfHO1o/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Z6PJDAb2gzGYdb5d9lcfHO1o/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1666x1350\" src=\"/user_uploads/thumbnail/3121/Z6PJDAb2gzGYdb5d9lcfHO1o/image.png/840x560.webp\"></a></div>",
        "id": 571015884,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776387
    },
    {
        "content": "<p>Can you confirm that the issue does not occur now if you go back to a commit of your project before v4.28.0-rc1?</p>",
        "id": 571016482,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1769776594
    },
    {
        "content": "<p>i will downgrade my version again and update you</p>",
        "id": 571016789,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776689
    },
    {
        "content": "<p>I was using 4.27.0 before</p>",
        "id": 571017001,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776751
    },
    {
        "content": "<p>i wanted to upgrade to something, since 4.27 broke the autocomplete suggestions  with modules(always completing to <br>\n<code>Meta. ......... .Tactic.assumption</code> instead of <code>assumption</code>)</p>",
        "id": 571017170,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776802
    },
    {
        "content": "<p>Which got fixed at some point</p>",
        "id": 571017257,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776825
    },
    {
        "content": "<p>Oh heck no</p>",
        "id": 571017672,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776952
    },
    {
        "content": "<p>Its still happening</p>",
        "id": 571017706,
        "sender_full_name": "Moritz R",
        "timestamp": 1769776958
    },
    {
        "content": "<p>i also remember that i had no issues yesterday before sleep, when i was already on 4.28-rc1</p>",
        "id": 571017915,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777021
    },
    {
        "content": "<p>Did you update VS Code recently by any chance? :-)</p>",
        "id": 571017966,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1769777034
    },
    {
        "content": "<p>so its probably not the lean version</p>",
        "id": 571017976,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777037
    },
    {
        "content": "<p>Not actively at least</p>",
        "id": 571018026,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777047
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/ln2D0E3o8DuutyvFM5DfXJID/image.png\">image.png</a><br>\nWhatever this menu is, it shows that my system at least didn't do an update this night</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ln2D0E3o8DuutyvFM5DfXJID/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2154x1282\" src=\"/user_uploads/thumbnail/3121/ln2D0E3o8DuutyvFM5DfXJID/image.png/840x560.webp\"></a></div>",
        "id": 571018762,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777232
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/fJV3t5khSY3oLBydiiKVLbuc/image.png\">image.png</a><br>\nAnd this suggests, im on a 1 week old vscode?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/fJV3t5khSY3oLBydiiKVLbuc/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"548x664\" src=\"/user_uploads/thumbnail/3121/fJV3t5khSY3oLBydiiKVLbuc/image.png/840x560.webp\"></a></div>",
        "id": 571018939,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777278
    },
    {
        "content": "<p>What's your Lean VS Code extension version? Also, does the issue still occur if you disable all non-Lean extensions and fully restart VS Code?</p>",
        "id": 571019281,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1769777364
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/4UpQWUZKDBgi0xGaiW2qQkF3/image.png\">image.png</a><br>\nIt's 1 month? old</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/4UpQWUZKDBgi0xGaiW2qQkF3/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1530x1164\" src=\"/user_uploads/thumbnail/3121/4UpQWUZKDBgi0xGaiW2qQkF3/image.png/840x560.webp\"></a></div>",
        "id": 571020403,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777662
    },
    {
        "content": "<p>And yes, disabling all the extensions (except \"Even Better TOML\" which the Lean 4 extension seems to depend on) still produces the gray screen (after a restart of vscode)</p>",
        "id": 571020538,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777698
    },
    {
        "content": "<p>hmm maybe it has to do with trace messages</p>",
        "id": 571021494,
        "sender_full_name": "Moritz R",
        "timestamp": 1769777940
    },
    {
        "content": "<p>i was debugging a looping simp_all and had</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"bp\">.</span><span class=\"n\">unify</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>\n<p>active.<br>\nNow that i have commented them out, it has not yet gone gray yet</p>",
        "id": 571021737,
        "sender_full_name": "Moritz R",
        "timestamp": 1769778012
    },
    {
        "content": "<p>Aha!<br>\nI need the looping simp_all call and tracing enabled. Then it happens</p>",
        "id": 571022871,
        "sender_full_name": "Moritz R",
        "timestamp": 1769778327
    },
    {
        "content": "<p>I will try to reduce</p>",
        "id": 571022899,
        "sender_full_name": "Moritz R",
        "timestamp": 1769778335
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/urQBcssFG6Us0DeRg9V8DJAS/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/urQBcssFG6Us0DeRg9V8DJAS/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1784x1402\" src=\"/user_uploads/thumbnail/3121/urQBcssFG6Us0DeRg9V8DJAS/image.png/840x560.webp\"></a></div>",
        "id": 571032082,
        "sender_full_name": "Moritz R",
        "timestamp": 1769780682
    },
    {
        "content": "<p>Any suggestions on how to create such a high <code>succeeded</code> count with a loop in simp?</p>",
        "id": 571032212,
        "sender_full_name": "Moritz R",
        "timestamp": 1769780710
    },
    {
        "content": "<p>My reduced examples always stop at max : 167, because they stop via <code>max recursion depth</code>, not via <code>timeout at whnf</code></p>",
        "id": 571033011,
        "sender_full_name": "Moritz R",
        "timestamp": 1769780900
    },
    {
        "content": "<p>Enabling more traces also helps it go faster gray in my application:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"bp\">.</span><span class=\"n\">unify</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"bp\">.</span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span>\n</code></pre></div>",
        "id": 571033218,
        "sender_full_name": "Moritz R",
        "timestamp": 1769780950
    },
    {
        "content": "<p>I think one just needs to generate an absurd amount of <code>failed to unify</code> or other messages</p>",
        "id": 571033377,
        "sender_full_name": "Moritz R",
        "timestamp": 1769780987
    },
    {
        "content": "<p>I could recreate it</p>",
        "id": 571045758,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783847
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span></p>",
        "id": 571045776,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783852
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">maxRecDepth</span><span class=\"w\"> </span><span class=\"mi\">20000</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"bp\">.</span><span class=\"n\">unify</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">simp</span><span class=\"bp\">.</span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">opaque</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n\n\n\n\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">foo_eq_bar5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n\n\n\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"mi\">100000</span><span class=\"kd\">]</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">bar_eq_foo5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\">  </span><span class=\"c1\">-- Loops: foo 5 → bar 5 → foo 5 → ...</span>\n</code></pre></div>",
        "id": 571045803,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783859
    },
    {
        "content": "<p>I know im setting recursion  depth and diagnostics threshold unreasonably high, but it creates the gray screen error i was getting in my project <strong>where i didn't touch any of these settings</strong></p>",
        "id": 571046004,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783910
    },
    {
        "content": "<p>It doesn't recreate on Lean 4 Web tough</p>",
        "id": 571046073,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783927
    },
    {
        "content": "<p>So it might have to do with machine specs</p>",
        "id": 571046167,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783946
    },
    {
        "content": "<p>Can you recreate on your machine?</p>",
        "id": 571046250,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783964
    },
    {
        "content": "<p>You need to put the cursor after the <code>simp_all</code> and wait a bit (&lt;= 3 minutes for me i think)</p>",
        "id": 571046317,
        "sender_full_name": "Moritz R",
        "timestamp": 1769783978
    },
    {
        "content": "<p>Edit: The diagnostics threshold doesn't need to be changed, i deleted that line</p>",
        "id": 571047296,
        "sender_full_name": "Moritz R",
        "timestamp": 1769784191
    },
    {
        "content": "<p>The idea of the example is to create a huge amount of messages, by having the rewrite loop of <br>\n<code>bar x -&gt; foo x -&gt; bar x -&gt; foo x ...</code> <br>\nso that <code>set_option trace.Meta.Tactic.simp.rewrite true</code> will generate a message for each rewrite.<br>\nIn between we generate even more messages by having some high priority simp lemmas, that will fail the unification (and <code>set_option trace.Meta.Tactic.simp.unify true</code> will generate a message from this)</p>",
        "id": 571048196,
        "sender_full_name": "Moritz R",
        "timestamp": 1769784399
    },
    {
        "content": "<p>If it doesn't reproduce for you, try adding even more unification-fail-lemmas in each step.</p>",
        "id": 571048583,
        "sender_full_name": "Moritz R",
        "timestamp": 1769784496
    }
]