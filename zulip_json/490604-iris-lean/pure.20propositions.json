[
    {
        "content": "<p>In iris-lean, does pure propositions need to have the <code>&lt;affine&gt;</code> keyword in front like<br>\n<a href=\"https://github.com/leanprover-community/iris-lean/blob/5fe59a8fd5dfca4fa645aa30b462b6bb089a7187/src/Iris/Tests/Tactics.lean#L521-L525\">https://github.com/leanprover-community/iris-lean/blob/5fe59a8fd5dfca4fa645aa30b462b6bb089a7187/src/Iris/Tests/Tactics.lean#L521-L525</a></p>",
        "id": 560203855,
        "sender_full_name": "Alex Bai",
        "timestamp": 1764089042
    },
    {
        "content": "<p>If you remove the <code>&lt;affine&gt;</code> modality you get the error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">TCOr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Affine</span><span class=\"w\"> </span><span class=\"n\">iprop</span><span class=\"o\">(</span><span class=\"bp\">⌜⊢</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"bp\">⌝</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Absorbing</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><code>icases</code> requires that the term you are casing on the be affine in order to manipulate the proof context. Adding an <code>&lt;affine&gt;</code> modality is one way to make this true in any <code>BI</code>, however it is not necsary for <code>BI</code>'s that have a <code>BIAffine</code> instance like <code>iProp</code> or <code>uPred</code>. Indeed, if you add <code>[BIAffine PROP]</code> you can remove the <code>&lt;affine&gt;</code> modality.</p>",
        "id": 560207021,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1764089902
    },
    {
        "content": "<p>I haven't thought too hard about if there is a <code>BI</code> where pure propositions are not affine</p>",
        "id": 560207551,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1764090044
    },
    {
        "content": "<p>For context, I was trying to prove the theorems in <code>bupd_alt.v</code>. <a href=\"https://github.com/ahuoguo/iris-lean/blob/bupdalt/src/Iris/BI/BUpdAlt.lean\">https://github.com/ahuoguo/iris-lean/blob/bupdalt/src/Iris/BI/BUpdAlt.lean</a></p>\n<p>I got stuck for a bit since I need to add the affine modality for <code>own_updateP_plainly</code> even though the original rocq code doesn't add it.</p>",
        "id": 560237781,
        "sender_full_name": "Alex Bai",
        "timestamp": 1764099811
    },
    {
        "content": "<p>You can debug this problem by using <code>Set Typeclasses Debug</code> in the Rocq code before the <code>iIntros</code> of the hypothesis. This shows that Rocq uses the <a href=\"https://gitlab.mpi-sws.org/iris/iris/-/blob/master/iris/bi/plainly.v#L316\">plainly_absorbing</a> typeclass instance. My guess would be that this instance is missing in Iris Lean.</p>",
        "id": 560320164,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1764141994
    },
    {
        "content": "<p>thanks! Seems like the lean equivalent is <code>set_option trace.Meta.synthInstance true</code>?</p>",
        "id": 560437527,
        "sender_full_name": "Alex Bai",
        "timestamp": 1764175927
    }
]