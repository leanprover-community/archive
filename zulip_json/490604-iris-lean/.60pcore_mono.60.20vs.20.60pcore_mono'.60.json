[
    {
        "content": "<p>Right now, the definition of <code>CMRA</code> in iris-lean uses the following property:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">pcore_mono'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>But the Coq Iris instead uses a property, that looks like this when translated to Lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">pcore_mono</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"n\">z</span>\n</code></pre></div>\n<p>Should we keep the current definition or use the one from Coq?</p>",
        "id": 506253332,
        "sender_full_name": "suhr",
        "timestamp": 1742243146
    },
    {
        "content": "<p>Also, how to prove <code>pcore_mono</code> from <code>pcore_mono'</code>? Since <code>≡</code> is weaker than <code>=</code>, you can't use it directly to replace <code>op x y</code> with <code>y</code>.</p>",
        "id": 506254108,
        "sender_full_name": "suhr",
        "timestamp": 1742243407
    },
    {
        "content": "<p>my understanding is that <code>pcore</code> preserves <code>≡</code> because it is non-expansive</p>",
        "id": 506256062,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742244073
    },
    {
        "content": "<p>that is, if you know <code>y ≡ op x z</code>, then <code>pcore y ≡ pcore (op x z)</code>, so if you know <code>pcore (op x z) = some w</code> then <code>pcore y ≡ some w</code> as well</p>",
        "id": 506256348,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742244169
    },
    {
        "content": "<p>and unpacking the latter that means <code>pcore y = some w'</code> for some <code>w' ≡ w</code></p>",
        "id": 506256468,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742244214
    },
    {
        "content": "<p>All right, I figured it out. Now the question is which definition is preferable.</p>",
        "id": 506260995,
        "sender_full_name": "suhr",
        "timestamp": 1742245731
    },
    {
        "content": "<p>Under the constraint that we can't use <code>&lt;=</code> in the axiom, I think it is better to minimize the number of symbols and logical concepts involved in stating the axioms. The original <code>pcore_mono</code> looks like a more useful lemma but <code>pcore_mono'</code> looks easier to prove if you are constructing an instance</p>",
        "id": 506263386,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1742246561
    },
    {
        "content": "<p>The old definition is back in the PR, now as <code>pcore_op_mono</code>.</p>",
        "id": 506269402,
        "sender_full_name": "suhr",
        "timestamp": 1742248747
    },
    {
        "content": "<p>I have two remaining admits for the iProp construction and they're both proving <code>pcore_mono</code>... am I correct in understanding that the current monotonicity field (<code>pcore_op_mono</code> in the development, <code>pcore_mono'</code> in the above discussion ) is stronger but not equivalent to the one in Rocq Iris?</p>",
        "id": 511842114,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1744489682
    },
    {
        "content": "<p>Curiously I had the same suspicion, but I thought I simply might have an issue of skill.</p>",
        "id": 511845893,
        "sender_full_name": "suhr",
        "timestamp": 1744493009
    },
    {
        "content": "<p>No, they should be equivalent</p>",
        "id": 511867786,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744514028
    },
    {
        "content": "<p>The direction <code>pcore_mono' -&gt; pcore_mono</code> is relatively easy. If you assume <code>pcore_mono'</code> above and suppose we know  <code>y ≡ op x z</code> and <code>pcore x = some cx</code>. Then <code>pcore (op x z) = some (op cx cz)</code> for some <code>cz</code> by <code>pcore_mono'</code>. By non-expansiveness of <code>pcore</code>,  <code>pcore (op x z) ≡ pcore y</code>, so <code>pcore y = some cy</code> for some <code>cy ≡ op cx cz</code>. So the conclusion of <code>pcore_mono</code> is satisfied, that is, <code>∃ cy, pcore y = some cy ∧ ∃ cz, cy ≡ op cx cz</code>.</p>",
        "id": 511868008,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744514262
    },
    {
        "content": "<p>Okay. We need the other direction actually but I'll try again to prove it.</p>",
        "id": 511869415,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1744515580
    },
    {
        "content": "<p>the other direction I already sketched in the discussion above</p>",
        "id": 511869622,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744515770
    },
    {
        "content": "<p>At the risk of embarrassing myself here, is it? I think it makes sense as an argument for <code>pcore_mono' -&gt; pcore_mono</code> but I don't see how it makes sense the other way around. </p>\n<p>This (modulo extra CMRA assumptions) is the lemma we need: <a href=\"/user_uploads/3121/Aj5VnuXYyiu_wBYjTqkwWGL8/Screenshot-2025-04-13-at-12.12.31AM.png\">Screenshot 2025-04-13 at 12.12.31 AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Aj5VnuXYyiu_wBYjTqkwWGL8/Screenshot-2025-04-13-at-12.12.31AM.png\" title=\"Screenshot 2025-04-13 at 12.12.31 AM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1138x278\" src=\"/user_uploads/thumbnail/3121/Aj5VnuXYyiu_wBYjTqkwWGL8/Screenshot-2025-04-13-at-12.12.31AM.png/840x560.webp\"></a></div>",
        "id": 511871763,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1744517820
    },
    {
        "content": "<p>you are missing some universal quantifiers in the assumptions</p>",
        "id": 511875405,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744521106
    },
    {
        "content": "<p>in particular the <code>y</code> variable in <code>H1</code> should be in a forall because we don't want it to be <code>y</code>, we need to instantiate it as <code>op x y</code></p>",
        "id": 511875497,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744521179
    },
    {
        "content": "<p>once you do that, the first antecedent in H1 is easy to prove by reflexivity and the second one is by hypothesis</p>",
        "id": 511875540,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744521237
    },
    {
        "content": "<p>oh but I think I see a typo, the statement of pcore_op_mono should use ≡</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">pcore_op_mono</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 511875715,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744521395
    },
    {
        "content": "<p>fixed this on master, hopefully that should make the theorem provable</p>",
        "id": 511876009,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1744521640
    },
    {
        "content": "<p><del>How to get an <code>∃ z, y ≡ op x z</code> in order to use the assumption?</del></p>",
        "id": 511884750,
        "sender_full_name": "suhr",
        "timestamp": 1744530348
    },
    {
        "content": "<p>Yeah, with <code>≡</code> it's now easy:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OFE</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pcore</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≡</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"> </span><span class=\"n\">cy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">λ</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"bp\">⟨_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">op</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"n\">z</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcy</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">OFE</span><span class=\"bp\">.</span><span class=\"n\">some_eqv_some_of_eqv</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 511885632,
        "sender_full_name": "suhr",
        "timestamp": 1744531191
    },
    {
        "content": "<p>Cool, thanks for the help folks (no idea why that was so difficult to see). iProp is sorry-free now!</p>",
        "id": 511923372,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1744562666
    }
]