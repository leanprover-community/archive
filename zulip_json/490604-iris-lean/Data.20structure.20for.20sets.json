[
    {
        "content": "<p>Hi,<br>\nI'm new to Lean. I'm learning it by implementing the select pattern of the proof mode and need to choose a data structure for sets with efficient insert and lookup.<br>\nWhich one should I use? There seems to be many set implementations.<br>\nThanks.</p>",
        "id": 532539016,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754214181
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashSet#doc\">docs#Std.HashSet</a> has a decent api</p>",
        "id": 532546757,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754220400
    },
    {
        "content": "<p>What are you using sets for in selection patterns?</p>",
        "id": 532655168,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754289083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"769610\">Oliver Soeser</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Data.20structure.20for.20sets/near/532655168\">said</a>:</p>\n<blockquote>\n<p>What are you using sets for in selection patterns?</p>\n</blockquote>\n<p>I'm thinking of using a set to avoid duplications of selected hypotheses. The Rocq implementation does this by removing each selected hypothesis from the context when elaborating the pattern (<a href=\"https://gitlab.mpi-sws.org/iris/iris/-/blob/master/iris/proofmode/ltac_tactics.v#L155\">https://gitlab.mpi-sws.org/iris/iris/-/blob/master/iris/proofmode/ltac_tactics.v#L155</a>), which I think is less efficient and not straightforward to port because of iris-lean's distinct representation of the context. What do you think?</p>",
        "id": 532660499,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754291317
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Data.20structure.20for.20sets/near/532546757\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Std.HashSet#doc\">docs#Std.HashSet</a> has a decent api</p>\n</blockquote>\n<p>Thanks. I actually want to have a set for <code>Name</code>s, and I found <code>NameSet</code>: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Data/NameMap.html#Lean.NameSet\">https://leanprover-community.github.io/mathlib4_docs/Lean/Data/NameMap.html#Lean.NameSet</a>. I guess I should just use this ?</p>",
        "id": 532661147,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754291572
    },
    {
        "content": "<p>Sounds good, I've got a <a href=\"https://github.com/leanprover-community/iris-lean/pull/80/files#diff-68c2259e66c27cd6a346694a83408844cc07e1729ad17ae1d3ba287b9dd3264b\">very simplified implementation of specialization patterns</a> that I'm using for implementing <code>iapply</code> right now that's based on lists. As long as the underlying set structure is abstracted away under helper functions that shouldn't be a problem though</p>",
        "id": 532662040,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754291935
    },
    {
        "content": "<p>NameSet is essentially a red black tree of names.</p>",
        "id": 532662932,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754292323
    },
    {
        "content": "<p>Unless we are expecting gigantic contexts, red black trees are perfectly fine, but asymptotically slower</p>",
        "id": 532663052,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754292375
    },
    {
        "content": "<p>I don’t immediately see a useful ordering of names you can maintain</p>",
        "id": 532663202,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754292436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Data.20structure.20for.20sets/near/532663202\">said</a>:</p>\n<blockquote>\n<p>I don’t immediately see a useful ordering of names you can maintain</p>\n</blockquote>\n<p>Thanks for the info. I think the default <code>NameSet</code> is fine for the first implementation. I'll make a layer of abstraction, and we can optimise this later.</p>",
        "id": 532672398,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754295466
    },
    {
        "content": "<p>Interesting! <span class=\"user-mention\" data-user-id=\"883069\">@Zongyuan Liu</span> FYI, we do not have a Mathlib dependency so if you want to use <code>NameSet</code> you would have to reimplement something similar to it. </p>\n<p>Am I understanding correctly that the size of the set you're constructing is roughly the same as the size of the selection pattern typed by the programmer?</p>",
        "id": 532721302,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754311868
    },
    {
        "content": "<p>NameSet is not in mathlib</p>",
        "id": 532722987,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754312438
    },
    {
        "content": "<p>It's in Lean's core</p>",
        "id": 532723079,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754312468
    },
    {
        "content": "<p>Oh, lol you are right. Great!</p>",
        "id": 532723174,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754312496
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"721721\">Markus de Medeiros</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Data.20structure.20for.20sets/near/532721302\">said</a>:</p>\n<blockquote>\n<p>Am I understanding correctly that the size of the set you're constructing is roughly the same as the size of the selection pattern typed by the programmer?</p>\n</blockquote>\n<p>No, the upper bound is the number of the hypotheses in the context, because <code>#</code> and <code>*</code> can select multiple.</p>",
        "id": 532731766,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754315332
    },
    {
        "content": "<p>The first version that works with <code>iclear</code> is in <a href=\"https://github.com/leanprover-community/iris-lean/pull/82\">https://github.com/leanprover-community/iris-lean/pull/82</a>. Feedback is more than welcome!</p>",
        "id": 532732298,
        "sender_full_name": "Zongyuan Liu",
        "timestamp": 1754315486
    }
]