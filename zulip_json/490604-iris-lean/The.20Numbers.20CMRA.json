[
    {
        "content": "<p>The iris numbers file defines the Numbers CMRA as <code>nat</code> with addition. I already defined an ordered commutative monoid that subsumes this, except the implicit positivity of nat</p>",
        "id": 526415099,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751293405
    },
    {
        "content": "<p>Is this positivity strictly necessary or can <code>int</code>s qualify as numbers?</p>",
        "id": 526415155,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751293422
    },
    {
        "content": "<p>Iris defines cmras both for <code>Z</code> and <code>nat</code>, both for <code>add</code> and <code>max</code> so I guess all of them are useful (and none subsumes the others).</p>",
        "id": 526422375,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1751295455
    },
    {
        "content": "<p>Oh hey, nice to see one of the original iris authors here. Do you think describing Numbers as commutative monoids with a total order consistent with addition captures everything?</p>",
        "id": 526427640,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751296948
    },
    {
        "content": "<p>I think your ordered commutative monoid work is right on here</p>",
        "id": 526445014,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751302588
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/iris-lean/pull/67\">iris-lean#67</a></p>\n<p>The commit history mentions some commits in Frac, but we may rest assured that there is no intersection.</p>",
        "id": 526445421,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751302767
    },
    {
        "content": "<p>Should I change the copyright header? The initial file came from Frac but since then most of it has changed</p>",
        "id": 526445829,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751302927
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526427640\">said</a>:</p>\n<blockquote>\n<p>Oh hey, nice to see one of the original iris authors here. </p>\n</blockquote>\n<p>Just to clarify, I am not one of the original Iris authors, just someone who works with Iris quite a bit :) (Though actually more on the automation side, not too much with the different CMRA constructions.)</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526427640\">said</a>:</p>\n<blockquote>\n<p>Do you think describing Numbers as commutative monoids with a total order consistent with addition captures everything?</p>\n</blockquote>\n<p>This is hard for me to  says since I did not do muc fancy stuff my CMRAs myself. But I would recommend to look at uses of the CMRAs in e.g. Iris examples and see if your CMRA would work there. For example, here is an example using the max nat CMRA: <a href=\"https://gitlab.mpi-sws.org/iris/examples/-/blob/master/theories/lecture_notes/coq_intro_example_2.v#L413\">https://gitlab.mpi-sws.org/iris/examples/-/blob/master/theories/lecture_notes/coq_intro_example_2.v#L413</a></p>\n<p>In general, I think it would be nice if there is a mapping (e.g. in some document) from all CMRAs in Iris to CMRAs in Iris Lean such that it is easy to see that Iris lean can do everything that Iris can do.</p>",
        "id": 526473976,
        "sender_full_name": "Michael Sammler",
        "timestamp": 1751311811
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"574718\">Michael Sammler</span> <a href=\"#narrow/stream/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526473976\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526427640\">said</a>:</p>\n<blockquote>\n<p>Oh hey, nice to see one of the original iris authors here. </p>\n</blockquote>\n<p>Just to clarify, I am not one of the original Iris authors, just someone who works with Iris quite a bit :) (Though actually more on the automation side, not too much with the different CMRA constructions.)</p>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526427640\">said</a>:</p>\n<blockquote>\n<p>Do you think describing Numbers as commutative monoids with a total order consistent with addition captures everything?</p>\n</blockquote>\n<p>This is hard for me to  says since I did not do muc fancy stuff my CMRAs myself. But I would recommend to look at uses of the CMRAs in e.g. Iris examples and see if your CMRA would work there. For example, here is an example using the max nat CMRA: <a href=\"https://gitlab.mpi-sws.org/iris/examples/-/blob/master/theories/lecture_notes/coq_intro_example_2.v#L413\">https://gitlab.mpi-sws.org/iris/examples/-/blob/master/theories/lecture_notes/coq_intro_example_2.v#L413</a></p>\n<p>In general, I think it would be nice if there is a mapping (e.g. in some document) from all CMRAs in Iris to CMRAs in Iris Lean such that it is easy to see that Iris lean can do everything that Iris can do.</p>\n</blockquote>\n<p>In principle I like this idea. In practice, unless we at least add batteries (which has some moral equivalence with stdpp) as a dependency, achieving this will be difficult.  For instance the current definition of Rational numbers is in Batteries. Currently our frac CMRA is a generalisation of the Coq version, but this takes the form of a typeclass. To derive an instance for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> we would currently have to create a downstream project that imports iris-lean and batteries. </p>\n<p>Also I don’t know how much ordinals are required in the recent transfinite iris advances, but if they are needed, we only have them in mathlib, so that will also have to join the show. I am not opposed to that idea personally fwiw. My favourite thing to do is call <code>import Mathlib</code> at the beginning of a file and let <code>#min_imports</code> figure how to reduce this to essentials after I am done with the file.</p>",
        "id": 526485664,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751317032
    },
    {
        "content": "<p>I would discourage adding Mathlib as a dependency for something like <code>iris-lean</code>. We know there are many people out there who find some combination of Mathlib's size, speed of change, and lack of compatibility difficult to reconcile with their requirements.</p>\n<p>Regarding <code>Rat</code>, we will probably need a <code>Rat</code> type for upcoming improvements to <code>grind</code>, but it remains unclear yet whether we would just make an internal-use-only version or make it part of the Lean Standard Library. Either way, it's helpful to know who would like access to it.</p>",
        "id": 526497583,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751324069
    },
    {
        "content": "<p>we're likely to add a batteries import if it comes to it. Mathlib is not on the table</p>",
        "id": 526498591,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324772
    },
    {
        "content": "<p>anything needing mathlib + iris will be in a separate mathlib_iris repo</p>",
        "id": 526498633,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324812
    },
    {
        "content": "<p>Basically people who use Coq iris can, at a minimum, use everything in stdpp (adding more dependencies when required). </p>\n<p>Stdpp includes all the basic number types and collection types (like sets, finsets, multi sets)</p>",
        "id": 526498665,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324831
    },
    {
        "content": "<p>stdpp is batteries</p>",
        "id": 526498678,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324842
    },
    {
        "content": "<p>it's literally the same naming convention</p>",
        "id": 526498696,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324850
    },
    {
        "content": "<p>std but more</p>",
        "id": 526498708,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324861
    },
    {
        "content": "<p>And the transfinite stuff?</p>",
        "id": 526498722,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324866
    },
    {
        "content": "<p>That’s the only thing for which I referred to mathlib</p>",
        "id": 526498749,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324884
    },
    {
        "content": "<p>depends on how it shakes out, but I'm willing to bet that it won't actually end up using ordinals, or it will use a bespoke type</p>",
        "id": 526498767,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324899
    },
    {
        "content": "<p>well founded types are in core</p>",
        "id": 526498778,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324907
    },
    {
        "content": "<p>Okay. Batteries should be fine though right ?</p>",
        "id": 526498819,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324940
    },
    {
        "content": "<p>yes</p>",
        "id": 526498829,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324944
    },
    {
        "content": "<p>it's not imported right now simply because there is no current need for it</p>",
        "id": 526498844,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324957
    },
    {
        "content": "<p>Except we don’t have Sets,  Finsets, Multisets etc.</p>",
        "id": 526498854,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324964
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526498844\">said</a>:</p>\n<blockquote>\n<p>it's not imported right now simply because there is no current need for it</p>\n</blockquote>\n<p>Ideally we should supply Frac instances for Rat. That’s how we get closer to a 1:1 mapping</p>",
        "id": 526498873,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751324976
    },
    {
        "content": "<p>sets could get upstreamed to batteries</p>",
        "id": 526498878,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751324980
    },
    {
        "content": "<p>for finsets et al we could probably use <code>ExtTreeSet</code> from core</p>",
        "id": 526498958,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751325024
    },
    {
        "content": "<p>Is it convenient API wise?</p>",
        "id": 526499045,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751325082
    },
    {
        "content": "<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 526499057,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751325089
    },
    {
        "content": "<p>maybe we'll be the first user</p>",
        "id": 526499075,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751325102
    },
    {
        "content": "<p>generally \"I'll cross that bridge when I come to it\"</p>",
        "id": 526499115,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751325129
    },
    {
        "content": "<p>It might be nice to have those code actions</p>",
        "id": 526499206,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751325187
    },
    {
        "content": "<p>Are those in core now?</p>",
        "id": 526499213,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751325193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/stream/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526498873\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/490604-iris-lean/topic/The.20Numbers.20CMRA/near/526498844\">said</a>:</p>\n<blockquote>\n<p>it's not imported right now simply because there is no current need for it</p>\n</blockquote>\n<p>Ideally we should supply Frac instances for Rat. That’s how we get closer to a 1:1 mapping</p>\n</blockquote>\n<p>This is basically the only place we need batteries now. For feature parity with Coq iris.</p>",
        "id": 526500328,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751325942
    },
    {
        "content": "<p>There's long long way to feature parity. But right now the goal is to make something usable.</p>",
        "id": 526500516,
        "sender_full_name": "suhr",
        "timestamp": 1751326096
    },
    {
        "content": "<p>re. Transfinite Iris: It's still being upstreamed in Rocq, but they don't use a concrete ordinal type either. They have an <a href=\"https://gitlab.mpi-sws.org/iris/iris/-/blob/master/iris/algebra/stepindex.v?ref_type=heads#L51\">interface</a>.</p>",
        "id": 526506905,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751330918
    },
    {
        "content": "<p>I'm of the opinion that in general we should use interfaces whenever possible instead of concrete types :)</p>",
        "id": 526506984,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751330997
    },
    {
        "content": "<p>I think I have an error in the Numbers CMRA. I am a bit tired to debug it now, and will look at this again tomorrow. If one of you finds the error, do please ping me and I might finish this CMRA earlier. See line 175. Link <a href=\"https://github.com/leanprover-community/iris-lean/pull/67\">iris-lean#67</a></p>",
        "id": 527738821,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751994233
    },
    {
        "content": "<p>Also I notice that there is a merge conflict because I added an <code>@[ext]</code> to the <code>LeibnizO</code> structure. I will fix that right away</p>",
        "id": 527739032,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751994312
    },
    {
        "content": "<p>Concretely, I think I am missing some notion of positivity. I think I need to add <code>1 &gt; 0</code>. But it is possible the mistake lies elsewhere</p>",
        "id": 527739386,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751994425
    }
]