[
    {
        "content": "<p>Based on my reading of the Frac CMRA, we need rational numbers to define it. Currently Rationals are defined in batteries. Should we include batteries as a dependency?</p>",
        "id": 525234517,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750627784
    },
    {
        "content": "<p>CC : <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> and <span class=\"user-mention\" data-user-id=\"721721\">@Markus de Medeiros</span></p>",
        "id": 525234907,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750628460
    },
    {
        "content": "<p>When we used iris in my semantics course we used it with stdpp and batteries serves a similar role in lean (but has some content differences), so hopefully it isn't a controversial addition</p>",
        "id": 525234955,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750628529
    },
    {
        "content": "<p>To port this file you don't actually need the rationals! This is a case where we can generalize the existing Iris implementation to require a typeclass with the properties we want, rather than the Rational type itself (namely, a type of positive numbers).  I'll push my implementation of Frac in an hour or so.</p>",
        "id": 525235099,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750628742
    },
    {
        "content": "<p>Adding batteries is a bit of an orthogonal issue to this (though I'm definitely not be opposed to adding it when the need arises!)</p>",
        "id": 525235130,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750628767
    },
    {
        "content": "<p>Ah okay. I actually want to get a hang of CMRAs (I only learnt the simplified resource algebra story in my course)</p>",
        "id": 525235164,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750628799
    },
    {
        "content": "<p>presumably a minimalistic type which serves the role here would actually be dyadic rationals</p>",
        "id": 525235191,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750628820
    },
    {
        "content": "<p>So I think I can try the Frac CMRA or some variant, just as a practice. Feel free to close the PR if you prefer it</p>",
        "id": 525235215,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750628841
    },
    {
        "content": "<p>It would be better to use a typeclass. I am sure that eventually I will want to instantiate this with the positive reals.</p>",
        "id": 525235226,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750628852
    },
    {
        "content": "<p>what exactly is a Leibniz structure?</p>",
        "id": 525239632,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750635602
    },
    {
        "content": "<p>conceptually?</p>",
        "id": 525239636,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750635608
    },
    {
        "content": "<p>Leibniz equality is Rocq-speak for <code>Eq</code></p>",
        "id": 525239657,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750635629
    },
    {
        "content": "<p>I'm quite dubious about using the terminology in iris-lean since no one uses it here</p>",
        "id": 525239671,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750635654
    },
    {
        "content": "<p>A Leibniz OFE is one where the <code>Equiv</code> relation is <code>Eq</code></p>",
        "id": 525239692,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750635698
    },
    {
        "content": "<p>some possibly mixed up questions : <code>Equivalence</code> is in Init. Why isn't <code>Equivalence Eq</code> defined in core?</p>",
        "id": 525239783,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750635903
    },
    {
        "content": "<p>and why do we use this extra indirection in Iris at the moment?</p>",
        "id": 525239811,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750635929
    },
    {
        "content": "<p>what indirection?</p>",
        "id": 525239816,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750635940
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LeibnizO</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">car</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span>\n\n<span class=\"c1\">-- Move?</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Eq_Equivalence</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equivalence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Eq</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">congrFun</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COFE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LeibnizO</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">COFE</span><span class=\"bp\">.</span><span class=\"n\">ofDiscrete</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">Eq_Equivalence</span>\n</code></pre></div>",
        "id": 525239820,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750635962
    },
    {
        "content": "<p><code>LeibnizO</code> is a type constructor which builds a COFE on an arbitrary type, which is also a leibniz OFE</p>",
        "id": 525239846,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636006
    },
    {
        "content": "<p>You don't want that structure on every type, it's like the discrete topology</p>",
        "id": 525239869,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636052
    },
    {
        "content": "<p>Are there any rules about when we should use indirection? I brought up the fact that we put the <a href=\"https://github.com/leanprover-community/iris-lean/blob/b1c209607c8c93fffaeadb8d810d3e535340689b/src/Iris/Algebra/CMRA.lean#L905\">discrete function CMRA</a> on every function type but I don't think that point was ever resolved.</p>",
        "id": 525240001,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750636309
    },
    {
        "content": "<p>The key question is whether there is a likelihood of conflict between different structures</p>",
        "id": 525240023,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636359
    },
    {
        "content": "<p>For function types, it's fine as long as you can argue that there will never be a different structure on function types (only wrapped function types)</p>",
        "id": 525240051,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636405
    },
    {
        "content": "<p>for <code>LeibnizO</code> this is clearly impossible to argue because it would be a blanket instance covering every type</p>",
        "id": 525240063,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636440
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525240051\">said</a>:</p>\n<blockquote>\n<p>only wrapped function types</p>\n</blockquote>\n<p>Ah--good point. I'm not sure I've ever seen a function type in Iris that wasn't wrapped into a discrete function with <code>-d&gt;</code>.</p>",
        "id": 525240117,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750636521
    },
    {
        "content": "<p>So it might as well be the default</p>",
        "id": 525240125,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750636538
    },
    {
        "content": "<p>I believe there is no competing instance for function types anyway; <code>-n&gt;</code> isn't a function type, it is a subtype of a function type</p>",
        "id": 525240128,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750636548
    },
    {
        "content": "<p>Also @Markus : there seems to be no clean way to map arbitrary typeclass instances from Fractional to Frac</p>",
        "id": 525240283,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750636821
    },
    {
        "content": "<p>Referring to this part:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LeibnizO</span><span class=\"w\"> </span><span class=\"n\">T</span>\n\n<span class=\"c1\">-- TODO: How do I get rid of these instances?</span>\n<span class=\"c1\">-- I definitely do not want to use an abbrev for Frac (there are many different OFE's for numerical types)</span>\n<span class=\"c1\">-- so do we need to keep around all of these coercions?</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"bp\">·.</span><span class=\"m\">1</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">(</span><span class=\"bp\">⟨·⟩</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">COFE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Frac</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">One</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨⟨</span><span class=\"n\">One</span><span class=\"bp\">.</span><span class=\"n\">one</span><span class=\"bp\">⟩⟩</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">⟩</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">⟩</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Frac</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 525240317,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750636850
    },
    {
        "content": "<p>I made a draft PR to your PR at <a href=\"https://github.com/leanprover-community/iris-lean/pull/57\">leanprover-community/iris-lean#57</a></p>",
        "id": 525242001,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750638976
    },
    {
        "content": "<p>I want to simplify this further tomorrow morning</p>",
        "id": 525242011,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750638993
    },
    {
        "content": "<p>For example, I think the positivity condition is pointless</p>",
        "id": 525242040,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750639029
    },
    {
        "content": "<p>Since we are focussed on positive numbers only, we could add define the four conditions of <code>Fractional</code> in simpler terms. However changes here will break proofs, so I will fix this after some sleep</p>",
        "id": 525242099,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750639128
    },
    {
        "content": "<p>Nice! Yeah feel free to play around with it, I didn't simplify the <code>Fractional</code> typeclass at all :)</p>",
        "id": 525242419,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750639566
    },
    {
        "content": "<p>I do think positivity will be hard to remove (the type in Rocq is actually the positive rationals in case you missed it!)</p>",
        "id": 525242466,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750639664
    },
    {
        "content": "<p>To clarify I mean we can take positivity simpler</p>",
        "id": 525242720,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750640050
    },
    {
        "content": "<p>Trying to simplify positivity has had the side effect of creating a lot of useful API lemmas for the Fractional class</p>",
        "id": 525369153,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750696209
    },
    {
        "content": "<p>Your definition looks nice! Is it minimal?</p>",
        "id": 525372333,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750697449
    },
    {
        "content": "<p>I don't have a proof of that. I am trying to codify rationals as totally ordered commutative monoids (ignoring multiplication).</p>",
        "id": 525372549,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697529
    },
    {
        "content": "<p>I am basically remembering Apostol's definition of ordered fields in his real analysis book and simply removing the multiplication axioms. I don't have a copy so I have to go with my memory</p>",
        "id": 525372612,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697556
    },
    {
        "content": "<p>Okay! We don't need a proof or anything, just want to be reasonably confident that this typeclass is as minimal as possible.</p>",
        "id": 525372880,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750697663
    },
    {
        "content": "<p>I have marked a couple of the remaining fields for removal after I prove them as theorems</p>",
        "id": 525372963,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697698
    },
    {
        "content": "<p>Oh and I miss quite a few tactics I take for granted in mathlib like <code>contrapose</code>, <code>apply .. at</code>, <code>nth_rw</code>, and <code>simp_rw</code></p>",
        "id": 525373067,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697739
    },
    {
        "content": "<p>I pushed <a href=\"https://github.com/leanprover-community/iris-lean/pull/59\">iris-lean#59</a>, we'll want <code>Fractional</code> to be the smallest typeclass such that everything in <code>DFractional</code> can also be proved.</p>",
        "id": 525373322,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750697846
    },
    {
        "content": "<p>Uh also, I think you should not use <code>Zero</code>. This cannot be instantiated for types that are intrinsically positive like the positive reals or positive rationals.</p>",
        "id": 525373515,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750697925
    },
    {
        "content": "<p>Okay, but then the class that comes out of it will not be a monoid</p>",
        "id": 525373617,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697960
    },
    {
        "content": "<p>That's fine</p>",
        "id": 525373673,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750697979
    },
    {
        "content": "<p>I also miss all those precious code actions that split cases and create proof holes</p>",
        "id": 525373694,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750697985
    },
    {
        "content": "<p>Everywhere you see me using the <code>conv</code> mode, I would have used <code>nth_rw</code> instead.</p>",
        "id": 525374674,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750698360
    },
    {
        "content": "<p>Btw the Zero class only adds the notation for zero. For various intervals of Q I think the correct way to do this is by adding properties with the upper and lower bounds</p>",
        "id": 525376851,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750699259
    },
    {
        "content": "<p>So I think the zero and id laws should remain</p>",
        "id": 525376895,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750699273
    },
    {
        "content": "<p>And then this Fractional class should be extended with another that bounds the valid range of values. Kinda like subtypes</p>",
        "id": 525377263,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750699404
    },
    {
        "content": "<p>Otherwise the order relations’ compatibility with addition will become complicated. Further, we would have to reinvent many of the API  lemmas I have already proved</p>",
        "id": 525378267,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750699674
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525373694\">said</a>:</p>\n<blockquote>\n<p>I also miss all those precious code actions that split cases and create proof holes</p>\n</blockquote>\n<p>Those are in Batteries</p>",
        "id": 525378474,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750699720
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525376851\">said</a>:</p>\n<blockquote>\n<p>Btw the Zero class only adds the notation for zero. For various intervals of Q I think the correct way to do this is by adding properties with the upper and lower bounds</p>\n</blockquote>\n<p>There is no zero in the positive rationals.</p>",
        "id": 525381243,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750700517
    },
    {
        "content": "<p>Yeah but for positive rationals you can restrict the allowed values using a property</p>",
        "id": 525381573,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750700650
    },
    {
        "content": "<p>I understand that mechanizing a monoid is easy but that is not the structure we want. If the type includes zero elements we will need to change the CMRA to accommodate this, but since this is CMRA is used extensively throughout the derived parts of Iris I am hesitant to do that.</p>",
        "id": 525381575,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750700650
    },
    {
        "content": "<p>I would call it “PositiveFractional” and impose a restriction that all values a strictly greater than 0</p>",
        "id": 525381682,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750700698
    },
    {
        "content": "<p>...PositiveFractional cannot extend zero then.</p>",
        "id": 525381832,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750700742
    },
    {
        "content": "<p>0 won’t be a valid value if PositiveFractional</p>",
        "id": 525383230,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701322
    },
    {
        "content": "<p>Only fractional</p>",
        "id": 525383239,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701325
    },
    {
        "content": "<p>0 will be ruled out by the inability to prove the strict positivity field</p>",
        "id": 525383286,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701347
    },
    {
        "content": "<p>It’s basically like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subtype#doc\">docs#Subtype</a></p>",
        "id": 525383335,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701368
    },
    {
        "content": "<p>The stuff you've done is great, and it will be convenient to say that the positive restrictions of the classes you laid out will be <code>PositiveFractional</code>! But <code>PositiveFractional</code> itself should be a typeclass. </p>\n<p>Think of how you would instantiate <code>PositiveFractional</code> for the type of intrinsically positive fractions represented as pairs <code>structure PFrac : {num : Nat+; den: Nat+; wf : gcd num den = 1}</code>. Under your strategy, you would have to add a zero onto this type </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">positiveFracPlusZero</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PFrac</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span>\n</code></pre></div>\n<p>then lift all of the <code>PFrac</code> operations to <code>positiveFracPlusZero</code>, all to use <code>{p : positiveFracPlusZero | 0 &lt; p}</code> as the type of your indices. This is a mess.</p>",
        "id": 525383452,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750701426
    },
    {
        "content": "<p>Once I’m back I’ll flesh it out in code.</p>",
        "id": 525383580,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701491
    },
    {
        "content": "<p>Maybe it will be easier to communicate it that way</p>",
        "id": 525383610,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750701505
    },
    {
        "content": "<p>In a way you are right. But we can add default tactic arguments like <code>by omega</code> to make most of the api seamless</p>",
        "id": 525385413,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750702205
    },
    {
        "content": "<p>And then we just establish the API with general bound parameters. EDIT: this is how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector#doc\">docs#Vector</a>  works on top of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Array#doc\">docs#Array</a></p>",
        "id": 525385648,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750702294
    },
    {
        "content": "<p>By the way, why do we need rationals for program verification?</p>",
        "id": 525385697,
        "sender_full_name": "suhr",
        "timestamp": 1750702318
    },
    {
        "content": "<p>(sorry if the question is silly, I do not have that much experience with Iris)</p>",
        "id": 525385801,
        "sender_full_name": "suhr",
        "timestamp": 1750702374
    },
    {
        "content": "<p>Yeah. This cmra expresses fractional ownership later</p>",
        "id": 525386132,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750702535
    },
    {
        "content": "<p>So fractions come up in \"fractional ownership\" which are a way of dealing with avoiding races between readers and writers. Let's say we want to ensure the property:</p>\n<ul>\n<li>A writer can only write if there are no concurrent readers or writers</li>\n<li>Multiple readers can read concurrently</li>\n</ul>\n<p>To accomplish this, we can have a separating proposition <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">\\ell\\mapsto_1 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> which represents full ownership of the value, and if you have this then you are the unique owner and can safely write. If you want to share read access to it, you can \"split\" the ownership into two pieces, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow></msub><mi>v</mi><mo stretchy=\"false\">)</mo><mo>∗</mo><mo stretchy=\"false\">(</mo><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow></msub><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\ell\\mapsto_{1/2} v)\\ast (\\ell\\mapsto_{1/2} v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1052em;vertical-align:-0.3552em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1/2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1052em;vertical-align:-0.3552em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1/2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span></span>, and now distribute these pieces to separate threads of execution. If you have only half of a permission, then you do not know that there are no concurrent readers so you are entitled only to read the value, not write it. The reason for having arbitrary rationals is so that these tokens can be arbitrarily split and passed around, and you can keep reading it as long as the fraction remains positive. When all is done you can recombine the pieces into one full permission and go back to writing.</p>",
        "id": 525386791,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750702875
    },
    {
        "content": "<p>Here is what I would expect from an axiomatization of the type of positive fractions here, with the model <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">(0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> in mind:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> is a permission</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">a+b=c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> is a functional ternary relation on permissions (write <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> when this exists)</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>c</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a+b)+c=a+(b+c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a+b=b+a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">a/2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/2</span></span></span></span> is a function such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo>+</mo><mi>a</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo>=</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a/2+a/2=a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n</ul>\n<p>I think that's it?</p>",
        "id": 525387394,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703147
    },
    {
        "content": "<p>I think Markus wants something more general. He mentioned wanting to use Real number intervals later</p>",
        "id": 525387600,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750703235
    },
    {
        "content": "<p>Adding onto Mario's explanation, the problem with a zero fraction  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mn>0</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">\\ell\\mapsto_0 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> is that it _does not_ denote read permissions to a location, so it adds an edge case that needs to be handled by the validity predicate of the CMRA.</p>",
        "id": 525387680,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703277
    },
    {
        "content": "<p>But yeah I am still convinced that a dual api with default arguments and/or partial functions is the way to handle bounded fractions.</p>",
        "id": 525387711,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750703288
    },
    {
        "content": "<p>Same as Array and Vector</p>",
        "id": 525387759,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750703311
    },
    {
        "content": "<p>Otherwise we lose substantially simplicity of API</p>",
        "id": 525387814,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750703337
    },
    {
        "content": "<p>note that all of the following satisfy my axioms:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">(0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi><mo>∩</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}\\cap(0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">D</mi><mo>∩</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}\\cap(0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">D</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">D</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">D</span></span></span></span> = dyadic rationals</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7713em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7713em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">Q</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.938em;vertical-align:-0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7713em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">D</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7713em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">D</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7713em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n<p>You can only concretely construct fractions in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">D</mi><mo>∩</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}\\cap(0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">D</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> as literals though.</p>",
        "id": 525387900,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703373
    },
    {
        "content": "<p>That's right. I'm not convinced that your axiomatization actually has everything needed to instantiate CMRA (you don't have a relationship between addition and 1, for example) and the division by 2 axiom is useless.</p>",
        "id": 525388050,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703440
    },
    {
        "content": "<p>To construct 3/4 you need an axiom saying that when <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a+(b+c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span> exists, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> also exists and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">a+(b+c)=(a+b)+c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> (this is the associativity axiom but more precise about what exists)</p>",
        "id": 525388092,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703458
    },
    {
        "content": "<p>The division by 2 axiom is certainly not useless, it's the only way you can actually make fractions</p>",
        "id": 525388275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703543
    },
    {
        "content": "<p>Useless for the CMRA instance, which is what were talking about.</p>",
        "id": 525388339,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703578
    },
    {
        "content": "<p>otherwise <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{1\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">1</span><span class=\"mclose\">}</span></span></span></span> would also be a model of the axioms</p>",
        "id": 525388342,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703579
    },
    {
        "content": "<p>You also need <code>a ≠ a/2</code>.</p>",
        "id": 525388371,
        "sender_full_name": "suhr",
        "timestamp": 1750703597
    },
    {
        "content": "<p>why?</p>",
        "id": 525388417,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525388342\">said</a>:</p>\n<blockquote>\n<p>otherwise <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{1\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">1</span><span class=\"mclose\">}</span></span></span></span> would also be a model of the axioms</p>\n</blockquote>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{1\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">1</span><span class=\"mclose\">}</span></span></span></span> is fine!</p>",
        "id": 525388459,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703635
    },
    {
        "content": "<p>is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mo>+</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}^+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7713em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7713em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span></span></span></span> fine?</p>",
        "id": 525388509,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703658
    },
    {
        "content": "<p>Yes.</p>",
        "id": 525388551,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703673
    },
    {
        "content": "<p>Oh-- actually {1} is not fine, sorry. You need addition.</p>",
        "id": 525388642,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703726
    },
    {
        "content": "<p>no you have addition, it's just an empty relation in my setting</p>",
        "id": 525388693,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703751
    },
    {
        "content": "<p>so you can talk about splitting but you can never actually do it</p>",
        "id": 525388754,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703775
    },
    {
        "content": "<p>I suppose you could change <code>Add</code> to be a relation instead of a function, yes. Then <code>{1}</code> is fine.</p>",
        "id": 525388774,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703788
    },
    {
        "content": "<p><code>Frac {1}</code> is the same as <code>Excl</code> I believe.</p>",
        "id": 525388840,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703818
    },
    {
        "content": "<p>I use a relation because I expect that the CMRA wants to do this PCM style</p>",
        "id": 525388867,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703823
    },
    {
        "content": "<p>so we have this way of combining values which is just not always defined</p>",
        "id": 525388936,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703864
    },
    {
        "content": "<p>The well-definition is already controlled by the validity predicate of the CMRA</p>",
        "id": 525388981,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703888
    },
    {
        "content": "<p>if we restrict to those sets which have 1 as an upper bound then we get the relation <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mn>1</mn><mo>=</mo><mi>b</mi><mo>→</mo><mi mathvariant=\"normal\">⊥</mi></mrow><annotation encoding=\"application/x-tex\">a+1=b\\to\\bot</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\">⊥</span></span></span></span> which is nice</p>",
        "id": 525389008,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750703906
    },
    {
        "content": "<p>I could believe that. The question then becomes if using a relation instead of a function is easier for clients.</p>",
        "id": 525389113,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750703957
    },
    {
        "content": "<p>Is there (rational/real/natural) addition defined as a relation somewhere? I only know of it defined as a function.</p>",
        "id": 525389215,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704004
    },
    {
        "content": "<p>You can define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>&lt;</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a&lt;b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∃</mi><mi>c</mi><mo separator=\"true\">,</mo><mi>c</mi><mo>+</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">\\exists c,c+a=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">∃</span><span class=\"mord mathnormal\">c</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> (which works also when 1 is not an upper bound) and then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">¬</mi><mi>a</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\neg a&lt;1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord\">¬</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> means that you can write</p>",
        "id": 525389280,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704026
    },
    {
        "content": "<p>Anyway, speaking of axioms, what stops defining <code>+</code> in a trivial way: <code>1 + 1 = 1</code>, where <code>1</code> is only value of the type?</p>\n<p>This should satisfy the axioms?</p>",
        "id": 525389292,
        "sender_full_name": "suhr",
        "timestamp": 1750704029
    },
    {
        "content": "<p>and you want an axiom <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">¬</mi><mi>a</mi><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\neg a&lt;a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord\">¬</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></p>",
        "id": 525389396,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704060
    },
    {
        "content": "<p>which will prevent your example <span class=\"user-mention\" data-user-id=\"394485\">@suhr</span></p>",
        "id": 525389480,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704087
    },
    {
        "content": "<p>Concretely, this is not sound from a logical perspective. You can't exchange <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">\\ell\\mapsto_1 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi><mo>∗</mo><mi mathvariant=\"normal\">ℓ</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">\\ell\\mapsto_1 v \\ast \\ell\\mapsto_1 v </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\">ℓ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> because then you get two write permissions to the same place.</p>",
        "id": 525389531,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704109
    },
    {
        "content": "<p>right, but the question is whether this should be prevented in the axioms somehow so that you can actually prove a soundness theorem for generalized fractional permissions using this typeclass</p>",
        "id": 525389668,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704164
    },
    {
        "content": "<p>there is a bit of difference between the sets that have 1 as an upper bound (which prefer the partial addition version) and those that are unbounded (which can have addition as a function but need more side conditions saying things are less than 1)</p>",
        "id": 525389982,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704307
    },
    {
        "content": "<p>What is the type actually used in iris for this?</p>",
        "id": 525390088,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704358
    },
    {
        "content": "<p>Just to bring the discussion back down to earth, Iris does the following:</p>\n<ul>\n<li>Use a function for fraction addition</li>\n<li>Internalize that the fraction values are positive</li>\n<li>Externalize that the fraction values are at most 1 (using the CMRA validity predicate) </li>\n</ul>\n<p>Iris uses <code>Qp</code>, the type of positive rationals for this.</p>",
        "id": 525390160,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704384
    },
    {
        "content": "<p>is division used?</p>",
        "id": 525390229,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704415
    },
    {
        "content": "<p>Not for the CMRA instance</p>",
        "id": 525390266,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704432
    },
    {
        "content": "<p>The generalization I'm suggesting matches Iris in terms of externalizing/internalizing different features of Qp, but generalizes the Qp type itself. Other generalizations are possible, but may change the derived proofs in tricky ways.</p>",
        "id": 525390552,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704560
    },
    {
        "content": "<p>in that case how about this:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> exists</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> exists</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a+b=b+a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>c</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a+b)+c=a+(b+c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>&lt;</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a&lt;b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∃</mi><mi>c</mi><mo separator=\"true\">,</mo><mi>c</mi><mo>+</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">\\exists c,c+a=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">∃</span><span class=\"mord mathnormal\">c</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>, define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a\\le b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">¬</mi><mi>b</mi><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\neg b&lt;a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord\">¬</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a\\le a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n</ul>",
        "id": 525390647,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704597
    },
    {
        "content": "<p>there is no explicit relationship between 1 and + but you would use <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a\\le 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> in the validity predicate</p>",
        "id": 525391083,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704775
    },
    {
        "content": "<p>Mario just for context you can look at the <a href=\"https://github.com/leanprover-community/iris-lean/pull/56/files\">Fractional</a> class in my PR to see a sufficient set of axioms. <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> it's worth a shot to try reducing my typeclass to Mario's axioms.</p>",
        "id": 525391103,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704783
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525391083\">said</a>:</p>\n<blockquote>\n<p>there is no explicit relationship between 1 and + but you would use <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a\\le 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> in the validity predicate</p>\n</blockquote>\n<p>Right, I get it. I did use the field <code>one_strict_max</code> in my <a href=\"https://github.com/leanprover-community/iris-lean/pull/59/files\">DFractional</a> typeclass (which <code>Fractional</code> should also subsume) but I feel that may be able to be removed.</p>",
        "id": 525391175,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750704820
    },
    {
        "content": "<p>You should be able to prove transitivity of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding=\"application/x-tex\">&lt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\le</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span> using associativity</p>",
        "id": 525391243,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704852
    },
    {
        "content": "<p>oh we do need to add <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>+</mo><mi>a</mi><mo>=</mo><mi>c</mi><mo>+</mo><mi>b</mi><mo>→</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">c+a=c+b\\to a=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></p>",
        "id": 525391326,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704895
    },
    {
        "content": "<p><code>le_refl</code> and <code>positive</code> are the same thing if you have <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>b</mi><mo>↔</mo><mi mathvariant=\"normal\">¬</mi><mi>b</mi><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a\\le b\\leftrightarrow\\neg b&lt;a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">↔</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord\">¬</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></p>",
        "id": 525391414,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704941
    },
    {
        "content": "<p>and so <code>add_le_mono</code> should be provable</p>",
        "id": 525391510,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750704989
    },
    {
        "content": "<p>(Just to be clear, I'm approving of the general structure of <span class=\"user-mention\" data-user-id=\"721721\">@Markus de Medeiros</span> 's PR, this should be a custom typeclass.)</p>",
        "id": 525393039,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750705629
    },
    {
        "content": "<p>the details of the axioms aren't too important</p>",
        "id": 525393085,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750705648
    },
    {
        "content": "<p>Your axiom \"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> exists\" means that we should keep <code>+</code> as a function (as it is now) instead of a relation, right? This detail does matter for the downstream code I am working on.</p>",
        "id": 525393363,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750705792
    },
    {
        "content": "<p>yes</p>",
        "id": 525393388,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750705800
    },
    {
        "content": "<p>this does mean that we won't be able to support <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">D</mi><mo>∩</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}\\cap (0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">D</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> as a model; there is no way you can do addition as a function without saturating, which violates cancellativity</p>",
        "id": 525393583,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750705903
    },
    {
        "content": "<p>it also means 1 + 1 = 1 which violates irreflexivity</p>",
        "id": 525393785,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750705992
    },
    {
        "content": "<p>Hm. What is  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">D</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{D}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">D</span></span></span></span> in this context?</p>",
        "id": 525394357,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750706263
    },
    {
        "content": "<p>dyadic rationals</p>",
        "id": 525394397,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750706278
    },
    {
        "content": "<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> also have the same behavior though</p>",
        "id": 525394488,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750706327
    },
    {
        "content": "<p>Ah right--the issue is the <code>$$...\\cap (0,1]$$</code> part.</p>",
        "id": 525394568,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750706363
    },
    {
        "content": "<p>There seems to be a lot of messages here. What’s the conclusion?</p>",
        "id": 525412284,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750715466
    },
    {
        "content": "<ul>\n<li>You should try and refine the type class on my initial PR (without a Zero instance), Mario's axioms are probably the refinement you want</li>\n<li>Your work (the classes with a Zero instance) can stay, the positive subtype of them can be used as a generic instance for the Fractional typeclass</li>\n</ul>",
        "id": 525412703,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750715740
    },
    {
        "content": "<ul>\n<li>The Fractional typeclass you end up with should subsume both Fractional from the frac branch and DFractional from the DFrac branch.</li>\n</ul>",
        "id": 525413441,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750716199
    },
    {
        "content": "<p>My work is a bit generic. It just happens to subsume Fractional. Since Fractional is meant to use a different axiom set, should I move my work to a separate file? Alternatively, I can understand point 2 to mean that you wish to have all the API lemmas and properties from the typeclass, but have them proved from these axioms.</p>",
        "id": 525415360,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750717595
    },
    {
        "content": "<p>Where you put your work or if you keep it is largely irrelevant, just give it a shot (if you still want to!) and let me know when you're done so I can review it and give more detailed feedback.</p>",
        "id": 525415673,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750717827
    },
    {
        "content": "<p>Okay. I’ll do this tomorrow. It’s past midnight in my time zone.</p>",
        "id": 525416483,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750718331
    },
    {
        "content": "<p>Fwiw, the APi lemmas I showed for this typeclass will also be needed to make Mario’s definitions usable downstream.</p>",
        "id": 525416804,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750718538
    },
    {
        "content": "<p>We are basically foregoing all the order theory and algebra that was developed for mathlib. So we need to recover the basic properties that a mathlib user can take for granted.</p>",
        "id": 525416871,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750718600
    },
    {
        "content": "<p>I think that's the wrong way to look at it. As <span class=\"user-mention silent\" data-user-id=\"394485\">suhr</span> remarked, it's surprising that we need rational numbers to begin with, and the truth is that we don't really, we need an extremely basic structure of which rational numbers are the simplest to explain model. Generalizing to the minimum properties necessary actually makes it clearer what's actually going on, and reveals that this really has little to do with rational numbers or any of their algebraic properties.</p>\n<p>I am reminded of the evolution of \"the interval\" in HoTT and cubical type theory. Once upon a time people did homotopy theory using the type <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>⊆</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">[0,1]\\subseteq \\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⊆</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span>, which captures a bunch of structure of topological spaces. But when going synthetic, people started to realize that they can get away with just a rational interval and they get something computable, and in modern cubical type theory it's an extremely basic type, like \"thing that has a 0 and 1 and maybe <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>max</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\max</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mop\">max</span></span></span></span>?\" And keeping things to that minimal subset is exactly what makes it possible to have a decidable theory of equality, which is part of what makes cubical type theory possible.</p>",
        "id": 525421196,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750721911
    },
    {
        "content": "<p>hmm.. In neural nets, researchers went from all sorts of non-linear functions like the sigmoid function to softmax for the threshold</p>",
        "id": 525423893,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724081
    },
    {
        "content": "<p>I see your point. But I just realised that my generalisation also captures the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">N</mi><mo separator=\"true\">,</mo><mo>+</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\N, +)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">+</span><span class=\"mclose\">)</span></span></span></span>  resource for counters I had in my course. Except their core is the constant function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>. EDIT : It also captures <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">N</mi><mo separator=\"true\">,</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\N, max)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></p>",
        "id": 525423972,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724138
    },
    {
        "content": "<p>For now I will use your axioms in the Frac CMRA, but keep the PR for the stuff I wrote open</p>",
        "id": 525424153,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724271
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525423972\">said</a>:</p>\n<blockquote>\n<p>I see your point. But I just realised that my generalisation also captures the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">N</mi><mo separator=\"true\">,</mo><mo>+</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\N, +)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">+</span><span class=\"mclose\">)</span></span></span></span>  resource for counters I had in my course. Except their core is the constant function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></p>\n</blockquote>\n<p>I think that's a different use case, which uses a monoid</p>",
        "id": 525424248,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1750724336
    },
    {
        "content": "<p>It's a commutative monoid with a total order. EDIT : Both <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">N</mi><mo separator=\"true\">,</mo><mo>+</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\N, +)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">+</span><span class=\"mclose\">)</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">N</mi><mo separator=\"true\">,</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(\\N, max)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></p>",
        "id": 525424294,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724365
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/V9bwQkrt7MlhSRJja67g6lsc/Screenshot-from-2025-06-24-02-21-15.png\">Screenshot from 2025-06-24 02-21-15.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/V9bwQkrt7MlhSRJja67g6lsc/Screenshot-from-2025-06-24-02-21-15.png\" title=\"Screenshot from 2025-06-24 02-21-15.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2326x1311\" src=\"/user_uploads/thumbnail/3121/V9bwQkrt7MlhSRJja67g6lsc/Screenshot-from-2025-06-24-02-21-15.png/840x560.webp\"></a></div>",
        "id": 525424455,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724487
    },
    {
        "content": "<p>Yes, commutative monoids can be a resource (you should do the <a href=\"https://github.com/leanprover-community/iris-lean/issues/32\">numbers resources</a> after this!) But these are different than <code>Frac</code>. It is essential that <code>Frac</code> have a maximum valid element which neither <code>(Nat, +)</code> nor <code>(Nat, max)</code> really do.</p>",
        "id": 525424639,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750724675
    },
    {
        "content": "<p>Okay. In that case I will proceed as follows:</p>\n<ol>\n<li>I will move my current <code>Frac.lean</code> to <code>Numbers.lean</code>. Maybe even rename the PR.</li>\n</ol>",
        "id": 525424953,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750724993
    },
    {
        "content": "<ol start=\"2\">\n<li>Separately start a new PR against your PR to add the axioms Mario suggested for Frac.lean</li>\n</ol>\n<p>All this tomorrow</p>",
        "id": 525424983,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750725016
    },
    {
        "content": "<p>Mild confusion. In <code>Init.Prelude</code> online, I see a typeclass <code>One</code> <a href=\"https://github.com/leanprover/lean4/blob/6741444a63eec253a7eae7a83f1beb3de015023d/src/Init/Prelude.lean#L1441-L1444\">here</a></p>",
        "id": 525695910,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750852425
    },
    {
        "content": "<p>But somehow I can't access this in iris-lean</p>",
        "id": 525695953,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750852436
    },
    {
        "content": "<p>Did something change between toolchain updates?</p>",
        "id": 525695969,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750852441
    },
    {
        "content": "<p>This is the same part of the same file but opened in my editor with Ctrl + Click  and the <code>One</code> typeclass is missing</p>\n<p><a href=\"/user_uploads/3121/IrGRVXPUq8owY6fv9mcbysxu/Screenshot-from-2025-06-25-13-55-15.png\">Screenshot from 2025-06-25 13-55-15.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/IrGRVXPUq8owY6fv9mcbysxu/Screenshot-from-2025-06-25-13-55-15.png\" title=\"Screenshot from 2025-06-25 13-55-15.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1823x1493\" src=\"/user_uploads/thumbnail/3121/IrGRVXPUq8owY6fv9mcbysxu/Screenshot-from-2025-06-25-13-55-15.png/840x560.webp\"></a></div>",
        "id": 525696239,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750852552
    },
    {
        "content": "<p>That typeclass was only added two months ago, maybe the version of Lean you're using doesn't have it yet?</p>",
        "id": 525697671,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750853076
    },
    {
        "content": "<p>Okay that's possible. I haven't merged master and I don't think Markus has either</p>",
        "id": 525698006,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750853195
    },
    {
        "content": "<p>I remember this class being around for a while.</p>",
        "id": 525698147,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750853250
    },
    {
        "content": "<p>That typeclass has certainly been around for a while, but I think it was scattered across different files</p>",
        "id": 525698790,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750853499
    },
    {
        "content": "<p>Nah it isn't there even in v4.20.0</p>",
        "id": 525698898,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750853543
    },
    {
        "content": "<p>This seems to be the commit that brought it into the Prelude: <a href=\"https://github.com/leanprover/lean4/commit/196d899c0298e6d44dcce45253535bb617d8a539\"># Commit 196d899</a></p>",
        "id": 525698917,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750853552
    },
    {
        "content": "<p>Then it is surprising that it wasn't in this month's release</p>",
        "id": 525699125,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750853644
    },
    {
        "content": "<p>Are you sure you're running v4.20? <code>One</code> is in the Prelude for me: <a href=\"/user_uploads/3121/jrLx1-PzT0ZX-1rBuQcSBIR_/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jrLx1-PzT0ZX-1rBuQcSBIR_/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1454x910\" src=\"/user_uploads/thumbnail/3121/jrLx1-PzT0ZX-1rBuQcSBIR_/image.png/840x560.webp\"></a></div>",
        "id": 525700465,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750854118
    },
    {
        "content": "<p>Oh thanks. I was in the wrong branch</p>",
        "id": 525700815,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750854251
    },
    {
        "content": "<p>No worries!</p>",
        "id": 525700911,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750854284
    },
    {
        "content": "<p>We need totality of the order relation</p>",
        "id": 525703086,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750855012
    },
    {
        "content": "<p>What requires that?</p>",
        "id": 525703945,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750855298
    },
    {
        "content": "<p>You can't prove it from the axioms above</p>",
        "id": 525705208,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750855702
    },
    {
        "content": "<p>But maybe I am thinking about this the wrong way.</p>",
        "id": 525705273,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750855730
    },
    {
        "content": "<p>Maybe we don't need to prove it</p>",
        "id": 525705292,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750855738
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525390647\">said</a>:</p>\n<blockquote>\n<p>in that case how about this:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> exists</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a+b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> exists</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a+b=b+a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>c</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(a+b)+c=a+(b+c)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>&lt;</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a&lt;b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∃</mi><mi>c</mi><mo separator=\"true\">,</mo><mi>c</mi><mo>+</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">\\exists c,c+a=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">∃</span><span class=\"mord mathnormal\">c</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>, define <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a\\le b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">¬</mi><mi>b</mi><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\neg b&lt;a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord\">¬</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a\\le a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span></li>\n</ul>\n</blockquote>\n<p>These axioms?</p>",
        "id": 525708214,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750856642
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/iris-lean/pull/62\">leanprover-community/iris-lean#62</a></p>",
        "id": 525715308,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750858736
    },
    {
        "content": "<p>FWIW <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi mathvariant=\"double-struck\">Z</mi><mrow><mo>&gt;</mo><mn>0</mn></mrow></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">(\\Z_{&gt;0})^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathbb\">Z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">&gt;</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1774em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> (with 1 defined arbitrarily and + defined componentwise) seems to satisfy the both the axioms quoted by Oliver and the ones in the PR, and isn't total.</p>",
        "id": 525716368,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1750859083
    },
    {
        "content": "<p>I am beginning to think the only thing that we really need to check is if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x &lt; 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> for some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></p>",
        "id": 525720292,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860083
    },
    {
        "content": "<p>If not, then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> and we have total ownership of some resource</p>",
        "id": 525720539,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860148
    },
    {
        "content": "<p>More concretely, total ordering is not necessary</p>",
        "id": 525721385,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860375
    },
    {
        "content": "<p>That's an interesting thought</p>",
        "id": 525721498,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750860404
    },
    {
        "content": "<p>That's my intuition too, totality seems like an unnecessary restriction</p>",
        "id": 525721543,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750860421
    },
    {
        "content": "<p>It would be cool if we could instantiate it with abstract fractional permissions like <a href=\"https://www.cs.ubc.ca/~alexsumm/papers/HeuleLeinoMuellerSummers11.pdf\">here</a> (though I wouldn't read too much into their exact permissions structure itself)</p>",
        "id": 525722074,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750860571
    },
    {
        "content": "<p>Lol. I was thinking of something just like that</p>",
        "id": 525722155,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860591
    },
    {
        "content": "<p>Basically you don't need any operation other than halving and recombining</p>",
        "id": 525722192,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860601
    },
    {
        "content": "<p>there is an implicit partial order in halving</p>",
        "id": 525722376,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860650
    },
    {
        "content": "<p>So we only <code>combine</code> things that are equal in this order</p>",
        "id": 525722444,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860668
    },
    {
        "content": "<p>what we really need is an abstract binary tree structure where leaf nodes at the same level can be combined into a leaf node at the parent level or split</p>",
        "id": 525723092,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750860869
    },
    {
        "content": "<p>DFrac is more like the abstract fractional permissions in that paper, and deals with the invalid combinations, I think? Would be interesting to see if generalizing to partial orders (with total comparisons to 1) could simplify these OFE's.</p>",
        "id": 525723137,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750860882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525723092\">said</a>:</p>\n<blockquote>\n<p>what we really need is an abstract binary tree structure where leaf nodes at the same level can be combined into a leaf node at the parent level or split</p>\n</blockquote>\n<p>The rationals are not a binary tree so this is not right.</p>",
        "id": 525723512,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750860998
    },
    {
        "content": "<p>no they are not, but as Mario says, we just need dyadic rationals</p>",
        "id": 525723627,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861035
    },
    {
        "content": "<p>I don't see why we can only combine equals?</p>",
        "id": 525723653,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750861043
    },
    {
        "content": "<p>It means we don't have to keep track of what we are adding</p>",
        "id": 525723749,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861073
    },
    {
        "content": "<p>two equal leaf child nodes yield a new leaf node at the parent level</p>",
        "id": 525723812,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861090
    },
    {
        "content": "<blockquote>\n<p>The rationals are not a binary tree so this is not right.</p>\n</blockquote>\n<p><a href=\"/user_uploads/3121/jiGz_rOtfsmu2hRkwvbFBGkj/SternBrocotTree.svg.png\">SternBrocotTree.svg.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jiGz_rOtfsmu2hRkwvbFBGkj/SternBrocotTree.svg.png\" title=\"SternBrocotTree.svg.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1280x768\" src=\"/user_uploads/thumbnail/3121/jiGz_rOtfsmu2hRkwvbFBGkj/SternBrocotTree.svg.png/840x560.webp\"></a></div>",
        "id": 525724093,
        "sender_full_name": "suhr",
        "timestamp": 1750861165
    },
    {
        "content": "<p>Would that still work in practice though? To my knowledge it's fairly common for unequal fractional permissions to be combined</p>",
        "id": 525724152,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1750861179
    },
    {
        "content": "<p>So let's take a step back and consider what the fractional ownership actually represents</p>",
        "id": 525724412,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861245
    },
    {
        "content": "<p>In terms of heaplang, we get to create two threads out of one, if we fork at a thread.</p>",
        "id": 525724605,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861307
    },
    {
        "content": "<p>we recombine ownership when we join two threads</p>",
        "id": 525725310,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861498
    },
    {
        "content": "<p>One could also spawn N threads simultaneously and then somehow use the fact that threads are essentially the same?</p>",
        "id": 525725385,
        "sender_full_name": "suhr",
        "timestamp": 1750861521
    },
    {
        "content": "<p>You can model that general scenario using dyadic rationals</p>",
        "id": 525725474,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861547
    },
    {
        "content": "<p>but the model that I think Mario has in mind is based on what we do in heaplang</p>",
        "id": 525725510,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861562
    },
    {
        "content": "<p>You can, but the proof might become more complex.</p>",
        "id": 525725520,
        "sender_full_name": "suhr",
        "timestamp": 1750861566
    },
    {
        "content": "<p>We can instantiate the class with rationals</p>",
        "id": 525725585,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861581
    },
    {
        "content": "<p>and define the combining operation in terms of addition</p>",
        "id": 525725632,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861593
    },
    {
        "content": "<p>We will have the issue you speak of in any case <span class=\"user-mention\" data-user-id=\"394485\">@suhr</span>  : The definition Mario proposed is rather general</p>",
        "id": 525725917,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861675
    },
    {
        "content": "<p>The creation of n threads is an atomic sequence of (n-1) forks</p>",
        "id": 525726034,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861708
    },
    {
        "content": "<p>Yes. Halving of any kind is not necessary for the proof that Frac is a CMRA and therefore should not be part of the <code>Fractional</code> class.</p>",
        "id": 525726091,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1750861723
    },
    {
        "content": "<p>Anyway,  I think I have most of it nailed. I only made two changes. I added an axiom that <code>a  &lt; b -&gt; a \\neq b</code></p>",
        "id": 525726450,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861816
    },
    {
        "content": "<p>and defined <code>a \\leq b</code> as <code>a &lt; b \\or a = b</code></p>",
        "id": 525726525,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861832
    },
    {
        "content": "<p>This is much more convenient for proofs</p>",
        "id": 525726550,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1750861842
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525720292\">said</a>:</p>\n<blockquote>\n<p>I am beginning to think the only thing that we really need to check is if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x &lt; 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> for some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></p>\n</blockquote>\n<p>Just curious, did this not end up working out for some reason?</p>",
        "id": 526139054,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751050908
    },
    {
        "content": "<p>Oh no it works. I didn’t imagine this PR was the right place to experiment since Mario and you already had a plan.</p>",
        "id": 526140266,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751051534
    },
    {
        "content": "<p>In general I think frac should just be a rooted tree</p>",
        "id": 526140297,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751051550
    },
    {
        "content": "<p>The arity need not be fixed</p>",
        "id": 526140396,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751051589
    },
    {
        "content": "<p>Basically it would model thread ownership</p>",
        "id": 526140424,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751051602
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526140266\">said</a>:</p>\n<blockquote>\n<p>Oh no it works. I didn’t imagine this PR was the right place to experiment since Mario and you already had a plan.</p>\n</blockquote>\n<p>Good to know!</p>",
        "id": 526140430,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751051606
    },
    {
        "content": "<p>A thread can only return fractional ownership to its creator if it has the entirety of its piece. When a thread spawns with split ownership, then, correspondingly many child nodes are tacked on. When the child nodes return their piece they are deleted. Ownership is 1 only if the tree has a root node with no children.  </p>\n<p>Frac is a very special case of this where, we always maintain a version of the tree flattened upto the root node plus its children nodes :<br>\nmeaning either of the following : </p>\n<ol>\n<li>only the root node produces more pieces of partial ownership (or)</li>\n<li>The only non root nodes are leaf nodes, which are children of the root.  Instead of adding child nodes to a non root node, we simply replace that node with more leaf nodes.  </li>\n</ol>\n<p>In either case total ownership is represented by a tree with only the root node.</p>",
        "id": 526140969,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751051916
    },
    {
        "content": "<p>The nice thing is one can effectively compute when ownership is complete without the imprecision of machine arithmetic or overhead of rational arithmetic.</p>",
        "id": 526142834,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751053010
    },
    {
        "content": "<p>One can also precisely reason about when a thread can relinquish ownership of its fraction.</p>",
        "id": 526142899,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751053050
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"721721\">Markus de Medeiros</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/525726091\">said</a>:</p>\n<blockquote>\n<p>Yes. Halving of any kind is not necessary for the proof that Frac is a CMRA and therefore should not be part of the <code>Fractional</code> class.</p>\n</blockquote>\n<p>While true, I think you will probably want a class that extends this which actually contains a halving or similar operation, since without halving you can't actually do anything interesting with the class that would motivate including this CMRA in your iProp. And you might want to reconsider calling this class <code>Fractional</code> as there is nothing fractional about it, <code>PNat</code> satisfies the definition</p>",
        "id": 526150806,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751057540
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526140297\">said</a>:</p>\n<blockquote>\n<p>In general I think frac should just be a rooted tree</p>\n</blockquote>\n<p>That doesn't sound associative</p>",
        "id": 526151115,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751057743
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526140969\">said</a>:</p>\n<blockquote>\n<p>A thread can only return fractional ownership to its creator if it has the entirety of its piece. When a thread spawns with split ownership, then, correspondingly many child nodes are tacked on. When the child nodes return their piece they are deleted. Ownership is 1 only if the tree has a root node with no children.</p>\n</blockquote>\n<p>Your model, where you only recombine elements at the same height, is more restrictive than the actual fractional permissions model over Q, which in particular lets you do the following:</p>\n<ul>\n<li>Initialize with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_1 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span></li>\n<li>Split <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_1 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> into <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><msub><mo>↦</mo><mi>a</mi></msub><mi>v</mi><mo stretchy=\"false\">)</mo><mo>∗</mo><mo stretchy=\"false\">(</mo><mi>x</mi><msub><mo>↦</mo><mi>b</mi></msub><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x\\mapsto_a v)\\ast (x\\mapsto_b v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a+b=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n<li>Fork off thread A with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mi>a</mi></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_a v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> permission</li>\n<li>Split <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mi>b</mi></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_b v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> into <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><msub><mo>↦</mo><mi>c</mi></msub><mi>v</mi><mo stretchy=\"false\">)</mo><mo>∗</mo><mo stretchy=\"false\">(</mo><mi>x</mi><msub><mo>↦</mo><mi>d</mi></msub><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x\\mapsto_c v)\\ast (x\\mapsto_d v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>+</mo><mi>d</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">c+d=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></li>\n<li>Fork off thread C with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mi>c</mi></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_c v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> permission</li>\n<li>Thread C passes its ownership of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mi>c</mi></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_c v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> to thread A (say, through a mutex) and exits</li>\n<li>Thread A recombines permissions to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mi>e</mi></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_e v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">e</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>c</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">a+c=e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></li>\n<li>Thread A dies and returns its permissions to main thread</li>\n<li>Main thread recombines permissions to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><msub><mo>↦</mo><mn>1</mn></msub><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">x\\mapsto_1 v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.661em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\">↦</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mo>+</mo><mi>e</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">d+e=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n</ul>\n<p>If you keep track of what is happening with the fractions, you will see that at least one of the splits/merges <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a+b=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>+</mo><mi>d</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">c+d=b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>c</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">a+c=e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mo>+</mo><mi>e</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">d+e=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> has to involve adding two fractions that are not at the same height. Permitting splits and merges only in perfect halves only permits stack-like usage of read permissions and would ban the cross cut here where thread C passes its permission over to thread A.</p>",
        "id": 526152119,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751058310
    },
    {
        "content": "<p>Okay but you can recover this by allowing child nodes to be transferred</p>",
        "id": 526155762,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751060985
    },
    {
        "content": "<p>At that point that fractional piece (c) is shifted to a different subtree so the subtree rooted at (b) is not concerned about it</p>",
        "id": 526155845,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751061053
    },
    {
        "content": "<p>my point is that you need associativity to hold, and it doesn't if you only allow combining equal pieces</p>",
        "id": 526155940,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061136
    },
    {
        "content": "<p>if we suppose that all the splits are equal, then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>=</mo><mi>b</mi><mo>=</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">a=b=1/2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/2</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><mi>d</mi><mo>=</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">c=d=1/4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/4</span></span></span></span>, and then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi><mo>=</mo><mn>3</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">e=3/4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3/4</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn><mo>+</mo><mn>3</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1/4+3/4=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/4</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3/4</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> is an unequal merge</p>",
        "id": 526155985,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061178
    },
    {
        "content": "<p>that is, you need dyadic rationals, not just <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><msup><mn>2</mn><mi>n</mi></msup><mo>∣</mo><mi>n</mi><mo>∈</mo><mi mathvariant=\"double-struck\">N</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{1/2^n\\mid n\\in\\mathbb{N}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbb\">N</span><span class=\"mclose\">}</span></span></span></span></p>",
        "id": 526156072,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061250
    },
    {
        "content": "<p>Okay so concretely we need an operation that works on combining arbitrary subtrees associatively.</p>",
        "id": 526156242,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751061388
    },
    {
        "content": "<p>what exactly are the trees you are referring to?</p>",
        "id": 526156274,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061415
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526150806\">said</a>:</p>\n<blockquote>\n<p>While true, I think you will probably want a class that extends this which actually contains a halving or similar operation,</p>\n</blockquote>\n<p>Yeah I wouldn't be opposed to this by any stretch! This won't affect anything beneath a program logic though, so it's library code.</p>",
        "id": 526156449,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751061573
    },
    {
        "content": "<p>well you can't type a fork operation without it</p>",
        "id": 526156483,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061604
    },
    {
        "content": "<p>Good thing the language I care about doesn't have fork :p</p>",
        "id": 526156540,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751061638
    },
    {
        "content": "<p>why would you care about fractional permissions if you can't make fractions?</p>",
        "id": 526156547,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061656
    },
    {
        "content": "<p>we already have Auth, right?</p>",
        "id": 526156591,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751061680
    },
    {
        "content": "<p>Yes. But it's downstream of some constructions like <code>gmap_view</code> which I do care about.</p>",
        "id": 526156684,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751061760
    },
    {
        "content": "<p>In <code>gmap_view</code> the authoritative part has a fractional permission, and is used in a variety of program logics. We could write a version of <code>gmap_view</code> which elides this but it's nice that I can get the one I want without duplicating the structure.</p>",
        "id": 526156784,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751061851
    },
    {
        "content": "<p>It might be possible to parameterize <code>gmap_view</code> even further (parameterize the auth part by an arbitrary CMRA or something?) but I'm not sure about that yet.</p>",
        "id": 526156960,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751062006
    },
    {
        "content": "<p>Anyways, I ended up refactoring Shreyvas'  code to implement his idea about comparing to 1</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Fractional</span>\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Validity predicate on fractions. Generalizes the notion of `(· ≤ 1)` from rational fractions. -/</span>\n<span class=\"w\">  </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"n\">add_comm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">add_assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"n\">add_left_cancel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- There does not exist a zero fraction. -/</span>\n<span class=\"w\">  </span><span class=\"n\">add_ne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">proper_add_mono_left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"sd\">/-- A type of fractions with a unique whole element. -/</span>\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">UFractional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">One</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">whole_iff_one</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">whole</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">NumericFractional</span>\n<span class=\"sd\">/-- Generic fractional instance for types with comparison and 1 operators. -/</span>\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">NumericFractional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">One</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">add_comm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">add_assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"n\">add_left_cancel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"n\">le_def</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">lt_def</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">lt_not_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumFractional</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UFractional</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">where</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>I think <code>UFractional</code> is probably the most general class that doesn't cause real problems downstream, but I'll keep playing around with it over the next few days to find out.</p>",
        "id": 526157219,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751062206
    },
    {
        "content": "<p>what is <code>whole</code>?</p>",
        "id": 526157337,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062286
    },
    {
        "content": "<p>I think it’s an implementation of the idea that the only order comparison you actually care about it with 1</p>",
        "id": 526157453,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751062398
    },
    {
        "content": "<p>what is <code>add_left_cancel</code> used for?</p>",
        "id": 526157454,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062398
    },
    {
        "content": "<p>I thought that was <code>proper</code> <span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span></p>",
        "id": 526157467,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062412
    },
    {
        "content": "<p>I don't think <span class=\"user-mention\" data-user-id=\"721721\">@Markus de Medeiros</span> 's code compiles as written since <code>whole</code> isn't defined</p>",
        "id": 526157487,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062431
    },
    {
        "content": "<p>whole is proper when the order is total I suppose.</p>",
        "id": 526157533,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751062465
    },
    {
        "content": "<p>no, <code>whole</code> appears to generalize <code>a &gt;= 1</code> while <code>proper</code> generalizes <code>a &lt;= 1</code></p>",
        "id": 526157572,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062498
    },
    {
        "content": "<p>or maybe <code>1 | a</code>, I'm not sure because there are no axioms for it</p>",
        "id": 526157622,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062537
    },
    {
        "content": "<p>Ah right--sorry I snipped that segment out of a couple parts of the PR. Here's the missing piece:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- A fraction does not represent the entire resource.</span>\n<span class=\"sd\">Generalizes the notion of `(· &lt; 1)` from rational fractions. -/</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">fractional</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- A fraction that is tne entire resource.</span>\n<span class=\"sd\">Generalizes the notion of `1` from rational fractions. -/</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">whole</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fractional</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">proper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 526157675,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751062591
    },
    {
        "content": "<p>I would expect the first conjunct in <code>fractional</code> to not be needed</p>",
        "id": 526157717,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062626
    },
    {
        "content": "<p>FYI <code>proper</code>, <code>fractional</code> and <code>whole</code> should be capitalized</p>",
        "id": 526157730,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062639
    },
    {
        "content": "<p>Proper generalizes <code>&lt;=</code>, fractional generalizes <code>&lt;</code>, whole generalizes <code>1</code>. I wanted to see how general I could make the CMRA construction, but for some downstream code it is (or at least seems) important to have a unique whole element.</p>",
        "id": 526157734,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751062641
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526157454\">said</a>:</p>\n<blockquote>\n<p>what is <code>add_left_cancel</code> used for?</p>\n</blockquote>\n<p>I recall using it to prove a few lemmas about order in my pr to Markus’s PR</p>",
        "id": 526157788,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751062683
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526157717\">said</a>:</p>\n<blockquote>\n<p>I would expect the first conjunct in <code>fractional</code> to not be needed</p>\n</blockquote>\n<p>I think you're right about that</p>",
        "id": 526157865,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751062737
    },
    {
        "content": "<p>and if you do that then <code>whole</code> can be simplified using <code>fractional</code></p>",
        "id": 526157887,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062750
    },
    {
        "content": "<p>these shouldn't be abbrevs</p>",
        "id": 526157892,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751062755
    },
    {
        "content": "<p>The intuitive idea behind the tree is to represent how ownership of a resource is split. Each subtree represents the split up of some fragment of a resource.  All currently owned resources are represented by leaf nodes. When a fragment of a resource is split (or some fragment taken out of the resource, the corresponding leaf node branches out into child nodes.</p>",
        "id": 526163785,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751068890
    },
    {
        "content": "<p>These splits don’t have to be “equal”</p>",
        "id": 526163799,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751068902
    },
    {
        "content": "<p>You might choose to transfer ownership of an entire subtree of resources to a different branch.</p>",
        "id": 526163836,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751068925
    },
    {
        "content": "<p>I am trying to come up with the most free version of resource splitting that keeps track of the history of resource partitioning and sharing.</p>",
        "id": 526163879,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751068968
    },
    {
        "content": "<p>One can also think of the internal &amp; leaf nodes of the tree as threads, where only leaf threads hold resource fragments. When, say, a single thread is forked from another, the node of the parent thread splits into two child nodes  of which one carries the resource of the newly forked thread, and the other carries what’s left in the parent thread. Conversely the join operation joins child nodes. If there are no other child threads left then a child node is merged into its parent node. If you wish to represent the transfer of resources to a different thread, this is done by attaching the corresponding subtrees as children of the node corresponding to the recipient thread.</p>",
        "id": 526164292,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751069531
    },
    {
        "content": "<p>That being said, the more  I write, the more complicated this seems to be getting. Rational numbers seem much simpler</p>",
        "id": 526164371,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751069673
    },
    {
        "content": "<p>sure, you can imagine the resources as a finite antichain in the complete binary tree, but then the \"numbers\" need to represent sets of leaves, not just one</p>",
        "id": 526164442,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751069770
    },
    {
        "content": "<p>and that's equivalent to dyadic rationals</p>",
        "id": 526164454,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751069781
    },
    {
        "content": "<p>Actually if you really want the <em>free</em> structure defined by these axioms I think you would get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">comm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">assoc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">split</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b'</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">one</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Disjoint</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FreeRational</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Quot</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Valid</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">·.</span><span class=\"m\">1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 526165241,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751070852
    },
    {
        "content": "<p>This is including an axiom saying splits exist, i.e. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∀</mi><mi>x</mi><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">∃</mi><mi>a</mi><mi>b</mi><mo separator=\"true\">,</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\forall x,\\exists a b,a+b=x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">∀</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">∃</span><span class=\"mord mathnormal\">ab</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></p>",
        "id": 526165307,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751070950
    },
    {
        "content": "<p>but not specifically that half exists, which is why <code>left</code> and <code>right</code> are not the same</p>",
        "id": 526165336,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751070980
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526157454\">said</a>:</p>\n<blockquote>\n<p>what is <code>add_left_cancel</code> used for?</p>\n</blockquote>\n<p>Only the <code>CMRA.Cancellable</code> instance right now, for which it seems necessary. No idea what else downstream.</p>",
        "id": 526166184,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751072223
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526164442\">said</a>:</p>\n<blockquote>\n<p>sure, you can imagine the resources as a finite antichain in the complete binary tree, but then the \"numbers\" need to represent sets of leaves, not just one</p>\n</blockquote>\n<p>Yes. But the sets would correspond to a subtree. So merging a set of resources would be collapsing a subtree to its root node.</p>",
        "id": 526167192,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751073486
    },
    {
        "content": "<p>but there isn't necessarily one root node</p>",
        "id": 526167241,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073542
    },
    {
        "content": "<p>If some fragment of the subtree is actually moved, the corresponding subsubtree is transplanted to the other root node</p>",
        "id": 526167251,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751073547
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526167241\">said</a>:</p>\n<blockquote>\n<p>but there isn't necessarily one root node</p>\n</blockquote>\n<p>Root of a subtree.</p>",
        "id": 526167260,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751073558
    },
    {
        "content": "<p>The overall tree has one root node that represents 1, and when the tree collapses to its root there is sole ownership again.</p>",
        "id": 526167298,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751073600
    },
    {
        "content": "<p>if you have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">\\</span>\n<span class=\"w\">  </span><span class=\"n\">d</span><span class=\"w\">   </span><span class=\"n\">c</span>\n<span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">\\</span>\n<span class=\"n\">a</span><span class=\"w\">   </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>then <code>{b, c}</code> can't be represented by the root node <code>1</code> because it's missing <code>a</code></p>",
        "id": 526167318,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073619
    },
    {
        "content": "<p>there is no single node which represents <code>{b, c}</code></p>",
        "id": 526167342,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073654
    },
    {
        "content": "<p>in the above inductive this would be <code>add (right (left one)) (right one)</code></p>",
        "id": 526167390,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073713
    },
    {
        "content": "<p>and actually I don't think sets of nodes from the tree is enough, since if you decided to split <code>{b, c}</code> then there is no set of nodes that would be equivalent to (i.e. <code>left (add (right (left one)) (right one))</code> isn't a set of nodes)</p>",
        "id": 526167462,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073817
    },
    {
        "content": "<p>If you split b and c, you would have a new internal node</p>",
        "id": 526167562,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751073941
    },
    {
        "content": "<p>no, I'm splitting <code>b + c</code></p>",
        "id": 526167601,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751073995
    },
    {
        "content": "<p>not <code>b</code> or <code>c</code></p>",
        "id": 526167609,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074002
    },
    {
        "content": "<p>Oh right</p>",
        "id": 526167612,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074012
    },
    {
        "content": "<p>But once we do b + c, do we care to keep their identities separate?</p>",
        "id": 526167654,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074057
    },
    {
        "content": "<p>Can’t they just be one thread carrying b and c as on big fragment of resource?</p>",
        "id": 526167684,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074097
    },
    {
        "content": "<p>we don't, but that's the problem, there is no single node representing that combination so now we can't draw children of that non-node to represent the result of splitting it</p>",
        "id": 526167695,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074109
    },
    {
        "content": "<p>we would need a representation where sums of elements are themselves elements</p>",
        "id": 526167725,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074147
    },
    {
        "content": "<p>In my idea you would combine the two nodes of b and c into one node</p>",
        "id": 526167731,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074151
    },
    {
        "content": "<p>which the inductive type does</p>",
        "id": 526167737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074154
    },
    {
        "content": "<p>what does that mean?</p>",
        "id": 526167747,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074167
    },
    {
        "content": "<p>If it is the sole remaining child, then just delete and let the parent node represent the combination of b and c</p>",
        "id": 526167754,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074175
    },
    {
        "content": "<p>You can definitely do it if you have mutable state, the challenge here is that this \"rational\" type has to represent every possible split pattern and history</p>",
        "id": 526167796,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074216
    },
    {
        "content": "<p>if you have mutable state you just need a list of objects that add to 1</p>",
        "id": 526167818,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074249
    },
    {
        "content": "<p>and every split just removes that element and adds two more</p>",
        "id": 526167828,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074263
    },
    {
        "content": "<p>Let’s say you have a node structure <code> a-&gt; [b,c,d]</code>. When merging b and c you create a combined node <code>e</code>. Then you get <code>a -&gt; [e,d]</code></p>",
        "id": 526167845,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074282
    },
    {
        "content": "<p>If you combine <code>e</code> and <code>d</code> into a new blob <code>f</code>, first that node becomes <code>a -&gt; </code>[f]`</p>",
        "id": 526167886,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074345
    },
    {
        "content": "<p>Then because <code>a</code> has only one child</p>",
        "id": 526167893,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074357
    },
    {
        "content": "<p><code>a</code> gets replaced by <code>f</code></p>",
        "id": 526167902,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074374
    },
    {
        "content": "<p>but <code>Rational</code> is just a type, it isn't living in some particular context which keeps track of what other rationals have been created</p>",
        "id": 526167905,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074377
    },
    {
        "content": "<p>and in particular even if you did store that context inside each rational you would get in trouble when it goes out of date because you try to hold on to one piece while splitting another one</p>",
        "id": 526167970,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751074455
    },
    {
        "content": "<p>My hope is that we don’t actually have to track exact numbers. After all we only care that we can merge the same things we split and check that we have all the pieces.  Suppose we split a cake into pieces and put them in different plates on a table. We then put the pieces back on the cake tray.  Even if we don’t rearrange them into the exact shape, and have a haphazard arrangement, ,we can determine that all the pieces we cut out have been returned. This is because all the plates are empty</p>",
        "id": 526168321,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074851
    },
    {
        "content": "<p>The tree analogy just introduces some bigger intermediate plates and the tree structure tracks which small plates derive their cake from which intermediate plate.</p>",
        "id": 526168365,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751074902
    },
    {
        "content": "<p>Iris is affine so you can lose plates</p>",
        "id": 526168377,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751074915
    },
    {
        "content": "<p>Right, but even if someone steals a plate, we can track of whether someone owns a totality or part of the remaining cake by checking for emptiness of remaining plates</p>",
        "id": 526169105,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751075809
    },
    {
        "content": "<p>Even in the rational number case, if some resource fragment just disappears, then thanks to our full ownership check (=?= 1) , the remainig fragments can’t sum up to 1.</p>",
        "id": 526169160,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751075861
    },
    {
        "content": "<p>To be upfront, I can see the simplicity of just using rational numbers here. The more I think about this tree system, the more complicated it seems.</p>",
        "id": 526169209,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1751075929
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526168321\">said</a>:</p>\n<blockquote>\n<p>My hope is that we don’t actually have to track exact numbers. After all we only care that we can merge the same things we split and check that we have all the pieces.  Suppose we split a cake into pieces and put them in different plates on a table. We then put the pieces back on the cake tray.  Even if we don’t rearrange them into the exact shape, and have a haphazard arrangement, ,we can determine that all the pieces we cut out have been returned. This is because all the plates are empty</p>\n</blockquote>\n<p>The free rational type is strictly harder than just tracking actual numbers. But really you don't need to do this in logical reasoning, you existentially quantify all of these numbers so you aren't actually working with them concretely anyway</p>",
        "id": 526169225,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751075957
    },
    {
        "content": "<p>The point of this type is to have an abstract accounting mechanism that in principle does not forget anything</p>",
        "id": 526169283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076017
    },
    {
        "content": "<p>that's what you need to prove the lemmas</p>",
        "id": 526169296,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076029
    },
    {
        "content": "<p>but in the program logic you don't actually need to deal with the numbers</p>",
        "id": 526169327,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076045
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/490604-iris-lean/topic/Rationals.20needed.20for.20the.20Frac.20CMRA.3F/near/526169225\">said</a>:</p>\n<blockquote>\n<p>you existentially quantify all of these numbers</p>\n</blockquote>\n<p>Well that's not strictly true, you could want a finitely splittable fractional resource for example (Nat+ with addition and <code>One.one := n</code>). But your overall point that program logics abstract over the concrete fractions is true.</p>",
        "id": 526169757,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751076579
    },
    {
        "content": "<p>if you are doing finite splitting then yes you will have to do math</p>",
        "id": 526169815,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076643
    },
    {
        "content": "<p>maybe the fistful of dollars paper is doing that?</p>",
        "id": 526169867,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076663
    },
    {
        "content": "<p>(misremembered, that was not an iris paper, but <a href=\"https://iris-project.org/pdfs/2019-esop-time.pdf\">https://iris-project.org/pdfs/2019-esop-time.pdf</a> is the iris version)</p>",
        "id": 526170049,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751076863
    },
    {
        "content": "<p>IIRC that's different, more like the numbers CMRA's</p>",
        "id": 526170129,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751076955
    },
    {
        "content": "<p>I guess if you want a finitely divisible read permission that would be something like a bounded concurrency primitive</p>",
        "id": 526170171,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751077012
    },
    {
        "content": "<p>Or maybe to specify an invariant for a size N circular buffer, something like <code>[ exists n, Frac(n) * pure (sizeof buf + n = N) ]</code>so if you have <code>Frac i</code> it is sound to add <code>i</code> elements to the buffer without overflow.</p>",
        "id": 526170530,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751077593
    },
    {
        "content": "<p>Anyways, this is interesting but no reason to add anything about splitting to Frac haha</p>",
        "id": 526170592,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751077668
    },
    {
        "content": "<p>I don't see why you wouldn't just use numbers CMRA for that</p>",
        "id": 526170599,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751077677
    },
    {
        "content": "<p>Sure, yeah</p>",
        "id": 526170623,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1751077720
    },
    {
        "content": "<p>I think this discussion has been a bit too theoretical, we don't actually have the code that uses Frac</p>",
        "id": 526170628,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751077736
    },
    {
        "content": "<p>the only motivation thus far is that it is one part of the stack to define something we want, but obviously that was added for a reason and I am sure we don't have anything that would notice if we just skipped that part</p>",
        "id": 526170668,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1751077801
    },
    {
        "content": "<p>FYI: I did end up needing to add in class of fractions with splitting for this update lemma: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">dfrac_undiscard_update</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsSplitFraction</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">discard</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DFrac</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~~&gt;</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">own</span><span class=\"w\"> </span><span class=\"n\">q</span>\n</code></pre></div>",
        "id": 531687523,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1753818630
    }
]