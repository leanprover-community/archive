[
    {
        "content": "<p>The <code>iapply</code> tactic has been implemented! (PR <a href=\"https://github.com/leanprover-community/iris-lean/pull/80\">#80</a>)</p>\n<p>Like most iris-lean tactics, it does not yet have the same flexibility as its Rocq equivalent, however I'm confident that the tactic is sufficiently useful in its current form.</p>\n<p>Next steps for <code>iapply</code> would include the ability to apply hypotheses from the lean context directly and the use of advanced specialization patterns. I could add these to the current PR though it might be worth splitting them into separate issues/PRs, let me know what you think.</p>\n<p>If anyone could try <code>iapply</code> out for their proofs and give me some feedback that would be very helpful :)</p>",
        "id": 532717929,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754310675
    },
    {
        "content": "<p>Sweet! I'll merge that into my personal branch and play around with it today :)</p>",
        "id": 532721880,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754312077
    },
    {
        "content": "<p>I'll just post my feedback here as I have it: having iapply work with functions from the Lean context is definitely an important feature</p>",
        "id": 532725103,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754313162
    },
    {
        "content": "<p>The workaround I've found atm is to first put the theorem into the Iris context with transitivity and then specialize/apply it from there</p>",
        "id": 532725333,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754313238
    },
    {
        "content": "<p>(which has the major PITA that you need to spell out all of your implicits instead of getting them by unification with your goal)</p>",
        "id": 532725573,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754313323
    },
    {
        "content": "<p>Yea that's definitely a major deficit, I'll make sure to add it to the current PR</p>",
        "id": 532727293,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754313924
    },
    {
        "content": "<p>Minor regression, I don't think it's that important but just be aware of it. Before in the context</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∗</span><span class=\"n\">Hσ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">state_interp</span><span class=\"w\"> </span><span class=\"n\">sl</span><span class=\"w\"> </span><span class=\"n\">sr</span>\n<span class=\"bp\">∗</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">sl</span><span class=\"w\"> </span><span class=\"n\">sr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">state_interp</span><span class=\"w\"> </span><span class=\"n\">sl</span><span class=\"w\"> </span><span class=\"n\">sr</span><span class=\"w\"> </span><span class=\"bp\">-∗</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>I was able to do <code>ispecialize H Hσ</code>, but now it complains that it can't synthesize <code>IntoWand</code>. <code>ispecialize H sl sr Hσ</code> works though so it's nbd</p>",
        "id": 532730102,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754314804
    },
    {
        "content": "<p>Ah, this might be related to something in <code>iApply</code>. I'm struggling to minimize the example since it seems to go away when the types are simpler, but I'll put it here for posterity anyways</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Example</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">wp_gen_loc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Locals</span><span class=\"w\"> </span><span class=\"n\">DataT</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Locals</span><span class=\"w\"> </span><span class=\"n\">DataT</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⌜</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"bp\">⌝</span><span class=\"w\"> </span><span class=\"bp\">-∗</span><span class=\"w\"> </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DataT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DataT</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sₗ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pₗ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sᵣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pᵣ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Φ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-∗</span>\n<span class=\"w\">    </span><span class=\"bp\">⌜</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">llₗ</span><span class=\"w\"> </span><span class=\"n\">llᵣ</span><span class=\"bp\">⌝</span><span class=\"w\"> </span><span class=\"bp\">-∗</span>\n<span class=\"w\">    </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DataT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DataT</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sₗ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">llₗ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pₗ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">sᵣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">llᵣ</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pᵣ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Φ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">iintro</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">HR</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Breaks without this ispecialize</span>\n<span class=\"w\">  </span><span class=\"n\">ispecialize</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">HR</span>\n<span class=\"w\">  </span><span class=\"n\">iapply</span><span class=\"w\"> </span><span class=\"n\">H</span>\n</code></pre></div>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Error</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">ProofMode</span><span class=\"bp\">.</span><span class=\"n\">FromAssumption</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">    </span><span class=\"n\">iprop</span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"bp\">⌜</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"bp\">⌝</span><span class=\"w\"> </span><span class=\"bp\">-∗</span>\n<span class=\"w\">          </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExecState</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sₗ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">locₗ</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pₗ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExecState</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sᵣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">locᵣ</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pᵣ</span><span class=\"o\">))</span>\n<span class=\"w\">            </span><span class=\"n\">Φ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExecState</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sₗ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">llₗ</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pₗ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ExecState</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">stmt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sᵣ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">llᵣ</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">pᵣ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">Φ</span><span class=\"o\">)</span>\n</code></pre></div>\n</div></div>",
        "id": 532785501,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754336008
    },
    {
        "content": "<p><code>iApply</code> is super nice to have even in this form!</p>",
        "id": 532785658,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754336078
    },
    {
        "content": "<p>It would be great to automatically use Affine lemmas in the case of applying wands like <code>P  -∗ (Q ∗ emp)</code>, and automatically eliminate trivial goals when applying <code>(True ∗ P) -∗ Q</code>, this stuff comes up when going in and out of the proofmode, which we need to do for the near future (and IMO is a super nice feature of of the proofmode!)</p>",
        "id": 532796787,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754340960
    },
    {
        "content": "<p>Also, I'm wondering if there's a way to name goals coming from <code>iApply</code>? I'm actually not sure if there's a way to do after the fact this in regular Lean but sometimes we might want to solve the generated goals in a different order.</p>",
        "id": 532796925,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754341040
    },
    {
        "content": "<p>Oh yeah related to the first point, an intro pattern to clear unwanted lemmas would be nice (like <code>_</code> in Rocq, since <code>_</code> behaves like <code>?</code> in Lean)</p>",
        "id": 532797091,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754341133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"721721\">Markus de Medeiros</span> <a href=\"#narrow/channel/490604-iris-lean/topic/iApply.20tactic.20implemented/near/532797091\">said</a>:</p>\n<blockquote>\n<p>Oh yeah related to the first point, an intro pattern to clear unwanted lemmas would be nice (like <code>_</code> in Rocq, since <code>_</code> behaves like <code>?</code> in Lean)</p>\n</blockquote>\n<p><code>iintro</code> supports using <code>-</code> to clear lemmas, is that what you're looking for?</p>",
        "id": 532855401,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754380225
    },
    {
        "content": "<p>TIL, thanks!</p>",
        "id": 532882214,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754388264
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 532977004,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754421913
    },
    {
        "content": "<p><code>iapply</code> should work with lemmas from the lean context now!</p>",
        "id": 533058721,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754471648
    },
    {
        "content": "<p>At the moment it is prone to adding trivial goals, so I'll try to get their automatic elimination working next</p>",
        "id": 533059119,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754471767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"769610\">Oliver Soeser</span> <a href=\"#narrow/channel/490604-iris-lean/topic/iApply.20tactic.20implemented/near/533058721\">said</a>:</p>\n<blockquote>\n<p><code>iapply</code> should work with lemmas from the lean context now!</p>\n</blockquote>\n<p>Sweeeet!</p>",
        "id": 533107718,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754488142
    },
    {
        "content": "<p>I've also put in some automatic goal elimination, though that still needs improving</p>",
        "id": 533107959,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754488215
    },
    {
        "content": "<p>How hard would it be to allow <code>iapply</code> to be given a proof term, or to apply a lemma that has implicits? Here's a representative example: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Example</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Iris</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">PROP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BI</span><span class=\"w\"> </span><span class=\"n\">PROP</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">PROP</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Works when you specialize everything yourself</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"n\">iintro</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"n\">iapply</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">H</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Lalt</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- But can I apply L without providing all the implicits?</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">iintro</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"c1\">-- iapply L with [H] -- iapply: L is not an entailment</span>\n<span class=\"w\">  </span><span class=\"c1\">-- iapply Lalt       -- unexpected term '@Lalt'; expected single reference to variable</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Example</span>\n</code></pre></div>",
        "id": 533117365,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754490949
    },
    {
        "content": "<p>It's not so bad in this example but when your start having more implicits, specializing them all becomes big problem <br>\n<a href=\"/user_uploads/3121/YCzMyxIRmgCkk9rUnN4TE4KQ/Screenshot-2025-08-06-at-10.36.42AM.png\">Screenshot 2025-08-06 at 10.36.42 AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YCzMyxIRmgCkk9rUnN4TE4KQ/Screenshot-2025-08-06-at-10.36.42AM.png\" title=\"Screenshot 2025-08-06 at 10.36.42 AM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1264x366\" src=\"/user_uploads/thumbnail/3121/YCzMyxIRmgCkk9rUnN4TE4KQ/Screenshot-2025-08-06-at-10.36.42AM.png/840x560.webp\"></a></div>",
        "id": 533117796,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754491079
    },
    {
        "content": "<p>For example in the screenshot above I would love to be able to do <code>iapply (wp_gen_loc (fun _ _ =&gt; True)</code> since everything else matches with the proof goal exactly by unification</p>",
        "id": 533118024,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754491147
    },
    {
        "content": "<p>It seems that there are two issues:</p>\n<ul>\n<li>Feeding <code>iapply</code> a Lean term for an entailment <code>(wp_gen_loc (fun _ _ =&gt; True))</code> instead of the name of a Lean term for an entailment <code>Z</code></li>\n<li><code>iapply</code>ing a term with implicits</li>\n</ul>",
        "id": 533118320,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754491241
    },
    {
        "content": "<p>For lemmas with implicits: that's gonna need some procedure to automatically fill them, which shouldn't be too difficult I hope</p>",
        "id": 533118713,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754491351
    },
    {
        "content": "<p>For feeding proof terms, I'm gonna look into how I can adjust the parser to allow that</p>",
        "id": 533118834,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754491386
    },
    {
        "content": "<p>Nice. The latter might even solve the former.</p>",
        "id": 533119039,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754491449
    },
    {
        "content": "<p>for the parser, you might be able to borrow the syntax spec of the <code>apply</code> tactic</p>",
        "id": 533119071,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754491461
    },
    {
        "content": "<p>It shouldn't really affect how the proof is elaborated anyway</p>",
        "id": 533119155,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1754491493
    },
    {
        "content": "<p>At the moment my procedure for passing lean lemmas just very bluntly pattern matches for an entailment, so that would need to be reworked</p>",
        "id": 533119219,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754491510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"721721\">Markus de Medeiros</span> <a href=\"#narrow/channel/490604-iris-lean/topic/iApply.20tactic.20implemented/near/533119039\">said</a>:</p>\n<blockquote>\n<p>Nice. The latter might even solve the former.</p>\n</blockquote>\n<p>That's true!</p>",
        "id": 533119292,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754491532
    },
    {
        "content": "<p>Right, I think even if you have to do <code>iapply (@wp_gen_loc _ _ _ _ _ _ _ (fun _ _ =&gt; True))</code> it solves 99% of the problem! As it stands right now every time I want to apply I lemma I need to explicitly copy out the entire remaining program text to specialize it haha</p>",
        "id": 533119498,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754491598
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"721721\">Markus de Medeiros</span> <a href=\"#narrow/channel/490604-iris-lean/topic/iApply.20tactic.20implemented/near/532796925\">said</a>:</p>\n<blockquote>\n<p>Also, I'm wondering if there's a way to name goals coming from <code>iApply</code>? I'm actually not sure if there's a way to do after the fact this in regular Lean but sometimes we might want to solve the generated goals in a different order.</p>\n</blockquote>\n<p>I've now made it so that you can put a string at the end of a spec pat to name the corresponding subgoal, hope that resolves the issue</p>",
        "id": 533122870,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754492649
    },
    {
        "content": "<p>Ah, I realize now that I can actually get away with not writing out all my implicits  by using the form <br>\n<code>P ∗ (Q -∗ wp e') ⊢ wp e</code> instead of <code>⊢ P -∗ (Q -∗ wp e') -∗ wp e</code> so that the entire right-hand side of the turnstyle matches the entire Iris goal. I still need to manually use <code>refine Entails.trans ?_ (@myLemma  ..)</code> for this instead of <code>iapply</code> due to the first issue above but at least there's a workaround for the second issue!</p>",
        "id": 533156583,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754503902
    },
    {
        "content": "<p>Kudos again for the work so far btw, <code>iapply</code> has definitely saved me some grief!</p>",
        "id": 533178031,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1754513717
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 533261421,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1754561645
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span>\n<span class=\"w\">  </span><span class=\"bp\">∗</span><span class=\"n\">IH</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">emp</span><span class=\"w\"> </span><span class=\"bp\">-∗</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"w\"> </span><span class=\"n\">p2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">∗</span><span class=\"w\"> </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"w\"> </span><span class=\"n\">p2</span><span class=\"w\"> </span><span class=\"n\">Φ</span><span class=\"w\"> </span><span class=\"bp\">-∗</span><span class=\"w\"> </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"w\"> </span><span class=\"n\">p2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">iprop</span><span class=\"o\">(</span><span class=\"n\">Φ</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">∗</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">∗</span><span class=\"n\">HP</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span>\n<span class=\"w\">  </span><span class=\"bp\">∗</span><span class=\"n\">Hwp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cl'</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">cr'</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">Φ</span>\n<span class=\"w\">  </span><span class=\"bp\">∗</span><span class=\"n\">Hemp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">emp</span>\n<span class=\"w\">  </span><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">wp</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cl'</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">cr'</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">iprop</span><span class=\"o\">(</span><span class=\"n\">Φ</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"bp\">∗</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Minor thing: <code>iapply IH</code> doesn't work in this case yet. The two things I think are missing are specialization for empty hypotheses, and instantiation of foralls.</p>",
        "id": 534821955,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1755435234
    },
    {
        "content": "<p>It would also be nice if <code>ispecialize</code> could specialize <code>emp</code> hypotheses, since atm I think you need to manually exit the proofmode and apply <code>refine .trans sep_emp.mpr ?_</code> to specialize it.</p>",
        "id": 534822049,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1755435337
    },
    {
        "content": "<p>Can this PR be merged? I believe the implementation is already quite useful. Subsequent improvements could be made in a new PR.</p>",
        "id": 539447212,
        "sender_full_name": "suhr",
        "timestamp": 1757894766
    },
    {
        "content": "<p>What is currently status of <code>iapply</code>? Seems like it's one \"TODO\" comment for syntax away?</p>",
        "id": 547189105,
        "sender_full_name": "Alex Bai",
        "timestamp": 1761541328
    },
    {
        "content": "<p>In my view <code>iapply</code> is finished, the syntax is mostly the same as it is in the Rocq implementation. It is admittedly a bit clunky to use, but I don't think it's a major issue. If people feel strongly about this and have suggestions for alternative syntax I'd be happy to implement them</p>",
        "id": 547247788,
        "sender_full_name": "Oliver Soeser",
        "timestamp": 1761563042
    },
    {
        "content": "<p>If you want to use iApply right now I'd suggest using the unstable branch</p>",
        "id": 547263481,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1761567825
    },
    {
        "content": "<p>It is completely usable, just in the backlog of things for Mario to review</p>",
        "id": 547263762,
        "sender_full_name": "Markus de Medeiros",
        "timestamp": 1761567920
    }
]