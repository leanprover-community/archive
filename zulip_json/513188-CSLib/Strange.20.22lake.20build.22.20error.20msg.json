[
    {
        "content": "<p>I'm at this branch:<br>\n<a href=\"https://github.com/ctchou/cslib/tree/omega-flatten\">https://github.com/ctchou/cslib/tree/omega-flatten</a><br>\nWhen I do \"lake build\", I got the following error msg.  But I can't find any occurrence of <code>Mathlib.Computability.DFA</code> in the whole repo.  For that matter, I can't find any occurrence of <code>noConfusionType</code>, either.  What is wrong?</p>\n<blockquote>\n<p>âœ– [7267/7268] Building Cslib<br>\ntrace: .&gt; LEAN_PATH=/Users/ctchou/play/cslib/.lake/packages/Cli/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/batteries/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/Qq/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/aesop/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/proofwidgets/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/importGraph/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/LeanSearchClient/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/plausible/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/packages/mathlib/.lake/build/lib/lean:/Users/ctchou/play/cslib/.lake/build/lib/lean /Users/ctchou/.elan/toolchains/leanprover--lean4---v4.24.0-rc1/bin/lean /Users/ctchou/play/cslib/Cslib.lean -o /Users/ctchou/play/cslib/.lake/build/lib/lean/Cslib.olean -i /Users/ctchou/play/cslib/.lake/build/lib/lean/Cslib.ilean -c /Users/ctchou/play/cslib/.lake/build/ir/Cslib.c --setup /Users/ctchou/play/cslib/.lake/build/ir/Cslib.setup.json --json<br>\nerror: Cslib.lean:1:0: import Mathlib.Computability.DFA failed, environment already contains 'DFA.noConfusionType' from Cslib.Computability.Automata.DFA<br>\nerror: Lean exited with code 1<br>\nSome required targets logged failures:</p>\n<ul>\n<li>Cslib<br>\nerror: build failed</li>\n</ul>\n</blockquote>",
        "id": 544660221,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760418249
    },
    {
        "content": "<p>The problem is that you define a type <code>DFA</code>, but Mathlib already does this.</p>",
        "id": 544722111,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760441060
    },
    {
        "content": "<p>See <a class=\"message-link\" href=\"/#narrow/channel/513188-CSLib/topic/namespacing/near/544720537\">#CSLib &gt; namespacing @ ðŸ’¬</a>  :-)</p>",
        "id": 544722135,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760441070
    },
    {
        "content": "<p><code>noConfusionType</code> is a built-in helper type created anytime an inductive type is defined. It's not the clearest or most  actionable error message, sadly.</p>",
        "id": 544722270,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760441107
    },
    {
        "content": "<p>I think the issue may be that when <span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span> added the DFA file to the <code>main</code> branch, he did not add their paths to <code>Cslib.lean</code> and hence the problem was not exposed at that point.  While working on my branch (which is based on <code>main</code>), I did a <code>lake exe mk_all</code> which caused all the missing paths being added to <code>Cslib.lean</code> and the problem to show up.</p>",
        "id": 544805681,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760463404
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span> , does cslib require that all theory files have their paths be included in the top-level <code>Cslib.lean</code>?</p>",
        "id": 544805928,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760463508
    },
    {
        "content": "<p>We don't have a requirement per se yet, but maybe we should? This should've been caught earlier, after all.</p>",
        "id": 544819306,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1760468845
    },
    {
        "content": "<p>I think we should.  Allowing some theory files to not appear in Cslib.lean introduces another level of complexity.</p>",
        "id": 544820737,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760469393
    },
    {
        "content": "<p>If you donâ€™t add those paths I donâ€™t think lake even builds them by default, but even if it does (correct me if I am wrong), you want to make it possible to use a shorter prefix to import a whole folder for example</p>",
        "id": 544830481,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760473205
    },
    {
        "content": "<p>I prefer explicit import, simpler and maintainable.</p>",
        "id": 544832929,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1760474366
    },
    {
        "content": "<p>In our lakefile, we have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[[</span><span class=\"n\">lean_lib</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Cslib\"</span>\n<span class=\"n\">globs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Cslib.*\"</span>\n</code></pre></div>\n<p>which should build everything, right? I believe the intent was to not have the possibility of forgetting a file.</p>",
        "id": 544833203,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760474475
    },
    {
        "content": "<p>Maybe this is not explicit, but I find it better for the \"simpler and maintainable\" aspect. If there are other tradeoffs, please let us know.</p>",
        "id": 544833653,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760474702
    },
    {
        "content": "<p>There is also some automated review of imports (see <a href=\"https://github.com/leanprover/cslib/pull/83\">cslib#83</a> for example) that I think covers this already?</p>",
        "id": 544834132,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760474932
    },
    {
        "content": "<p>If that's true, we have a double assurance that everything is built and explicitly imported.</p>",
        "id": 544834549,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760475148
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"121542\">Alexandre Rademaker</span> <a href=\"#narrow/channel/513188-CSLib/topic/Strange.20.22lake.20build.22.20error.20msg/near/544832929\">said</a>:</p>\n<blockquote>\n<p>I prefer explicit import, simpler and maintainable.</p>\n</blockquote>\n<p>You can achieve that with min_imports after developing a file. During development a large import is simpler.</p>\n<p>I have never used this glob pattern in your lake file before, so maybe it works. Do check if you can cross import one file from another one in a different subfolder.</p>",
        "id": 544836702,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760475948
    },
    {
        "content": "<p>About namespacing, I recall making some effort to get Mathlib Vectors namespaced last year, but this was not considered something necessary for the wider library. This namespacing (and it might bite even more with notation) is a constant headache. I suggest namespacing from the get go.</p>",
        "id": 544836909,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476022
    },
    {
        "content": "<p>Happy to make the PR to all files in an hour. It will touch many files so the sooner we do it the better. I'll start right away.</p>",
        "id": 544837264,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476156
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/513188-CSLib/topic/Strange.20.22lake.20build.22.20error.20msg/near/544837264\">said</a>:</p>\n<blockquote>\n<p>Happy to make the PR to all files in an hour. It will touch many files so the sooner we do it the better. I'll start right away.</p>\n</blockquote>\n<p>This would be appreciated. I think the other thread reached consensus on <code>Cslib</code> as the top namespace.</p>",
        "id": 544838194,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760476533
    },
    {
        "content": "<p>I think this name convention should be uniform. Anyway changing the namespace will be a matter of <code>Ctrl + Shift +F &gt; namespace CSLib</code></p>",
        "id": 544838346,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476583
    },
    {
        "content": "<p>You don't want any confusion between import name and namespace</p>",
        "id": 544838407,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476603
    },
    {
        "content": "<p>Whichever you pick</p>",
        "id": 544838419,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476608
    },
    {
        "content": "<p>(It seems the convention is already Cslib, so we can go with that)</p>",
        "id": 544838529,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760476669
    },
    {
        "content": "<p>Here: <a href=\"https://github.com/leanprover/cslib/pull/105\">https://github.com/leanprover/cslib/pull/105</a></p>",
        "id": 544841955,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478390
    },
    {
        "content": "<p>I just need to fix four tests</p>",
        "id": 544841969,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478396
    },
    {
        "content": "<p>All four of them are guard_msgs which are erroring on the different namespaces which honestly makes no sense to me</p>",
        "id": 544842039,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478434
    },
    {
        "content": "<p>A couple of issues:</p>\n<ol>\n<li>There seems to be a strange mix of sections and namespaces in the Automaton folder. I am only standardising linebreaks here.</li>\n<li>I am establishing a convention that the top namespace declaration is one line after the module docstring and that there is always a linebreak between namespace related lines. It appears that things have been haphazard so far.</li>\n<li>I am using a different namespace CslibTests for the tests folder.</li>\n</ol>",
        "id": 544842244,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478524
    },
    {
        "content": "<p>I also think there ought to be scoped notation instead of notation. This saves a lot of headaches later. Happy to do a separate PR for that</p>",
        "id": 544842649,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478741
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span>  and <span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span> : can I comment out the four guard messages for now?</p>",
        "id": 544842834,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760478847
    },
    {
        "content": "<p>I think I know about those tests, let me check first</p>",
        "id": 544843929,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760479332
    },
    {
        "content": "<p>It's not just tests, the build is failing in </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Cslib</span><span class=\"bp\">.</span><span class=\"n\">Languages</span><span class=\"bp\">.</span><span class=\"n\">LambdaCalculus</span><span class=\"bp\">.</span><span class=\"n\">LocallyNameless</span><span class=\"bp\">.</span><span class=\"n\">Fsub</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Cslib</span><span class=\"bp\">.</span><span class=\"n\">Logics</span><span class=\"bp\">.</span><span class=\"n\">LinearLogic</span><span class=\"bp\">.</span><span class=\"n\">CLL</span><span class=\"bp\">.</span><span class=\"n\">PhaseSemantics</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Cslib</span><span class=\"bp\">.</span><span class=\"n\">Languages</span><span class=\"bp\">.</span><span class=\"n\">LambdaCalculus</span><span class=\"bp\">.</span><span class=\"n\">LocallyNameless</span><span class=\"bp\">.</span><span class=\"n\">Stlc</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n</code></pre></div>",
        "id": 544844031,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760479371
    },
    {
        "content": "<p>Will check</p>",
        "id": 544844084,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479387
    },
    {
        "content": "<p>Right. I missed a whole subfolder there</p>",
        "id": 544844149,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479419
    },
    {
        "content": "<p>Now it should build</p>",
        "id": 544844642,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479621
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/513188-CSLib/topic/Strange.20.22lake.20build.22.20error.20msg/near/544842039\">said</a>:</p>\n<blockquote>\n<p>All four of them are guard_msgs which are erroring on the different namespaces which honestly makes no sense to me</p>\n</blockquote>\n<p>This is intentional, it is a test to ensure some metaprogramming is respecting namespaces. We can remove the non-namespaced test now. I can do this and push to the PR.</p>",
        "id": 544844705,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760479645
    },
    {
        "content": "<p>okay</p>",
        "id": 544844840,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479695
    },
    {
        "content": "<p>Also, fixed the whole FSub and Stlc folder</p>",
        "id": 544844879,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479708
    },
    {
        "content": "<p>Need CI approval</p>",
        "id": 544844899,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479717
    },
    {
        "content": "<p>Now only the namespace tests fill fail hopefully</p>",
        "id": 544845023,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479773
    },
    {
        "content": "<p>More errors. Will fix. Isn't there a git commit hook for this before I push?</p>",
        "id": 544845294,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760479923
    },
    {
        "content": "<p>I typically run <code>lake build</code>? :-)</p>",
        "id": 544845663,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760480075
    },
    {
        "content": "<p><code>lake build</code> passes now</p>",
        "id": 544846062,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480302
    },
    {
        "content": "<p>If you have a push hook then this is automatic and the push fails if the build fails</p>",
        "id": 544846105,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480321
    },
    {
        "content": "<p>I'll probably need permission to run CI again.</p>",
        "id": 544846131,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480334
    },
    {
        "content": "<p>CI passes</p>",
        "id": 544846439,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480529
    },
    {
        "content": "<p>You might want to have subfolder specific namespaces too. A lot of notation is wildly reused in CS, so it would be beneficial to scope the notation to the subfolder namespaces. But that's for subsequent PRs</p>",
        "id": 544846532,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480586
    },
    {
        "content": "<p>Some of the notation (and grind annotations) are scoped this way, but yes more could do this.</p>",
        "id": 544846655,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760480676
    },
    {
        "content": "<p>Also I suggest merging this PR asap since it touches every file and each PR pending in the queue will be affected by the resulting merge conflicts. The longer we wait, the more PRs are created and thus get affected. Conversely each merged PR gives merge conflicts for this one.</p>",
        "id": 544846740,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760480733
    },
    {
        "content": "<p>Sure, I'll ping tomorrow if it's still pending.</p>",
        "id": 544847130,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760480986
    },
    {
        "content": "<p>Needs one more CI run (permission). I localised a couple of mathlib namespace opens</p>",
        "id": 544847594,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760481290
    },
    {
        "content": "<p>Merged!<br>\nThank you all for discussing and fixing this, all while I was sleeping. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 544878473,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1760505438
    },
    {
        "content": "<p>I just noticed that Cslib/Languages/CombinatoryLogic/Evaluation.lean was added to the \"main\" branch as part of <a href=\"https://github.com/leanprover/cslib/pull/57\">cslib#57</a> without being also added to Cslib.lean.  I have made a PR (<a href=\"https://github.com/leanprover/cslib/pull/114\">cslib#114</a>) to fix it.  CC: <span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span></p>",
        "id": 546092786,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760993247
    },
    {
        "content": "<p>Perhaps we should have some automatic check to enforce this?</p>",
        "id": 546092960,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760993301
    },
    {
        "content": "<p>I think there is an action that will flag this, it just never ran for that PR because it was opened over a month ago. If you see another case of this not caught, ping me and I'll address it.</p>",
        "id": 546094936,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760993947
    },
    {
        "content": "<p>merged, thx :)</p>",
        "id": 546654359,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1761218909
    }
]