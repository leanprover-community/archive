[
    {
        "content": "<p>I have an instance of a class which needs an assumption:<br>\n<a href=\"https://github.com/ctchou/cslib/blob/5279f4467d8e89f01625809d131b8a5a56784034/Cslib/Computability/Automata/NA/Loop.lean#L182\">https://github.com/ctchou/cslib/blob/5279f4467d8e89f01625809d131b8a5a56784034/Cslib/Computability/Automata/NA/Loop.lean#L182</a><br>\nIs it possible to use an anonymous instance here?  I've tried it but it doesn't seem to work.  First, instance inference fails.  Then I added an explicit proof of the instance in a context where the assumption holds:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">na</span><span class=\"bp\">.</span><span class=\"n\">finLoop</span><span class=\"bp\">.</span><span class=\"n\">Total</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n</code></pre></div>\n<p>Now instance inference works, but <code>lake lint</code> complains:</p>\n<blockquote>\n<p>/- The <code>impossibleInstance</code> linter reports:<br>\nSOME INSTANCES HAVE ARGUMENTS THAT ARE IMPOSSIBLE TO INFER<br>\nThese are arguments that are not instance-implicit and do not appear in<br>\nanother instance-implicit argument or the return type. -/<br>\n-- Cslib.Computability.Automata.NA.Loop<br>\n/Users/ctchou/play/cslib-2/Cslib/Computability/Automata/NA/Loop.lean:181:1: error: @Cslib.Automata.NA.FinAcc.instTotalSumUnitFinLoopOfExistsMemSetStart argument 4 h : ∃<br>\n  s0, s0 ∈ na.start</p>\n</blockquote>\n<p>What is the best practice here?</p>",
        "id": 567013380,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1767899227
    },
    {
        "content": "<p>Have you seen the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fact#doc\">docs#Fact</a> class in Mathlib? This is a technique for injecting hypotheses into the typeclass system. It's intended for local instances (<em>sometimes</em> there's a case for a global instance, but these should be treated with suspicion).</p>\n<p>A variant is to make a custom typeclass for just this hypothesis. This is often nicer since it doesn't require thinking about a global/general design.</p>\n<p>In particular, it looks like your conditional instance is about whether <code>na.start</code> is nonempty. Any reason not to use the <code>Nonempty</code> class?</p>",
        "id": 567023305,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1767902752
    },
    {
        "content": "<p>Can you confirm that is the correct commit that triggers the linter? I tried checking out that commit and was not able to reproduce.</p>",
        "id": 567027844,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767904403
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span>  The commit I gave does not have the lint error, which is triggered if you make the instance anonymous.<br>\n<span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>  I'll look into what you wrote and get back to you.</p>",
        "id": 567029921,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1767905151
    },
    {
        "content": "<p>I decided to use the <code>Fact</code> mechanism:<br>\n<a href=\"https://github.com/ctchou/cslib/blob/1a6d35afec5a09d0d526ac10f6ac97b8be28ecce/Cslib/Computability/Automata/NA/Loop.lean#L182\">https://github.com/ctchou/cslib/blob/1a6d35afec5a09d0d526ac10f6ac97b8be28ecce/Cslib/Computability/Automata/NA/Loop.lean#L182</a><br>\nSee also lines 196-199 of the same file.  <code>LTS.Total.mTr_ωTr</code> on line 199 is where the <code>Fact</code> from line 196 is used.</p>",
        "id": 567038628,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1767908830
    },
    {
        "content": "<p>Just to unify with the conversation on GitHub, note this is in <a href=\"https://github.com/leanprover/cslib/pull/241\">cslib#241</a> where I had left a comment.</p>",
        "id": 567041142,
        "sender_full_name": "Chris Henson",
        "timestamp": 1767909991
    },
    {
        "content": "<p>Just an update to make this thread self-contained: <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> and <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> pointed out that the <code>Set.Nonempty</code> assumption I need to make can be converted to an <code>Nonempty</code> assumption and hence can be handled by the instance inference mechanism itself.  See <a href=\"https://github.com/leanprover/cslib/pull/241\">cslib#241</a> for details.</p>",
        "id": 567065446,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1767927564
    }
]