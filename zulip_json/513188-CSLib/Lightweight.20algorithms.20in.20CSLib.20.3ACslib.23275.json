[
    {
        "content": "<p>Hi all, <br>\nAfter chasing some paper deadlines, I am back to finishing <a href=\"https://github.com/leanprover/cslib/pull/275\">cslib#275</a>. I am pruning the current code and reorganizing it so that we can review, merge, and use it soon. Concretely the PR will contain:</p>\n<ol>\n<li>The Free Monad based query model</li>\n<li>A standard query type for the Word RAM model</li>\n<li>Example algorithms : OrderedInsert for lists, InsertionSort for lists, and MergeSort.</li>\n</ol>",
        "id": 574319854,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771342289
    },
    {
        "content": "<p>I need some help getting this PR done, and there is room for contributions.</p>",
        "id": 574319897,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771342304
    },
    {
        "content": "<p>I need help on two issues:</p>\n<ol>\n<li>Help with aesop/grind annotations to simplify a bunch of proofs that consist of <code>simp_all[&lt;Monad or Free monad theorems&gt;]</code></li>\n<li>Help fixing a merge conflict that arises from a re-organisation</li>\n</ol>",
        "id": 574320118,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771342356
    },
    {
        "content": "<ol start=\"3\">\n<li>If you can finish some of the complexity proofs, that is also great.</li>\n</ol>",
        "id": 574320533,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771342448
    },
    {
        "content": "<p>Contributions can be made by PR to my PR branch. I prefer many smaller PRs to one large PR.</p>",
        "id": 574320597,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771342461
    },
    {
        "content": "<p>The current status:</p>\n<ol>\n<li>I now require Cost types to be <code>AddCommSemigroup</code>s</li>\n</ol>",
        "id": 574329233,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771344639
    },
    {
        "content": "<ol start=\"2\">\n<li>the ordered insert example requires completion of proofs</li>\n<li>the merge part of mergeSort is mostly done. The proofs for mergesort remain</li>\n</ol>\n<p>I also plan to reject unfiltered and unprocessed AI slop PRs . If you submit a proof, please be sure you can explain what's happening and please produce a readable and concise proofs. In that case and that case alone, I am open to AI use. In other words, controlled AI use is fine, especially for proofs. Uncontrolled use is not. If AI generates a big proof, try to factor it into smaller more abstract lemmas.</p>",
        "id": 574329706,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771344742
    },
    {
        "content": "<p>actually never mind insertion sort. I am done with that. Only mergeSort remains.</p>",
        "id": 574410026,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771374915
    },
    {
        "content": "<p>So, I opened two PRs, but you commited yourself later a result I PRed. I think however that the time complexity for merge should be <code>xs.length + ys.length - 1</code> instead of your proposal as there are no comparisions when both are empty.</p>",
        "id": 574450889,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1771403309
    },
    {
        "content": "<p>I’m seeking help to get this done fast. But the idea is if I finish something, I’m taking that</p>",
        "id": 574469474,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409102
    },
    {
        "content": "<p>We are not only counting comparisons</p>",
        "id": 574469546,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409128
    },
    {
        "content": "<p>We are also counting pure operations.</p>",
        "id": 574469585,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409142
    },
    {
        "content": "<p>Also, fwiw I don’t see your PRs</p>",
        "id": 574469736,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409192
    },
    {
        "content": "<p>I think I’ll finish merge sort today if nobody else does.</p>",
        "id": 574469800,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409214
    },
    {
        "content": "<p><a href=\"https://github.com/Shreyas4991/cslib/pull/2\">https://github.com/Shreyas4991/cslib/pull/2</a></p>",
        "id": 574470092,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1771409305
    },
    {
        "content": "<p>Why are you changing ListOrderedInsert</p>",
        "id": 574470298,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409360
    },
    {
        "content": "<p>I am done with that</p>",
        "id": 574470321,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409365
    },
    {
        "content": "<p>I wrote that yesterday</p>",
        "id": 574470433,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1771409403
    },
    {
        "content": "<p>I do like the brevity of some of your proofs</p>",
        "id": 574470556,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409444
    },
    {
        "content": "<p>But you only get them by changing purecost to 0</p>",
        "id": 574470671,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409486
    },
    {
        "content": "<p>I tried that. By I absolutely want to penalise pureCost by default</p>",
        "id": 574470748,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409510
    },
    {
        "content": "<p>That’s what makes many of these proofs tedious, but I am making a point that pure operations cannot sneak by</p>",
        "id": 574470862,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409550
    },
    {
        "content": "<p>The hbind pattern you see in my proof is repetitive</p>",
        "id": 574471235,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409674
    },
    {
        "content": "<p>So that’s going to become a lemma</p>",
        "id": 574471271,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409684
    },
    {
        "content": "<p>I consider it a plus of my approach that we spotted how badly the proofs behave when there is a nonzero purecost (which technically breaks monadic laws as far as Prog.time goes ). So now we know what extra API we need</p>",
        "id": 574471579,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409773
    },
    {
        "content": "<p>I don't really get how operations are counted in your model then. The return operation seems to count, but removing the head of the list does not count.</p>",
        "id": 574471688,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1771409811
    },
    {
        "content": "<p>It can’t count what goes on between monadic operations ofc. That limitation never goes away in any lightweight DSL</p>",
        "id": 574472128,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771409962
    },
    {
        "content": "<p>My point is, somewhere along the way, you have to return the result.</p>",
        "id": 574472249,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410006
    },
    {
        "content": "<p>And we can count (or more accurately record) these returns. We could also log them in-principle.</p>",
        "id": 574472338,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410043
    },
    {
        "content": "<p>SortOpsCosts.pure could easily just be a log of what is returned at any point.</p>",
        "id": 574472444,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410076
    },
    {
        "content": "<p>pureCost allows a sanity check.</p>",
        "id": 574472570,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410120
    },
    {
        "content": "<p>I don’t mind scoped instances to keep purecost 0 for mergeSort. It’s more monadic and the three Prog.time lemmas kick in with grind and simp easily.</p>",
        "id": 574472729,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410175
    },
    {
        "content": "<p>But I would not have discovered that we need additional API lemmas if I hadn’t set them to non zero values</p>",
        "id": 574472937,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771410235
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574329233\">said</a>:</p>\n<blockquote>\n<p>The current status:</p>\n<ol>\n<li>I now require Cost types to be <code>AddCommSemigroup</code>s</li>\n</ol>\n</blockquote>\n<p>What cost does pure have without a zero?</p>",
        "id": 574676466,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771491510
    },
    {
        "content": "<p>This PR also seems to have made a bad merge somewhere along the way and accidentally reverted a bunch of unrelated changes. I don't think it is a good use of time to review or improve this PR until you yourself have ensured that the diff contains nothing more than you intended.</p>",
        "id": 574677422,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771491800
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574676466\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"466334\">Shreyas Srinivas</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574329233\">said</a>:</p>\n<blockquote>\n<p>The current status:</p>\n<ol>\n<li>I now require Cost types to be <code>AddCommSemigroup</code>s</li>\n</ol>\n</blockquote>\n<p>What cost does pure have without a zero?</p>\n</blockquote>\n<p>1 for basic number types by default. A slightly more sophisticated example is in ListOrderedInsert, where I explicitly count <code>pure</code>s separately. In principle, this can be a logging type for pure operations</p>",
        "id": 574693101,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771496793
    },
    {
        "content": "<p>Or even ListLinearSearch</p>",
        "id": 574693322,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771496850
    },
    {
        "content": "<p>I'll first clean this PR up of every change that is not explicitly a part of it.</p>",
        "id": 574693576,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771496916
    },
    {
        "content": "<p>I explicitly avoid <code>AddCommMonoid</code> because I want to allow non-zero pure costs as in the examples above.</p>",
        "id": 574693773,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771496969
    },
    {
        "content": "<p>Where a zero is needed, we can always use an <code>AddCommMonoid</code> instance</p>",
        "id": 574694490,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771497184
    },
    {
        "content": "<p>Assigning a non-zero cost to pure makes your monad not lawful, right?</p>",
        "id": 574777033,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771520149
    },
    {
        "content": "<p>For timing yes</p>",
        "id": 574777340,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771520230
    },
    {
        "content": "<p>For evaluation, it’s still lawful</p>",
        "id": 574777458,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771520256
    },
    {
        "content": "<p>I am open to the possibility of switching to 0 purecost by default while allowing nonzero costs when users wants it. But this means we still keep AddCommSemigroup.</p>",
        "id": 574777709,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771520331
    },
    {
        "content": "<p>I'm making the claim that no user should ever want a non-zero cost for pure, since the point in oracle computations is that only calling the oracle has a cost.</p>",
        "id": 574798891,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771526494
    },
    {
        "content": "<p>my claim is that it’s beneficial to log pure operations or some function on them</p>",
        "id": 574801482,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771527305
    },
    {
        "content": "<p>It’s a safeguard.</p>",
        "id": 574801512,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771527313
    },
    {
        "content": "<p>It violates monad rules for time, but it gets us this ability to catch bad uses of pure.</p>",
        "id": 574801686,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771527366
    },
    {
        "content": "<p>Not really, since you can replace <code>pure (pureFunc x)</code> with <code>irrelevantOracleCall &gt;&gt;= fun _ =&gt; pureFunc x</code> if the cost of <code>irrelevantOracleCall</code> is less than <code>pureCost</code></p>",
        "id": 574805054,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771528556
    },
    {
        "content": "<p>It would have to be <code>irrelevantOracleCall &gt;&gt;= fun _ =&gt; pure (pureFunc x)</code> to be type correct wouldn’t it?</p>",
        "id": 574811443,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771530834
    },
    {
        "content": "<p>The return type  of the function on the  rhs of &gt;&gt;= has to be a monad.</p>",
        "id": 574811730,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771530944
    },
    {
        "content": "<p>Okay I’ll do one thing. I’ll set purecost to zero by default. I’ll leave insertionSort with its non-zero pure costs untouched for now, since they already work and serve as a good example.</p>",
        "id": 574826423,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771536989
    },
    {
        "content": "<p>And I’ll also fix the PR mess.</p>",
        "id": 574826440,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771537000
    },
    {
        "content": "<p>I want to get this merged asap. I am also including a canonical parametric word ram model. That’ll be like the final boss model. If someone is keen to show an implementable version on this model they can use reduceProg</p>",
        "id": 574826659,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771537089
    },
    {
        "content": "<p>Most algorithms folks will be content with not going that far</p>",
        "id": 574826704,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771537110
    },
    {
        "content": "<p>I don't think adding more things to a contentious PR is an effective strategy for getting it merged ASAP</p>",
        "id": 574826811,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771537162
    },
    {
        "content": "<p>Okay I’ll get to that later</p>",
        "id": 574827365,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771537393
    },
    {
        "content": "<p>The PR is complete</p>",
        "id": 574874342,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771568955
    },
    {
        "content": "<p>and ready for review.</p>",
        "id": 574874348,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771568961
    },
    {
        "content": "<p>I have removed all mentions of pureCost for now. The main content is in the folder Cslib.AlgorithmsTheory. The old time monad is in a subfolder called Lean (as before)</p>",
        "id": 574874406,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771568999
    },
    {
        "content": "<p>There are 4 complete examples:</p>\n<ol>\n<li>Linear search in lists with the <code>ListSearch</code> query type.</li>\n<li>Ordered Insertion in Lists using <code>SortOps</code>. This is used later in <code>insertionSort</code></li>\n<li>Insertion Sort in Lists using <code>SortOps</code></li>\n<li>Merge Sort in Lists using <code>SortOps</code>.</li>\n</ol>\n<p>Other examples of queries and programs can be found in CslibTests. These are meant to be illustrative examples.</p>",
        "id": 574874444,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771569029
    },
    {
        "content": "<p>The CI seems to be taking its time here : <a href=\"https://github.com/leanprover/cslib/actions/runs/22213745658/job/64253121530?pr=275\">https://github.com/leanprover/cslib/actions/runs/22213745658/job/64253121530?pr=275</a></p>",
        "id": 574874505,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771569071
    },
    {
        "content": "<p>The CI is stuck here for 5 minutes now. CSLib linters have already approved this PR. This seems to be a different set of linters:<br>\n<a href=\"/user_uploads/3121/wxvv9_E-yk699E6fPfL3C-sl/Screenshot-from-2026-02-20-07-32-38.png\">Screenshot from 2026-02-20 07-32-38.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/wxvv9_E-yk699E6fPfL3C-sl/Screenshot-from-2026-02-20-07-32-38.png\" title=\"Screenshot from 2026-02-20 07-32-38.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2946x1741\" src=\"/user_uploads/thumbnail/3121/wxvv9_E-yk699E6fPfL3C-sl/Screenshot-from-2026-02-20-07-32-38.png/840x560.webp\"></a></div>",
        "id": 574874681,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771569205
    },
    {
        "content": "<p>I don't know what's taking so long at file 32/119 in batteries</p>",
        "id": 574874850,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771569341
    },
    {
        "content": "<h2>Update</h2>\n<p>I have addressed all code-quality review comments. There are a couple of opinion-based design choices that have been brought up in the review. I'd like to keep <code>Prog</code> self-contained and I think trying to generalize <code>TimeM</code> to <code>CostM</code> and reducing <code>Prog</code> to <code>CostM</code> is not a good idea for three reasons:</p>\n<ol>\n<li>Changes to <code>TimeM</code> are not in scope for this PR. </li>\n<li>Even with this change <code>Prog</code>'s models are more general than <code>TimeM</code>, see the example models of lists equipped with <code>find</code> when <code>find</code> is implemented respectively by <a href=\"https://github.com/leanprover/cslib/pull/275/changes#diff-5d4b8fab242780632c05f296143988c4d0cd9aba0948ee80f0320325ab1416a6R31\">linear search</a> and <a href=\"https://github.com/leanprover/cslib/pull/275/changes#diff-5d4b8fab242780632c05f296143988c4d0cd9aba0948ee80f0320325ab1416a6R41\">binary search</a>. Their complexity can depend on input size. Later we can reduce them to smaller models by reductions if someone likes that, but that's not strictly necessary. There is no option for this in either <code>TimeM</code> or the hypothetical <code>CostM</code>.  This is a highlight of the query model in that I can encode complex queries whose cost is dependent on input size. It allows me to reason about algorithms using opaque queries to flow or cut algorithms in graphs for example and just substitute their known complexities.  </li>\n<li>Even if point 2 could be addressed, it would be a needless layer of indirection between Prog and its models, that adds nothing meaningful to <code>Prog</code>.</li>\n</ol>",
        "id": 574947211,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771596124
    },
    {
        "content": "<h2>About CI</h2>\n<p>It seems CI runs of preceding commits are not cancelled when a new commit lands in a PR. See example below <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span>  :<br>\n<a href=\"/user_uploads/3121/PbX2luJF_xawp_ek_xwk_DbT/Screenshot-from-2026-02-20-14-56-17.png\">Screenshot from 2026-02-20 14-56-17.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/PbX2luJF_xawp_ek_xwk_DbT/Screenshot-from-2026-02-20-14-56-17.png\" title=\"Screenshot from 2026-02-20 14-56-17.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2946x1741\" src=\"/user_uploads/thumbnail/3121/PbX2luJF_xawp_ek_xwk_DbT/Screenshot-from-2026-02-20-14-56-17.png/840x560.webp\"></a></div>",
        "id": 574947623,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771596222
    },
    {
        "content": "<p>I only see downsides in linking <code>Prog</code> to <code>TimeM</code> or  its renamed version <code>CostM</code>.</p>",
        "id": 574949048,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771596606
    },
    {
        "content": "<p>I personally vote for keeping <code>Prog</code> self-contained as it is already.</p>",
        "id": 574950148,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771596877
    },
    {
        "content": "<p>For CI, we haven't set <code>cancel-in-progress</code>, but we can easily do so. The action for the text based linters is just slow to build, it's been on my todo list.</p>\n<p>I'd like to emphasize that this is not my area of expertise, and I will mostly defer to <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  and others who are more knowledgeable. It seems there are some ongoing discussions in the review.</p>\n<p>That said, this seems to be something different from what we have previously discussed. Previously it seemed to me that you were suggesting that this would directly generalize and subsume <code>TimeM</code>, and I suggested scoping the PR to this change to cleanly show this. It has since grown to almost 1500 LoC, and proofs about merge sort are duplicated in this new framework. I personally might have opened a PR like this with just merge sort since this is all <code>TimeM</code> has. It also seems like this file (<code>Cslib/AlgorithmsTheory/Lean/MergeSort/MergeSort.lean</code>) is quite a bit longer than the <code>TimeM</code> equivalent.</p>\n<p>I think it would be helpful to have a <em>succinct</em> description of exactly how these are meant to interact.</p>",
        "id": 574958277,
        "sender_full_name": "Chris Henson",
        "timestamp": 1771598889
    },
    {
        "content": "<p>They are not meant to interact. Prog makes no use of TimeM</p>",
        "id": 574958528,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771598957
    },
    {
        "content": "<p>The mergeSort file is longer because I follow a proof style based on refinement. I take my programs and show that they are equivalent to functional-programming style lean versions, as far as correctness goes. For example <code>merge</code> and <code>mergeNaive</code> act on their inputs identically</p>",
        "id": 574958721,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599011
    },
    {
        "content": "<p>I am emphasising this style over a seemingly simpler approach because I think</p>\n<ol>\n<li>\n<p>it’s a healthy separation of concerns. Proofs of correctness of merge and mergeSort directly follow from their “naive” counterparts. </p>\n</li>\n<li>\n<p>It emphasises the utility of proving correctness of functional versions of algorithms. If we already had the correctness proofs for mergeSort in pure lean code, all we’d need is to show their equivalence to the Prog version. I have been emphasising the need for correctness theorems for pure lean code algorithms for some time now. I hope this spurs the initiative now.</p>\n</li>\n</ol>",
        "id": 574959275,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599139
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"687698\">Chris Henson</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574958277\">said</a>:</p>\n<blockquote>\n<p>That said, this seems to be something different from what we have previously discussed. Previously it seemed to me that you were suggesting that this would directly generalize and subsume <code>TimeM</code></p>\n</blockquote>\n<p>Currently it does exactly that. In fact I prefer to keep it independent on TimeM, since it strictly supersedes it anyway.</p>",
        "id": 574959559,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599210
    },
    {
        "content": "<p>You can entirely delete  <code>TimeM</code> and this PR would be perfectly fine.</p>",
        "id": 574959765,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599264
    },
    {
        "content": "<p>I just haven't done this because it is not my code. I leave it to you all to decide what happens to that code first.</p>",
        "id": 574960243,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599370
    },
    {
        "content": "<p>The 1500 lines of code come from several sources:</p>\n<ol>\n<li>I provide a number of examples of query types and Progs in the CslibTests folder to teach this model</li>\n<li>I have 3 additional  fully worked out algorithms.</li>\n<li>There is some code in specifying custom models, espcecially cost models.</li>\n</ol>",
        "id": 574960556,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599446
    },
    {
        "content": "<p>I hope that clarifies everything <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span></p>",
        "id": 574961141,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599575
    },
    {
        "content": "<p>I believe this model is sufficiently new to justify illustrating it with more than one example. We want these algorithms anyway.</p>",
        "id": 574962185,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771599807
    },
    {
        "content": "<p>I am of the belief that we should not be avoiding TimeM; we should be lifting into it with FreeM.liftM in order to compute outputs and costs simultaneously.</p>",
        "id": 574963614,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600136
    },
    {
        "content": "<p>As I have argued before, TimeM is not general enough and is pointless indirection.</p>",
        "id": 574963770,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600169
    },
    {
        "content": "<p>And it leaves us with two different lightweight methods of formalizing algorithms</p>",
        "id": 574963827,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600185
    },
    {
        "content": "<p>Then let's first generalize TimeM, which is probably a 50 line diff</p>",
        "id": 574964064,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600243
    },
    {
        "content": "<p>From an algorithms theory perspective, I want to retain the flexibility to say \"I am making calls to this opaque procedures with such and such inputs of such and such size\". Like \"make cut queries on this subgraph of this size\", or \"compute max flows in this subgraph\"</p>",
        "id": 574964089,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600249
    },
    {
        "content": "<p>Even your generalized TimeM won't meet that. And I still maintain that this indirection is bad.</p>",
        "id": 574964195,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600269
    },
    {
        "content": "<p>Why is the indirection worse than duplicating the logic of FreeM.liftM and TimeM inside your Prog code?</p>",
        "id": 574964439,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600325
    },
    {
        "content": "<p>I don't understand your question mark</p>",
        "id": 574964546,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600353
    },
    {
        "content": "<p>The message seems irrelevant to the point; you get what it asks for with Prog whether or not we use TimeM as an intermediary.</p>",
        "id": 574964721,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600399
    },
    {
        "content": "<p>I want time complexity to depend on input size to the query. I don't see how to make that happen in TimeM. The model is designed to increment its cost by a constant amount.</p>",
        "id": 574964727,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600400
    },
    {
        "content": "<p>And the way I see it, Prog is currently completely self-contained. It sits on top of FreeM.</p>",
        "id": 574964935,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600454
    },
    {
        "content": "<p>Non-constant amounts work just fine with TimeM. It will be easy to show you with an example once we generalize TimeM to AddCommMonoid, and the diff will be smaller than this conversation</p>",
        "id": 574965161,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600508
    },
    {
        "content": "<p>(which to be very clear, I'm advocating we do in a separate PR, first)</p>",
        "id": 574965375,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600566
    },
    {
        "content": "<p>Well, I don't know how to make it work. I spent a lot of time figuring out the exact type signature of queries and <code>evalQuery</code> and <code>cost</code></p>",
        "id": 574965472,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600597
    },
    {
        "content": "<p>If it turns out you're right after all and TimeM is an annoyance we can always delete it later after generalizing</p>",
        "id": 574965486,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600601
    },
    {
        "content": "<p>Sounds complicated <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 574965566,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600622
    },
    {
        "content": "<p>We have a fully working solution now that .... works well.</p>",
        "id": 574965608,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600636
    },
    {
        "content": "<p>\"I have already written my code and I like it\" is not a particularly compelling defense in isolation</p>",
        "id": 574965727,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771600677
    },
    {
        "content": "<p>I am not a fan of the TimeM approach because it allows arbitrary annotations in the first place.</p>",
        "id": 574965835,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600705
    },
    {
        "content": "<p>That's a huge issue that I am trying to mitigate here. Relying on TimeM also means keeping the ability to write code with ticks (pun intended).</p>",
        "id": 574965942,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600733
    },
    {
        "content": "<p>I have already covered the mergeSort example that TimeM has. At this point my PR is a strict super set of TimeM, even in terms of algorithms we have in the repository.  Whatever decision we reach w.r.t TimeM, we make it harder by introducing unnecessary downstream dependencies.</p>",
        "id": 574966719,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771600944
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574965727\">said</a>:</p>\n<blockquote>\n<p>\"I have already written my code and I like it\" is not a particularly compelling defense in isolation</p>\n</blockquote>\n<p>This is about not introducing unnecessary dependencies. Especially having a more general concept depend on a less general one.</p>",
        "id": 574967144,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771601049
    },
    {
        "content": "<p>If anything, TimeM should be refactored as a special case of Prog, with the mergeSort example implemented in it...which I have already done (i.e. implemented mergeSort).</p>",
        "id": 574968081,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771601298
    },
    {
        "content": "<p>At least, I don't see any reason to take a perfectly functional approach <code>Prog</code> and bend it backwards just because we want to use an existing piece of code, which is clearly not necessary for <code>Prog</code>. It's a pointless dependency and therefore bad design.</p>",
        "id": 574969120,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771601587
    },
    {
        "content": "<p>If someone wants to pursue this complication and potential revert, please do so and  feel free to refactor this PR. I'd like to preserve the current state somehow (EDIT : <a href=\"https://github.com/Shreyas4991/cslib/tree/query-complexity-model-ideal-state\">done</a> ). As far as I am concerned, it has reached a point of Pareto-optimality in design for its purposes with just the right amount of simplicity, generality, and underlying dependencies. It has kept its promise of being a strict superset of <code>TimeM</code> without depending on it, and allowing things <code>TimeM</code> doesn’t.</p>",
        "id": 574970214,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771601865
    },
    {
        "content": "<p>If we create a dependency on TimeM, we will continue to get PRs <a href=\"https://github.com/leanprover/cslib/pull/343/changes\">on top of it</a>. This is an unnecessary doubling of effort.</p>",
        "id": 574973060,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771602486
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/513188-CSLib/topic/Lightweight.20algorithms.20in.20CSLib.20.3ACslib.23275/near/574965161\">said</a>:</p>\n<blockquote>\n<p>Non-constant amounts work just fine with TimeM. It will be easy to show you with an example once we generalize TimeM to AddCommMonoid, and the diff will be smaller than this conversation</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover/cslib/pull/357\">https://github.com/leanprover/cslib/pull/357</a> does the generalization</p>",
        "id": 574974161,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771602742
    },
    {
        "content": "<p>Refactoring <a href=\"https://github.com/leanprover/cslib/pull/275\">cslib#275</a> might prove a headache. I still don't see why we need to go through another Monad.</p>",
        "id": 574974986,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771602994
    },
    {
        "content": "<p>I think it will be trivial and the refactor will make the code shorter</p>",
        "id": 574975084,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771603023
    },
    {
        "content": "<p>Also this directly contradicts my guarantee that TimeM is strictly superseded</p>",
        "id": 574975137,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603040
    },
    {
        "content": "<p>Because <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> at one point wanted to fix on default model for lightweight algorithms</p>",
        "id": 574975196,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603054
    },
    {
        "content": "<p>Now we are going to end up with two.</p>",
        "id": 574975232,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603063
    },
    {
        "content": "<p>The total number of models after <a href=\"https://github.com/leanprover-community/CSLib/pull/357\">CSLib#357</a> is still one.</p>",
        "id": 574975291,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771603079
    },
    {
        "content": "<p>That's because there <code>Prog</code> hasn't been merged</p>",
        "id": 574975366,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603100
    },
    {
        "content": "<p>The tick model is still a more loose model and it will now exist side-by-side with <code>Prog</code> once that is merged. So people will be duplicating work in two models.</p>",
        "id": 574975459,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603130
    },
    {
        "content": "<p>anyway, I am not doing this refactor. I hope the test models in CslibTests/QueryModel work. I included them explicitly as an example of how the same query type can have two different models with two different costs for the same operation.</p>",
        "id": 574975593,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603166
    },
    {
        "content": "<p>My preferred solution is to delete <code>TimeM</code> and stick with<code>Prog</code> (or maybe delete <code>Prog</code> and stick with <code>TimeM</code>, naturally I am biased towards my approach, albeit with sound reasons).</p>",
        "id": 574975779,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603212
    },
    {
        "content": "<p>Two lightweight models = either</p>\n<ol>\n<li>Duplication of algorithms, or</li>\n<li>People pick the easier one, at the cost  of formalization quality/usability in algorithms code.</li>\n</ol>",
        "id": 574976109,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603306
    },
    {
        "content": "<p>Fwiw I made a separate frozen branch called <code>query-complexity-model-ideal-state</code> to preserve what I did : <a href=\"https://github.com/Shreyas4991/cslib/tree/query-complexity-model-ideal-state\">https://github.com/Shreyas4991/cslib/tree/query-complexity-model-ideal-state</a></p>",
        "id": 574977078,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771603545
    },
    {
        "content": "<p>(link to Eric's PR is <a href=\"https://github.com/leanprover/cslib/pull/357\">cslib#357</a>)</p>",
        "id": 574980456,
        "sender_full_name": "Chris Henson",
        "timestamp": 1771604492
    },
    {
        "content": "<p>I can see optimizations in the time complexity side of <a href=\"https://github.com/leanprover/cslib/pull/275\">cslib#275</a> if your PR goes through, because we may not need all those FreeM composition lemmas (or maybe we need lifting lemmas for FreeM.liftBind, bind, and pure). I still maintain linking Prog to TimeM is a terrible idea. A strictly better solution that still allows those optimizations would be to have <code>Prog.time</code> lift <code>Model.cost</code> to <code>Writer Cost</code>. It will still leave us independent of <code>TimeM</code>, and maybe give us access to more lemmas.</p>",
        "id": 574984537,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771605513
    },
    {
        "content": "<p>The biggest optimizations in the proof length can come from golfing my existing proofs since I have a habit of writing lean proofs like a late-2024 LLM anyway.</p>",
        "id": 574985901,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771605778
    },
    {
        "content": "<p>WriterT is probably too annoying to use since it forces the cost to be multiplicative. If we fix that in mathlib then I agree that it could replace TimeM</p>",
        "id": 574986018,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771605816
    },
    {
        "content": "<p>I can make that PR. I don't know how long it will linger in mathlib's review queue. Typical wait time seems to be 1 month.</p>",
        "id": 574986225,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771605864
    },
    {
        "content": "<p>It was easy : <a href=\"https://github.com/leanprover-community/mathlib4/pull/35578\">https://github.com/leanprover-community/mathlib4/pull/35578</a><br>\nOnly the Cont monad uses <code>WriterT</code> in mathlib</p>",
        "id": 574988525,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771606400
    },
    {
        "content": "<p>I think you need consensus on Zulip that it's a good idea first</p>",
        "id": 574989097,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771606570
    },
    {
        "content": "<p>Maybe ping the previous thread you made now that the PR exists</p>",
        "id": 574989168,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771606588
    },
    {
        "content": "<p>Okay. I don't recall making one. But I don't see why this should be a controversial change. This is the meaning of a writer monad.</p>",
        "id": 574989412,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771606655
    },
    {
        "content": "<p>Both the current and proposed versions are, the difference is a mathlib-ism</p>",
        "id": 574989690,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771606739
    },
    {
        "content": "<p>Let's not discuss this here, please try to find your old thread</p>",
        "id": 574989789,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771606762
    },
    {
        "content": "<p>I am willing to go to some lengths to avoid dependency on <code>TimeM</code> because whatever decision is reached on its fate (whether it will be \"the\" model of lightweight algorithms or the opposite), I don't want the decision to be linked to its usage in <code>Prog</code>. Further as I have said before, conceptually the dependency is both extraneous and flawed.</p>",
        "id": 574991325,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771607201
    },
    {
        "content": "<p>I also promised <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span>  that <code>Prog</code> doesn't need <code>TimeM</code> and as far as I can help it, I have kept it.</p>",
        "id": 574991465,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771607243
    },
    {
        "content": "<p>I think we have optimised <a href=\"https://github.com/leanprover/cslib/pull/275\">cslib#275</a> substantially now</p>",
        "id": 575416842,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771889131
    },
    {
        "content": "<p>It has gone from ~1500 lines to about ~1100 lines</p>",
        "id": 575416934,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771889159
    },
    {
        "content": "<p>It now piggybacks off the TimeM infrastructure as if it were the writer monad (tick = tell)</p>",
        "id": 575417628,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1771889383
    },
    {
        "content": "<p>This PR is starting to become unwieldy with the number of review comments, especially as I don't have the pemission to resolve the ones that have been addressed.</p>",
        "id": 575426218,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771893882
    },
    {
        "content": "<p>Hey, Eric. Thanks so much for the review work. I didn't realize you didn't already have permission to even resolve comments. I'm going to ping the maintainer channel about this.</p>",
        "id": 575429174,
        "sender_full_name": "Chris Henson",
        "timestamp": 1771895184
    },
    {
        "content": "<p><strong>Update</strong> : This PR has been thoroughly vetted and refined. I hope we can get this merged fast. I can’t see any technical reasons to wait. </p>\n<p>I hope to continue building on it with confirmation that it has been merged. There are several obvious further additions for subsequent PRs that I hope to pursue very soon after the merge. For one thing: a RAM model type parametrised by a word type.</p>",
        "id": 575889628,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772060548
    },
    {
        "content": "<p>It has exactly what it needs to start collecting algorithms and models and even reductions between models.</p>",
        "id": 575889751,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772060582
    },
    {
        "content": "<h2>Another update</h2>\n<p>Here's a compressed PR with no comment history for ease of further reviewing : <a href=\"https://github.com/leanprover/cslib/pull/372\">cslib#372</a></p>",
        "id": 575901056,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772065944
    },
    {
        "content": "<p>CC : <span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span></p>",
        "id": 575901389,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772066052
    },
    {
        "content": "<p>I hope this speeds up review and merge. This PR has been pending for a while. It would be greatly helpful to me if we could get this done asap.</p>",
        "id": 575901561,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772066145
    },
    {
        "content": "<h2>Update</h2>\n<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> has approved this PR and I have addressed his and Eric's comments. Is there anything I can do to accelerate to a merge? CC : <span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span></p>",
        "id": 576254383,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772197238
    },
    {
        "content": "<p>Great work!I'm happy to see this</p>",
        "id": 576325699,
        "sender_full_name": "Tanner Duve",
        "timestamp": 1772216878
    },
    {
        "content": "<p>Thanks. I have plans for future PRs that this approach specifically allows us to explore. I would love to invite everyone to contribute. </p>\n<ol>\n<li>Defining a query type for RAM models parametrised by a word type. </li>\n<li>Instantiations to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> and bitvecs of a fixed size <code>w</code> to get the Real RAM and w-word RAM models</li>\n</ol>",
        "id": 576371257,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772239472
    },
    {
        "content": "<ol start=\"3\">\n<li>\n<p>Reductions from custom queries all the way down to one of these models. </p>\n</li>\n<li>\n<p>Straight-Line programs as a query type for circuits (Boolean/arithmetic)</p>\n</li>\n<li>\n<p>a TM query type for Turing machines. </p>\n</li>\n<li>\n<p>Basic algorithms in sufficiently abstract and minimal query types chosen per the problem setting.</p>\n</li>\n</ol>",
        "id": 576371526,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772239658
    },
    {
        "content": "<p>A careful formulation of the RAM model should also allow discussing space complexity in this framework. This in turn might suggest ways to work with space complexity (by allowing only the use of allocated objects, and cost functions that assign space depending on object allocated)</p>",
        "id": 576371827,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772239842
    },
    {
        "content": "<p>Sounds good I can definitely contribute to this</p>",
        "id": 576374883,
        "sender_full_name": "Tanner Duve",
        "timestamp": 1772241219
    },
    {
        "content": "<p>I am hoping it gets merged soon. I still have my code for straight line circuits and ID marked progrms that I deleted from the PR to keep it small.</p>",
        "id": 576375035,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772241269
    },
    {
        "content": "<p>I'm happy to look at this again in the coming week. I need to sort out where to put some things (that's minor). I'd also like a high level overview of all the proposed approaches, to direct people effectively. I'll open a separate thread for that.</p>",
        "id": 576402034,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1772266113
    },
    {
        "content": "<p>It’s ready for merging fwiw. I hope we can start inviting contributors already</p>",
        "id": 576407168,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772270485
    },
    {
        "content": "<p>I am at workshop where people are interested in doing so.</p>",
        "id": 576407266,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1772270583
    }
]