[
    {
        "content": "<p>Can I suggest/recommend that CSLib puts everything in the CSLib namespace? </p>\n<p>(Mathlib conspicuously doesn't do this, but this is not an example to emulate.)</p>",
        "id": 544720537,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760440668
    },
    {
        "content": "<p>Yes, I can do this. We unfortunately picked up the bad habit of not consistently using a top level CSLib namespace.</p>",
        "id": 544728847,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760443109
    },
    {
        "content": "<p>It would be nice to have a linter for this, but I'm not sure exactly what the condition should be.</p>",
        "id": 544729185,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1760443196
    },
    {
        "content": "<p>Something like every new declaration is either in the CSLib namespace, or extending something upstream? If that's possible metaprogramming-wise, seems like it would be something you run periodically.</p>",
        "id": 544734277,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760444635
    },
    {
        "content": "<p><a class=\"message-link\" href=\"/#narrow/channel/513188-CSLib/topic/Strange.20.22lake.20build.22.20error.20msg/near/544805681\">#CSLib &gt; Strange \"lake build\" error msg @ üí¨</a> </p>\n<p>Does cslib require that all theory files have their paths be included in the top-level¬†<code>Cslib.lean</code>?</p>",
        "id": 544807608,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760464165
    },
    {
        "content": "<p>Is it possible to make <code>_root_</code> point to <code>CSLib</code>? Prefixing names with <code>_root.CSLib.</code> when you're in a namespace and want to define something outside of it is a bit verbose. Or maybe there's some syntax for the parent namespace?</p>",
        "id": 544810275,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760465133
    },
    {
        "content": "<p>Ah, I wasn't aware of this. I took Mathlib's example, unaware that it was not a good one.</p>\n<p>Yes, let's put everything under a namespace. But with what casing? I've been going with Cslib so far, while other people with CSLib and recently in the steering committee we've adopted CSlib. <span aria-label=\"face with spiral eyes\" class=\"emoji emoji-1f635-200d-1f4ab\" role=\"img\" title=\"face with spiral eyes\">:face_with_spiral_eyes:</span></p>",
        "id": 544819522,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1760468956
    },
    {
        "content": "<p>I think <code>Cslib</code> is better.  After all, that's the name already used by file and directory names at the top of the repo (like <code>Cslib.lean</code>, etc).  Having <code>CSlib</code> as a namespace just creates confusion.</p>",
        "id": 544821090,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760469528
    },
    {
        "content": "<p>Yeah, the casing constantly trips me up. We should decide on a standard usage. I tend to prefer <code>Cslib</code> <em>in code</em> for the same reasons as <span class=\"user-mention\" data-user-id=\"110637\">@Ching-Tsun Chou</span>. It'd be confusing for it not to match the imports. It's okay(ish) if in informal usage another casing is used.</p>",
        "id": 544822034,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760469975
    },
    {
        "content": "<p>Glad to read this.<br>\nI find casing of cslib a nightmare both to figure out and to type, so I settled on no casing early on (<code>cslib</code>), and just capitalise the first letter when a first capital letter is expected (like in Lean).<br>\nSo, I like <code>Cslib</code> for the namespace.</p>",
        "id": 544878662,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1760505607
    },
    {
        "content": "<p>I just noticed that <code>Cslib/Foundations/Data/OmegaSequence</code> missed the Cslib namespacing patch.  So I made a PR (<a href=\"https://github.com/leanprover/cslib/pull/112\">cslib#112</a>) to fix it.  <span class=\"user-mention\" data-user-id=\"929508\">@Fabrizio Montesi</span> , could you take a look and merge it into \"main\"?  Thanks!</p>",
        "id": 545158269,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760582970
    },
    {
        "content": "<p>I think <code>CSLib</code> is the most sensible casing (and the one that follows lean + mathlib casing guidelines re: acronyms in names), but it should be used uniformly (on the root package name and the namespace alike)</p>",
        "id": 545314916,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1760620210
    },
    {
        "content": "<p>Is Mathlib not following the convention then? (Shouldn't it be MathLib?)</p>",
        "id": 545323052,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1760621492
    },
    {
        "content": "<p>mathlib is one word for branding purposes</p>",
        "id": 545367822,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1760627966
    },
    {
        "content": "<p>I think Cslib can be a similar brand name</p>",
        "id": 545367934,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760627984
    },
    {
        "content": "<p>I agree with the others that <code>Cslib</code> is easier to type that <code>CSLib</code></p>",
        "id": 545368030,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760627999
    },
    {
        "content": "<p>I believe there was an initial confusion on this matter because two projects started around the same time with different casings</p>",
        "id": 545368182,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1760628022
    },
    {
        "content": "<p>see e.g. this zulip channel name</p>",
        "id": 545368302,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1760628040
    },
    {
        "content": "<p>I think this hasn't been mentioned in this thread, but for context I  just namespaced everything in Cslib yesterday</p>",
        "id": 545368380,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760628054
    },
    {
        "content": "<p>I think it's harder to pronounce Cslib as a word though</p>",
        "id": 545368525,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1760628077
    },
    {
        "content": "<p>There are some 50 odd files to modify if you wish to change that</p>",
        "id": 545368612,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760628093
    },
    {
        "content": "<p>It is mildly annoying to have another big PR, but it's just a search and replace. (Not arguing for it per se, I just don't find that reasoning compelling)</p>",
        "id": 545386622,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760630935
    },
    {
        "content": "<p>how do you get a list of all declarations that were declared in the current file (as opposed to imported)? Maybe we could write a linter that just checks that all these declarations have a namespace matching the project name or specified in the lakefile.</p>",
        "id": 545397742,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760632677
    },
    {
        "content": "<p>We still want to allow extending existing namespaces though, say for instance to add something for <code>List</code> or <code>Nat</code>. Here is my reasoning so far:</p>\n<p>What needs to be checked is that every new declaration falls under either CsLib or an upstream top level namespace. If I can write it so the latter isn't recalculated each time (or otherwise fast), it can be a usual linter. Otherwise, it could be a library-wide check run in CI.</p>",
        "id": 545403512,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760633962
    },
    {
        "content": "<p>Alas, isn't it a bit too late to make such disruptive name changes now?  It is not just a matter of a global name change in the main branch of the upstream repo.  There are other branches and some of us are working on multiple patches locally.  I would hate to spend the time fixing all the patches I'm working on.</p>\n<p>And this is not to mention that CSLib is harder to read and to type than Cslib.  You have to look at it twice to make sure that the \"L\" is in uppercase.</p>",
        "id": 545424204,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760640247
    },
    {
        "content": "<p>In case it is helpful, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Environment.getNamespaceSet#doc\">docs#Lean.Environment.getNamespaceSet</a> returns all available namespaces.  In fact, every namespaces is added to the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.namespacesExt#doc\">docs#Lean.namespacesExt</a> environment extension.  However, a command like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>does extend the environment extension with <code>A</code> and <code>A.B</code>, so checking after-the-fact whether a namespace already existed is a little tricky.  You may have to preemptively scan the environment for declarations that are \"imported\" and extract their namespace, before you check if the initial segment of a new name matches <code>Cslib</code> or one of the others.</p>\n<p>Here is a sample usage of <code>namespaceExt</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: #[Acc, Add, Alternative, AndOp, AndThen, Append, Applicative, Array, BEq, Bind, BitVec, Bool,</span>\n<span class=\"sd\">ByteArray, Char, Classical, Coe, CoeDep, CoeFun, CoeHTC, CoeHTCT, CoeHead, CoeOTC, CoeOut, CoeSort,</span>\n<span class=\"sd\">CoeT, CoeTC, CoeTail, Complement, Decidable, DecidableLE, Div, DoResultBC, DoResultPR, DoResultPRBC,</span>\n<span class=\"sd\">DoResultSBC, Dvd, Dyadic, EStateM, EmptyCollection, Except, ExceptT, Fin, Float, Float32,</span>\n<span class=\"sd\">FloatArray, FloatSpec, ForIn, ForIn', ForInStep, ForM, Function, Functor, GetElem, GetElem?, HAdd,</span>\n<span class=\"sd\">HAnd, HAndThen, HAppend, HDiv, HMod, HMul, HOr, HOrElse, HPow, HSMul, HShiftLeft, HShiftRight, HSub,</span>\n<span class=\"sd\">HXor, HasEquiv, HasSSubset, HasSubset, Hashable, HomogeneousPow, IO, ISize, ImportCompletion,</span>\n<span class=\"sd\">Inhabited, Insert, Int, Int16, Int32, Int64, Int8, IntCast, Inter, Inv, LE, LLVM, LT, Lean, List,</span>\n<span class=\"sd\">MProd, Max, Membership, MessageActionItem, MessageType, Min, Mod, Monad, MonadControl,</span>\n<span class=\"sd\">MonadControlT, MonadEval, MonadEvalT, MonadExcept, MonadExceptOf, MonadFinally, MonadFunctor,</span>\n<span class=\"sd\">MonadFunctorT, MonadLift, MonadLiftT, MonadReader, MonadReaderOf, MonadShareCommon, MonadState,</span>\n<span class=\"sd\">MonadStateOf, MonadWithReader, MonadWithReaderOf, Mul, Nat, NatCast, NatPow, Neg, NonScalar, OfNat,</span>\n<span class=\"sd\">OfScientific, One, Option, OrElse, OrOp, Ord, Ordering, PEmpty, PLift, PNonScalar, PProd, PSigma,</span>\n<span class=\"sd\">PSum, PULift, PUnit, Pow, Prod, Pure, Quotient, RandomGen, Rat, Relation, Repr, ReprTuple, SDiff,</span>\n<span class=\"sd\">SMul, ST, Sep, Seq, SeqLeft, SeqRight, Setoid, ShareCommon, ShiftLeft, ShiftRight,</span>\n<span class=\"sd\">ShowMessageParams, ShowMessageRequestParams, Sigma, Singleton, SizeOf, StateCpsT, StateT, Std,</span>\n<span class=\"sd\">StdGen, Stream, String, Sub, Substring, Subtype, Sum, System, Task, Thunk, ToBool, ToStream,</span>\n<span class=\"sd\">ToString, Trans, UInt16, UInt32, UInt64, UInt8, ULift, USize, Union, Vector, WellFoundedRelation,</span>\n<span class=\"sd\">XorOp, Zero, default, instDecidableEqDyadic, instDecidableEqRat, instDecidableEqSum]</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">namespaces</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">getEnv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getNamespaceSet</span><span class=\"bp\">.</span><span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚àÖ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NameSet</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">tot</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">components</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"bp\">::_::_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">tot</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"n\">r</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">tot</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">sorted</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">namespaces</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"bp\">.</span><span class=\"n\">qsort</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬∑.</span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">¬∑.</span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"n\">sorted</span>\n</code></pre></div>",
        "id": 545968292,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1760964564
    },
    {
        "content": "<p>I think concretely an API function that returns the namespaces of a declaration in an array  will be useful. The idea is that in any file there shouldn‚Äôt be any unnamespaced local declaration.</p>",
        "id": 545979817,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1760967161
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> This \"preemptive scan\" is what I had in mind, though thanks for pointing out that function to make it easier! </p>\n<p>To avoid having to query for the namespaces every time in a linter, I was thinking I would have this as a constant, and have a test that it is equal.</p>",
        "id": 545990761,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760969536
    },
    {
        "content": "<p>If you want to write a <em>syntax</em> linter, then I agree that probably storing the available namespaces in a constant is a viable option.  If you are writing an <em>environment</em> linter, though, the computation of the available namespaces is (probably) only performed once and it is not an especially slow computation, so you may not need to hard-code it.</p>",
        "id": 546017165,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1760975173
    },
    {
        "content": "<p>Ah this probably does make better sense as an environment linter, I overlooked that possibility. If it performs fine, I'll do that, thanks!</p>",
        "id": 546034287,
        "sender_full_name": "Chris Henson",
        "timestamp": 1760979269
    },
    {
        "content": "<p>This seems to work reasonably fast, ~20 seconds to check <code>Cslib</code>. The only offending declarations it found were unscoped notations from <code>LTS</code> and <code>ReductionSystem</code>. Once I figure out how to fix those I'll make a PR.</p>",
        "id": 546711698,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761233503
    },
    {
        "content": "<p>PR: <a href=\"https://github.com/leanprover/cslib/pull/123\">cslib#123</a></p>",
        "id": 546775622,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761257221
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110637\">Ching-Tsun Chou</span> <a href=\"#narrow/channel/513188-CSLib/topic/namespacing/near/545424204\">said</a>:</p>\n<blockquote>\n<p>Alas, isn't it a bit too late to make such disruptive name changes now?</p>\n</blockquote>\n<p>Just as a general principle, no, it is never too late to do anything. :-) At least, this is the approach that Mathlib takes, that all refactors are fair game, and that PR branches just need to merge <code>master</code>, and that this is an acceptable cost.</p>",
        "id": 546784935,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761263086
    },
    {
        "content": "<p>But you need to argue first that <code>CSLib</code> is a better name than <code>Cslib</code> to be worth the effort.  Also, changing the names of namespaces is one thing, but changing the filenames and directories names is quite something else.</p>",
        "id": 546789201,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1761266159
    },
    {
        "content": "<p>I agree with Kim in general. It is not unacceptably difficult to merge even large changes, including filenames, given a sufficient benefit. That said, I think people are reasonably happy at the moment. I am not compelled to make any change.</p>",
        "id": 546790165,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761266899
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110637\">Ching-Tsun Chou</span> <a href=\"#narrow/channel/513188-CSLib/topic/namespacing/near/546789201\">said</a>:</p>\n<blockquote>\n<p>But you need to argue first that <code>CSLib</code> is a better name than <code>Cslib</code> to be worth the effort.</p>\n</blockquote>\n<p>Ah, I'd missed the context, and thought we were talking about adding CSLIB namespace in the first place, not changing the casing.</p>",
        "id": 546799237,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1761273239
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"687698\">@Chris Henson</span> I've merged your lint-test-integration (nice!). Will people get that linting also while they edit files? Maybe we should add a check that Cslib.Init is imported somehow (albeit indirectly)?</p>",
        "id": 546836080,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1761293547
    },
    {
        "content": "<p>Because they are environment linters, which by their nature are a bit slower, they will not be run as you edit. You must either run <code>lake test</code> locally or wait for it to run in CI. The import requirements are:</p>\n<ul>\n<li>Syntax linters, such as the ones we use from Mathlib, need that <code>Cslib.Init</code>/<code>Mathlib.Init</code> are imported. When I add <code>Cslib.Init</code>, I will test for this.</li>\n<li>Environment linters require that everything is imported in <code>Cslib.lean</code>. I believe lint-style -action leaves on comment on PRs if we forget an import? I'd be more comfortable if there were an actual test though.</li>\n</ul>",
        "id": 546840971,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761294843
    },
    {
        "content": "<p>Sounds good, thx!</p>",
        "id": 546844292,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1761295908
    },
    {
        "content": "<p>I was thinking that, if you wanted to make a syntax linter for this check, what you could do is to create an <code>IO.Ref</code> that contains a precomputation of all the namespaces that are available <em>before</em> the current file, computed using the constants in <code>(‚Üê getEnv).constants.map‚ÇÅ</code>.  After that, for each declaration you check whether its root namespace appears in the precomputed list.</p>\n<p>This means that you pay the price for the precomputation once per file, but since the first time that you compute it, you store it in the IO.Ref, you only pay it once.</p>",
        "id": 546847852,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1761297072
    },
    {
        "content": "<p>As a practical matter I think you could get away with fewer precomputations (maybe one in our Init?) because the only time the top namespace is not <code>Cslib</code> is for upstream core/Mathlib. I felt the environment linter was simpler and sufficient because I don't anticipate people violating this rule often.</p>",
        "id": 546849471,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761297590
    },
    {
        "content": "<p>I noticed that <code>import CslibTests.Lint</code> has not been added to <code>CslibTests.lean</code>.</p>",
        "id": 547007584,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1761345357
    },
    {
        "content": "<p>Oops, my bad. I will add a test for this eventually. (Though compared to the library it is less crucial, because the tests are unlikely to be used as a library, and everything is still built by <code>lake test</code> because of the glob pattern)</p>",
        "id": 547007998,
        "sender_full_name": "Chris Henson",
        "timestamp": 1761345758
    },
    {
        "content": "<p>I run the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">mk_all</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n</code></pre></div>\n<p>on everything I work on all the time.</p>",
        "id": 547008201,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1761345948
    }
]