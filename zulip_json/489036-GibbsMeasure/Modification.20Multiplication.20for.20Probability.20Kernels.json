[
    {
        "content": "<p>I'm currently working on the lemma IsModifier.mul in <a href=\"https://github.com/james18lpc/GibbsMeasure/blob/main/GibbsMeasure/Specification.lean\">Specification.lean</a>, and I've reached a point where the statement I'm trying to prove is true for Probability Kernels (i.e. all the induced measures have total mass one). I'm not entirely sure if the original statement of the lemma is true in general for all kernels the way we've defined them (still need to think about this), or if I've reached this point by not making use of all of the properties of specifications/modifiers. </p>\n<p>Below is the Lean code I have so far (ignore the poor quality, I'll clean it up once I have a working proof). The bulk of the code is just rewriting all the densities as integrals, and then showing that the functions inside the integrals are equal. </p>\n<p>The last goal before the sorry is  \"(((γ Λ₁) a).withDensity (ρ₁ Λ₁ * ρ₂ Λ₁)) b = b.indicator (fun x ↦ 1) a\". Here, γ is a specification, so (γ Λ₁) is a proper kernel. This identity is  equation (1.19) in Georgii's book (2nd edition) for proper probability kernels. For general kernels, we can use equation (1.18)  with A being the entire space, and see that the right hand side should be multiplied by the measure of the entire space. </p>\n<p>Right now, I think Specifications are defined as general kernels in the project and not as probability kernels specifically.  Should I specify somehow that γ Λ₁ is a probability kernel in the statement? Or does anyone see where I'm missing something and can still prove it for general kernels?<br>\n<span class=\"user-mention\" data-user-id=\"373986\">@Kalle Kytölä</span> <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> <span class=\"user-mention\" data-user-id=\"773147\">@Yan Yablonovskiy</span> <span class=\"user-mention\" data-user-id=\"727171\">@Kin Yau James Wong</span> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">IsModifier</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">ρ₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"bp\">∞</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hρ₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">IsModifier</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hρ₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">modification</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">hρ₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">IsModifier</span><span class=\"w\"> </span><span class=\"n\">ρ₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">IsModifier</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">ρ₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">measurable</span><span class=\"w\"> </span><span class=\"n\">Λ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hρ₁</span><span class=\"bp\">.</span><span class=\"n\">measurable</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hρ₂</span><span class=\"bp\">.</span><span class=\"n\">measurable</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">isConsistent</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">IsConsistent</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">Λ₁</span><span class=\"w\"> </span><span class=\"n\">Λ₂</span><span class=\"w\"> </span><span class=\"n\">hsub</span>\n\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">modification</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">hρ₁</span><span class=\"w\"> </span><span class=\"n\">Λ₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">cylinderEvents_le_pi</span><span class=\"w\"> </span><span class=\"bp\">∘ₖ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">modification</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">hρ₁</span><span class=\"w\"> </span><span class=\"n\">Λ₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">modification</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">hρ₁</span><span class=\"w\"> </span><span class=\"n\">Λ₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"o\">[(</span><span class=\"n\">γ</span><span class=\"bp\">.</span><span class=\"n\">modification</span><span class=\"w\"> </span><span class=\"n\">ρ₁</span><span class=\"w\"> </span><span class=\"n\">hρ₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">isConsistent</span><span class=\"w\"> </span><span class=\"n\">hsub</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">modificationKer</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">modificationKer</span><span class=\"o\">]</span>\n\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Kernel</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Kernel</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">bind</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">withDensity_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">ofMeasurable</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">measure_eq_coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MeasurableSet</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"bp\">.</span><span class=\"n\">toOuterMeasure</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">      </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">measure_eq_coe</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">inducedOuterMeasure</span><span class=\"o\">]</span>\n\n<span class=\"w\">    </span><span class=\"n\">conv_rhs</span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">withDensity</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">ofMeasurable</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">measure_eq_coe</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">inducedOuterMeasure</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">--apply congr_arg₂</span>\n<span class=\"w\">    </span><span class=\"n\">congr</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">congr_arg</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">funext</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">funext</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hb</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">lintegral_map</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">lintegral_withDensity_eq_lintegral_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">lintegral_indicator</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">lintegral_congr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_equal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ρ₂</span><span class=\"w\"> </span><span class=\"n\">Λ₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ρ₂</span><span class=\"w\"> </span><span class=\"n\">Λ₂</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">h_equal</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">indicator_mul_left</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">mul_left_inj</span><span class=\"o\">]</span>\n\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 518166461,
        "sender_full_name": "Fred Rajasekaran",
        "timestamp": 1747260225
    },
    {
        "content": "<p>Sorry, I realise I never replied to your message, <span class=\"user-mention\" data-user-id=\"671055\">@Fred Rajasekaran</span>! You should feel free to assume anything extra about the kernel. The book only talks about probability kernels</p>",
        "id": 544388877,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1760264707
    },
    {
        "content": "<p>I've been working on some files in this <a href=\"https://github.com/james18lpc/GibbsMeasure/pull/13\">PR</a> and more recently have completed the sorry s in CondExp (It seems nobody was working on it but apologies if otherwise). If nobody is working on it, I'm going to make a try at LebesgueCondExp :)</p>",
        "id": 544996080,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1760541341
    }
]