[
    {
        "content": "<p>So the formalization of the quantum harmonic oscillator is now in PhysLean.  One of the things I'm currently exploring is 'curated notes', and I have made one for the harmonic oscillator <a href=\"https://heplean.com/CuratedNotes/HarmonicOscillator.html\">here</a>.</p>\n<p>The motivation behind these notes is two fold: </p>\n<ul>\n<li>Firstly, I hope they give the new or experienced  Lean user an idea of the (story of the) formalization without them having to work through every definition and theorem. </li>\n<li>Secondly, I hope (and maybe this is unfounded) that they will also be useful for physicists not initiated in Lean who want to learn about a specific topic. </li>\n</ul>\n<p>I also hope that they can be used to in a sense \"advertise\" the project more generally.</p>\n<p>The notes are made directly from the Lean code using doc-strings with some additional text surrounding this. </p>\n<p>Any feedback would be greatly appreciated.</p>",
        "id": 502042100,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1740575109
    },
    {
        "content": "<p>Looking at the lean code for lemma 2.3, <a href=\"https://heplean.com/CuratedNotes/HarmonicOscillator.html#decl-2.3\">https://heplean.com/CuratedNotes/HarmonicOscillator.html#decl-2.3</a>, I would suggest using structured goals so that you don't have two exacts right after each other. and/or using <code>suffices</code></p>",
        "id": 502054272,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740578548
    },
    {
        "content": "<p>And perhaps for physlean or just this file, it makes sense to have a CoeFun for polynomial so that you don't have to have a separate HermiteFun def. Or have simp lemmas that describe its ring hom nature.</p>",
        "id": 502055326,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740578817
    },
    {
        "content": "<p>Additionally, I think if you're trying to get across clarity in the lean code, for example that the eigenfunction is real, it might be better to not squeeze the simps but to have a plain terminal simp without specifying lemmas.</p>",
        "id": 502055574,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740578889
    },
    {
        "content": "<p>Similarly, proofs like this are shorter and at the same time, I think clearer:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">eigenfunction_aeStronglyMeasurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">AEStronglyMeasurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">eigenfunction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">eigenfunction_integrable</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">aestronglyMeasurable</span>\n</code></pre></div>",
        "id": 502056080,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740579038
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> ! I agree with all of these points. <br>\nThough weirdly the terminal simp of eigenfunction_conj doesn't actually work if turned into a plain simp (I think other simp lemmas get in the way). I'm going to have a go to see if I can get something working regarding the CoeFun . </p>\n<p>Let me add in passing, here that the 'curated note' is actually made from a number of different files (and select theorems and definitions therein)  within PhysLean.</p>",
        "id": 502069750,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1740582313
    },
    {
        "content": "<p>Please leave a note here about which simp lemmas get in the way! I do this by doing <code>simp?</code> and remarking which ones get mentioned that I don't want. It's possible we have a coercion/cast lemma pointing the \"wrong\" way.</p>",
        "id": 502092457,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740587855
    },
    {
        "content": "<p>It's <code>Complex.ofReal_exp</code> that gets in the way, because it overrides <code>Complex.conj_ofReal</code>.</p>\n<p>Here is a mwe </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex.ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real.exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Complex.ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real.exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\">  </span><span class=\"c1\">-- does not work</span>\n<span class=\"w\">  </span><span class=\"c1\">-- simp only [Complex.conj_ofReal] -- works</span>\n</code></pre></div>\n</div></div>",
        "id": 502093982,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1740588243
    },
    {
        "content": "<p>Perhaps in this file, you want to turn off that lemma, since you're almost never going to be discussing <code>Complex.exp</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_exp</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- or</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal_exp</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 502096306,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740588800
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Rat.cast_neg#doc\">docs#Rat.cast_neg</a> is a simp lemma which pushes the coercion inwards under a unary operator. I don't know what the conventions are in general but this makes me think that <code>Complex.ofReal_exp</code> might be going in the right direction as far as mathlib is concerned, and perhaps what you want is another simp lemma saying <code>(starRingEnd ℂ) (Complex.exp z) = Complex.exp (starRingEnd ℂ z)</code> to make <code>simp</code> confluent again.</p>",
        "id": 502096375,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740588823
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- now works</span>\n</code></pre></div>\n<p>I've never worked in this part of the library and can't guarantee that this simp lemma is OK but if it makes the simp set confluent then that sounds like good evidence that it should be there.</p>",
        "id": 502096779,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740588921
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">kevin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- uh-oh, simpNF linter will complain</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 502096904,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740588956
    },
    {
        "content": "<p>Hmm, yeah seems like <code>Complex.exp_conj</code> and <code>Complex.ofReal_exp</code> act against each other here.</p>",
        "id": 502097517,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1740589119
    },
    {
        "content": "<p>So perhaps one can argue that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Complex.exp_conj#doc\">docs#Complex.exp_conj</a> is backwards (i.e. should be a simp lemma the other way around). Searching for it in mathlib I see 7 <code>rw [← exp_conj]</code> and only 4 <code>rw [exp_conj]</code> (although there is more than one lemma called <code>exp_conj</code>) so you might want to raise this issue in <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4\">#mathlib4</a> and see if people think changing the direction is a good idea. You could of course just try changing the type of the lemma in mathlib and seeing what breaks.</p>",
        "id": 502130269,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740599023
    },
    {
        "content": "<p>My thought is that the only things that exp foo could be simplied on are exp 0 and exp over ring expressions. On which conj would operate as well into the obvious forms. And conj can operate on more expressions than just ring expressions, including re and im. So exp should stay on the outside.</p>",
        "id": 502141795,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740602977
    },
    {
        "content": "<p>Nice! With this it should be pretty immediate to prove, e.g. the spectrum of the QHO, or to show the Virial theorem for it, right?</p>",
        "id": 502601233,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1740755617
    },
    {
        "content": "<p>It should be! The spectrum is already there in the form of the TISE, but not formally defined as such. <br>\nIf anyone wants to have a go at the Virial theorem and push it to PhysLean please do!</p>",
        "id": 502605826,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1740756888
    },
    {
        "content": "<p>As an aside: For these ‘curated notes’, I have added drop down menus for each definition and theorem which allows one to easily generate a GitHub issue related to that definition or theorem. In particular it allows one to suggest improvements to the name, lean code or doc-string.</p>",
        "id": 503261464,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741093281
    },
    {
        "content": "<p>These curated notes are now written in Verso: e.g.</p>\n<p><a href=\"https://notes.physlean.com/Quantum-Mechanics/Quantum-Harmonic-Oscillator/#QHO\">https://notes.physlean.com/Quantum-Mechanics/Quantum-Harmonic-Oscillator/#QHO</a></p>\n<p>My aim is that these notes  is that they will expand to cover other areas in PhysLean, and in conjunction with PhysLean (though PhysLean itself will always be the priority). In particular one area that particularly needs covering is: The Lorentz group. </p>\n<p>If anyone wants to help with any of this side of things let me know!</p>",
        "id": 505343879,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741852329
    },
    {
        "content": "<p>I'd be happy to work on curated notes for the Lorentz Group since I'm already working on PRs to develop the Relativity folder in PhysLean</p>",
        "id": 505347372,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1741853311
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span> This would be helpful :)</p>",
        "id": 505360502,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1741856599
    }
]