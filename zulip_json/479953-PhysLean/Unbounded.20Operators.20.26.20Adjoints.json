[
    {
        "content": "<p>I've started playing around with defining unbounded operators and their adjoints (items 4 and 5 on the QM project board) and ran into a design question I thought I'd ask about. My current definitions are:</p>\n<p>ğ•œ is <code>RCLike</code>, E &amp; F have instances <code>InnerProductSpace</code> and <code>NormedAddCommGroup</code> (Hilbert spaces without completeness)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">BoundedLinearMap</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">bounded</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">â€–</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">x</span><span class=\"bp\">â€–</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"s2\">\"â†’áµ‡â‚—[\"</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">BoundedLinearMap</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span>\n</code></pre></div>\n<p>(<code>BoundedLinearMap</code>  is maybe unnecessary since continuity is equivalent to bounded and there's already a structure <code>ContinuousLinearMap</code>)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">UnboundedLinearMap</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">domain</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subspace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span>\n<span class=\"w\">  </span><span class=\"n\">dense</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dense</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">domain</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"s2\">\"â†’áµ˜â‚—[\"</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">UnboundedLinearMap</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span>\n</code></pre></div>\n<p>The problem is when I try to define the adjoint of an unbounded operator. There several ways to characterize the domain of the adjoint all to do with the maps <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>â†¦</mo><mo stretchy=\"false\">âŸ¨</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>A</mi><mi>y</mi><mo stretchy=\"false\">âŸ©</mo></mrow><annotation encoding=\"application/x-tex\">y \\mapsto \\langle x, A y\\rangle</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7054em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">â†¦</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">âŸ¨</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">âŸ©</span></span></span></span> for fixed <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>âˆˆ</mo><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">x \\in F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> and operator <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span>, the issue is that apparently this domain is not necessarily dense but will be in  practical applications.</p>\n<p>My ideas are to either</p>\n<ol>\n<li>Define the adjoint for all operators as just a linear map and then promote it to an operator with a density condition, but we have to carry the domain of the adjoint separate from the map.</li>\n<li>Remove the density condition from the definition and add it back as a hypothesis of defining the adjoint so the adjoint is automatically an \"unbounded operator\", but this diverges from the expected definition.</li>\n</ol>\n<p>Thoughts on my ideas or your own solution is appreciated, and feel free to comment on the definitions above. You can see all of my work so far in <a href=\"https://github.com/morrison-daniel/PhysLean/tree/unbounded/PhysLean/Mathematics/Operators\">my fork</a>.</p>",
        "id": 508882671,
        "sender_full_name": "Daniel Morrison",
        "timestamp": 1743220832
    },
    {
        "content": "<p>Hi Daniel!</p>\n<p>First let me say: Thank you very much for working in this direction - its great to see this been done! I've looked at your fork and it looks great!</p>\n<p>To address your question: Out of your ideas I personally think 2 is the best, because overall I think this will make things easier to work with. </p>\n<p>Maybe one could do something like the following: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LinearMapWithDomain</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’â‚—</span><span class=\"o\">[</span><span class=\"n\">ğ•œ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">domain</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subspace</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsUnboundedLinearMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMapWithDomain</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Dense</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">domain</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"s2\">\"â†’áµ˜â‚—[\"</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LinearMapWithDomain</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span>\n</code></pre></div>\n<p>One could maybe also define a structure <code>UnboundedLinearMap</code> which extends <code>LinearMapWithDomain</code>. </p>\n<p>I run into problems like this quite often, so maybe someone else here can shed more light on what is best. I also think there is no harm in picking one approach and seeing if you can get it to work - we can always refactor it later (it's a pain but not the end of the world).</p>\n<p>Once again - thanks! </p>\n<p>Joseph</p>",
        "id": 508919420,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1743252410
    },
    {
        "content": "<p>If you look at <a href=\"https://github.com/dupuisf/LFTCM2024TraceClass/blob/master/LFTCM2024TraceClass/ContinuousLinearMap.lean\">https://github.com/dupuisf/LFTCM2024TraceClass/blob/master/LFTCM2024TraceClass/ContinuousLinearMap.lean</a> I think there's similarly some good stuff to get going.</p>\n<p>Why do you need to define \"Unbounded linear map\", why not just, a linear map? At very least, if your definition of <code>UnboundedLinearMap</code> is not equivalent to a linear map (I can't tell for sure), I'm sure there's a better name for it</p>",
        "id": 508962648,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1743286551
    },
    {
        "content": "<p>Oh this is for <a href=\"https://en.wikipedia.org/wiki/Unbounded_operator#Definitions_and_basic_properties\">https://en.wikipedia.org/wiki/Unbounded_operator#Definitions_and_basic_properties</a> right right silly me</p>",
        "id": 508962743,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1743286625
    },
    {
        "content": "<p>Well I think the <code>dense</code> property should be pulled out into <code>DenselyDefinedLinearMap</code>, which can extend <code>UnboundedLinearMap</code>. And then adjoints are defined for <code>DenselyDefinedLinearMap</code></p>",
        "id": 508962762,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1743286641
    },
    {
        "content": "<p>Upon further investigation into the mathlib docs I found that this already exists... The relevant structure is <code>LinearPMap</code> (partially defined linear map) and you can find <code>LinearPMap.adjoint</code> <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/LinearPMap.html#LinearPMap.adjoint\">here</a>. On the bright side I was close to recreating what's here and it was an interesting exercise anyway. It isn't imported by anything else so there's probably work to be done developing the theory for what we need here.</p>",
        "id": 508997536,
        "sender_full_name": "Daniel Morrison",
        "timestamp": 1743317470
    },
    {
        "content": "<p>Just in case this helps: When I was making the project board for  QM this <a href=\"https://personal.lse.ac.uk/robert49/teaching/partiii/pdf/HilbSpReview.19x21UPLOAD.pdf\">Ref</a> is what I was looking at regarding bounded linear maps etc.</p>",
        "id": 509029610,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1743344024
    },
    {
        "content": "<p>Ooh, thanks I'll take a look. I was using Quantum Theory for Mathematicians by Brian Hall</p>",
        "id": 509056522,
        "sender_full_name": "Daniel Morrison",
        "timestamp": 1743362253
    },
    {
        "content": "<p>There is also this <a href=\"https://inspirehep.net/files/3a471bd701a9ee6bbd45003581130cf4\">Ref</a>. But I'm sure Hall's book is equally as good as either of these.</p>",
        "id": 509238784,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1743435909
    }
]