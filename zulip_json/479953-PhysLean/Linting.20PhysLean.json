[
    {
        "content": "<p>I made this PR <a href=\"https://github.com/HEPLean/PhysLean/pull/790\">PhysLean#790</a> which contains some documentation about the various linters which can be run on PhysLean and what they do. If anyone has any suggestions of how it can be improved, I would be very glad to hear them.</p>",
        "id": 547200083,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761547692
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> , I was going through the linters (lake exe lint_all) and the Style linter was flagging a bunch of stuff on SpaceTime, which is not at all what I worked on. </p>\n<p>The question is: should I fix those as well?</p>",
        "id": 560498463,
        "sender_full_name": "Fabio Anzà",
        "timestamp": 1764203893
    },
    {
        "content": "<p>Hmm odd, could you paste the output here? But no need to fix these.</p>",
        "id": 560520610,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1764222990
    },
    {
        "content": "<p>Ok, I manage to work this out - the linter errors you are seeing are on \"optional linters\" (lets call them), ones that appear in <code>lake exe lint_all</code> but are not strictly enforced by GitHub, so sometimes slip through the net. </p>\n<p>I have fixed them in <a href=\"https://github.com/HEPLean/PhysLean/pull/820\">PhysLean#820</a>, which I will merge, and then make a note here - after which merging <em>with</em> Master should remove these errors for you. (update: This PR has now been merged into master).</p>",
        "id": 560566060,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1764240373
    },
    {
        "content": "<p>(deleted - on a train with poor internet so sent message twice)</p>",
        "id": 560566290,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1764240438
    },
    {
        "content": "<p>Thanks, but it happened again. Not sure why. I'm attaching a screenshot <br>\n<a href=\"/user_uploads/3121/6km5GyZGpMMxP4LOsyqlrNIQ/Screenshot-2025-11-27-at-6.53.07PM.png\">Screenshot 2025-11-27 at 6.53.07 PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/6km5GyZGpMMxP4LOsyqlrNIQ/Screenshot-2025-11-27-at-6.53.07PM.png\" title=\"Screenshot 2025-11-27 at 6.53.07 PM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"3004x1396\" src=\"/user_uploads/thumbnail/3121/6km5GyZGpMMxP4LOsyqlrNIQ/Screenshot-2025-11-27-at-6.53.07PM.png/840x560.webp\"></a></div>",
        "id": 560681252,
        "sender_full_name": "Fabio Anzà",
        "timestamp": 1764284420
    },
    {
        "content": "<p>I'm happy to fix them and they can get pulled once I issue the PR</p>",
        "id": 560686394,
        "sender_full_name": "Fabio Anzà",
        "timestamp": 1764288550
    },
    {
        "content": "<p>They should be fixed now :). You will need to update your fork with master (merge master into your fork), but then these should go away, no need for you to do anything :).</p>",
        "id": 560710702,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1764308825
    },
    {
        "content": "<p>I saw the style linter in <a href=\"https://github.com/HEPLean/PhysLean/pull/849\">https://github.com/HEPLean/PhysLean/pull/849</a> took ~30 min to complete.  Whereas in Mathlib, most lints completed in ~2 min or less: <a href=\"https://github.com/leanprover-community/mathlib4/pull/33368\">https://github.com/leanprover-community/mathlib4/pull/33368</a>. Is it because the GH Actions CI compiled the entirety of PhysLean in addition to just checking the syntax? If so I think it would be more productive to separate the syntax checking and fail the long compilation early when the syntax check / any fast checks fail.</p>",
        "id": 565649032,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767005331
    },
    {
        "content": "<p>I think the underlying reason behind this is that Mathlib is caching builds, whilst PhysLean isn't. There have been a few discussions on best ways to set up a cache for PhysLean, but none have yet led to anything. </p>\n<p>Some of the linters specifically require PhysLean to be build before they can be applied, and this is why things are slowed. But no doubt things can be rearanged in a better way, and I think this is something we should explore. </p>\n<p>In the mean time, I recommend people lint locally rather than relying on the linters on GitHub. Instructions can be found here:</p>\n<p><a href=\"https://github.com/HEPLean/PhysLean/blob/master/scripts/README.md\">https://github.com/HEPLean/PhysLean/blob/master/scripts/README.md</a></p>",
        "id": 565703673,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767030039
    },
    {
        "content": "<p>Ah, I see. Updating on my previous post, I was comparing apples to oranges. The fast linter that took &lt; 2 min is actually the Python-based linter, which PhysLean already uses. The time comparison should have been 11 min Mathlib <code>lake build</code> vs 30 min PhysLean <code>lake build</code>.</p>\n<blockquote>\n<p>There have been a few discussions on best ways to set up a cache for PhysLean, but none have yet led to anything.</p>\n</blockquote>\n<p>I couldn't find the discussions (I searched with the keyword \"cache\"). Would following  <a href=\"https://github.com/leanprover-community/mathlib4/blob/69fc0048aa48ab4674e6fb9f0ad1b6446d04eca7/.github/workflows/build.yml#L302-L339\">how Mathlib does it</a> be strictly better than the current setup? There could always be a better method, but this can be discussed in the future. I can help prepare this, if agreed.</p>",
        "id": 565709456,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767033702
    },
    {
        "content": "<p>Here is a previous discussion on this: </p>\n<p><a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/Cache.20for.20PhysLean.20and.20projects.20downstream.20of.20Mathlib/with/530748082\">#general &gt; Cache for PhysLean and projects downstream of Mathlib</a> </p>\n<p>I believe that Mathlib's cache is stored on a server (either explicitly, or the workflow is run directly on said server), and paying for said server is one of the things that prohibits us copying Mathlib's approach.</p>",
        "id": 565713756,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767036884
    },
    {
        "content": "<p>I see (I only searched within <a class=\"stream\" data-stream-id=\"479953\" href=\"/#narrow/channel/479953-PhysLean\">#PhysLean</a> ), the Mathlib's cache seems to be stored in Azure Blob Storage (<a href=\"https://github.com/leanprover-community/mathlib4/blob/69fc0048aa48ab4674e6fb9f0ad1b6446d04eca7/Cache/Requests.lean#L251C6-L251C45\">https://github.com/leanprover-community/mathlib4/blob/69fc0048aa48ab4674e6fb9f0ad1b6446d04eca7/Cache/Requests.lean#L251C6-L251C45</a>).</p>\n<p>From the <a href=\"https://lean-lang.org/doc/reference/latest/releases/v4.25.0/#release-v4___25___0\">release note of Lean 4.25</a>, remote cache feature is already in:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover/lean4/pull/10188\">#10188</a> adds support for remote artifact caches (e.g., Reservoir) to Lake. As part of this support, a new suite of <code>lake cache</code> CLI commands has been introduced to help manage Lake's cache. Also, the existing local cache support has been overhauled for better interplay with the new remote support.</p>\n</blockquote>\n<p>I think there is no uncertainty on the direction of which method to use.</p>",
        "id": 565715437,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767038334
    },
    {
        "content": "<blockquote>\n<p>paying for said server is one of the things that prohibits us copying Mathlib's approach.</p>\n</blockquote>\n<p>Claude Code's estimate is ~$500/month (because of the egress traffic). But Mathlib also uses Cloudflare R2, which has $0 egress fee. The fee could as well be $50/month.</p>",
        "id": 565716551,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767039079
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"158609\">Rein Zustand</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Linting.20PhysLean/near/565716551\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>paying for said server is one of the things that prohibits us copying Mathlib's approach.</p>\n</blockquote>\n<p>Claude Code's estimate is ~$500/month (because of the egress traffic). But Mathlib also uses Cloudflare R2, which has $0 egress fee. The fee could as well be $50/month.</p>\n</blockquote>\n<p>I used to pay $50/month for a server for PhysLean - to run a search engine, and an online playground. Over the months this quickly adds up though. </p>\n<p>I may have some research money I can use for this, but I will need to ask if this is an allowed expense, and how it would work. Otherwise maybe we could get a small grant for it or sponsor etc.</p>",
        "id": 565747860,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767073007
    },
    {
        "content": "<blockquote>\n<p>Otherwise maybe we could get a small grant for it or sponsor etc.</p>\n</blockquote>\n<p>The frontier AI labs are benefiting a lot from the Lean formalization. I think we can ask one or few of them to fund the expenses. If Mathlib's Azure expense were in fact be $500/month, it could likely had been subsidized by Microsoft themselves.</p>",
        "id": 565751015,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767075848
    },
    {
        "content": "<p>I'm having trouble running <code>lake exe lint_all</code>, here's the error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"mi\">9</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">/</span><span class=\"n\">UnicodeCLib</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">cc</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">\\</span><span class=\"n\">PhysLean</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeCLib</span><span class=\"bp\">\\</span><span class=\"n\">case</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">\\</span><span class=\"n\">PhysLean</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeCLib</span><span class=\"bp\">\\</span><span class=\"n\">case</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">username</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.27.0\\include -O -fPIC</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">cc'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">trace</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">.&gt;</span><span class=\"w\"> </span><span class=\"n\">cc</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">\\</span><span class=\"n\">PhysLean</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeCLib</span><span class=\"bp\">\\</span><span class=\"n\">prop</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">lean</span><span class=\"bp\">\\</span><span class=\"n\">PhysLean</span><span class=\"bp\">\\.</span><span class=\"n\">lake</span><span class=\"bp\">\\</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">\\</span><span class=\"n\">UnicodeCLib</span><span class=\"bp\">\\</span><span class=\"n\">prop</span><span class=\"bp\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">username</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.27.0\\include -O -fPIC</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">execute</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">cc'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">targets</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">UnicodeBasic</span><span class=\"bp\">/</span><span class=\"n\">UnicodeCLib</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>does anyone know what I should do to make this work?</p>",
        "id": 572617405,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770553915
    },
    {
        "content": "<p>this is after <code>lake update</code> and <code>lake build</code> both succeed</p>",
        "id": 572617474,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770554008
    },
    {
        "content": "<p>update: seems to work after installing MSYS2 and updating system PATH (following instructions from AI) but not sure whether this is the proper way or am I missing something.</p>",
        "id": 572620093,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770556436
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"890057\">@ZhiKai Pong</span> Are you using windows?</p>",
        "id": 572633418,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1770568784
    },
    {
        "content": "<p>yea this is on windows, not sure what changed</p>",
        "id": 572633596,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770568930
    },
    {
        "content": "<p>It seems to be working fine for me on a mac, as another data point.</p>",
        "id": 572683312,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1770615160
    }
]