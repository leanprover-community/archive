[
    {
        "content": "<p>On the pedagogical side of things, is anyone thinking about a system of physical dimensions and units in Lean?  I guess I'm thinking mainly about SI units, but I'd be interested to know about any work or ideas about physical dimensions and units.</p>",
        "id": 518939176,
        "sender_full_name": "Scott N. Walck",
        "timestamp": 1747588208
    },
    {
        "content": "<p>Hey, there have been a number of discussions on this in the past. See e.g.: </p>\n<ul>\n<li><a class=\"stream-topic\" data-stream-id=\"395462\" href=\"/#narrow/channel/395462-Natural-sciences/topic/physical.20units/with/382407056\">#Natural sciences &gt; physical units</a> </li>\n<li><a class=\"message-link\" href=\"/#narrow/channel/395462-Natural-sciences/topic/Meeting.20.28virtual.20and.20informal.29.20for.20Lean.20and.20science/near/486589163\">#Natural sciences &gt; Meeting (virtual and informal) for Lean and science @ üí¨</a></li>\n</ul>",
        "id": 518995532,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1747631262
    },
    {
        "content": "<p>For fun, I wrote an implementation of both abstract units in general, and SI units in particular.  An example file of how the API works is at <a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SIExamples.lean\">https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SIExamples.lean</a> using the SI units defined in <a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SI.lean\">https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SI.lean</a> , which are in turn a special case of \"unit systems\" defined in <a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/UnitsSystem.lean\">https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/UnitsSystem.lean</a> .</p>\n<p>Right now I have support for scalar quantities of a given dimension (e.g. length * mass / time), which can be added, multiplied, etc. in any dimensionally consistent form.  There is also a larger algebra of formal combinations of scalars (basically an <code>AddMonoidAlgebra</code>) which one can cast into, which can be convenient for some algebraic calculations.</p>",
        "id": 530237249,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753225605
    },
    {
        "content": "<p>Hi Terence, </p>\n<p>One small comment: </p>\n<p>Naively, I would expect <em>dimensions</em> to be defined independently from <em>units</em>. For example, the world has a manifold <code>Time</code> corresponding to time. A point <code>t : Time</code> should have dimension time. To have <code>t : Time</code> I need no definition of a second or units. To me what a second is, is a choice of two times <code>t1 t2 : Time</code> which are used to define a metric on <code>Time</code>, and therefore a map from <code>Time</code> to another type <code>Seconds</code> (say), terms of which correspond to  differences between times in seconds. </p>\n<p>In reality, I think in Lean one has to define <code>t1 t2 : Time</code> as axioms.</p>",
        "id": 530269235,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753251633
    },
    {
        "content": "<p>I just wanted to say that not everything has an SI equivalent. Maybe I am straying way off topic but the Haskell package I used made the assumption that everything was expressible in this way and this caused me problems.</p>\n<blockquote>\n<p>Substances like erythropoietin (EPO) are measured in International Units and these cannot be converted to Moles (see¬†Jelkmann (2009)¬†for much more detail) so we have to pretend it really is measured in Moles as there seems to be no easy way to define what the dimensional package calls a base dimension. A typical amount for a person is 15 milli-IU / milli-litre but can reach much higher levels after loss of blood.</p>\n<p>Jelkmann, Wolfgang. 2009. ‚ÄúEfficacy of Recombinant Erythropoietins: Is There Unity of International Units?‚Äù¬†<em>Nephrology Dialysis Transplantation</em>¬†24 (5): 1366. doi:<a href=\"https://doi.org/10.1093/ndt/gfp058\">10.1093/ndt/gfp058</a>.</p>\n</blockquote>",
        "id": 530308291,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1753265244
    },
    {
        "content": "<p>This is really cool! That it \"just works\" for type checking like this is really cool, that is that you can compare <code>Momentum</code> and <code>Mass * Speed</code> and they're actually the same time.</p>\n<p>Another (slight) limitation: the SI definition assumes powers of units are always integers. Quantities like amplitude spectral density typically have Volts/‚àöHz or Watts/‚àöHz. Or <a href=\"https://en.wikipedia.org/wiki/Statcoulomb\">https://en.wikipedia.org/wiki/Statcoulomb</a> which has units cm^(3/2)‚ãÖg^(1/2)‚ãÖs^(‚àí1).</p>\n<p>Obviously not too big of a deal, and it looks like <code>UnitsSystem</code> supports rational powers fine</p>",
        "id": 530391986,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1753289332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/530269235\">said</a>:</p>\n<blockquote>\n<p>Hi Terence, </p>\n<p>One small comment: </p>\n<p>Naively, I would expect <em>dimensions</em> to be defined independently from <em>units</em>. </p>\n</blockquote>\n<p>Yes, I was initially thinking in this \"coordinate-free\" approach, but eventually I concluded that I want to support both the \"coordinate-free\" way of thinking in which one does not reference units as well as the \"coordinate-using\" approach where one is happy to work in some artificially chosen unit system.  So in the end I did not adopt a purely axiomatic approach, and instead implemented dimensions directly using an internal unit system, and supplied API for both approaches.  (In particular, <code>Scalar.val_inj</code> is handy for manipulating scalar quantities directly through their unit representation, but one can instead use <code>Scalar.formal_inj</code> and work in the formal ring generated by dimensional quantities.)</p>",
        "id": 530396710,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753290941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/530308291\">said</a>:</p>\n<blockquote>\n<p>I just wanted to say that not everything has an SI equivalent. Maybe I am straying way off topic but the Haskell package I used made the assumption that everything was expressible in this way and this caused me problems.</p>\n</blockquote>\n<p>One could set up an extended SI system in my formalism that still uses <code>UnitsSystem</code> but with a different <code>Dimensions</code> instance than the SI one.  Though I haven't set up much API that would allow one to easily transfer between the SI system and an extended SI system (basically one wants a bunch of <code>map</code> lemmas involving homomorphisms between different <code>Dimensions</code> instances), but I think it can be done.</p>",
        "id": 530397426,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753291175
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/530391986\">said</a>:</p>\n<blockquote>\n<p>This is really cool! That it \"just works\" for type checking like this is really cool, that is that you can compare <code>Momentum</code> and <code>Mass * Speed</code> and they're actually the same time.</p>\n<p>Another (slight) limitation: the SI definition assumes powers of units are always integers. Quantities like amplitude spectral density typically have Volts/‚àöHz or Watts/‚àöHz. Or <a href=\"https://en.wikipedia.org/wiki/Statcoulomb\">https://en.wikipedia.org/wiki/Statcoulomb</a> which has units cm^(3/2)‚ãÖg^(1/2)‚ãÖs^(‚àí1).</p>\n<p>Obviously not too big of a deal, and it looks like <code>UnitsSystem</code> supports rational powers fine</p>\n</blockquote>\n<p>Actually there is a subtlety here I was trying to avoid.  The reason that type checking \"just works\" is that my underlying <code>Dimensions</code> instance for SI is simple enough that things like the dimensions of <code>Momentum</code> and <code>Mass * Speed</code> are actually defeq and not just propositionally equal, ultimately due to the arithmetic of the integers being basically commutative and associative at a defeq level.  I could indeed replace the dimensions instance to take rational values instead of integer ones, but then I lose the defeq and now I have to insert additional casting operators.  I don't know how to enjoy the best of both worlds at this point.  (Well, there are ad hoc solutions, such as taking the square root of a second as a base unit rather than a second, which would then permit introducing square roots of Hertz in a dimension system with nice defeq properties.)</p>",
        "id": 530397933,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753291360
    },
    {
        "content": "<p>Note that you can make them defeq:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">mul</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 530412000,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1753296444
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/530396710\">said</a>:</p>\n<blockquote>\n<p>Yes, I was initially thinking in this \"coordinate-free\" approach, but eventually I concluded that I want to support both the \"coordinate-free\" way of thinking in which one does not reference units as well as the \"coordinate-using\" approach where one is happy to work in some artificially chosen unit system.  So in the end I did not adopt a purely axiomatic approach, and instead implemented dimensions directly using an internal unit system, and supplied API for both approaches.  (In particular, <code>Scalar.val_inj</code> is handy for manipulating scalar quantities directly through their unit representation, but one can instead use <code>Scalar.formal_inj</code> and work in the formal ring generated by dimensional quantities.)</p>\n</blockquote>\n<p>I agree and understand this approach for things like time, where I would expect the underlying manifold to be <code>‚Ñù</code>, but I'm struggling to see how this works for temperature, where the underlying manifold is <code>‚Ñù‚â•0</code>, and where one really wants to distinguish between temperature (living in <code>‚Ñù‚â•0</code>) and temperature difference in a given unit (living in <code>‚Ñù</code>).</p>",
        "id": 530415212,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753297494
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> Thanks! I have updated the SI files to now support rational dimensions (with defeq equivalence in any namespace in which <code>Rat</code> arithmetic is <code>unseal</code>ed), and it works smoothly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">half_frequency_unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">frequency_unit</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">SqrtFrequency</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Scalar</span><span class=\"w\"> </span><span class=\"n\">half_frequency_unit</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">sqrt_hertz</span><span class=\"o\">:</span><span class=\"n\">SqrtFrequency</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">StandardUnit</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sqrt_hertz</span><span class=\"bp\">**</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">hertz</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">Scalar</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">half_frequency_unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">frequency_unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sqrt_hertz</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SqrtFrequency</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hw</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">sqrt_hertz</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">hertz</span><span class=\"bp\">.</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"bp\">**</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">Scalar</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">half_frequency_unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">frequency_unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hw</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>(I've still limited my <code>**</code> operation to natural number exponentation, though, so any square roots have to be done by hand, as above, though it would not be difficult to define some <code>qpow</code> operation with rudimentary API.)</p>\n<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> : I've now given each <code>Scalar d</code> type an instance of an ordered vector space, so one can create subtypes such as <code>{T:Temperature // T ‚â• 0 } </code>if desired.</p>",
        "id": 530436684,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753306163
    },
    {
        "content": "<p>I had a go at modifying <span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> 's approach to do two things: </p>\n<ol>\n<li>Include more concretely the physical origin and meaning  of dimensions and units into the story. That is, e.g. something has dimensions <code>time</code> if it scales in a certain way under a choice of metric  on the <code>Time</code> manifold (aka a choice of time unit). </li>\n<li>Allow any quantity <code>M</code> which depends on a choice of units to carry a dimension. </li>\n</ol>\n<p>In short, this amounts to replacing Terence's <code>Scalar</code> definition with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">HasDimensions</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>where the condition <code>HasDimensions d f</code> is related to how <code>f</code> scales on changing units. </p>\n<p>Obviously I haven't built nearly as much API around things (but think all the features of Terence's code could be reproduced in this framework). Below is the code. I'm naturally not claiming mine is better, it just starts from a different place.</p>\n<p>One thing I couldn't get to work is casting from dimensionless quantities to e.g. the reals (see the last example). </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"sd\">/-- Metric's on e.g. `Time` are specified</span>\n<span class=\"sd\">  (via some choice of reference metric) by a positive real number. -/</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_neq_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x.val</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Ne.symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ne_of_lt</span><span class=\"w\"> </span><span class=\"n\">x.property</span><span class=\"o\">)</span>\n\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x.property</span>\n\n<span class=\"sd\">/-- The difference in scale between two Unit metrics. -/</span>\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HDiv</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">hDiv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x.val</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">y.val</span>\n\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.hDiv_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x.val</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">y.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## Defining dimensions</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"c1\">-- more to be added.</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">zero_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"n\">d1.length</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d1.time</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.time</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d1.mass</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.mass</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">time_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">d1.time</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">length_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">d1.length</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">mass_add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">d1.mass</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2.mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Neg</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">neg</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"bp\">-</span><span class=\"n\">d.length</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">d.time</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">d.mass</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## Choice of units (aka metrics)</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"sd\">/-- Choices of units for each physical quantity. -/</span>\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span>\n<span class=\"w\">  </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span>\n<span class=\"w\">  </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitMetric</span>\n<span class=\"w\">  </span><span class=\"c1\">-- more to be added.</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span>\n\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">dimScale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">):</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"w\">  </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">u1.length</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">u2.length</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dim.length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">u1.time</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">u2.time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dim.time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">u1.mass</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">u2.mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dim.mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">‚ü©,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">‚ü©,</span><span class=\"w\"> </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## Quantities of a given dimension</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">HasDimensions</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UnitChoice.dimScale</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u1</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">HasDimensions</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">coe</span><span class=\"kd\">]</span>\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Dimensionful.toVal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">default</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">ScalarTime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">ScalarFrequency</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Dimensionless</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"sd\">/-- Multiplication of two dimensionful real numbers. This has natural generalizations. -/</span>\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f1</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">f1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f2</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UnitChoice.dimScale</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.hDiv_eq</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real.rpow_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real.rpow_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real.rpow_add</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u1.mass.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u1.mass</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u2.mass.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u2.mass</span>\n<span class=\"w\">      </span><span class=\"n\">positivity</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u1.time.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u1.time</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u2.time.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u2.time</span>\n<span class=\"w\">      </span><span class=\"n\">positivity</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u1.length.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u1.length</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">u2.length.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.val_pos</span><span class=\"w\"> </span><span class=\"n\">u2.length</span>\n<span class=\"w\">      </span><span class=\"n\">positivity</span><span class=\"o\">‚ü©</span>\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## Examples</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Time.distM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- `‚Ñù` here should be `Time`.</span>\n<span class=\"w\">     </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarTime</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">‚ü®</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">t1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">u.time.val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UnitChoice.dimScale</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">UnitMetric.hDiv_eq</span><span class=\"o\">]‚ü©</span>\n\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Rat.add</span><span class=\"w\"> </span><span class=\"n\">Rat.mul</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarTime</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarFrequency</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionless</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarTime</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarFrequency</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionless</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"c1\">-- can't get casting to work :(.</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarTime</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ScalarFrequency</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toVal</span>\n</code></pre></div>\n</div></div>",
        "id": 530520545,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753351584
    },
    {
        "content": "<p>Nice.  One can probably create some casting operators between your <code>Dimensionful ‚Ñù d</code> and my <code>Scalar d</code> that render them functionally equivalent, but your framework also allows for vector-valued dimensionful quantities, such as velocity and (vector-valued) momentum, which is of course useful (in my framework one would have to take the tensor product of <code>Speed</code> with <code>Space</code> or something).  </p>\n<p>For your final coercion problem, perhaps one has to replace <code>Coe</code> with <code>CoeOut</code>?  I had a similar issue in a separate project.</p>\n<p>One question is what the use cases would be for dimensionful units.  My API was mostly intended for a situation in which one selects a single unit system (such as SI) to work with, and the main purpose of the API was to ensure that all of one's manipulations remain dimensionally consistent.  Your framework looks like it would be more useful in situations in which one wants to consider multiple unit systems at once (e.g. SI and Planck), and the conversions between them.</p>",
        "id": 530589939,
        "sender_full_name": "Terence Tao",
        "timestamp": 1753370871
    },
    {
        "content": "<blockquote>\n<p>One can probably create some casting operators between your¬†<code>Dimensionful ‚Ñù d</code>¬†and my¬†<code>Scalar d</code>¬†that render them functionally equivalent,</p>\n</blockquote>\n<p>Agreed, although I don't think there will be a canonical way to cast - I think there will be one for each set of units.</p>\n<blockquote>\n<p>For your final coercion problem, perhaps one has to replace Coe with CoeOut? I had a similar issue in a separate project.</p>\n</blockquote>\n<p>I'll have a play around with this - a naive implementation didn't seem to work. </p>\n<blockquote>\n<p>One question is what the use cases would be for dimensionful units. My API was mostly intended for a situation in which one selects a single unit system (such as SI) to work with, and the main purpose of the API was to ensure that all of one's manipulations remain dimensionally consistent. Your framework looks like it would be more useful in situations in which one wants to consider multiple unit systems at once (e.g. SI and Planck), and the conversions between them.</p>\n</blockquote>\n<p>I would say that another difference between the two frameworks is the following: </p>\n<ul>\n<li>In yours the multiplication of a quantity a1 with dimension d1 with a quantity b2 with dimension d2 is defined to have dimension d1 + d2, whilst in mine, it is proved to have dimension d1 + d2.</li>\n</ul>\n<p>But I don't think this affects the use of it. </p>\n<p>With a bias towards PhysLean, I see three main use cases (in addition to the obvious calculation and conversion use cases):</p>\n<ol>\n<li>I think the main one, which both our frameworks do in the same way, is being able to keep track of the dimensions, as you say. Notably, you don't need to create a new API every time you want a quantity with a dimension you've never used before - I can see this being very useful.</li>\n<li>Another use case is being able to define constants, for example the speed of light or Planck's constant, and relate them to their numerical value.</li>\n<li>On the more theoretical side, and using the <code>time</code> manifold as an example, let me call it <code>TimeMan</code>. One day (based on previous conversations), it would be nice to have the structure of an <code>AddTorsor</code> on <code>TimeMan</code>, allowing you to take an abstract point in time <code>t1</code> and add e.g. 2 seconds to it, or 1 hour etc to it.</li>\n</ol>",
        "id": 530598651,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753373559
    },
    {
        "content": "<p>With regard to the third application in my list, I've made this <a href=\"https://github.com/HEPLean/PhysLean/pull/660\">PR</a> to PhysLean, with the <a href=\"https://github.com/HEPLean/PhysLean/blob/097cb55575d79e3d0f980086a04117f7569dd211/PhysLean/SpaceAndTime/Time/TimeTransMan.lean\">TimeTransMan.lean</a> file  being the relevant one. </p>\n<p>The idea of this PR is to relate the <code>UnitChoice</code> in my framework above for time (called <code>TimeMetric</code> in the PR) explicitly to the different versions of Time present in PhysLean. I think  probably the docstring of this file explains things better: </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Docstring</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<h1>The time manifold with a transitive action of <code>‚Ñù</code></h1>\n<p>In this module we define the type <code>TimeTransMan</code>. This type physically corresponds to the manifold of time (diffeomorphic to <code>‚Ñù</code>) with the following additional structure:</p>\n<ol>\n<li>a transitive action of <code>‚Ñù</code>,</li>\n<li>a choice of orientation.</li>\n</ol>\n<p>The manifold <code>TimeTransMan</code> is not equipped with a translationally-invariant metric. Such metrics are in one-to-one correspondence (to be shown) with positive reals, and as such we define the type <code>TimeMetric</code> (equivalent to the positive reals) to represent the choice of metric on <code>TimeTransMan</code>.</p>\n<p>From the point of view of physics, this choice of metric corresponds to a choice of units, and we will use the phrase 'units of time' interchangeably 'term of TimeMetric'.</p>\n<p>Given a <code>x : TimeMetric</code>, and the structure above, we can define the following operations on <code>TimeTransMan</code>:</p>\n<ul>\n<li>\n<p><code>diff x t1 t2</code>, for <code>t1 t2 : TimeTransMan</code> gives the signed difference between two points in time in the units <code>x</code>.</p>\n</li>\n<li>\n<p><code>addTime x r t</code>, for <code>r : ‚Ñù</code> and <code>t : TimeTransMan</code>, gives the point in <code>TimeTransMan</code> that seperated from <code>t</code>, by <code>r</code> in the unit <code>x</code>. For example, if <code>x</code> is the unit of seconds, then <code>addTime x 1 t</code> gives the point in <code>TimeTransMan</code> that is one second after <code>t</code>.</p>\n</li>\n</ul>\n<p>Recall that the type <code>Time</code> corresponds to the manifold of time with a<br>\ngiven (but arbitrary) choice of units and origin (and therefore has a structure<br>\nof a module over <code>‚Ñù</code>). Here we define the map:</p>\n<ul>\n<li><code>toTime zero x</code> from <code>TimeTransMan</code> to <code>Time</code> where <code>zero : TimeTransMan</code> is the choice of origin and <code>x : TimeMetric</code> is the choice of units.</li>\n</ul>\n<p>This map is a diffeomorphism (to be shown).</p>\n</div></div>",
        "id": 530795716,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753456173
    },
    {
        "content": "<p>For reference for people who end up reading this thread: I asked this question:</p>\n<ul>\n<li><a class=\"stream-topic\" data-stream-id=\"113488\" href=\"/#narrow/channel/113488-general/topic/A.20general.20proposition.20for.20group.20invariance/with/531990445\">#general &gt; A general proposition for group invariance</a> </li>\n</ul>\n<p>on the <code>general</code> channel of this Zulip. It is framed in terms of <code>group invariance</code> but the principal should carry over to the notion of being <code>dimensionally correct</code>.</p>",
        "id": 531991154,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753943428
    },
    {
        "content": "<p>I'm toying around with a simple extensible dimensional analysis framework, i'll keep you updated if i can make it fully work :<br>\n<a href=\"/user_uploads/3121/_COF0-iZDOsUa8Z8GY9JkPdr/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/Zqq9m9T_voPf35gVMxy-FNRu/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/_COF0-iZDOsUa8Z8GY9JkPdr/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"725x736\" src=\"/user_uploads/thumbnail/3121/_COF0-iZDOsUa8Z8GY9JkPdr/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Zqq9m9T_voPf35gVMxy-FNRu/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"877x388\" src=\"/user_uploads/thumbnail/3121/Zqq9m9T_voPf35gVMxy-FNRu/image.png/840x560.webp\"></a></div>",
        "id": 533009869,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754443541
    },
    {
        "content": "<p>Nice <span class=\"user-mention\" data-user-id=\"942100\">@ecyrbe</span>! There is also an implementation (based on the conversation above) of units and dimensions now in PhysLean, see <a href=\"https://github.com/HEPLean/PhysLean/tree/master/PhysLean/Units\">here</a>.</p>",
        "id": 533041171,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754465503
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/533041171\">said</a>:</p>\n<blockquote>\n<p>Nice <span class=\"user-mention silent\" data-user-id=\"942100\">ecyrbe</span>! There is also an implementation (based on the conversation above) of units and dimensions now in PhysLean, see <a href=\"https://github.com/HEPLean/PhysLean/tree/master/PhysLean/Units\">here</a>.</p>\n</blockquote>\n<p>Yes, i took a look at all the solutions. one minor issue, is that adding new dimensions to all of them require to change the libraries. Not big of a deal, but that's why i'm trying this new approach based on Strings.</p>",
        "id": 533053486,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754469934
    },
    {
        "content": "<p>Ah, I see. Could you give me an example of a dimension you would like to add, which would require a change?</p>",
        "id": 533054175,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754470152
    },
    {
        "content": "<p>isn't there only 7 dimensions?</p>",
        "id": 533054441,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754470236
    },
    {
        "content": "<p>In otherwords (as I think Kenny is refering to), I expect the only fundamental dimensions you would ever need are: <br>\nlength, time, mass, charge, and temperature. (Maybe also moles but I personal find that one a bit dubious - but would be happy to implement it if a strong case was made)</p>",
        "id": 533054582,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754470277
    },
    {
        "content": "<p>I'm thinking bigger, not Just for physics. Dimensional analysis is used in other fields. Like Finantial systems, Computer science, etc</p>\n<p>One big inspiration comes from the most complete implementation out there (<a href=\"https://github.com/mpusz/mp-units\">mp_units</a>)</p>",
        "id": 533054946,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754470397
    },
    {
        "content": "<p>So another example would be something like currency?</p>",
        "id": 533075293,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754477397
    },
    {
        "content": "<p>Not a comment on any particular implementation, but something I being thinking about for a while so thought it is worth writing down:</p>\n<p>I think one thing to bear in mind with any implementation of dimensions and units, is the following definitions:</p>\n<p><strong>Definition 1:</strong><br>\nA dimensional quantity is one whose value depends on the choice of units. Such a quantity is said to have a given dimension, if it scales under a change in units in a specific way.</p>\n<p><strong>Definition 2:</strong><br>\nAn expression is dimensionally correct if its validity does not depend on the choice of units. </p>\n<p>In programming languages other than interactive theorem provers (ITP), to work with units it is sufficient to: </p>\n<ul>\n<li>Come up with a system which keeps track of  dimensions, and ensure you have dimensional consistency. </li>\n</ul>\n<p>But within an ITP I advocate that one needs more: each  dimensionally correct expression should give you a <em>theorem</em> which you can use. This theorem should correspond to that expression being dimensionally correct and say \"I can use any choice of units in this expression and it will work\".</p>",
        "id": 533077640,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754478313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/533075293\">said</a>:</p>\n<blockquote>\n<p>So another example would be something like currency?</p>\n</blockquote>\n<p>yes, and in stock market, shares would be another one. in such systems, proving your stock market algorithms can be of value and so dimensional analysis also</p>",
        "id": 533079564,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1754478991
    },
    {
        "content": "<p>Random idea: I think it will be nice to have a proof that units multiply (divide) under integration (differentiation). The handwavy way that I know would be to write a Riemann sum for the integral and use first principles for differentiation, but I'm curious what would a more rigorous proof look like.</p>",
        "id": 533293344,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1754573328
    },
    {
        "content": "<p>For the derivative, multiplication and division there are proofs (naturally set up dependent) <a href=\"https://github.com/HEPLean/PhysLean/blob/3c35be22030160ea0294254468cc49535c5d4cbc/PhysLean/Units/Basic.lean#L707\">here</a>. But having integration, and sums in general, would be good.</p>",
        "id": 533295845,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1754574070
    },
    {
        "content": "<p>Hello everyone! I've been learning Lean recently and got interested into applications outside of pure math. I was thinking about physical problems and units, and I found PhysLean has some units defined and some theorems. However, I didn't find any simple example and I'm struggling a bit understanding how it is supposed to be used. Maybe I've missed the example, but I would be thankful of being pointed to it, or otherwise maybe someone can provide me with a bit of insight. Thanks!</p>",
        "id": 534547442,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755199973
    },
    {
        "content": "<p>Hi Izan! There is a precisely a single example here: </p>\n<ul>\n<li><a href=\"https://github.com/HEPLean/PhysLean/blob/58f376b9c52176fc82c902d527c1b85ba714956c/PhysLean/ClassicalMechanics/HarmonicOscillator/Solution.lean#L85\">ClassicalMechanics/HarmonicOscillator/Solution</a></li>\n</ul>\n<p>Units are very new to PhysLean and <span class=\"user-mention\" data-user-id=\"622397\">@Daniel Morrison</span> is working on it improving the API. But in general we are still working out the best way to use it. Any help or ideas , example cases would be very much appreciated :). (Note we are trying to make an API that 'proofs' units and dimensions, not only tracks them - if this makes sense).</p>",
        "id": 534549642,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755201105
    },
    {
        "content": "<p>Thanks Joseph! Will take a look at it :)</p>",
        "id": 534635638,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755256014
    },
    {
        "content": "<p>Hi, I have a question about units in PhysLean, when you define</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LengthUnit</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The underlying scale of the unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span>\n<span class=\"w\">  </span><span class=\"n\">property</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">val</span>\n</code></pre></div>\n<p>and then<br>\n<code>axiom meters : LengthUnit</code></p>\n<p>Could you just have defined meters as <code>‚ü®1, by norm_num‚ü©</code>?</p>\n<p>I guess it is a decision to avoid meters being just a wrapper of some numbers but an actual \"concept\"? Like you always need to work in terms of meters (or some function of meters)?</p>\n<p>I'd like to hear from the authors :)</p>",
        "id": 534907020,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755509050
    },
    {
        "content": "<p>Arguably that should be <code>opaque</code> not <code>axiom</code></p>",
        "id": 534907383,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755509166
    },
    {
        "content": "<p>That makes sense from my little understanding of it, it will have the same effect without having extra assumptions, right?</p>",
        "id": 534913623,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755511194
    },
    {
        "content": "<p>So here is my philosophy.</p>\n<p>Let <code>LengthMetric</code> represent translationally and rotationally invariant metrics on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span>. <br>\nA choice of  an element in <code>LengthMetric</code> is what really represents a unit of length, but there is no canonical choice. In the real world we historically choose it by  using some reference stick.  Mathematically I would see no other way here than by using an axiom, either the axiom of choice or another custom axiom (as we have done). <br>\nThe type <code>LengthMetric</code> is not yet in PhysLean (it's open if anyone wants to do this!). </p>\n<p>Currently <code>LengthUnit</code> can be seen as a place-holder for <code>LengthMetric</code>. Here is where it gets a bit tricky. <br>\nThe  equivalence between <code>LengthUnit</code> and <code>LengthMetric</code> depends on a choice of metric (or unit). </p>\n<p>Until <code>LengthMetric</code> is defined, which I beleive will remove all ambiguity here, there are two choices:</p>\n<ol>\n<li>Assume the equivalence from <code>LengthUnit</code> and <code>LengthMetric</code> to be defined through meters.  In which case <code>meters</code> in <code>LengthUnit</code> should be defined through <code>‚ü®1, by norm_num‚ü©</code>. In this case, once <code>LengthMetric</code> is defined, an axiom would then need to be introduced for <code>meters</code> in <code>LengthMetric</code>. I.e. it moves the use of an axiom (either the axiom of choice or something else) to a latter date. </li>\n<li>Consider the equivalence from <code>LengthUnit</code> and <code>LengthMetric</code> to be define through some arbitrary choice of unit, and for now axiomize <code>meters</code> in <code>LengthUnit</code>. </li>\n</ol>\n<p>These are two different design decisions, which I believe will converge in the end. With good documentation it shouldn't matter which is chosen. (I am not claiming that the documentation there is good - I wrote it :))</p>",
        "id": 534914807,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755511572
    },
    {
        "content": "<p>(If someone has the time, and they agree with what I have written above, it would help to create a TODO item (see <a href=\"https://physlean.com/GettingStarted.html#writing-results\">this</a>) in <a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/SpaceAndTime/Space/LengthUnit.lean\">this file</a> regarding the definition of <code>LengthMetric</code>).</p>",
        "id": 534918137,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755512771
    },
    {
        "content": "<p>The advantage of <code>opaque</code> over <code>axiom</code> is that it doesn't raise any soundness questions, and <code>#print axioms</code> doesn't track it</p>",
        "id": 534918373,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755512856
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I actually like the fact that <code>#print axioms</code> tracks it - because it is in a sense tracking what things from the real-world are used. But your point about soundness outweighs any positive I can think of. A solution that might work for <code>LengthMetric</code> in the end, is to just use Classical.choose, and maybe this is the way we should go for <code>LengthUnit</code>, for the time-being, or just swap to <code>‚ü®1, by norm_num‚ü©</code> with the appropriate modification of the docs.</p>",
        "id": 534920190,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755513556
    },
    {
        "content": "<p>I think \"used\" is a strong term here though; if I define <code>def radians := meters / meters</code> did I \"use\" meters?</p>",
        "id": 534920468,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755513676
    },
    {
        "content": "<p>Yeah, ok, there is probably some better way to phrase it</p>",
        "id": 534921012,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755513877
    },
    {
        "content": "<p>I see, thanks Joseph and Eric!</p>\n<p>I have also been looking at the example solution of the Harmonic Oscillator. So as you mentioned before, \"API that 'proofs' units and dimensions, not only tracks them\". So we would be separately proving theorems with no units about the equations, etc, and then prove some facts about the units?<br>\nI see right now <code>solDim</code> is defined, and there is a future lemma <code>solDim_eq_sol</code> to be formalized and proven.</p>\n<p>In contrast, I've seen Terence Tao's posts about units, and he has examples like<br>\n<code>example (first_law : F = m * a) (hm : m = 2 ‚Ä¢ kilogram) (ha : a = 3 ‚Ä¢ meter / second**2) : F = 6 ‚Ä¢ newton</code></p>\n<p>Are you expecting to provide such capabilities in the future, also working with vectors etc?</p>",
        "id": 534923750,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755514802
    },
    {
        "content": "<blockquote>\n<p>So we would be separately proving theorems with no units about the equations, etc, and then prove some facts about the units?</p>\n</blockquote>\n<p>Ideally the API should be good enough that you essentially get the theorems about units for free or very easily, without having to do much extra work. Ideally in that example we wouldn't need <code>solDim</code> and <code>sol</code> itself would contain the dimensions - just not sure how to make this all work yet - in a nice way that gives you usable theorems :). </p>\n<p>Concerning Tao's examples, one can do e.g.:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">PhysLean</span><span class=\"bp\">.</span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">Mass</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">UnitChoices</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NNReal</span>\n\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">newtons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Mùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ofUnit</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">SI</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">kilograms</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">Mùì≠</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ofUnit</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">SI</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mPerSecond</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ofUnit</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">SI</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Mùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"n\">Mùì≠</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">mul</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">first_law</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">kilograms</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">mPerSecond</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">newtons</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>among other things - so yes we expect this sort of capabilities. Note in this example, the dimensions are indeed being tracked correctly by Lean. </p>\n<p>One would already be able to define <code>Dimensionful</code> with vectors and work with them in a similar way to the above.</p>",
        "id": 534928227,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755516380
    },
    {
        "content": "<p>What I'm trying to do with units is similar to Tao's example where units can be added to calculations via the scalar multiplication notation.  As Joseph mentioned these kinds of things are technically possible at the moment but are a little cumbersome to use because you need to use several different types. My goal is to move stuff to classes so it can be used implicitly without much thought from the user, how exactly that happens is something to be figured out.</p>",
        "id": 534983784,
        "sender_full_name": "Daniel Morrison",
        "timestamp": 1755533676
    },
    {
        "content": "<p>We've finished a draft of our manuscript on defining dimensions and physical variables in Lean, which may be of interest for this thread. We wanted to post it here to gather feedback from the community and solicit thoughts on its applicability. It's great to see all the researchers interested in Lean!<br>\n<a href=\"/user_uploads/3121/oIo_FCfTIHXArycS__tFaHJB/Formalizing_dimensional_analysis.pdf\">Formalizing_dimensional_analysis.pdf</a></p>",
        "id": 535222467,
        "sender_full_name": "Max Bobbin",
        "timestamp": 1755651967
    },
    {
        "content": "<p>We explored implementing PhysicalVariables as a graded algebra over dimensions, but found the code to be unusable since each physical variable (such as velocity or force) is its own type and requires a large amount of coercion instances to use together in equations.</p>",
        "id": 535224422,
        "sender_full_name": "Max Bobbin",
        "timestamp": 1755653698
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"474115\">Max Bobbin</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535224422\">said</a>:</p>\n<blockquote>\n<p>We explored implementing PhysicalVariables as a graded algebra over dimensions, but found the code to be unusable since each physical variable (such as velocity or force) is its own type and requires a large amount of coercion instances to use together in equations.</p>\n</blockquote>\n<p>hello, can you elaborate on this part ? does it mean afftecting  <code>s^-1 * (m * s) / s</code> to <code>m/s</code> don't work ?</p>",
        "id": 535228378,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1755656756
    },
    {
        "content": "<p>Some quick feedback on the manuscript:</p>\n<ul>\n<li>could you remark on why you chose not use <code> Multiplicative</code> to define <code>Dimension</code>, which give you the group structure for free and eliminates 2.5 pages of work</li>\n<li>Why do you define addition on dimensions at all?</li>\n<li>Could you remark on how you define addition of <code>PhysicalVariable</code>, and what happens if the units mismatch?</li>\n</ul>",
        "id": 535256487,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755675962
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"474115\">@Max Bobbin</span> , just wanted to say well done getting this draft done! I know this is something you all started a fair while ago, and I'm sure it's going to act as a useful reference point in the future, so congrats!</p>",
        "id": 535261892,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1755677864
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">ecyrbe</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535228378\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"474115\">Max Bobbin</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535224422\">said</a>:</p>\n<blockquote>\n<p>We explored implementing PhysicalVariables as a graded algebra over dimensions, but found the code to be unusable since each physical variable (such as velocity or force) is its own type and requires a large amount of coercion instances to use together in equations.</p>\n</blockquote>\n<p>hello, can you elaborate on this part ? does it mean afftecting  <code>s^-1 * (m * s) / s</code> to <code>m/s</code> don't work ?</p>\n</blockquote>\n<p>We tried defining physical variable as a structure that took in a dimension instead of having a dimension as a field (we have this saved on <a href=\"https://github.com/ATOMSLab/LeanDimensionalAnalysis/blob/main/PhysicalVariables/Basic_GradedStructure.lean\">github</a> to check out. We defined the graded structure as a subtype of PhysicalVariable).  A major problem is that the <code>PhysicalVariable (length/time)</code> is a different type than <code>PhysicalVariable (velocity).</code>  This made it very difficult to write a statement like <code>v = x/t</code> . To write such a statement required <code>Coe (PhysicalVariable (length/time)) (PhysicalVariable velocity)</code>. We couldn't write general Coe instances because we ran into a problem with Lean not having a definite output for the Type.</p>",
        "id": 535402140,
        "sender_full_name": "Max Bobbin",
        "timestamp": 1755731061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535256487\">said</a>:</p>\n<blockquote>\n<p>Some quick feedback on the manuscript:</p>\n<ul>\n<li>could you remark on why you chose not use <code> Multiplicative</code> to define <code>Dimension</code>, which give you the group structure for free and eliminates 2.5 pages of work</li>\n<li>Why do you define addition on dimensions at all?</li>\n<li>Could you remark on how you define addition of <code>PhysicalVariable</code>, and what happens if the units mismatch?</li>\n</ul>\n</blockquote>\n<p>After you said that, I remember this suggestion from before. There is no reason we chose not to use Multiplicative, and I think the code would be nicely golfed with Multiplicative. One thing we liked about showing that definition of <code>dimension</code> is offering an example to scientists about defining Types in a similar way the way the Natural numbers are built. We hoped it would give an easily accessible example for scientist to understand how to build these mathematical objects. </p>\n<p>We define addition for dimensions, mainly, so we can define addition for Physical Variables. We define their addition as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"n\">PhysicalVariable</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\">  </span><span class=\"n\">PhysicalVariable</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">PhysicalVariable</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">PhysicalVariable</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">value</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">dim</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">dim</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The other way we found to define addition is to use the graded structure which prevents the dimensions from being different, but we found that formulation to be unuseable for theorems. This definition uses our definition of addition for dimensions. So, if we correctly understand how the Epsilon function works, you could write an equation of <code> velocity + time = force</code> but you wouldn't be able to show the dimensional homogeneity because the addition for dimensions requires it to be the same dimension.</p>",
        "id": 535402934,
        "sender_full_name": "Max Bobbin",
        "timestamp": 1755731646
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"474115\">Max Bobbin</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535402140\">said</a>:<br>\nWe tried defining physical variable as a structure that took in a dimension instead of having a dimension as a field (we have this saved on <a href=\"https://github.com/ATOMSLab/LeanDimensionalAnalysis/blob/main/PhysicalVariables/Basic_GradedStructure.lean\">github</a> to check out. We defined the graded structure as a subtype of PhysicalVariable).  A major problem is that the <code>PhysicalVariable (length/time)</code> is a different type than <code>PhysicalVariable (velocity).</code>  This made it very difficult to write a statement like <code>v = x/t</code> . To write such a statement required <code>Coe (PhysicalVariable (length/time)) (PhysicalVariable velocity)</code>. We couldn't write general Coe instances because we ran into a problem with Lean not having a definite output for the Type.</p>\n</blockquote>\n<p>So does this mean that in your new implementation, we can add two incompatible dimensions and not have an error catched at compile time ?</p>",
        "id": 535478567,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1755773731
    },
    {
        "content": "<p>Yes. It also means that you can't add quantities at runtime any more, as <code>+</code> is noncomputable</p>",
        "id": 535479885,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755774242
    },
    {
        "content": "<p>(it's also non-commutative, so there is no <code>Ring</code> structure on quantities)</p>",
        "id": 535480630,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755774503
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  do you think a custom elaborator could solve the issue ? i think i saw someone try that path in one implementation to do the checks and proven coe generated at compile time</p>",
        "id": 535480703,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1755774531
    },
    {
        "content": "<p>I think we already found the solution, it's <code>unseal Rat.*</code> in</p>",
        "id": 535480733,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755774551
    },
    {
        "content": "<p>But also, <code>velocity = length/time</code> should be rfl anyway, so I think there is something else going wrong here</p>",
        "id": 535481165,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755774722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/535481165\">said</a>:</p>\n<blockquote>\n<p>But also, <code>velocity = length/time</code> should be rfl anyway, so I think there is something else going wrong here</p>\n</blockquote>\n<p>yes, in my own implementation, this works, definitely something else going on.</p>",
        "id": 535481357,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1755774795
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"657719\">Terence Tao</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/530589939\">said</a>:</p>\n<blockquote>\n<p>Nice.  One can probably create some casting operators between your <code>Dimensionful ‚Ñù d</code> and my <code>Scalar d</code> that render them functionally equivalent, but your framework also allows for vector-valued dimensionful quantities, such as velocity and (vector-valued) momentum, which is of course useful (in my framework one would have to take the tensor product of <code>Speed</code> with <code>Space</code> or something).  </p>\n<p>For your final coercion problem, perhaps one has to replace <code>Coe</code> with <code>CoeOut</code>?  I had a similar issue in a separate project.</p>\n<p>One question is what the use cases would be for dimensionful units.  My API was mostly intended for a situation in which one selects a single unit system (such as SI) to work with, and the main purpose of the API was to ensure that all of one's manipulations remain dimensionally consistent.  Your framework looks like it would be more useful in situations in which one wants to consider multiple unit systems at once (e.g. SI and Planck), and the conversions between them.</p>\n</blockquote>\n<p>Hi Terence, is there a convenient way to work with vectors and dimensions with your units approach? Also, since it is inside your \"Analysis\" project in the \"Misc\" section, do you plan to keep improving it? Or is it just an exercise on formalizing units? Thanks!</p>",
        "id": 535530665,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755790636
    },
    {
        "content": "<p>Given all the other efforts now to formalize units in Lean, I do not have plans to significantly expand my current code, which I was indeed viewing as an exercise.</p>\n<p>As for vector valued dimensional quantities, one could simply create an API for <code>Vector X := Fin 3 ‚Üí X</code> that might be good for creating, e.g., <code>Vector Length</code>, <code>Vector Momentum</code>, etc. (and then develop further API for covectors (axial vectors), etc. perhaps) with typechecking that \"just works\", but I haven't put much thought into this.  One could also try to use the <code>TensorProduct</code> API already in Mathlib, but the lack of defeq, e.g., between <code>X ‚äó Y</code> and <code>Y ‚äó X</code>, would be annoying.</p>",
        "id": 535532701,
        "sender_full_name": "Terence Tao",
        "timestamp": 1755791311
    },
    {
        "content": "<p>Happy to announce some progress on my compile time checked dimensional analysis framework library.<br>\ntook inspiration from <span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span>  ideas.<br>\nAll formal proofs have been done making my Dimension implementation a AddCommGroup. Allowing to use <code>module</code> tactic to cast seemlessly if it's provable.<br>\nHere an exemple :</p>\n<p><a href=\"/user_uploads/3121/w_FqnuB4MVeP_4fVswyRYHe-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/w_FqnuB4MVeP_4fVswyRYHe-/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"977x349\" src=\"/user_uploads/thumbnail/3121/w_FqnuB4MVeP_4fVswyRYHe-/image.png/840x560.webp\"></a></div><p>If cast fails, you are sure it's incompatible :<br>\n<a href=\"/user_uploads/3121/D5ApmLgEIMJmJr-68iqnxY2r/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/D5ApmLgEIMJmJr-68iqnxY2r/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"546x69\" src=\"/user_uploads/thumbnail/3121/D5ApmLgEIMJmJr-68iqnxY2r/image.png/840x560.webp\"></a></div>",
        "id": 535897469,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756036169
    },
    {
        "content": "<p>And you can define new dimensions on the fly, and mix them with previously defined ones, and it works without touching the base framework :</p>\n<p><a href=\"/user_uploads/3121/arqOvn3MDznrKOZZ4bW3ZZln/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/arqOvn3MDznrKOZZ4bW3ZZln/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"724x131\" src=\"/user_uploads/thumbnail/3121/arqOvn3MDznrKOZZ4bW3ZZln/image.png/840x560.webp\"></a></div>",
        "id": 535901106,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756040596
    },
    {
        "content": "<p>next step, i'll define properly ISO-80000 for system of quantities and hierarchical quantities (meaning, even if dimensions are equal, they may not be of the same kind and you don't want to mix them, like altitude and width should not be mixed together even if they have the same dimension)</p>",
        "id": 535901494,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756041095
    },
    {
        "content": "<p>To make this possible, under the hood, Dimensions are a normalized list of Bases that are pretty much just string and non null exponents :<br>\n<a href=\"/user_uploads/3121/Ait9OXPLK9VtnId9-nIXo192/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/JzKVfm7t0mDmYNvEXxVL-HIc/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/_q_EYa_AngVaVuqawHtodG6a/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Ait9OXPLK9VtnId9-nIXo192/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"295x147\" src=\"/user_uploads/thumbnail/3121/Ait9OXPLK9VtnId9-nIXo192/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/JzKVfm7t0mDmYNvEXxVL-HIc/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"289x61\" src=\"/user_uploads/thumbnail/3121/JzKVfm7t0mDmYNvEXxVL-HIc/image.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/_q_EYa_AngVaVuqawHtodG6a/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"414x127\" src=\"/user_uploads/thumbnail/3121/_q_EYa_AngVaVuqawHtodG6a/image.png/840x560.webp\"></a></div>",
        "id": 535902543,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756042069
    },
    {
        "content": "<p>hardest part, was proving that this form a AddCommGroup</p>",
        "id": 535902656,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756042197
    },
    {
        "content": "<p>I think you could save yourself some effort by defining <code>Dimension := DFinsupp String (fun _ =&gt; Rat)</code></p>",
        "id": 535903326,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756042954
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 535903345,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756042983
    },
    {
        "content": "<p>Thanks Eric, i'm not familiar with DFinsupp, i'll take a look. if it can make the proofs easier, i'm all for it;</p>",
        "id": 535903423,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756043088
    },
    {
        "content": "<p>Notably you get the AddCommGroup structure for free</p>",
        "id": 535903501,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756043172
    },
    {
        "content": "<p>Yours is probably computationally faster though</p>",
        "id": 535903518,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756043195
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  i created a new Dimension based on DFinsupp, works like a charm.<br>\n<a href=\"/user_uploads/3121/B8eof2sqhbftlC7Uz9EO-RCf/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/B8eof2sqhbftlC7Uz9EO-RCf/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"556x314\" src=\"/user_uploads/thumbnail/3121/B8eof2sqhbftlC7Uz9EO-RCf/image.png/840x560.webp\"></a></div><p>no more proofs needed, like you said all free, just one thing is that i had to make an unsafe Repr (like DFinsupp does) while mine was not.</p>",
        "id": 535909010,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756049321
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/c4kCuM6GQNx-oquYg6ax50jP/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/c4kCuM6GQNx-oquYg6ax50jP/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"853x608\" src=\"/user_uploads/thumbnail/3121/c4kCuM6GQNx-oquYg6ax50jP/image.png/840x560.webp\"></a></div>",
        "id": 535909145,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756049456
    },
    {
        "content": "<p>You should be able to make a safe one with .support.sort</p>",
        "id": 535912817,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756053816
    },
    {
        "content": "<p>But also, because you're using abbrev you shouldn't define that instance</p>",
        "id": 535912837,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756053832
    },
    {
        "content": "<p>Probably you should make a one-field structure instead</p>",
        "id": 535912860,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756053847
    },
    {
        "content": "<p>Then you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Equiv.addCommGroup#doc\">docs#Equiv.addCommGroup</a> to pull across that structure, and be free to define your own repr</p>",
        "id": 535912882,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756053869
    },
    {
        "content": "<p>(also, consider posting with <a href=\"https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks\">#backticks</a> rather than screenshots)</p>",
        "id": 535912932,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756053918
    },
    {
        "content": "<p>All this make sence; thanks for the kind advices</p>",
        "id": 535912970,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756053958
    },
    {
        "content": "<p>I'll remind you that your initial implementation is probably faster; though I think <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> has a (D)Finsupp alternative for hashable types that might be even faster here</p>",
        "id": 535913043,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756054060
    },
    {
        "content": "<p>Yes, mine is certainly faster, i'll measure for sure.  i may provide both implementations if it's that bad.<br>\nThey have the same user surface level API and are compatible. So i don't worry too much.</p>",
        "id": 535914154,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756055383
    },
    {
        "content": "<p>I think i'll keep DFinsupp, it's kind of magical to compose Dimensions into higher Opaque Hierachical Unit system.<br>\nI can now define a unit as :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"n\">impl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DFinsupp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">defineUnit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">DFinsupp</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">DFinsupp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ü®</span><span class=\"n\">Unit</span><span class=\"bp\">._</span><span class=\"n\">impl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instAddCommGroup</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">instEquiv</span><span class=\"bp\">.</span><span class=\"n\">addCommGroup</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">dimension</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">u</span><span class=\"bp\">._</span><span class=\"n\">impl</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">qd</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">qd</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Here a starting preview or units definition :<br>\n<a href=\"/user_uploads/3121/9jBePsG-MgVnrZwfyWQh8Uwm/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/9jBePsG-MgVnrZwfyWQh8Uwm/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"743x356\" src=\"/user_uploads/thumbnail/3121/9jBePsG-MgVnrZwfyWQh8Uwm/image.png/840x560.webp\"></a></div>",
        "id": 535927167,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756070084
    },
    {
        "content": "<p>i may rename <code>Unit</code> into QuantityRef to say that it's a ISQ reference from a unit of choice into a dimension.<br>\nit's the name used in c++ mp_units</p>",
        "id": 535927601,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756070714
    },
    {
        "content": "<p>You then build quantities on top of it, since it works like dimension themselves</p>",
        "id": 535927637,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756070774
    },
    {
        "content": "<p>One cool thing is that now, with this system, we can prevent adding Becquerel and Frequency quantities, because even if they have the same dimension, we can define them as opaque different units.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Hz</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineUnit</span><span class=\"w\"> </span><span class=\"s2\">\"Hz\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Bq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">defineUnit</span><span class=\"w\"> </span><span class=\"s2\">\"Bq\"</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>same dimension, but not addable by default. i'll try to come up with an escape hatch to allow it (maybe something like strong cast)</p>",
        "id": 535928835,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756072459
    },
    {
        "content": "<p>I don't understand the intent of your Unit type, what does <code>2*m +s</code> mean?</p>",
        "id": 535932025,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1756076594
    },
    {
        "content": "<p>it's a reference, they form a hierarchy in ISO 80000<br>\nSo it's just an abstraction over dimensions to say you have chosen a metric for a dimension.<br>\nSeconds for Time, Kilograms for Mass, etc<br>\nThe confusion may come because we have chosen to represent Dimension and Quantities Reference as a AddCommGroup instead of a CommGroup (because there is no good tactic that work on CommGroup only, so it was better to represent them like that to leverage on Mathlib power)<br>\nSo here we are not dealing with quantities, yet. Just Dimension Abstractions.</p>\n<p>Here a less confusing application once we work on quantities with proper operators :<br>\n<a href=\"/user_uploads/3121/jvJCDgOEdx8A2UnXxk1Eyt7z/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jvJCDgOEdx8A2UnXxk1Eyt7z/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"888x643\" src=\"/user_uploads/thumbnail/3121/jvJCDgOEdx8A2UnXxk1Eyt7z/image.png/840x560.webp\"></a></div>",
        "id": 535933885,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756079000
    },
    {
        "content": "<p>And i encourage anyone interrested in how to properly implement Physical Units to take a look at the most advanced implementation out there  that will be standardized by C++ ISO commity.<br>\nThey explain pretty well what are System of Quantities in their docs, and why they are needed:<br>\n<a href=\"https://mpusz.github.io/mp-units/latest/users_guide/framework_basics/systems_of_quantities/\">https://mpusz.github.io/mp-units/latest/users_guide/framework_basics/systems_of_quantities/</a></p>",
        "id": 535934826,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756080159
    },
    {
        "content": "<p>New exemple, you want to work on electron volts. it's another system of metric. and don't want to have implicit conversion between eV and Joules (that could be bad if not taken care of)<br>\nHaving this hierarchy in place allows to force some kind of explicit conversion if someone want to work with both at the ame time.<br>\n<a href=\"/user_uploads/3121/MZ1jAACbRNw-HmLPUSKYXa5D/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/MZ1jAACbRNw-HmLPUSKYXa5D/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"887x333\" src=\"/user_uploads/thumbnail/3121/MZ1jAACbRNw-HmLPUSKYXa5D/image.png/840x560.webp\"></a></div>",
        "id": 535938001,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756083182
    },
    {
        "content": "<p>Conversion system is now in place. This is starting to look very good. i'll publish the full source code soon :<br>\n<a href=\"/user_uploads/3121/LMmVIzJnw0KDivfW1_Dlbpv-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/LMmVIzJnw0KDivfW1_Dlbpv-/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1004x626\" src=\"/user_uploads/thumbnail/3121/LMmVIzJnw0KDivfW1_Dlbpv-/image.png/840x560.webp\"></a></div>",
        "id": 536130409,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756167646
    },
    {
        "content": "<p>A high-level question I wanted to ask about: in PhysLean, time is semantically distinct from distance, and their implementations are rather different (according to this <a href=\"#narrow/channel/479953-PhysLean/topic/Space.2C.20Time.20and.20SpaceTime.20API/with/533565131\">topic</a>). But in dimensional analysis, there is no distinction. I wonder how these might ultimately be stitched together.</p>",
        "id": 536246241,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756217389
    },
    {
        "content": "<p>Would you mind providing more detail about what you mean by:</p>\n<blockquote>\n<p>But in dimensional analysis, there is no distinction.</p>\n</blockquote>\n<p>Are you thinking about natural units where time and space are treated the same due to the speed of light being set to 1, or something else?</p>",
        "id": 536246845,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756217554
    },
    {
        "content": "<p>(I should also add a note that we are refactoring <code>Space</code> to make it more like the implementation of <code>Time</code>, this is taking place <a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/SpaceAndTime/Space/SpaceStruct.lean\">here</a>)</p>",
        "id": 536247273,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756217687
    },
    {
        "content": "<p>Interesting! I'm not referring to natural units - mainly about dimensions on this, not units. I feel like time and space are rather different in their internal structure / their semantics, but one treats them the same when doing dimensional analysis math (or handling any of the ISQ dimensions, FWIW). We might first be dealing with this in time and space, but I anticipate it will come up more often. For instance, electric current is the ISQ dimension, but I wonder if you'd rather define what an electron is, first (alongside the other fundamental particles, their relationships to one another, etc.), define what its charge is, then link it to time to <em>derive</em> the ISQ dimension. I also wonder about temperature, too.</p>",
        "id": 536248036,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756217933
    },
    {
        "content": "<p>Indeed, <code>Space d</code> abstracting over <code>`EuclideanSpace</code> has no parallel of <code>Time d</code> abstracting over <code>EuclideanTime</code>. <code>SpaceStruct d</code> representing <code>d</code> dimensional Euclidean space seems cleaner, indeed. Nice!</p>",
        "id": 536249056,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756218209
    },
    {
        "content": "<blockquote>\n<p>I wonder if you'd rather define what an electron is, first (alongside the other fundamental particles, their relationships to one another, etc.), define what its charge is, then link it to time to¬†<em>derive</em>¬†the ISQ dimension.</p>\n</blockquote>\n<p>This is certainly the way I would like things to be done in PhysLean, i.e. dimensions should be defined and connected to the actual physical choices they correspond to, and this is currently the set up of dimensions within PhysLean (although much of the nitty-gritty detail is left as a TODO, and there is much to be refined). This is somewhat related to this message of mine above:</p>\n<p><a class=\"message-link\" href=\"/#narrow/channel/479953-PhysLean/topic/physical.20units/near/533077640\">#PhysLean &gt; physical units @ üí¨</a> </p>\n<p>For what it's worth I view dimensions and units as a two sided problem: </p>\n<ol>\n<li>Define/derive the physical origin and meaning of the notion of a dimension. </li>\n<li>Come with a system to effectively and efficiently track dimensions and convert between units.</li>\n</ol>\n<p>Much of the conversation here has focused on (2) - which is great because this is perhaps the most useful part. Long term in PhysLean we need both (1) and (2) and them connected well.</p>",
        "id": 536251916,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756218916
    },
    {
        "content": "<p>You can't define and link Dimensions based on theories that are underlying it. <br>\nBecause there is no one true theory in physics. Dimensional Analysis is an abtraction and i think it should be kept like that. It helps state and prove theorems based on some theories axioms. So we should keep them appart. This way you'll be able to build different theories, state some truth about them if you consider the theory axioms true. An if needed, at the proper hierachy level use dimensional analysis to cheack your statements are at least sound.</p>",
        "id": 536252684,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756219106
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/536251916\">said</a>:</p>\n<blockquote>\n<p>For what it's worth I view dimensions and units as a two sided problem: </p>\n<ol>\n<li>Define/derive the physical origin and meaning of the notion of a dimension. </li>\n<li>Come with a system to effectively and efficiently track dimensions and convert between units.</li>\n</ol>\n<p>Much of the conversation here has focused on (2) - which is great because this is perhaps the most useful part. Long term in PhysLean we need both (1) and (2) and them connected well.</p>\n</blockquote>\n<p>Nice! I like the way you're framing this. This more cleanly divides the syntax and semantics. I was trying to articulate a question like (1) here, what will this look like? The closest thing I've seen in the various implementations is to essentially: someone builds an implementation of (2) (aka syntax), and then says \"now let's define the ISQ dimensions\" (making the jump to semantics).</p>",
        "id": 536254828,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756219710
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">ecyrbe</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/536252684\">said</a>:</p>\n<blockquote>\n<p>You can't define and link Dimensions based on theories that are underlying it.<br>\nBecause there is no one true theory in physics. Dimensional Analysis is an abtraction and i think it should be kept like that. It helps state and prove theorems based on some theories axioms. So we should keep them appart. This way you'll be able to build different theories, state some truth about them if you consider the theory axioms true. An if needed, at the proper hierachy level use dimensional analysis to cheack your statements are at least sound.</p>\n</blockquote>\n<p>Agreed! What's clearer to me, now, is that even defining ISQ (without any deeper connections) is already breaking away from that abstraction, and linking this to semantics. Eventually, we'll want the broader physical theories to be \"linkable\" to the dimensional analysis syntax, but they wouldn't be used to derive the math of dimensional analysis. A deeper theory might be used to derive the ISQ base dimensions, though. But different theories might implement that differently, for instance, depending on how fundamental that theory considers temperature to be.</p>",
        "id": 536256269,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756220159
    },
    {
        "content": "<blockquote>\n<p>I was trying to articulate a question like (1) here, what will this look like?</p>\n</blockquote>\n<p>To me it looks like a file like:</p>\n<ul>\n<li><a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/SpaceAndTime/Time/TimeUnit.lean\">https://github.com/HEPLean/PhysLean/blob/master/PhysLean/SpaceAndTime/Time/TimeUnit.lean</a> </li>\n</ul>\n<p>for each unit, which is the origin of the non-canonical choice that one has to make, and which corresponds to the units. This is what covers (1), and then a file like:</p>\n<ul>\n<li><a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/Units/Basic.lean\">https://github.com/HEPLean/PhysLean/blob/master/PhysLean/Units/Basic.lean</a></li>\n</ul>\n<p>which defines the notion of a dimension formally based on quantities which whose values depend on those non-canonical choices. This can then be fed into an implementation like (2), ideally it should be possible to go back from (2) to (1) though, and make consequential lemmas about the choices made.</p>\n<p>Again all of this in PhysLean is very much open to improvement, and is more a framework of how things could look, then set-in-stone.</p>",
        "id": 536257874,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756220652
    },
    {
        "content": "<p>I'm in the process of cleaning my take on Dimensional Analysis and publish the source code. I took inspiration from Terrence Tao implementation.<br>\nYou can just work on Dimensional system (without ISQ) and have an abtract Formal Quantity system based on AddMonoidAlgebra. All decorelated from the practical Unit system.</p>",
        "id": 536260548,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756221478
    },
    {
        "content": "<p>Hello i just published the source code of Lean-Units framework :<br>\n<a href=\"https://github.com/ecyrbe/lean-units\">https://github.com/ecyrbe/lean-units</a></p>",
        "id": 536320513,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756247177
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span>  what's a good (simple) lemma you proved using physlean dimensional analysis that i can check also against my library ? So that i can have a basic idea if it can be of any help for formal physics.</p>",
        "id": 536423969,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756302264
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"942100\">@ecyrbe</span> , I don't have any simple examples, mainly because we are trying to tie things (as implicitly as possible) into the more core definitions within PhysLean, and as <span class=\"user-mention\" data-user-id=\"622397\">@Daniel Morrison</span>  pointed out above  that will probably involve going over to a type-class approach. I.e. we haven't worked out the best way to do (2) (in my list above) within PhysLean, which makes it hard to give examples which could be compared with your implementation.</p>",
        "id": 536428960,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756303656
    },
    {
        "content": "<p>(By a type-class approach I mean something along the lines of terms of type <code>M</code> is assigned a dimension through an instance of a type-class on <code>M</code>, rather then making a special types which are explicitly defined to carry dimensions (e.g. <code>SI T</code> say). )</p>",
        "id": 536429597,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756303824
    },
    {
        "content": "<p>Thank you very much. <br>\nSo, i'll try to do some basic things then that i have in my old grad books</p>",
        "id": 536431546,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756304357
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">ecyrbe</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/536423969\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span>  what's a good (simple) lemma you proved using physlean dimensional analysis that i can check also against my library ? So that i can have a basic idea if it can be of any help for formal physics.</p>\n</blockquote>\n<p>Conceptually, I think your simple E = m*c^2 idea is a good place to start. <a href=\"https://github.com/ecyrbe/lean-units/blob/9fb70fb0a7a1e6ad74274cd02be94803438d1c37/Examples/formal.lean#L17\">https://github.com/ecyrbe/lean-units/blob/9fb70fb0a7a1e6ad74274cd02be94803438d1c37/Examples/formal.lean#L17</a></p>\n<p>FWIW, while <span class=\"user-mention\" data-user-id=\"474115\">@Max Bobbin</span> was working on his implementation, we had a version we were pretty happy with. I then suggested he try, as a stretch goal, the Lennard-Jones potential, since we implemented that <a href=\"https://arxiv.org/abs/2505.09095\">here</a>. My original ask was \"can you literally take our <a href=\"https://github.com/ATOMSLab/LeanLJ/blob/7ef4fe84a4f29a502663a55daa2358e893df83b3/LeanLJ/Function.lean#L71\">Real-valued function</a> (without the <code>if</code> and <code>else</code> complication), somehow attribute dimensions to the variables on the right-hand-side, and write a theorem <em>about</em> the dimensions of the LJ <em>function</em>.\" That turned out to be too hard. But we settled for something less elegant - can we define a new version of the LJ function, in which we specify the dimensions of the RHS variables in the function, and then do that? While tackling this, he realized some issues with his old implementation (I forget exactly, it might have been related to handling <code>energy</code> - <code>energy</code> [=] <code>energy</code>), and refactored the code into its current state. We're in the process of one more refactor of that section, but the simplest theorem in that area is <a href=\"https://github.com/ATOMSLab/LeanDimensionalAnalysis/blob/0e5c2e2b1aa94adab422914743868986767c5785/PhysicalVariables/LennardJones.lean#L19\">here</a> - essentially that, for the function <code>LJ</code> whose RHS has dimensional variables, prove that when $r$ = $\\sigma$, LJ = 0 (with dimensions of energy).</p>",
        "id": 536432240,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1756304549
    },
    {
        "content": "<p>As an example of the sort of thing I think  PhysLean would end up needing</p>\n<p>(This assumes some contents from <a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/Units/Basic.lean\">this file</a>)</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## CarrysDimension</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">HasDimension'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoices</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoices</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">UnitChoices.dimScale</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CarriesDimension.d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">u1</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Dimensionful'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UnitChoices</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">HasDimension'</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">}</span>\n\n<span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">DMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M1</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"w\"> </span><span class=\"n\">M3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"n\">M1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"n\">M3</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"kd\">extends</span><span class=\"w\"> </span><span class=\"n\">HMul</span><span class=\"w\"> </span><span class=\"n\">M1</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"w\"> </span><span class=\"n\">M3</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mul_dim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m1</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful'</span><span class=\"w\"> </span><span class=\"n\">M1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimensionful'</span><span class=\"w\"> </span><span class=\"n\">M2</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">HasDimension'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m1</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m2</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n\n<span class=\"cm\">## WithDim</span>\n\n<span class=\"cm\">WithDim is the type `M` which carrying the dimension `d`.  But one could assign</span>\n<span class=\"cm\">the instance `CarriesDimension` to any type.</span>\n\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">WithDim</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x1.val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x2.val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x1</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x2</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">smul</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">m.val</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">smul_val</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">m.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CarriesDimension</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">carriesDimension_d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"bp\">‚â•</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">CarriesDimension.d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">hMul</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">‚ü®</span><span class=\"n\">m1.val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m2.val</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">withDim_hMul_val</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m1.val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m2.val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n\n<span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">DMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">d2</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mul_dim</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"w\"> </span><span class=\"n\">u2</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">m1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">m2</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">u1</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">smul_smul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">congr</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lùì≠</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Tùì≠</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">m1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m2</span>\n\n<span class=\"kd\">end</span><span class=\"w\"> </span><span class=\"n\">WithDim</span>\n</code></pre></div>\n</div></div>\n<p>One would have to more manually build the API then other implementations, but everything is done by actual proofs (e.g. in <code>DMul</code>), and otherwise tracked by typeclasses.</p>",
        "id": 536454095,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756310905
    },
    {
        "content": "<p>See I cleaned up the PhysLean version of units based on the above in <a href=\"https://github.com/HEPLean/PhysLean/pull/718\">PhysLean#718</a>. </p>\n<p>But also, <span class=\"user-mention\" data-user-id=\"942100\">@ecyrbe</span> , I think it may be possible to combine your implementation with the one in PhysLean, and get the best of both worlds.</p>\n<p>For example, your type <code>Dimension</code> is defined as </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"n\">impl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DFinsupp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>While PhysLean's is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The length dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The time dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The mass dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The charge dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">charge</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The temperature dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">temperature</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n</code></pre></div>\n<p>So we could just combine and do: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The length dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The time dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The mass dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The charge dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">charge</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The temperature dimension. -/</span>\n<span class=\"w\">  </span><span class=\"n\">temperature</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- Other dimensions based on strings.  -/</span>\n<span class=\"w\">  </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DFinsupp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Similarly your type <code>Quantity</code> is the same as PhysLean's type <code>WithDim</code>. Let me know what you think? (Not so say I think this is going to be easy - but I think it could be possible).</p>",
        "id": 536551300,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756368279
    },
    {
        "content": "<p>i'm not sure how to transpose HasDimension for <code>others</code> . When working formally, would this mean that you would need to reason differently for <code>others</code> dimensions and <code>length</code> ?</p>",
        "id": 536574072,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756376005
    },
    {
        "content": "<p>I was thinking making a type like <code>OtherUnit</code> defined isomorphic to <code>‚Ñù‚â•0</code>, similar to how <code>TemperatureUnit</code> etc are defined. Then one could define e.g. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The choice of units. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">UnitChoices</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The length unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LengthUnit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The time unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TimeUnit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The mass unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">mass</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MassUnit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The charge unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">charge</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ChargeUnit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The temperature unit. -/</span>\n<span class=\"w\">  </span><span class=\"n\">temperature</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TemperatureUnit</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The other units -/</span>\n<span class=\"w\">  </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">OtherUnit</span>\n</code></pre></div>\n<p>Then given you have restricted to finite support, we could add to <code>dimScale</code> a factor which depends on these other units. Then (I think) everything else should follow in exactly the same way  for <code>others</code> and <code>length</code>etc. i.e they wouldn't have to be reasoned about differently. (I agree that if they did then this would defeat the point).</p>",
        "id": 536574912,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756376363
    },
    {
        "content": "<p>In my lib, i can implement as many systems (a system is a choice of dimensions and units) as needed.<br>\nI have of course setup the standard SI system, but for natural unit systems i know it's kind of a complex.</p>\n<p>from the wikipedia page, i see 6 different natural unit systems. is it exhaustive ? are there more ?<br>\nshould i just not pre-define them and let the users implement their own, or would it be convenient if i pre-defined those 6 ? or less ?</p>",
        "id": 536611047,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756388941
    },
    {
        "content": "<p>the wikipedia page : <a href=\"https://en.wikipedia.org/wiki/Natural_units\">https://en.wikipedia.org/wiki/Natural_units</a></p>",
        "id": 536611267,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756389008
    },
    {
        "content": "<p>As an engineer i only work with SI, so i'm kind of lost when it comes to natural units :)</p>",
        "id": 536612860,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756389486
    },
    {
        "content": "<p>I think some of them are probably never used. The one I would recognize as \"natural units\" is the one labelled \"Particle and atomic physics\" in that list.</p>\n<p>BTW is there a specific type for 'a system' (as you describe above) in your implementation? I guess this is something easier in PhysLean's current implementation where the dimension are fixed and one can define a system by just specifying a unit for each dimension (e.g. <a href=\"https://github.com/HEPLean/PhysLean/blob/86f229354767bbd0dbd0a542d68768555af35c53/PhysLean/Units/Basic.lean#L277\">here</a>).</p>",
        "id": 536626236,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756393143
    },
    {
        "content": "<p>Your right to point that out, i have not yet attached anything to the concept of <code>coherent system of units</code>. And i think i should, because if i do, we could create morphisms between them (some would be isomorphic, others not)</p>",
        "id": 536627253,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756393400
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"890057\">ZhiKai Pong</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/533293344\">said</a>:</p>\n<blockquote>\n<p>Random idea: I think it will be nice to have a proof that units multiply (divide) under integration (differentiation). The handwavy way that I know would be to write a Riemann sum for the integral and use first principles for differentiation, but I'm curious what would a more rigorous proof look like.</p>\n</blockquote>\n<p>All a bit of a mess, but <a href=\"https://github.com/HEPLean/PhysLean/pull/718/files#diff-febbab01e1bb53d25471bad8c67029ca51ac9680a481467ca2abdeba7a1a1fe6R67\">here</a> is a <em>proof</em>  that integrals behave as one would expect with regard to dimensions.</p>",
        "id": 536631892,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756394563
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span>  is it Ok for you if i use the lemmas you defined here ? :<br>\n<a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/UnitsSystem.lean\">https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/UnitsSystem.lean</a></p>\n<p>into my library ? i can give credit in the header of the file where i'd use it and in de Readme.md so that nobody thinks i'm the author.</p>",
        "id": 536687564,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756417448
    },
    {
        "content": "<p>The License of my Library is MIT in case this matter</p>",
        "id": 536687697,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756417562
    },
    {
        "content": "<p>Sure, this is fine with me.</p>",
        "id": 536690338,
        "sender_full_name": "Terence Tao",
        "timestamp": 1756419379
    },
    {
        "content": "<p>Was thinking of putting the following comment in the Units file of PhysLean: </p>\n<blockquote>\n<h2>Other implementations of units</h2>\n<p>There are other implementations of units in Lean, in particular:</p>\n<ol>\n<li><a href=\"https://github.com/ATOMSLab/LeanDimensionalAnalysis/tree/main\">https://github.com/ATOMSLab/LeanDimensionalAnalysis/tree/main</a></li>\n<li><a href=\"https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SI.lean\">https://github.com/teorth/analysis/blob/main/analysis/Analysis/Misc/SI.lean</a></li>\n<li><a href=\"https://github.com/ecyrbe/lean-units\">https://github.com/ecyrbe/lean-units</a></li>\n</ol>\n<p>Each of these have their own advantages and specific use-cases.<br>\nFor example both (1) and (3) allow for or work in Floats, allowing computability and the use of <code>#eval</code>. This is currently not possible with the more theoretical implementation here in PhysLean which is based exclusively on Reals.</p>\n</blockquote>\n<p>Do people think this is fair/have anything that could be added?</p>",
        "id": 536732508,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756452494
    },
    {
        "content": "<p>Yes, good note. i'll do the same on mine.</p>",
        "id": 536732687,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756452568
    },
    {
        "content": "<p>I've updated my own file with these links.  I've decided to stop maintaining my own code for units and let it be used freely in other projects of this nature.</p>",
        "id": 536810418,
        "sender_full_name": "Terence Tao",
        "timestamp": 1756480479
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span>  i took some time to check your new examples in physlean, and i see the DimensionInvariant concept and i'm a bit puzzled.<br>\nYou could have just made the equations computed directly on quantities and by the magic of type checking this would have been by definition. Am i missing something ?</p>",
        "id": 537266195,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756813049
    },
    {
        "content": "<p>As an exemple, in my lib :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">e_equal_mc2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">¬≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>is typechecked and so is dimensionally invariant by definition.<br>\nand this one :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">e_equal_mc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"c1\">-- statement is wrong and is directly catched by the type checker</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Don't type check, you can't compile it. And so is not DimensionalInvariant by definition.</p>",
        "id": 537267006,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756813370
    },
    {
        "content": "<p>And using Terence Tao Abstraction, you could have exactly the same for your <code>WithDim</code> quantity abstraction</p>",
        "id": 537267194,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756813445
    },
    {
        "content": "<p>The reason is that in your lib,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">e_equal_mc'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">E</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>does type check, so why is it not 'dimensionally invariant' in your library? </p>\n<p>With PhysLean's implementation you would be able to prove that  <code>e_equal_mc2</code> is dimensionally invariant and <code>e_equal_mc</code> and <code>e_equal_mc'</code> are not.<br>\nThis is because dimensions are defined by how quantities scale under  a change in units.<br>\n It works no matter what tricks the user plays with types or casting, and you get from it a bona-fide theorem which you can apply in proving other theorems. </p>\n<p>This means that with something like <code>IsDimensionalInvariant</code> you can prove derivatives and integrals have certain dimensions, whilst this would be impossible in the sort of implementation you have (as far as I am aware), where it would just have to be defined. </p>\n<p>It is certainly true that type checking and the sort of implementation you have is extremely useful, and with a good API would be able to help prove e.g. <code>IsDiemsionallyInvariant</code> for <code>e_equal_mc2</code> based on the fact it type checks.</p>",
        "id": 537269247,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756814266
    },
    {
        "content": "<blockquote>\n<p>And using Terence Tao Abstraction, you could have exactly the same for your WithDim quantity abstraction</p>\n</blockquote>\n<p>I agree, and this is what we would want, we would want that implementation connected to <code>IsDimensionallyInvariant</code> as well though.</p>",
        "id": 537269420,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756814322
    },
    {
        "content": "<blockquote>\n<p>...does type check, so why is it not 'dimensionally invariant' in your library?</p>\n</blockquote>\n<p>To answer this, in your library the definition of 'dimensionally invariant'  really has two parts to it: </p>\n<ol>\n<li>It type checks. </li>\n<li>You have only used a set of allowed operations which have specially been defined to track and account for dimensions. </li>\n</ol>\n<p>Lean knows about 1, but it does not know about or check for 2, a human has to do this. Both for <code>e_equal_mc2</code> and <code>e_equal_mc'</code>, the first of these hold, but for <code>e_equal_mc'</code> the second does not hold. You could write a theorem for <code>2</code> - and then you are already heading in the direction of the sort of implementation PhysLean has.</p>",
        "id": 537271023,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756814790
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/537269247\">said</a>:</p>\n<blockquote>\n<p>The reason is that in your lib,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">e_equal_mc'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">E</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>does type check, so why is it not 'dimensionally invariant' in your library? </p>\n</blockquote>\n<p>But here you are working on values that are not typed checked, so it's normal. <br>\nIt's the whole point of a unit system (in my point of view) to compute everything using quantities and not values.<br>\nWriting proofs for Dimensional invariance is cumbersome when you can just work with Quantities and have it for free.</p>",
        "id": 537271062,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756814805
    },
    {
        "content": "<blockquote>\n<p>It's the whole point of a unit system (in my point of view) to compute everything using quantities and not values.</p>\n</blockquote>\n<p>But this is not something you can tell or encode into Lean.</p>",
        "id": 537271376,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756814902
    },
    {
        "content": "<blockquote>\n<p>Writing proofs for Dimensional invariance is cumbersome when you can just work with Quantities and have it for free.</p>\n</blockquote>\n<p>I will be the first to admit that writing proofs for dimensional invariance is currently very cumbersome, but this is more a case of building the API I think, and part of that API should be about working with <code>Quantities</code>.</p>",
        "id": 537271589,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756814986
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/537271023\">said</a>:</p>\n<blockquote>\n<p>To answer this, in your library the definition of 'dimensionally invariant'  really has two parts to it: </p>\n<ol>\n<li>It type checks. </li>\n<li>You have only used a set of allowed operations which have specially been defined to track and account for dimensions. </li>\n</ol>\n<p>Lean knows about 1, but it does not know about or check for 2, a human has to do this. Both for <code>e_equal_mc2</code> and <code>e_equal_mc'</code>, the first of these hold, but for <code>e_equal_mc'</code> the second does not hold. You could write a theorem for <code>2</code> - and then you are already heading in the direction of the sort of implementation PhysLean has.</p>\n</blockquote>\n<p>I don't agree, type checking is not based on allowed computations. It's using an automated proof tactic to prove the dimensions are equal (by using module tactic). And lean can perfectly do it.</p>",
        "id": 537271930,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815122
    },
    {
        "content": "<p>That's what cast do. automatically prove that the dimensions are equal</p>",
        "id": 537272171,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815208
    },
    {
        "content": "<p>But for that to work you need to make your Dimensions AddCommGroup instead of CommGroup, like Terence did</p>",
        "id": 537272430,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815301
    },
    {
        "content": "<p>I agree with this, but I don't think this is what I am saying. </p>\n<p>You, as a human, had to tell me that <code>e_equal_mc'</code> wasn't dimensionally invariant, because it depended on values and not quantities. Lean would have let me write down this equation without any problem. </p>\n<p>Let me rephrase this: How would you tell Lean that <code>e_equal_mc'</code>  is not dimensionally invariant?</p>",
        "id": 537272647,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756815381
    },
    {
        "content": "<p>You don't, you work on Quantities all the time ?</p>",
        "id": 537272786,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815430
    },
    {
        "content": "<p>My point is, why would you write your physics equations using values, when you can just use the Quantities?<br>\nEven your examples use quantities abstractions to write the equations and provide a proof manually.<br>\nAnd so why not write the equation directly using the quantities. If it don't type check, it's a proof. That's what Lean does. A proof is just a type checked code. It it don't type check you don't have a proof</p>",
        "id": 537273686,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815720
    },
    {
        "content": "<p>And sorry, it's the other way around, if it type checks, you have a proof. absence of type checking is not a proof it could not type check.</p>",
        "id": 537274148,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815847
    },
    {
        "content": "<p>Maybe that's your point ? But even so, failing to writing a proof manually is not a proof of absence of dimensional invariance</p>",
        "id": 537274347,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756815902
    },
    {
        "content": "<blockquote>\n<p>My point is, why would you write your physics equations using values, when you can just use the Quantities?</p>\n</blockquote>\n<p>But one could say: Why would you write physics equations that are dimensionally incorrect anyway, just write dimensionally correct equations?</p>\n<p>You are trusting the user here to work just with Quantities, which is fine, but this is not something you can encode into Lean. </p>\n<blockquote>\n<p>if it type checks, you have a proof</p>\n</blockquote>\n<p>A proof of what theorem?</p>\n<blockquote>\n<p>But even so, failing to writing a proof manually is not a proof of absence of dimensional invariance</p>\n</blockquote>\n<p>Agreed, but I'm all for automated ways to prove dimensionally invariance too</p>",
        "id": 537274797,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756816047
    },
    {
        "content": "<blockquote>\n<p>You are trusting the user here to work just with Quantities, which is fine, but this is not something you can </p>\n</blockquote>\n<p>I don't get it, to write Dimensional Invariance like you did in physlean, you have to attach dimensions to your values. hence the <code>.1</code> everywhere.</p>\n<div class=\"codehilite\" data-code-language=\"quot\"><pre><span></span><code>&gt; if it type checks, you have a proof\n\nA proof of what theorem?\n</code></pre></div>\n<p>A proof that it that the dimension on the left side is equal to the one on the right side. On Terence Tao, it's even better, you get a proof at each casting operation. So you can have multiple proofs.</p>",
        "id": 537275770,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756816376
    },
    {
        "content": "<p>An the proof is just <code>by module</code></p>",
        "id": 537276072,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756816474
    },
    {
        "content": "<p>And if they are the same, you get dimensional invariance</p>",
        "id": 537277019,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756816786
    },
    {
        "content": "<blockquote>\n<p>I don't get it, to write Dimensional Invariance like you did in physlean, you have to attach dimensions to your values. hence the¬†<code>.1</code>¬†everywhere.</p>\n</blockquote>\n<p>Those <code>.1</code> could be got rid of by defining multiplication between <code>WithDim _ _</code>s, in the same way that you have defined it.  This is just a case of bad API. </p>\n<p>Let me add another equation into the mix: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">e_equal_mc2'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">E</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">¬≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>To me, the following is ture</p>\n<ol>\n<li>Both <code>e_equal_mc2</code> and <code>e_equal_mc2'</code> are both dimensionally valid statements. In that, on changing units the expressions still hold.</li>\n<li>Both <code>e_equal_mc</code> and <code>e_equal_mc'</code> are both dimensionally invalid statements. In particular <code>e_equal_mc</code> does not type-check. </li>\n</ol>\n<p>Thus to me there should be a theorem which is true for <code>e_equal_mc2</code> and <code>e_equal_mc2'</code> and false for <code>e_equal_mc'</code> (let's ignore <code>e_equal_mc</code> as you won't even be able to write it down). That theorem is <code>IsDimensionallyInvariant</code> in PhysLean. </p>\n<p>Now, given your implementation, which is something that could be mapped to <code>WithDim _ _</code> in PhysLean, then <code>IsDimensionallyInvariant  e_equal_mc2</code> should manifestly be true and the proof should ideally be a one-liner. <br>\nBut <code>IsDimensionallyInvariant  e_equal_mc2'</code> should also be true, but since now dimensions aren't being tracked it may be harder to prove this, but it is still possible. </p>\n<p>I also reiterate a point I made earlier, I do not see a way to give derivatives or integrals a notion of dimension in your implementation, without just defining it to be true.</p>",
        "id": 537277575,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756816965
    },
    {
        "content": "<p>BTW if you want to hash this out over Zoom at some point - it may be easier. But no worries if not, also happy to continue here.</p>",
        "id": 537278164,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756817136
    },
    {
        "content": "<p>Yes, i'll try to be there for the next Cafe if i can be available. (i'm in Paris time zone)</p>",
        "id": 537278368,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756817194
    },
    {
        "content": "<p>Will DM you.</p>\n<p>(Edit - cafe organized to discuss this here: <a class=\"message-link\" href=\"/#narrow/channel/479953-PhysLean/topic/The.20PhysLean.20caf.C3.A9/near/537281814\">#PhysLean &gt; The PhysLean caf√© @ üí¨</a> )</p>",
        "id": 537278726,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756817307
    },
    {
        "content": "<p>edit: sorry i wrote some nonsense. we'll discuss on friday</p>",
        "id": 537377854,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756855582
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 537379085,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1756856666
    },
    {
        "content": "<p>[I fixed a mathematical bias of mine in <a href=\"https://github.com/HEPLean/PhysLean/pull/727\">PhysLean#727</a> and have renamed <code>IsDimensionallyInvariant</code> to <code>IsDimensionallyCorrect</code>. Also added more examples based on <code>WithDim</code>, with one-line proofs of <code>IsDimensionallyCorrect</code>]</p>",
        "id": 537423962,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1756887450
    },
    {
        "content": "<p>So here an example of derivative on quantities, one with proof with an abstraction on quantities and one using mathlib :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- proof using Quantities lemmas</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">simp_over_time</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">v0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">deriv_qconst_mul_real</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">deriv_id</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">mul_one</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">differentiable_fun_id</span>\n\n<span class=\"c1\">-- proof using only mathlib lemmas</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">simp_over_time'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">v0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">deriv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"bp\">.</span><span class=\"n\">cast</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">cos</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">deriv_const_mul</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">smul_eq_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">deriv_id''</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">differentiableAt_fun_id</span>\n</code></pre></div>\n<p>And i defined derivative as this (that i think is correct for single base dimensions or units) :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- derivative</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"n\">d‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d‚ÇÇ</span><span class=\"bp\">-</span><span class=\"n\">d‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ü®_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fun_to_val</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">‚ü©</span>\n</code></pre></div>",
        "id": 537919007,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757094044
    },
    {
        "content": "<p>I think i have another way to prove dimensional inviance that feels more natural to write. The idea is to extract dimension information from the Quantities we want to extract.<br>\nMaybe not as powerfull as PhysLean current definition, but feals simpler to me to understand :<br>\n<a href=\"/user_uploads/3121/9PlSAn2RNop5Wo-jX08S8luN/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/9PlSAn2RNop5Wo-jX08S8luN/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"741x165\" src=\"/user_uploads/thumbnail/3121/9PlSAn2RNop5Wo-jX08S8luN/image.png/840x560.webp\"></a></div>",
        "id": 538375690,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757405389
    },
    {
        "content": "<p>You can think of the <code>ùíü</code> symbol as <code>dimension of</code></p>",
        "id": 538375834,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757405442
    },
    {
        "content": "<p>So we just compare dimensions of both sides of the equation.</p>",
        "id": 538375916,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757405469
    },
    {
        "content": "<p>This works on any quantities (units choosen or not)</p>",
        "id": 538376567,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757405681
    },
    {
        "content": "<p>We can still have both defined, since i think mine is less powerful</p>",
        "id": 538377011,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757405825
    },
    {
        "content": "<p>How is it defined? is it something like : </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span>\n</code></pre></div>",
        "id": 538377530,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757405998
    },
    {
        "content": "<p>No, it uses a typeclass, but in the end it derives into something like this transitively</p>",
        "id": 538377686,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757406054
    },
    {
        "content": "<p>The typeclass allows to abstract the notion of dimension, so many stacked layers (in my definition, quantities compute dimension, units compute dimensions and dimensions on dimensions are just identity)</p>",
        "id": 538377979,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757406161
    },
    {
        "content": "<p>that's why there is a <code>simp_dim</code> in there, to apply some rules on computing the dimensions and simplifying them.</p>",
        "id": 538378419,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757406301
    },
    {
        "content": "<p>Ok, this makes sense, thanks for explaining. </p>\n<p>Would the following be provable:?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">wrongMul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">     </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ùìì</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ùìì</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">wrongMul</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>(just trying to understand how things work, and whether or not <code>ùìì</code> cares about what makes up the quantity, or just the type of the final quantity itself).</p>",
        "id": 538380101,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757406753
    },
    {
        "content": "<p>No this would not work. Leaving Quantity <code>universe</code> to build a wronful quantity can't be detected with this. That's why i think we should keep yours also.</p>",
        "id": 538380658,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757406930
    },
    {
        "content": "<p>Ok, good, I understand and I think this is a nice way of phrasing it :). </p>\n<p>Though now I am slightly confused why not defining <code>ùíü</code> as I did above wouldn't work in exactly the same way as you have defined it?</p>",
        "id": 538381458,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757407189
    },
    {
        "content": "<p>I'm explaining further then.<br>\nYou see, you can also want to proove things on units and in my library dimensions on units is a computed property :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">UnitChoice</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">Conversion</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"n\">impl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DFinsupp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\">  </span><span class=\"n\">UnitChoice</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">BEq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">dimension</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">u</span><span class=\"bp\">._</span><span class=\"n\">impl</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">qd</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">qd</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDimension</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dimension</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">dimension</span>\n</code></pre></div>\n<p>but if you work on dimensions (without units, like in my formal example), the dimensions are not computed :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDimension</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dimension</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span>\n</code></pre></div>\n<p>is it clearer ?</p>",
        "id": 538386219,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757408605
    },
    {
        "content": "<p>Ok, I think this is clearer. Thank you for taking the time to explain!</p>",
        "id": 538388014,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757409160
    },
    {
        "content": "<p>Ok, so i made it simpler to proove, now it's just :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">kepler_third_law</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">¬≤</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">4</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">œÄ</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">¬≥/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))))</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_dim</span>\n<span class=\"w\">    </span><span class=\"n\">module</span>\n</code></pre></div>\n<p>after <code>simp_dim</code> the goal becomes :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span>\n<span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span>\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span>\n<span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span>\n<span class=\"bp\">‚ä¢</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>by then, <code>module</code> solves the goal directly</p>",
        "id": 538394918,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757411235
    },
    {
        "content": "<p>After some cleanup, i'll be able to have both working :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">kepler_third_law_dim_check</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Time</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Length</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">¬≤</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">4</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">œÄ</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">¬≥/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))))</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_dim</span>\n<span class=\"w\">    </span><span class=\"n\">module</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">kepler_third_law_si_check</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">second</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">meter</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SI</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"bp\">.</span><span class=\"n\">kilogram</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">¬≤</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">4</span><span class=\"bp\">‚Ä¢</span><span class=\"n\">œÄ</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">¬≥/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))))</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_dim</span>\n<span class=\"w\">    </span><span class=\"n\">module</span>\n</code></pre></div>",
        "id": 538398536,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757412384
    },
    {
        "content": "<p>And by cleanup, i mean, having SI system not be relying upon Float, but be generic on the value (Real, Float, Complex, ...)</p>",
        "id": 538400156,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757412882
    },
    {
        "content": "<p>Didn't need cleanup actually, working like a charm !<br>\n<a href=\"https://github.com/ecyrbe/lean-units/blob/main/Examples/formal.lean\">https://github.com/ecyrbe/lean-units/blob/main/Examples/formal.lean</a></p>",
        "id": 538402011,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757413544
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span>  so, i'm trying to adapt my lib to physlean, but i got a first issue. You defined change of units only using scales, not affine transformations (so Celsius conversion, Fahrenheit won't work)<br>\nDo you think it's possible to come up with a dimension check that would work with affine transformations or you think it's impossible ?<br>\nFrom first analysis, i can't find a way (because affine transformations are not transitive, nor commutative, while scaling only is). But  Maybe you have an idea ?</p>",
        "id": 538566395,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757479184
    },
    {
        "content": "<p>No, I don't know how to do affine transformations. I'm not sure even sure how to make sense of them on pen-and-paper. </p>\n<p>For example, something like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>T</mi><msub><mi>k</mi><mi>B</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">E/(Tk_B)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> has no dimensions, which means that it's value does not change if you change the unit of temperature from absolute Celsius (aka kelvin) to absolute Fahrenheit (where 0 absolute Fahrenheit is absolute zero), but its value absolutely does change when you go from ordinary Celsius to ordinary  Fahrenheit. </p>\n<p>I think maybe when doing dimensional analysis quantities should be thought of as secretly differences in quantities between your chosen value and a given fixed chosen value of zero - which for temperature is usually absolute zero.</p>",
        "id": 538567260,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757479876
    },
    {
        "content": "<p>Ok, good. <br>\nI'll try to define an alternative conversion system that only handle scaling and keep the affine one only for computable side of units.</p>",
        "id": 538570013,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757482054
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/538567260\">said</a>:</p>\n<blockquote>\n<p>For example, something like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>T</mi><msub><mi>k</mi><mi>B</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">E/(Tk_B)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> has no dimensions, which means that it's value does not change if you change the unit of temperature from absolute Celsius (aka kelvin) to absolute Fahrenheit (where 0 absolute Fahrenheit is absolute zero), but its value absolutely does change when you go from ordinary Celsius to ordinary  Fahrenheit. </p>\n</blockquote>\n<p>The only equation I know of where this matters is Antoine‚Äôs Equation. All other cases that I‚Äôve come across use absolute temperature (it‚Äôs wrong to use C or F, only use K or R) or use a temperature difference (C and F are okay, but the offset from absolute zero cancels out).   <a href=\"https://en.m.wikipedia.org/wiki/Antoine_equation\">https://en.m.wikipedia.org/wiki/Antoine_equation</a> </p>\n<p>Antoine is semi empirical; it has weird unit properties, like ‚Äúall parameters A B and C jointly depend on the choice of units for psat and T.‚Äù Unit conversions are possible, but they don‚Äôt end up being simple proportions like usual.</p>",
        "id": 538715277,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1757528833
    },
    {
        "content": "<p>So, a little feeback on trying to integrate with what Physlean has already done, without taking away key ideas, but trying to generalize them.<br>\nSo one of the features on lean-units is that there is no fixed set of dimensions, and also no fixed set of units.<br>\nthis allows for extensibiity, but that maybe not that important to physlean.<br>\nAnother feature is computability, and i think this one is of use for physicist when exploring a problem. because you can always try to #eval your ideas.</p>\n<p>So for the no fixed dimension set feature, when integrating with phylean, two different ideas came to me :</p>\n<ul>\n<li>instead of setting in stone the dimension at the core, fix them at the abstract level. this way, the core stays generic, and only when you want to work with a system of dimensions that you fix them. I have named this, Building a Dimensional System and Unit System.</li>\n<li>the other approach is : instead of trying to fix dimension at any level, don't fix them at all and try to find a generic way to handle scaling, UnitDependent and DimensionallyCorrect.</li>\n</ul>\n<p>I'm convinced that the second one is more powerful. So i'm trying to expand on this one. Maybe it will be a failure, i don't know yet. But i have an idea of how to do it.</p>\n<p>So one of the nice tricks of PhysLean on DimensionallyCorrect is that you can use Prime Numbers Scales to define another UnitChoices and disprove DimensionallyCorrect. <br>\nBut i think it can also be used to prove it. Indeed, if you define a One Unit and Prime Unit, you can generate all Unitchoices from them. So maybe just Proving a Scale between One and Prime is sufficient. (maybe i'm wrong, just a conjecture i have). If i'm wrong, i think a counter example should be easilly found.</p>\n<p>So if true, i can automate building such a prime scale. Indeed, on lean-units, each dimension is defined by a String, and you can map uniquely a String to a natural number. And for each natural number you can get the nth Prime Number and automate building a Prime UnitChoice for an undefined number of dimensions. And build a generic DimensionallyCorrect system.</p>\n<p>So that's the idea, maybe it will prove unfruitful. But it's fun to try.</p>",
        "id": 539373823,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757813754
    },
    {
        "content": "<p>To elaborate the idea, we can build this :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">foldl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt32</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">string_to_nat_inj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">proof_to_big_to_show_here</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">prime_from_str_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">prime_from_str</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">prime_nth_prime</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">prime_from_str_inj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_enc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">nth_injective</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">infinite_setOf_prime</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">string_to_nat_inj</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h_enc</span>\n</code></pre></div>",
        "id": 539383359,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757828193
    },
    {
        "content": "<p>Nice! Yeah, I had also thought whether this other side to the prime number thing could be done, and I think it would be possible. It would be awesome if you could make this 'automated'! </p>\n<p>Concerning computability. I did have a go making the stuff in PhysLean computable. It involved having a special subset of  scalings which are rationals rather than reals, which allows you to define dimensions on floats in addition to reals. I didn't get very far but I think something along these lines should be possible.</p>",
        "id": 539387455,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757832990
    },
    {
        "content": "<p>yes, one of the key proofs will be to show (or disprove) that :<br>\n<code> (‚àÄ u1 u2 : UnitChoices, scaleUnit u1 u2 m = m) ‚Üî (u_one u_prime: UnitChoices, scaleUnit u_one u_prime m = m)</code> <br>\ni think i will need help on this one.</p>",
        "id": 539395794,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757843831
    },
    {
        "content": "<p>Finished the PrimeScale automation and created some proofs.</p>\n<p><a href=\"https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/PrimeScale.lean\">https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/PrimeScale.lean</a><br>\n<a href=\"https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Lemmas.lean\">https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Lemmas.lean</a></p>\n<p>Thank to DFinsupp, It's then just defined as :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">PrimeScale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">._</span><span class=\"n\">impl</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">PrimeScale</span><span class=\"bp\">.</span><span class=\"n\">prime_pow</span>\n</code></pre></div>\n<p>Now the hardest part, defining <code>UnitDependent</code> and <code>DimensionCheck</code> on top of this. Need to think how to do this :)</p>",
        "id": 539649754,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1757971389
    },
    {
        "content": "<p>Awesome! Shouldn't this somehow be a result built upon/from <code>UnitDependent</code>,  not the other way around?</p>",
        "id": 539679943,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1757996151
    },
    {
        "content": "<p>You may be right. I'll didn't think yet about how to link <code>unitDependent</code> to this yet. I may indeed need to refactor things in the end.</p>",
        "id": 539706063,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758009679
    },
    {
        "content": "<p>One of the nice things i discovered with my previous simple dimension check is that you can disprove also using kernel decidability, making such proofs really small :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">not_e_equal_mc_dim_check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Energy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithDim</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">Mass</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">   </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_dim</span>\n<span class=\"w\">    </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">kernel</span>\n</code></pre></div>",
        "id": 539750427,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758024167
    },
    {
        "content": "<p>Some news, i have defined DimentionallyCorrect, not yet tried to use it (to see if it works).<br>\nSo i have simplified a lot UnitDependant, and renamed it to Scaler with this definition :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Scaler</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv_scale_cancel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">scale_inv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"n\">scale</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv_inj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"n\">scale_inv</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">MulScaler</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulAction</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Scaler</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">scale_smul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"n\">m</span>\n</code></pre></div>\n<p>Indeed, we now only apply scales using a PrimeScale. So <code>u1 and u2</code> disapear.<br>\nExample instance for Quantities based on Dimensions (WithDim) :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasDimension</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulScaler</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"o\">:=</span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"o\">(</span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">q1</span><span class=\"w\"> </span><span class=\"n\">q2</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dim_eq_dim</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">val_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_eq_mul_left_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val_inj</span><span class=\"w\"> </span><span class=\"n\">q1</span><span class=\"w\"> </span><span class=\"n\">q2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exfalso</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"bp\">.</span><span class=\"n\">scaler_ne_zero</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv_inj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">q1</span><span class=\"w\"> </span><span class=\"n\">q2</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dim_eq_dim</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">val_inj</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">ùíü</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">div_eq_mul_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_eq_mul_right_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">val_inj</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">inv_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_self_right</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exfalso</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"bp\">.</span><span class=\"n\">scaler_ne_zero</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">  </span><span class=\"n\">scale_inv_scale_cancel</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dim_eq_dim</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span><span class=\"bp\">‚Üê_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">div_self</span><span class=\"o\">,</span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_one</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Dimension</span><span class=\"bp\">.</span><span class=\"n\">PrimeScale</span><span class=\"bp\">.</span><span class=\"n\">scaler_ne_zero</span>\n<span class=\"w\">  </span><span class=\"n\">scale_smul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">smul_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">smul_eq_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dim_eq_dim</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>And dimensionally correct is just :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsDimensionallyCorrect</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Scaler</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Scaler</span><span class=\"bp\">.</span><span class=\"n\">scale</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span>\n</code></pre></div>\n<p>Now crossing fingers this works. i'll have some time this week end to test this. But not that much.</p>",
        "id": 540509702,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758305010
    },
    {
        "content": "<p>I understand why this definition is simpler to use and computationally would be a lot quicker than <code>UnitDependent</code>. My one unease about this is that it looses the physical meaning behind the class. In <code>UnitDependent</code> the function <code>scaleUnit</code> allowed you to see what happens when you change units from <code>u1</code> to <code>u2</code> and therefore had a precise physical meaning. </p>\n<p>Really IMHO, it would be better to have your definition of a <code>Scaler</code> as a constructor for a <code>UnitDependent</code> and  your <code>IsDimensionallyCorrect</code> as a if and only if  statement related to the existing  <code>IsDimensionallyCorrect</code> statement. I do not know if this latter one is possible, because it relies on the instances.</p>",
        "id": 540561343,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1758345746
    },
    {
        "content": "<p>The issue is, at the moment i can't build a <code>UnitDependent</code> class, i would first need to proove my conjecture to allow a relation between all units and PrimeScales.<br>\nI don't know where to start for this one. I would need help from a mathematician.<br>\nOne other thing is that, i have no UnitChoice really, because, choosing a Unit on my implementation is a deliberate abstracted type, unlike UnitChoice. <br>\nEven more so, i can't define a UnitChoice. Because it would mean fixing a set of dimensions to do so.<br>\nDefining UnitChoice is the <code>Approach 1</code> i exposed earlier, where i could define a Dimension System and Unit System on top of my library. Something i tried to evoid for <code>Approach 2</code>.<br>\nLet me try this <code>Approach 2</code>, if it prooves unfruitful, i'll go back to <code>Approach 1</code>.</p>",
        "id": 540568492,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758355206
    },
    {
        "content": "<p>So here, Scaler is just a mean to define <code>IsDimensionallyCorrect</code>for now and test if it works. We'll see after that if we can define another kind of <code>UnitChoice</code>, not the same as yours (can't define an undefined number of axioms for undefined number of units), on top of my <code>Units</code> type</p>",
        "id": 540568779,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758355636
    },
    {
        "content": "<p>FYI - we updated our manuscript and posted it here: <a href=\"https://arxiv.org/abs/2509.13142\">https://arxiv.org/abs/2509.13142</a></p>",
        "id": 540885903,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1758571199
    },
    {
        "content": "<p>A quick feedback, if you want to have a (somewhat) ok notation for powers with a custom typeclass :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">Dependent power operator, allows to have the output type depend on the exponent.</span>\n<span class=\"sd\">`q ^·µà n`:</span>\n<span class=\"sd\">Examples:</span>\n<span class=\"sd\">- `q ^·µà 2`   -- power with ‚Ñï exponent</span>\n<span class=\"sd\">- `q ^·µà (-2 : ‚Ñ§)`   -- power with ‚Ñ§ exponent</span>\n<span class=\"sd\">- `q ^·µà (1/3 : ‚Ñö)`  -- power with ‚Ñö exponent</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">DPow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pow</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">80</span><span class=\"w\"> </span><span class=\"s2\">\" ^·µà \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">DPow</span><span class=\"bp\">.</span><span class=\"n\">pow</span>\n</code></pre></div>\n<p>Example of instanciation  :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Pow</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"n\">Œ¥</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DPow</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">‚Ñö</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Quantity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pow</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚ü©</span>\n</code></pre></div>\n<p>It may make some of the example equations feel a litle more natural.</p>",
        "id": 540891951,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1758573707
    },
    {
        "content": "<p>Hello,</p>\n<p>Another week, another quick report of how it's going to try integrating lean-units into PhysLean.<br>\nSo the definition above of <code>IsDimensionallyCorrect</code> works.<br>\nBut, proving it is harder than in PhysLean for now. I need to add <code>simp</code> annotations to my <code>PrimeScale</code> lemmas and see if it makes things simpler to prove (like what i did with <code>simp_dim</code> tactic).<br>\nI'm also in the process to prove <code>PrimeScale</code> function is injective, thats a way to say that two different Dimensions have two different <code>PrimeScale</code> and vice-versa, making my conjecture a proved theorem.<br>\nI proved it on paper (with some holes i'm confident with), so now i need to formalize it (and fill the holes)</p>\n<p><span aria-label=\"warning\" class=\"emoji emoji-26a0\" role=\"img\" title=\"warning\">:warning:</span> A litle warning, because i'm not sure i explained it very well. My integration means that choosing a unit will no more be an <code>axiom</code> and <code>Space</code> and <code>Time</code> Unit (that are defined like a quantity) will need to be derived from Quantity, not the other way around.<br>\nThis means certainly some refactoring in Physlean, not sure how big it will be, because i did not look if this API is used all over PhysLean or not.</p>",
        "id": 541919836,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1759094871
    },
    {
        "content": "<p><code>Space</code> and <code>Time</code> are used all over PhysLean so this would be a big refactor if you mean this, but their units are not currently used very much. </p>\n<p>Seeing injectivity  of <code>PrimeScale</code> would be very nice.</p>",
        "id": 542027779,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1759149677
    },
    {
        "content": "<p>Hello,</p>\n<p>Some news to say that i almost finished formalizing injectivity of Primescale, it required proving ‚Ñö-linear ind√©pendance of logarithmic primes. This is something that is missing in mathlib, so i tacled this proof.<br>\nThis proof is formalized and done (it's bit Big, so i'll eventually refactor it).<br>\nI'm now just missing some plumbing to finish Primescale injectivity.<br>\nNext, i'll work on a series of PR to merge. And will be able to discuss how to do that.<br>\nMaybe a PhysLean caf√© would be nice to discuss this.</p>",
        "id": 543454052,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1759819327
    },
    {
        "content": "<p>Nice! Yeah let's discuss at a PhysLean caf√© - I will organize one now</p>",
        "id": 543464540,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1759823397
    },
    {
        "content": "<p>Finished the plumbing of primescale injectivity proof. I'm not a mathlib expert, so the proof looks nice at the higher level, but the lower levels looks kind of messy.<br>\nAnyway, here the interresting files :<br>\n<code>lemmas about primescale</code><br>\n<a href=\"https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Lemmas.lean#L330\">https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Lemmas.lean#L330</a><br>\n<code>lemmas and definitions to build primescale</code><br>\n<a href=\"https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/PrimeScale.lean\">https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/PrimeScale.lean</a><br>\n<code>lemmas for ‚Ñö-linear independance of logarithmic primes</code> (rephased to use product instead of logarithmic directly, so that the proof can be used directly)<br>\n<a href=\"https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Prime.lean\">https://github.com/ecyrbe/lean-units/blob/main/LeanUnits/Framework/Dimensions/Prime.lean</a></p>",
        "id": 544328536,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1760195816
    },
    {
        "content": "<p>So after our discussion, i found a way to make a computable version of <code>nth_prime</code> and have the associated proofs i needed. They are suficienlty simple by using monotonicity  and deriving it by a special implementation of <code>next_prime</code> using <code>Nat.find</code> helper lemmas:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Computable nth_prime with proofs</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">next_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">exists_infinite_primes</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hprime</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">find_spec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">exists_infinite_primes</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ü®</span><span class=\"n\">prime</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hprime</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">next_prime_gt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">next_prime</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">find_spec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">exists_infinite_primes</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">prime_two</span><span class=\"bp\">‚ü©</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">nth</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">next_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sub_one_lt</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"n\">rename_i</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">beq_iff_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">assumption</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">nth_prime_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nth_prime_nat_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_prime_nat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nth_prime_strictmono</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StrictMono</span><span class=\"w\"> </span><span class=\"n\">nth_prime_nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">strictMono_nat_of_lt_succ</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hstep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">    </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nth_prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">next_prime_gt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">occs</span><span class=\"o\">:=[</span><span class=\"mi\">2</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nth_prime</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nth_prime</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">next_prime</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hstep</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">prime_two</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nth_prime_nat_inj</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"n\">nth_prime_nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">nth_prime_strictmono</span><span class=\"bp\">.</span><span class=\"n\">injective</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">nth_prime_nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">string_to_nat</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"L\"</span><span class=\"w\"> </span><span class=\"c1\">-- 397</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"T\"</span><span class=\"w\"> </span><span class=\"c1\">-- 443</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"M\"</span><span class=\"w\"> </span><span class=\"c1\">-- 401</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"I\"</span><span class=\"w\"> </span><span class=\"c1\">-- 379</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"K\"</span><span class=\"w\"> </span><span class=\"c1\">-- 389</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"N\"</span><span class=\"w\"> </span><span class=\"c1\">-- 409</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">prime_from_str</span><span class=\"w\"> </span><span class=\"s2\">\"J\"</span><span class=\"w\"> </span><span class=\"c1\">-- 383</span>\n</code></pre></div>\n</div></div>",
        "id": 545133650,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1760565492
    },
    {
        "content": "<p>Nice! These primes are lower than I was expecting :). Do you know if \"in theory\" your computable version gives the same numbers as the non-computable one?</p>",
        "id": 545201001,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1760600997
    },
    {
        "content": "<p>yes they are exactly the same.</p>",
        "id": 545215986,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1760603404
    },
    {
        "content": "<p>Hello! I'm interested in improving units in PhysLean and, in particular, in generalising the framework using typeclasses for dimension systems and/or unit systems, ... so that each application only needs to care about the relevant dimensions. I'm not sure about the status of the integration of lean-units with PhysLean, but hopefully that should make it easier.</p>\n<p>Anyway, for now I'm looking at refactoring some of the code in <code>PhysLean.Units</code>. I've found a way to get rid of <code>ModuleCarriesDimension</code>, I'll send a PR soon if that's considered useful.</p>",
        "id": 546779443,
        "sender_full_name": "Ronan Lamy",
        "timestamp": 1761259563
    },
    {
        "content": "<p>Hey Ronan, I think anything to simplify the units in PhysLean will in the end make it easier to integrate with lean-units! So I am all for this. </p>\n<p>I am curious how you removed <code>ModuleCarriesDimension</code>, the reason I added it (if I recall correctly) was to prevent a typeclass diamond happening. But am happy to wait for a PR to see :).</p>",
        "id": 546818191,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761287146
    },
    {
        "content": "<p>In my impl, i also did not use ModuleCarriesDimension, but because i did not need DimensionFul since Quantity is already generic. I have a HasDimension that looks like CarriesDimension.</p>",
        "id": 546821851,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761288820
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"942100\">Alfredo Moreira-Rosa</span> <a href=\"#narrow/channel/479953-PhysLean/topic/physical.20units/near/546821851\">said</a>:</p>\n<blockquote>\n<p>In my impl, i also did not use ModuleCarriesDimension, but because i did not need DimensionFul since Quantity is already generic. I have a HasDimension that looks like CarriesDimension.</p>\n</blockquote>\n<p>Yes, I basically copied that idea - I have:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HasDim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Dimension</span>\n</code></pre></div>",
        "id": 546940595,
        "sender_full_name": "Ronan Lamy",
        "timestamp": 1761324427
    },
    {
        "content": "<p>I sent <a href=\"https://github.com/HEPLean/PhysLean/pull/787\">the PR</a>.</p>",
        "id": 546998202,
        "sender_full_name": "Ronan Lamy",
        "timestamp": 1761339157
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> does physlean have a notion of experimental measure with an measurement error ?<br>\nIf so/or not is it something that could be interresting for Quantities to have a Measured Quantity with error threshold ?</p>",
        "id": 547977114,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761840246
    },
    {
        "content": "<p>No PhysLean doesn't currently have anything along these lines! I  would be extremely interested to see something like this.</p>",
        "id": 547977937,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761840441
    },
    {
        "content": "<p>Thanks, i'll do a check of what is the state of the art on this subject and try to bring these ideas to discussion.</p>",
        "id": 547978619,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1761840615
    },
    {
        "content": "<p>Woukd this be related to regular statistics topics like mean, standard deviation, standard error of the mean, 95% confidence interval, and uncertainty propagation? Much of that would have a home in Mathlib, I would guess.</p>",
        "id": 548019451,
        "sender_full_name": "Tyler Josephson ‚öõÔ∏è",
        "timestamp": 1761852986
    },
    {
        "content": "<p>I guess it would be a combination of both, no? The underlying theory in Mathlib, but the actual quantities of interest in PhysLean or something similar.</p>",
        "id": 548025890,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761855479
    },
    {
        "content": "<p>Just a quick info on my side, i'm doing some work on another part of lean (implementing independant https client), but i did not forget i need to create some PRs for integrating lean-units. i'll have some holidays until the end of the year, so i'll try to get at least one PR before end of the year.</p>",
        "id": 564994136,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1766406780
    }
]