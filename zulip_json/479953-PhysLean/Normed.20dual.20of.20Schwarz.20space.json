[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> I thought it might be a good idea to make this a separate thread. What are the things I should keep in mind?</p>",
        "id": 528463103,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752331077
    },
    {
        "content": "<p>For example, the question I would have is, how much stuff do we currently have? and which folder should I put it in?</p>",
        "id": 528463299,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752331251
    },
    {
        "content": "<p>maybe I should make a separate folder for it, PhysLean/Mathematics/Schwarz/Basic.lean</p>",
        "id": 528463346,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752331310
    },
    {
        "content": "<p>to document more of my thoughts, I had an idea to enlarge the test functions to continuous piecewise differentiable but ultimately thought  it's a bad idea.</p>",
        "id": 528463540,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752331496
    },
    {
        "content": "<p>I think I'll keep the test function to the Schwarz space, and then I'll make some API to account for the piecewise functions</p>",
        "id": 528463560,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752331516
    },
    {
        "content": "<p>The only thing currently in PhysLean regarding Schwarz maps is the stuff I was doing last week regarding Quantum mechanics which can be found in the <code>Operators</code> and <code>HilbertSpace</code> folders of <a href=\"https://github.com/HEPLean/PhysLean/tree/master/PhysLean/QuantumMechanics/OneDimension\">this</a> directory. </p>\n<p>I would even be tempted to put this in the <code>SpaceAndTime</code> directory in a folder like e.g. <code>SpaceAndTime.Distributions.</code>, but I think the mathematics folder is also good. </p>\n<p>Here are somethings I would like to see: </p>\n<ul>\n<li>Notation that makes the type of  distributions look like a function type e.g. <code>ℝ →d ℂ</code></li>\n<li>API and notation around derivatives so we can use them like we use derivatives of functions. </li>\n<li>API that makes it as easy as possible to treat functions as distributions. This means: Defining distributions from functions, take the derivative of distributions which are actually functions, proving equality of two distributions which are actually functions, etc.</li>\n<li>Important distributions pre-defined as such, e.g. dirac delta, the Heaviside step functions, the inverse potential <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">1/r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>. These should have good API, for example their derivatives etc.</li>\n</ul>",
        "id": 528464205,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752332219
    },
    {
        "content": "<p>also another question is, do we want R -&gt; C or R -&gt; R? or R -&gt; R^k?</p>",
        "id": 528464436,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752332441
    },
    {
        "content": "<p>it seems like in quantum you would want (R -&gt; C) -&gt; C but in variational calculus you would want (R -&gt; R^2) -&gt; R?</p>",
        "id": 528465365,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752333354
    },
    {
        "content": "<p>or i can allow both</p>",
        "id": 528465390,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752333375
    },
    {
        "content": "<p>I want to make the decision to only use Type 0 lol</p>",
        "id": 528465645,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752333585
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> do you actually use universes? I see that you type <code>universe v u</code> in the beginning of your files but I don't know if you really use them</p>",
        "id": 528465706,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752333647
    },
    {
        "content": "<p>So as physicists we are mainly interested in functions from space (or spacetime) to Euclidean space or the product of R’s etc. So if it can be done to cover all these cases I think this would be good - if indeed possible.</p>",
        "id": 528465944,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752333891
    },
    {
        "content": "<p>yes but i'm saying in quantum you want C</p>",
        "id": 528465975,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752333920
    },
    {
        "content": "<p>Regarding universes, nope! I’m not sure of anywhere in physlean where universes come in. If they can be avoided here the better I think</p>",
        "id": 528466027,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752333971
    },
    {
        "content": "<p>Yeah sorry, Euclidean spaces over the reals or complex numbers and also factors of C and C^2 etc. (Sorry for the bad formatting - on my phone)</p>",
        "id": 528466117,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752334044
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528466027\">said</a>:</p>\n<blockquote>\n<p>Regarding universes, nope! I’m not sure of anywhere in physlean where universes come in. If they can be avoided here the better I think</p>\n</blockquote>\n<p><a href=\"https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code\">https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code</a></p>",
        "id": 528466157,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334080
    },
    {
        "content": "<p>now i'm thinking you might actually want (R -&gt; R/C^k) -&gt; R/C^k!</p>",
        "id": 528466318,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334258
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> what should the output be?</p>",
        "id": 528466361,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334299
    },
    {
        "content": "<p>for example, where does dirac delta make sense?</p>",
        "id": 528466381,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334315
    },
    {
        "content": "<p>if i start with a function f:R-&gt;R^3 defined by f(t) = (sin(t), cos(t), t), and ask you what is (δ*f)(0)?</p>",
        "id": 528466433,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334368
    },
    {
        "content": "<p>then you would say (0, 1, 0) right</p>",
        "id": 528466442,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334377
    },
    {
        "content": "<p>I think the output should be R or C still. In particular a function R-&gt;R^k defines a distribution (R-&gt;R^k)-&gt;R through integration over the inner product</p>",
        "id": 528466650,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752334567
    },
    {
        "content": "<p>ok but what about my example?</p>",
        "id": 528466674,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334582
    },
    {
        "content": "<p>oh you take the inner product first</p>",
        "id": 528466987,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334787
    },
    {
        "content": "<p>I think (though could be wrong) that you have a direction associated with the delta function</p>",
        "id": 528467015,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752334805
    },
    {
        "content": "<p>wiki seems to think that it outputs R^n</p>",
        "id": 528467109,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334890
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528466157\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528466027\">said</a>:</p>\n<blockquote>\n<p>Regarding universes, nope! I’m not sure of anywhere in physlean where universes come in. If they can be avoided here the better I think</p>\n</blockquote>\n<p><a href=\"https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code\">https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code</a></p>\n</blockquote>\n<p>I can’t open this right now (as I’m not signed into GitHub on my phone) but I’m going to guess that those universes can be trivially removed</p>",
        "id": 528467111,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752334892
    },
    {
        "content": "<p>but this could just be a different convention</p>",
        "id": 528467118,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334895
    },
    {
        "content": "<p>could you share the wiki page?</p>",
        "id": 528467164,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752334941
    },
    {
        "content": "<p><a href=\"https://en.wikipedia.org/wiki/Dirac_delta_function#Generalizations\">https://en.wikipedia.org/wiki/Dirac_delta_function#Generalizations</a></p>",
        "id": 528467173,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334954
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/Cqobkj9X_gBdOVarRdnGLqyX/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Cqobkj9X_gBdOVarRdnGLqyX/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1202x335\" src=\"/user_uploads/thumbnail/3121/Cqobkj9X_gBdOVarRdnGLqyX/image.png/840x560.webp\"></a></div>",
        "id": 528467200,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334979
    },
    {
        "content": "<p>oh wait, this is different</p>",
        "id": 528467222,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752334999
    },
    {
        "content": "<p>this is the dirac delta R^n -&gt; R, sorry for the confusion</p>",
        "id": 528467234,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752335008
    },
    {
        "content": "<p>Yeah! I think f here is a function from R^k-&gt;R</p>",
        "id": 528467288,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752335061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528466157\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528466027\">said</a>:</p>\n<blockquote>\n<p>Regarding universes, nope! I’m not sure of anywhere in physlean where universes come in. If they can be avoided here the better I think</p>\n</blockquote>\n<p><a href=\"https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code\">https://github.com/search?q=repo%3AHEPLean%2FPhysLean%20universe&amp;type=code</a></p>\n</blockquote>\n<p>Back at a computer, and made a <a href=\"https://github.com/HEPLean/PhysLean/pull/643\">PR</a> removing all universes in PhysLean - none were doing anything.</p>",
        "id": 528469060,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752337083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> I've made a PR to define distributions and dirac delta function. I've provided a custom constructor that a physicist <em>should</em> be able to understand (try it yourself!).</p>",
        "id": 528473071,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341347
    },
    {
        "content": "<p><a href=\"https://github.com/HEPLean/PhysLean/pull/644\">https://github.com/HEPLean/PhysLean/pull/644</a></p>",
        "id": 528473394,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341660
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"890057\">@ZhiKai Pong</span></p>",
        "id": 528473430,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341694
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> do you know why the CI is building all the files even though I haven't touched anything?</p>",
        "id": 528474240,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752342604
    },
    {
        "content": "<p>This always happens for PhysLean - I think it is basically down to the fact we don't have a cache like Mathlib does. I would like to set one up at some point, but am not entirely sure how - and think it relies on server space somewhere.</p>",
        "id": 528474345,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752342743
    },
    {
        "content": "<p>BTW you can run the linters locally using (which is quicker then relying on GitHub): </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">lint_all</span>\n<span class=\"bp\">./</span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">lint</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">sh</span>\n</code></pre></div>",
        "id": 528474378,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752342781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> i've updated the file</p>",
        "id": 528475629,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752344144
    },
    {
        "content": "<p>what does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SchwartzMap.delta#doc\">docs#SchwartzMap.delta</a> do or is it something else entirely?</p>",
        "id": 528477119,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1752345803
    },
    {
        "content": "<p>aha, lol</p>",
        "id": 528477340,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752345986
    },
    {
        "content": "<p>nice find!</p>",
        "id": 528477359,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346012
    },
    {
        "content": "<p>so one difference is that it doesn't output a scalar</p>",
        "id": 528477380,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346041
    },
    {
        "content": "<p><a href=\"https://en.wikipedia.org/wiki/Distribution_(mathematics)\">https://en.wikipedia.org/wiki/Distribution_(mathematics)</a></p>",
        "id": 528477743,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346430
    },
    {
        "content": "<p>here's an interesting thing</p>",
        "id": 528477745,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346433
    },
    {
        "content": "<p>wiki seems to imply that distributions are actually (U -&gt; R) -&gt; R or (U -&gt; C) -&gt; C</p>",
        "id": 528477757,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346451
    },
    {
        "content": "<p>wiki wants to make the domain high dimensional rather than the target</p>",
        "id": 528477765,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752346463
    },
    {
        "content": "<p>what if we just allow (R -&gt; E) -&gt; F because we might need them eventually</p>",
        "id": 528478294,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752347042
    },
    {
        "content": "<p>on that note why don't we generalise the R too <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 528478553,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752347339
    },
    {
        "content": "<p>Yeah I think R really should be generalized, since in general this represents space or spacetime, not necessarily in 1-dimension. I'm still confused why you want to generalize F though?</p>",
        "id": 528478755,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752347470
    },
    {
        "content": "<p>Maybe my real concern is the following: If you generalize F, I worry that defining e.g. the derivative etc. will become difficult. But maybe it can be done.</p>",
        "id": 528479040,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752347782
    },
    {
        "content": "<p>Let me add to my list above of things I would like to see: </p>\n<ul>\n<li>A constructor of a distribution based on a function <code>ℝ → ℂ</code> satisfying conditions which can be solved with <code>fun_prop</code>.</li>\n</ul>",
        "id": 528479262,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752348042
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528478755\">said</a>:</p>\n<blockquote>\n<p>Yeah I think R really should be generalized, since in general this represents space or spacetime, not necessarily in 1-dimension. I'm still confused why you want to generalize F though?</p>\n</blockquote>\n<p>i think you're right, we don't need to generalise F; i just thought we might need to because the dirac delta in the library is S(E,F) -&gt;[L] F</p>",
        "id": 528479615,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752348400
    },
    {
        "content": "<p>but if we stick to R/C then we can still define our own dirac by composing it with a linear function</p>",
        "id": 528479651,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752348424
    },
    {
        "content": "<p>Ok, I'm happy either way, so I am happy for you to make a call on this. I think at some point it will become clear which one is needed anyway :).</p>",
        "id": 528479776,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752348542
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> I think a good enough criterion for f to become a distribution is that int_a^b |f(x)| dx should (exist and) be bounded for every a&lt;b? but this would also mean that your 1/r^2 might not work... how do you make sense of 1/r^2?</p>",
        "id": 528480142,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752348948
    },
    {
        "content": "<p>every continuous function should be able to be interpreted as a distribution</p>",
        "id": 528480608,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752349545
    },
    {
        "content": "<p>i'll do that in the next PR</p>",
        "id": 528480616,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752349550
    },
    {
        "content": "<p>actually i hope you don't mind me asking again, i'm not really familiar with these things; do you have an example where we want the test functions (that's the R-&gt;E part) to have high dimensional output value?</p>",
        "id": 528481060,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752350056
    },
    {
        "content": "<p>i actually don't understand why S(R, R) -&gt;L R and S(R, C) -&gt;L C aren't enough...</p>",
        "id": 528481083,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752350079
    },
    {
        "content": "<p>i thought about the var cal case but actually in that case the test functions are still one dimensional</p>",
        "id": 528481104,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752350095
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528480142\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> I think a good enough criterion for f to become a distribution is that int_a^b |f(x)| dx should (exist and) be bounded for every a&lt;b? but this would also mean that your 1/r^2 might not work... how do you make sense of 1/r^2?</p>\n</blockquote>\n<p>Huh - this is worrying. I want to really make sense of the equation given here: </p>\n<p><a href=\"https://math.stackexchange.com/questions/1335591/divergence-of-vecf-frac-hat-mathrmrr2?noredirect=1&amp;lq=1\">https://math.stackexchange.com/questions/1335591/divergence-of-vecf-frac-hat-mathrmrr2?noredirect=1&amp;lq=1</a></p>\n<p>I thought, and what people say, is that this is in terms of distributions. This equation comes up in Maxwell's equations for a point particle, and actually gives an example of why  S(R, R) -&gt;L R and S(R, C) -&gt;L C aren't enough.</p>",
        "id": 528482696,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752351843
    },
    {
        "content": "<p>Also the 1/r^2  should be thought of as being in 3d, which may salvage things (r) is the distance from the orgin.</p>",
        "id": 528483076,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352266
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> Thanks for the example.</p>\n<ol>\n<li>This is an interesting example indeed. From the proof given in the most upvoted answer, I'll take the definition to be \"the limit of the distributions defined by 1/(r^2+a^2) as a-&gt;0\". If you want a more intrinsic definition maybe principal values will be the answer?</li>\n<li>The test functions (φ) are actually R^3 -&gt; R, so that's actually not an example I'm looking for. I understand that the first R in my (S(R, R/C) -&gt; R/C) should be generalised, but I'm talking about the first \"R/C\" in my expression.</li>\n</ol>",
        "id": 528483165,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752352366
    },
    {
        "content": "<p>c.f. 2, yes, sorry you are right. I am interested in the function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mo stretchy=\"false\">)</mo><mo>=</mo><mover accent=\"true\"><mi>r</mi><mo>^</mo></mover><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">f(\\vec r) = \\hat{r}/r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.471em\" height=\"0.714em\" style=\"width:0.471em\" viewBox=\"0 0 471 714\" preserveAspectRatio=\"xMinYMin\"><path d=\"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\"/></svg></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1944em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> before taking the divergence, and I want to interpret this as a distribution, which I think would correspond to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo stretchy=\"false\">(</mo><msup><mi>R</mi><mn>3</mn></msup><mo separator=\"true\">,</mo><msup><mi>R</mi><mn>3</mn></msup><mo stretchy=\"false\">)</mo><mo>→</mo><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">S(R^3, R^3)\\to R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>.</p>",
        "id": 528483275,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352511
    },
    {
        "content": "<p>I want to interpret this as a distribution, because I want to make sense of the divergence of it, and ending up with a Dirac delta function.</p>",
        "id": 528483317,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352561
    },
    {
        "content": "<blockquote>\n<p>If you want a more intrinsic definition maybe principal values will be the answer?</p>\n</blockquote>\n<p>I was thinking that, but I don't think it's actually needed, since I think e.g. the norm of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mo stretchy=\"false\">)</mo><mo>=</mo><mover accent=\"true\"><mi>r</mi><mo>^</mo></mover><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">f(\\vec r) = \\hat r /r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.471em\" height=\"0.714em\" style=\"width:0.471em\" viewBox=\"0 0 471 714\" preserveAspectRatio=\"xMinYMin\"><path d=\"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\"/></svg></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1944em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> is locally integrable in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">R^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>, namely since the volume measure is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><msup><mi>r</mi><mn>2</mn></msup><mi>d</mi><mi>r</mi><mi>d</mi><mi>θ</mi><mi>d</mi><mi>ϕ</mi></mrow><annotation encoding=\"application/x-tex\">= \\sin (\\theta) r^2 drd\\theta d\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ϕ</span></span></span></span>, the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>'s cancel out.</p>",
        "id": 528483432,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352711
    },
    {
        "content": "<p>I'm wondering if it's possible to make sense of your f : R^3 -&gt; \"R^3\" without actually modifying the space of test functions S(R^3, R)</p>",
        "id": 528483441,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752352719
    },
    {
        "content": "<p>(From the</p>\n<p><span class=\"user-mention silent\" data-user-id=\"653351\">Joseph Tooby-Smith</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528483432\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>If you want a more intrinsic definition maybe principal values will be the answer?</p>\n</blockquote>\n<p>I was thinking that, but I don't think it's actually needed, since I think e.g. the norm of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mo stretchy=\"false\">)</mo><mo>=</mo><mover accent=\"true\"><mi>r</mi><mo>^</mo></mover><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">f(\\vec r) = \\hat r /r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.471em\" height=\"0.714em\" style=\"width:0.471em\" viewBox=\"0 0 471 714\" preserveAspectRatio=\"xMinYMin\"><path d=\"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\"/></svg></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1944em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> is locally integrable in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">R^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>, namely since the volume measure is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><msup><mi>r</mi><mn>2</mn></msup><mi>d</mi><mi>r</mi><mi>d</mi><mi>θ</mi><mi>d</mi><mi>ϕ</mi></mrow><annotation encoding=\"application/x-tex\">= \\sin (\\theta) r^2 drd\\theta d\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ϕ</span></span></span></span>, the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>'s cancel out.</p>\n</blockquote>\n<p>(From the physics point of view this is actually precisely why the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">1/r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> appears in electromagnetism)</p>",
        "id": 528483483,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352787
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528483441\">said</a>:</p>\n<blockquote>\n<p>I'm wondering if it's possible to make sense of your f : R^3 -&gt; \"R^3\" without actually modifying the space of test functions S(R^3, R)</p>\n</blockquote>\n<p>I guess the question is how would you treat <code> f : R^3 -&gt; R^3</code> as a distribution in this sense, what would your integral be?</p>",
        "id": 528483601,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752352917
    },
    {
        "content": "<p>from a mathematical point of view there's actually nothing \"extra\" added on by going from a \"scalar field\" to a \"vector field\": the behaviour of (f1, f2, f3) is determined by f1, f2, and f3, i think</p>",
        "id": 528483645,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752352974
    },
    {
        "content": "<p>generalising the codomain is quite different from generalising the domain</p>",
        "id": 528483657,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752352990
    },
    {
        "content": "<p>i'm actually also a bit confused about the statement that it's integrable because the 1D version 1/x^2 seems to not be integrable? am I missing something here?</p>",
        "id": 528483685,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353041
    },
    {
        "content": "<p>oh the 1d version isn't 1/x^2 it's sgn(x)/x^2 right</p>",
        "id": 528483803,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353210
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/479953-PhysLean/topic/Normed.20dual.20of.20Schwarz.20space/near/528483803\">said</a>:</p>\n<blockquote>\n<p>oh the 1d version isn't 1/x^2 it's sgn(x)/x^2 right</p>\n</blockquote>\n<p>The  2d version is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">1/r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>, and the 1d version is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>. This is explained (for physicists) here:</p>\n<p><a href=\"https://physics.stackexchange.com/questions/629299/does-the-electric-field-in-1d-exist-in-nature\">https://physics.stackexchange.com/questions/629299/does-the-electric-field-in-1d-exist-in-nature</a></p>\n<p>This has a very bizarre physical consequence: A point particle in 1d produces a constant electric field in all of space. (the same way that in 3d an infinite plane of charges produces a constant electric field).</p>",
        "id": 528483937,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752353426
    },
    {
        "content": "<p>sorry, by 1d version i just meant the naive way of just looking at the x-axis</p>",
        "id": 528483967,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353474
    },
    {
        "content": "<p>and then for sgn(x)/x^2 you still need to kinda of \"take some limit\" -- whether you do it explicitly via sgn(x)/(x^2+a^2), or implicitly by considering \"principal value\" or taking the complement of (-ε, ε) and letting ε -&gt; 0</p>",
        "id": 528484015,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353554
    },
    {
        "content": "<p>I agree that the value along the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>-axis is sgn(x)/x^2, but I don't see why you are trying to integrate along the x-axis, which is of measure zero in 3d.</p>",
        "id": 528484091,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752353663
    },
    {
        "content": "<p>ah I just wanted to do an \"easier\" version but maybe this is not the right thing to do</p>",
        "id": 528484130,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353715
    },
    {
        "content": "<p>maybe 3d domain is really different from 1d domain</p>",
        "id": 528484138,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752353724
    },
    {
        "content": "<p>Yeah I think it is - I don't think you can just restrict to a 1d line. (which I agree is rather odd intuitively)</p>",
        "id": 528484232,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752353880
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> btw im now leaning towards making a function f: R^n -&gt; R^k into a distribution by taking test function η: R^n -&gt; R (!) and outputting int η x • f x dx (in R^k!); I thought I would ask for your opinion on this.</p>",
        "id": 528526524,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752409488
    },
    {
        "content": "<p>I’m 80% convinced that this is the best approach</p>",
        "id": 528526767,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752409785
    },
    {
        "content": "<p>update: 90%</p>",
        "id": 528527957,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752411136
    },
    {
        "content": "<p>Ok this makes sense, I think it will make it easier to eg define the divergence  as well</p>",
        "id": 528528137,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752411374
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 528547239,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1752430642
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 528547378,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1752430781
    },
    {
        "content": "<p>Concerning showing <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">1/r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> is a distribution in 3d, I think what one may need is the generalization of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=integral_comp_polarCoord_symm#doc\">docs#integral_comp_polarCoord_symm</a> to one dimension higher, or something similar. This is related to <span class=\"user-mention\" data-user-id=\"890057\">@ZhiKai Pong</span> 's (as yet unanswered :() post on spherical coordinates: <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F/topic/Spherical.20coordinates/with/512702457\">#Is there code for X? &gt; Spherical coordinates</a> . Maybe it is worth developing such an API.</p>",
        "id": 529064744,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752673797
    },
    {
        "content": "<p>I recall we have something like a \"spherical haar measure\"</p>",
        "id": 529067028,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752674431
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Constructions/HaarToSphere.html#MeasureTheory.Measure.toSphere\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/Constructions/HaarToSphere.html#MeasureTheory.Measure.toSphere</a></p>",
        "id": 529067358,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752674516
    },
    {
        "content": "<p>this thing</p>",
        "id": 529067385,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752674521
    },
    {
        "content": "<p>Ah! Nice! Ok, and there is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MeasureTheory.integral_fun_norm_addHaar#doc\">docs#MeasureTheory.integral_fun_norm_addHaar</a> ! Looks very close to what we would want (just over a compact domain not the whole space).</p>",
        "id": 529068320,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752674752
    },
    {
        "content": "<p>just set the function to 0 outside the compact domain</p>",
        "id": 529068399,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752674771
    },
    {
        "content": "<p>Yep!</p>",
        "id": 529068529,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752674803
    },
    {
        "content": "<p>Honestly I spent a good hour earlier  searching loogle for things like </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integral</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"norm\"</span>\n</code></pre></div>\n<p>so don't know how I missed this, maybe I didn't quite use the right words :).</p>",
        "id": 529068922,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752674912
    },
    {
        "content": "<p>Some other distributions which appear in physics: </p>\n<ul>\n<li>A generalization of a dirac delta function to a line e.g. for the <code>x</code>-axis <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>δ</mi><mrow><mi>L</mi><mi>x</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\delta_{Lx}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0379em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">Lx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> such that in 3d</li>\n</ul>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">⟨</mo><msub><mi>δ</mi><mrow><mi>L</mi><mi>x</mi></mrow></msub><mo separator=\"true\">,</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo separator=\"true\">,</mo><mi>z</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">⟩</mo><mo>=</mo><mo>∫</mo><mi>ϕ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">\\langle \\delta_{Lx}, \\phi(x, y, z) \\rangle = \\int \\phi(x, 0, 0) dx.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">⟨</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0379em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">Lx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϕ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)⟩</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.2222em;vertical-align:-0.8622em;\"></span><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϕ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">.</span></span></span></span></span></p>\n<p>Physically this appears when studying e.g. lines of charges, or a the magnetic field around a wire. </p>\n<ul>\n<li>A generalization of a dirac delta function to a plane (and in general any co-dimension <code>n</code> surface, e.g. the surface of a ball). </li>\n<li>The function which takes a value 'a' inside a ball of radius 'r' and is zero outside. Used e.g. in gravity.</li>\n</ul>",
        "id": 529215856,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752736315
    },
    {
        "content": "<p>Here is the definition of the function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">1/r^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> in 3d as a distribution, I'm sure this could very much be neatened up etc. </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Distribution</span><span class=\"bp\">.</span><span class=\"n\">FourierSchwartz</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Constructions</span><span class=\"bp\">.</span><span class=\"n\">HaarToSphere</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">SchwartzMap</span><span class=\"w\"> </span><span class=\"n\">NNReal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">invSqMeasure</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">volume</span><span class=\"bp\">.</span><span class=\"n\">withDensity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">HasTemperateGrowth</span><span class=\"w\"> </span><span class=\"n\">invSqMeasure</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">exists_integrable</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">invSqMeasure</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrable_withDensity_iff</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">swap</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n<span class=\"w\">    </span><span class=\"n\">swap</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">@</span><span class=\"n\">ae_iff</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">toReal_ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">measurePreserving_homeomorphUnitSphereProd</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))))</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IntegrableOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\">  </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"bp\">ᶜ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrableOn_iff_comap_subtypeVal</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">swap</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">MeasurableSet</span><span class=\"bp\">.</span><span class=\"n\">compl_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">          </span><span class=\"bp\">@</span><span class=\"n\">Membership</span><span class=\"bp\">.</span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">instMembership</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"bp\">ᶜ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">homeomorphUnitSphereProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span><span class=\"bp\">∘</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">homeomorphUnitSphereProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">funext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Integrable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"bp\">.</span><span class=\"n\">integrable_comp_emb</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Homeomorph</span><span class=\"bp\">.</span><span class=\"n\">measurableEmbedding</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">homeomorphUnitSphereProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span>\n<span class=\"w\">      </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"n\">sfinite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SFinite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">instMeasurableSpace</span>\n<span class=\"w\">          </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">measureSpace</span><span class=\"bp\">.</span><span class=\"n\">toMeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">volume</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">out'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SFinite</span><span class=\"bp\">.</span><span class=\"n\">out'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">        </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">          </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">isFiniteMeasure_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">comap</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">comap_apply</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measure_lt_top</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">subtype_coe</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">comap_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">sum_apply</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">conv_rhs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">            </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">            </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">comap_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">subtype_coe</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span><span class=\"o\">)]</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">ext_iff'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">sum_apply</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">MeasurableSet</span><span class=\"bp\">.</span><span class=\"n\">subtype_image</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">MeasurableEmbedding</span><span class=\"bp\">.</span><span class=\"n\">subtype_coe</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">homeomorphUnitSphereProd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">        </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">funext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">comp_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">homeomorphUnitSphereProd_symm_apply_coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">norm_smul</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">norm_eq_abs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_eq_of_mem_sphere</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sq_abs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_eq_mul_right_iff</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">inv_inj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat_ne_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">not_false_eq_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pow_eq_zero_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">abs_of_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">le_of_lt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)]</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">true_or</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hf'</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">volumeIoiPow</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">prod_withDensity_right</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">swap</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrable_withDensity_iff</span><span class=\"w\"> </span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">swap</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"bp\">.</span><span class=\"n\">ennreal_ofReal</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">        </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"bp\">.</span><span class=\"n\">pow_const</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Measurable</span><span class=\"bp\">.</span><span class=\"n\">comp</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurable_subtype_coe</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurable_snd</span>\n<span class=\"w\">      </span><span class=\"n\">swap</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">Eventually</span><span class=\"bp\">.</span><span class=\"n\">of_forall</span>\n<span class=\"w\">        </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal_lt_top</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">sphere</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">toReal</span><span class=\"o\">))</span>\n<span class=\"w\">          </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\">  </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">funext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">toReal_ofReal</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">        </span><span class=\"n\">ring_nf</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">coe_prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">          </span><span class=\"n\">linarith</span>\n<span class=\"w\">        </span><span class=\"n\">field_simp</span>\n<span class=\"w\">        </span><span class=\"n\">ring_nf</span>\n<span class=\"w\">        </span><span class=\"n\">field_simp</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">sq_nonneg</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hf''</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrable_prod_iff'</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">aestronglyMeasurable_iff_aemeasurable</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">        </span><span class=\"n\">fun_prop</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Integrable</span><span class=\"bp\">.</span><span class=\"n\">const_mul</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">volume_def</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrable_of_integral_eq_one</span>\n<span class=\"w\">        </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integral_subtype_comap</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">rfl</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurableSet_Ioi</span>\n<span class=\"w\">        </span><span class=\"n\">trans</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span>\n<span class=\"w\">          </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span><span class=\"w\">   </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span>\n<span class=\"w\">          </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fa</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">          </span><span class=\"n\">change</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fa</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span><span class=\"w\">  </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"bp\">_</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">MeasurePreserving</span><span class=\"bp\">.</span><span class=\"n\">setIntegral_image_emb</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ν</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">volume</span><span class=\"o\">)]</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">fa</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">fa</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurePreserving_add_left</span><span class=\"w\"> </span><span class=\"n\">volume</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">fa</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">measurableEmbedding_addLeft</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">        </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">∂</span><span class=\"n\">volume</span>\n<span class=\"w\">          </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">            </span><span class=\"n\">rfl</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">integral_Ioi_rpow_of_lt</span><span class=\"w\"> </span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">field_simp</span>\n<span class=\"w\">          </span><span class=\"n\">norm_num</span>\n<span class=\"w\">          </span><span class=\"n\">linarith</span>\n<span class=\"w\">          </span><span class=\"n\">linarith</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integrableOn_univ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">IntegrableOn</span><span class=\"bp\">.</span><span class=\"n\">congr_set_ae</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">ae_eq_set_compl</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∅</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)))</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">EventuallyEq</span><span class=\"bp\">.</span><span class=\"n\">of_eq</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">compl_empty</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">compl_compl</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">symm</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">invSq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">𝓢</span><span class=\"o\">((</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ℝ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">integralCLM</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">invSqMeasure</span>\n</code></pre></div>\n</div></div>",
        "id": 529485165,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752852995
    },
    {
        "content": "<p>I was thinking maybe it would be good to define e.g. the following notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"¹/r²\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">invSq</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>or similar.</p>\n<p>(edit: removed part of message which was incorrect).</p>",
        "id": 529507042,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1752862065
    },
    {
        "content": "<p>I have a construction of a distribution from a function bounded by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>r</mi><mi mathvariant=\"normal\">∣</mi><msup><mi mathvariant=\"normal\">∣</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>r</mi><mi mathvariant=\"normal\">∣</mi><msup><mi mathvariant=\"normal\">∣</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">c_1 ||r||^{-2} + c_2 ||r||^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord\">∣</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord\">∣</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> in this <a href=\"https://github.com/HEPLean/PhysLean/pull/653\">PR</a>. This is only for <code>EuclideanSpace ℝ (Fin 3)</code>, but I'm sure everything should generalize nicely. </p>\n<p>I'm not sure if this is something you're still aiming for <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> , but if so, I suspect anything you produce here will be better then what I have - in which case this PR can be ignored or overwritten at a later date :).</p>",
        "id": 529848562,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1753094286
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> there might be a bit of time before my next PR, sorry</p>",
        "id": 529856491,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753095322
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/Tempered.20distributions/with/548090282\">#PR reviews &gt; Tempered distributions</a> </p>\n<p><span class=\"user-mention\" data-user-id=\"412682\">@Moritz Doll</span> (sorry for pinging) has a series of PRs on tempered distributions which I believe is closely related to what's been done here (e.g. <a href=\"https://github.com/HEPLean/PhysLean/blob/master/PhysLean/Mathematics/Distribution/Basic.lean\">Distribution</a>) and we may want to update our version to match the mathlib version once it stabilizes. (I'm not so confident with the relevant maths yet)</p>",
        "id": 548192239,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1761925816
    },
    {
        "content": "<p>on a related note there's also <a href=\"https://github.com/leanprover-community/mathlib4/pull/30329\">#30329</a> on generalised distributions</p>",
        "id": 548192409,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1761925869
    },
    {
        "content": "<p>Agreed! I wonder if it is possible to set up a Zulip bot that would ping a message when PRs are merged with Mathlib, and/or when a PR becomes a part of a tagged version of Mathlib. I think this would be very helpful in keeping track of these things when they actually get merged, so we can act on them then.</p>",
        "id": 548194503,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761926333
    },
    {
        "content": "<p>I do know there's a Zulip topic <a class=\"stream-topic\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss/topic/Recent.20Commits.20to.20mathlib4.3Amaster/with/548251529\">#rss &gt; Recent Commits to mathlib4:master</a> which posts new merged PRs and includes a link to the PR so it seems like you could tell a bot to watch that topic and message you when certain PRs are mentioned. On the Github side I believe there's a way to link your PR to other ones and a bot there will comment changes. No idea how either of these work though</p>",
        "id": 548258266,
        "sender_full_name": "Daniel Morrison",
        "timestamp": 1761953480
    },
    {
        "content": "<p>The definition of tempered distributions has now been merged (sorry forgot to mention it here), there is very little of actual useful objects (there are PRs for embeddings, multiplication and derivatives), just the Fourier transform. Fourier multiplier and convolution are work in progress</p>",
        "id": 563948586,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765845643
    },
    {
        "content": "<p>Great <span class=\"user-mention\" data-user-id=\"412682\">@Moritz Doll</span>  - many thanks for postiing here ! We have some stuff specific for PhysLean around distributions in places over PhysLean e.g. </p>\n<p><a href=\"https://github.com/HEPLean/PhysLean/blob/094824dbb0fc6dad6cf46e99369a48b981cb9d88/PhysLean/SpaceAndTime/SpaceTime/Derivatives.lean#L273\">https://github.com/HEPLean/PhysLean/blob/094824dbb0fc6dad6cf46e99369a48b981cb9d88/PhysLean/SpaceAndTime/SpaceTime/Derivatives.lean#L273</a></p>\n<p>So when we next merge with Mathlib we need to remove our definition of a distribution and update all the lemmas around it. </p>\n<p>What do you mean by 'multiplication'? Multiplication of a distribution with what?</p>",
        "id": 563966236,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1765861612
    },
    {
        "content": "<p>Multiplication with a function of temperate growth (i.e., all derivatives are polynomially bounded)</p>",
        "id": 563966564,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1765861931
    },
    {
        "content": "<p>I'm a bit out of the loop on mathlib versions, are we ready to start this refactor or will it be in the next update?</p>",
        "id": 565278799,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766579714
    },
    {
        "content": "<p>I think we are ready to refactor now with our current update.</p>",
        "id": 565285198,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1766583734
    },
    {
        "content": "<p>I'll give it a go over Christmas (also to give myself a reason to learn the API). I'll probably come up with a lot of questions and will ask here.</p>",
        "id": 565285626,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766584010
    },
    {
        "content": "<p>so there is </p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> (defined as <code>abbrev Distribution := 𝓓^{n}(Ω, ℝ) →L_c[ℝ] F</code>)</p>\n<p>and </p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemperedDistribution#doc\">docs#TemperedDistribution</a> (defined as <code>𝓢(E, ℂ) →Lₚₜ[ℂ] F</code>)</p>\n<p>currently in Mathlib.</p>\n<p>I don't really understand the difference in terms of topology etc., from what I gathered we should use the second one.</p>\n<p>if my understanding is correct, should we just use the mathlib notation (i.e. <code>𝓢'(E, F)</code> for <code>TemperedDistribution E F</code>) instead of the current <code>E →d[𝕜] F</code>?</p>",
        "id": 565574177,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766933845
    },
    {
        "content": "<p>Yeah - I think we want the second one. I think the  “pt” is related to the topology of the whole space, which I don’t think we use so shouldn’t affect anything.  </p>\n<p>I personally would be in favour of keeping the ‘E →d[𝕜] F’ notation, since to me it echos that this is like a function, which is how a physicist thinks about them. But happy to hear arguments against</p>",
        "id": 565575443,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1766935031
    },
    {
        "content": "<p>my concern would be that if we are to use the mathlib API the notation mismatch might be confusing</p>",
        "id": 565576260,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766936031
    },
    {
        "content": "<p>Not sure it's the right place to share this video, but here is a nice use of schwartz space functions for non standard Traces detection in particle colliders :<br>\n<a href=\"https://www.youtube.com/watch?v=DRS7TbjVTNQ\">https://www.youtube.com/watch?v=DRS7TbjVTNQ</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"DRS7TbjVTNQ\" href=\"https://www.youtube.com/watch?v=DRS7TbjVTNQ\"><img src=\"https://uploads.zulipusercontent.net/e853426edf83947f6f589eaad477841284d74902/68747470733a2f2f692e7974696d672e636f6d2f76692f4452533754626a56544e512f6d7164656661756c742e6a7067\"></a></div>",
        "id": 565576892,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1766936855
    },
    {
        "content": "<p>Also mathlib define this for complex ℂ: <code>abbrev TemperedDistribution := 𝓢(E, ℂ) →Lₚₜ[ℂ] F</code> whereas the PhysLean definition has <code>[RCLike 𝕜]</code>. Just want to check that we do indeed want the ability to write real-valued distributions before pinging Moritz to ask about implementation details</p>",
        "id": 565584321,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766947925
    },
    {
        "content": "<p>Yeah, we are going to explicitly need it for the reals as well as the complex numbers. In electromagnetism, I think we only use it over the reals. I guess this is one advantage of the current notation - the field is explicit.</p>",
        "id": 565594840,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1766955203
    },
    {
        "content": "<p>The reason to bake in the complex numbers is that the main motivation for Schwartz functions (and tempered distributions) is the Fourier transform and that is only defined if the codomain is a complex vector space. So even when you solve a PDE that is purely real like the wave equation, you might want to work over the complex numbers.</p>",
        "id": 565596232,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1766957363
    },
    {
        "content": "<p>Thank you Moritz for explaining.</p>\n<p><del>I'm thinking about the following: Maybe we keep the PhysLean version for physical distributions (point charges, current densities etc.), then cast towards the Mathlib version when we need to do Fourier transforms?</del></p>",
        "id": 565596501,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766957754
    },
    {
        "content": "<p><del>The refactor will then be to match analogous API (lemma and proofs where possible) to the Mathlib (complex) version counterpart, but keeping both versions, <span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> do you think this is a good idea</del></p>",
        "id": 565596569,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766957884
    },
    {
        "content": "<p><del>I'm getting myself confused, should physical distributions (charges, currents) be <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> instead? the tempered part only comes in when we care about Fourier transforms etc.? but I also don't see any connection between <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemperedDistribution#doc\">docs#TemperedDistribution</a> in mathlib, not sure if this is due to both parts being very new or I'm completely misunderstanding things.</del></p>",
        "id": 565600424,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766964332
    },
    {
        "content": "<p>if I'm not mistaken <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TestFunction#doc\">docs#TestFunction</a> is ultimately the samething as <a href=\"https://physlean.com/docs/PhysLean/Mathematics/VariationalCalculus/IsTestFunction.html\">IsTestFunction</a> used in variational calculus, so it seems to me that we can refactor everything in mathlib API (not sure how challenging this will be)</p>",
        "id": 565600515,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766964496
    },
    {
        "content": "<p>sorry if this is a bit incoherent, it's late here and I'm quite confused about all of these, just summarizing my thoughts here:</p>\n<ol>\n<li>For physical distributions, the object we want is <code>𝓢(E, 𝕜) →L[𝕜] F</code> which is defined over both real and complex whereas the mathlib <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemperedDistribution#doc\">docs#TemperedDistribution</a> is only defined over the complex.</li>\n</ol>\n<ul>\n<li>\n<p>1.1 <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> requires compact support which is not necessarily the case for physical distributions so it is irrelevant here (is this correct?)</p>\n</li>\n<li>\n<p>1.2 Do we want to duplicate the mathlib API for multiplication and derivatives etc.?</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li><span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> in PhysLean, is distributions and variational calculus currently \"orthogonal\" in  the sense that they can be dealt with separately?</li>\n</ol>\n<ul>\n<li>2.1 a separate refactor of <a href=\"https://physlean.com/docs/PhysLean/Mathematics/VariationalCalculus/IsTestFunction.html\">IsTestFunction</a> should be done? </li>\n</ul>\n<ol start=\"3\">\n<li>Mathematically, <del>is it correct to say that tempered and has compact support are independent properties, and the mathlib definitions of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemeperedDistribution#doc\">docs#TemeperedDistribution</a> only conincide when the object has both?</del></li>\n</ol>\n<p>is it correct that compactly supported implies temperedness, so <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemeperedDistribution#doc\">docs#TemeperedDistribution</a> is strictly more general than <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> ?</p>",
        "id": 565601599,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1766966485
    },
    {
        "content": "<p>In response to your points: </p>\n<ol>\n<li>\n<p>Yes we want <code>𝓢(E, 𝕜) →L[𝕜] F</code>. <br>\n1.1 Yes, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a> is defined on  compactly supported functions whilst <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemeperedDistribution#doc\">docs#TemeperedDistribution</a> is defined on all Schwartz maps. Every compactly supported function is a Schwartz map, so every <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemeperedDistribution#doc\">docs#TemeperedDistribution</a> is also defined on all compactly supported functions, and thus is a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Distribution#doc\">docs#Distribution</a>. (as your last comment indicates). <br>\n1.2 We currently have derivatives for distributions, but not multiplication. I think it would be worth reproducing this. </p>\n</li>\n<li>\n<p>Yes, distributions and variational calculus are currently orthogonal. In fact, I think they might have to stay this way, since I do not know of anyway to even define a Lagrangian for distributions (instead of functions). <br>\n2.1. I think a refactoring for IsTestFunction should be done.</p>\n</li>\n</ol>",
        "id": 565604360,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1766971170
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"412682\">@Moritz Doll</span>  May I ask why does mathlib use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LineDeriv#doc\">docs#LineDeriv</a> for SchwartzMap and TemperedDistribution instead of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=fderiv#doc\">docs#fderiv</a> ? </p>\n<p>I'm trying to understand the difference between the mathlib inplementation and <a href=\"https://physlean.com/docs/PhysLean/Mathematics/Distribution/Basic.html#Distribution.fderivD\">https://physlean.com/docs/PhysLean/Mathematics/Distribution/Basic.html#Distribution.fderivD</a>, especially on the usage of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SchwarzMap.fderivCLM#doc\">docs#SchwarzMap.fderivCLM</a></p>\n<p>I'm guessing it makes some Fourier stuff easier, but I have never used LineDeriv before so not really sure what's the difference, and if there's a way to convert between the two</p>",
        "id": 573321467,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770824653
    },
    {
        "content": "<p>I think it is way more convenient in distribution theory to deal with maps with equal domain and codomain. If you use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=fderiv#doc\">docs#fderiv</a> directly (and we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SchwartzMap.fderivCLM#doc\">docs#SchwartzMap.fderivCLM</a>), then the definition for distributions becomes lengthy because you have to rearrange the evaluation map. This is exactly why the definition of <code>fderivD</code> is so tedious. However the definition for the directional derivative is just one line, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemperedDistribution.instLineDeriv#doc\">docs#TemperedDistribution.instLineDeriv</a>.<br>\nNote that <code>lineDerivOp</code> is mainly for the notation (and then there are algebraic type-classes on top), so it all looks very nice (and consistent).<br>\nFor the Fourier transform on Schwartz functions, we proved <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SchwartzMap.fderivCLM_fourier_eq#doc\">docs#SchwartzMap.fderivCLM_fourier_eq</a> first and then deduced the variants for the line derivative, whereas for tempered distributions it follows for the line derivatives directly from duality, so no <code>fderivCLM</code> needed.</p>",
        "id": 573398067,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1770848436
    },
    {
        "content": "<p>Many thanks <span class=\"user-mention\" data-user-id=\"412682\">@Moritz Doll</span>  for typing this out. I've tried playing around with it a bit but am still kind of lost (could very well be my knowledge of distributions isn't good enough), I'm wondering would it be possible to demonstrate something like derivative of the heaviside step function (not even sure how to write this as a distribution) equals Dirac delta or is this actually much more completed than I think.</p>\n<p>(<span class=\"user-mention\" data-user-id=\"653351\">@Joseph Tooby-Smith</span> I thought you had something along these lines for 1D point charge, is it still somewhere in PhysLean or am I misremembering?)</p>",
        "id": 573417748,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770858874
    },
    {
        "content": "<p>There is a bit of stuff missing, but nothing too major:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Distribution</span><span class=\"bp\">.</span><span class=\"n\">TemperedDistribution</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">SchwartzMap</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">LineDeriv</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">heaviside</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">𝓢'</span><span class=\"o\">(</span><span class=\"n\">ℝ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">cont</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">heaviside_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">𝓢</span><span class=\"o\">(</span><span class=\"n\">ℝ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">heaviside</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioi</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">lineDerivOp_eq_deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">𝓢</span><span class=\"o\">(</span><span class=\"n\">ℝ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∂_</span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">linederiv_heaviside</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∂_</span><span class=\"o\">{(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"n\">heaviside</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">TemperedDistribution</span><span class=\"bp\">.</span><span class=\"n\">delta</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TemperedDistribution</span><span class=\"bp\">.</span><span class=\"n\">lineDerivOp_apply_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">heaviside_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">SchwartzMap</span><span class=\"bp\">.</span><span class=\"n\">neg_apply</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">lineDerivOp_eq_deriv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TemperedDistribution</span><span class=\"bp\">.</span><span class=\"n\">delta_apply</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">integral_Ioi_of_hasDerivAt_of_tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">hasDerivAt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">neg</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Integrable</span><span class=\"bp\">.</span><span class=\"n\">integrableOn</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">derivCLM</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">integrable</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>obviously not mathlib level code. The last sorry is obviously true and follows from the statement about cocompact filters in mathlib.</p>",
        "id": 573419910,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1770860531
    },
    {
        "content": "<p>Thanks! I'll try to work through this later</p>",
        "id": 573420863,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770861137
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"890057\">@ZhiKai Pong</span>  This was for the point particle in 1 dimension, but I replaced the heaviside step function with (x-r)/||x-r||, as this was more general, and carried over to higher dimensions. </p>\n<p>The corresponding derivatives are calculated in this file:</p>\n<p><a href=\"https://github.com/lean-phys-community/PhysLean/blob/master/PhysLean/SpaceAndTime/Space/Norm.lean\">https://github.com/lean-phys-community/PhysLean/blob/master/PhysLean/SpaceAndTime/Space/Norm.lean</a> </p>\n<p>Maybe the thing to do here is relate <code>fderiv</code> of our distributions to <code>linederiv</code>, if possible.</p>",
        "id": 573439162,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1770874997
    },
    {
        "content": "<p>Yea I'm planning to refactor the relevant PhysLean parts to follow Mathlib more closely, I'm still experimenting to see how everything fits together, especially since we want to be able to do stuff with <code>𝓢(E, 𝕜) →L[𝕜] F</code>, maybe we just duplicate the whole <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TemperedDistribution#doc\">docs#TemperedDistribution</a> API but I'll think about it</p>",
        "id": 573470355,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770888096
    },
    {
        "content": "<p>I can see this being a source of confusion (it already is quite confusing) I'm thinking maybe some sort of namespace structuring might be helpful but we should probably be more careful about this and think this through</p>",
        "id": 573471674,
        "sender_full_name": "ZhiKai Pong",
        "timestamp": 1770888476
    },
    {
        "content": "<p>In PhysLean we have the condition <a href=\"https://physlean.com/docs/PhysLean/SpaceAndTime/Space/IsDistBounded.html#Space.IsDistBounded\">IsDistBounded</a> which is different from <code>HasTemperateGrowth</code> (in particular it deals with non-smooth functions such as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>↦</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mi mathvariant=\"normal\">∥</mi><mi>x</mi><mi mathvariant=\"normal\">∥</mi></mrow><annotation encoding=\"application/x-tex\">x \\mapsto 1/\\|x\\|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.522em;vertical-align:-0.011em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">↦</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1/∥</span><span class=\"mord mathnormal\">x</span><span class=\"mord\">∥</span></span></span></span>, which often appear in physics). </p>\n<p>We have things like the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">distOfFunction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Space</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">basis</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">fun_prop</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Here the <code>by fun_prop</code> is a proof of a <code>IsDistBounded</code> lemma. I am wondering if we can define a macro, so we can make this look much more like a function. I'm thinking of something like: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⸨‖</span><span class=\"n\">x</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">basis</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⸩ᵈ</span>\n</code></pre></div>\n<p>to represent the above, where the <code>x</code> is automatically inferred  and the <code>fun_prop</code> is automatically proved.</p>",
        "id": 573759094,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1770993903
    },
    {
        "content": "<p>In addition to the above, maybe some sort of equality <code>=d</code>  which takes a distribution on the left and a function on the right, and is true when the distribution corresponds to the integration of the function.</p>",
        "id": 574154207,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1771261729
    },
    {
        "content": "<p>I have put an implementation of the <code>⸨‖x‖ ^ (- d.succ : ℤ) • basis.repr x⸩ᵈ</code> style notation in <a href=\"https://github.com/HEPLean/PhysLean/pull/953\">PhysLean#953</a>, along with some other simplifying definitions around distributions.</p>",
        "id": 574743733,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1771511713
    }
]