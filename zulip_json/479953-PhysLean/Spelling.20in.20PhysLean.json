[
    {
        "content": "<p>I made a low-tech linter for spelling documentation in PhysLean. </p>\n<p>I basically made a list of all the words that appear in PhysLean to date, got an AI to remove the ones which where incorrectly spelled or manifestly do not correspond to code etc., thereby creating a list of <code>allowed words</code>. Then checked all the documentation agains this list of <code>allowed words</code>.  Naturally any new words would have to be added to the allowed words list, and it doesn't deal with code snippets in documentation in any smart way. </p>\n<p>The corresponding PR is <a href=\"https://github.com/HEPLean/PhysLean/pull/781\">PhysLean#781</a>. If anyone has better ways we could 'lint' for spelling I would be very glad to hear them.</p>",
        "id": 546634823,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761212581
    },
    {
        "content": "<p>interesting, i was thinking about doing something similar for mathlib (also with the help of GPT) but it ended up very slow so i ended up only correcting 300 files; i think you'll just have to do it every month or so; did you make the corrections manually or with LLM? i was also wondering if there were ways to speed up the process</p>",
        "id": 546635496,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761212800
    },
    {
        "content": "<p>I ended up doing the actual corrections manually, it took about 2 hours to do so wasn't so bad. Though I had to keep pasting words in to MS word to get suggestions for the correct spellings which was a bit of a pain. </p>\n<p>I think if one keeps on top of it, it should be much quicker to do it in the future. But yeah, I am hoping there is a much quicker way to go about this. I think the main problem is the number of specialized words in maths/physics, so that a normal dictionary would not cover it.</p>",
        "id": 546636578,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761213137
    },
    {
        "content": "<p>yeah I just fed entire files to GPT so that it has enough context</p>",
        "id": 546636666,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761213167
    },
    {
        "content": "<p>I suppose you could isolate the errors and then feed like -2/+2 lines to GPT and have it correct the error</p>",
        "id": 546636760,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761213194
    },
    {
        "content": "<p>Yeah - and then maybe a yes or no type thing to allow someone to easily allow or disallow a change :).</p>",
        "id": 546814947,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761285350
    },
    {
        "content": "<p>Based on <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> suggestion I have segregated the meta code for the spelling PR away from the 100s of spelling corrections. The meta code is in <a href=\"https://github.com/HEPLean/PhysLean/pull/783\">PhysLean#783</a>.</p>",
        "id": 546815128,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1761285467
    },
    {
        "content": "<p>The standard practice that I know is used in <a href=\"https://github.com/zulip/zulip\">Zulip</a> is via <code>codespell</code>, which detects for common typos. I caught 57 typos running the tool, 14 of which is in this PR: <a href=\"https://github.com/HEPLean/PhysLean/pull/866\">https://github.com/HEPLean/PhysLean/pull/866</a>.</p>\n<p>The codespell linter can be enabled via pre-commit (e.g. <a href=\"https://github.com/mesa/mesa/blob/e9054adbb9efb626d0d038fe8c5178d34338e1ab/.pre-commit-config.yaml#L27-L30\">https://github.com/mesa/mesa/blob/e9054adbb9efb626d0d038fe8c5178d34338e1ab/.pre-commit-config.yaml#L27-L30</a>), which is much faster than running it as GH Actions.</p>",
        "id": 565713976,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767037083
    },
    {
        "content": "<p>Note: I only included 14 to keep the PR small, not because the rest are false positives.</p>",
        "id": 565714349,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767037373
    },
    {
        "content": "<p>Nice! I approved your PR, and merged it. What sort of configuration does codespell need? Is it in a sense 'ready to go', or does one have to teach it about Lean (say)?</p>",
        "id": 565747613,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767072750
    },
    {
        "content": "<p>This is the content of the <code>.codespellignore</code> that I used:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">digitalize</span>\n<span class=\"n\">statics</span>\n<span class=\"n\">disjointness</span>\n<span class=\"n\">lightYears</span>\n<span class=\"n\">tne</span>\n<span class=\"n\">hge</span>\n<span class=\"n\">Breal</span>\n<span class=\"n\">ket</span>\n<span class=\"n\">rIn</span>\n<span class=\"n\">FRO</span>\n</code></pre></div>\n<p><code>codespell</code> focuses on typical typos, instead of programmatically check the edit distance with all the English dictionary terms, its dictionary is in the form of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">aaccess</span><span class=\"bp\">-&gt;</span><span class=\"n\">access</span>\n<span class=\"n\">aaccessibility</span><span class=\"bp\">-&gt;</span><span class=\"n\">accessibility</span>\n<span class=\"n\">aaccession</span><span class=\"bp\">-&gt;</span><span class=\"n\">accession</span>\n<span class=\"n\">aache</span><span class=\"bp\">-&gt;</span><span class=\"n\">cache</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ache</span><span class=\"o\">,</span>\n<span class=\"n\">aack</span><span class=\"bp\">-&gt;</span><span class=\"n\">ack</span>\n<span class=\"n\">aactual</span><span class=\"bp\">-&gt;</span><span class=\"n\">actual</span>\n<span class=\"n\">aactually</span><span class=\"bp\">-&gt;</span><span class=\"n\">actually</span>\n<span class=\"n\">aadd</span><span class=\"bp\">-&gt;</span><span class=\"n\">add</span>\n</code></pre></div>\n<p>(<a href=\"https://github.com/codespell-project/codespell/blob/main/codespell_lib/data/dictionary.txt\">https://github.com/codespell-project/codespell/blob/main/codespell_lib/data/dictionary.txt</a>)</p>\n<p>And so, I only had to teach few PhysLean-specific variables that sound like typos.</p>",
        "id": 565750594,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767075357
    },
    {
        "content": "<p>Great! This looks really nice, and it seems possible to use this as a get this setup as a GitHub workflow, right?</p>",
        "id": 565771611,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767090969
    },
    {
        "content": "<p>Yes, by committing a .pre-commit-config.yaml, and registering the repo in <a href=\"https://pre-commit.com/\">https://pre-commit.com/</a>. Mathlib actually uses a hook, although not codespell: <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.pre-commit-config.yaml\">https://github.com/leanprover-community/mathlib4/blob/master/.pre-commit-config.yaml</a>.</p>",
        "id": 565772728,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767091663
    },
    {
        "content": "<p>Before merging your PR, I would like to get a better understanding of pre-commit. Do you know how it differs from GithHub workflows, sorry if I'm being a bit slow with regard to this.</p>",
        "id": 565785146,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767098943
    },
    {
        "content": "<p>It will show up in the list of checks just like with GH Actions (e.g. <a href=\"https://github.com/mesa/mesa/pull/3041\">https://github.com/mesa/mesa/pull/3041</a> where the CI passed). There won't be a bot that noisily says \"pre-commit passed/failed\", no worries.</p>",
        "id": 565785340,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767099098
    },
    {
        "content": "<p>Upon checking Mathlib, they didn't use the pre-commit SaaS (<a href=\"https://github.com/leanprover-community/mathlib4/pull/33404\">https://github.com/leanprover-community/mathlib4/pull/33404</a>). They seemed to only use pre-commit locally.</p>",
        "id": 565785475,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767099181
    },
    {
        "content": "<p>pre-commit can run locally before you commit. <br>\nI consider pre-commit to be a bad idea because it blocks the local development workflow.<br>\nIt's really better in my view to have linters in IDE and in CI/CD, but not pre-commits.</p>",
        "id": 565785573,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1767099245
    },
    {
        "content": "<blockquote>\n<p>I consider pre-commit to be a bad idea because it blocks the local development workflow.</p>\n</blockquote>\n<p>I personally have  used the pre-commit config for CI purposes only in the past. But, that said, some found <del>it</del>the local version to be useful. I was skimming past threads in this Zulip server by searching for keyword \"pre-commit\".</p>",
        "id": 565786014,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767099556
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"158609\">@Rein Zustand</span> Do you know if there is a similar way that we can do something like <code>codespell</code> without using pre-commit, or are they somehow intrinsically linked? I still don't have a good mental model of pre-commit, but I will try and get one over the next few days.</p>\n<p>In the mean time, could we separate the spelling corrections in <a href=\"https://github.com/HEPLean/PhysLean/pull/868\">PhysLean#868</a> from the initalization of .pre-commit-config.yaml?</p>",
        "id": 565822941,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767121582
    },
    {
        "content": "<p><del>No</del>, I meant, yes, <code>codespell</code> can be used with the usual GH Actions, it's just a CLI tool. In the past, in the repositories I maintained (e.g. <a href=\"https://github.com/mesa/mesa\">https://github.com/mesa/mesa</a>), I had looked for optimizing the run time for lightweight CLI tools, and found pre-commit CI to be much faster than GH Actions. No need for container initialization, setting up dependencies, etc.</p>",
        "id": 565825752,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767123279
    },
    {
        "content": "<p>In case if you wonder if using pre-commit CI might be a niche solution. It is actually used by several major FOSS projects:</p>\n<ul>\n<li>pylint <a href=\"https://results.pre-commit.ci/run/github/47671127/1767085347.rZadMeHCQ-aHliegxFNCZg\">https://results.pre-commit.ci/run/github/47671127/1767085347.rZadMeHCQ-aHliegxFNCZg</a></li>\n<li>pandas <a href=\"https://results.pre-commit.ci/run/github/858127/1767003206.C6pZ2L4_SaW7vJJHqpQIRg\">https://results.pre-commit.ci/run/github/858127/1767003206.C6pZ2L4_SaW7vJJHqpQIRg</a></li>\n<li>pypa/build <a href=\"https://results.pre-commit.ci/run/github/262827329/1766734314.v83Ah6i8T9OynSUfqp6oOA\">https://results.pre-commit.ci/run/github/262827329/1766734314.v83Ah6i8T9OynSUfqp6oOA</a></li>\n</ul>\n<p>Python-only in the list. There are Rust projects using it as well, but not necessarily the foundational projects like the ones listed above.</p>",
        "id": 565827436,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767124544
    },
    {
        "content": "<p>I would really encourage the GH actions route. It's not that bad to have the CI take a litle more time for a lint feature and evoid a Python dependency when it's not necessary.</p>",
        "id": 565833971,
        "sender_full_name": "Alfredo Moreira-Rosa",
        "timestamp": 1767128914
    },
    {
        "content": "<p>Using GH Actions about as long as the current Python-based linter in the CI (7s of which is due to installing Python). ~15s vs ~5s.</p>",
        "id": 565834700,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767129510
    },
    {
        "content": "<p>Ok, given these times are much smaller compared to the Lean longer, I would think a GH action is probably the way to go for now (can always modify later). <span class=\"user-mention\" data-user-id=\"158609\">@Rein Zustand</span>  would you be able to make a PR implementing it as a GH action?</p>",
        "id": 565862340,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1767158327
    },
    {
        "content": "<p>Changed to GH Actions: <a href=\"https://github.com/HEPLean/PhysLean/pull/868\">https://github.com/HEPLean/PhysLean/pull/868</a>.</p>",
        "id": 565887026,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1767179423
    }
]