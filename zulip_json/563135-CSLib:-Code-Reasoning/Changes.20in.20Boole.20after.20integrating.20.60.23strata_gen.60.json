[
    {
        "content": "<p>We replaced the old handwritten <code>DDMTransform.Translate</code> pipeline with the generated <code>BooleDDM.*</code> produced by <code>#strata_gen</code>.</p>\n<p>Previously the pipeline was:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Strata</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">representation</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">translateProgram</span><span class=\"w\">   </span><span class=\"o\">(</span><span class=\"n\">handwritten</span><span class=\"w\"> </span><span class=\"n\">parser</span><span class=\"bp\">/</span><span class=\"n\">translation</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Boole</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Boogie</span><span class=\"bp\">-</span><span class=\"n\">style</span><span class=\"w\"> </span><span class=\"n\">AST</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">handwritten</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">toCoreProgram</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">handwritten</span><span class=\"w\"> </span><span class=\"n\">translation</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">representation</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">verify</span>\n</code></pre></div>\n<p>Here, <code>Boole.Program</code> was essentially a copy of the Boogie AST, and <code>translateProgram</code> was a handwritten parser that converted Lean syntax into that AST (largely duplicating Strata/Core parsing logic).</p>\n<p>Now it is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Strata</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\">               </span><span class=\"o\">(</span><span class=\"n\">representation</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">BooleDDM</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"bp\">.</span><span class=\"n\">ofAst</span><span class=\"w\">   </span><span class=\"o\">(</span><span class=\"n\">generated</span><span class=\"w\"> </span><span class=\"n\">parser</span><span class=\"bp\">/</span><span class=\"n\">translation</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">BooleDDM</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\">       </span><span class=\"o\">(</span><span class=\"n\">AST</span><span class=\"w\"> </span><span class=\"n\">generated</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"n\">strata_gen</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">toCoreProgram</span><span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">handwritten</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">WIP</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">Program</span><span class=\"w\">       </span><span class=\"o\">(</span><span class=\"n\">representation</span><span class=\"o\">)</span>\n<span class=\"w\">          </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">verify</span>\n</code></pre></div>\n<p>Both <code>translateProgram</code> (before) and <code>BooleDDM.Program.ofAst</code> (now) act as parsers: they take Lean syntax and construct a Boole AST (Strata → Boole). The difference is that this step is now generated automatically. The only remaining handwritten step is <code>toCoreProgram</code> (BooleDDM → Core).</p>\n<p>With this refactoring, we reuse the shared Strata generation/translation infrastructure instead of maintaining our own frontend translation logic, which reduces duplication and keeps Boole aligned with the common Strata architecture.</p>",
        "id": 574878871,
        "sender_full_name": "Lydia Kondylidou",
        "timestamp": 1771572027
    }
]