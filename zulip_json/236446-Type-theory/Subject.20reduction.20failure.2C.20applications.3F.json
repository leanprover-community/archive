[
    {
        "content": "<p>I've heard through the years about quotient types breaking subject reduction, and how it's a problem for theory.</p>\n<p>Something I've never heard though is whether there are <em>applications</em> of subject reduction failure. Is it something that can be taken advantage of in some way?</p>\n<p>For example, perhaps it can be wielded to make a term that relieves some dependence issues, for example a term that has type <code>Fin (n + m)</code> in one context but <code>Fin (m + n)</code> in another.</p>\n<p>(Out of scope for this discussion: whether this is a good idea or not. The question is motivated out of a <a href=\"http://www.catb.org/jargon/html/H/hacker.html\">hacker</a> spirit to see what's possible <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span>)</p>",
        "id": 532581698,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1754242890
    },
    {
        "content": "<p>In <a href=\"https://github.com/digama0/lean-type-theory/releases/tag/v1.0\">#leantt</a> there are two notions of definitional equality, the ideal one and the algorithmic one. The ideal definitional equality satisfies subject reduction, while the algorithmic one fails due to a lack of transitivity caused by subsingleton elimination. If I'm not mistaken, the ideal definitional equality is the transitive closure of the algorithmic definitional equality, so I think there cannot be an application of the subject reduction failure in the way you describe.</p>",
        "id": 532836082,
        "sender_full_name": "Parth Shastri",
        "timestamp": 1754371225
    },
    {
        "content": "<p>Side note: The subject reduction failure (really the defeq transitivity failure) for quotient types is easily fixable (just bump the universe to <code>max 1 u</code> since quotients of <code>Prop</code>s are useless). The actual problem is with <code>Acc</code>, used in well-founded recursion, and it isn't just a problem for theory. This is the reason why well-founded definitions don't satisfy definitional equations. For example, <code>Nat.log2 2 = 1</code> would be provable by <code>rfl</code> if not for the defeq transitivity failure:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">log2</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">log2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Acc</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Acc</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">log2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">log2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">log2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">log2</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\">                                       </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\">          </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_wfRel</span><span class=\"bp\">.</span><span class=\"n\">wf</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\">          </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">                                         </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 532844734,
        "sender_full_name": "Parth Shastri",
        "timestamp": 1754376311
    },
    {
        "content": "<p>What if you add axioms like <code>Quot.sound</code></p>",
        "id": 532882120,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754388221
    },
    {
        "content": "<p>Axioms don't add new definitional equalities</p>",
        "id": 532927621,
        "sender_full_name": "Parth Shastri",
        "timestamp": 1754403614
    },
    {
        "content": "<p>I guess yeah</p>",
        "id": 532935009,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754405999
    },
    {
        "content": "<p>if you don't add any new definitional equalities you can't have more stuff be definitionally equal</p>",
        "id": 532935077,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754406019
    },
    {
        "content": "<p>You might be interested in this PA.SX answer (by me) on the subject including lots of links back to Zulip.  <a href=\"https://proofassistants.stackexchange.com/a/1194\">https://proofassistants.stackexchange.com/a/1194</a></p>",
        "id": 533379725,
        "sender_full_name": "Jason Rute",
        "timestamp": 1754611931
    }
]