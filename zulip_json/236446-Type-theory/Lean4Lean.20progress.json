[
    {
        "content": "<p>I wanted to share that Lean4Lean has just reached a major milestone: The <code>inferType</code> function has been <a href=\"https://github.com/digama0/lean4lean/blob/c50b155ad6f2b7a79bd47eb05471fee2a8252f8f/Lean4Lean/Verify/TypeChecker/Theorems.lean#L1222-L1225\">proved correct</a>. This constitutes about 1/3 of the main typechecker, excluding inductive types. The other two main functions are <code>whnf</code> and <code>isDefEq</code>.</p>\n<p>I've also started cataloguing <a href=\"https://github.com/digama0/lean4lean/blob/master/divergences.md\">places where lean4lean intentionally differs from the lean kernel</a>, often to fix bugs, as well as a <a href=\"https://github.com/digama0/lean4lean/blob/master/bugs-found.md\">trophy case</a> of kernel bugs found in the course of formalization.</p>",
        "id": 541108980,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758665435
    },
    {
        "content": "<p>How confident are, you based on this proof, that the C++ equivalent in the upstream kernel is also correct?</p>",
        "id": 541109966,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1758665955
    },
    {
        "content": "<p>Very, modulo the documented issues. I have a file of axioms, some of which are known to be false, for example the one about substring reflexivity (<a href=\"https://github.com/leanprover/lean4/pull/10511\">lean4#10511</a>). The divergences should be upstreamed though, because otherwise I'm proving things about a kernel that is not the one upstream</p>",
        "id": 541111906,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758667006
    },
    {
        "content": "<p>Oh, I managed to turn that one into a <code>native_decide</code> unsoundness:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mdata</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">[(</span><span class=\"ss\">`_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofSyntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"s2\">\"\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`_</span><span class=\"w\"> </span><span class=\"o\">[]))]</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">mdata</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">[(</span><span class=\"ss\">`_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofSyntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"s2\">\"\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`_</span><span class=\"w\"> </span><span class=\"o\">[]))]</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≠</span>\n<span class=\"w\">         </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">native_decide</span>\n<span class=\"w\">  </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>this happens because <code>Expr</code> assumes equality is reflexive to justify a pointer equality optimization</p>",
        "id": 541112941,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758667602
    },
    {
        "content": "<p>so it's less that I know the upstream kernel is correct but I know it's incorrect and why</p>",
        "id": 541113087,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758667685
    },
    {
        "content": "<p>The divergences about checking primitives aren't even something I have made an attempt to upstream, because I know what the core team will say: we don't care if the lean kernel is unsound if you have to rewrite the prelude, that's not a supported way to use lean</p>",
        "id": 541113282,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758667795
    },
    {
        "content": "<p>Here are the list of axioms and sorries:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">'</span><span class=\"n\">Lean4Lean</span><span class=\"bp\">.</span><span class=\"n\">TypeChecker</span><span class=\"bp\">.</span><span class=\"n\">Inner</span><span class=\"bp\">.</span><span class=\"n\">inferType'</span><span class=\"bp\">.</span><span class=\"n\">WF'</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">axioms</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">propext</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">sorryAx</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"bp\">.</span><span class=\"n\">choice</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">sound</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">abstractRange_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">abstract_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">eqv_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">hasLevelParam_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">hasLooseBVar_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">instantiate1_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">instantiateRevRange_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">instantiateRev_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">instantiate_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">looseBVarRange_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">lowerLooseBVars_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">replace_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Level</span><span class=\"bp\">.</span><span class=\"n\">hasMVar_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Level</span><span class=\"bp\">.</span><span class=\"n\">hasParam_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Level</span><span class=\"bp\">.</span><span class=\"n\">instLawfulBEqLevel</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PersistentArray</span><span class=\"bp\">.</span><span class=\"n\">toList'_push</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PersistentHashMap</span><span class=\"bp\">.</span><span class=\"n\">findAux_isSome</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Substring</span><span class=\"bp\">.</span><span class=\"n\">beq_refl</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">structEq_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">mkAppRangeAux</span><span class=\"bp\">.</span><span class=\"n\">eq_def</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PersistentHashMap</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">find?_eq</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PersistentHashMap</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">toList'_insert</span><span class=\"o\">]</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">VInductDecl</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"kt\">Prop</span>\n<span class=\"n\">VEnv</span><span class=\"bp\">.</span><span class=\"n\">addInduct</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">VEnv</span>\n<span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">VExpr</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">VExpr</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">VExpr</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"n\">VEnv</span><span class=\"bp\">.</span><span class=\"n\">addInduct_WF</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">env'</span><span class=\"bp\">.</span><span class=\"n\">Ordered</span>\n<span class=\"n\">inferProj</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">RecM</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inferProj</span><span class=\"w\"> </span><span class=\"n\">st</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">ety</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">ty'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">TrTyping</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">st</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">ty'</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">weakN</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">Γ'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">liftN</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">liftN</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">wf</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">WF</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">e'</span>\n<span class=\"n\">VEnv</span><span class=\"bp\">.</span><span class=\"n\">IsDefEq</span><span class=\"bp\">.</span><span class=\"n\">uniq</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">IsDefEq</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">uniq</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">IsDefEqU</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">Γ₁</span><span class=\"w\"> </span><span class=\"n\">e₁'</span><span class=\"w\"> </span><span class=\"n\">e₂'</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">defeqDFC</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">Γ₂</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e₂</span><span class=\"w\"> </span><span class=\"n\">e'</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">instL</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">instL</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">instL</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">instL</span><span class=\"w\"> </span><span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"o\">)</span>\n<span class=\"n\">VEnv</span><span class=\"bp\">.</span><span class=\"n\">IsDefEqU</span><span class=\"bp\">.</span><span class=\"n\">weakN_iff</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">IsDefEqU</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"n\">e2</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">weakN_inv</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">Γ'</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">liftN</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">e'</span>\n<span class=\"n\">TrProj</span><span class=\"bp\">.</span><span class=\"n\">instN</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">TrProj</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"n\">e₀</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e'</span><span class=\"bp\">.</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"n\">e₀</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span>\n<span class=\"n\">VEnv</span><span class=\"bp\">.</span><span class=\"n\">IsDefEqU</span><span class=\"bp\">.</span><span class=\"n\">forallE_inv</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">IsDefEq</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">A'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">IsDefEq</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">B'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">VExpr</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Obviously this is rather different in character from a pure math project. Most of the axioms are un-opaquing an <code>opaque</code> or <code>partial</code> definition. Most of the sorries have to do with support for inductives, plus the big questions about injectivity of type constructors and unique typing.</p>",
        "id": 541115698,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1758669260
    }
]