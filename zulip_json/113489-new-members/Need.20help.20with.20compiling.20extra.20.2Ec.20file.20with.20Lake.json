[
    {
        "content": "<p>I am using <code>Lean (version 4.7.0, aarch64-apple-darwin, commit 6fce8f7d5cd1, Release)</code>.</p>\n<p>Consider a simple lake project: <code>lake new MyLibrary lib</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">MyLibrary</span>\n<span class=\"bp\">├──</span><span class=\"w\"> </span><span class=\"n\">MyLibrary</span>\n<span class=\"bp\">│</span><span class=\"w\">   </span><span class=\"bp\">└──</span><span class=\"w\"> </span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">├──</span><span class=\"w\"> </span><span class=\"n\">MyLibrary</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">├──</span><span class=\"w\"> </span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">└──</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n</code></pre></div>\n<p>And lakefile.lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">MyLibrary</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add package configuration options here</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">MyLibrary</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add library configuration options here</span>\n</code></pre></div>\n<p>I would like to create a new file: <code>MyLibrary.c</code> along side <code>MyLibrary.lean</code> and have Lake compile and link it with all the other generated .c files.</p>\n<p>Based on an initial search, I found out about <code>library_facet</code> and <code>module_facet</code>, which seems to be the way to go. But how?</p>\n<p>Could someone get me started?</p>\n<p>thanks,</p>",
        "id": 441052919,
        "sender_full_name": "Yuri",
        "timestamp": 1716906483
    },
    {
        "content": "<p>I realized that I should have posted this in the lean4 channel?</p>",
        "id": 441053112,
        "sender_full_name": "Yuri",
        "timestamp": 1716906542
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"463095\">Yuri de Wit</span> <a href=\"#narrow/stream/113489-new-members/topic/Need.20help.20with.20compile.20extra.20.2Ec.20file.20with.20Lake/near/441052919\">said</a>:</p>\n<p>I can create a library_facet and I can explicitly invoke it using <code>lake build MyLibrary:test</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">library_facet</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"test!\"</span>\n<span class=\"w\">  </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"s2\">\"test!!\"</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n</code></pre></div>\n<p>How can I make this run automatically when the the library is built? Adding the facet does not work.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">defaultFacets</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`test</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">nativeFacets</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"ss\">`test</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Or maybe I misunderstand what is the purpose of a library_facet?</p>",
        "id": 441061492,
        "sender_full_name": "Yuri",
        "timestamp": 1716909120
    }
]