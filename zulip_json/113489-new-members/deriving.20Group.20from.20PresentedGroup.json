[
    {
        "content": "<p>I am following the example from MIL and <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/Group.20presentation.20hom.20injective/with/394515617\">#new members &gt; Group presentation hom injective</a>  but I am not sure why I cannot derive the <code>Group</code> instance in the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Symbols</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FreeGroup</span><span class=\"w\"> </span><span class=\"n\">Symbols</span><span class=\"w\"> </span><span class=\"n\">PresentedGroup</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">The set of relations for the group presentation ⟨x, y | x^n = y^2, y * x * y⁻¹ = x⁻¹ ⟩</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Relations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FreeGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Symbols</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">∪</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myGroup</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">PresentedGroup</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Relations</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Group</span>\n</code></pre></div>",
        "id": 503663533,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741219811
    },
    {
        "content": "<p>There is no <code>deriving</code> handler for group.</p>",
        "id": 503663681,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741219910
    },
    {
        "content": "<p>Maybe something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Symbols</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FreeGroup</span><span class=\"w\"> </span><span class=\"n\">Symbols</span><span class=\"w\"> </span><span class=\"n\">PresentedGroup</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">The set of relations for the group presentation ⟨x, y | x^n = y^2, y * x * y⁻¹ = x⁻¹ ⟩</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Relations</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FreeGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Symbols</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">∪</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">myGroup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PresentedGroup</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Relations</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myGroup</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 503663765,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741219939
    },
    {
        "content": "<p>Hmm maybe MIL is a bit misleading? <br>\n<a href=\"/user_uploads/3121/JBWLLNUon4HXM8pqgkzQyhxX/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/JBWLLNUon4HXM8pqgkzQyhxX/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"911x285\" src=\"/user_uploads/thumbnail/3121/JBWLLNUon4HXM8pqgkzQyhxX/image.png/840x560.webp\"></a></div><p>In the chapter <a href=\"https://leanprover-community.github.io/mathematics_in_lean/C08_Groups_and_Rings.html\">https://leanprover-community.github.io/mathematics_in_lean/C08_Groups_and_Rings.html</a></p>",
        "id": 503663835,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741219987
    },
    {
        "content": "<p>thank you <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  !</p>",
        "id": 503663876,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741220016
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634542\">Alex Brodbelt</span> <a href=\"#narrow/channel/113489-new-members/topic/deriving.20Group.20from.20PresentedGroup/near/503663835\">said</a>:</p>\n<blockquote>\n<p>Hmm maybe MIL is a bit misleading? <br>\n<a href=\"/user_uploads/3121/JBWLLNUon4HXM8pqgkzQyhxX/image.png\">image.png</a></p>\n<p>In the chapter <a href=\"https://leanprover-community.github.io/mathematics_in_lean/C08_Groups_and_Rings.html\">https://leanprover-community.github.io/mathematics_in_lean/C08_Groups_and_Rings.html</a></p>\n</blockquote>\n<p>This is definitely wrong</p>",
        "id": 503663888,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741220024
    },
    {
        "content": "<p>Hmm <code>#synth Group (myGroup _)</code> does not work for me... Maybe I need to update my dependencies.</p>",
        "id": 503664116,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741220136
    },
    {
        "content": "<p>Even with the <code>abbrev</code> change?</p>",
        "id": 503665004,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741220641
    },
    {
        "content": "<p>I will take this a sign that I should go to sleep - thanks Kevin, it now works. I don't get why it works but I'll trust Lean's magic.</p>",
        "id": 503665901,
        "sender_full_name": "Alex Brodbelt",
        "timestamp": 1741221100
    },
    {
        "content": "<p>Lean does not do magic. Typeclass inference can see through <code>abbrev</code> s (because they're reducible) but not <code>def</code>s (because they're irreducible). </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n</code></pre></div>",
        "id": 503666279,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741221267
    }
]