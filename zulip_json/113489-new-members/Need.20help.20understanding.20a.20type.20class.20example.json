[
    {
        "content": "<p>In the process of trying to understand the <code>Nonempty</code> type class definition, I constructed the following example which, a bit to my surprise, compiled:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">oneThing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">anotherThing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span>\n</code></pre></div>\n<p>I am having a hard time understanding what the type class <code>Something</code> is about and what the final line with <code>instance</code> actually means. Any help or insight is greatly appreciated.</p>",
        "id": 471223138,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1726654819
    },
    {
        "content": "<p>Do you understand</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">oneThing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span>\n<span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">anotherThing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span>\n</code></pre></div>\n<p>? <br>\nYour code just that, plus \"add these definitions to the typeclass inference system\" (which is a big list of types which have the <code>@[class]</code> attribute and terms which have the <code>@[instance]</code> attribute). I'm just trying to establish which part you don't understand.</p>",
        "id": 471226592,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726655996
    },
    {
        "content": "<p>I understand what goes on without the class and instance stuff. So the <code>class</code> is just syntactic sugar for <code>[@class]</code>?</p>",
        "id": 471226844,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1726656082
    },
    {
        "content": "<p>Right! <code>class</code> and <code>instance</code> are just adding tags to declarations.</p>",
        "id": 471227002,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726656127
    },
    {
        "content": "<p>Thank you. That helps.</p>",
        "id": 471227072,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1726656149
    },
    {
        "content": "<p>And then the cool thing is that you can ask the typeclass inference system to come up with terms for you automatically. It's just another way of getting the system to fill in inputs to functions, like unification.</p>",
        "id": 471227156,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726656173
    },
    {
        "content": "<p><code>def foo (a : Nat) {b : Nat} [c : Nat] : ...</code> means \"when you're running this, let the user input <code>a</code>, get unification to solve for <code>b</code> and get the typeclass inference system to solve for <code>c</code> (and this will fail, because Nat isn't a class :-) ).</p>",
        "id": 471227483,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726656266
    },
    {
        "content": "<p>It makes sense now. And I see that I can do something like the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instOne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">instAnother</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">anotherThing</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">anotherThing</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 471227671,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1726656337
    },
    {
        "content": "<p>Here's an example which does work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n</code></pre></div>\n<p>Now <code>foo</code> wants the user to input a type, but then typeclass inference will supply the additive group structure on <code>G</code>. The <code>#check</code> works because somewhere in mathlib someone has written <code>instance : AddGroup ℤ := &lt;the group structure&gt;</code> so the typeclass inference system can find the instance and supply the input.</p>",
        "id": 471227895,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726656407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"397075\">Kevin Cheung</span> <a href=\"#narrow/stream/113489-new-members/topic/Need.20help.20understanding.20a.20type.20class.20example/near/471227671\">said</a>:</p>\n<blockquote>\n<p>It makes sense now. And I see that I can do something like the following:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instOne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">instAnother</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">anotherThing</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">oneThing</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Something</span><span class=\"bp\">.</span><span class=\"n\">anotherThing</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>You can do this, but a lot of the system is set up under the assumption of \"one instance per class\", so this kind of code might cause problems down the line. For example, one would typically only have one AddGroup structure on a type (because otherwise <code>+</code> would be ambiguous) and this is why <code>AddGroup</code> is a class.</p>",
        "id": 471228196,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1726656523
    }
]