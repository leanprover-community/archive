[
    {
        "content": "<p>Is there a way to pretend that a mapping from some (multiplicative) <code>Monoid</code> to an (additive) <code>AddMonoid</code> is a homomorphism of some kind?</p>\n<p>The base case I have in mind is the length of words over some alphabet. I see that Mathlib has a <code>length</code> function from words to <code>ℕ</code> (which is really <code>List.length</code> in thin disguise), and theorems (both in the multiplicative and additive settings) that the length of a concatenation of two words is the sum of their lengths, but it seems that none is described as a homomorphism. At least it could/should be in the additive case?</p>\n<p>In fact, what I would like to be able to do is define some alternative notions of length, where each letter could be defined to have a different \"length\". I can do this with <code>FreeAddMonoid.lift</code>, but if I try to use <code>FreeMonoid.lift</code> (because I would really like to write concatenation multiplicatively), Lean picks the multiplicative monoid on <code>ℕ</code> and that's not at all what I want.</p>\n<p>I suppose this is a sign that I don't really understand the problems with instance synthesis (like, having an instance to make a <code>Monoid</code> from a <code>FreeMonoid</code> and vice versa would probably create loops in the instance resolution program, and I can imagine this would be pretty bad)</p>",
        "id": 523116573,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749483281
    },
    {
        "content": "<p>Something something <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Additive#doc\">docs#Additive</a></p>",
        "id": 523116824,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1749483347
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MonoidHom.toAdditive%27#doc\">docs#MonoidHom.toAdditive'</a></p>",
        "id": 523118539,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749483759
    },
    {
        "content": "<p>Not sure how to use this in practice, but thanks for the pointers.</p>\n<p>(Why are so many thing hidden in Mathlib.Algebra.Group, when there is no group in sight?)</p>",
        "id": 523118605,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749483775
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">append</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">[]</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddZeroClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">zero_add</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">add_zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">append_nil</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lengthHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→+</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">length</span>\n<span class=\"w\">  </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">length_nil</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">length_append</span>\n</code></pre></div>",
        "id": 523119942,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749484075
    },
    {
        "content": "<p>You could/should probably scope these</p>",
        "id": 523119986,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749484085
    },
    {
        "content": "<p>For free monoid, let's see...</p>",
        "id": 523120032,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749484100
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lengthHom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FreeMonoid</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"n\">Multiplicative</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">AddMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">toMultiplicative'</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">FreeMonoid</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">Additive</span><span class=\"bp\">.</span><span class=\"n\">toMul</span>\n<span class=\"w\">    </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 523121178,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1749484354
    },
    {
        "content": "<p>Thanks! (Though, having something like <code>Multiplicative ℕ</code> is probably a bit confusing)</p>",
        "id": 523128323,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749486533
    },
    {
        "content": "<p><a href=\"https://loogle.lean-lang.org/?q=Multiplicative+Nat\">this loogle query</a> suggests that it is not an uncommon pattern</p>",
        "id": 523128794,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749486714
    }
]