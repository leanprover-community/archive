[
    {
        "content": "<p>Hey everyone,</p>\n<p>A couple of days ago I started getting into lean and have done a few exercises of \"mathematics in lean\".<br>\nSince I lack background in the field, it would be really nice, if someone could give me a little code review on my first \"project\" I did over the last two days.<br>\nWhat I did was a tiny cpu simulation using a custom mini instruction set. I then have a simple loop and show the program halts.<br>\nAny feedback is welcome :-)</p>\n<p>Link: <a href=\"https://github.com/wechselstrom/cpu_sim/blob/main/cpu_sim/cpu.lean\">https://github.com/wechselstrom/cpu_sim/blob/main/cpu_sim/cpu.lean</a></p>",
        "id": 474775045,
        "sender_full_name": "Stefan Weber",
        "timestamp": 1728032313
    },
    {
        "content": "<p>I think you're probably looking for feedback more about the proof technique side of things. It's cool that you proved the program halted, but I'm wondering if you could pull parts of the proof into a monadic context.  Using the state monad it's possible to write an assembly DSL, (maybe you've already done things like this),</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">StateM</span><span class=\"w\"> </span><span class=\"n\">ExecutionState</span><span class=\"w\"> </span><span class=\"n\">Unit</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inst</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Instr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">modify</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">exec_instr</span><span class=\"w\"> </span><span class=\"n\">inst</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">dec</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Instr</span><span class=\"bp\">.</span><span class=\"n\">Dec</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">jumpIfZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Instr</span><span class=\"bp\">.</span><span class=\"n\">JumpIfZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">jump</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Instr</span><span class=\"bp\">.</span><span class=\"n\">Jump</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">halt</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Instr</span><span class=\"bp\">.</span><span class=\"n\">Halt</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tiny_prog'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">dec</span>\n<span class=\"w\">  </span><span class=\"n\">jumpIfZero</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"n\">jump</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"n\">halt</span>\n</code></pre></div>\n<p>Maybe someone knows how to incorporate proof elements, to get something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">tiny_prog'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Run</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">dec</span>\n<span class=\"w\">  </span><span class=\"n\">jumpIfZero</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"n\">jump</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- proofs</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">stack_not_smashed</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">aesop</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">memory_bounds_on_array_respected</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">hackers</span>\n\n<span class=\"w\">  </span><span class=\"n\">halt</span>\n</code></pre></div>",
        "id": 474876333,
        "sender_full_name": "Derek Rhodes",
        "timestamp": 1728065153
    }
]