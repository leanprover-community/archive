[
    {
        "content": "<p>In <a href=\"http://[live%20Lean](https://live.lean-lang.org/)\">lean live</a>,</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">calc_test</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"w\">  </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>yields the error (under tactic state)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">requested</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">blob</span><span class=\"o\">:</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">live</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">lang</span><span class=\"bp\">.</span><span class=\"n\">org</span><span class=\"bp\">/</span><span class=\"n\">f42383ff</span><span class=\"bp\">-</span><span class=\"n\">f362</span><span class=\"bp\">-</span><span class=\"mi\">4</span><span class=\"n\">ff7</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"n\">fce</span><span class=\"bp\">-</span><span class=\"mi\">82</span><span class=\"n\">cfada2668f'</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">provide</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">named</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">useRpcSession'</span>\n</code></pre></div>\n<p>from the <code>calc</code> line.</p>\n<p>But without the <code>import Mathlib</code>, the error is not there.</p>\n<p>What's going on here?</p>\n<p>Same error message mention in <a href=\"#narrow/stream/270676-lean4/topic/Using.20.60exprDiff.60.20in.20widgets\">this post</a>, but no explanation or (whether there is a) resolution given.</p>",
        "id": 464510485,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1724371760
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"385895\">@Jon Eugster</span></p>",
        "id": 464530518,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724384281
    },
    {
        "content": "<p>Note that the goal view still works...</p>",
        "id": 464530636,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724384307
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"245476\">@Quinn Culver</span> Thanks for reporting this error!</p>",
        "id": 464530752,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724384341
    },
    {
        "content": "<p>It works fine in the new version on my test server: <a href=\"https://lean.math.hhu.de/#code=import%20Mathlib%0A%0Atheorem%20calc_test%3A%201%3D1%20%3A%3D%20by%0A%0A%20%20calc%201%20%3D%201%20%3A%3D%20by%20sorry%0A\">lean.math.hhu.de</a> (except that the new updated version still needs a fix to work on Windows). But actually trying to use that calc widget seems to yield another error...</p>\n<p>On <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a>, the error I'm observing when clicking on <code>calc</code> is a different one:<code>Error: import not found: EnvPosContext</code> and I think this comes from mathlib's calc widget failing to load (the calc widget gives you some interactive feature to help you selecting subexpressions or something). I think you can still use the editor for now and just ignore the widget failing, can't you?</p>\n<p>I'll have a look! Generally for web editor bugs, it's useful if you directly report them at <a href=\"https://github.com/leanprover-community/lean4web/issues\">https://github.com/leanprover-community/lean4web/issues</a>, I tend to only see a random subset of Zulip messages unless I'm pinged.</p>",
        "id": 464605354,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724407551
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/xNy_PSlQhU5gVLpSDxsBiQaC/Screenshot_20240823_120744-1.png\">Screenshot_20240823_120744-1.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/xNy_PSlQhU5gVLpSDxsBiQaC/Screenshot_20240823_120744-1.png\" title=\"Screenshot_20240823_120744-1.png\"><img data-original-dimensions=\"359x383\" src=\"/user_uploads/thumbnail/3121/xNy_PSlQhU5gVLpSDxsBiQaC/Screenshot_20240823_120744-1.png/840x560.webp\"></a></div>",
        "id": 464605654,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724407691
    },
    {
        "content": "<p>Can proofs be trusted if that error has been thrown?</p>",
        "id": 464772332,
        "sender_full_name": "Quinn Culver",
        "timestamp": 1724463822
    },
    {
        "content": "<p>Yes. afaik all widgets are purely cosmetical and do not interact with the proof term, so it doesn't matter if the widget crashes. (they might offer buttons/links to edit your proof, but their presence does not directly influence the proof term)</p>\n<p>Two indications that your proof is fine:</p>\n<ul>\n<li>If there are no messages under \"All messages\" (in the example this says \"uses sorry\"). If your proof is not fine, the Lean server should always report error Messages under \"All Messages\"</li>\n<li>you don't have any red squiggles in the editor at all.</li>\n</ul>",
        "id": 464775336,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724465594
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"245476\">Quinn Culver</span> has marked this topic as resolved.</p>",
        "id": 465085218,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724649478
    },
    {
        "content": "<p>It looks like the remaining error is not a web editor thing, and can be reproduced in VSCode:</p>\n<p>Consider:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">calc_test</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n\n<span class=\"w\">    </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"c1\">--  ^ cursor here shows the following goal in the infoview</span>\n<span class=\"c1\">--  ‚ä¢ 1 = 1</span>\n<span class=\"c1\">--      ^ shift-click here to get a panic:</span>\n<span class=\"c1\">-- \"Rpc error: InternalError: goal ?[anonymous]\" in the calc-widget</span>\n<span class=\"c1\">-- together with panic \"unreachable code has been reached\"</span>\n</code></pre></div>\n<p>(<a href=\"https://lean.math.hhu.de/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQO0Cm0BIcAxkumQPowEDOMAXHAIwC8rcT7cWAnnjjDylMmzi8uPPvzj1oUQQFplwgHrkArlAVQ4qAlALzUEAO704hOADMI6dBeAA7AOZw3ESnFfXDvi72AG7ABOY4qsKARUQSUpFqIhqmwLYwymSYZADWBkYmMBCeBPBIcGBILsBkTAlwAEQASmDiRlDQLACSLnRQLpQAolDtUCxePgD8ANqVEC78IBBa9AC69YH+JhRUyubAACZuJXWFR4T6e2jlldUNWi7GSGSoSFjoWxD7Ji9WWAQELjgj2eBH29RwQA\">link to web editor dev version</a>)</p>\n<p>The only web-editor related thing is that the panic isn't displayed to the user.</p>\n<p>If somebody wants to have a go at it, it is probably easy to locate by searching for <code>unreachable!</code> inside <code>Mathlib/Tactic/Widget/Calc.lean</code></p>",
        "id": 465161264,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1724673620
    }
]