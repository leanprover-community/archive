[
    {
        "content": "<p>For example, I can do this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">bind</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">flip</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inline</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">containsFive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">foldr'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">foldrM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">init</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"n\">stop</span>\n</code></pre></div>\n<p>I don't see where the problems would start. What am I missing?</p>",
        "id": 554562091,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762694569
    },
    {
        "content": "<p>the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=id_eq#doc\">docs#id_eq</a> is a simp lemma</p>",
        "id": 554562542,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762694995
    },
    {
        "content": "<p>The answer to this question belongs in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id#doc\">docs#Id</a> if it is not already there</p>",
        "id": 554602950,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762733768
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/What.20is.20the.20benefit.20of.20.60Id.60.20over.20.60id.60.3F/near/554562542\">said</a>:</p>\n<blockquote>\n<p>the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=id_eq#doc\">docs#id_eq</a> is a simp lemma</p>\n</blockquote>\n<p>I'm sorry, but I don't understand how this relates to my question. Could you explain in more detail? I'm still new to Lean.<br>\nAre you saying I should use <code>(id_eq _).mp</code> instead of defining <code>id.run</code>?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/What.20is.20the.20benefit.20of.20.60Id.60.20over.20.60id.60.3F/near/554602950\">said</a>:</p>\n<blockquote>\n<p>The answer to this question belongs in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id#doc\">docs#Id</a> if it is not already there</p>\n</blockquote>\n<p>It is not, or at least I didn't understand it from it. In my original post I rewrote the example from there using <code>id</code> instead of <code>Id</code>.</p>",
        "id": 554669623,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762771963
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>'s point is that <code>id Nat</code> will simplify to <code>Nat</code>, at which point it will have no monad instance. <code>Id Nat</code> doesn't simplify, so will continue to have a monad instance.</p>",
        "id": 554671604,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762772506
    },
    {
        "content": "<p>The answer is that you can't use <code>simp</code> anymore now since it will just simplify away all your occurrences of <code>id</code></p>",
        "id": 554671615,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762772511
    },
    {
        "content": "<p>But wouldn't it be easy to reintroduce it?</p>",
        "id": 554673413,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762773051
    },
    {
        "content": "<p>I guess I'll try to fork and replace Id with id in the whole library to see how bad it would actually be</p>",
        "id": 554673553,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762773090
    },
    {
        "content": "<p>we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id.run_pure#doc\">docs#Id.run_pure</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id.run_map#doc\">docs#Id.run_map</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id.run_bind#doc\">docs#Id.run_bind</a></p>",
        "id": 554673728,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762773145
    },
    {
        "content": "<p><code>simp</code> will only use those if it sees a term of type <code>Id _</code></p>",
        "id": 554673818,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762773178
    },
    {
        "content": "<p>you can't do those with <code>id _</code> since it'll get simplified away</p>",
        "id": 554673901,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762773204
    },
    {
        "content": "<p>But if <code>id</code> gets simplified away, there's no need for those three theorems in the first place, since they hold trivially by simplification. Right?</p>",
        "id": 554674377,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762773347
    },
    {
        "content": "<p>no?</p>",
        "id": 554674458,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762773372
    },
    {
        "content": "<p>the <code>id</code> gets simplified away but the <code>id.run</code> and the <code>Bind.bind</code> are still there</p>",
        "id": 554674521,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762773400
    },
    {
        "content": "<p>If you see in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Id#doc\">docs#Id</a>, there's some instances; these allow the monadic notation that is described above. In order to apply instances like this, Lean needs a symbol to match against. <code>id</code> would work, but generally we want to remove all uses of <code>id</code> possible via simplification; this is _not_ the behaviour we want in this case. So we must make a separate symbol</p>",
        "id": 554689892,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1762778245
    },
    {
        "content": "<p><a href=\"https://github.com/viliml/lean4/commit/963ece083e028587a522785fd1dbf113b2a13d54\">https://github.com/viliml/lean4/commit/963ece083e028587a522785fd1dbf113b2a13d54</a><br>\nI had to add a negative simp lemma in <em>one</em> place. Otherwise, everything just works.</p>",
        "id": 554729924,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762788707
    },
    {
        "content": "<p>I managed to remove a lot of the pure/run wrappers and it's much cleaner now.<br>\nIt's a shame how even though Lean actually has real type functions (unlike Haskell), the identity monad is still the equivalent of a \"newtype\" instead of utilizing that feature.<br>\nMaybe something to keep in mind for version 5.</p>",
        "id": 554731576,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762789110
    },
    {
        "content": "<p>The whole point of the <code>run</code> wrappers is to allow you to explicitly hop in and out of the monadic abstraction</p>",
        "id": 554736834,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762790441
    },
    {
        "content": "<p>Why does it need to be explicit? \"monadic\" computations in the identity monad are just regular values. Are you saying that <code>fun x =&gt; f x.run</code> and <code>(pure &lt;| f . . .)</code> are clearer and better code style than <code>f</code>?</p>",
        "id": 554772333,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762801558
    },
    {
        "content": "<p>It's so that automation can recognize when you're in the id monad and it's also so you can recognize when you're in the id monad</p>",
        "id": 554774697,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762802482
    },
    {
        "content": "<p>I'll also note that the change you propose amounts to reverting my <a href=\"https://github.com/leanprover/lean4/pull/7352\">lean4#7352</a> and going further in the opposite direction</p>",
        "id": 554854488,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762847981
    },
    {
        "content": "<p>yeah I did notice those deprecation warnings <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 555003340,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762900120
    },
    {
        "content": "<p>So yeah, the extra simping didn't cause me much trouble when converting the base library from <code>Id</code> to <code>id</code>, against your predictions.<br>\nMaybe the problems you speak of would start cropping up if I tried to convert Mathlib, but I think I've wasted enough of my time on this already.<br>\nI'll just accept \"backwards compatibility\" as the answer to my question, and move on.</p>",
        "id": 555005533,
        "sender_full_name": "Vilim Lendvaj",
        "timestamp": 1762901706
    }
]