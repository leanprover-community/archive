[
    {
        "content": "<p>In PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/31101\">#31101</a> the reviewer (<span class=\"user-mention\" data-user-id=\"459699\">@Jo√´l Riou</span>) helped me get rid of an <code>erw</code> in a construction as follows.</p>\n<p>The <code>homEquiv_id</code> field below used to read</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"n\">homEquiv_id</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">trans_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eHomEquiv_id</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">erw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">eId_eq</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>but this has been replaced by one line <code>by simpa using h _ (eId V _)</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">TransportEnrichment</span><span class=\"bp\">.</span><span class=\"n\">enrichedOrdinaryCategory</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">LaxMonoidal</span><span class=\"bp\">.</span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">EnrichedOrdinaryCategory</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TransportEnrichment</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">homEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eHomEquiv</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">homEquiv_id</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eId</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">homEquiv_comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">trans_apply</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">erw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">erw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">erw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">tensorHom_comp_tensorHom</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eHomEquiv_comp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eComp_eq</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">tensorHom_def</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">LaxMonoidal</span><span class=\"bp\">.</span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">unitors_inv_equal</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>A few questions:<br>\n(i) How should I understand a proof <code>by simpa using ...</code>?<br>\n(ii) How do I discover my own proofs of the form <code>by simpa using ...</code>?<br>\n(iii) When I have to use a <code>erw</code> what is the likely culprit?<br>\n(iv) What are some tricks to try to get rid of further <code>erw</code>s such as in the <code>homEquiv_comp</code> field?</p>",
        "id": 558018155,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763491819
    },
    {
        "content": "<p>Also this PR is currently failing because of something to do with the lean version I don't understand. I tried running a <code>lake update</code> and committing but now there's a mismatch with the proofwidgets toolchain. (I don't know what proofwidgets is or how to fix this.)</p>",
        "id": 558019573,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763492277
    },
    {
        "content": "<p>Try merging master into your branch. You should not be running <code>lake update </code> inside mathlib</p>",
        "id": 558023121,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763493395
    },
    {
        "content": "<p>A good first approximation to <code>simpa</code> is that <code>simpa</code> means <code>simp; assumption</code>. More accurately <code>simpa using h</code> means <code>simp; simp at h; exact h</code>. </p>\n<p>When you have to use <code>erw</code> you can ask lean what the culprit is with <code>erw?</code>. If this isn't documented when you hover over <code>erw</code> then it should be! [Edit: and indeed it is not!]</p>",
        "id": 558031486,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763496097
    },
    {
        "content": "<p>If you want some jargon to look up, <code>simpa using ...</code> roughly does <em>paramodulation</em>, i.e. unification of metavariables up to equalities (here the equalities are given by the simp lemmas)</p>",
        "id": 558034710,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1763497182
    },
    {
        "content": "<p>I read <code>by simpa using h</code> as \"And now we are done thanks to <code>h</code>, up to simplification\"</p>",
        "id": 558034863,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1763497247
    },
    {
        "content": "<p>This is possibly <em>the</em> proof technique I use the most in Lean, and I find it incredibly powerful. I therefore encourage you further in your quest of understanding it.</p>",
        "id": 558035036,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1763497310
    },
    {
        "content": "<p>Oh curses, <code>erw</code> is in core and <code>erw?</code> is in Mathlib so the core people probably are not interested in mentioning <code>erw?</code> in the <code>erw</code> docstring. The correct thing to do here would be to persuade core people to take on <code>erw?</code> but this would probably be a slow process.</p>",
        "id": 558035400,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763497467
    },
    {
        "content": "<p>Unfortunately it is currently unergonomic to create a <code>simpa using ...</code> proof. My usual setting is stuffing more and more stuff in the simpa call below until it works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simpa?</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>If simp goes too far or loops, I painfully switch to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">stuff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">stuff</span><span class=\"o\">]</span>\n<span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>(I wish a failing <code>simpa? using h</code> reported the lemmas it used instead of failing with no explanation <span aria-label=\"bangbang\" class=\"emoji emoji-203c\" role=\"img\" title=\"bangbang\">:bangbang:</span>)<br>\nIf I don't have <code>h</code> yet, I do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>and work inside the hole as you usually would, possibly adding another <code>by simpa using ...</code> in there!</p>",
        "id": 558036149,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1763497772
    },
    {
        "content": "<p>Is there always just a single term after the <code>simpa using</code> because this is the thing you are supposed to exact at the end?</p>",
        "id": 558066012,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763499742
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Ya√´l Dillies</span> <a href=\"#narrow/channel/113489-new-members/topic/how.20do.20I.20get.20rid.20of.20an.20erw.3F/near/558034863\">said</a>:</p>\n<blockquote>\n<p>I read <code>by simpa using h</code> as \"And now we are done thanks to <code>h</code>, up to simplification\"</p>\n</blockquote>\n<p><em>and defeq</em>; essentially <code>using h</code> can hide a defeq abuse that <code>erw</code> was previously making visible.</p>",
        "id": 558069216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763501009
    },
    {
        "content": "<p>Unfortunately none of these techniques are helping me write the proof. <code>erw?</code> did return something but I can't parse it.</p>",
        "id": 558069291,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763501038
    },
    {
        "content": "<p>I think I understand the confusion. Above I have<br>\n<code> instance : Category (TransportEnrichment F C) := inferInstanceAs (Category C)</code>.</p>\n<p>My hypothesis <code>h</code> refers to some structure borne by the type <code>C</code>. My goal involves morphisms in the category structure on the type <code>TransportEnrichment F C</code>.</p>",
        "id": 558069405,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763501086
    },
    {
        "content": "<p>So I have <code>h _ (eHomEquiv V (C := C) (f ‚â´ g)) : (e (X ‚ü∂[V] Z)) ((eHomEquiv V) (f ‚â´ g)) = Functor.LaxMonoidal.Œµ F ‚â´ F.map ((eHomEquiv V) (f ‚â´ g))</code> while the LHS of my goal is <br>\n<code>(e (X ‚ü∂[V] Z)) ((eHomEquiv V) (f ‚â´ g)) = (Œª_ (ùüô_ W)).inv ‚â´ ((e (X ‚ü∂[V] Y)) ((eHomEquiv V) f) ‚äó‚Çò (e (Y ‚ü∂[V] Z)) ((eHomEquiv V) g)) ‚â´ eComp W X Y Z</code>.</p>\n<p><code>rw [h]</code> or even <code>rw [h with all the arguments]</code> still fails while <code>erw [h]</code> succeeds.</p>",
        "id": 558069614,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1763501176
    },
    {
        "content": "<p>There's probably some hidden implicit arguments that use <code>C</code> instead of <code>TransportEnrichment F C</code> or so <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> I think in my PR I also needed to add some explicit annotations to get it to work without <code>erw</code>.</p>",
        "id": 558336512,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1763604244
    }
]