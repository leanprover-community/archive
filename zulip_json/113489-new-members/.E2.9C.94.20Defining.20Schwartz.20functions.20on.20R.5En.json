[
    {
        "content": "<p>Hi, I am trying to formalise the following definition : An infinitely differentiable function f : R^n -&gt; C is  called a Schwartz function if for every pair of multi-indices  a and b  there exists C_{a,b} sucht that  sup x∈Rn |x^a ∂^b f(x)| =C_{a,b}&lt; ∞. I have defined the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiindex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">\\</span><span class=\"n\">N</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">multiindex</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Rn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">multiindex_product_pow</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">multiindex</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rn</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">iterated_partial_deriv</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">iteratedFDeriv</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>These seem to work. However, now I would like to define the partial derivative related to the multi-index; d^b f(x). I thought that iterated_partial_deriv would be helpful for this together with folding the multi-index or so, but Lean should also 'keep track' of the differentiated function f. I can't seem to get it right. So my questions are: Am I on the right track overall? How could I continue with this d^b f(x)? <br>\nThanks in advance!</p>",
        "id": 519785420,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747905242
    },
    {
        "content": "<p>You can check how it is done in Mathlib if you want: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Distribution/SchwartzSpace.html#SchwartzMap\">SchwartzMap</a>.</p>",
        "id": 519787747,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1747905938
    },
    {
        "content": "<p>The SchwartzMap in Mathlib uses a more general setting where partial derivatives and polynomials are avoided. However, my aim is to define it in this more concrete setting. Therefore I think the Mathlib SchwartzMap is not helpful here</p>",
        "id": 519791824,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747907156
    },
    {
        "content": "<p>Note that the mathlib <code>SchwartzMap</code>, when considered in your concrete setting, coincides exactly with what you want to define, so you could as well use it directly.</p>",
        "id": 519793443,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1747907657
    },
    {
        "content": "<p>Yes noted, thank you. However, I still feel like it would be a nice way to get used to these constructions (for instance Fin, how Lean deals with derivatives, higher order differentiation etc.). Moreover, I am trying to follow a book on this so this is the goal my supervisor and I have set as a starting point. This way of defining it should be possible right? And if so, how could I continue?</p>",
        "id": 519797576,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747908889
    },
    {
        "content": "<p>Is it important that you follow <em>exactly the same definition as in the book, even if that could be more painful to formalise</em>? Often (dare I say \"usually\"), there are several ways to formalise any given definition - and one can be really painful to work with, and the other one is pleasant to use.</p>",
        "id": 519828013,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747918559
    },
    {
        "content": "<p>Some people say this is a feature, as in formalisation making to pick the \"right\" definition.</p>",
        "id": 519828162,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747918596
    },
    {
        "content": "<p>Why don't you instead prove a theorem saying that a function is a Schwartz function in the sense that you describe iff it is a Schwartz function in the sense of mathlib? That way you will not be adding new definitions which people are pushing back against and you will still be mathematically engaging with the same material.</p>",
        "id": 519845725,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747922979
    },
    {
        "content": "<p>Thank you all for your help. After reading these comments, I agree that it might be best to switch the focus a bit. <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, do you mean proving that on paper? That would definitely deviate quite a bit from our original goal.</p>",
        "id": 520021870,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747996788
    },
    {
        "content": "<p>Oh I meant proving it in Lean.</p>",
        "id": 520021973,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747996808
    },
    {
        "content": "<p>Ah, but then how could I state this theorem without first defining Schwartz functions the way I described?</p>",
        "id": 520022076,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747996844
    },
    {
        "content": "<p>Formalizing a definition can be a good exercise, but if mathlib already has that definition (even in a form which you're not at all happy with) then formalizing the definition sounds to me to be a bit futile, and instead formalizing the theorems which you like about the definition which you don't like sounds like a more productive project.</p>",
        "id": 520022114,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747996865
    },
    {
        "content": "<p>To give a concrete more low-level example, mathlib's definition of a compact space is some crazy thing involving filters, and not remotely connected to \"every open cover has a finite subcover\". And sometimes I get undergraduates saying \"I want to prove that the continuous image of compact is compact and the proof in my notes says to cover the target, pull back to cover the source, take a finite cover and push that back forwards, and I can't do this in Lean because when I unfold mathlib's definition of compact then I get some gobble-de-gook\" and my reply is \"oh yes you can, because we have a <em>theorem</em> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=isCompact_iff_finite_subcover#doc\">docs#isCompact_iff_finite_subcover</a> which says that a set is compact iff every open cover has a finite subcover, so just apply this theorem first and don't worry at all about mathlib's definition of compact\".</p>",
        "id": 520022514,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747997018
    },
    {
        "content": "<p>It doesn't matter what a definition is, under the hood. What matters is that everyone is able to use the definition in the way they want to use it. So for example if you want the definition to have a list of properties which you like then you should prove that mathlib's definition has this list of properties which you like. What we cannot have is two definitions of the same thing because that goes against the whole philosophy of the library.</p>\n<p>If you don't want to get into the weeds of working with mathlib's definition, then what you could do is to just <em>state</em> theorems of the form \"mathlib's definition has this property\", and <code>sorry</code> the proof (and even ask for help proving it in <a class=\"stream\" data-stream-id=\"217875\" href=\"/#narrow/channel/217875-Is-there-code-for-X.3F\">#Is there code for X?</a> ) and then you can go ahead using mathlib's definition, applying your theorems and putting yourself in exactly the situation which you want to be in. I claim that this proposal puts you literally back into exactly the situation which you wanted to be in in the first place.</p>\n<p>The reason I am strongly discouraging you from writing your own definition is that this one step at the very beginning of your project will basically immediately rule out any of your work being eligible for inclusion in mathlib.</p>",
        "id": 520023283,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747997259
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"910054\">Wouter Bosse</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20Schwartz.20functions.20on.20R.5En/near/520022076\">said</a>:</p>\n<blockquote>\n<p>Ah, but then how could I state this theorem without first defining Schwartz functions the way I described?</p>\n</blockquote>\n<p>You can state things like \"a function from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\R^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">C</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{C}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">C</span></span></span></span> is a Schwartz function in the sense of mathlib if and only if it has the following properties\".</p>",
        "id": 520023747,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747997397
    },
    {
        "content": "<p>Ah okay. That seems to be a good way to work with definitions in Mathlib which I dont like. Thanks a lot for the replies!</p>",
        "id": 520028950,
        "sender_full_name": "Wouter Bosse",
        "timestamp": 1747999037
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"910054\">Wouter Bosse</span> has marked this topic as resolved.</p>",
        "id": 520033490,
        "sender_full_name": "Notification Bot",
        "timestamp": 1748000608
    }
]