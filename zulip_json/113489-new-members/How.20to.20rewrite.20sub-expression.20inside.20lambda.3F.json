[
    {
        "content": "<p>I've been proving some simple natural number theorems to practice my Lean skills. I'm struggling with the Binomial theorem however because it involves summing the values of a function or lambda (maybe Lean calls it a binder?). I can't seem to rewrite using a known equality inside the function:</p>\n<p>def binomial_thereom (x y p : Nat) : (x + y) ^ p = Nat.sum (<a href=\"http://List.map\">List.map</a> (binterm x y p) (List.range (p + 1))) := by<br>\n&lt;&lt;proof terms omitted&gt;&gt;</p>\n<p>My current proof state is </p>\n<p><code> p' x y : ℕ\nih : ∀ (x y : ℕ), (x + y) ^ p' = (List.map (binterm x y p') (List.range (p' + 1))).sum\n⊢ (List.map (fun i =&gt; x ^ i * y ^ (p' - i) * combin p' i) (List.range (p' + 1))).sum * (x + y) = (List.map (fun i =&gt; x ^ i * y ^ (p' + 1 - i) * combin (p' + 1) i) (List.range (p' + 2))).sum</code><br>\nwhere combin and binterm are:</p>\n<p><code>def combin (p i : Nat) := p.factorial / (i.factorial * (p - i).factorial)\ndef binterm (x y p i : Nat) := x ^ i * y ^ (p - i) * combin p i</code></p>\n<p>I want to rewrite y ^ (p' + 1 - i) into y ^ (p' - i + 1), and then take out a factor of y, but when I try to rw [Nat.add_sub_assoc] it fails.</p>\n<p>I read another discussion here about how rw doesn't work in binders and I should use simp_rw,  but I tried simp_rw and I was also unable to progress with that. It said no progress made.</p>\n<p>Any tips for working with this type of proof?</p>",
        "id": 467961686,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725564514
    },
    {
        "content": "<p>I think the tips which would help most here are <a href=\"https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks\">#backticks</a> and <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> . If you edit your original message so that it's a mwe then it will become much easier for other people to see what you're doing wrong.</p>",
        "id": 467963935,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1725565137
    },
    {
        "content": "<p>Having said that, just by reading your first paragraph, it is indeed the case that <code>rw</code> can’t work under binders, try using <code>simp_rw</code></p>",
        "id": 467985604,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1725570946
    },
    {
        "content": "<p>I’ll try to put in a MWE tomorrow. I tried simp_rw and it didn’t work but I’ll show that.</p>",
        "id": 467986267,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725571231
    },
    {
        "content": "<p>do you know about <code>conv</code>? (if not, see <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/conv.html\">here</a>)</p>",
        "id": 467986855,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1725571469
    },
    {
        "content": "<p>Here's my MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sum_power_rearrange</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n\n<span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_sub_assoc</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>The simp_rw doesn't make any progress, and rw doesn't work.</p>",
        "id": 468160174,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725622652
    },
    {
        "content": "<p>That's because <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add_sub_assoc#doc\">docs#Nat.add_sub_assoc</a> has a side condition <code>k ≤ m</code>. If you provide that side condition, then <code>simp_rw</code> will work</p>",
        "id": 468161666,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725622998
    },
    {
        "content": "<p>Ah, ok during normal rewriting with the side conditions it would just add it as another thing to proof afterwards</p>",
        "id": 468161962,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725623067
    },
    {
        "content": "<p>Any hints on how to prove that the index of the summation is always y or less if the list is Range (y + 1)?</p>",
        "id": 468163371,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725623329
    },
    {
        "content": "<p>rewrite using <a href=\"https://leanprover-community.github.io/mathlib4_docs/Init/Data/List/Attach.html#List.attach_map_val\">List.attach_map_val</a></p>",
        "id": 468164572,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725623554
    },
    {
        "content": "<p>then use <code>congr</code></p>",
        "id": 468165578,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1725623712
    },
    {
        "content": "<p>Thank you. I will spend some time working through this to understand more.</p>",
        "id": 468167929,
        "sender_full_name": "Anthony Peterson",
        "timestamp": 1725624033
    }
]