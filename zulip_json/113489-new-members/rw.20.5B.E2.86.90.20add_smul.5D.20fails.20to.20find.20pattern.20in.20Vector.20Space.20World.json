[
    {
        "content": "<p>Hi everyone,<br>\n(I am totally new to Lean and trying to brush up on Linear Algebra)</p>\n<p>I'm working through the Linear Algebra \"Vector Space World\" Lean game (Level 1/5: zero scalar multiplication), and I'm stuck on what seems like a type inference issue with <code>rewrite</code>.</p>\n<p><strong>Goal:</strong> Prove <code>zero_smul_v</code>: that <code>(0 : K) • w = (0 : V)</code> in a vector space.<br>\n<strong>Setup:</strong> After applying <code>add_right_cancel (b := 0 • w)</code>, my goal becomes:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">w</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">w</span>\n</code></pre></div>\n<p><strong>Problem:</strong> I want to rewrite <code>0 • w + 0 • w</code> to <code>(0 + 0) • w</code> using <code>add_smul</code> backwards. The theorem <code>add_smul</code> has signature:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>But <code>rw [← add_smul]</code> fails with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rewrite'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">did</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">expression</span>\n<span class=\"w\">  </span><span class=\"bp\">?</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">x</span>\n</code></pre></div>\n<p><strong>What I've tried:</strong></p>\n<ul>\n<li><code>rw [← add_smul]</code></li>\n<li><code>rw [← add_smul 0 0 w]</code></li>\n<li><code>rw [← add_smul (0 : K) (0 : K) w]</code></li>\n<li><code>rw [← @add_smul K V _ _ _ 0 0 w]</code></li>\n</ul>\n<p>All give the same error. The pattern <code>0 • w + 0 • w</code> is literally in the goal, so I'm confused why Lean can't find it.</p>\n<p>The game doesn't have access to <code>conv</code>, <code>simp</code>, <code>change</code>, or <code>linarith</code>.</p>\n<p>Any ideas what's going on or how to work around this?</p>\n<p>Thanks!</p>",
        "id": 563589865,
        "sender_full_name": "Stephen Thoemmes",
        "timestamp": 1765598002
    },
    {
        "content": "<p>Please let me know if I should ask this in another channel instead</p>",
        "id": 563589907,
        "sender_full_name": "Stephen Thoemmes",
        "timestamp": 1765598051
    },
    {
        "content": "<p>Hello <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span><br>\nSuch questions should be asked in <a class=\"stream\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members\">#new members</a>, but do not post a duplicate there; an admin will probably move this thread to there soon</p>",
        "id": 563590331,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765598564
    },
    {
        "content": "<p>As for your question, when <code>rw</code> fails with such an error where it looks obvious that the pattern is in the goal, I find it helps to hover over stuff to check their type, in both your goal and the question mark thingies (metavariables) in the error message</p>",
        "id": 563590388,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765598632
    },
    {
        "content": "<p>Here you'll find that your goal has two different zeros. One is of type <code>K</code>, and the other is a natural number</p>",
        "id": 563590412,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765598657
    },
    {
        "content": "<p>You introduced natural number zero with the first <code>apply</code>, so the solution is to do:<br>\n<code>apply add_right_cancel (b := (0 : K) • w)</code></p>",
        "id": 563590429,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765598692
    },
    {
        "content": "<p>Just found out that this is what <a href=\"https://adam.math.hhu.de/#/g/zrtmrh/linearalgebragame/world/VectorSpaceWorld/level/1\">the game itself</a> recommends when you press \"Show more help\" on that level.<br>\nDid they introduce you to similar casting issues before? If not, then I highly recommend watching <a href=\"https://www.youtube.com/playlist?list=PLs6rMe3K87LHu03WWh9rEbEhhCilTRFGE\">this Lean Real-Analysis course</a>, I think it's a nice beginner-friendly introduction to Lean.</p>",
        "id": 563590701,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765598986
    },
    {
        "content": "<p>This is amazing info, thank you so much.</p>",
        "id": 563591426,
        "sender_full_name": "Stephen Thoemmes",
        "timestamp": 1765599780
    },
    {
        "content": "<p>This topic was moved here from <a href=\"#narrow/channel/270676-lean4/topic/rw.20.5B.E2.86.90.20add_smul.5D.20fails.20to.20find.20pattern.20in.20Vector.20Space.20World\">#lean4 &gt; rw &#91;← add_smul&#93; fails to find pattern in Vector Space World</a> by <span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span>.</p>",
        "id": 563606631,
        "sender_full_name": "Notification Bot",
        "timestamp": 1765618213
    },
    {
        "content": "<p>This is very helpful. Unfortunately, for me, there was no \"Show more help\" button, and I got no error messages when using <code>rw [\\l add_smul]</code> and variations, just the same active goal listed again and again. I imagined that the source code of the world would be the next place to turn, but I couldn't find that anywhere. It seems likely that this is just one manifestation of a general problem (maybe related to crashes requiring a reload when using tactics which don't immediately prove all goals).</p>",
        "id": 565033386,
        "sender_full_name": "Patrick Beart",
        "timestamp": 1766419865
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1008364\">Patrick Beart</span> <a href=\"#narrow/channel/113489-new-members/topic/rw.20.5B.E2.86.90.20add_smul.5D.20fails.20to.20find.20pattern.20in.20Vector.20Space.20World/near/565033386\">said</a>:</p>\n<blockquote>\n<p>I imagined that the source code of the world would be the next place to turn, but I couldn't find that anywhere.</p>\n</blockquote>\n<p><a href=\"https://github.com/ZRTMRH/LinearAlgebraGame/blob/a67bd0fa7d9ac6eed7485c0be0a465d4a29b5a75/Game/Levels/VectorSpaceWorld/Level01.lean#L225\">https://github.com/ZRTMRH/LinearAlgebraGame/blob/a67bd0fa7d9ac6eed7485c0be0a465d4a29b5a75/Game/Levels/VectorSpaceWorld/Level01.lean#L225</a></p>",
        "id": 565038533,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1766421846
    }
]