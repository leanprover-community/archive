[
    {
        "content": "<p>I am trying to write a very basic, but non-structurally recursive function: the merging of two sorted lists. I know which measure to use (the sum of lengths ot the two lists), but I cannot prove the goals because (I believe) I don't know how to tell Lean to \"remember equations\" about the arguments.</p>\n<p>MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ms</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">l2</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">l1</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v1</span><span class=\"bp\">::</span><span class=\"n\">l1'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v2</span><span class=\"bp\">::</span><span class=\"n\">l2'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"bp\">::</span><span class=\"o\">(</span><span class=\"n\">ms</span><span class=\"w\"> </span><span class=\"n\">l1'</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"bp\">::</span><span class=\"o\">(</span><span class=\"n\">ms</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"n\">l2'</span><span class=\"o\">)</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"o\">)</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- l1'.length + l2.length &lt; l1'.length + 1 + (l2'.length + 1)</span>\n<span class=\"w\">  </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- l1.length + l2'.length &lt; l1'.length + 1 + (l2'.length + 1)</span>\n</code></pre></div>\n<p>In both <code>sorry</code>s above, I have no way to conclude because I have no hypothesis linking <code>l2</code> and <code>l2'</code> (its tail), or <code>l1</code> and <code>l1'</code> (again, its tail).</p>\n<p>Very likely this is a completely standard problem and I'm just missing some annotation somewhere...</p>\n<p>Of course I could just reconstruct <code>l1</code> as <code>v1::l1'</code> and <code>l2</code> as <code>v2::l2'</code>, but I'm pretty sure there is a simpler way to do this...</p>",
        "id": 523811369,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749752990
    },
    {
        "content": "<p>You can try<br>\n<code>match h1 : l1, h2 : l2 with</code></p>",
        "id": 523813935,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749753965
    },
    {
        "content": "<p>Perfect, thanks!</p>\n<p>(the linter still underlines the <code>h1</code> and <code>h2</code> as unused variables, even though they are used in the proofs)</p>",
        "id": 523823592,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749758394
    },
    {
        "content": "<p>Then you can also do<br>\n<code>match _ : l1, _ : l2 with</code><br>\nto shut it up</p>",
        "id": 523823690,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749758432
    },
    {
        "content": "<p>If I do this, then I cannot rewrite them! They are really used, just not in the definition of the function, only in the proof of its termination (I'd say they really should not be considered unused variables, but I have no idea how the option works and can be changed)</p>",
        "id": 523825922,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1749759451
    }
]