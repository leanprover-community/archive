[
    {
        "content": "<p>Why does <code>String.replace</code> with the empty pattern just return the original string? I feel like it should instead insert the replacement between every character like in other languages.</p>\n<p>Ex.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"s2\">\"abc\"</span><span class=\"bp\">.</span><span class=\"n\">replace</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"w\"> </span><span class=\"s2\">\"k\"</span><span class=\"w\"> </span><span class=\"c1\">-- \"abc\"</span>\n</code></pre></div>\n<p>Compare to JavaScript</p>\n<div class=\"codehilite\" data-code-language=\"JavaScript\"><pre><span></span><code><span class=\"s2\">\"abc\"</span><span class=\"p\">.</span><span class=\"nx\">replaceAll</span><span class=\"p\">(</span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"s2\">\"k\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\">// \"kakbkck\"</span>\n</code></pre></div>",
        "id": 547102304,
        "sender_full_name": "Serena",
        "timestamp": 1761454155
    },
    {
        "content": "<p>This seems like reasonable behavior given the docstring: \"replaces all occurrences of <code>pattern</code> with <code>replacement</code>\". If the pattern is empty, it seems reasonable to say it doesn't occur. At least more reasonable than the javascript behavior.</p>",
        "id": 547104440,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1761456797
    },
    {
        "content": "<p>If the pattern is the empty string, then it occurs between every char</p>",
        "id": 547104490,
        "sender_full_name": "Serena",
        "timestamp": 1761456883
    },
    {
        "content": "<p>This also matches regex behavior</p>",
        "id": 547104495,
        "sender_full_name": "Serena",
        "timestamp": 1761456895
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"976524\">Serena</span> <a href=\"#narrow/channel/113489-new-members/topic/String.2Ereplace.20with.20empty.20pattern/near/547104490\">said</a>:</p>\n<blockquote>\n<p>If the pattern is the empty string, then it occurs between every char</p>\n</blockquote>\n<p>but it also occurs <em>twice</em> between every two chars...</p>",
        "id": 547112072,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761465895
    },
    {
        "content": "<p>I think the Python behavior aligns with JavaScript here</p>",
        "id": 547118668,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761473319
    },
    {
        "content": "<p>I recommend opening an RFC and listing the behaviors in ~5 other languages</p>",
        "id": 547118697,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761473347
    },
    {
        "content": "<p>No need to go through the trouble of writing an RFC, I'm about to redefine <code>String.replace</code> anyway and I will make sure that it matches the JavaScript behavior.</p>",
        "id": 547118899,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761473602
    },
    {
        "content": "<p>What is <code>\"\".replaceAll(\"\",\"k\")</code> supposed to give? Is this consistent across languages?</p>",
        "id": 547150261,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761502854
    },
    {
        "content": "<p>js says <code>\"k\"</code>, python says <code>\"k\"</code>, Lean says <code>\"\"</code>, I don't know how to do this operation in any other languages</p>",
        "id": 547151644,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761504334
    },
    {
        "content": "<p>With <a href=\"https://chatgpt.com/share/68febf4a-8d8c-8012-8501-9b43cb3610e4\">ChatGPT's help</a>, I've manually run the code in the languages it gave me:</p>\n<ul>\n<li><a href=\"https://ideone.com/Y6xSWO\">Python</a>: kakbkck, k</li>\n<li><a href=\"https://ideone.com/ndoJi2\">Java</a>: kakbkck, k</li>\n<li><a href=\"https://ideone.com/6P4xxi\">C#</a>: error (String cannot be of zero length)</li>\n<li><a href=\"https://ideone.com/s1Hol2\">PHP</a>: abc, \"\"</li>\n<li><a href=\"https://ideone.com/mu4fqs\">Ruby</a>: kakbkck, k</li>\n<li><a href=\"https://ideone.com/3XywdN\">Kotlin</a>: kakbkck, k</li>\n<li><a href=\"https://ideone.com/vJuiAz\">Dart</a>: kakbkck, k</li>\n<li><a href=\"https://ideone.com/vHT3tN\">R</a>: kakbkck, k</li>\n</ul>",
        "id": 547171156,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761525759
    },
    {
        "content": "<p>It is worth noting that the languages behavior of different languages differs when used on non-ASCII characters.<br>\nWhen I ran something like <code>\"â„•\".replace(\"\", \"z\")</code>and <code>\"ğ”¸\".replace(\"\", \"z\")</code>and <code>\"vÌ‚\".replace(\"\", \"z\")</code> on different languages I got:</p>\n<ul>\n<li>Python 3: \"zâ„•z\" and \"zğ”¸z\" and \"zvzÌ‚z\"</li>\n<li>Java and Kotlin: \"zâ„•z\" and \"z?z?z\" and \"zvzÌ‚z\"</li>\n<li>Ruby: \"zâ„•z\" and \"zğ”¸z\" and \"zvzÌ‚z\"</li>\n<li>Dart: \"zâ„•z\" and \"zï¿½zï¿½z\" and \"zvzÌ‚z\"</li>\n<li>R: \"zâ„•z\" and \"zğ”¸z\" and \"zvzÌ‚z\"</li>\n<li><a href=\"https://ideone.com/TK9Dbm\">C++</a>: \"zï¿½zï¿½zï¿½z\" and \"zï¿½zï¿½zï¿½zï¿½z\" and \"zvzï¿½zï¿½z\"</li>\n</ul>\n<p>(Note: â„• is in the BMP, ğ”¸ is not in the BMP, and vÌ‚ is actually two characters but one grapheme cluster)</p>",
        "id": 547214256,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761552822
    },
    {
        "content": "<p>To add a language whose strings work with grapheme clusters:</p>\n<ul>\n<li><a href=\"https://swiftfiddle.com/vkt27rd4izez5gw5i6dwopbaai\">Swift</a>: \"zâ„•z\" and \"zğ”¸z\" and \"zvÌ‚z\"</li>\n</ul>\n<p>Since Lean's strings are based on Unicode scalar values, the desired behavior in Lean is \"zâ„•z\" and \"zğ”¸z\" and \"zvzÌ‚z\".</p>",
        "id": 547215583,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761553329
    },
    {
        "content": "<p>relevant: <a href=\"https://lukeplant.me.uk/blog/posts/breaking-provably-correct-leftpad/\">https://lukeplant.me.uk/blog/posts/breaking-provably-correct-leftpad/</a></p>",
        "id": 547231369,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761558305
    },
    {
        "content": "<p>I see. I don't quite understand why Lean strings have an api based on unicode scalar values, but given that they do, this behavior makes sense.</p>\n<p>Edit: Nevermind, the data model of string apparently changed last month to be what I would expect it to be.</p>",
        "id": 547374999,
        "sender_full_name": "Niels Voss",
        "timestamp": 1761600737
    },
    {
        "content": "<p>Sorry for being unclear. What I meant was that the conceptual model of strings (basically: the answer to \"a string is a sequence of what exactly?\") that Lean chooses is that a string is a sequence of Unicode scalar values, just like Python and Rust. How to actually represent those Strings at runtime is a somewhat orthogonal question; here Lean chooses UTF-8.</p>",
        "id": 547418579,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1761633030
    }
]