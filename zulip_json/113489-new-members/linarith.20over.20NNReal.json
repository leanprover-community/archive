[
    {
        "content": "<p>I find linarith very useful for inequalities in ℝ (I know when it will/won't work), and I miss a tactic like it in NNReal, and I'm wondering how people work with inequalities in NNReal. I think I understand why linarith doesn't work (Fourier-Motzkin elimination (FME) won't work with saturating subtraction). One way I saw to prove inequalities is to transfer to <code>ℝ</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">NNReal</span><span class=\"bp\">.</span><span class=\"n\">coe_lt_coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"n\">NNReal</span><span class=\"bp\">.</span><span class=\"n\">coe_le_coe</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"n\">push_cast</span>\n<span class=\"w\">    </span><span class=\"c1\">-- now h1, h2, ⊢ are statements about ℝ, so linarith works</span>\n<span class=\"w\">    </span><span class=\"n\">linarith</span>\n</code></pre></div>\n<p>This is less convenient as it modifies all the assumptions by default, and I also need to manually rewrite inequalities to <code>&lt;</code> or <code>≤</code> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h1'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\">  </span><span class=\"c1\">-- necessary otherwise the next line fails to modify h1</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">NNReal</span><span class=\"bp\">.</span><span class=\"n\">coe_lt_coe</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"n\">NNReal</span><span class=\"bp\">.</span><span class=\"n\">coe_le_coe</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"n\">push_cast</span>\n<span class=\"w\">    </span><span class=\"n\">linarith</span>\n</code></pre></div>\n<p>And it needs help to prove that specific subtractions don't saturate: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- I don't actually know how to prove this, haven't needed to learn yet</span>\n</code></pre></div>\n<p>Some concrete questions:</p>\n<ol>\n<li>Is there some algorithm like FME in informal math that proves linear inequalities with \"saturating\" subtraction?</li>\n<li>Is there a uniform way to prove the first two examples? E.g. a tactic to rewrite all inequalities to <code>&lt;</code> / <code>≤</code>. Even better if it handles all 3 examples.</li>\n</ol>",
        "id": 497269044,
        "sender_full_name": "Li Xuanji",
        "timestamp": 1738512241
    },
    {
        "content": "<p>Do you know about <code>rify</code>?</p>",
        "id": 497269257,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738512395
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308587\">Li Xuanji</span> <a href=\"#narrow/channel/113489-new-members/topic/linarith.20over.20NNReal/near/497269044\">said</a>:</p>\n<blockquote>\n<p>a tactic to rewrite all inequalities to <code>&lt;</code> / <code>≤</code></p>\n</blockquote>\n<p>The mathlib philosophy here is to have all inequalities in the form <code>&lt;</code> / <code>≤</code> in the first place. Who handed you those shady <code>&gt;</code>/<code>≥</code>?</p>",
        "id": 497269391,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738512502
    },
    {
        "content": "<blockquote>\n<p>Do you know about <code>rify</code>?</p>\n</blockquote>\n<p>Not really - I use <code>zify</code> so I have some idea of what this kind of tactic does, but the <code>rify</code> docstring doesn't mention NNReal (only <code>ℕ</code>, <code>ℤ</code> or <code>ℚ</code>)</p>\n<blockquote>\n<p>Who handed you those shady <code>&gt;</code>/<code>≥</code>?</p>\n</blockquote>\n<p>Some informal math proof which has steps like <code>(some complicated expression) &gt; (a simpler expression) &gt; (a very simple expression)</code>. I try to rewrite stuff in <code>&lt;</code> / <code>≤</code> but when working with ℝ I'm used to being able to switch to the other form (for short sections at least) and having <code>linarith</code> deal with it</p>",
        "id": 497269767,
        "sender_full_name": "Li Xuanji",
        "timestamp": 1738512875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308587\">Li Xuanji</span> <a href=\"#narrow/channel/113489-new-members/topic/linarith.20over.20NNReal/near/497269767\">said</a>:</p>\n<blockquote>\n<p>the <code>rify</code> docstring doesn't mention NNReal (only <code>ℕ</code>, <code>ℤ</code> or <code>ℚ</code>)</p>\n</blockquote>\n<p>Ah! If it doesn't handle <code>ℝ≥0</code>, we definitely should change it so that it does <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 497269902,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1738512998
    },
    {
        "content": "<p>Yes, given that we have <code>zify</code> to go to Int from Nat, we should make <code>rify</code> work from NNreal to Real, presumably following what <code>zify</code> does.</p>",
        "id": 497274030,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738516669
    }
]