[
    {
        "content": "<p>I noticed that if a goal can be closed by <code>simp</code> and another by <code>simpa</code> then closing both using a single <code>simpa</code> statements triggers <code>linter.unnecessarySimpa</code> as in:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simpa</span>\n</code></pre></div>\n<p>In this case <code>simp</code> does not work (because the second goal requires <code>assumption</code>) and the warning message <code>try 'simp' instead of 'simpa'</code> is confusing. But I wonder if the warning could be disabled altogether when closing multiple goals.</p>\n<p>Of course this particular example can take a simpler form:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>But I have encountered this pattern with several tactics which create multiple goals (<code>by_cases</code>, <code>rewrite</code>, <code>split</code>...)</p>\n<p>Any advice? In particular:</p>\n<ul>\n<li>is there a better way to solve some goals by <code>simp</code> and others by <code>simpa</code> in a single statement?</li>\n<li>would disabling the warning as I suggest even be feasible? (I tried to follow the code in <code>src/Lean/Elab/Tactic/Simpa.lean</code> but I am not sure)</li>\n<li>would there be cases where disabling the warning as I suggest would be undesirable?</li>\n</ul>",
        "id": 501781442,
        "sender_full_name": "Nico",
        "timestamp": 1740483437
    },
    {
        "content": "<p>If you are using <code>Batteries</code>, an alternative is to use the <code>&lt;;&gt; [...;...]</code> combinator as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 501783144,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740483902
    },
    {
        "content": "<p>The tactic is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Batteries.Tactic.seq_focus#doc\">docs#Batteries.Tactic.seq_focus</a>.</p>",
        "id": 501783289,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740483950
    },
    {
        "content": "<p>As a matter of personal preference, I am not a huge fan of the <code>&lt;;&gt;</code> combinator and its friends.  They certainly avoid code duplication, which is great.  However, using them for complicated proofs (which is certainly not the case in what you mention above), produces code that is hard to maintain.</p>",
        "id": 501784133,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740484217
    },
    {
        "content": "<p>From this perspective, the <code>seq_focus</code> above is better: it tells you explicitly what you are doing in each branch at the (small) cost of writing a few extra characters.</p>",
        "id": 501784287,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740484275
    },
    {
        "content": "<p>thanks! this tactic is a neat trick <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> <br>\nI like a short proof and <code>&lt;;&gt;</code> is great for that, but I am starting to see what you mean <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> <br>\nmodifying a proof with <code>&lt;;&gt;</code> often requires me to unfold all the cases, rewite some of them and find a way to fold them back...</p>",
        "id": 501784742,
        "sender_full_name": "Nico",
        "timestamp": 1740484427
    },
    {
        "content": "<p>Right: if you are doing this once, it is ok.  If you later start refactoring and some branch breaks, it becomes a mess to maintain.</p>",
        "id": 501786370,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1740484748
    }
]