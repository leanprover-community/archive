[
    {
        "content": "<p>Is there any mechanism for preventing <code>notation</code> declarations from an imported package from applying? I see <code>ident hiding ident</code> from <a href=\"https://lean-lang.org/doc/reference/latest/Namespaces-and-Sections/#namespaces-sections\">https://lean-lang.org/doc/reference/latest/Namespaces-and-Sections/#namespaces-sections</a> but it's not clear to me if that could apply to <code>notation</code>.</p>",
        "id": 512152590,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657061
    },
    {
        "content": "<p>Not if it's globally declared. Which notation do you want to prevent?</p>",
        "id": 512152732,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744657112
    },
    {
        "content": "<p>My imagined usecase is wanting to use <code>notation</code> of, e.g. ≤ for something else, despite it being connected to LE.le in the prelude.</p>",
        "id": 512152739,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657116
    },
    {
        "content": "<p>For, conceivably, pedagogical purposes; imagine someone wanting to give some example Lean code that builds up the idea of natural numbers and the less-than-or-equal relation from scratch.</p>",
        "id": 512152816,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657148
    },
    {
        "content": "<p>That's not a problem. You don't need to disable the notation for that.</p>",
        "id": 512152871,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1744657173
    },
    {
        "content": "<p>instead, define an instance of <code>LE MyNat</code></p>",
        "id": 512152916,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744657189
    },
    {
        "content": "<p>That makes a lot of sense if I want to make my own development that has its own custom notion of &lt;=, but my imagined use-case is targetting an audience that is just learning lean, and maybe even learning about dependent types for the first time, and maybe doesn't want to learn about the typeclass machinery as a prerequesite.</p>",
        "id": 512153193,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657277
    },
    {
        "content": "<p>But, shrug, I'm not super upset, just exploring what's feasible and what's not. Appreciate the explanation of that workaround. I remain curious if there are others.</p>",
        "id": 512153254,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657298
    },
    {
        "content": "<p>To not put too fine a point on it, I was glancing at <span class=\"user-mention\" data-user-id=\"505123\">@Philip Wadler</span> 's <a href=\"https://plfa.inf.ed.ac.uk/Relations/\">https://plfa.inf.ed.ac.uk/Relations/</a> and noticing he was trying to port some of that book to Lean and thinking through myself as an exercise how that chapter would look</p>",
        "id": 512154084,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657594
    },
    {
        "content": "<p>I am kind of intrigued/confused by what you are looking for here. If you want to use Lean's Nat but not Lean's &lt;= then just remove the relevant instance attributes with <code>attribute [-instance] ...</code>. But this will break a lot of things. But it sounds like you want them to break?</p>",
        "id": 512154127,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744657610
    },
    {
        "content": "<p>I'm not trying to be too narrowminded in \"what I want\" and perfectly amenable to being talked out of what it seems like I'm asking for :)</p>",
        "id": 512154227,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657648
    },
    {
        "content": "<p>That link to PLFA captures what I notice is nice about the development in agda, which is that you can tell a story where you can, from scratch</p>\n<ul>\n<li>invent the natural numbers</li>\n<li>invent the le relation</li>\n<li>use reasonably pleasant mathematician-familiar unicode infix notation while doing so</li>\n</ul>",
        "id": 512154322,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657674
    },
    {
        "content": "<p>did you see <a href=\"https://adam.math.hhu.de/#/g/leanprover-community/nng4\">https://adam.math.hhu.de/#/g/leanprover-community/nng4</a> ?</p>",
        "id": 512154459,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744657719
    },
    {
        "content": "<p>and my question is really \"neat, how much of that can be obtained in Lean\"</p>",
        "id": 512154486,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657729
    },
    {
        "content": "<p>It is in lean?</p>",
        "id": 512154515,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744657740
    },
    {
        "content": "<p>Yes --- so I'm curious, what did it do under the hood? Not import Prelude at all?</p>",
        "id": 512154588,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657755
    },
    {
        "content": "<p>Defined a <code>MyNat</code> and notated it as <code>ℕ</code></p>",
        "id": 512154671,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744657786
    },
    {
        "content": "<p>No it imports loads of Lean. It just redefines the natural numbers and overrides \\N so that it means the local version.</p>",
        "id": 512154679,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744657789
    },
    {
        "content": "<p>You can still see the <code>MyNat</code> through the hover tooltips</p>",
        "id": 512154762,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1744657804
    },
    {
        "content": "<p>You can see how it does it here <a href=\"https://github.com/leanprover-community/NNG4/blob/main/Game/MyNat/Definition.lean\">https://github.com/leanprover-community/NNG4/blob/main/Game/MyNat/Definition.lean</a></p>",
        "id": 512154919,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744657859
    },
    {
        "content": "<p>Ah, ok, so for le it does in fact <a href=\"https://github.com/leanprover-community/NNG4/blob/main/Game/MyNat/LE.lean\">just define an instance</a>.</p>",
        "id": 512155054,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744657909
    },
    {
        "content": "<p>In fact the instance it defines is totally different to the LE on Lean's Nat because a lot of testing with undergraduates convinced me that the recursive definition was quite hard for mathematicians to understand.</p>",
        "id": 512155307,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744657971
    },
    {
        "content": "<p>But what I'm hearing is, as long as you import Prelude, &lt;= is tied irrevocably to the LE typeclass?</p>",
        "id": 512155407,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658010
    },
    {
        "content": "<p>In fact the comment about \"as long as we do not import <code>Mathlib.Init.Data.Nat.Notation</code> this is fine.\" seems to be incorrect; the priority overrides the notation for \\N fine.</p>\n<p>Yes <code>≤</code> is just notation for the <code>LE</code> typeclass but the <code>LE</code> typeclass can mean whatever you want it to mean, there are no axioms.</p>",
        "id": 512155564,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744658058
    },
    {
        "content": "<p>Yeah, I do see that to be the case for LE specifically; although it seems to me it would be a nice feature to be able to do something like <code>hiding</code> for other notations potentially. Not every library author is going to ensure that every <code>notation</code> is equally open-ended. But I hear some skepticism about the value of that feature and that is ok :) I am certainly right here in the new-members channel so I won't presume expertise about the tradeoffs.</p>",
        "id": 512155907,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/Hiding.20notations.20or.20macros.3F/near/512155407\">said</a>:</p>\n<blockquote>\n<p>But what I'm hearing is, as long as you import Prelude, &lt;= is tied irrevocably to the LE typeclass?</p>\n</blockquote>\n<p>You can define <code>macro_rules</code> to override what the notation expands to.</p>",
        "id": 512155922,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658187
    },
    {
        "content": "<p>You lose pretty printing without defining more rules though.</p>",
        "id": 512155967,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658201
    },
    {
        "content": "<p>Interesting</p>",
        "id": 512156046,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658233
    },
    {
        "content": "<p>I think someday there will be a way to hide notations, but I don't believe it's on any roadmap at the moment.</p>",
        "id": 512156075,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658248
    },
    {
        "content": "<p>Yeah I can very easily see this as in the \"nice to have but not blocking anything important\" bucket</p>",
        "id": 512156204,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658285
    },
    {
        "content": "<p>Anyway thanks all for the responses!</p>",
        "id": 512156220,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658290
    },
    {
        "content": "<p>In fact you can just override the standard &lt;= by giving a new instance with higher priority:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MyLE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">10000000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">MyLE</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 512156403,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744658364
    },
    {
        "content": "<p>In NNG there is all sorts of shenannigans going on under the hood but we can hide it from the user easily and the same is true for lots of Lean examples -- you just do the dirty work in a file which you import at the top.</p>",
        "id": 512156505,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744658402
    },
    {
        "content": "<p>Yeah ok I guess this works not too badly in this particular case. You can still define the MyLE as an inductive type and then secretly in a hidden literate code block wire it up as an instance if you don't want to scare the reader with typeclasses.</p>",
        "id": 512156845,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658532
    },
    {
        "content": "<p>That works so long as it's the same Nat (if it's a custom Nat, default instances might still find the original LE Nat)</p>",
        "id": 512156917,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658556
    },
    {
        "content": "<p>Here's how you override the meaning of a notation and get it to pretty print:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro_rules</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">app_unexpander</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unexpandNatAdd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Unexpander</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>",
        "id": 512156957,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658570
    },
    {
        "content": "<p>This specializes <code>+</code> to <code>Nat.add</code>.</p>",
        "id": 512157037,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744658602
    },
    {
        "content": "<p>And this just takes priority over other <code>macro_rules</code> that were previously defined that would have matched the same expression? Like, in the case of LE, <a href=\"https://github.com/leanprover/lean4/blob/bfb02be28168d05ae362d6d9a135ec93820ca1cb/src/Init/Notation.lean#L347\">https://github.com/leanprover/lean4/blob/bfb02be28168d05ae362d6d9a135ec93820ca1cb/src/Init/Notation.lean#L347</a> ?</p>",
        "id": 512157998,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744658951
    },
    {
        "content": "<p>Yeah, newer rules take precedence.</p>\n<p>In fact, the linked rule you gave is itself taking precedence over the one defined by <a href=\"https://github.com/leanprover/lean4/blob/bfb02be28168d05ae362d6d9a135ec93820ca1cb/src/Init/Notation.lean#L333\">https://github.com/leanprover/lean4/blob/bfb02be28168d05ae362d6d9a135ec93820ca1cb/src/Init/Notation.lean#L333</a></p>",
        "id": 512158727,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659214
    },
    {
        "content": "<p>Great, you anticipated and answered a question I had then</p>",
        "id": 512158906,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659280
    },
    {
        "content": "<p>I infer from empirical evidence that <code>notation</code> priority is not powerful enough to contradict any <code>macro_rules</code>, by the fact that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyLeNotation</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1000000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" ≤ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">le</span>\n</code></pre></div>\n<p>doesn't appear to work, yeah?</p>",
        "id": 512159081,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659345
    },
    {
        "content": "<p>(forgive me for not <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> ing, I can do so if that would help)</p>",
        "id": 512159122,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659360
    },
    {
        "content": "<p>(it would help me!)</p>",
        "id": 512159215,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744659387
    },
    {
        "content": "<p>ok, then give me a minute or two and I will, most likely it'll help me understand in more detail what I'm actually doing as well here...</p>",
        "id": 512159328,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659434
    },
    {
        "content": "<p><code>notation</code> introduces a new <code>syntax</code> that's independent from the original one. Lean will parse the syntax with the old syntax and the new syntax simultaneously and attempt to disambiguate. That's why I suggest a <code>macro_rule</code>.</p>",
        "id": 512159969,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659635
    },
    {
        "content": "<p>mwe is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">leZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"c1\">------------</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"c1\">-------------</span>\n<span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyLeNotation</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1000000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\" ≤ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">le</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">le</span>\n\n<span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">two_le_four</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"n\">leZero</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>What I naively expected was: Code typechecks ok<br>\nWhat I observed was: The final ≤ appears to be referring to Prelude ≤. I'm concluding tentatively this is because the <code>macro_rules</code> <a href=\"https://github.com/leanprover/lean4/blob/bfb02be28168d05ae362d6d9a135ec93820ca1cb/src/Init/Notation.lean#L347\">in the Prelude affecting ≤</a> is preventing any <code>notation</code> declarations from having any effect. Happy to hear if I'm wrong about that though.</p>",
        "id": 512159978,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659638
    },
    {
        "content": "<p>As a general thing maybe I should just dive into the elaborator docs and source and understand what's going on in a principled way instead of making random guesses :)</p>",
        "id": 512160255,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659733
    },
    {
        "content": "<p>Do you intend to use <code>notation</code> here instead of <code>infix</code> like how the le notation was originally defined?</p>",
        "id": 512160363,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659789
    },
    {
        "content": "<p>I don't have any commitment to using <code>notation</code>, no</p>",
        "id": 512160431,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659812
    },
    {
        "content": "<p>I was just trying to answer <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> 's question of what I was doing in the form of a self-contained example</p>",
        "id": 512160500,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659841
    },
    {
        "content": "<p>I'm basically asking, are you aware that the notation you defined is this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">two_le_four</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"n\">leZero</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 512160538,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659843
    },
    {
        "content": "<p>Oh! No I was not aware</p>",
        "id": 512160565,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659858
    },
    {
        "content": "<p><code>notation</code> is for defining the full notation, and the <code>infix</code> family are macros that expand out to a <code>notation</code>.</p>",
        "id": 512160623,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659887
    },
    {
        "content": "<p>I'd copy the prelude <code>infix</code> definition and start  from there.</p>",
        "id": 512160646,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744659896
    },
    {
        "content": "<p>Ah, thanks for your patience with me making silly mistakes then in that case</p>",
        "id": 512160669,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744659903
    },
    {
        "content": "<p>In that case, I observe </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">leZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"c1\">------------</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"c1\">-------------</span>\n<span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyLeNotation</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1000000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"s2\">\" ≤ \"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">le</span>\n\n<span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">two_le_four</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">leStep</span><span class=\"w\"> </span><span class=\"n\">leZero</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>does work, and now I realize I simply don't understand exactly how <code>macro_rules</code> and <code>notation</code> interact when they presume to work on the same identifier. But maybe that's not something I need to bother y'all about at the moment.</p>",
        "id": 512161097,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660078
    },
    {
        "content": "<p><code>notation</code> does three things:</p>\n<ol>\n<li>defines a <code>syntax</code> declaration</li>\n<li>defines a <code>macro_rules</code> to expand the syntax</li>\n<li>defines a pretty printer (if possible)</li>\n</ol>",
        "id": 512161307,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744660162
    },
    {
        "content": "<p>I'm quite happy with having learned that things I can do include</p>\n<ul>\n<li>define my own <code>macro_rules</code></li>\n<li>define notations with different priorities for when the time comes that lean attempts to disambiguate overlapping notations</li>\n<li>simply reuse library notations if I'm lucky and their scope includes the thing I'm trying to do with them (i.e. the \"just instance the typeclass\" solution)</li>\n</ul>",
        "id": 512161320,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660168
    },
    {
        "content": "<p>I'd be careful defining a <code>notation</code> like that, without copying exactly all the binding powers of the notation you're shadowing.</p>",
        "id": 512161470,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744660216
    },
    {
        "content": "<p>Can you clarify what \"binding powers\" that entails?</p>",
        "id": 512161510,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660234
    },
    {
        "content": "<p>It's the <code>:50</code> part that you're not copying. It specifies with what precedence the operands should be parsed.</p>",
        "id": 512161630,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744660281
    },
    {
        "content": "<p>Ok sure that seems like a sensible warning then thanks</p>",
        "id": 512161673,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660301
    },
    {
        "content": "<p>I thought for a moment you meant binding in the sense of variable binding</p>",
        "id": 512161703,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660314
    },
    {
        "content": "<p>The problem is that you might get structurally different parses using the old notation and the new notation, and it might be impossible to disambiguate and otherwise be very confusing.</p>",
        "id": 512161799,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744660345
    },
    {
        "content": "<p>from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Command.expandMixfix#doc\">docs#Lean.Elab.Command.expandMixfix</a> we can see that <code>infix:50 \"foo\" =&gt; v</code> expands as <code>notation:50 x:51 \"foo\" y:51 =&gt; v x y</code></p>",
        "id": 512162070,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744660453
    },
    {
        "content": "<p>I killed default &lt;= but it took a while!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">instLENat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instPreorder</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instPartialOrder</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommMonoid</span>\n<span class=\"w\">    </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommMonoidWithZero</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instOrderedSemiring</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instOrderedCommSemiring</span>\n<span class=\"w\">    </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instStrictOrderedCommSemiring</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCommSemiring</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instStrictOrderedSemiring</span>\n<span class=\"w\">    </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedSemiring</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedAddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrderedCancelAddCommMonoid</span>\n<span class=\"w\">    </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLattice</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instConditionallyCompleteLinearOrderBot</span><span class=\"w\"> </span><span class=\"n\">instDistribLatticeNat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">instLinearOrder</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">LE</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 512162200,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744660514
    },
    {
        "content": "<p>This is the First-Person Shooter variant of the natural numbers game, I take it.</p>",
        "id": 512162505,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744660630
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> has marked this topic as resolved.</p>",
        "id": 512167054,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744662303
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Hiding.20notations.20or.20macros.3F/near/512161799\">said</a>:</p>\n<blockquote>\n<p>that <code>infix:50 \"foo\" =&gt; v</code> expands as <code>notation:50 x:51 \"foo\" y:51 =&gt; v x y</code></p>\n</blockquote>\n<p>Is there a convenient way to automate this, by interrogating the elaborator live? I thought <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAGQKYEMB2AoDATJAzOADzgC4BeObCRVNAOgFEAbFAIzoGEIQR1s6khMHwCywQnnFwAFIATCAAbTgaSYRIBWAAxwARHggQdcMgD44ANwCUljAGIwUZfEJA\">this might do it</a> but I'm just getting the monadic expression, not the result of running it. (Or, naturally, also would be happy to know where in the documentation should I have been looking to find this out)</p>",
        "id": 512168273,
        "sender_full_name": "Jason Reed",
        "timestamp": 1744662756
    },
    {
        "content": "<p>That's printing the definition of a function to do it, not the result.</p>\n<p>Here's one way.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">expandMixfix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←`</span><span class=\"o\">(</span><span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">))</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">liftMacroM</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{ex}\"</span>\n</code></pre></div>",
        "id": 512170602,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744663687
    }
]