[
    {
        "content": "<p>Hi! I'm trying to create a function that can operate on any kind of type, but mostly returns none. I have this definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but I get the error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">true</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<p>Is it possible to pattern match on Type? If not, is there some other way to achieve a similar sort of behavior? Thanks!</p>",
        "id": 520330485,
        "sender_full_name": "Sam Cymbaluk",
        "timestamp": 1748211313
    },
    {
        "content": "<p>Could you explain why you want to write a function that operates on any kind of type?</p>",
        "id": 520335278,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748216021
    },
    {
        "content": "<p>I think the closest thing to what you want would be to use a typeclass</p>",
        "id": 520335351,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1748216105
    },
    {
        "content": "<p>Type universes are not inductive types, so you can't match on their elements. But you can define a class.</p>",
        "id": 520336130,
        "sender_full_name": "suhr",
        "timestamp": 1748216980
    },
    {
        "content": "<p>A typeclass would work, though I think it would still be good to understand the use case, just to make sure there isn't an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> problem here</p>",
        "id": 520338210,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748219044
    },
    {
        "content": "<p>Thanks for the responses. I'm trying to create a collection of functions with the same type as F that are used for configuring a larger system. The reason for the general type is so that all the functions can be applied the same way, even if some are only concerned with e.g. Bools or Nats. I don't think type classes work because there isn't any shared structure or operation between the elements of Type that I'm interested in. I want access to the type itself so I can use it's particular structure. Something like the <a href=\"https://lean-lang.org/functional_programming_in_lean/dependent-types/typed-queries.html#a-universe-of-data\">Universes of Data</a> from FP in Lean is the closest thing I've found to what I'm trying to do.</p>",
        "id": 520339556,
        "sender_full_name": "Sam Cymbaluk",
        "timestamp": 1748220233
    },
    {
        "content": "<p>Would this work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"mi\">123</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span>\n</code></pre></div>",
        "id": 520340214,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748220793
    },
    {
        "content": "<p>Oh, clever! That does work! Out of curiosity, how does Lean know which instance to use? Both <code>CanF α</code> and <code>CanF Bool</code> apply to <code>F true</code>, but the <code>CanF Bool</code> instance is the one \"prioritized\".</p>",
        "id": 520341595,
        "sender_full_name": "Sam Cymbaluk",
        "timestamp": 1748221981
    },
    {
        "content": "<p>honestly I'm not sure lol</p>\n<p>I suspect there's an answer in this section of the docs: <a href=\"https://lean-lang.org/doc/reference/latest/Type-Classes/Instance-Synthesis/\">https://lean-lang.org/doc/reference/latest/Type-Classes/Instance-Synthesis/</a></p>",
        "id": 520341982,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748222334
    },
    {
        "content": "<p>From that reference page:</p>\n<blockquote>\n<p>Code that uses instance-implicit parameters should be prepared to consider all instances as equivalent. In other words, it should be robust in the face of differences in synthesized instances.</p>\n</blockquote>",
        "id": 520342470,
        "sender_full_name": "Sam Cymbaluk",
        "timestamp": 1748222760
    },
    {
        "content": "<p>Are you quoting that because you're concerned that it means the above code is a bad idea?</p>",
        "id": 520342762,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748222951
    },
    {
        "content": "<p>I think this is how it knows which instance is the correct one:</p>\n<blockquote>\n<p>During instance synthesis, if a goal is fully known (that is, contains no metavariables) and search succeeds, no further instances will be attempted for that same goal. In other words, when search succeeds for a goal in a way that can't be refuted by a subsequent increase in information, the goal will not be attempted again, even if there are other instances that could potentially have been used.</p>\n</blockquote>\n<p>The instances for Nat and Bool have no variables... they're maximally specific.</p>",
        "id": 520342910,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748223092
    },
    {
        "content": "<p>(I could be misreading that though)</p>",
        "id": 520342981,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1748223143
    },
    {
        "content": "<p>Mostly sharing that for posterity, but it does seem like it might be a reason to not use the <code>CanF</code> approach. I'm realizing now that the <code>CanF</code> approach doesn't work for me for other reasons. From what I can tell, it limits me to a single function <code>F</code> rather than being able to have a collection of functions from the same family as <code>F</code>. i.e. <br>\n a <code>List FConfig</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FConfig</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n</code></pre></div>",
        "id": 520343348,
        "sender_full_name": "Sam Cymbaluk",
        "timestamp": 1748223448
    },
    {
        "content": "<p>I think this is an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> problem again. Can you give a MWE with the code you want to work?</p>",
        "id": 520352647,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748230673
    },
    {
        "content": "<p>The answer to the earlier question about how to select instances is that you can set priorities, and if the priorities are all default then the last declaration wins. So it's important in <span class=\"user-mention silent\" data-user-id=\"380294\">Matt Diamond</span> 's example that the <code>none</code> instance comes first. A more idiomatic way to clarify that this is by design is to use <code>instance (priority := low)</code> on that instance.</p>",
        "id": 520352775,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748230764
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/Pattern.20matching.20on.20Type/near/520352775\">said</a>:</p>\n<blockquote>\n<p>if the priorities are all default then the last declaration wins.</p>\n</blockquote>\n<p>Is this true? I thought in the face of ties you were at the whim of discrtree key order.</p>",
        "id": 520408562,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748253719
    },
    {
        "content": "<p>Yeah it also works like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n</code></pre></div>\n<p>Still, discr tree order is deterministic and follows the following (approximate) scheme:</p>\n<ol>\n<li>Parameters are considered in order of occurrence (earlier ones are considered first)</li>\n<li>Generalized parameters come before specialized ones</li>\n<li>For equally specialized variants, the order is exactly insertion order</li>\n</ol>",
        "id": 520491669,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1748276819
    },
    {
        "content": "<p>I don't understand how to read 2 in the context of your three examples; is the third instance tried before the other two?</p>",
        "id": 520550433,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748305587
    },
    {
        "content": "<p>Oh no it's the order in which they are retrieved from the discr tree. Type class search goes through the list in reverse order</p>",
        "id": 520584589,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1748325464
    },
    {
        "content": "<p>so this is not related to category theory? because that sounds like the mathematically standard way to relate different \"types\"</p>",
        "id": 520594908,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1748329850
    },
    {
        "content": "<p>It sounds to me more like this is about polymorphism and not mathematics</p>",
        "id": 520595767,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1748330150
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/stream/113489-new-members/topic/Pattern.20matching.20on.20Type/near/520584589\">said</a>:</p>\n<blockquote>\n<p>Type class search goes through the list in reverse order</p>\n</blockquote>\n<p>The \"list\" being the three instances or the numbered list of three rules?</p>",
        "id": 520630067,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1748340556
    },
    {
        "content": "<p>List of instances.<br>\nLet me make a bigger example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">β</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 1</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 2</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">()</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 3</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 4</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 5</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 6</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CanF</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- 7</span>\n<span class=\"w\">  </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>The order in the discr tree is the following:</p>\n<ol>\n<li>First all instances with the first parameter generalized (2, 3, 5). <code>2</code> has second parameter specialized, so comes after the others: 3, 5, 2</li>\n<li>Then all instances with first parameter specialized (1, 4, 6, 7). The first one that comes up is <code>Nat</code>: 1</li>\n<li>The second one that comes up is <code>Bool</code>: first generalized (6), then specialized (4): 6, 4</li>\n<li>Then <code>Unit</code>: 7</li>\n</ol>\n<p>So the discr tree order is: 3, 5, 2, 1, 6, 4, 7. Instance synthesization then takes those of these that match and goes through them in reverse order, so for <code>CanF Bool Nat</code> the order they are tried in is: 4, 6, 5, 3</p>",
        "id": 520679759,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1748355350
    }
]