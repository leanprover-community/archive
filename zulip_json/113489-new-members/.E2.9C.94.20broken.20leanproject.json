[
    {
        "content": "<p>Hi!<br>\nI'm having the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>pedro@solari:~$<span class=\"w\"> </span>leanproject\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/pedro/.local/bin/leanproject\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">5</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>from<span class=\"w\"> </span>mathlibtools.leanproject<span class=\"w\"> </span>import<span class=\"w\"> </span>safe_cli\nModuleNotFoundError:<span class=\"w\"> </span>No<span class=\"w\"> </span>module<span class=\"w\"> </span>named<span class=\"w\"> </span><span class=\"s1\">'mathlibtools'</span>\n</code></pre></div>\n<p><strong>Context</strong>:<br>\nI haven't been using Lean for a while, and I set to port to Lean4 one of my projects using the <a href=\"https://github.com/leanprover-community/mathport#user-content-running-on-a-project-other-than-mathlib\"><code>mathport</code> instructions</a> (<a href=\"https://github.com/leanprover-community/mathport\">cleaner link</a>).</p>\n<p>At some point (certainly at or before the first to require <code>leanproject</code>) I noticed its failure. I checked that VSCode opens the folder of the project without problems (it compiles; Lean is working there).</p>\n<p>This seems to be some Python problem; not sure if some recent update broke mine (I'm using Debian Testing).<br>\nI tried to reinstall the <code>leanproject</code> part using the last bullet point of the <a href=\"https://leanprover-community.github.io/install/debian_details.html\">Controlled installation of Lean and mathlib on Debian/Ubuntu</a>, but it complained about <code>pipx</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>pedro@solari:~$<span class=\"w\"> </span>python3<span class=\"w\"> </span>-m<span class=\"w\"> </span>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>--user<span class=\"w\"> </span>pipx\nerror:<span class=\"w\"> </span>externally-managed-environment\n\n×<span class=\"w\"> </span>This<span class=\"w\"> </span>environment<span class=\"w\"> </span>is<span class=\"w\"> </span>externally<span class=\"w\"> </span>managed\n╰─&gt;<span class=\"w\"> </span>To<span class=\"w\"> </span>install<span class=\"w\"> </span>Python<span class=\"w\"> </span>packages<span class=\"w\"> </span>system-wide,<span class=\"w\"> </span>try<span class=\"w\"> </span>apt<span class=\"w\"> </span>install\n<span class=\"w\">    </span>python3-xyz,<span class=\"w\"> </span>where<span class=\"w\"> </span>xyz<span class=\"w\"> </span>is<span class=\"w\"> </span>the<span class=\"w\"> </span>package<span class=\"w\"> </span>you<span class=\"w\"> </span>are<span class=\"w\"> </span>trying<span class=\"w\"> </span>to\n<span class=\"w\">    </span>install.\n\n<span class=\"w\">    </span>If<span class=\"w\"> </span>you<span class=\"w\"> </span>wish<span class=\"w\"> </span>to<span class=\"w\"> </span>install<span class=\"w\"> </span>a<span class=\"w\"> </span>non-Debian-packaged<span class=\"w\"> </span>Python<span class=\"w\"> </span>package,\n<span class=\"w\">    </span>create<span class=\"w\"> </span>a<span class=\"w\"> </span>virtual<span class=\"w\"> </span>environment<span class=\"w\"> </span>using<span class=\"w\"> </span>python3<span class=\"w\"> </span>-m<span class=\"w\"> </span>venv<span class=\"w\"> </span>path/to/venv.\n<span class=\"w\">    </span>Then<span class=\"w\"> </span>use<span class=\"w\"> </span>path/to/venv/bin/python<span class=\"w\"> </span>and<span class=\"w\"> </span>path/to/venv/bin/pip.<span class=\"w\"> </span>Make\n<span class=\"w\">    </span>sure<span class=\"w\"> </span>you<span class=\"w\"> </span>have<span class=\"w\"> </span>python3-full<span class=\"w\"> </span>installed.\n\n<span class=\"w\">    </span>If<span class=\"w\"> </span>you<span class=\"w\"> </span>wish<span class=\"w\"> </span>to<span class=\"w\"> </span>install<span class=\"w\"> </span>a<span class=\"w\"> </span>non-Debian<span class=\"w\"> </span>packaged<span class=\"w\"> </span>Python<span class=\"w\"> </span>application,\n<span class=\"w\">    </span>it<span class=\"w\"> </span>may<span class=\"w\"> </span>be<span class=\"w\"> </span>easiest<span class=\"w\"> </span>to<span class=\"w\"> </span>use<span class=\"w\"> </span>pipx<span class=\"w\"> </span>install<span class=\"w\"> </span>xyz,<span class=\"w\"> </span>which<span class=\"w\"> </span>will<span class=\"w\"> </span>manage<span class=\"w\"> </span>a\n<span class=\"w\">    </span>virtual<span class=\"w\"> </span>environment<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>you.<span class=\"w\"> </span>Make<span class=\"w\"> </span>sure<span class=\"w\"> </span>you<span class=\"w\"> </span>have<span class=\"w\"> </span>pipx<span class=\"w\"> </span>installed.\n\n<span class=\"w\">    </span>See<span class=\"w\"> </span>/usr/share/doc/python3.11/README.venv<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>more<span class=\"w\"> </span>information.\n\nnote:<span class=\"w\"> </span>If<span class=\"w\"> </span>you<span class=\"w\"> </span>believe<span class=\"w\"> </span>this<span class=\"w\"> </span>is<span class=\"w\"> </span>a<span class=\"w\"> </span>mistake,<span class=\"w\"> </span>please<span class=\"w\"> </span>contact<span class=\"w\"> </span>your<span class=\"w\"> </span>Python<span class=\"w\"> </span>installation<span class=\"w\"> </span>or<span class=\"w\"> </span>OS<span class=\"w\"> </span>distribution<span class=\"w\"> </span>provider.<span class=\"w\"> </span>You<span class=\"w\"> </span>can<span class=\"w\"> </span>override<span class=\"w\"> </span>this,<span class=\"w\"> </span>at<span class=\"w\"> </span>the<span class=\"w\"> </span>risk<span class=\"w\"> </span>of<span class=\"w\"> </span>breaking<span class=\"w\"> </span>your<span class=\"w\"> </span>Python<span class=\"w\"> </span>installation<span class=\"w\"> </span>or<span class=\"w\"> </span>OS,<span class=\"w\"> </span>by<span class=\"w\"> </span>passing<span class=\"w\"> </span>--break-system-packages.\nhint:<span class=\"w\"> </span>See<span class=\"w\"> </span>PEP<span class=\"w\"> </span><span class=\"m\">668</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>the<span class=\"w\"> </span>detailed<span class=\"w\"> </span>specification.\n</code></pre></div>\n<p>In any case, I do also have <code>pipx</code> installed as a standalone package, and when I tried <code>pipx install mathlibtools</code> (after failing the standard instructions), I got:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>/home/pedro/.local/pipx/shared/bin/python:<span class=\"w\"> </span>No<span class=\"w\"> </span>module<span class=\"w\"> </span>named<span class=\"w\"> </span>pip\nFailed<span class=\"w\"> </span>to<span class=\"w\"> </span>upgrade<span class=\"w\"> </span>shared<span class=\"w\"> </span>libraries\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3/dist-packages/pipx/shared_libs.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">113</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>upgrade\n<span class=\"w\">    </span>subprocess_post_check<span class=\"o\">(</span>upgrade_process<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3/dist-packages/pipx/util.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">203</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>subprocess_post_check\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>PipxError<span class=\"o\">(</span>\npipx.util.PipxError:<span class=\"w\"> </span><span class=\"s1\">'/home/pedro/.local/pipx/shared/bin/python -m pip --disable-pip-version-check install -q --upgrade pip setuptools wheel'</span><span class=\"w\"> </span>failed\n<span class=\"s1\">'mathlibtools'</span><span class=\"w\"> </span>already<span class=\"w\"> </span>seems<span class=\"w\"> </span>to<span class=\"w\"> </span>be<span class=\"w\"> </span>installed.<span class=\"w\"> </span>Not<span class=\"w\"> </span>modifying<span class=\"w\"> </span>existing<span class=\"w\"> </span>installation<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"s1\">'/home/pedro/.local/pipx/venvs/mathlibtools'</span>.<span class=\"w\"> </span>Pass<span class=\"w\"> </span><span class=\"s1\">'--force'</span><span class=\"w\"> </span>to<span class=\"w\"> </span>force\ninstallation.\n</code></pre></div>\n<p>Extra info:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>pedro@solari:~$<span class=\"w\"> </span>elan<span class=\"w\"> </span>-V\nelan<span class=\"w\"> </span><span class=\"m\">1</span>.4.5<span class=\"w\"> </span><span class=\"o\">(</span>b325638d9<span class=\"w\"> </span><span class=\"m\">2023</span>-04-26<span class=\"o\">)</span>\n</code></pre></div>\n<p>I'm really sorry to bother with this; I really do not know if it was my fault. Thanks in advance.</p>",
        "id": 363994254,
        "sender_full_name": "Pedro Sánchez Terraf",
        "timestamp": 1686056207
    },
    {
        "content": "<p>Do you recall how you initially installed <code>leanproject</code> (also known as <code>mathlibtools</code>)? I would be trying to uninstall it first, then reinstall it from scratch.</p>",
        "id": 364155060,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1686109391
    },
    {
        "content": "<p>So perhaps just</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">pipx</span> <span class=\"n\">uninstall</span> <span class=\"n\">mathlibtools</span>\n<span class=\"n\">pipx</span> <span class=\"n\">install</span> <span class=\"n\">mathlibtools</span>\n</code></pre></div>\n<p>?</p>",
        "id": 364155259,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1686109513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Scott Morrison</span> <a href=\"#narrow/stream/113489-new-members/topic/broken.20leanproject/near/364155060\">said</a>:</p>\n<blockquote>\n<p>Do you recall how you initially installed <code>leanproject</code> (also known as <code>mathlibtools</code>)? I would be trying to uninstall it first, then reinstall it from scratch.</p>\n</blockquote>\n<p>Yes indeed, after a short “hacker” hesitation, I decided to follow the quick instructions that put everything in (even VSCode, in spite of my being an Emacs fan). I'll try re-installing as you suggest. Thank you very much!</p>",
        "id": 364248760,
        "sender_full_name": "Pedro Sánchez Terraf",
        "timestamp": 1686137775
    },
    {
        "content": "<p>I had errors while uninstalling, but it succeeded:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>pedro@solari:~$<span class=\"w\"> </span>pipx<span class=\"w\"> </span>uninstall<span class=\"w\"> </span>mathlibtools\n/home/pedro/.local/pipx/shared/bin/python:<span class=\"w\"> </span>No<span class=\"w\"> </span>module<span class=\"w\"> </span>named<span class=\"w\"> </span>pip\nFailed<span class=\"w\"> </span>to<span class=\"w\"> </span>upgrade<span class=\"w\"> </span>shared<span class=\"w\"> </span>libraries\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3/dist-packages/pipx/shared_libs.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">113</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>upgrade\n<span class=\"w\">    </span>subprocess_post_check<span class=\"o\">(</span>upgrade_process<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3/dist-packages/pipx/util.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">203</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>subprocess_post_check\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>PipxError<span class=\"o\">(</span>\npipx.util.PipxError:<span class=\"w\"> </span><span class=\"s1\">'/home/pedro/.local/pipx/shared/bin/python -m pip --disable-pip-version-check install -q --upgrade pip setuptools wheel'</span><span class=\"w\"> </span>failed\nuninstalled<span class=\"w\"> </span>mathlibtools!<span class=\"w\"> </span>✨<span class=\"w\"> </span>🌟<span class=\"w\"> </span>✨\n</code></pre></div>\n<p>BUT, <code>pipx</code> didn't let me install it again with a fatal error, and produced a log file containing:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>PIP<span class=\"w\"> </span>STDOUT\n----------\n\nPIP<span class=\"w\"> </span>STDERR\n----------\n/home/pedro/.local/pipx/venvs/mathlibtools/bin/python:<span class=\"w\"> </span>No<span class=\"w\"> </span>module<span class=\"w\"> </span>named<span class=\"w\"> </span>pip\n</code></pre></div>\n<p>I seems there's something very wrong with my Python... Conflicting versions maybe?</p>",
        "id": 364250420,
        "sender_full_name": "Pedro Sánchez Terraf",
        "timestamp": 1686138158
    },
    {
        "content": "<p>It seems I found a solution! (For Ubuntu/Debian)</p>\n<p><a href=\"https://www.linuxuprising.com/2023/05/how-to-fix-pipx-fatal-error-from-pip.html\">Here</a> it states that</p>\n<blockquote>\n<p>It appears this happens when the Python version is upgraded (to a major version) on a machine on which <code>pipx</code> was installed and used before.</p>\n<p>The best solution I could find to solve this issue is to remove the ~/.local/pipx/shared folder (or you can move it somewhere if you wish), which holds shared pipx libraries, then get pipx to reinstall the shared libraries [...]:</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>mv<span class=\"w\"> </span>~/.local/pipx/shared<span class=\"w\"> </span>~/.local/pipx/shared.old\npipx<span class=\"w\"> </span>list\n</code></pre></div>\n<p>After this, I was able run</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">pipx</span> <span class=\"n\">install</span> <span class=\"n\">mathlibtools</span>\n</code></pre></div>\n<p>successfully, and <code>leanproject</code> was good to go again.</p>",
        "id": 364569615,
        "sender_full_name": "Pedro Sánchez Terraf",
        "timestamp": 1686232440
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"327749\">Pedro Sánchez Terraf</span> has marked this topic as resolved.</p>",
        "id": 364571414,
        "sender_full_name": "Notification Bot",
        "timestamp": 1686232765
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> for the hint!</p>",
        "id": 364571809,
        "sender_full_name": "Pedro Sánchez Terraf",
        "timestamp": 1686232843
    }
]