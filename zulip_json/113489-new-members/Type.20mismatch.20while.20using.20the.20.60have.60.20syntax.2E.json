[
    {
        "content": "<p>As far as I know, the syntax <code>have h : p := s; t</code> is equivalent to the expression <code>(fun (h : p) =&gt; t) s</code>. So it is reasonable to have the following proof in Lean.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>And the latter one can be used as a proof of <code>1 = 1</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>However, when I want to use the <code>have</code> syntax to give a proof of <code>1 = 1</code>, Lean complains.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Error message:</span>\n<span class=\"cm\">  Type mismatch</span>\n<span class=\"cm\">    rfl</span>\n<span class=\"cm\">  has type</span>\n<span class=\"cm\">    x = x</span>\n<span class=\"cm\">  but is expected to have type</span>\n<span class=\"cm\">  1 = 1</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Also, a similar error occurs when using the <code>letFun</code> syntax.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Error message:</span>\n<span class=\"cm\">  Type mismatch</span>\n<span class=\"cm\">    rfl</span>\n<span class=\"cm\">  has type</span>\n<span class=\"cm\">    x = x</span>\n<span class=\"cm\">  but is expected to have type</span>\n<span class=\"cm\">    1 = x</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">letFun</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is this a bug? Or is the way that <code>have</code> syntax works different from what I think?</p>\n<p>THX in advance.</p>",
        "id": 568381492,
        "sender_full_name": "LizBonn",
        "timestamp": 1768552588
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><code>have</code> is opaque, but you are using it in an expression that requires the content of the definition.</p>",
        "id": 568383486,
        "sender_full_name": "suhr",
        "timestamp": 1768553304
    },
    {
        "content": "<p>As was already stated above , but i was preparing this already: </p>\n<blockquote>\n<p>TheÂ <code>have</code>Â tactic is for adding opaque definitions and hypotheses to the local context of the main goal. The definitions forget their associated value and cannot be unfolded, unlike definitions added by theÂ let</p>\n</blockquote>\n<p><a href=\"https://lean-lang.org/doc/reference/latest/Tactic-Proofs/The-Tactic-Language/#have\">source</a></p>\n<p>In particular </p>\n<blockquote>\n<ul>\n<li>TheÂ <code>have h : t := e</code>Â is like doingÂ <code>let h : t := e; clear_value h</code>.</li>\n</ul>\n</blockquote>",
        "id": 568384098,
        "sender_full_name": "Yan Yablonovskiy ðŸ‡ºðŸ‡¦",
        "timestamp": 1768553515
    },
    {
        "content": "<p>I understand that when <code>have</code> is used as a tactic. But I'm still a little confused by the <a href=\"https://leanprover-community.github.io/mathlib4_docs//Init/Prelude.html#letFun\">this documentation</a>. It says, <code>have x := v; b/letFun v (fun x =&gt; b)</code> is equal to <code>(fun x =&gt; b) v</code> and the value of <code>x</code> is not accessible to <code>b</code>.</p>\n<p>Does this mean one cannot use <code>x</code> to construct the term <code>b</code>? But if so, how is <code>f</code> a dependent function of type <code>(x : Î±) â†’ Î² x</code>?</p>",
        "id": 568388335,
        "sender_full_name": "LizBonn",
        "timestamp": 1768554888
    },
    {
        "content": "<p>I think that it means that you cannot use <code>v</code> to construct <code>b</code>.</p>",
        "id": 568388966,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1768555105
    },
    {
        "content": "<p>this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"n\">generalize</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 568410407,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1768562135
    },
    {
        "content": "<p>That looks good. It seems that the elaboration order matters a lot. Is there any documentation explaining the mechanism for <code>let</code>, <code>have</code> and the elaboration process?</p>",
        "id": 568469817,
        "sender_full_name": "LizBonn",
        "timestamp": 1768579597
    }
]