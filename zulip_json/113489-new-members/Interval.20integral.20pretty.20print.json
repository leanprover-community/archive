[
    {
        "content": "<p>If I check the type of an intervalIntegral with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">..</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>the resulting command yields</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>If I copy paste that pretty print into the same Lean file, this is invalid syntax. Note that the spaces around the <code>..</code> have changed, and the parentheses are gone. I'm finding this somewhat odd. Is this intended? Why is the prettyPrint different, and no valid syntax? And to avoid future confusion: where can I find the definition for the prettyPrint? I couldn't find any delaborators, which I thought was what I might need.</p>\n<p>Edit: the import of whole mathlib takes quite some time, sorry. Here's a more efficient <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">Integral</span><span class=\"bp\">.</span><span class=\"n\">IntervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">..</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 520920427,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1748446106
    },
    {
        "content": "<p>The delaborator comes for free as part of the <code>notation3</code> command that defines this syntax <a href=\"https://github.com/leanprover-community/mathlib4/blob/f6b3bf487bff9b227d4435ac186541716ea54978/Mathlib/MeasureTheory/Integral/IntervalIntegral/Basic.lean#L509-L510\">here</a></p>",
        "id": 520923804,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1748447118
    },
    {
        "content": "<p>Possibly, changing <code>\"..\"</code> to <code>\" .. \"</code> would make pretty printing round trip.</p>\n<p>It's possibly a Lean core bug that this doesn't pretty print with an extra space before the <code>1</code>. The reason there's a space after <code>0</code> is to make sure the <code>.</code> doesn't get parsed as part of <code>0.</code>. The core pretty printer inserts spaces to break up tokens.</p>",
        "id": 520926088,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748447749
    },
    {
        "content": "<p>Thanks! This makes delaboration a lot less magical :)<br>\nStill, this leaves me wondering a bit why the core pretty printer inserts the initial space at <code>\"0..\"</code> (resulting in <code>\"0 ..\"</code>), since this is not valid either.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>returns a syntax error.</p>",
        "id": 520927316,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1748448100
    },
    {
        "content": "<p>Does it work if you put a space before the 1? That would confirm what I was guessing, that this is a core bug.</p>",
        "id": 520927949,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748448298
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>is valid syntax, but the resulting pretty print is still the same.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n</code></pre></div>",
        "id": 520928036,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1748448324
    },
    {
        "content": "<p>I would not expect it to change how it is pretty printed. The pretty printer remembers nothing about the original input syntax.</p>",
        "id": 520928367,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748448435
    },
    {
        "content": "<p>As the different syntax is elaborated into the same Expr, and the delaborator only uses the Expr, right?</p>",
        "id": 520928483,
        "sender_full_name": "Simon Sorg",
        "timestamp": 1748448480
    },
    {
        "content": "<p>Yes</p>",
        "id": 520928546,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748448488
    },
    {
        "content": "<p>The likely problem is that a dot before a number is lexically a floating point literal.</p>",
        "id": 520928667,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748448532
    },
    {
        "content": "<p>The pretty printer doesn't have many levers to pull to try to fix lexical errors like this. Inserting whitespace is one of them.</p>\n<p>I don't think there's any case of parenthesis insertion (there's no framework for that...) but it would help here.</p>",
        "id": 520929018,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748448658
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/Interval.20integral.20pretty.20print/near/520929018\">said</a>:</p>\n<blockquote>\n<p>parenthesis insertion (there's no framework for that...)</p>\n</blockquote>\n<p>Are you familiar with the <a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/PrettyPrinter/Parenthesizer.html\"><code>Parenthesizer</code></a>?</p>",
        "id": 521002162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748482441
    },
    {
        "content": "<p>I'm sure that you know that I am <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span></p>\n<p>As you might recall, the parenthesizer is designed for inserting parentheses where they are syntactically necessary, not lexically necessary.</p>\n<p>Or maybe you think this is purely a precedence issue?</p>",
        "id": 521004214,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1748483883
    },
    {
        "content": "<p>I think it usually makes most sense to fix lexical errors by inserting whitespace, although vertical alignment is problematic</p>",
        "id": 521004550,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748484075
    },
    {
        "content": "<p>I was just reacting to the claim that there is no framework for parenthesis insertion</p>",
        "id": 521004737,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1748484172
    }
]