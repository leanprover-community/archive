[
    {
        "content": "<p>I want to construct something with transfinite induction, so I want to use induction on the ordinals to define it. I found <code>Ordinal.induction</code>, but</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">induction'</span> <span class=\"n\">o</span> <span class=\"n\">using</span> <span class=\"n\">Ordinal.induction</span> <span class=\"k\">with</span> <span class=\"n\">o</span> <span class=\"n\">IH</span>\n</code></pre></div>\n<p>doesn't work when constructing a non-prop term (type mismatch when assigning motive, expected <code>Ordinal → Prop</code>, got <code>Ordinal → Type</code>).</p>\n<p>MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">fasd</span> <span class=\"o\">:</span> <span class=\"n\">Ordinal</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"o\">:=</span> <span class=\"k\">fun</span> <span class=\"n\">o</span> <span class=\"bp\">↦</span> <span class=\"kd\">by</span>\n  <span class=\"n\">induction'</span> <span class=\"n\">o</span> <span class=\"n\">using</span> <span class=\"n\">Ordinal.induction</span> <span class=\"k\">with</span> <span class=\"n\">o</span> <span class=\"n\">IH</span> <span class=\"c1\">--type mismatch</span>\n</code></pre></div>\n<p>Is there an easy way to do this?</p>",
        "id": 438201036,
        "sender_full_name": "Nir Paz",
        "timestamp": 1715536640
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.recOn#doc\">docs#Ordinal.recOn</a> exists?</p>",
        "id": 438201448,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1715536961
    },
    {
        "content": "<p>it doesn't, but <code>Ordinal</code> is well founded so you can use the equation compiler to define functions by well founded recursion</p>",
        "id": 438201498,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1715537038
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn#doc\">docs#Ordinal.limitRecOn</a> exists if you want to define the function by cases on zero/succ/limit ordinals</p>",
        "id": 438201533,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1715537063
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 438202367,
        "sender_full_name": "Nir Paz",
        "timestamp": 1715537944
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"565854\">Nir Paz</span> Hi and sorry about that, but would you mind sharing your ordinal recursion solution? I could really use a concrete example (and I am sure other people could too, in the future).</p>",
        "id": 452650981,
        "sender_full_name": "George Kojonis",
        "timestamp": 1721417442
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"720043\">@George Kojonis</span> I'm not in front of a computer, but I'll send it soon!</p>",
        "id": 452652095,
        "sender_full_name": "Nir Paz",
        "timestamp": 1721417855
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"720043\">@George Kojonis</span> apparantly for this project I ended up using recursion on a minimal well order on a type, rather than ordinals directly, and the code is broken now anyways since something changed with <code>simp</code>.  I have this simpe example though, defining the aleph function with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn#doc\">docs#Ordinal.limitRecOn</a> and proving it's equivalent to the definition in mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myAleph</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ordinal</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">limitRecOn</span><span class=\"w\"> </span><span class=\"n\">o</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Cardinal</span><span class=\"bp\">.</span><span class=\"n\">aleph0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- myAleph 0</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">alepho</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">alepho</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- myAleph (o + 1)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">oLim</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">sSup</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">κ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Cardinal</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">plto</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">plto</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">κ</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"c1\">-- myAleph of limit</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">alpeh_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">myAleph</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">aleph</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">  </span><span class=\"n\">Ordinal</span><span class=\"bp\">.</span><span class=\"n\">limitRecOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">myAleph</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">aleph</span><span class=\"w\"> </span><span class=\"n\">o</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">o</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myAleph</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"c1\">-- proof for o = 0</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\">                 </span><span class=\"c1\">-- proof for o + 1</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myAleph</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\">                 </span><span class=\"c1\">-- proof for limit o</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">pLim</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myAleph</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">limitRecOn_limit</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">--using definition of myAleph at limit points</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">aleph_limit</span><span class=\"w\"> </span><span class=\"n\">pLim</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">congr</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">qltp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">qltp</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">hq</span>\n<span class=\"w\">      </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">aleph</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">myAleph</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">qltp</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">q</span>\n<span class=\"w\">      </span><span class=\"n\">aesop</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">pLim</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Basically using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn#doc\">docs#Ordinal.limitRecOn</a> to define stuff and then using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn_zero#doc\">docs#Ordinal.limitRecOn_zero</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn_succ#doc\">docs#Ordinal.limitRecOn_succ</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Ordinal.limitRecOn_limit#doc\">docs#Ordinal.limitRecOn_limit</a> to prove things about them. It can get messy so feel free to ask for help if you want (:</p>",
        "id": 452685675,
        "sender_full_name": "Nir Paz",
        "timestamp": 1721432893
    },
    {
        "content": "<p>Anyways if you end up doing induction directly on a well order on a type (which is usually best if your function isn't doing set theory stuff) you can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsWellFounded.fix#doc\">docs#IsWellFounded.fix</a> to define it and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsWellFounded.fix_eq#doc\">docs#IsWellFounded.fix_eq</a> to work with it.</p>",
        "id": 452685864,
        "sender_full_name": "Nir Paz",
        "timestamp": 1721433028
    },
    {
        "content": "<p>Thanks! This was very helpful!</p>",
        "id": 452792689,
        "sender_full_name": "George Kojonis",
        "timestamp": 1721461752
    }
]