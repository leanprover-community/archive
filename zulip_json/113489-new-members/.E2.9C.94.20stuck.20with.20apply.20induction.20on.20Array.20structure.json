[
    {
        "content": "<p>I am trying to prove something should be simple but failed. Can any one help? <br>\nFirst, I guess I shall use Array.foldl_induction rule <code>induction Array.foldl_induction</code> but <code>tactic 'induction' failed</code>.<br>\nSecond, why <code>simp [h1]</code> dose not change <code>if h : a &lt; Array.size bk then Array.set bk { val := a, isLt := h } (bk[a] + amount) else bk</code> to <code>Array.set bk { val := a, isLt := h } (bk[a] + amount)</code><br>\nThird, do I missed anything else I shall notice?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">abbrev</span> <span class=\"n\">Book</span> <span class=\"o\">:=</span> <span class=\"n\">Array</span> <span class=\"n\">Nat</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Book.sum</span> <span class=\"o\">(</span><span class=\"n\">bk</span><span class=\"o\">:</span> <span class=\"n\">Book</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span> <span class=\"o\">:=</span>\n  <span class=\"n\">bk.foldl</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">a</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"mi\">0</span>\n\n<span class=\"k\">#eval</span> <span class=\"n\">Book.sum</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">2</span><span class=\"o\">,</span> <span class=\"mi\">3</span><span class=\"o\">]</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">bk</span><span class=\"o\">:</span> <span class=\"n\">Book</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">amount</span> <span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"n\">bk.size</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">&lt;</span> <span class=\"n\">bk.size</span><span class=\"o\">)</span> <span class=\"bp\">→</span>\n  <span class=\"n\">bk.sum</span> <span class=\"bp\">+</span> <span class=\"n\">amount</span> <span class=\"bp\">=</span> <span class=\"n\">Book.sum</span> <span class=\"o\">(</span><span class=\"n\">bk.modify</span> <span class=\"n\">a</span> <span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">amount</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">intro</span> <span class=\"n\">bk</span> <span class=\"n\">a</span> <span class=\"n\">amount</span> <span class=\"n\">h</span> <span class=\"n\">h1</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Book.sum</span><span class=\"o\">]</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Array.modify</span><span class=\"o\">,</span> <span class=\"n\">Array.modifyM</span><span class=\"o\">]</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Id.run</span><span class=\"o\">]</span>\n<span class=\"c\">/-</span><span class=\"cm\"> bk: Book</span>\n<span class=\"cm\">aamount: Nat</span>\n<span class=\"cm\">h: Array.size bk &gt; 0</span>\n<span class=\"cm\">h1: a &lt; Array.size bk</span>\n<span class=\"cm\">⊢ Array.foldl (fun x a =&gt; x + a) 0 bk 0 (Array.size bk) + amount =</span>\n<span class=\"cm\">  Array.foldl (fun x a =&gt; x + a) 0</span>\n<span class=\"cm\">    (if h : a &lt; Array.size bk then Array.set bk { val := a, isLt := h } (bk[a] + amount) else bk) 0 (Array.size bk)</span>\n<span class=\"cm\">-/</span>\n  <span class=\"n\">induction</span> <span class=\"n\">Array.foldl_induction</span>  <span class=\"c1\">-- this tatic failed.</span>\n</code></pre></div>\n<p>Here are another two examples easy to prove, what is the difference between them?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">amount</span><span class=\"o\">,</span> <span class=\"n\">Book.sum</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">2</span> <span class=\"o\">,</span> <span class=\"mi\">3</span><span class=\"o\">,</span> <span class=\"mi\">4</span><span class=\"o\">,</span> <span class=\"n\">amount</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"mi\">10</span> <span class=\"bp\">+</span> <span class=\"n\">amount</span><span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">intro</span> <span class=\"n\">amount</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Book.sum</span><span class=\"o\">]</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Array.foldl</span><span class=\"o\">,</span> <span class=\"n\">Id.run</span><span class=\"o\">,</span> <span class=\"n\">Array.foldlM</span><span class=\"o\">,</span> <span class=\"n\">Array.foldlM.loop</span><span class=\"o\">]</span>\n  <span class=\"n\">get_elem_tactic</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">bk</span><span class=\"o\">:</span> <span class=\"n\">Book</span><span class=\"o\">,</span> <span class=\"n\">Book.sum</span> <span class=\"o\">(</span><span class=\"n\">bk</span> <span class=\"bp\">++</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">amount</span><span class=\"o\">])</span> <span class=\"bp\">=</span> <span class=\"n\">Book.sum</span> <span class=\"n\">bk</span> <span class=\"bp\">+</span> <span class=\"n\">amount</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">intro</span> <span class=\"n\">bk</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">Book.sum</span><span class=\"o\">,</span> <span class=\"n\">Array.foldl_eq_foldl_data</span><span class=\"o\">]</span>\n  <span class=\"bp\">```</span>\n</code></pre></div>",
        "id": 398165012,
        "sender_full_name": "ZHAO Jiecheng",
        "timestamp": 1698100471
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"250110\">ZHAO Jiecheng</span> has marked this topic as resolved.</p>",
        "id": 398378166,
        "sender_full_name": "Notification Bot",
        "timestamp": 1698192665
    },
    {
        "content": "<p>Done by induction the list in the array.</p>",
        "id": 398378225,
        "sender_full_name": "ZHAO Jiecheng",
        "timestamp": 1698192720
    }
]