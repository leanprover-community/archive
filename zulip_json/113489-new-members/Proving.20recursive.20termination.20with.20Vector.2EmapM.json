[
    {
        "content": "<p>Hi. I'm attempting to prove a recursive function that uses <code>Vector.mapM</code> terminates with <code>decreasing_by</code>.  The function includes something like <code>Vector.mapM (λ c =&gt; ...) cs</code>. When proving termination, I have something like the following in the context:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">T</span>\n</code></pre></div>\n<p>I'm able to prove termination if I add the assumption <code>have hMem : c ∈ cs := by sorry</code> and then use <code>Array.sizeOf_lt_of_mem hMem</code>. Is there a way to get <code>hMem</code> just from the use of <code>Vector.mapM</code>, or is there a better approach to proving the termination?</p>\n<p>Also, I need the lemma :<code>def lt_add (a b c : ℕ) : a &lt; b -&gt; a &lt; b + c</code>. Does this already exist in Mathlib? I couldn't find it with Loogle or Moogle. </p>\n<p>Thanks!</p>",
        "id": 516504352,
        "sender_full_name": "James Parker",
        "timestamp": 1746554450
    },
    {
        "content": "<p>Try <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector.attach#doc\">docs#Vector.attach</a></p>",
        "id": 516538980,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746568139
    },
    {
        "content": "<p>Also <code>lt_add</code> is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.lt_add_right#doc\">docs#Nat.lt_add_right</a></p>",
        "id": 516539137,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746568234
    },
    {
        "content": "<p>Thanks! That's what we needed. Now I'm left with the goal <code>(hV ▸ cs'.toVector).toArray = cs'</code>. Do you have any suggestions here? <code>grind</code> actually says it succeeds, but we get the following type error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././././</span><span class=\"n\">File</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">22</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">toArray</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cs'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">size_toArray</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">toArray</span>\n<span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">cs'</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">length</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZKExpr</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 516673744,
        "sender_full_name": "James Parker",
        "timestamp": 1746623871
    },
    {
        "content": "<p>use <code>cs'.toVector.cast</code> instead, that should work better</p>",
        "id": 516745332,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746643646
    },
    {
        "content": "<p>or <code>Vector.mk</code></p>",
        "id": 516745343,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1746643651
    }
]