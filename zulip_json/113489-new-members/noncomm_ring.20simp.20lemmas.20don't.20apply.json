[
    {
        "content": "<p>Someone here is going along with an example I'm showing on my machine, which works on my machine, but for some reason doesn't on theirs. It's the <code>noncomm_ring</code> tactic saying that <code>noncomm_ring simp lemmas don't apply</code>. This happens for them even if they're trying to prove that <code>a + b = b + a</code> for integers a and b. Is there a known bug?</p>",
        "id": 547353902,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761592237
    },
    {
        "content": "<p>If it works on one machine and not another, then my first conjecture would be that those machines are using different versions of mathlib, and whoever is having problems should try updating. What is the error? This would be a helpful thing to report.</p>",
        "id": 547382175,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761604409
    },
    {
        "content": "<p>I'll ask her tomorrow. For now I recall the message suggested using <code>abel</code> isntead.</p>",
        "id": 547385179,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761606073
    },
    {
        "content": "<p>hmm, maybe it was failing to find the second operation</p>",
        "id": 547385382,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761606144
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/cJLieK8lTnyhYfLhJgT40q8l/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/cJLieK8lTnyhYfLhJgT40q8l/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2494x910\" src=\"/user_uploads/thumbnail/3121/cJLieK8lTnyhYfLhJgT40q8l/image.png/840x560.webp\"></a></div>",
        "id": 547793778,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761764922
    },
    {
        "content": "<p>This is the error she's getting</p>",
        "id": 547793816,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761764939
    },
    {
        "content": "<p>4.21.0</p>",
        "id": 547793838,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761764945
    },
    {
        "content": "<p>but she also gets it for simpler things like proving <code>a + b = b + a</code> for <code>a, b \\in \\Z</code></p>",
        "id": 547793963,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761764990
    },
    {
        "content": "<p>this is not a Nat/Int issue</p>",
        "id": 547793974,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761764994
    },
    {
        "content": "<p>can reproduce</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"c1\">-- `noncomm_ring` simp lemmas don't apply; try `abel` instead</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„¤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">noncomm_ring</span>\n</code></pre></div>",
        "id": 547794141,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761765042
    },
    {
        "content": "<p>I think the intent here is that you use <code>abel</code> instead</p>",
        "id": 547794582,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761765195
    },
    {
        "content": "<p>prolly, but I'm scared by the nondeterminism of it all</p>",
        "id": 547794738,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761765248
    },
    {
        "content": "<p>for me it works and i'm on 4.21.0 too</p>",
        "id": 547794754,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761765255
    },
    {
        "content": "<p>maybe it's a different commit of mathlib</p>",
        "id": 547794804,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761765275
    },
    {
        "content": "<p>I see. So #version tells you a round number even if you're on a nightly :)</p>",
        "id": 547795540,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761765540
    },
    {
        "content": "<p><code>#version</code> gives you the Lean version, but maybe it's on a different version of mathlib</p>",
        "id": 547795720,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761765617
    },
    {
        "content": "<p>oh!</p>",
        "id": 547796195,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761765814
    },
    {
        "content": "<p>is there a <code>#version mathlib</code>?</p>",
        "id": 547796241,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761765832
    },
    {
        "content": "<p>mathlib doesn't have releases so you may as well just do <code>git log</code>.</p>",
        "id": 547808280,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761770628
    },
    {
        "content": "<p>I guess one thing to add here is that the naturals are not a non-commutative ring ;-)</p>",
        "id": 547808407,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761770680
    },
    {
        "content": "<p>Yeah, I guess semiring would fit better... but I guess it's not explaining why it's failing for \\Z</p>",
        "id": 547809357,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761771016
    },
    {
        "content": "<p>This also fails with the same error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">noncomm_ring</span>\n</code></pre></div>\n<p>At this point I am thinking that this is unexpected behaviour and you might want to open an issue. Or perhaps the designers are well aware of this issue and are arguing that because you are not using multiplication at all you're using the wrong tactic anyway and should be using the abelian group tactic.</p>",
        "id": 547811796,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1761771889
    },
    {
        "content": "<p>yes that's how I interpreted it</p>",
        "id": 547812074,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761771985
    },
    {
        "content": "<p>And this seems to be true. Quoting my collaborator: \"That makes sense. I didn't update Mathlib, but after rewriting the equation as 1<em>a+1</em>b = 1<em>b+1</em>a, noncomm_ring works now.\"</p>",
        "id": 547841813,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761790189
    },
    {
        "content": "<p>I must say I was rather surprised that a tactic(!) is defined in mathlib rather than in Lean proper. But I guess this is what you get when tactics are so easy to define :)</p>",
        "id": 547841869,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761790222
    },
    {
        "content": "<p>rings are defined in mathlib (well I guess now that we have <code>grind</code> they're also defined in core)</p>",
        "id": 547841974,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761790293
    },
    {
        "content": "<p>I guess it'd be even more surprising to you then that in fact the <em>majority</em> of tactics don't come from core (253 from core, 266 directly from mathlib, 39 from a dependency of mathlib)</p>",
        "id": 548337607,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1762030241
    }
]