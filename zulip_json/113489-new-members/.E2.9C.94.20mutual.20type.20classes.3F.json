[
    {
        "content": "<p>Is it possible to have mutually recursive type classes?  E.g. I am trying to define something along these lines:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- some stuff</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elem</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Element</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">elem</span>\n</code></pre></div>\n<p>but <code>mutual</code> doesn't seem to like it.</p>\n<p>As an random aside, I am finding that I would love to see the \"C++\"-ish syntax for specifying type classes, i.e.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Num</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">auto</span><span class=\"w\"> </span><span class=\"n\">Num</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- e.g. stick with the C++ nomenclature.</span>\n</code></pre></div>",
        "id": 473381083,
        "sender_full_name": "Tom",
        "timestamp": 1727553755
    },
    {
        "content": "<p>What exactly is the expression <code>Element container</code> there at the end, including implicit arguments? If you think about it for a bit you will realize it would have to be infinitely large</p>",
        "id": 473381565,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554106
    },
    {
        "content": "<p>remember that <code>[]</code> typeclass arguments are regular arguments to a function, they are just automatically filled in by typeclass inference</p>",
        "id": 473381621,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554171
    },
    {
        "content": "<p>So it's really <code>@Element container ?a</code> where <code>?a : @Container container ?b</code> where <code>?b : @Element container ?c</code> where ...</p>",
        "id": 473381717,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554248
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> <a href=\"#narrow/stream/113489-new-members/topic/mutual.20type.20classes.3F/near/473381083\">said</a>:</p>\n<blockquote>\n<p>As an random aside, I am finding that I would love to see the \"C++\"-ish syntax for specifying type classes, i.e.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Num</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">auto</span><span class=\"w\"> </span><span class=\"n\">Num</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- e.g. stick with the C++ nomenclature.</span>\n</code></pre></div>\n</blockquote>\n<p>You won't find many people saying \"gosh, C++ really got the syntax right here\" in an FP language community</p>",
        "id": 473381840,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554379
    },
    {
        "content": "<p>Perhaps my minimized example doesn't quite capture the relationship but what I am trying to express is that</p>\n<p>\"I have an element and I want the element be dependently typed to depend on its source container\".</p>\n<p>The example I'm trying to work through is the following:</p>\n<p>I am creating a <code>Graph</code> type class (so it could be implemented e.g. with different graph representations) and would like to have a <code>Vertex g</code> type class where <code>g</code> is the graph it came from.  I am trying to do this so that when I then e.g. index back into the graph, I can avoid any checks - similar to how e.g. <code>Fin x.size</code> can be used as an index into an array.</p>",
        "id": 473381847,
        "sender_full_name": "Tom",
        "timestamp": 1727554385
    },
    {
        "content": "<p>okay, so why the mutualness?</p>",
        "id": 473381940,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554449
    },
    {
        "content": "<p>sounds like Vertex depends on Graph and not vice versa</p>",
        "id": 473381955,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554465
    },
    {
        "content": "<blockquote>\n<p>You won't find many people saying \"gosh, C++ really got the syntax right here\" in an FP language community</p>\n</blockquote>\n<p>Oh, I don't think C++ syntax is beautiful by any stretch of the imagination, and FWIW, I find Lean to be one of the syntactically appealing languages I know.  It's more of the brevity...</p>",
        "id": 473381963,
        "sender_full_name": "Tom",
        "timestamp": 1727554475
    },
    {
        "content": "<p>(ironically, the second version is one character longer in your example)</p>",
        "id": 473381996,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554499
    },
    {
        "content": "<blockquote>\n<p>sounds like Vertex depends on Graph and not vice versa</p>\n</blockquote>\n<p>I would like the type class <code>Graph</code> to e.g. have <code>toArray : Array (Vertex g)</code></p>",
        "id": 473382042,
        "sender_full_name": "Tom",
        "timestamp": 1727554542
    },
    {
        "content": "<p>okay?</p>",
        "id": 473382053,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554551
    },
    {
        "content": "<p>if <code>g</code> is a type then that's fine, but not if it's a graph</p>",
        "id": 473382134,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554578
    },
    {
        "content": "<p>because you haven't finished defining what a graph is yet</p>",
        "id": 473382144,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554591
    },
    {
        "content": "<p>but you can express the mutual requirements of a vertex type and a graph type in a typeclass</p>",
        "id": 473382176,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554625
    },
    {
        "content": "<p>maybe sketch something out and I can fix it?</p>",
        "id": 473382193,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554649
    },
    {
        "content": "<p>I think what you have said so far is covered by</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elem</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elem</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 473382332,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554772
    },
    {
        "content": "<p>So the full story is that I want my vertex type class be able to express certain properties based on the graph, e.g. to look something like this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">supposeGraph</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">   </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">gr</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n<span class=\"w\">   </span><span class=\"c1\">-- more</span>\n</code></pre></div>\n<p>I'm working on trying to break the cycles in the type classes because it seems like the only thing I can do.  But I thought I'd ask, or if people have come up with some good patterns to help with such cases.</p>",
        "id": 473382333,
        "sender_full_name": "Tom",
        "timestamp": 1727554775
    },
    {
        "content": "<p>So far, I've defined a <code>SizedGraph</code> class which just defines <code>size</code> and <code>Vertex</code> uses that, and then I have a <code>VertexGraph</code> which extends <code>SizedGraph</code> and adds additional funcationality.</p>",
        "id": 473382474,
        "sender_full_name": "Tom",
        "timestamp": 1727554885
    },
    {
        "content": "<p>which you can inhabit like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">verts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">)</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">verts</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n</code></pre></div>",
        "id": 473382579,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727554972
    },
    {
        "content": "<p>But I would love your input!  Hardest part of learning a new language is to learn the libraries and idioms and it's hard to do that in a vacuum.</p>\n<p>Let me finish coding up some stuff and if at some point you can look and give me feedback/suggestions, however small, I would be super appreciative.</p>",
        "id": 473382622,
        "sender_full_name": "Tom",
        "timestamp": 1727555024
    },
    {
        "content": "<p>the typeclasses don't have to be cyclic, but the structures here would probably like to be</p>",
        "id": 473382630,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555038
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/mutual.20type.20classes.3F/near/473382579\">said</a>:</p>\n<blockquote>\n<p>which you can inhabit like this:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">verts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">)</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">verts</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Thanks, I'll think about this some more.  I appreciate your time!</p>",
        "id": 473382669,
        "sender_full_name": "Tom",
        "timestamp": 1727555043
    },
    {
        "content": "<p>you only need one typeclass in this case which expresses all the relations you want</p>",
        "id": 473382676,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555056
    },
    {
        "content": "<p>in this particular case you can also do this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Vertex'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">verts</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vertex'</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Vertex'</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">size</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Container</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">verts</span>\n</code></pre></div>",
        "id": 473382744,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555160
    },
    {
        "content": "<p>which avoids the need to map the vertices in <code>toList</code></p>",
        "id": 473382793,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555179
    },
    {
        "content": "<p>As an aside, my plan is a little more elaborate:  I am planning to have another (!) type class called <code>Vertices</code>, which implements e.g. the <code>ForIn</code> type class precisely so that I don't have to go through conversions to array/list just to iterate etc.</p>",
        "id": 473382940,
        "sender_full_name": "Tom",
        "timestamp": 1727555343
    },
    {
        "content": "<p>I want to mention though:  I want <code>Vertex</code> and <code>Graph</code> to be type classes, not concrete types like in your last example.</p>\n<p>Unless I'm misunderstanding something:  I want the type classes so that I can then implement the graph using adjacency lists, or matrices etc, in which case e.g. the Vertex type is dependent on the graph implementation.   Then the graph algos can be written just in terms of the type classes.</p>\n<p>Anyway, this seemed like a first \"meaty\" project to try and explore DTT/Lean.</p>",
        "id": 473383203,
        "sender_full_name": "Tom",
        "timestamp": 1727555603
    },
    {
        "content": "<p>There are always two sides to making typeclasses: the classes themselves, and the implementations</p>",
        "id": 473383308,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555713
    },
    {
        "content": "<p>Writing the class itself is the easy part, in this case</p>",
        "id": 473383313,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555724
    },
    {
        "content": "<p>I'm writing example implementations to demonstrate that it is possible to construct something satisfying the requirements of the typeclass</p>",
        "id": 473383335,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555758
    },
    {
        "content": "<p>I think you have it wrong when you say that you want <code>Vertex</code> and <code>Graph</code> to be typeclasses. I think you actually want one typeclass which takes several type arguments, playing the roles of the graph type and vertex type. That is <code>Container</code> that I wrote before</p>",
        "id": 473383426,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555829
    },
    {
        "content": "<p>Ditto with <code>Vertices</code>, these are all just more fields in one mega typeclass</p>",
        "id": 473383453,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727555864
    },
    {
        "content": "<p>You may be right, I don't feel like I've developed a good \"feeling\" for the \"correct patterns\" and how to factor my code yet.  I appreciate your thoughts/input.</p>",
        "id": 473383540,
        "sender_full_name": "Tom",
        "timestamp": 1727555905
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> has marked this topic as resolved.</p>",
        "id": 473383753,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727556115
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">GraphStruct</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">forIn</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ForInStep</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">β</span>\n<span class=\"w\">  </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Graph</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">toList_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">forIn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">yield</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">neighbors</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Vertex</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I don't know, maybe you want more things in this</p>",
        "id": 473383812,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727556134
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> </p>\n<p>FWIW, my question on \"lean 4\" about the compiler/lowering is directly related to the above.  My plan is to try and build some simple graph algos, benchmark and then consider FFI-ing stuff if needed.</p>",
        "id": 473383970,
        "sender_full_name": "Tom",
        "timestamp": 1727556322
    },
    {
        "content": "<p><a href=\"#narrow/stream/270676-lean4/topic/.E2.9C.94.20Type.20erasure.2Fcompilation.20questions/near/473374096\">link</a></p>",
        "id": 473384047,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1727556364
    }
]