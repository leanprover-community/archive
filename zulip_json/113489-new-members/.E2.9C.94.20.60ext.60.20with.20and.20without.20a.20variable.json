[
    {
        "content": "<p>I was recently introduced to <code>ext</code> in MoP.</p>\n<p>I thought I understood it when used with a variable, eg <code>ext x</code>.  I read that as meaning, introduce a variable to parameterise the functions / sets in the goal which must be equal. </p>\n<p>I have a vague idea of <strong>extensionality</strong> from axiomatic set theory which says two sets are the same of an element of one is in the other, and I think I can extend this to functions to say two functions are the same if they map elements of the domain to the same element of the codomain (and have the same domain and codomain),</p>\n<p>However, its without a variable is used in some examples, but is not explained.</p>\n<p><strong>Question</strong>: What does <code>ext</code> without a variable do?</p>\n<hr>\n<p>MoP example with ext and a variable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">l</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hl</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hl</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hk</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>Mop Example with ext and no variable:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"n\">push_neg</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"w\">  </span><span class=\"n\">right</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">not_dvd_of_exists_lt_and_lt</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">numbers</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">    </span><span class=\"n\">numbers</span>\n</code></pre></div>",
        "id": 501420640,
        "sender_full_name": "rzeta0",
        "timestamp": 1740353927
    },
    {
        "content": "<p><code>ext</code> stands for \"extensionality\", that is, two things are equal if their parts are equal. For a function, that means that it evaluates the same on every argument (and you'd generally name the argument); for sets it means that an element is in one iff it is in the other (and you'd name the element); for pairs it means that the first part and the second part are equal (and you'd get two goals rather than one, but nothing that needs to be named); and there's other cases (some kinds of functions are equal as soon as they're equal at 1, for example)</p>",
        "id": 501421039,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1740354342
    },
    {
        "content": "<p>Your example doesn't work at all without MoP</p>",
        "id": 501421054,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1740354355
    },
    {
        "content": "<p><code>ext</code> (outside of MoP) means, \"look for lemmas tagged <code>@[ext]</code> that say when two things are equal, create new goals for the assumptions, and <code>intro</code> any variables\".<br>\nExamples of <code>@[ext]</code> lemmas are <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prod.ext#doc\">docs#Prod.ext</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=funext#doc\">docs#funext</a>, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter.ext#doc\">docs#Filter.ext</a>.<br>\nWhen introducing new variable names, <code>ext a b c d e</code> will use <code>a b c d e</code> as the new variable names. If there aren't enough variable names, <code>ext</code> will make inaccessible names (similar to what happens when you <code>intro</code> without a name), and if there are too many, <code>ext</code> will ignore the extra names.</p>",
        "id": 501421117,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1740354383
    },
    {
        "content": "<p>(I haven't checked what your second example is doing, but I hope that helps with the general question)</p>",
        "id": 501421121,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1740354387
    },
    {
        "content": "<p><code>ext</code> without arguments means \"let Lean come up with a variable name\". The name it gives is something you can't enter yourself (it will have a cross to signify this). This is fine if you don't need to refer to the variable in the proof.</p>",
        "id": 501421536,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740354768
    },
    {
        "content": "<p>I invite you to take <code>ext x</code> in your example and delete the <code>x</code> to see what it does.</p>",
        "id": 501421560,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740354791
    },
    {
        "content": "<p>Thanks for the replies, which are useful.</p>\n<p>Your explanation of extensionality is useful, <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> </p>\n<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> if I follow what you said about \"let lean come up with a name\", then it shouldn't have a problem if I do come up with a name. However changing <code>ext</code> to <code>ext j</code> so I choose a name, in the second example, that causes an error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>applyExtLemma only applies to equations, not\n  {a | 4 ∣ a} = {b | 2 ∣ b} → False\n</code></pre></div>\n<p>So I haven't fully settled it in my mind.</p>",
        "id": 501421913,
        "sender_full_name": "rzeta0",
        "timestamp": 1740355143
    },
    {
        "content": "<p>I don't know what the MoP version of <code>ext</code> does for inequalities. The core Lean version wouldn't accept this.</p>",
        "id": 501422073,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740355228
    },
    {
        "content": "<p>ok thanks - I'll mark as resolved as this is too MoP in flavour</p>",
        "id": 501422419,
        "sender_full_name": "rzeta0",
        "timestamp": 1740355387
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> has marked this topic as resolved.</p>",
        "id": 501422421,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740355389
    },
    {
        "content": "<p>Here's the answer: <a href=\"https://github.com/hrmacbeth/math2001/blob/e660f42b13ddcb6d12b52ba036d6bd071a0cfb9b/Library/Config/Set.lean#L25-L30\">https://github.com/hrmacbeth/math2001/blob/e660f42b13ddcb6d12b52ba036d6bd071a0cfb9b/Library/Config/Set.lean#L25-L30</a></p>",
        "id": 501422573,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740355532
    },
    {
        "content": "<p>It says \"when <code>ext</code> isn't given arguments, try doing <code>rw [Set.mt_ext_iff]</code>\"</p>",
        "id": 501422651,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740355570
    },
    {
        "content": "<p>That is, it's applying the inverse of extensionality (which is also true, since extensionality is an iff).</p>",
        "id": 501422708,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740355630
    }
]