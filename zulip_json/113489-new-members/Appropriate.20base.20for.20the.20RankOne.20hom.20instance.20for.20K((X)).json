[
    {
        "content": "<p>Since my PR on nonarchimedean local fields is almost complete (<a href=\"https://github.com/leanprover-community/mathlib4/pull/16733\">#16733</a>), I thought about making sure that the results can be applied for the enumeration of such fields (finite extensions of Q_p and F_q((T))). To even start down this route, I found that <code>NontriviallyNormedField K((X))</code> does not yet exist. We do have <code>Valued K⸨X⸩ ℤₘ₀</code>. </p>\n<p>Apparently, the only thing that was missing for <code>Valued.toNormedField</code> to fir e is a <code>Valuation.RankOne</code> instance. We only have 2 such instances in mathlib, one of which I added myself (the obvious NormedField.toValued one). I haven't grokked the API set up of <code>Valued</code> and <code>Valuation.RankOne</code> entirely, especially with way that <code>Valued</code> carries data and can be \"noncanonical\" since the codomain is an outparam.</p>\n<p>Here is my attempt to generate a <code>NontriviallyNormedField K⸨X⸩</code>. You'll note that I used <code>e := 2</code> for the base of the Zm0 -&gt; NNReal hom. What is the \"proper\" value to use here? Does it even matter (?), since the <code>RankOne</code> nature is only used for the <code>nontrivial</code> aspect.  cc <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span>  <span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> as contributors to <code>Valued.to(Nontrivially)NormedField</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">RankOne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LaurentSeries</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithZeroMulInt</span><span class=\"bp\">.</span><span class=\"n\">toNNReal</span><span class=\"w\"> </span><span class=\"n\">two_ne_zero</span>\n<span class=\"w\">  </span><span class=\"n\">strictMono'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">WithZeroMulInt</span><span class=\"bp\">.</span><span class=\"n\">toNNReal_strictMono</span><span class=\"w\"> </span><span class=\"n\">one_lt_two</span>\n<span class=\"w\">  </span><span class=\"n\">nontrivial'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">HahnSeries</span><span class=\"bp\">.</span><span class=\"n\">single</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LaurentSeries</span><span class=\"bp\">.</span><span class=\"n\">valuation_single_zpow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ofAdd_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">coe_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_eq_one</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">coe_one</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Valued</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LaurentSeries</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsUltrametricDist</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LaurentSeries</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>",
        "id": 494059344,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1736997893
    },
    {
        "content": "<p>There's no canonical value in general. If K were finite then its size would be a nice choice because then <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">K((x))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mopen\">((</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">))</span></span></span></span> is locally compact and you've chosen the factor that additive haar measure is being scaled by (see the <a href=\"https://imperialcollegelondon.github.io/FLT/blueprint/Haar_char_project.html\">Haar character project</a> in the FLT blueprint) but I imagine that it's not in general in your situation (yet) so anything bigger than 1 works</p>",
        "id": 494079306,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737011734
    },
    {
        "content": "<p>The argument for using 37 instead of 2 is that it indicates that it's random</p>",
        "id": 494079390,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737011766
    },
    {
        "content": "<p>In our work on local fields, given a valued field <code>K</code> (not necessarily a field of Laurent series), <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> and I take <code>e</code> to be the size of the residue field of<code>K</code> if it is finite, and otherwise <code>e := 6</code> (a random non-prime power). You could do an analogous choice here.</p>",
        "id": 494086185,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1737014930
    },
    {
        "content": "<p>We call this <a href=\"https://github.com/mariainesdff/LocalClassFieldTheory/blob/22ce0b81b5ce5e75bdbad858dd1472adf1aa5826/LocalClassFieldTheory/DiscreteValuationRing/Basic.lean#L341\">Valuation.base</a>.</p>",
        "id": 494086639,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1737015128
    },
    {
        "content": "<p>There is an instance <code>WithAbs.nontriviallynormedField</code> in <a href=\"https://github.com/MichaelStollBayreuth/Heights/blob/master/Heights/Equivalence.lean\">Heights.Equivalence</a>. (This circumvents the \"base\" problem by forcing you to specify the absolute value.)</p>",
        "id": 494125886,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1737028288
    }
]