[
    {
        "content": "<p>Is there any reason why the rewrite here doesn't work?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">Infinite</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">and_comm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">exists_infinite_primes</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>",
        "id": 535658312,
        "sender_full_name": "Maris Ozols",
        "timestamp": 1755859862
    },
    {
        "content": "<p>The reason is commonly referred to as \"<code>rw</code> doesn't work under binders\" but this statement is not strictly accurate; more accurate would be \"<code>rw</code> often doesn't work under binders\". Try <code>simp only [and_comm]</code> or <code>simp_rw [and_comm]</code> and maybe you'll have more luck.</p>",
        "id": 535658826,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1755860072
    },
    {
        "content": "<p>\"<code>rw</code> doesn't match expressions containing bound variables\"</p>",
        "id": 535660905,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755860961
    },
    {
        "content": "<p>Though <code>simp</code> may have trouble because it loops. You can specify the <code>and_comm</code> more to avoid that, or use the <code>conv</code> tactic</p>",
        "id": 535661225,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755861104
    },
    {
        "content": "<p><code>conv</code> is a great way to use <code>rw</code> for particular positions. To use it, you need to get acquainted with the <code>enter</code> mini-language, and also hover over expressions in the Infoview to know how things are encoded:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">Infinite</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">and_comm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">exists_infinite_primes</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>If you use an identifier in place of <code>_</code>, then that names the existential binder as you enter.</p>\n<p>The reason for the <code>1</code> is that existentials are encoded as <code>Exists fun p =&gt; ...</code>, so we need to enter the first explicit argument and then the function.</p>",
        "id": 535724090,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755882497
    },
    {
        "content": "<p>(In the very near future <code>rw</code> <em>will</em> work under binders.)</p>",
        "id": 535724220,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1755882551
    },
    {
        "content": "<p><code>conv?</code> is also great when it works (and when <a href=\"https://github.com/leanprover-community/mathlib4/pull/25889\">#25889</a> is merged it will work a lot more)</p>",
        "id": 535724810,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755882816
    }
]