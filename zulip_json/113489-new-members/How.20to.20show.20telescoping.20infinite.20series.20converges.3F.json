[
    {
        "content": "<p>More generally, how to work with familiar partial sums:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 505063842,
        "sender_full_name": "spamegg",
        "timestamp": 1741769129
    },
    {
        "content": "<p>How can I write an infinite series that starts at, say, <code>n=17</code>?</p>",
        "id": 505066641,
        "sender_full_name": "spamegg",
        "timestamp": 1741769863
    },
    {
        "content": "<p>My understanding of series convergence in Mathlib is that it is in practice absolute convergence (I am unfamiliar with filter-based convergence but this is what I understand from the comments in the library), so just proving convergence of partial sums won't be enough. </p>\n<p>In your example the series is absolutely converging, so convergence of partial sums should be sufficient, but in general, a theorem about telescoping series would need a separate convergence hypothesis.</p>\n<p>(Also, your example does not declare a type for the values, so they are natural numbers by default, with the wonky natural division; this is most likely not what you intended. )</p>",
        "id": 505084427,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1741774223
    },
    {
        "content": "<p>Yes they should be rationals.</p>",
        "id": 505084560,
        "sender_full_name": "spamegg",
        "timestamp": 1741774254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"766787\">spamegg</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20show.20telescoping.20infinite.20series.20converges.3F/near/505066641\">ha dicho</a>:</p>\n<blockquote>\n<p>How can I write an infinite series that starts at, say, <code>n=17</code>?</p>\n</blockquote>\n<p>I would also like to know the correct notation for this.</p>",
        "id": 505087413,
        "sender_full_name": "spamegg",
        "timestamp": 1741774978
    },
    {
        "content": "<p>Anytime you mention n, instead write n+17</p>",
        "id": 505087570,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741775023
    },
    {
        "content": "<p>Or sum over n : Set.Ici 17</p>",
        "id": 505087792,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741775076
    },
    {
        "content": "<p>Yes I can do that. But I need to model a problem as closely as possible to the real thing, so that the Lean solution matches a \"human solution\" as closely as possible.</p>",
        "id": 505087838,
        "sender_full_name": "spamegg",
        "timestamp": 1741775088
    },
    {
        "content": "<p>Can you share the larger spec you have to match?</p>",
        "id": 505088026,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741775141
    },
    {
        "content": "<p>Is the challenge to formalize the statement or the solution as close as possible?</p>",
        "id": 505088335,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741775219
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"c1\">-- The sum should start from 17 instead.</span>\n</code></pre></div>\n<p>The solution involves getting partial fractions of <code>1/(n-15)(n-16)</code> and so on.</p>",
        "id": 505088371,
        "sender_full_name": "spamegg",
        "timestamp": 1741775225
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20show.20telescoping.20infinite.20series.20converges.3F/near/505088335\">ha dicho</a>:</p>\n<blockquote>\n<p>Is the challenge to formalize the statement or the solution as close as possible?</p>\n</blockquote>\n<p>Yes.</p>",
        "id": 505088391,
        "sender_full_name": "spamegg",
        "timestamp": 1741775232
    },
    {
        "content": "<p>Where are these restrictions derived from?</p>",
        "id": 505088479,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741775258
    },
    {
        "content": "<p>Old math olympiad problems for teaching.<br>\nNow of course I could say \"hey let's substitute u = n+17 and start from 0\" but that's quite unnatural... The natural thing is to write out the binomial coefficients, cancel / simplify, then use partial fractions. That's what humans would do.</p>",
        "id": 505128939,
        "sender_full_name": "spamegg",
        "timestamp": 1741785180
    },
    {
        "content": "<p>Also how would one go about proving, in Lean, that the substitution actually preserves convergence?</p>",
        "id": 505129117,
        "sender_full_name": "spamegg",
        "timestamp": 1741785231
    },
    {
        "content": "<p>Here's a notation macro to help with writing it differently, and a proof that they are definitionally equal.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"n\">notation3</span><span class=\"w\"> </span><span class=\"s2\">\"∑' \"</span><span class=\"o\">(</span><span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"s2\">\" from \"</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"mi\">67</span><span class=\"s2\">\", \"</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"mi\">67</span><span class=\"o\">:(</span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">tsum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">r</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 505164896,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741792560
    },
    {
        "content": "<p>For the \"substitution preserves convergence\", do you mean that the limit is the same, or that it converges period?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">summable_nat_add_iff</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n</code></pre></div>",
        "id": 505167648,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741793122
    },
    {
        "content": "<p>I guess, that one converges iff the other converges, and if they do, the limit is the same.</p>",
        "id": 505180779,
        "sender_full_name": "spamegg",
        "timestamp": 1741795799
    },
    {
        "content": "<p>I don't see how an arbitrary series starting from 0, and that same series starting from 17 would converge to the same limit. I would assume that if the series a_n starting from 0 converges to A, then the series summed from 17 would be <code>A - \\Sum_{0}^{16} a_i</code></p>",
        "id": 505188945,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741797581
    },
    {
        "content": "<p>Sorry I think the conversation got confused a little. I was talking about making a substitution like <code>u = f(n)</code> (like how we do in integrals).</p>",
        "id": 505189254,
        "sender_full_name": "spamegg",
        "timestamp": 1741797650
    },
    {
        "content": "<p>And the substitution would change the starting value of the sum.</p>",
        "id": 505189338,
        "sender_full_name": "spamegg",
        "timestamp": 1741797671
    },
    {
        "content": "<p>Anyway, that's not important right now.<br>\nI still need a way to work with \"from 17 to infinity\". Is Set.Ici the right way to go?</p>",
        "id": 505189464,
        "sender_full_name": "spamegg",
        "timestamp": 1741797702
    },
    {
        "content": "<p>This doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">BigOperators</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ici</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 505199963,
        "sender_full_name": "spamegg",
        "timestamp": 1741800030
    },
    {
        "content": "<p>failed to synthesize<br>\nFintype ↑(Set.Ici 17)</p>",
        "id": 505200222,
        "sender_full_name": "spamegg",
        "timestamp": 1741800094
    },
    {
        "content": "<p>It looks like it sees this as a finite sum.</p>",
        "id": 505200308,
        "sender_full_name": "spamegg",
        "timestamp": 1741800115
    },
    {
        "content": "<p>Use <code>∑'</code> instead to do an infinite sum.</p>",
        "id": 505200558,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741800172
    },
    {
        "content": "<p>application type mismatch<br>\n∑' (_ : n ∈ Set.Ici 17), n.choose 15 / n.choose 17<br>\nargument<br>\nfun h =&gt; n.choose 15 / n.choose 17<br>\nhas type<br>\nn ∈ Set.Ici 17 → ℕ : Type<br>\nbut is expected to have type<br>\n?m.931 n → ℕ : Type (max ?u.12 0)</p>",
        "id": 505200686,
        "sender_full_name": "spamegg",
        "timestamp": 1741800210
    },
    {
        "content": "<p>The syntax for tsum is of a type, not a membership, so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ici</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 505201456,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1741800389
    },
    {
        "content": "<p>Now, how to show convergence for a sum over <code>Set.Ici</code>, partial sums, or filters, or some other technique?</p>",
        "id": 505204665,
        "sender_full_name": "spamegg",
        "timestamp": 1741801190
    },
    {
        "content": "<p>I think the overall strategy could be</p>\n<ul>\n<li>Prove <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/InfiniteSum/Defs.html#Summable\">Summable</a> (absolute convergence) by <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Instances/ENNReal/Lemmas.html#Summable.of_nonneg_of_le\">comparison test</a> against <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/ZetaValues.html#hasSum_zeta_two\">zeta 2</a></li>\n<li>With Summable proved, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Topology/Algebra/InfiniteSum/NatInt.html#Summable.tendsto_sum_tsum_nat\">convert the absolute sum to limit of partial sum</a>, and then do telescoping in the partial sum and then calculate the limit</li>\n</ul>",
        "id": 505291501,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741829561
    },
    {
        "content": "<p>Correction: comparing to zeta 2 is overkill. You can use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/PSeries.html#Real.summable_nat_rpow_inv\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/PSeries.html#Real.summable_nat_rpow_inv</a></p>",
        "id": 505301433,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741833810
    }
]