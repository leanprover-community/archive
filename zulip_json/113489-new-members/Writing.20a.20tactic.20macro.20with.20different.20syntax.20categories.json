[
    {
        "content": "<p>I want to write a tactic macro that looks something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">elimTarget</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">elimTarget</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"kn\">macro_rules</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e1</span><span class=\"o\">:</span><span class=\"n\">elimTarget</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"o\">:</span><span class=\"n\">elimTarget</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>That is, I have two arguments which will both be instances of some inductive type, and I want to do case analysis in a particular order. However, Lean does not like the <code>generalizing $e2</code>, since it expects <code>term</code> syntax rather than <code>Lean.Parser.Tactic.elimTarget</code>. Is there a way to treat <code>elimTarget</code> as a <code>term</code>? Or how else could I resolve this? Thanks</p>",
        "id": 560042238,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1764028049
    },
    {
        "content": "<p>What do you want it to do with full <code>elimTarget</code> syntax? Remember that it's either a term <code>e</code> or of the form <code>h : e</code>, and also <code>generalizing</code> only supports references to local variables.</p>\n<p>Perhaps this is sufficient for your use case?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"foo\"</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"n\">ident</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span>\n<span class=\"kn\">macro_rules</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e1</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e1</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">e2</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>If you want terms, you can upgrade <code>ident</code> to <code>term</code> (useful if you want to refer to a local variable using <code>‹T›</code> syntax), but note that you'll need to adjust the syntax by for example adding a <code>\", \"</code> into it between the terms or increasing the precedence to <code>term:max</code>.</p>",
        "id": 560048127,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1764031658
    },
    {
        "content": "<p>Thanks, that was exactly what I needed. I wasn't specifically trying to use <code>elimTarget</code>, I only changed that following type errors when using <code>term</code>.</p>",
        "id": 560188381,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1764085163
    }
]