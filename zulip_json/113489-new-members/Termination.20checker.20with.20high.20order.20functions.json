[
    {
        "content": "<p>Is it possible to prove termination when the recursive function is passed as an argument to high order function, by directly unfolding the high order function definition?</p>\n<p>Example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">  </span><span class=\"gr\">admit</span>\n</code></pre></div>\n<p>It seems what I wanted to do is impossible, the goal doesn't mention <code>foo</code> at all. It wants me to prove that the recursive call to <code>bar</code> with any argument is decreasing.</p>",
        "id": 497108692,
        "sender_full_name": "MrQubo",
        "timestamp": 1738367778
    },
    {
        "content": "<p>Well founded recursion abstracts occurrences of <code>bar a</code> to pass to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WellFounded.fix#doc\">docs#WellFounded.fix</a>. So when you write <code>foo bar x</code>, <code>bar</code> gets eta-expanded into <code>fun a =&gt; bar a</code> so that <code>bar a</code> can be abstracted, and then you have to prove that this recursive call to <code>a</code> is decreasing, which is obviously impossible since <code>a</code> is now a new free variable.</p>",
        "id": 497110179,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738368653
    },
    {
        "content": "<p>Yes, I think I understand what happened.<br>\nI'm asking whether it's somehow possible to prove that function <code>bar</code> is in fact terminating.</p>",
        "id": 497110323,
        "sender_full_name": "MrQubo",
        "timestamp": 1738368750
    },
    {
        "content": "<p>Usually, the solution would be to modify <code>foo</code> to pass in some more arguments to <code>bar</code>, and then maybe these additional assumptions are enough to prove the recursive call is decreasing.</p>",
        "id": 497111263,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738369475
    },
    {
        "content": "<p>To do this without modifying <code>foo</code> is trickier. Since the elaborator needs to abstract out <code>bar a</code>, you need a way to unfold <code>foo</code>, which may not always be possible (what if instead of <code>foo</code>, you had a free variable?).</p>",
        "id": 497111595,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738369701
    }
]