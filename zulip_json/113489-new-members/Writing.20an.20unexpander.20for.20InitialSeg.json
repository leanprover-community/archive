[
    {
        "content": "<p>It would be nice if initial segments could appear in the info view as <code>α ≤i β</code> notation (and likewise for the <code>&lt;i</code> notation for principal segments). How would one write an unexpander to enable this? I assume it would be pretty simple but I have no idea what I'm doing when it comes to metaprogramming in Lean.</p>",
        "id": 566442001,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767648763
    },
    {
        "content": "<p>does using <code>notation3</code> to define the notation work?</p>",
        "id": 566442069,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767648796
    },
    {
        "content": "<p>oh hmm, I don't know... the notation itself is already defined in mathlib using <code>notation</code></p>",
        "id": 566442119,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767648827
    },
    {
        "content": "<p>but I suppose I could try redefining it using <code>notation3</code></p>",
        "id": 566442149,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767648842
    },
    {
        "content": "<p>it does seem to work (though I had to write a slightly different syntax to avoid overlap with the existing notation)</p>",
        "id": 566442610,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649081
    },
    {
        "content": "<p>I don't know about the differences here but it seems kind of funny that the lean-3 style notation works \"better\" than the lean 4 version (in the sense that it gives me the info view formatting for free)</p>",
        "id": 566442791,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649164
    },
    {
        "content": "<p>I just copy-pasted the <a href=\"https://tqft.net/mathlib4files/Order/InitialSeg\">file#Order/InitialSeg</a> into the web editor and changed <code>notation</code> to <code>notation3</code> on line 67 and the infoview changes from <code>(fun x1 x2 =&gt; x1 &lt; x2) ≼i fun x1 x2 =&gt; x1 &lt; x2</code> to <code>α ≤i β</code></p>",
        "id": 566442898,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767649214
    },
    {
        "content": "<p>yeah it definitely works... idk if that's something we want to change in mathlib (<strong>edit:</strong> probably not)</p>",
        "id": 566443241,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649387
    },
    {
        "content": "<p>I tried to do this in the web editor but it complained about ambiguous syntax, understandably:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">InitialSeg</span>\n\n<span class=\"n\">notation3</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"s2\">\" ≤i \"</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">InitialSeg</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LT</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 566443343,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649440
    },
    {
        "content": "<p>the doc for <code>notation3</code> says that it was created primarily for backward compatibility, so I'm curious if there's a more forward-looking approach</p>",
        "id": 566443738,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649630
    },
    {
        "content": "<p>(this isn't that important though, was mostly just wondering if it was something easy to do)</p>",
        "id": 566443869,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767649686
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"380294\">Matt Diamond</span> <a href=\"#narrow/channel/113489-new-members/topic/Writing.20an.20unexpander.20for.20InitialSeg/near/566443241\">said</a>:</p>\n<blockquote>\n<p>yeah it definitely works... idk if that's something we want to change in mathlib (<strong>edit:</strong> probably not)</p>\n</blockquote>\n<p>why not?</p>",
        "id": 566444393,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767649986
    },
    {
        "content": "<p>oh just going off the doc for <code>notation3</code>... it says it has an \"uncertain future\"</p>",
        "id": 566444439,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767650013
    },
    {
        "content": "<p>I think that's no longer accurate, or at least that there's no active plans to remove it</p>",
        "id": 566444600,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767650093
    },
    {
        "content": "<p>thanks for the info... I'm still curious why <code>notation3</code> seems to work better here than <code>notation</code></p>\n<p>is this one of those things where the Lean4 version is more powerful but doesn't give you as much \"out of the box\", so to speak?</p>",
        "id": 566452148,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767654133
    },
    {
        "content": "<p><code>notation3</code> <a href=\"https://github.com/leanprover-community/mathlib4/blob/8520ad2c07db70928bd61ccb847ab0a818b8c2a8/Mathlib/Util/Notation3.lean#L630-L677\">creates an delaborator</a></p>",
        "id": 566454672,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767655446
    },
    {
        "content": "<p>I asked about it here before <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/InitialSeg.20notation3/with/513978613\">#mathlib4 &gt; InitialSeg notation3</a>, it seems like the hope is that <code>notation</code> would do it eventually</p>",
        "id": 566454682,
        "sender_full_name": "Eric Paul",
        "timestamp": 1767655455
    },
    {
        "content": "<p>in the section on <a href=\"https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Notations/#notations\">Notations</a>, the Lean manual says:</p>\n<blockquote>\n<p>When the expansion consists of the application of a function defined in the global environment and each term in the notation occurs exactly once, an <a href=\"https://lean-lang.org/doc/reference/latest/Notations-and-Macros/Extending-Lean___s-Output/#--tech-term-unexpanders\">unexpander</a> is generated. The new notation will be displayed in <a href=\"https://lean-lang.org/doc/reference/latest/Tactic-Proofs/#--tech-term-proof-state\">proof states</a>, error messages, and other output from Lean when matching function application terms otherwise would have been displayed.</p>\n</blockquote>\n<p>so I'm wondering if the problem is that the notation for InitialSeg doesn't meet the requirements here, or if an unexpander by itself is insufficient</p>",
        "id": 566455264,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767655849
    },
    {
        "content": "<p>doesn't meet the requirements</p>",
        "id": 566455602,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767656104
    },
    {
        "content": "<p><code>@InitialSeg α β (fun (x1 : α) (x2 : α) =&gt; @LT.lt α inst_1 x1 x2) (fun (x1 : β) (x2 : β) =&gt; @LT.lt β inst x1 x2)</code></p>",
        "id": 566455796,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767656270
    },
    {
        "content": "<p>then it becomes obvious that <code>α</code> and <code>β</code> are used multiple times</p>",
        "id": 566455820,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767656299
    },
    {
        "content": "<p>ah, that would do it, yeah</p>",
        "id": 566455861,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1767656334
    }
]