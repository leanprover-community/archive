[
    {
        "content": "<p>if I need a deep understanding of Lean.Meta.Basic, do I have a better alternative than reading the code? </p>\n<p>the language reference seem not to go into low-level details and i can't find another doc that does</p>",
        "id": 528769371,
        "sender_full_name": "Ping J",
        "timestamp": 1752546240
    },
    {
        "content": "<p>have you read this <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/\">https://leanprover-community.github.io/lean4-metaprogramming-book/</a></p>",
        "id": 528769522,
        "sender_full_name": "(deleted)",
        "timestamp": 1752546382
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/channel/113489-new-members/topic/understanding.20the.20low.20level/near/528769522\">said</a>:</p>\n<blockquote>\n<p>have you read this <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/\">https://leanprover-community.github.io/lean4-metaprogramming-book/</a></p>\n</blockquote>\n<p>yes, i have. very educational<br>\n it more focuses on the utility of metaprogramming framework</p>",
        "id": 528769592,
        "sender_full_name": "Ping J",
        "timestamp": 1752546431
    },
    {
        "content": "<p>for e.g. i'm having trouble locating the definition/implementation of keywords <code>by</code>, and keyword <code>tactic</code> seem to point to an empty category and i cannot understand the implementation</p>",
        "id": 528770703,
        "sender_full_name": "Ping J",
        "timestamp": 1752547586
    },
    {
        "content": "<p>I think some of the key syntax objects are registered as builtins, which (I think, and I'm not completely sure of this) means that even though they are defined within Lean, they are defined within some past version of Lean and are thus accessible even when Lean doesn't import anything.</p>\n<p>See for example <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Term.byTactic#doc\">docs#Lean.Parser.Term.byTactic</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Term.elabByTactic#doc\">docs#Lean.Elab.Term.elabByTactic</a></p>",
        "id": 528771461,
        "sender_full_name": "Niels Voss",
        "timestamp": 1752548379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> <a href=\"#narrow/channel/113489-new-members/topic/understanding.20the.20low.20level/near/528771461\">said</a>:</p>\n<blockquote>\n<p>See for example <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Term.byTactic#doc\">docs#Lean.Parser.Term.byTactic</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Elab.Term.elabByTactic#doc\">docs#Lean.Elab.Term.elabByTactic</a></p>\n</blockquote>\n<p>thx for pointing out! i guess the latter is indeed the direction i should be looking into</p>",
        "id": 528772716,
        "sender_full_name": "Ping J",
        "timestamp": 1752549684
    },
    {
        "content": "<p>i'm reading </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">Creates a new metavariable of type `type` that will be synthesized using the tactic code.</span>\n<span class=\"sd\">The `tacticCode` syntax is the full `by ..` syntax.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTacticMVar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">tacticCode</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TacticMVarKind</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">delayOnMVars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TermElabM</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">debug</span><span class=\"bp\">.</span><span class=\"n\">byAsSorry</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getOptions</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">&lt;&amp;&amp;&gt;</span><span class=\"w\"> </span><span class=\"n\">isProp</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">withRef</span><span class=\"w\"> </span><span class=\"n\">tacticCode</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">mkLabeledSorry</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">unique</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">MetavarKind</span><span class=\"bp\">.</span><span class=\"n\">syntheticOpaque</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mvarId</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span>\n<span class=\"w\">    </span><span class=\"n\">registerSyntheticMVar</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"n\">mvarId</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">tacticCode</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">saveContext</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"n\">delayOnMVars</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mvar</span>\n</code></pre></div>\n<p>and am still quite lost. i think i'm confused mainly by oblivion of </p>\n<ol>\n<li>how is the delay/postpone orchestrated</li>\n<li>what is the code path from here to the code enabling e.g. tactic customization in metaprogramming</li>\n</ol>",
        "id": 528774294,
        "sender_full_name": "Ping J",
        "timestamp": 1752551197
    }
]