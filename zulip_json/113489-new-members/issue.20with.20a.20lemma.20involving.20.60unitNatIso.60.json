[
    {
        "content": "<p>The following lemma is giving me trouble in a bigger proof:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">MonoidalCategory</span><span class=\"w\"> </span><span class=\"n\">MonoidalClosed</span><span class=\"w\"> </span><span class=\"n\">SimplicialCategory</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">SSet</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonoidalClosed</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">closed</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"n\">rightAdj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sHomFunctor</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">A</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">    </span><span class=\"n\">adj</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">FunctorToTypes</span><span class=\"bp\">.</span><span class=\"n\">adj</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"o\">}</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Closed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">closed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">curry_snd_unitNatIso_inv_app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">curry</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CartesianMonoidalCategory</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">unitNatIso</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">SSet</span>\n</code></pre></div>\n<p>What is puzzling is how when we replace the second instance with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Closed</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unitClosed</span>\n</code></pre></div>\n<p>then <code>rfl</code> closes the goal, however, in the project I'm working in (infinity-cosmos), the first instance is the one the lemma takes automatically, and <code>rfl</code> doesn't do anything anymore. </p>\n<p>How can I solve this issue?</p>",
        "id": 529552757,
        "sender_full_name": "Rida Hamadani",
        "timestamp": 1752902217
    },
    {
        "content": "<p>I cannot answer specifically, but I have shown certain similar compatibilities. Usually, I would try various \"tricks\":</p>\n<ul>\n<li>pre/post-compose with the inverse of an isomorphism (here, I may try postcomposing with <code>unitNatIso.hom.app Y</code>);</li>\n<li>use <code>(un)curry_injective</code> and the various naturality lemmas;</li>\n<li>(un)apply a bijection like <code>((ihom X).obj Y) _‚¶ã0‚¶å ‚âÉ (X ‚ü∂ Y)</code> (see <a href=\"https://github.com/joelriou/topcat-model-category/blob/master/TopCatModelCategory/SSet/Monoidal.lean#L169\">https://github.com/joelriou/topcat-model-category/blob/master/TopCatModelCategory/SSet/Monoidal.lean#L169</a> which may depend on an out of date mathlib, before the chosen finite products refactor)</li>\n<li>try <code>rfl</code> at any stage.</li>\n</ul>\n<p>If all of this fail, I would try to see if there are missing equational lemmas (e.g. for <code>unitNatIso</code>?).</p>",
        "id": 529560028,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1752912085
    },
    {
        "content": "<p>Thanks, post-composing fixed the issue! Here is the proof:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">curry_snd_unitNatIso_inv_app</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">curry</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CartesianMonoidalCategory</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ùüô</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">SSet</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â´</span><span class=\"w\"> </span><span class=\"n\">unitNatIso</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Iso</span><span class=\"bp\">.</span><span class=\"n\">app_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Iso</span><span class=\"bp\">.</span><span class=\"n\">comp_inv_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Iso</span><span class=\"bp\">.</span><span class=\"n\">app_hom</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">unitNatIso</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">id_obj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">conjugateIsoEquiv_apply_hom</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">conjugateEquiv_apply_app</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">curriedTensor_obj_obj</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ihom</span><span class=\"bp\">.</span><span class=\"n\">ihom_adjunction_unit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">leftUnitorNatIso_hom_app</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">ihom</span><span class=\"bp\">.</span><span class=\"n\">coev_naturality_assoc</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">id_whiskerLeft</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Functor</span><span class=\"bp\">.</span><span class=\"n\">map_comp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">assoc</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Iso</span><span class=\"bp\">.</span><span class=\"n\">map_inv_hom_id_assoc</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 529622452,
        "sender_full_name": "Rida Hamadani",
        "timestamp": 1752974715
    },
    {
        "content": "<p>But I'm curious about why the difference in instances would cause such an issue, I'd appreciate any insight into that as well.</p>",
        "id": 529622583,
        "sender_full_name": "Rida Hamadani",
        "timestamp": 1752974924
    },
    {
        "content": "<p>It is likely that at least one of the lemmas in the <code>simp</code> list is not a <code>rfl</code> equality. Syntactically, it seems that the statement <code>curry_snd_unitNatIso_inv_app</code> may hold in more general cartesian closed monoidal categories, in which case it is very unlikely we could prove it by <code>rfl</code>. That the chosen product and the internal hom in the category of functor to types have nice formulas makes it so that some proofs can be done by <code>rfl</code> (but we can consider we are lucky when this happens).</p>",
        "id": 529866358,
        "sender_full_name": "Jo√´l Riou",
        "timestamp": 1753096420
    }
]