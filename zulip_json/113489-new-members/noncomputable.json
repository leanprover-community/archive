[
    {
        "content": "<p>I'm trying</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">to_complex</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">[</span><span class=\"n\">ω</span><span class=\"o\">])</span> <span class=\"o\">:</span> <span class=\"n\">ℂ</span> <span class=\"o\">:=</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">re</span> <span class=\"bp\">+</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">I</span> <span class=\"bp\">*</span> <span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span>\n</pre></div>\n\n\n<p>but getting <code>definition 'to_complex' is noncomputable, it depends on 'complex.discrete_field'</code>.<br>\nIs there some <code>import</code> or <code>open</code> that will \"deal\" with this? What are the consequences of ignoring the noncomputability of sqrt?<br>\nIt looks like an interesting exercise to make <code>real.sqrt</code> computable (looks like there is a proof sketch in the comments of <code>real.sqrt</code>'s definition). Is that worth trying? Is it just a matter of constructing the Cauchy sequence that converges to sqrt(n)?</p>",
        "id": 188389789,
        "sender_full_name": "Paul van Wamelen",
        "timestamp": 1581955687
    },
    {
        "content": "<p>The real numbers as implemented in mathlib have no useful computational structure anyways (they are Cauchy sequences without any explicit rate of convergence). You should just put <code>noncomputable theory</code> at the top of your file if you are going to use the reals a lot.</p>",
        "id": 188390057,
        "sender_full_name": "Reid Barton",
        "timestamp": 1581955949
    },
    {
        "content": "<p>Thanks!<br>\nAre you saying that even if we complete the proof of <code>sqrt_aux_converges</code> sqrt would still be \"uncomputable\"?</p>",
        "id": 188391256,
        "sender_full_name": "Paul van Wamelen",
        "timestamp": 1581956947
    },
    {
        "content": "<p>It would be computable in the sense that Lean wouldn't have the <code>noncomputable</code> tag, but it would not be computable in any practical sense. There is no computable function <code>real -&gt; bool</code> for example, so there's basically nothing you can do with a \"computable\" function on the current implementation of the reals.</p>",
        "id": 188391396,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1581957068
    },
    {
        "content": "<p>I think I see :)<br>\nThanks again! (I must say I'm blown away by the support here...)</p>",
        "id": 188391780,
        "sender_full_name": "Paul van Wamelen",
        "timestamp": 1581957453
    },
    {
        "content": "<p>I tend to not put <code>noncomputable theory</code> at the top of my files, and then every time Lean complains something is noncomputable I just write <code>noncomputable</code> in front of it, so e.g. <code>noncomputable def to_complex ...</code> would also remove the error.</p>",
        "id": 188394508,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1581959805
    },
    {
        "content": "<p>Why for such simple theorems I need the <code>noncomputable</code> in front of the theorems? </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">constant</span> <span class=\"n\">Class</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO immediateSubclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">subClass</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO subclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">Inherits</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">inhz</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c</span> <span class=\"n\">c</span>\n<span class=\"kn\">constant</span> <span class=\"n\">inhs</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c1</span> <span class=\"n\">c3</span>\n\n<span class=\"kn\">constants</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"o\">:</span> <span class=\"n\">Class</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">human_hominid</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span>\n<span class=\"kn\">constant</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"kn\">theorem</span> <span class=\"n\">test1</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">:=</span>\n <span class=\"n\">inhs</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Hominid</span> <span class=\"n\">human_hominid</span> <span class=\"o\">(</span><span class=\"n\">inhz</span> <span class=\"n\">Hominid</span><span class=\"o\">)</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"kn\">theorem</span> <span class=\"n\">test2</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Entity</span> <span class=\"o\">:=</span>\n <span class=\"n\">inhs</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"n\">human_hominid</span> <span class=\"o\">(</span><span class=\"n\">inhs</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"n\">Entity</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">(</span><span class=\"n\">inhz</span> <span class=\"n\">Entity</span><span class=\"o\">))</span>\n</code></pre></div>\n\n\n<p>Is it possible, using some tactics, to let Lean come up of the proof terms automatically? That is, to synthesize the proof term?</p>",
        "id": 196719006,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588815731
    },
    {
        "content": "<p><code>noncomputable</code> has nothing to do with computation in this sense</p>",
        "id": 196719042,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588815813
    },
    {
        "content": "<p>it's <code>noncomputable</code> because you can't directly execute the proofs because they use undefined constants</p>",
        "id": 196719112,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588815844
    },
    {
        "content": "<p>undefined constants? but in my example, they are all defined.</p>",
        "id": 196719141,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588815908
    },
    {
        "content": "<p><code>noncomputable theorem</code> is an indication that you have incorrectly marked a <code>def</code> as a theorem, or you have a type where you wanted a prop. Are <code>subClass</code> and <code>Inherits</code> supposed to be propositions? They are named like such</p>",
        "id": 196719144,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588815923
    },
    {
        "content": "<p><code>constant</code> is the same as <code>axiom</code></p>",
        "id": 196719145,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588815933
    },
    {
        "content": "<p>No, subClass is supposed to be a dependent type and Inherits a function.</p>",
        "id": 196719208,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588815998
    },
    {
        "content": "<p>You may want to consider using <code>variable</code> or <code>parameter</code> here</p>",
        "id": 196719236,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588816058
    },
    {
        "content": "<p>actually, I would like to be able to have a term like <code>inhs Human Hominid Hominid human_hominid (inhz Hominid)</code> produced automatically for a type <code>Inherits Human Hominid</code></p>",
        "id": 196719239,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588816071
    },
    {
        "content": "<p>you can probably do that using typeclass inference</p>",
        "id": 196719286,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588816098
    },
    {
        "content": "<p>Wow! Thank you Mario. Can you give me any reference to understand it better? Probably I have to read <a href=\"https://leanprover.github.io/theorem_proving_in_lean/type_classes.html\" title=\"https://leanprover.github.io/theorem_proving_in_lean/type_classes.html\">https://leanprover.github.io/theorem_proving_in_lean/type_classes.html</a>, right?</p>",
        "id": 196719362,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588816230
    },
    {
        "content": "<p>BTW, nice, I don't need the noncomputable with variables </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">constant</span> <span class=\"n\">Class</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO immediateSubclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">subClass</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO subclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">Inherits</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">variable</span> <span class=\"n\">inhz</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c</span> <span class=\"n\">c</span>\n<span class=\"kn\">variable</span> <span class=\"n\">inhs</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c1</span> <span class=\"n\">c3</span>\n\n<span class=\"kn\">variables</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"o\">:</span> <span class=\"n\">Class</span>\n\n<span class=\"kn\">variable</span> <span class=\"n\">human_hominid</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span>\n<span class=\"kn\">variable</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">test1</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">:=</span>\n <span class=\"n\">inhs</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Hominid</span> <span class=\"n\">human_hominid</span> <span class=\"o\">(</span><span class=\"n\">inhz</span> <span class=\"n\">Hominid</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">test2</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Entity</span> <span class=\"o\">:=</span>\n <span class=\"n\">inhs</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"n\">human_hominid</span> <span class=\"o\">(</span><span class=\"n\">inhs</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"n\">Entity</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">(</span><span class=\"n\">inhz</span> <span class=\"n\">Entity</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 196719384,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588816280
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">constant</span> <span class=\"n\">Class</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO immediateSubclass</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">class</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">subClass</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO subclass</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">class</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">Inherits</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">inhz</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c</span> <span class=\"n\">c</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">inhs</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Inherits</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">subClass</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c1</span> <span class=\"n\">c3</span>\n\n<span class=\"kn\">constants</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"o\">:</span> <span class=\"n\">Class</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">human_hominid</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test1</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">apply_instance</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test2</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Entity</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">apply_instance</span>\n</code></pre></div>",
        "id": 196719490,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588816420
    },
    {
        "content": "<p>thank you. I am getting two errors </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">.</span><span class=\"err\">…</span>    <span class=\"mi\">19</span>  <span class=\"mi\">19</span> <span class=\"n\">warning</span>         <span class=\"kn\">definition</span> <span class=\"err\">&#39;</span><span class=\"n\">test1&#39;</span> <span class=\"n\">was</span> <span class=\"n\">incorrectly</span> <span class=\"n\">marked</span> <span class=\"n\">as</span> <span class=\"n\">noncomputable</span> <span class=\"o\">(</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">checker</span><span class=\"o\">)</span>\n<span class=\"bp\">.</span><span class=\"err\">…</span>    <span class=\"mi\">19</span>  <span class=\"mi\">27</span> <span class=\"n\">error</span>           <span class=\"n\">maximum</span> <span class=\"n\">class</span><span class=\"bp\">-</span><span class=\"kn\">instance</span> <span class=\"n\">resolution</span> <span class=\"n\">depth</span> <span class=\"n\">has</span> <span class=\"n\">been</span> <span class=\"n\">reached</span> <span class=\"o\">(</span><span class=\"n\">the</span> <span class=\"n\">limit</span> <span class=\"n\">can</span> <span class=\"n\">be</span> <span class=\"n\">increased</span> <span class=\"k\">by</span> <span class=\"n\">setting</span> <span class=\"n\">option</span> <span class=\"err\">&#39;</span><span class=\"n\">class</span><span class=\"bp\">.</span><span class=\"n\">instance_max_depth&#39;</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">the</span> <span class=\"n\">class</span><span class=\"bp\">-</span><span class=\"kn\">instance</span> <span class=\"n\">resolution</span> <span class=\"n\">trace</span> <span class=\"n\">can</span> <span class=\"n\">be</span> <span class=\"n\">visualized</span> <span class=\"k\">by</span> <span class=\"n\">setting</span> <span class=\"n\">option</span> <span class=\"err\">&#39;</span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">class_instances&#39;</span><span class=\"o\">)</span>\n <span class=\"n\">state</span><span class=\"o\">:</span>\n <span class=\"err\">⊢</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">(</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">checker</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 196719663,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588816662
    },
    {
        "content": "<p>You won't be able to use a variable for typeclass inference here. Instances have to be <code>def</code>s or <code>constant</code>s</p>",
        "id": 196720067,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817141
    },
    {
        "content": "<p>The error is because you missed that I swapped the arguments to <code>inhs</code></p>",
        "id": 196720121,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817176
    },
    {
        "content": "<p>I make no guarantees about the behavior of this typeclass search, and there are issues with infinite searches if it follows the wrong path</p>",
        "id": 196720152,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817243
    },
    {
        "content": "<p>but it works in a pinch</p>",
        "id": 196720153,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817256
    },
    {
        "content": "<p>I see. But I copied and pasted your code. So I didn't understand your point about the swapping of the arguments of inhs...</p>",
        "id": 196720203,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588817293
    },
    {
        "content": "<p>Are you sure? What version of lean are you running</p>",
        "id": 196720248,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817377
    },
    {
        "content": "<p>I guessed that you modified your code to look like mine</p>",
        "id": 196720259,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817395
    },
    {
        "content": "<p>Oh, I got. Now I have just green marks</p>",
        "id": 196720303,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588817404
    },
    {
        "content": "<p>but I don't know any version of lean where the <code>noncomputable</code> mark on the def is unnecessary</p>",
        "id": 196720318,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817424
    },
    {
        "content": "<p>Hum, I see. So I guess that I can't expect too much from Lean to synthesize proof terms as I was expecting with this approach I was investigating.</p>",
        "id": 196720402,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588817547
    },
    {
        "content": "<p>there are other ways to do it but they are more complicated</p>",
        "id": 196720430,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817621
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">constant</span> <span class=\"n\">Class</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO immediateSubclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">subClass</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO subclass</span>\n<span class=\"kn\">constant</span> <span class=\"n\">Inherits</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">inhz</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c</span> <span class=\"n\">c</span>\n<span class=\"kn\">constant</span> <span class=\"n\">inhs</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"bp\">→</span> <span class=\"n\">Inherits</span> <span class=\"n\">c1</span> <span class=\"n\">c3</span>\n\n<span class=\"kn\">constants</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"o\">:</span> <span class=\"n\">Class</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">human_hominid</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span>\n<span class=\"kn\">constant</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">prove_subclass</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply</span> <span class=\"n\">human_hominid</span><span class=\"o\">]</span> <span class=\"bp\">&lt;|&gt;</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply</span> <span class=\"n\">hominid_entity</span><span class=\"o\">]</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">prove_inherits</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply</span> <span class=\"n\">inhz</span><span class=\"o\">]</span> <span class=\"bp\">&lt;|&gt;</span> <span class=\"o\">(</span><span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply</span> <span class=\"n\">inhs</span><span class=\"o\">]</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">prove_subclass</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">prove_inherits</span><span class=\"o\">)</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test1</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">prove_inherits</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test2</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Entity</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">prove_inherits</span>\n</code></pre></div>",
        "id": 196720597,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588817798
    },
    {
        "content": "<p>In this article, <a href=\"https://www.molto-project.eu/sites/default/files/FinalSUMOCNL.pdf\" title=\"https://www.molto-project.eu/sites/default/files/FinalSUMOCNL.pdf\">https://www.molto-project.eu/sites/default/files/FinalSUMOCNL.pdf</a>, the authors have an interesting idea of mapping a KIF ontology (a knowledge representation language) to dependent type. They used <a href=\"https://www.grammaticalframework.org\" title=\"https://www.grammaticalframework.org\">https://www.grammaticalframework.org</a> that implements dependent types too. I am trying to adapt their solution to Lean. The idea is to model the taxonomy of classes. Later, I would expect Lean to automatically construct terms that proof a chain of subclasses like  Human &lt; Hominid &lt; CognitiveAgent &lt; Agent &lt; ... &lt; Entity.</p>",
        "id": 196720859,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588818132
    },
    {
        "content": "<p>What impressed me was that I was expecting Lean to have a much more powerful type system. But in GF they were able to easily generate a term for a given type. Page 6 of the article. The command mean: give me a term for the type <code>Inherits Human Hominid</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">&gt;</span> <span class=\"n\">gt</span> <span class=\"bp\">-</span><span class=\"n\">cat</span><span class=\"bp\">=</span><span class=\"s2\">&quot;Inherits Human Hominid&quot;</span>\n<span class=\"o\">(</span><span class=\"n\">inhs</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Hominid</span> <span class=\"n\">Human_Class</span> <span class=\"o\">(</span><span class=\"n\">inhz</span> <span class=\"n\">Hominid</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 196720960,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588818266
    },
    {
        "content": "<p>Oh, sorry I was answering a question that you made in another thread! ;-)</p>",
        "id": 196721075,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588818410
    },
    {
        "content": "<p>Reading the paper, I'm pretty sure you want <code>subClass</code> and <code>Inherits</code> to be props. The reason they use a dependent type is because that's the nearest equivalent to a proposition in a haskell-esque type theory</p>",
        "id": 196721121,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588818460
    },
    {
        "content": "<p>I think <code>gt -cat</code> is doing something similar to lean's typeclass inference</p>",
        "id": 196721181,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588818528
    },
    {
        "content": "<p>pages 5-6 read very much like a description of typeclass inference. I'm pretty sure that <code>gt -cat</code> is a prolog-like search</p>\n<blockquote>\n<p>However, there are some types of axioms which could not be ported to SUMOGF, such as the ones that use quantification over classes, negative type declarations and axioms which use the predicates subclass, range or domain.</p>\n</blockquote>\n<p>...which also predicts that negations in theorems would be problematic to represent this way, because instance search only works with horn clauses (from A , B, ... Y infer Z)</p>",
        "id": 196721382,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588818823
    },
    {
        "content": "<p>Thank you, I will think more about the implications of moving to propositions. In the previous example of trying to prove a simple SUMO axiom in Lean, I used untyped FOL mapping to Lean - <a href=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean\" title=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean\">https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean</a>. This makes the simple proof very verbose.  I had a single type <a href=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L21\" title=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L21\">https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L21</a> and guards in the axioms <a href=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L96\" title=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L96\">https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean#L96</a>. I am trying to better use types and have a way to move from the class hierarchy to types.  </p>\n<p>Anyway, the use of tactics was interesting, thank you for sharing. Unfortunately, we needed to go back to constants and noncomputable...</p>",
        "id": 196721644,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588819198
    },
    {
        "content": "<p>The reason lean gets lost with the initial version of <code>inhs</code> is because it builds up a stack <code>subclass Human ?a /\\ subclass ?a ?b /\\ subclass ?b ?c /\\ Inherits ?c Hominid -&gt; Inherits Human Hominid</code> that doesn't resolve because it keeps applying <code>inhs</code> to the last <code>Inherits</code> subgoal. It's similar to the left recursion problem in context free grammars</p>",
        "id": 196721727,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588819313
    },
    {
        "content": "<p>I am curious if GF has the same problem if you stated <code>inhs</code> as <code>Inherits c1 c2 → subClass c2 c3 → Inherits c1 c3</code> instead</p>",
        "id": 196721774,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588819349
    },
    {
        "content": "<p>This is interesting. I moved subclass back to the original position and it is working for me</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">constant</span> <span class=\"n\">Class</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO immediateSubclass</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">class</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">subClass</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"c1\">-- SUMO subclass</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">class</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">Inherits</span> <span class=\"o\">:</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"n\">Class</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">inhz</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c</span> <span class=\"n\">c</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">inhs</span> <span class=\"o\">(</span><span class=\"n\">c1</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">subClass</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Inherits</span> <span class=\"n\">c2</span> <span class=\"n\">c3</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">c1</span> <span class=\"n\">c3</span>\n\n<span class=\"kn\">constants</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span> <span class=\"o\">:</span> <span class=\"n\">Class</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">human_hominid</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"kn\">constant</span> <span class=\"n\">hominid_entity</span> <span class=\"o\">:</span> <span class=\"n\">subClass</span> <span class=\"n\">Hominid</span> <span class=\"n\">Entity</span>\n\n<span class=\"kn\">set_option</span> <span class=\"n\">class</span><span class=\"bp\">.</span><span class=\"n\">instance_max_depth</span> <span class=\"mi\">100</span>\n<span class=\"kn\">set_option</span> <span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">class_instances</span> <span class=\"n\">true</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test1</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Hominid</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">apply_instance</span>\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">test2</span> <span class=\"o\">:</span> <span class=\"n\">Inherits</span> <span class=\"n\">Human</span> <span class=\"n\">Entity</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">apply_instance</span>\n</code></pre></div>",
        "id": 196721855,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588819489
    },
    {
        "content": "<p>Unfortunately, I can't test the change in GF, the code in <a href=\"https://github.com/GrammaticalFramework/gf-contrib/tree/master/SUMO\" title=\"https://github.com/GrammaticalFramework/gf-contrib/tree/master/SUMO\">https://github.com/GrammaticalFramework/gf-contrib/tree/master/SUMO</a> is incomplete.</p>",
        "id": 196722128,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588819817
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/noncomputable/near/196720248\" title=\"#narrow/stream/113489-new-members/topic/noncomputable/near/196720248\">said</a>:</p>\n<blockquote>\n<p>Are you sure? What version of lean are you running</p>\n</blockquote>\n<p>% lean -v<br>\nLean (version 3.4.2, Release)</p>",
        "id": 196722253,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588820038
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121542\">@Alexandre Rademaker</span> So I had a go at simplifying your <a href=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean\" title=\"https://github.com/own-pt/common-sense-lean/blob/master/misc/bs.lean\">bs.lean</a>, see <a href=\"https://gist.github.com/digama0/16c62d1af34212de2e3fba380d87c043\" title=\"https://gist.github.com/digama0/16c62d1af34212de2e3fba380d87c043\">https://gist.github.com/digama0/16c62d1af34212de2e3fba380d87c043</a> . You can't quite take care of everything with typeclass inference but almost all the proofs that look like typeclass inference can be done using it</p>",
        "id": 196725430,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588824554
    },
    {
        "content": "<p>I see, thank you so much for your attention.  I will read it carefully to understand the details. The main issue, I believe, is to understand the limitations of that approach. The comments <code>not provable</code> in the end means not probable with typeclass inference or not provable at all with this way to model classes and instances? </p>\n<p>Still, I think the predicates and functions are not really typed, right? I can't say that <code>partition : Class → Class → Class → Prop</code> and 'using it' like:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">axiom</span> <span class=\"n\">a67131</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">row0</span> <span class=\"n\">row1</span> <span class=\"o\">:</span> <span class=\"n\">Class</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n <span class=\"o\">(</span><span class=\"n\">partition3</span> <span class=\"n\">c</span> <span class=\"n\">row0</span> <span class=\"n\">row1</span> <span class=\"bp\">↔</span> <span class=\"o\">(</span><span class=\"n\">exhaustiveDecomposition3</span> <span class=\"n\">c</span> <span class=\"n\">row0</span> <span class=\"n\">row1</span> <span class=\"bp\">∧</span> <span class=\"n\">disjointDecomposition3</span> <span class=\"n\">c</span> <span class=\"n\">row0</span> <span class=\"n\">row1</span><span class=\"o\">))</span>\n</code></pre></div>\n\n\n<p>That is, I can't really internalize the class hierarchy in the types.</p>\n<p>In Lean 3.4.2 almost all proofs reached the maximum class-instance resolution depth, and I set it to 1000.</p>",
        "id": 196765225,
        "sender_full_name": "Alexandre Rademaker",
        "timestamp": 1588856028
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"121542\">Alexandre Rademaker</span> <a href=\"#narrow/stream/113489-new-members/topic/noncomputable/near/196765225\" title=\"#narrow/stream/113489-new-members/topic/noncomputable/near/196765225\">said</a>:</p>\n<blockquote>\n<p>I see, thank you so much for your attention.  I will read it carefully to understand the details. The main issue, I believe, is to understand the limitations of that approach. The comments <code>not provable</code> in the end means not probable with typeclass inference or not provable at all with this way to model classes and instances? </p>\n</blockquote>\n<p>Not provable from the axioms that were provided. Presumably you have omitted some axioms that are needed to prove these.</p>",
        "id": 196975218,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589003087
    },
    {
        "content": "<p>Indeed, these predicates and functions are essentially untyped, and typeclass inference is having to solve a harder problem than it normally would because there are so few classes and so many instances. One simple way to improve this is to have one typeclass per property and try to minimize the number of two-argument typeclasses. And things like <code>ins x Class</code> are really calling out for a <code>Class</code> type as you indicate, which would eliminate the need to do any type class search, although you still have to do something about subtyping.</p>",
        "id": 196975285,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589003244
    }
]