[
    {
        "content": "<p>In the code below, my intention is to use <code>#reduce</code> to get rid of <code>foo.match_1</code> and to expose the recursor of <code>Thing</code>. However, <code>#reduce</code> will also unfold <code>List.map</code>. </p>\n<p>Is it possible for me to control the terms that will be affected by <code>#reduce</code>? In Coq, I can use <code>Eval cbn delta [...]</code> to control; I also wonder if there is anything similar in Lean. </p>\n<p>Thanks!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- Lean version for this: v4.8.0</span>\n\n<span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">aa</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">aa</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List.map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">l</span>\n\n<span class=\"k\">#print</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">output:</span>\n\n<span class=\"cm\">def foo : Thing → List Nat :=</span>\n<span class=\"cm\">fun t =&gt; foo.match_1 (fun t =&gt; List Nat) t (fun _ =&gt; List.nil) fun l =&gt; List.map (fun x =&gt; HAdd.hAdd x 1) l</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"k\">#reduce</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">output:</span>\n\n<span class=\"cm\">fun t =&gt;</span>\n<span class=\"cm\">  Thing.rec []</span>\n<span class=\"cm\">    (fun a =&gt;</span>\n<span class=\"cm\">      (List.rec ⟨[], PUnit.unit⟩ (fun head tail tail_ih =&gt; ⟨head.succ :: tail_ih.1, ⟨tail_ih, PUnit.unit⟩⟩) a).1)</span>\n<span class=\"cm\">    t</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 448814433,
        "sender_full_name": "Qiyuan Zhao",
        "timestamp": 1720002874
    },
    {
        "content": "<p>This sort of is what you're asking, but it makes use of the <code>simp</code> tactic rather than reduction.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">aa</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Thing</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">aa</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">l</span>\n\n<span class=\"bp\">#</span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">fun t ↦</span>\n<span class=\"cm\">  match t with</span>\n<span class=\"cm\">  | Thing.aa =&gt; []</span>\n<span class=\"cm\">  | Thing.bb l =&gt; List.map (fun x ↦ x + 1) l</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 448909975,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720027478
    },
    {
        "content": "<p>It would be possible to write your own <code>#reduce</code> (or <code>#whnf</code>) that only unfolds certain terms.</p>",
        "id": 448910111,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720027522
    }
]