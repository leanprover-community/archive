[
    {
        "content": "<p>I can open a scope in Lean using <code>open</code>. How do I close it?</p>",
        "id": 546967477,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761334849
    },
    {
        "content": "<p>enclose it in a section/namespace</p>",
        "id": 546967764,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761334988
    },
    {
        "content": "<p>I think it would be nice to be able to close it within the same section or namespace.</p>\n<p><span class=\"user-mention\" data-user-id=\"375375\">@Darij Grinberg</span> you can also do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>Which opens the <code>Foo</code> scope limited to <code>bar</code></p>",
        "id": 546968224,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761335174
    },
    {
        "content": "<p>ah!</p>",
        "id": 546990314,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761335430
    },
    {
        "content": "<p>i think it's possible, i'm trying to do it rn</p>",
        "id": 546991448,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761335969
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">OpenDecl</span><span class=\"bp\">.</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OpenDecl</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">simple</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Scope</span><span class=\"bp\">.</span><span class=\"n\">close</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scope</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Scope</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">sc</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">openDecls</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">sc</span><span class=\"bp\">.</span><span class=\"n\">openDecls</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">!</span><span class=\"n\">OpenDecl</span><span class=\"bp\">.</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"close \"</span><span class=\"w\"> </span><span class=\"n\">ns</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">modifyScope</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Scope</span><span class=\"bp\">.</span><span class=\"n\">close</span><span class=\"w\"> </span><span class=\"n\">ns</span><span class=\"bp\">.</span><span class=\"n\">getId</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_mod</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">add_mod</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_mod</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">add_mod</span>\n\n<span class=\"n\">close</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_mod</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">add_mod</span><span class=\"w\"> </span><span class=\"c1\">-- error</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n</code></pre></div>",
        "id": 546992650,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761336500
    },
    {
        "content": "<p>the <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> continues...</p>",
        "id": 546992748,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761336546
    },
    {
        "content": "<p>wow, I didn't know Lean code could modify itself this easily</p>",
        "id": 546995922,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761337957
    },
    {
        "content": "<p>but yeah, i can wrap my scopes in sections, no problem with that</p>",
        "id": 546995954,
        "sender_full_name": "Darij Grinberg",
        "timestamp": 1761337972
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/JGvNyipAIdhMM6_W6ju7Ulaa/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/JGvNyipAIdhMM6_W6ju7Ulaa/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1027x259\" src=\"/user_uploads/thumbnail/3121/JGvNyipAIdhMM6_W6ju7Ulaa/image.png/840x560.webp\"></a></div><p>so that means i can also delete variables... i've wanted that feature for a while</p>",
        "id": 546996004,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761337997
    },
    {
        "content": "<blockquote>\n<p>so that means i can also delete variables... i've wanted that feature for a while</p>\n</blockquote>\n<p>Is <code>omit</code> not good enough?</p>",
        "id": 547074013,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1761416020
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224323\">@Junyan Xu</span> see <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/RFC.3A.20delete.20variables/with/547109517\">#mathlib4 &gt; RFC: delete variables</a></p>",
        "id": 547112228,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761466056
    }
]