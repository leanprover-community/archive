[
    {
        "content": "<p>Anyone have any pointers into debugging instance synthesis?</p>\n<p>Here I'm attempting to construct a union of terms which depend upon a typeclass instance. I've done this twice; in the first example I'm encountering the synthesis failure, in the second I've provided some of the implicit arguments explicitly.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span> <span class=\"n\">Domain</span> <span class=\"o\">(</span><span class=\"bp\">Φ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n  <span class=\"n\">domain</span> <span class=\"o\">:</span> <span class=\"bp\">Φ</span> <span class=\"bp\">→</span> <span class=\"n\">Set</span> <span class=\"n\">s</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">trace.Meta.synthInstance</span> <span class=\"n\">true</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"bp\">Φ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">inst</span> <span class=\"o\">:</span> <span class=\"n\">Domain</span> <span class=\"bp\">Φ</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"bp\">Φ</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">domainUnion₁</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">Domain.domain</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">∪</span>\n  <span class=\"c\">/-</span>\n<span class=\"cm\">  typeclass instance problem is stuck, it is often due to metavariables</span>\n<span class=\"cm\">    Domain Φ ?m.9227</span>\n<span class=\"cm\">  -/</span>\n  <span class=\"o\">(</span><span class=\"n\">Domain.domain</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">domainUnion₂</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">Domain.domain</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">∪</span>\n  <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Domain.domain</span> <span class=\"bp\">Φ</span> <span class=\"n\">s</span> <span class=\"n\">inst</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I'm not surprised that synthesis fails; it would be hard to figure out that <code>s</code> is the type argument we need here, but I'm trying to dig into this example to get some insight out of it and have two questions:</p>\n<p>1) Why does synthesis not fail on the first argument of the union?</p>\n<p>2) How can I interpret the results of synthesis tracing?<br>\nHere's the trace of the synthesis of the successfully traced first argument of the union in the first example:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Trace</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain ?m.9210 ?m.9211 ▼<br>\n  [] new goal ValuationAlgebras.Domain ?m.9210 ?m.9211 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain ?m.9210 ?m.9211 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain ?m.9210 ?m.9211 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9217 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9217 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9217 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n</div></div>\n<p>Here's the failing instance:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Trace</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain ?m.9222 ?m.9223 ▼<br>\n  [] new goal ValuationAlgebras.Domain ?m.9222 ?m.9223 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain ?m.9222 ?m.9223 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain ?m.9222 ?m.9223 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n<p>[Meta.synthInstance] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n  [] new goal ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [instances] #[inst] <br>\n  [] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> apply inst to ValuationAlgebras.Domain Φ ?m.9227 ▼<br>\n    [tryResolve] <span aria-label=\"boom\" class=\"emoji emoji-1f4a5\" role=\"img\" title=\"boom\">:boom:</span> ValuationAlgebras.Domain Φ ?m.9227 ≟ ValuationAlgebras.Domain Φ s </p>\n</div></div>",
        "id": 403460748,
        "sender_full_name": "N Gelwan",
        "timestamp": 1700600047
    },
    {
        "content": "<ol>\n<li>It does fail, but it only shows one error</li>\n</ol>",
        "id": 403461372,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1700600398
    },
    {
        "content": "<p>Why not <code>[inst : Domain Φ s]</code>?</p>",
        "id": 403479451,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1700609289
    },
    {
        "content": "<p>Oh yeah, sorry-- no reason. That was an artifact from some earlier experiments. Changing it doesn't make a difference.</p>",
        "id": 403509463,
        "sender_full_name": "N Gelwan",
        "timestamp": 1700623368
    },
    {
        "content": "<p>It doesn't even make a difference to the traces?? Are the traces from before or after this change?</p>",
        "id": 403656724,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1700682798
    }
]