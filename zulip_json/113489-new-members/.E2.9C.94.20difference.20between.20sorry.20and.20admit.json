[
    {
        "content": "<p>Could you explain a little bit on why we have two tactics, <code>sorry</code> and <code>admit</code>, in tactic mode, to temporarily accept any axiom? What is the difference between them? I feel like the documentation doesn't explain this.</p>\n<p>I know that besides tactic mode, <code>sorry</code> is also a valid placeholder in term mode, while <code>admit</code> is not.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"c1\">-- ok</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">-- ok. Mouseover: A temporary placeholder for a missing proof or value.</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">admit</span><span class=\"w\"> </span><span class=\"c1\">-- unknown identifier 'admit'</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">admit</span><span class=\"w\"> </span><span class=\"c1\">-- Mouseover: admit is a shorthand for exact sorry.</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Mouseover:</span>\n<span class=\"cm\">The sorry tactic closes the goal using sorryAx.</span>\n<span class=\"cm\">This is intended for stubbing out incomplete parts of a proof</span>\n<span class=\"cm\">while still having a syntactically correct proof skeleton.</span>\n<span class=\"cm\">Lean will give a warning whenever a proof uses sorry,</span>\n<span class=\"cm\">so you aren't likely to miss it,</span>\n<span class=\"cm\">but you can double check if a theorem depends on sorry</span>\n<span class=\"cm\">by using #print axioms my_thm</span>\n<span class=\"cm\">and looking for sorryAx in the axiom list.</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 455680197,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722525973
    },
    {
        "content": "<p>There's no real difference. I'm not sure why both exist</p>",
        "id": 455681612,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722526284
    },
    {
        "content": "<p>It seems they're absolutely the same thing.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"sorry\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">sorryAx</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- `admit` is a shorthand for `exact sorry`. -/</span>\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"admit\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">sorryAx</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 455682396,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1722526443
    },
    {
        "content": "<p>in every aspect other than the docstring</p>",
        "id": 455682834,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1722526558
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/stream/113489-new-members/topic/difference.20between.20.60sorry.60.20and.20.60admit.60/near/455682834\">said</a>:</p>\n<blockquote>\n<p>in every aspect other than the docstring</p>\n</blockquote>\n<p>The name also... <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 455688194,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722528014
    },
    {
        "content": "<p>In that case, how about removing one of them (probably <code>admit</code>)? There's a lot of things that beginners need to learn where some have subtile differences while others are exactly the same...</p>",
        "id": 455731748,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722538438
    },
    {
        "content": "<p><code>admit</code> goes way back. I'm not sure there's any reason it's still around other than inertia. Feel free to file a Lean 4 issue suggesting to remove <code>admit</code></p>",
        "id": 455758424,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722547084
    },
    {
        "content": "<p>⠀</p>",
        "id": 455779106,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722556646
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- TODO: make extensible, or don't</span>\n<span class=\"sd\">/-- Keywords for which a specific semantic token is provided. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">keywordSemanticTokenMap</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">RBMap</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">SemanticTokenType</span><span class=\"w\"> </span><span class=\"n\">compare</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">RBMap</span><span class=\"bp\">.</span><span class=\"n\">empty</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"s2\">\"sorry\"</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">leanSorryLike</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"s2\">\"admit\"</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">leanSorryLike</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"s2\">\"stop\"</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">leanSorryLike</span>\n<span class=\"w\">    </span><span class=\"bp\">|&gt;.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"s2\">\"#exit\"</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">leanSorryLike</span>\n</code></pre></div>",
        "id": 455779137,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722556669
    },
    {
        "content": "<p>I did a text search with ripgrep and found this line in this file.</p>\n<p>~/.elan/toolchains/leanprover--lean4---v4.9.0-rc2/src/lean/Lean/Server/FileWorker/RequestHandling.lean</p>",
        "id": 455779315,
        "sender_full_name": "Deming Xu",
        "timestamp": 1722556759
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"740877\">Deming Xu</span> has marked this topic as resolved.</p>",
        "id": 455781396,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722557634
    },
    {
        "content": "<p>GitHub issue RFC for deprecating <code>admit</code>: <a href=\"https://github.com/leanprover/lean4/issues/4901\">https://github.com/leanprover/lean4/issues/4901</a></p>",
        "id": 455972779,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722614323
    },
    {
        "content": "<p>After some positive feedback, I opened a <a href=\"https://github.com/leanprover/lean4/pull/4908\">PR</a> to deprecate the macro. <strong>Unfortunately, this does not work</strong> (no deprecation message is shown on use). How does one deprecate a macro?</p>",
        "id": 456317994,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722776839
    },
    {
        "content": "<p>I would make the macro log the deprecation and then call <code>sorry</code>.</p>",
        "id": 456319876,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1722778087
    },
    {
        "content": "<p>Thanks! I still can't do it though (need to read the metaprograming book, I guess...). Why does this not compile and how to fix it?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"admittt\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"WARNING\"</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">sorryAx</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 456371246,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722796649
    },
    {
        "content": "<p>You likely want</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"admittt\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"WARNING\"</span>\n<span class=\"w\">    </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">admittt</span>\n</code></pre></div>",
        "id": 456371443,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722796709
    },
    {
        "content": "<p>Your code doesn't work because <code>logWarning</code> is not a tactic</p>",
        "id": 456371583,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722796762
    },
    {
        "content": "<p>This would also work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"admittt\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">run_tac</span><span class=\"w\"> </span><span class=\"n\">logWarning</span><span class=\"w\"> </span><span class=\"s2\">\"WARNING\"</span>\n<span class=\"w\">     </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">sorryAx</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 456372566,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1722797331
    },
    {
        "content": "<p>Ok, that works, thanks.</p>\n<p>Unfortunately, all of <code>logWarning</code>, <code>evalTactic</code> and <code>run_tac</code> are not available at the point where <code>admit</code>, which I'm trying to deprecate, is defined. Maybe I could move it to a later point or different file? Very unsure what to do here.</p>\n<p>It seems like the task \"deprecate admit\" might be too big for me...</p>",
        "id": 456480111,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722847225
    },
    {
        "content": "<p>Still haven't implemented the deprecation. However, the first reviewer of the <a href=\"https://github.com/leanprover/lean4/issues/4901\">PR</a> has doubts if removing is motivated. <br>\nThe deprecation will not happen unless some of the people here (\"educators\" in particular, which I cannot claim to be) argue for it. I'm not sure who here is an educator, at least <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> indicated support for deprecation here?</p>\n<p>One argument given there against deprecation is that having <code>admit</code> is good for people who come from other provers that have <code>admit</code>. I personally think that given how ubiquitous <code>sorry</code> is, we definitely expect \"new people\" to learn it, rather than having <code>sorry</code> vs <code>admit</code> be a question of style or indicating which other theorem provers someone uses...</p>",
        "id": 459512164,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1723219123
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"638715\">@Adomas Baliuka</span> For Lean core RFCs, you don't need to make a reference implementation (and the core developers might want to implement it in a different way, so you might even say it's discouraged-by-default). Even if an RFC has community support, that doesn't mean the core developers will accept it.</p>\n<p><a href=\"https://github.com/leanprover/lean4/blob/master/CONTRIBUTING.md\">https://github.com/leanprover/lean4/blob/master/CONTRIBUTING.md</a></p>\n<p>The current status is that Sebastian would like to hear from educators to improve the RFC. You don't have to feel responsible for getting the RFC accepted, and it's plenty helpful just having the RFC in the issue tracker (thanks!), but if you are motivated you could try collecting feedback more widely about whether having <code>admit</code> point users to <code>sorry</code> would be helpful.</p>",
        "id": 459516090,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723220261
    },
    {
        "content": "<p>Or: in the meantime you could make a contribution to mathlib, introducing a linter for <code>admit</code>, where I'm sure it would be welcome. Maybe <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> might be interested? If this is successful, then potentially this linter could eventually be upstreamed to core, emphasis on eventually.</p>",
        "id": 459516095,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723220262
    },
    {
        "content": "<p>Such a linter would be very easy to write: I am happy to write it, or, if <span class=\"user-mention\" data-user-id=\"638715\">@Adomas Baliuka</span> wants to try it, feel free to do so!  If you want some guidance to write the linter, it would likely be a very straightforward modification of the <code>refineLinter</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.Linter.refine.refineLinter#doc\">docs#Mathlib.Linter.refine.refineLinter</a>).</p>",
        "id": 459519146,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723221113
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>  There doesn't seem to be a syntax (parser) for <code>admit</code> (also not for <code>sorry</code>).</p>\n<p>For <code>refine'</code>,  its usage is <a href=\"https://github.com/leanprover-community/mathlib4/blob/6a9aca0a5a11df04f3e97930d9ee7fc9d7a8827c/Mathlib/Tactic/Linter/RefineLinter.lean#L36\">checked for</a> using the \"ParserDescr\" <code> ``Lean.Parser.Tactic.refine'  </code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `getadmit t` returns all usages of the `admit` tactic in the input syntax `t`. -/</span>\n<span class=\"n\">partial</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">getadmit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Syntax</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"bp\">@</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rargs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">args</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">getadmit</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flatten</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"ss\">``Lean.Parser.Tactic.refine'</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">rargs</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">rargs</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">default</span>\n</code></pre></div>",
        "id": 459668502,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1723284314
    },
    {
        "content": "<p>I made a new parser and it seems to work, see <a href=\"https://github.com/leanprover-community/mathlib4/pull/15667\">Mathlib PR</a>. However, I'm not sure if it makes sense to \"overload\" the syntax like this</p>",
        "id": 459670568,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1723285237
    },
    {
        "content": "<p>I left a few (minor) comments. A test would be nice; the parser question looks like the only real question to me (everything else is easy to address or can be a future PR).</p>",
        "id": 459673801,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723286409
    },
    {
        "content": "<p>Also: thanks for writing a linter - it's great to have more people doing this! I learned <em>most</em> of my linter writing skills (which are still limited/I'm learning something new with every project) by asking, so feel free to ask!</p>",
        "id": 459673887,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1723286465
    },
    {
        "content": "<p>Adomas, I think that you can use <code>Lean.Parser.Tactic.tacticAdmit</code> when you scan for the appropriate <code>SyntaxNodeKind</code>.</p>",
        "id": 459714632,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723304121
    },
    {
        "content": "<p>You can do \"go to declaration\" on the <code>admit</code> tactic to get to the macro in core, and then if you hover over <code>macro</code> it shows the syntax kind <code>Lean.Parser.Tactic.tacticAdmit</code> that Damiano mentions.</p>",
        "id": 459721923,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1723306822
    }
]