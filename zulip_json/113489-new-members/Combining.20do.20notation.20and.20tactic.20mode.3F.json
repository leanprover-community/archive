[
    {
        "content": "<p>Is it possible to use do notation in tactic mode?</p>\n<p>I have a few functions that a) take some proofs as input and b) return a state monad. I'd like to use the <code>refine</code> tactic so I can call the function whilst providing the required proofs later, but it doesn't look like I can use <code>do</code> and <code>by</code> in the same block. Which means I have to manually thread the state through each function, which gets quite finicky. </p>\n<p>Is it possible to use tactics and do notation in the same block? If not, what would be the best way to thread a state through a series of computations in a <code>by</code> tactic block?</p>",
        "id": 501405173,
        "sender_full_name": "aron",
        "timestamp": 1740340455
    },
    {
        "content": "<p><code>exact</code> takes you back into term mode and presumably you can use <code>do</code> there</p>",
        "id": 501405248,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740340539
    },
    {
        "content": "<p>ah nice, yeah that worked!<br>\n<a href=\"/user_uploads/3121/PlqSJMLzLxcUFp-WeIlD6nBC/Screenshot-2025-02-23-at-20.10.13.png\">Screenshot 2025-02-23 at 20.10.13.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/PlqSJMLzLxcUFp-WeIlD6nBC/Screenshot-2025-02-23-at-20.10.13.png\" title=\"Screenshot 2025-02-23 at 20.10.13.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"851x867\" src=\"/user_uploads/thumbnail/3121/PlqSJMLzLxcUFp-WeIlD6nBC/Screenshot-2025-02-23-at-20.10.13.png/840x560.webp\"></a></div>",
        "id": 501406382,
        "sender_full_name": "aron",
        "timestamp": 1740341443
    },
    {
        "content": "<p>Watch out though; using tactics like <code>rw</code> when you're defining functions like this can cause them to be difficult to prove things about, or cause them to not be reducible (causing <code>rfl</code> or <code>decide</code> to fail for example).</p>\n<p>It would be better to stay in term mode, and put the rewrites inside the <code>have</code>s (which are still valid in term mode). This keeps the casts that <code>rw</code> produces inside the proofs, where they won't cause any trouble.</p>",
        "id": 501406914,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740341919
    },
    {
        "content": "<p>is there a way to do that without duplicating these 4 lines at the top that are used in the definitions of both <code>okUnif</code> and <code>errUnif</code>?<br>\n<a href=\"/user_uploads/3121/d8lOYYK2ppJ_jpZB8XR-EiYO/Screenshot-2025-02-23-at-20.21.19.png\">Screenshot 2025-02-23 at 20.21.19.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/d8lOYYK2ppJ_jpZB8XR-EiYO/Screenshot-2025-02-23-at-20.21.19.png\" title=\"Screenshot 2025-02-23 at 20.21.19.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"684x554\" src=\"/user_uploads/thumbnail/3121/d8lOYYK2ppJ_jpZB8XR-EiYO/Screenshot-2025-02-23-at-20.21.19.png/840x560.webp\"></a></div>",
        "id": 501407213,
        "sender_full_name": "aron",
        "timestamp": 1740342134
    },
    {
        "content": "<p>You could put each rewrite into the corresponding <code>have</code>, like <code>have prf1_empty := by rw [...]; exact ...</code></p>",
        "id": 501407522,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740342405
    }
]