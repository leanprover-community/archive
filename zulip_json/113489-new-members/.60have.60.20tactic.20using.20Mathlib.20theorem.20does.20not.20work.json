[
    {
        "content": "<p>Hi, newbie here.</p>\n<p>In a Lean 4 program of mine, I have a hypothesis <code>he</code> of type <code>Even n'</code>, and I'm trying to get a hypothesis of type <code>(-1)^n' = 1</code> using a Mathlib lemma: <code>have hm1n := Even.neg_one_pow he</code> (don't mind the horrible naming schemes), however the hypothesis <code>hm1n</code> does not appear in the infoview.</p>\n<p>Trying <code>have hm1n : ((-1)^n' = 1) := by exact Even.neg_one_pow he</code> to get more output, I get a <code>Type mismatch</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"n\">Even</span><span class=\"bp\">.</span><span class=\"n\">neg_one_pow</span><span class=\"w\"> </span><span class=\"n\">he</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">-@</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">76</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">One</span><span class=\"bp\">.</span><span class=\"n\">toOfNat1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">-@</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">instOfNat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>Any help?</p>\n<p>Edit: In case it may be relevant, I <em>do</em> think I have all the relevant  imports:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Init</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Parity</span>\n</code></pre></div>",
        "id": 544470303,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760338270
    },
    {
        "content": "<p>Try <code>(-1 : ℤ)</code>.</p>",
        "id": 544472949,
        "sender_full_name": "suhr",
        "timestamp": 1760339208
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"394485\">@suhr</span> Error message is unchanged</p>",
        "id": 544473227,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760339293
    },
    {
        "content": "<p>Then <code>Even.neg_one_pow (α := ℤ) he</code>.</p>",
        "id": 544473574,
        "sender_full_name": "suhr",
        "timestamp": 1760339404
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n</code></pre></div>\n<p>Huh... a missing import perhaps? ...Oh! I think I know</p>",
        "id": 544473867,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760339498
    },
    {
        "content": "<p>Nevermind... importing the <code>Int</code> type didn't do anything. But it definitely feels like a missing import - I need to find where in mathlib it says that Z is a monoid</p>",
        "id": 544474385,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760339691
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Int/Defs.html#Int.instMonoid\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Int/Defs.html#Int.instMonoid</a></p>",
        "id": 544474627,
        "sender_full_name": "suhr",
        "timestamp": 1760339769
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"394485\">@suhr</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">HasDistribNeg</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n</code></pre></div>\n<p>Should I just import all of Mathlib at this point? I still don't know if it's best practice to import the whole thing or exactly what you need</p>",
        "id": 544474899,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760339866
    },
    {
        "content": "<p>Can't help you with that, I do not know Mathlib very well. That I know though is that inference chains in Mathlib can be long.</p>",
        "id": 544476151,
        "sender_full_name": "suhr",
        "timestamp": 1760340299
    },
    {
        "content": "<p>You can import the whole of Mathlib while you work and afterwards run <code>#min_imports</code> which tells you (mostly) which files you need. (Exceptions for some tactics or notations whose files you may have to add manually).</p>",
        "id": 544478868,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1760341102
    },
    {
        "content": "<p>(what Johannes said)</p>",
        "id": 544479532,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760341278
    },
    {
        "content": "<p>Also: at this point, an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> (this links to a webpage) would be very helpful.</p>",
        "id": 544501094,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760347305
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"619540\">@Johannes Tantow</span> Where do I run <code>#min_imports</code>? It doesn't seem like a command-line command (and, if it is, it doesn't seem like the full command)</p>",
        "id": 544557230,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760362988
    },
    {
        "content": "<p>Last line in your file.</p>",
        "id": 544557357,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1760363025
    },
    {
        "content": "<p>When I write <code>import Mathlib</code>, the infoview takes ages to update. Am I supposed to run <code>lake update</code> and <code>lake build</code> (which both take ages to run as well) every time I start VSCode anew?</p>",
        "id": 544558110,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363231
    },
    {
        "content": "<blockquote>\n<p>Last line in your file.</p>\n</blockquote>\n<p>Oh, alright</p>",
        "id": 544558211,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363262
    },
    {
        "content": "<p>you're supposed to run <code>lake exe cache get</code> once which downloads a compiled version of mathlib, and you won't have to run anything anymore anywhere anytime</p>",
        "id": 544558256,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760363275
    },
    {
        "content": "<p>Well I ran <code>lake update</code> and <code>lake build</code> several times and I read that <code>lake update</code> executes <code>lake exe cache get</code> (which can be seen in the console output as well). Still, it takes a rather long time</p>",
        "id": 544558588,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363365
    },
    {
        "content": "<p>as long as it doesn't say \"building etc.\" on the infoview then you can just wait for a bit</p>",
        "id": 544558662,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760363393
    },
    {
        "content": "<p><code>No info found.</code> is all I see</p>",
        "id": 544558747,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363412
    },
    {
        "content": "<p>The wait time at the start is bareable but the wait time whenever I type pretty much anything into my file kinda ruins it</p>",
        "id": 544559005,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363478
    },
    {
        "content": "<p>I wish there was more output. It's hard to keep patience when it says something like <code>idk just computing stuff ig</code> for tens of minutes</p>",
        "id": 544559291,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363547
    },
    {
        "content": "<p>And right as I say that it just works... idk man Imma just call it \"computer aura\" at this point. Better to go superstitious than go crazy with this kind of stuff...</p>",
        "id": 544560153,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760363780
    },
    {
        "content": "<p>Huh, seems like I finally managed to finish the theorem... With absolutely horrendous code.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">q1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1g</span><span class=\"o\">,</span><span class=\"n\">q1d</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1g</span><span class=\"o\">,</span><span class=\"n\">q1d</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hn</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1d</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">heo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">even_or_odd</span><span class=\"w\"> </span><span class=\"n\">n'</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">heo</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">he</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">even_iff_exists_two_mul</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">he</span>\n<span class=\"w\">      </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"n\">h</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"n\">pow_add</span><span class=\"o\">,</span><span class=\"n\">pow_add</span><span class=\"o\">,</span><span class=\"n\">pow_add</span><span class=\"o\">,</span><span class=\"n\">pow_one</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">ring</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">ho</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h2p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"bp\">.</span><span class=\"n\">exists_bit1</span><span class=\"w\"> </span><span class=\"n\">ho</span>\n<span class=\"w\">      </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">h2p</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"n\">h</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_add</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_one</span><span class=\"o\">,</span><span class=\"n\">pow_mul</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>Here it is in case anyone wants to read and comment (and I'm sure there's plenty of comments to be had)</p>",
        "id": 544563010,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760364563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"971939\">Labyrinth</span> <a href=\"#narrow/channel/113489-new-members/topic/.60have.60.20tactic.20using.20Mathlib.20theorem.20does.20not.20work/near/544558747\">said</a>:</p>\n<blockquote>\n<p><code>No info found.</code> is all I see</p>\n</blockquote>\n<p>Which version of the VS Code extension are you using?<br>\nThere was a bug in 0.0.213 and 0.0.214 of the extension where it would sometimes display stale messages and not update properly, especially e.g. when building imports.</p>",
        "id": 544563646,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1760364710
    },
    {
        "content": "<p>PS: I'm aware of <code>Even.neg_one_pow</code> and the likes, however after struggling to not have it throw a bunch of errors I had issues with <code>-1</code>'s being <code>Int</code> in the theorem and <code>Rat</code> where I needed them, so I just gave up and rewrote the whole thing</p>",
        "id": 544563731,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760364731
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"221921\">@Marc Huisinga</span> 0.0.215. Was 0.0.214 recently the latest version? That would explain my past experiences</p>",
        "id": 544564108,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760364837
    },
    {
        "content": "<p>Yep, 0.0.214 was the latest version recently (and it sometimes takes a while until extension updates make it to all machines anyways)</p>",
        "id": 544564291,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1760364876
    },
    {
        "content": "<p>According to GitHub:<br>\n0.0.215: 2 weeks ago<br>\n0.0.214: 3 weeks ago<br>\n0.0.213: 3 weeks ago<br>\n0.0.212: last month</p>\n<p>So right around the time I started learning Lean... dang, guess I got sniped.</p>\n<p>Though I doubt that Lean 4 is at all fast for me now</p>",
        "id": 544565042,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760365027
    },
    {
        "content": "<p>(I'd take a slow interpreter over Coq's documentation any day)</p>",
        "id": 544565112,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760365047
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">q1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1g</span><span class=\"o\">,</span><span class=\"n\">q1d</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1g</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">reduceNeg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">cast_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">cast_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_one</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n\n<span class=\"bp\">#</span><span class=\"n\">min_imports</span>\n</code></pre></div>\n<p>This is shorter.</p>",
        "id": 544565423,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1760365138
    },
    {
        "content": "<p>WOW, okay... I see now...</p>\n<p>A bit of a long way to go until I can consider myself anywhere near proficient in the language...</p>",
        "id": 544565759,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760365215
    },
    {
        "content": "<p>Its essentially that you can often combine <code>rw</code>/<code>simp</code> tactics that follow each other or even use <code>simp</code> instead of <code>rw</code> to make it shorter. Than there was only this arithmetic expression and I just tried <code>ring</code>.</p>",
        "id": 544567370,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1760365654
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"619540\">@Johannes Tantow</span> I can't find documentation on <code>Int.reduceNeg</code> (the Mathlib docs just say <code>One or more equations did not get rendered due to their size.</code>), and the source code seems way above my level. How can I figure out what this is?</p>",
        "id": 544568290,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760365896
    },
    {
        "content": "<p>On a sidenote, those <code>cast</code>theorems seem really useful - those up arrows were contributing to me going mad</p>",
        "id": 544568771,
        "sender_full_name": "Labyrinth",
        "timestamp": 1760366019
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">q1g</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>is better (IMO) for the <code>succ</code> case -- why get tied up with cast lemmas when the simplifier can do it all for you?</p>",
        "id": 544571624,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760366817
    },
    {
        "content": "<p>I don't know what these theorems say without looking them up. I wrote <code>simp?[hn, q1d, q1g]</code> to squeeze a non-terminal simp and replace it with Leans output.</p>",
        "id": 544571741,
        "sender_full_name": "Johannes Tantow",
        "timestamp": 1760366854
    },
    {
        "content": "<p>You don't need to squeeze if you're doing <code>ring</code> afterwards, at least according to the mathlib style guide.</p>",
        "id": 544571929,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760366923
    },
    {
        "content": "<p>This didn't used to be the case but now there is some more complex set-up with \"flexible\" and \"rigid\" tactics, and basically after <code>simp</code> you can't go back to <code>rw</code> but you can use even more high-powered stuff like <code>ring</code>.</p>",
        "id": 544572083,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760366976
    },
    {
        "content": "<p>Mathlib style would also say</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">q1g</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1d</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>Why use <code>(-1 : Int)</code>? There is no Int in sight.</p>",
        "id": 544572468,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760367096
    },
    {
        "content": "<p>Can I also recommend</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">q1s</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">i</span><span class=\"bp\">^</span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>rather than all this <code>match</code> stuff (which also indicates that your definitions also make sense for -1).</p>",
        "id": 544572811,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760367207
    }
]