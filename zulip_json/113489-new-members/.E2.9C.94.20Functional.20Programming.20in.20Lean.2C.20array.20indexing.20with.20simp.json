[
    {
        "content": "<p>I am working through the book \"Functional Programming in Lean\". In this book (for instance <a href=\"https://lean-lang.org/functional_programming_in_lean/props-proofs-indexing.html\">here</a> evidence that an array index is in bounds is able to be provided by <code>simp</code>, but in my installation and the Lean 4 Web version, this is not the case. An exeprt from the link...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"hedgehog\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"deer\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"snail\"</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>... the third line fails with the goal unsatisfied. The following fails the same <br>\n.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>What does work is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"bp\">.</span><span class=\"n\">length</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">third</span><span class=\"w\"> </span><span class=\"n\">woodlandCritters</span><span class=\"w\"> </span><span class=\"n\">ok</span>\n</code></pre></div>\n<p>Has something changed in Lean where <code>simp</code> can no longer do the above? What is the intended way of providing the necessary evidence for array lookup?</p>",
        "id": 492416577,
        "sender_full_name": "Mark Eastwood",
        "timestamp": 1736298574
    },
    {
        "content": "<p>I am not exactly sure what change caused the code to no longer work, but the basic issue is that <code>simp</code> cannot see through the definition of <code>woodlandCritters</code> because it is not reducible (<a href=\"https://proofassistants.stackexchange.com/questions/2457/what-is-the-precise-meaning-of-reducible\">https://proofassistants.stackexchange.com/questions/2457/what-is-the-precise-meaning-of-reducible</a>). One way to fix it is to put <code>@[reducible]</code> before the definition of <code>woodlandCritters</code> so <code>simp</code> can see through the definition. Another way, which is probably better for this example, is to use <code>decide</code> instead of <code>simp</code>.</p>",
        "id": 492419751,
        "sender_full_name": "Mitchell Lee",
        "timestamp": 1736300650
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814107\">Mark Eastwood</span> has marked this topic as resolved.</p>",
        "id": 492427340,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736306300
    },
    {
        "content": "<p><code>decide</code> does the trick <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> Awesome,  thanks!</p>",
        "id": 492427421,
        "sender_full_name": "Mark Eastwood",
        "timestamp": 1736306382
    },
    {
        "content": "<p>The change was <a href=\"https://github.com/leanprover/lean4/pull/2722\">lean4#2722</a>, way back in v4.3.0. You can locally restore the old behavior with <code>simp +decide</code>.</p>",
        "id": 493466081,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1736808261
    }
]