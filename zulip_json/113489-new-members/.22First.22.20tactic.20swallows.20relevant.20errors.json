[
    {
        "content": "<p>Hello everyone.</p>\n<p>I'm working on some uses of Lean that involve an potentially large number of relatively simple goals. I often try to use tactics like \"all_goals\" with tactics that may work for some goals but not others. Accordingly, I try using \"any_goals\", or \"all_goals try\", or \"all_goals first\", but I've noticed some unexpected swallowing of errors with these tactics.</p>\n<p>Here's a silly example for reference. (Let's pretend we couldn't just use \"trivial\" to solve all goals here, almost straight away.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">IntervalCases</span>\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"n\">first</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"w\"> </span><span class=\"c1\">-- Goals accomplished ðŸŽ‰</span>\n</code></pre></div>\n<p>Now, if I'd made a simple error inside the first block:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">IntervalCases</span>\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"n\">first</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">nonexistent_hypothesis</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>\n<p>The only error I get is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">â–¼</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"bp\">-</span><span class=\"mi\">104</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span>\n<span class=\"bp\">'</span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">nonexistent_hypothesis'</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedTactic</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n\n<span class=\"bp\">â–¼</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">:</span><span class=\"mi\">38</span><span class=\"bp\">-</span><span class=\"mi\">104</span><span class=\"o\">:</span><span class=\"mi\">44</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span>\n<span class=\"bp\">'</span><span class=\"n\">decide'</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedTactic</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>The usual error I would expect in this scenario is <code>unknown identifier 'nonexistent_hypothesis'</code>. Unfortunately, first seems to swallow this error, only implying it with this warning.</p>\n<p>I understand this is a silly example. My question is mainly about the error swallowing behaviour of \"first\" (and \"try\", whose implementation I see derived from \"first\"). Is this intrinsically related to its \"backtracking\" functionality?</p>\n<p>I note that logs are also swallowed in branches that fail, such as produced by <code>run_tac Lean.logInfo \"Hello\"</code>. This makes a certain amount of sense, as I assume side-effects like logging are not executed immediately and  may therefore be eliminated if a state is \"backtracked\". However, this seems unfortunate for development purposes.</p>\n<p>I hope my example is not too contrived and using Lean in the \"right way\". I'm very much a beginner.</p>",
        "id": 535893569,
        "sender_full_name": "David Wood",
        "timestamp": 1756030109
    },
    {
        "content": "<p>I think the issue is that lean can't really tell the difference between \"tactic didn't prove the goal in an expected way\" and \"tactic failed in a way that indicates user error\"</p>",
        "id": 535897786,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756036593
    },
    {
        "content": "<p>Maybe one of the subgoals could have had a <code>nonexistent_hypothesis</code></p>",
        "id": 535897838,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756036649
    },
    {
        "content": "<p>Right, I see. With no simple way to discriminate one sort of error from another, I see how using these tactics could inevitably sacrifice ALL possible error checking (besides this one universal rule that warns against tactics doing nothing at all).</p>",
        "id": 535899246,
        "sender_full_name": "David Wood",
        "timestamp": 1756038361
    },
    {
        "content": "<p>Though that would seem to make it undesirable to ever use such tactics, outside of very limited contexts where the range of possible user errors are limited. Perhaps that still includes a lot of scenarios, given how many tactics are fully automated and require no user input (not even an identifier which could be mis-typed, etc).</p>",
        "id": 535899492,
        "sender_full_name": "David Wood",
        "timestamp": 1756038599
    },
    {
        "content": "<p>I have a feeling I am misusing the tactic language by expecting a portion of my proof to actually \"compute\" results with conditional logic, etc.</p>",
        "id": 535900509,
        "sender_full_name": "David Wood",
        "timestamp": 1756039871
    },
    {
        "content": "<p>This is working as designed. In <code>first</code>, it turns off error-recovery mode on each branch but the last. In fact, <code>first</code> completely backtracks the entire tactic state on each error, log messages included. I believe <code>dbg_trace</code> messages might still get through?</p>\n<p>Like Ruben said, there's no way for a tactic to know whether <code>absurd nonexistent_hypothesis</code> could make sense in some goal or not. Note that you will still get parser errors. It's just the errors from evaluation that get consumed.</p>\n<p>The \"tactic does nothing\" linter warnings aer a mathlib feature by the way, just to be clear. That's kind of nice that it gives feedback that one of the <code>first</code> branches doesn't ever apply. Maybe that's basically an answer to your question? That, despite the fact that <code>first</code> will consume errors, you still learn that there <em>might</em> be a mistake.</p>\n<p>I think <code>first</code> is usually a \"code smell\" in tactic proofs. It's better if it's used in a well-defined macro that serves a particular somewhat-general purpose. Using it in ad hoc proofs though becomes something that's not the most maintainable.</p>",
        "id": 535909658,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756049957
    },
    {
        "content": "<p>I know you said this was a silly example, but it also demonstrates that there might be more general approaches than trying to do case analysis:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n</code></pre></div>\n<p>(The <code>intro</code>/<code>revert</code> ended up putting the goal into a form where there's an existing <code>Decidable</code> typeclass. Then it's a \"proof-by-reflection\", via <code>decide</code>.) Likely that doesn't work for your actual case.</p>",
        "id": 535909795,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756050094
    },
    {
        "content": "<p>Ok, sounds like I should indeed avoid using \"first\" and \"try\" like this. </p>\n<p>I think I need to learn more about decidability.  It's remarkable to me that such a complicated proposition as this meets the criteria:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- Goals accomplished ðŸŽ‰</span>\n</code></pre></div>\n<p>With a little digging, I can discover the instances used.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">)</span>\n<span class=\"c1\">-- â–¼ 146:1-146:7: information:</span>\n<span class=\"c1\">-- @decide (âˆ€ {x : â„•}, 50 â‰¤ x â†’ x â‰¤ 55 â†’ Even x â†’ x = 50 âˆ¨ x = 52 âˆ¨ x = 54)</span>\n<span class=\"c1\">-- (Nat.decidableLoHiLe 50 55 fun x =&gt; Even x â†’ x = 50 âˆ¨ x = 52 âˆ¨ x = 54) : Bool</span>\n</code></pre></div>\n<p>That explains why a proposition in a certain range of values is decidable. I had to separately interrogate the instance for the embedded \"Even\" prop:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">)</span>\n<span class=\"c1\">-- @decide (Even 52) (Nat.instDecidablePredEven 52) : Bool</span>\n</code></pre></div>\n<p>Maybe there's a more direct method to obtain this information. Anyway, I've learned something.</p>",
        "id": 535916797,
        "sender_full_name": "David Wood",
        "timestamp": 1756058762
    },
    {
        "content": "<p>For educational purposes, I've been trying to make the reasoning in my proofs explicit and simple to understand, and therefore avoiding a lot of the really high-powered tactics.</p>\n<p>To prove something about a finite set of values, looking at each individual case seemed like the most understandable way to proceed, as long as I had some way to address an aggregate of cases at once in a consistent way.</p>",
        "id": 535917782,
        "sender_full_name": "David Wood",
        "timestamp": 1756059816
    },
    {
        "content": "<p>That's reasonable, but I think it's worth asking whether <code>first</code> helps meet the goal, since it gives no indication what reasoning was actually done, just that one of the tactics in the list succeeded.</p>",
        "id": 535919473,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756061479
    },
    {
        "content": "<p>Using <code>try</code> is pretty common for trying to close a lot of trivial goals. At least you know that everything that was closed was handled by the <code>try</code>.</p>\n<p><code>interval_cases</code> is fine too. Using <code>decide</code> for an interval like this isn't necessarily better than an explicit case analysis. The <code>decide</code> tactic can also be a bit brittle, because it depends on whatever instances are available, and hopefully they're efficient to evaluate.</p>",
        "id": 535919564,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756061576
    },
    {
        "content": "<p>It's common to see <code>&lt;;&gt;</code> instead of <code>all_goals</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">IntervalCases</span>\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">contradiction</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>This is basically the same as using <code>first</code>, but somehow I find it explains that \"first we get rid of all goals that have a straightforward contradiction, and then we do the main argument\".</p>\n<p>There are a number of ways to organize these things too. It's hard to say more about a toy example though.</p>",
        "id": 535919880,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756061886
    },
    {
        "content": "<p>Presumably <code>try</code> will still swallow user errors like typos? I think I've been spoiled coming from a traditional programming background where there's a lot of guardrails to keep us code-monkeys from hurting ourselves.</p>",
        "id": 535920354,
        "sender_full_name": "David Wood",
        "timestamp": 1756062371
    },
    {
        "content": "<p>You'll get syntax errors, but correct, <code>try</code> consumes errors from tactic evaluation. How's it supposed to know what you'd consider to be a typo?</p>\n<p>Re other languages, you should put this on the same conceptual level as C++ template metaprogramming. You're using <code>requires</code> in a <code>constexpr</code>. If you don't want to effectively do a compile-time check that the tactic code is valid, then you can handle every case manually.</p>",
        "id": 535921822,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756064134
    },
    {
        "content": "<p>The Mathlib unused tactic warning is a nice guardrail here, one you wouldn't see in other languages.</p>\n<p>While I think it's important to recognize that fundamentally <code>try</code>/<code>first</code> use errors to determine whether they should backtrack (so not reporting those errors is an essential part of their functionality), I do get where you're coming from that it makes it annoying to work with them in \"interactive mode\" â€” informally, that's when you're writing tactics manually in a proof script, rather than in a macro. If there were a formal concept of interactive mode, <code>try</code> and <code>first</code> could surface their errors as informational messages somehow. You'd want it to be unobtrusive, without lots of squiggles everywhere, but maybe there's some LSP protocol that could work. I find it hard to imagine what the editor interaction would be though... It would be noisy, since it would have to show the errors even for cases you don't consider to be typos.</p>",
        "id": 535922340,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756064654
    },
    {
        "content": "<p>Thanks for explaining. Maybe I need to think about writing my own macros eventually. In this example, it actually looks easy enough to address the cases I need fairly directly. If I write them out: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">50</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">51</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">52</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">53</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">54</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">55</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Obviously, if the interval were larger this would be quite awkward, but in this form it's also easy to see how a simple macro could match the pattern of the goal namesâ€”maybe by focusing on every 2-nth goal, or extracting the number in the goal name and actually deciding if it meets a predicate like \"Even\".</p>\n<p>I assume the goal names you typically get in case analysis are not as meaningful and \"pattern-matchable\" as this, but maybe I can still discover some ways to generalize. I've had some trouble in general with keeping my goals and synthetic metavariables in an easily readable and addressable state, with decent labels, etc.</p>\n<p>Generally, I will bear in mind that the tactic language is very low level and macro-based.</p>",
        "id": 535984316,
        "sender_full_name": "David Wood",
        "timestamp": 1756112885
    },
    {
        "content": "<p>I wouldn't recommend pattern matching goal names â€”Â that sounds fragile. Since you used <code>hx:</code> syntax, you have an equation in each goal that you can use, but still, this isn't something people really do.</p>\n<blockquote>\n<p>I will bear in mind that the tactic language is very low level and macro-based.</p>\n</blockquote>\n<p>This isn't what I was trying to get across. People usually use high-level tactics, and most aren't macros. Custom ad hoc macros are fairly rare. When you say \"coming from a traditional background where there's a lot of guardrails\", I'm trying to say that you should keep in mind that <code>try</code> is a pretty advanced feature that those languages don't generally have. The equivalent guardrail would be not having <code>try</code> at all, or hiding it behind some scarier features. In Lean it's just not a big deal to tentatively try a tactic and backtrack the state on failure, so it makes it available as a core feature.</p>\n<p>Maybe you mean 'macros' in another sense, maybe metaprogramming in general. If you want, the tactic language is language run at compile time to generate code (with that Curry-Howard correspondence, proofs and programs are treated in the same way, and both are code). I push back on 'macro' since that usually means some purely syntactic transformation. Tactics build expression trees with full knowledge of all the types of everything. They're integrated into compilation itself, in a sense. (In particular, they're part of the \"elaboration\" step.)</p>",
        "id": 536066218,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756140481
    },
    {
        "content": "<p>Generally proofs try to take advantage of some structure. The interesting thing in your example is that Even means that you want to skip every other number. That can be represented as introducing a new variable <code>x'</code> such that <code>x = 2 * x'</code>. Once you substitute that in, the interval is <code>25 â‰¤ x' âˆ§ x' â‰¤ 27</code>, and now none of the cases are contradictions. Why encode the structure into some macros when it can go into the logic of the proof itself?</p>\n<p>I fumbled this a bit while trying to keep your goal of \"no high-level tactics\", but here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">even_iff_exists_two_mul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">p_even</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">x'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p_even</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lb'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_le_div_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">lb</span>\n<span class=\"w\">    </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul_div_cancel_left</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_lt_two</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ub'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_le_div_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ub</span>\n<span class=\"w\">    </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mul_div_cancel_left</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_lt_two</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">x'</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- or trivial</span>\n</code></pre></div>",
        "id": 536066221,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756140482
    },
    {
        "content": "<p>I'd probably normally make use of <code>omega</code> here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">even_iff_exists_two_mul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">p_even</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">x'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"w\"> </span><span class=\"c1\">-- instead of rfl, you can use `_` and follow up with `subst x`.</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lb'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ub'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">x'</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 536066324,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756140517
    },
    {
        "content": "<p>This is how the students in my intro to proofs course learn to handle evenness on paper as well, they can write \"since x is even, let x' be such that x = 2 * x'\" and then eliminate <code>x</code>.</p>",
        "id": 536066603,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756140620
    },
    {
        "content": "<p>It's not bad to refer to case names, I want to clarify that. Programmatic case name parsing just seems brittle and unclear.</p>\n<p>It's possible to handle specific cases together using <code>case</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">51</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">53</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">55</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">50</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">52</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"mi\">54</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 536067330,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756140915
    },
    {
        "content": "<p>That's very cool. You avoided generating absurd cases in the first place.</p>\n<p>I found a good lemma for getting straight to <code>lb'</code>, but <code>ub'</code> required more wrangling for some reason.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">lb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_even</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">even_iff_exists_two_mul</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">p_even</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">x'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p_even</span>\n\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lb'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_le_of_le_mul</span><span class=\"w\"> </span><span class=\"n\">lb</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ub'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rewrite</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ub</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_div_iff_mul_le</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_lt_two</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">ub</span>\n\n<span class=\"w\">  </span><span class=\"n\">interval_cases</span><span class=\"w\"> </span><span class=\"n\">x'</span>\n<span class=\"w\">    </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- or trivial</span>\n</code></pre></div>\n<p>Thanks for more background information about the tactic language. I guess what I've been reaching for are ways to address the \"structure\" implicit in a large set of goals. Your solution was to exploit this structure BEFORE splitting into a large number of cases. Maybe there are reasons why this is generally the better option in Lean or mathematics.</p>\n<p>At first, I was trying to use the \"first\" tactic to implicitly pick out goals meeting a certain criteria, without being able to express that criteria directly as a condition for which to execute a particular tactic block. This is the feature of a traditional programming language which I'm really missing, not the backtracking mechanism I'm using to hack it in with \"first\".</p>",
        "id": 536089906,
        "sender_full_name": "David Wood",
        "timestamp": 1756148959
    },
    {
        "content": "<p>I've seen the tactic language has an \"if ... then ... else\" expression, but it seems to work very differently. It's not \"deciding\" whether the condition is true, but \"assuming\" it (and using the controversial law of excluded middle to do so?).</p>",
        "id": 536091852,
        "sender_full_name": "David Wood",
        "timestamp": 1756149709
    },
    {
        "content": "<p>I think I have numerous basic confusions about Lean that will just take more practice to overcome. Rather than persist in trying to address aggregates of a large number of subgoals, it seems the lesson I should first learn is to avoid generating cases/subgoals in the first place, if at all possible.</p>",
        "id": 536097794,
        "sender_full_name": "David Wood",
        "timestamp": 1756151884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"949348\">David Wood</span> <a href=\"#narrow/channel/113489-new-members/topic/.22First.22.20tactic.20swallows.20relevant.20errors/near/536089906\">said</a>:</p>\n<blockquote>\n<p>Maybe there are reasons why this is generally the better option in Lean or mathematics.</p>\n</blockquote>\n<p>Mathematicians care about understanding why things are true, not just that they're true, and large case analyses are generally not illuminating. Understanding things better leads to nicer, more insightful arguments. There's a joke that mathematicians put a lot of energy into being lazy.</p>\n<p>For Lean, what people have found is that maintaining large mathematical libraries is easier if the structure of the proof is static rather than dynamic. The tactic language might look like it's an imperative programming language for manipulating goal states â€” it is â€”Â but it's not used that way. Tactics are designed so that you can create scripts that show the logical structure of the proof. For example, you point out if/then/else. That's to prove something by breaking it into a true and a false case. It structures the proof visually into these cases.</p>\n<p>It's <em>possible</em> to write a tactic combinator that tries running a tactic and conditionally runs a second tactic based on its success. Maybe the syntax could be <code>try tacs1 then tacs2</code>, to try the first tactic sequence and if it succeeds then commit to the changes and run the second tactic sequence. It doesn't seem like it is in the direction of creating maintainable, understandable proofs though.</p>\n<p>Granted, you seem more interested in choosing goals by some sorts of conditions. There isn't much for that except for <code>case</code> and some variants, like the one in the Batteries library that can select a case by the type of the target, using a pattern.</p>\n<blockquote>\n<p>This is the feature of a traditional programming language which I'm really missing</p>\n</blockquote>\n<p>I guess it's good to know that Lean's tactic language looks friendly enough that you're even comparing it to traditional programming languages â€” I don't know any traditional languages where you imperatively manipulate expression trees at compile time. It's pretty strange!</p>\n<p>It takes some getting used to this model. It's a program you're running <em>once</em> for a particular theorem, to generate the actual proof. But, you do run it every time you compile your project, and you want it to keep running correctly even if you make small changes to definitions, if possible, or at least make it be easily correctable.</p>\n<p>Once you start working with many goals, it starts to feel like a better choice to use a high powered tactic that's a decision procedure for the general problem. That way, it's more tolerant to small changes, since it's a decision procedure that automatically generates the proof dynamically.</p>",
        "id": 536098924,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756152275
    },
    {
        "content": "<p>Speaking of procedures, <code>grind</code> grinds through it instantly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>\n<p>(I have no idea how it solves this. Using <code>grind</code> admits you don't care about getting any insight.)</p>",
        "id": 536099152,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756152356
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/.22First.22.20tactic.20swallows.20relevant.20errors/near/536098924\">said</a>:</p>\n<blockquote>\n<p>I guess it's good to know that Lean's tactic language looks friendly enough that you're even comparing it to traditional programming languages â€” I don't know any traditional languages where you imperatively manipulate expression trees at compile time. It's pretty strange!</p>\n</blockquote>\n<p>It seems like even after 65 years people still don't count LISP as a traditional programming language. :P And there are a few other languages with a good support of metaprogramming.</p>",
        "id": 536108864,
        "sender_full_name": "suhr",
        "timestamp": 1756155878
    },
    {
        "content": "<p>Though Coq style tactics are indeed unique.</p>",
        "id": 536110657,
        "sender_full_name": "suhr",
        "timestamp": 1756156627
    }
]