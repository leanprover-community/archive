[
    {
        "content": "<p>Hi, I am new to Lean.</p>\n<p>In <a href=\"https://en.wikipedia.org/wiki/Proof_theory\">proof theory</a> we treat proofs as (well-defined) formal mathematical objects w.r.t. fixed sets of rules and axioms.<br>\nI didn't find any Lean libraries to deal with such objects, so I wrote the following code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_atom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_not</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_imp</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n\n<span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">75</span><span class=\"w\"> </span><span class=\"s2\">\"~\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"bp\">.</span><span class=\"n\">f_not</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" ~&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"bp\">.</span><span class=\"n\">f_imp</span><span class=\"w\">  </span><span class=\"c1\">-- left-associative</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n\n<span class=\"c1\">-- Explicit instantiation for the next step.</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A2</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">H2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n\n<span class=\"c1\">-- Theorems T1,T2 ; TODO: Make T2 work (requires unification / most general unifier).</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">H2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n<span class=\"c1\">-- detailed variant of T1</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T1'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">H1</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n\n<span class=\"c1\">-- don't know how to synthesize implicit argument 'A' @D (A ~&gt; (?m.4763 ~&gt; A)) (A ~&gt; A) (A2.D A1) A1</span>\n<span class=\"c1\">-- context:</span>\n<span class=\"c1\">-- atom : Type u</span>\n<span class=\"c1\">-- A : formula</span>\n<span class=\"c1\">-- don't know how to synthesize implicit argument 'B' @D (A ~&gt; (?m.4763 ~&gt; A ~&gt; A)) (A ~&gt; (?m.4763 ~&gt; A) ~&gt; (A ~&gt; A)) A2 A1</span>\n<span class=\"c1\">-- context:</span>\n<span class=\"c1\">-- atom : Type u</span>\n<span class=\"c1\">-- A : formula</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n<span class=\"c1\">-- detailed variant of T2 ; same error</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T2'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A2</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n</code></pre></div>\n<p>The types are correctly resolved for <code>def T1</code>, which thus implicitly proves the <a href=\"https://en.wikipedia.org/wiki/Condensed_detachment#D-notation\">condensed detachment</a> proof <code>DD211</code>.<br>\nBut that only works when using explicit (user-defined) instantiation, i.e. <code>def T2</code> cannot be resolved. However, the most general unifier is defined for that term.<br>\nMore precisely, for <code>A ~&gt; B</code> and <code>C</code> given, <code>proof.D</code> (\"Rule D\": detachment + unification) should unify <code>A</code> and <code>C</code> and apply the resulting substitutions σ also to <code>B</code>, so that modus ponens can be applied, i.e. <code>proof(σ(B)) := proof.D proof(A ~&gt; B) proof(C)</code>, where <code>A' := σ(A) = σ(C)</code> is a most general unifier of <code>A</code> and <code>C</code>.</p>\n<p>Is there a way to make Lean resolve it correctly?</p>\n<p>Also, there are several more problems:</p>\n<ol>\n<li>Proof notation is overbloated. Can it be made something like <code>D D 2 1 1</code> (using numbers for axioms, no parentheses), ideally even without spaces (maybe as strings)?</li>\n<li>Can the type of a result be declared anonymously, i.e. without explicitly writing down the conclusion of a proof?</li>\n<li>Assuming one could make the unification work, would there be a way to print all the types / formulas that led to the final type / formula somehow?</li>\n</ol>\n<p>I know of only two programs capable of parsing (and validating) D-notation proofs in general:</p>\n<ul>\n<li><a href=\"https://github.com/xamidi/pmGenerator\">pmGenerator</a> (my own tool)<ul>\n<li>capable of much more, D-proof parsing is just a tiny feature</li>\n<li>written in C++</li>\n</ul>\n</li>\n<li><a href=\"http://cs.christophwernhard.com/cdtools/\">CD Tools</a><ul>\n<li>cannot print intermediate conclusions, i.e point 3 missing</li>\n<li>written in Prolog<ul>\n<li>makes use of unification of the logic programming language itself</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>Lean's <a href=\"https://lean-lang.org/lean4/doc/unifhint.html\">documentation on \"Unification Hints\"</a> — which might be helpful — only says \"<code>TODO</code>\".</p>\n<p>I think embedding the ability to parse and validate such proofs into the language of a proof assistant (as a verified program) would open a nice opportunity to increase confidence for users, and to experiment around in a more powerful environment.</p>",
        "id": 485586000,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733133784
    },
    {
        "content": "<p>you may find parts of what you're looking for <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/ModelTheory/Syntax.html\">here</a> among mathlibs model theory files</p>",
        "id": 485588739,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733134666
    },
    {
        "content": "<p>also, that's an immense wall of text you've sent there. I think it might help people help you if you ask these things one at a time</p>",
        "id": 485589318,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733134842
    },
    {
        "content": "<p>you can definitely remove the <code>proof.</code>, just use <code>open proof</code> first. This will give you notation similar to Coq's</p>",
        "id": 485589451,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733134894
    },
    {
        "content": "<p>similarly, you can do the \"detailed\" proof by using <code>by</code> and <code>apply</code>. But <code>T2</code> will still have an unresolved metavariable in tactic mode.</p>",
        "id": 485589709,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733134970
    },
    {
        "content": "<p>You might be able to resolve these variables using <code>repeat exact formula.true</code> at the end of the proof, but in CIC it is not considered a complete proof until you do this, you can't just forget about an uninstantiated metavariable because the type could be empty</p>",
        "id": 485590116,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733135090
    },
    {
        "content": "<p>Regarding compressing the notation, you will most likely need to write a custom parser. It is easier to do the version that does not compress spaces</p>",
        "id": 485590441,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733135173
    },
    {
        "content": "<p>You don't need unification hints for this. This is plain first order unification, lean's normal metavariables do more or less what you want here</p>",
        "id": 485590721,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733135252
    },
    {
        "content": "<p>fwiw, adding <code>(A := A ~&gt; (A ~&gt; A))</code> after the first <code>D</code> fixes your <code>T2</code> issue</p>",
        "id": 485591827,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733135562
    },
    {
        "content": "<p>Thanks Mario, I added the <code>open proof</code> and removed that part from the question.</p>\n<p>Which is the correct <code>by</code> and <code>apply</code> syntax for L1? I couldn't figure this out.</p>\n<p>What is <code>repeat exact formula.true</code>? I didn't define this and it says <code>unexpected token 'repeat'</code> when I try to put this anywhere.</p>",
        "id": 485593482,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733136066
    },
    {
        "content": "<p>Interesting, Edward, though not the desired behavior (the user shouldn't have to figure this out, and for longer proofs, the blowup through formulas is exponential).</p>",
        "id": 485594114,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733136246
    },
    {
        "content": "<p>here's T1 using by and apply:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T1'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">H1</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n</code></pre></div>",
        "id": 485594338,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733136332
    },
    {
        "content": "<p>if you do T2 in this style, you get an error on the A2 subgoal because it hasn't solved all the metavariables yet</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">T2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">D</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A2</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n</code></pre></div>",
        "id": 485594619,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733136418
    },
    {
        "content": "<p>Cool. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n<p>Yeah, same as in Coq.</p>",
        "id": 485594753,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733136465
    },
    {
        "content": "<p>unfortunately it seems like apply (nor <code>eapply</code> / <code>fapply</code>) does not want to systematically defer all these formula goals which makes it difficult to give a general approach using only the user-facing tactics and not using ad hoc <code>swap</code> and such to push the goals to the end</p>",
        "id": 485595161,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733136579
    },
    {
        "content": "<p>Ok. Seems like there is no solution close for a newbie like me then.</p>\n<p>What was that about <code>repeat exact formula.true</code>, though? Where to put it?</p>",
        "id": 485595849,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733136801
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113489-new-members/topic/Axiomatic.20formal.20proofs.20.2F.20How.20to.20unify.20typed.20formulas.3F/near/485595161\">said</a>:</p>\n<blockquote>\n<p>unfortunately it seems like apply (nor <code>eapply</code> / <code>fapply</code>) does not want to systematically defer all these formula goals which makes it difficult to give a general approach using only the user-facing tactics and not using ad hoc <code>swap</code> and such to push the goals to the end</p>\n</blockquote>\n<p>i suppose a version of apply which tries <code>assumption</code> or <code>exact default</code> for any remaining goal would be what you'd want here?</p>",
        "id": 485597006,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733137147
    },
    {
        "content": "<p>the trouble is that apply doesn't always postpone the formula subgoals</p>",
        "id": 485597126,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733137183
    },
    {
        "content": "<p>try doing <code>T2</code> without the bullets and you will see the issue</p>",
        "id": 485597165,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733137195
    },
    {
        "content": "<p>(and you can't close the goals too early using <code>formula.true</code> or it will cause later <code>apply</code> to fail to unify)</p>",
        "id": 485597305,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733137224
    },
    {
        "content": "<p>right... so part of the issue here is that the focussing bullet <code>·</code> forces us to assign a metavariable which we don't know enough about yet to truly resolve yet...</p>",
        "id": 485598683,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733137659
    },
    {
        "content": "<p>ideally, we'd be able to make <code>apply</code> recognise that <code>formula</code>-goals here are \"goals that we would like to postpone wherever possible, and only solve for by unification\"</p>",
        "id": 485599478,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733137908
    },
    {
        "content": "<p>I removed the Coq code as it is no longer needed. Much smaller wall of text now. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 485600933,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733138369
    },
    {
        "content": "<p>Here's a parser for your <code>DD211</code> expressions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CD</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Parser</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_atom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_not</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_imp</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n\n<span class=\"kn\">prefix</span><span class=\"o\">:</span><span class=\"mi\">75</span><span class=\"w\"> </span><span class=\"s2\">\"~\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"bp\">.</span><span class=\"n\">f_not</span>\n<span class=\"kn\">infixl</span><span class=\"o\">:</span><span class=\"mi\">65</span><span class=\"w\"> </span><span class=\"s2\">\" ~&gt; \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"bp\">.</span><span class=\"n\">f_imp</span><span class=\"w\">  </span><span class=\"c1\">-- left-associative</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">cdChunkKind</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SyntaxNodeKind</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`cdChunk</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isCDChar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">1</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">2</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">D'</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'_'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cdChunkFn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ParserFn</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pos</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">takeWhileFn</span><span class=\"w\"> </span><span class=\"n\">isCDChar</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">hasError</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">ParserState</span><span class=\"bp\">.</span><span class=\"n\">mkError</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"s2\">\"CD chunk\"</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">tag</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Substring</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toString</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">tag</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">isCDChar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">ParserState</span><span class=\"bp\">.</span><span class=\"n\">mkUnexpectedError</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"s2\">\"invalid character\"</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">mkNodeToken</span><span class=\"w\"> </span><span class=\"n\">cdChunkKind</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">s</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cdChunkNoAntiquot</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">fn</span><span class=\"w\">   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cdChunkFn</span>\n<span class=\"w\">  </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkAtomicInfo</span><span class=\"w\"> </span><span class=\"s2\">\"cdChunk\"</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cdChunkParser</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">withAntiquot</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkAntiquot</span><span class=\"w\"> </span><span class=\"s2\">\"cdChunk\"</span><span class=\"w\"> </span><span class=\"n\">cdChunkKind</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">cdChunkNoAntiquot</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">combinator_formatter</span><span class=\"w\"> </span><span class=\"n\">cdChunkNoAntiquot</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cdChunkNoAntiquot</span><span class=\"bp\">.</span><span class=\"n\">formatter</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Formatter</span><span class=\"bp\">.</span><span class=\"n\">visitAtom</span><span class=\"w\"> </span><span class=\"n\">cdChunkKind</span>\n<span class=\"kd\">@[</span><span class=\"n\">combinator_parenthesizer</span><span class=\"w\"> </span><span class=\"n\">cdChunkNoAntiquot</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">cdChunkAntiquot</span><span class=\"bp\">.</span><span class=\"n\">parenthesizer</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Parenthesizer</span><span class=\"bp\">.</span><span class=\"n\">visitToken</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Pos</span>\n<span class=\"w\">  </span><span class=\"n\">chunks</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`CD.cdChunkParser</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Char</span>\n\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StateT</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"n\">MacroM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Pos</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·+⟨</span><span class=\"mi\">1</span><span class=\"bp\">⟩</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">chunk</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">atom</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">chunk</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"bp\">.</span><span class=\"n\">getPos?</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">next</span>\n\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">buildExpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StateT</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"n\">MacroM</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"bp\">.</span><span class=\"n\">getDM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'_'</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">missing</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">ofRange</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Pos</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">D'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">buildExpr</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">buildExpr</span>\n<span class=\"w\">    </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkCIdentFrom</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"ss\">``proof.D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canonical</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">1</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkCIdentFrom</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"ss\">``proof.A1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canonical</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">2</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkCIdentFrom</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"ss\">``proof.A2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canonical</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">3</span><span class=\"bp\">'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkCIdentFrom</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"ss\">``proof.A3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">canonical</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">'_'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">copyHeadTailInfoFrom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">missing</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"[CD| \"</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">:</span><span class=\"n\">cdChunkParser</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">finish</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StateT</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"n\">MacroM</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">buildExpr</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">missing</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Syntax</span><span class=\"bp\">.</span><span class=\"n\">ofRange</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">Pos</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">Macro</span><span class=\"bp\">.</span><span class=\"n\">throwErrorAt</span><span class=\"w\"> </span><span class=\"n\">ref</span><span class=\"w\"> </span><span class=\"s2\">\"expected 'D', '1', '2', '3', '_'\"</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">getPos?</span>\n<span class=\"w\">  </span><span class=\"n\">finish</span><span class=\"bp\">.</span><span class=\"n\">run'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">chars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CD</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">DD211</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 485615233,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733143170
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113489-new-members/topic/Axiomatic.20formal.20proofs.20.2F.20How.20to.20unify.20typed.20formulas.3F/near/485615233\">said</a>:</p>\n<blockquote>\n<p>Here's a parser for your <code>DD211</code> expressions:<br>\n[...]</p>\n</blockquote>\n<p>Wow that's really cool, thanks! I added <code>'3'</code> to <code>isCDChar</code>, but it still seems to not work all the time, for example for </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">#check</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CD</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">DD2DD2D13D2DD2D1311</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>, i.e. the first entry in <a href=\"https://us.metamath.org/mmsolitaire/pmproofs.txt\">pmproofs.txt</a>, I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">A2</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A2</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A1</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A2</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A2</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A1</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"o\">))))</span><span class=\"bp\">.</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A1</span>\n<span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">A1</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11320</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11321</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11320</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~~?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11297</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11316</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">11297</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>",
        "id": 485620629,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733144871
    },
    {
        "content": "<p>that seems like a legitimate failure?</p>",
        "id": 485627766,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733147128
    },
    {
        "content": "<p>Your axiom 3 is wrong, you wrote</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>but I guess it should be</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 485628804,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733147455
    },
    {
        "content": "<p>also you probably want implication to be right associative, not left associative</p>",
        "id": 485628890,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733147484
    },
    {
        "content": "<p>Here's an elaborator which fills in the metavariables correctly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">cdCleanup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"cd_cleanup \"</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"n\">Meta</span>\n<span class=\"kd\">@[</span><span class=\"n\">term_elab</span><span class=\"w\"> </span><span class=\"n\">cdCleanup</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">elabCleanup</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TermElab</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">cd_cleanup</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">isMVar</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isMVarApp</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isMVar</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">tryPostpone</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">elabTerm</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isMVar</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferType</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">isFormula</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">isDefEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">getType</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``formula</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mvars</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">collectUnassignedMVars</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">filterM</span><span class=\"w\"> </span><span class=\"n\">isFormula</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isMVar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">StateT</span><span class=\"bp\">.</span><span class=\"n\">run'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">mvars</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">appendIndexAfter</span><span class=\"w\"> </span><span class=\"ss\">`A</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``formula</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">withLocalDeclsD</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">mvars</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">          </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">assign</span><span class=\"w\"> </span><span class=\"n\">fvar</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">collectUnassignedMVars</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isFormula</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">assign</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``formula.f_atom</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">mkLambdaFVars</span><span class=\"w\"> </span><span class=\"n\">fvars</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">StateT</span><span class=\"bp\">.</span><span class=\"n\">run'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">mvars</span><span class=\"bp\">.</span><span class=\"n\">forM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">setUserName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Name</span><span class=\"bp\">.</span><span class=\"n\">appendIndexAfter</span><span class=\"w\"> </span><span class=\"ss\">`A</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">((),</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">collectUnassignedMVars</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"n\">mvars</span><span class=\"bp\">.</span><span class=\"n\">contains</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">          </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isFormula</span><span class=\"w\"> </span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">            </span><span class=\"n\">mvar</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">assign</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``formula.f_atom</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">throwUnsupportedSyntax</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"CD: \"</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"o\">:</span><span class=\"n\">cdChunkParser</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">cd_cleanup</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CD</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">chunks</span><span class=\"bp\">.</span><span class=\"n\">raw</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">])</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CD</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DD2DD2D13D2DD2D1311</span>\n<span class=\"c1\">-- fun A_0 ↦ (A2.D ((A2.D (A1.D A3)).D (A2.D ((A2.D (A1.D A3)).D A1)))).D A1</span>\n<span class=\"c1\">-- : (A_0 : formula) → proof (~A_0 ~&gt; A_0 ~&gt; A_0)</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">CD</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DD2DD2D13D2DD2D1311</span>\n</code></pre></div>",
        "id": 485636966,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733149836
    },
    {
        "content": "<p>note that this is based on the following definition of <code>formula</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_atom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_not</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f_imp</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n</code></pre></div>",
        "id": 485637361,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733149944
    },
    {
        "content": "<p>here <code>f_atom</code> is used to fill in all unresolved metavariables encountered after unification is complete, and any variables which remain in the theorem statement are universally quantified</p>",
        "id": 485637488,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733149985
    },
    {
        "content": "<p>regarding your last question</p>\n<blockquote>\n<p>Assuming one could make the unification work, would there be a way to print all the types / formulas that led to the final type / formula somehow?</p>\n</blockquote>\n<p>you can obtain this result from <code>#explode</code>, which I wrote a while ago to mimic the metamath proof style that I know you are thinking of:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Explode</span>\n\n<span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"bp\">.</span><span class=\"n\">f_atom</span>\n<span class=\"bp\">#</span><span class=\"n\">explode</span><span class=\"w\"> </span><span class=\"n\">CD</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DD2DD2D13D2DD2D1311</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">  </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"o\">))))</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\">         </span><span class=\"bp\">├</span><span class=\"w\"> </span><span class=\"n\">formula</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A2</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span>\n<span class=\"w\">  </span><span class=\"o\">(((</span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">10</span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">11</span><span class=\"bp\">│</span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">12</span><span class=\"bp\">│</span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">13</span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">14</span><span class=\"bp\">│</span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"mi\">13</span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">15</span><span class=\"bp\">│</span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">))</span>\n<span class=\"mi\">16</span><span class=\"bp\">│</span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">17</span><span class=\"bp\">│</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">(((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">18</span><span class=\"bp\">│</span><span class=\"w\">     </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">A1</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">19</span><span class=\"bp\">│</span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"mi\">18</span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\">  </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n<span class=\"mi\">20</span><span class=\"bp\">│</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"n\">I</span><span class=\"w\">          </span><span class=\"bp\">│</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">formula</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 485639065,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733150413
    },
    {
        "content": "<p>(the ascii table formatting is a bit janky on multiline formulas)</p>",
        "id": 485639212,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733150456
    },
    {
        "content": "<p>note that you need <code>proof</code> to live in <code>Prop</code> for this to work (otherwise <code>#explode</code> doesn't consider it to be a proof subexpression and just shows the proof term instead of the typing derivation)</p>",
        "id": 485639728,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1733150617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113489-new-members/topic/Axiomatic.20formal.20proofs.20.2F.20How.20to.20unify.20typed.20formulas.3F/near/485628804\">said</a>:</p>\n<blockquote>\n<p>Your axiom 3 is wrong, you wrote</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>but I guess it should be</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">~&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Oops, you're right.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/channel/113489-new-members/topic/Axiomatic.20formal.20proofs.20.2F.20How.20to.20unify.20typed.20formulas.3F/near/485628804\">said</a>:</p>\n<blockquote>\n<p>regarding your last question<br>\n[...]</p>\n</blockquote>\n<p>Very nice. <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n<p>To my surprise, everything I asked for is thereby solved in Lean! Thank you very much.</p>",
        "id": 485654429,
        "sender_full_name": "Samiro Discher",
        "timestamp": 1733154420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"784629\">Samiro Discher</span> has marked this topic as resolved.</p>",
        "id": 485723535,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733180683
    }
]