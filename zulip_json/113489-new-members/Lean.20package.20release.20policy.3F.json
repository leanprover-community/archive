[
    {
        "content": "<p>Hi, I was wondering what the release policy for a Lean package should be. When I create a new project using <code>lake new ... math</code>, Lake sets up some GitHub actions that automatically create tags and releases matching the Lean and mathlib releases (like <code>v4.23.0</code> or <code>v4.24.0-rc1</code>).</p>\n<p>But there’s also a <code>version</code> field in <code>lakefile.toml</code> (default is <code>v0.1.0</code>), which shows up in Reservoir. It seems natural to make a GitHub release (and add a git tag) whenever I bump this version, but that would conflict with the tags created by the default actions.</p>\n<p>So what’s the recommended approach here?</p>",
        "id": 540004734,
        "sender_full_name": "Michał Dobranowski",
        "timestamp": 1758112863
    },
    {
        "content": "<p>A related question. When a new Lean version is announced, what do I need to do?</p>\n<p>Specifically:</p>\n<ol>\n<li>I have a fork of mathlib. What do I need to do there?</li>\n<li>I have a Lean project using <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span>'s <a href=\"https://pitmonticone.github.io/LeanProject/\">Lean Project</a> template. What do I need to do there? </li>\n</ol>\n<p>We've been through this before but long enough ago that I've totally forgotten.</p>",
        "id": 540010670,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1758114519
    },
    {
        "content": "<p><code>lake update</code> takes care of updating all the dependencies of your project. You only need to do <code>lake build</code> and fix the proofs that broke.</p>",
        "id": 540017521,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116274
    },
    {
        "content": "<p>For 1- nothing</p>",
        "id": 540017567,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758116287
    },
    {
        "content": "<p>You can essentially ignore new releases of Lean, just do <code>lake update</code> often to update mathlib, and sometimes Lean will also be updated, but you don't need to care.</p>",
        "id": 540017809,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116348
    },
    {
        "content": "<p>Sorry, after <code>lake update</code> you need <code>lake exe cache get</code></p>",
        "id": 540017923,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116377
    },
    {
        "content": "<p>Otherwise you recompile everything</p>",
        "id": 540017964,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116388
    },
    {
        "content": "<p>Doesn't <code>lake update</code> do that by default now?</p>",
        "id": 540018026,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758116401
    },
    {
        "content": "<p>Ah it's possible</p>",
        "id": 540018087,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116414
    },
    {
        "content": "<p>Still, better to run it once too many than not enough</p>",
        "id": 540018394,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758116489
    },
    {
        "content": "<p>Yes, it does it automatically</p>",
        "id": 540018631,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758116540
    },
    {
        "content": "<p>Do you know the answer to my original question?</p>",
        "id": 540021890,
        "sender_full_name": "Michał Dobranowski",
        "timestamp": 1758117255
    },
    {
        "content": "<p>\"We're thinking about it\", is my most recent understanding</p>",
        "id": 540022470,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758117401
    },
    {
        "content": "<p>In the fork, does <code>lake update</code> subsume <code>git pull</code> followed by <code>lake exe cache get</code>? And does it make a difference whether I run this from master or from another branch?</p>",
        "id": 540031933,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1758119655
    },
    {
        "content": "<p>This is usually what I do when (I think) I'm bumping mathlib.</p>",
        "id": 540031999,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1758119671
    },
    {
        "content": "<p>No, within mathlib, you should never run <code>lake update</code></p>",
        "id": 540032556,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758119790
    },
    {
        "content": "<p>Got it. So this is just something for Lean projects then.</p>",
        "id": 540033286,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1758119945
    },
    {
        "content": "<p>While we're here. What is <code>lake</code>? I've always imagined it's some sort of <code>make</code> for Lean. (Disclosure: I don't really know what <code>make</code> files are supposed to do.</p>",
        "id": 540033613,
        "sender_full_name": "Emily Riehl",
        "timestamp": 1758120015
    },
    {
        "content": "<p>Suppose that you have your project <code>BigTheorem</code>, that depends on mathlib. Inside the <code>BigTheorem</code> forlder, <code>lake update</code> will update mathlib (and Lean if needed) but it will not do anything to your project. After this you have to run <code>lake build</code> to make sure your project works with the new version, and once everything works you commit and push as usual (you will notice that <code>lake</code> changed the lakefile, you have to commit this change, but otherwise you can ignore it). There is no need to pull anything during this process.</p>",
        "id": 540035675,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758120469
    },
    {
        "content": "<p>On the other hand, if someone else (or yourself with another computer) modifies something in your project you need <code>git pull</code> to get the new version.</p>",
        "id": 540035860,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758120511
    },
    {
        "content": "<p>One think to keep in mind is that, if the modification you get with <code>git pull</code> is a bump, done by someone else, you need <code>lake exe cache get</code>, otherwise you have red bars everywhere.</p>",
        "id": 540036132,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758120573
    },
    {
        "content": "<p>You can think to <code>lake</code> as the software that allows you to handle Lean projects.</p>",
        "id": 540036333,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1758120620
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20package.20release.20policy.3F/near/540022470\">said</a>:</p>\n<blockquote>\n<p>\"We're thinking about it\", is my most recent understanding</p>\n</blockquote>\n<p>Do you know of any actively developed projects that use the <code>version</code> field and have solved this problem?</p>",
        "id": 540038708,
        "sender_full_name": "Michał Dobranowski",
        "timestamp": 1758121173
    },
    {
        "content": "<p>I don't</p>",
        "id": 540038933,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1758121229
    },
    {
        "content": "<p>Note that just running <code>lake update</code> is bad advice if you think there is any chance anyone else wants to use your project</p>",
        "id": 540043160,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758122305
    },
    {
        "content": "<p>You should instead do the following:</p>\n<ul>\n<li>modify your lakefile to pin mathlib to <code>@ \"git#v4.23.0\"</code> (or whatever the version is)</li>\n<li>run <code>lake update</code></li>\n<li>fix everything and commit</li>\n<li>Optionally remove the <code>@ \"git#v4.23.0\"</code> and re-run <code>lake update</code>, if you want to go to the bleeding edge</li>\n</ul>",
        "id": 540043444,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758122379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20package.20release.20policy.3F/near/540043444\">said</a>:</p>\n<blockquote>\n<ul>\n<li>modify your lakefile to pin mathlib to <code>@ \"git#v4.23.0\"</code> (or whatever the version is)</li>\n</ul>\n</blockquote>\n<p>Isn't <code>lake-manifest.json</code> supposed to pin mathlib to the latest version? What's the difference if I pin it manually in lakefile?</p>",
        "id": 540122741,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1758155026
    },
    {
        "content": "<p>That won't pin any of the dependencies to the right versions</p>",
        "id": 540127614,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758158347
    },
    {
        "content": "<p>You could manually pin every dependency in the manifest, which is fragile; but if you do it in the lakefile instead, <code>lake update</code> will do the work for you.</p>",
        "id": 540127717,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758158412
    },
    {
        "content": "<p>What is right version? You mean it will pin to latest commit, instead of release version?</p>",
        "id": 540205906,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1758193813
    },
    {
        "content": "<p>\"right version\" means that if you depend on <code>A</code> and <code>A</code> depends on <code>B</code>, then you get a version of <code>B</code> that <code>A</code> claims works with it</p>",
        "id": 540206335,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1758193975
    }
]