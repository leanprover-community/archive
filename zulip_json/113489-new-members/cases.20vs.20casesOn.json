[
    {
        "content": "<p>Here's a proof using the <code>cases</code> tactic on an inductive:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Sym</span><span class=\"bp\">.</span><span class=\"n\">Sym2</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>I want to instead give a concise proof term, such as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Sym</span><span class=\"bp\">.</span><span class=\"n\">Sym2</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>but for some reason <code>h.casesOn</code> takes the goal as is and just adds <code>∀ (x y : ℕ)</code> before it.<br>\nIs <code>casesOn</code> not the correct theorem? Or is the huge proof term unavoidable?</p>",
        "id": 530792464,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753455175
    },
    {
        "content": "<p><code>casesOn</code> is a very simple definition that just splits into cases. <code>cases</code> does something more elaborate, something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Sym</span><span class=\"bp\">.</span><span class=\"n\">Sym2</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">noConfusion</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">symm</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>In other words, it adds equalities to the motive that we prove using <code>rfl</code> and that we can then use in the body. As you can tell this is neither smaller nor better so here is an alternative:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p><code>match</code>, contrasting <code>casesOn</code>, has similar capabilities to <code>cases</code> (actually <code>match</code> uses <code>cases</code>).</p>",
        "id": 530795365,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753456061
    },
    {
        "content": "<p>Thanks, I'm thoroughly confused about all this though-<br>\nWhen I used <code>casesOn</code> it had 2 parameters, but when you added a motive it had 4.<br>\nAlso there's not only <code>cases</code> and <code>casesOn</code>, but there's also <code>match</code> which does something slightly different? And there's also the <code>have ⟨ ... ⟩ := ...</code> tactic, which also sometimes complains about motive, although I'm not sure if it can handle sum types and not just product types.<br>\nIf I understand correctly, proof irrelevance is the cause of all this?</p>\n<p>What I'm asking is: Do you know a good resource to learn this from? Since it all seems to be haunting me no matter what I try to do with Lean.</p>",
        "id": 530800678,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753457856
    },
    {
        "content": "<p>By <em>this</em> I mean everything about <code>motive</code>, and the difference between <code>Nonempty</code> and <code>Inhabited</code>, or <code>Exists</code> and <code>Subtype</code>, and <code>Sort</code>s and <code>Type</code>s and when I can or can't use <code>cases</code> or <code>casesOn</code> or <code>`have ⟨ ... ⟩ := ...</code>.<br>\nI'm coming from <code>Rocq</code>, where all of this was simply something like <code>intros a [b c | d [e | f]]</code>, and it never complained</p>",
        "id": 530801410,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753458132
    },
    {
        "content": "<p>If you're using recursors, the first thing you should be familiar with is its exact type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Sym2.Rel.casesOn.{u} {α : Type u} {motive : (a a_1 : α × α) → Sym2.Rel α a a_1 → Prop} {a✝ a✝¹ : α × α}</span>\n<span class=\"cm\">  (t : Sym2.Rel α a✝ a✝¹) (refl : ∀ (x y : α), motive (x, y) (x, y) ⋯) (swap : ∀ (x y : α), motive (x, y) (y, x) ⋯) :</span>\n<span class=\"cm\">  motive a✝ a✝¹ t</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>The <code>motive</code> should be a function of three arguments. However, Robin gave it a function of <em>five</em> arguments (that's perfectly fine! A forall is a <code>Prop</code> after all). That means <code>Sym2.Rel.casesOn</code> is returning a function of two arguments in this case.</p>",
        "id": 530801704,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753458256
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530800678\">said</a>:</p>\n<blockquote>\n<p>If I understand correctly, proof irrelevance is the cause of all this?</p>\n</blockquote>\n<p>No, definitely not. Dependent type theory is the cause.</p>\n<p>There's a reason we have all these high-level tactics and elaborators to avoid ever needing to touch recursors by hand. It's a good exercise to write recursor expressions, to see how it works under the hood, but that doesn't need to come before getting familiar first with how the system is actually used.</p>",
        "id": 530802162,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753458427
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530801704\">said</a>:</p>\n<blockquote>\n<p>If you're using recursors, the first thing you should be familiar with is its exact type:</p>\n</blockquote>\n<p>I tried checking the type of <code>casesOn</code>, but it complained with a separate cryptic error message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Sym</span><span class=\"bp\">.</span><span class=\"n\">Sym2</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"bp\">.</span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>failed to elaborate eliminator, expected type is not available\n</code></pre></div>",
        "id": 530802354,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753458494
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530802162\">said</a>:</p>\n<blockquote>\n<p>No, definitely not. Dependent type theory is the cause.</p>\n</blockquote>\n<p>So why is this never a problem in Rocq, which also uses dependent type theory?<br>\nWhen I asked why I can't destruct an <code>Exists</code> inside a function that returns <code>Nat</code> <a href=\"#narrow/channel/270676-lean4/topic/Help.3A.20recursor.20'Exists.2EcasesOn'.20can.20only.20eliminate.20into.20Prop/near/529480769\">I was told</a> it's because of proof irrelevance, that's why I suspected it's the cause of all of the <code>motive</code> things.</p>",
        "id": 530802758,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753458628
    },
    {
        "content": "<p>That error might be a hint that you shouldn't be using eliminators (aka recursors) by hand <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span> (Not everyone agrees with this. I guess I don't even agree, since in my graduate Lean course I had my students write recursor expressions in the first couple weeks!)</p>",
        "id": 530802847,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753458660
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530802758\">said</a>:</p>\n<blockquote>\n<p>So why is this never a problem in Rocq</p>\n</blockquote>\n<p>I don't understand then what \"all this\" refers to. Rocq doesn't avoid dependent type issues.</p>",
        "id": 530803398,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753458852
    },
    {
        "content": "<p>If you mean \"why this complexity with elimination of propositions\", then I guess, sure, that's motivated by proof irrelevance, as I understand. But that's such a small part of the discussion — I thought you were talking about working with casesOn, which is going to be about the same difficulty no matter what system you're working in.</p>",
        "id": 530803611,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753458935
    },
    {
        "content": "<p><code>#check h.casesOn</code> doesn't work because you're giving it the term <code>h.casesOn</code>. If you gave it the full name of the identifier, <code>Sym2.Rel.casesOn</code>, you'd get the type signature.</p>\n<p><code>#check</code> has two modes: if you give it an identifier it shows you the type signature, but if you give it a general expression it will try to elaborate that expression and then give you the elaborated expression and its type.</p>",
        "id": 530804080,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753459096
    },
    {
        "content": "<p>I lost a draft message; I was going to mention <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/\">Theorem Proving in Lean</a></p>",
        "id": 530804807,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753459326
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530803398\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530802758\">said</a>:</p>\n<blockquote>\n<p>So why is this never a problem in Rocq</p>\n</blockquote>\n<p>I don't understand then what \"all this\" refers to. Rocq doesn't avoid dependent type issues.</p>\n</blockquote>\n<p>Hmm, maybe I'm trying to do things in Lean that I never tried in Rocq, and I just think it works in Rocq</p>",
        "id": 530806430,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753459887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530804807\">said</a>:</p>\n<blockquote>\n<p>I lost a draft message; I was going to mention <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/\">Theorem Proving in Lean</a></p>\n</blockquote>\n<p>Looks like they mention all the <code>casesOn</code> and <code>recOn</code> and recursors, thank you!<br>\nI'll try to read it, it'll hopefully fix the way I approach Lean theorems :)</p>",
        "id": 530806731,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753459995
    },
    {
        "content": "<p>The <code>match</code> expression (according to <a href=\"https://rocq-prover.org/doc/v8.10/refman/language/cic.html#the-match-with-end-construction\">https://rocq-prover.org/doc/v8.10/refman/language/cic.html#the-match-with-end-construction</a>) appears to have the same universe elimination rules as Lean. It's motivated by program extraction; it causes <code>ex</code> to eliminate only into <code>Prop</code>, since in an extracted program proofs are erased, so getting the witness would amount to getting something from nothing.</p>\n<p>Rocq has <code>SProp</code> too, which is analogous to Lean's <code>Prop</code>. That can only eliminate into <code>SProp</code>, just like Lean.</p>\n<p>That <code>match</code> limitation is artificial though, since Rocq's eliminator for <code>ex</code>, <code>ex_rec</code>, does allow elimination into <code>Set</code>. Lean only allows the \"<code>ex_sind</code>\" eliminator for existentials, since <code>Exists</code> is \"<code>SProp</code>\"-valued.</p>\n<p>If you want <code>ex</code> in Lean, you need to work with sigma types instead.</p>",
        "id": 530807758,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753460358
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530802354\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530801704\">said</a>:</p>\n<blockquote>\n<p>If you're using recursors, the first thing you should be familiar with is its exact type:</p>\n</blockquote>\n<p>I tried checking the type of <code>casesOn</code>, but it complained with a separate cryptic error message:</p>\n</blockquote>\n<p>Just to check: was there no type for casesOn when you hovered over it in the source code? That would be surprising. This usually works even if there are errors.</p>",
        "id": 530810814,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753461447
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/cases.20vs.20casesOn/near/530810814\">said</a>:</p>\n<blockquote>\n<p>Just to check: was there no type for casesOn when you hovered over it in the source code?</p>\n</blockquote>\n<p>There was, but since it both didn't work correctly for me and the <code>#check</code> showed an error I thought I might be seeing the type of a different <code>casesOn</code> or something<br>\nThere's also no autocompletion for the name <code>casesOn</code>, even when it doesn't error</p>",
        "id": 530856547,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1753481703
    }
]