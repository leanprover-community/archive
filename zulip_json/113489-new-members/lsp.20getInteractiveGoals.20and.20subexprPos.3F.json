[
    {
        "content": "<p>Hi what's the field <code>subexprPos</code> in the method <code>Lean.Widget.getInteractiveGoals</code> of lsp request <code>$/lean/rpc/call</code>used for? I am trying to do some basic funtionality of Lean4 in Intellij Idea and now reach a status that I want to extract the current expression when the cursor hovering in the infoview:<br>\n<a href=\"/user_uploads/3121/Pdi-eMTS2Q7o6L4GiauyJGjX/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/oEfsfhW8bqA-23QL2_q_UMwf/image.png\">image.png</a><br>\n<a href=\"/user_uploads/3121/zBWoPf0yYJvVXUFZV3l682v6/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Pdi-eMTS2Q7o6L4GiauyJGjX/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/Pdi-eMTS2Q7o6L4GiauyJGjX/image.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/oEfsfhW8bqA-23QL2_q_UMwf/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/oEfsfhW8bqA-23QL2_q_UMwf/image.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/zBWoPf0yYJvVXUFZV3l682v6/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/zBWoPf0yYJvVXUFZV3l682v6/image.png\"></a></div>",
        "id": 449916015,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1720454868
    },
    {
        "content": "<p>I think I must convert the response to some tree-like structure for getting the start and end position for the current hovering position. Is it used for this? I am already deserialized it in some form but not sure how to use it:<br>\n<a href=\"/user_uploads/3121/59bQhaYQwuDQ0JIoYLuzXm7Y/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/59bQhaYQwuDQ0JIoYLuzXm7Y/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/59bQhaYQwuDQ0JIoYLuzXm7Y/image.png\"></a></div>",
        "id": 449917929,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1720455313
    },
    {
        "content": "<p>(You're probably better done asking this in #lean4)<br>\nI don't recall what that field does, but I can tell you lean.nvim doesn't use it for anything from a quick grep.</p>",
        "id": 449932433,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720458908
    },
    {
        "content": "<p>(And we support that functionality, IIRC the places to hover come straight from the widgets RPC calls, not from there)</p>",
        "id": 449932514,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720458931
    },
    {
        "content": "<p>So yeah I'd: 1) ask in #lean4 where Marc may see it and jump in and/or 2) check the Lean server source code (the files have moved around a bit recently so probably just grep for that) and/or 3) grep the VSCode extension to see if it uses it for anything ,as I say lean.nvim doesn't, but maybe we're missing something.</p>",
        "id": 449932813,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720458997
    },
    {
        "content": "<p>(<a href=\"https://github.com/Julian/lean.nvim/blob/03f743773b684ab4db63c4224dcef06588c1a6f7/lua/lean/infoview/components.lua#L87\">https://github.com/Julian/lean.nvim/blob/03f743773b684ab4db63c4224dcef06588c1a6f7/lua/lean/infoview/components.lua#L87</a> in case that helps as well, though probably we ported that directly from the VSCode extension)</p>",
        "id": 449933064,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720459080
    },
    {
        "content": "<p>Yeah thanks it helps a lot! I will check the lua code. A first glance it seems the popup information is loaded eagerly rather than after hovering. I will try to follow nvim's impl too!</p>",
        "id": 449934569,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1720459470
    },
    {
        "content": "<p>Btw I cannot move this thread. I will link this for next post in #lean4 <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 449935153,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1720459581
    },
    {
        "content": "<p>I don't think I can either, and yeah not a big deal, just might assume the people who know the answers may not necessarily pay attention to this stream.</p>",
        "id": 449935370,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720459625
    },
    {
        "content": "<p>You might find these files to be helpful:<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Server/FileWorker/WidgetRequests.lean\">Root for InfoView-related widget requests</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Server/FileWorker/RequestHandling.lean#L233\">Language server request handling</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Widget/InteractiveGoal.lean#L51\">InteractiveGoal type declaration</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Widget/InteractiveCode.lean#L45\">CodeWithInfos type declaration</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Widget/TaggedText.lean#L17\">TaggedText type declaration</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Server/InfoUtils.lean#L38\">InfoWithCtx type declaration</a><br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/SubExpr.lean#L22\">Lean.SubExpr.Pos type declaration</a></p>",
        "id": 450092404,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1720511731
    },
    {
        "content": "<p>As per the doc linked by Marc, <code>subexprPos</code> is the address of a subexpression within a parent expression. For a simple example, <code>y</code> might have address <code>2/1</code> in <code>f x (g y)</code> because it's the first argument to the second argument (NB: it won't actually have that address in Lean, this is just to illustrate the idea).</p>",
        "id": 450142800,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1720525018
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"560873\">@Shanghe Chen</span> does Idea support browser-based webviews? If it does, you could embed the full infoview as sketched <a href=\"https://github.com/leanprover/vscode-lean4/tree/master/lean4-infoview#hosting\">here</a> and wouldn't have to work on reimplementing its functionality.</p>",
        "id": 450142924,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1720525069
    },
    {
        "content": "<p>Ah thanks! Yeah it has things like <a href=\"https://plugins.jetbrains.com/docs/intellij/jcef.html\">JCEF (Java Chromium Embedded Framework)</a> and I did a basic setup for external infoview with infoview-app <a href=\"https://github.com/onriv/ij-plugin-lean/blob/main/browser-infoview/src/App.tsx#L140\">here</a> too. I am not planing to reimplement the whole functionality of current infoview-app. Maybe something like popup document and types of current expression should be enough for basic usage.</p>",
        "id": 450147209,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1720526048
    }
]