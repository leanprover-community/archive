[
    {
        "content": "<p>I'm trying to work with the Dyadic numbers, and am having trouble with a few things.</p>\n<p>I want to use the absolute value, but Dyadic.abs is not defined. There also does not seem to be an Rat.abs, though there is Int.natAbs. Is this because there is an auto-generated abs somewhere, maybe Mathlib.Algebra.Order.AbsoluteValue.Basic and/or Mathlib.Algebra.Order.Group.Unbundled.Abs?  But then I can do |.| of Int, but not |.| of Dyadic (\"failed to synthesize instance of type class Lattice Dyadic\") or Rat.</p>\n<p>There also seems to be quite some inconsistency between different parts of Mathlib. For example, comparing Int, Dyadic and Rat:</p>\n<ul>\n<li>Int has neg_add, but Dyadic and Rat do not.</li>\n<li>Rat has add_right_cancel, but Int and Dyadic are missing this.</li>\n<li>Int and Rat have and instMax but Dyadic does not/</li>\n<li>Int defines .le (via NonNeg), .lt and .ble, but not .blt, whereas Dyadic defines .ble and .blt and Rat just  .blt<br>\nIs there any reason for this? Will there be any effort made to standardise the provided operations and lemmas?</li>\n</ul>\n<p>It seems like the intention is that the typeclasses organise operators and their properties. This is in principle nice, but there are <em>at lot</em> of typeclasses! This makes it really hard to find what is available. (Int has way more than 100!) Are there any good ways to navigate this?</p>\n<p>I've also been having a hard time \"unfolding\" things, especially with all the casts and notations around. Is there any way of simplifying out all notations, derived operations from typeclasses etc?</p>\n<p>Thanks!</p>",
        "id": 570301478,
        "sender_full_name": "Pieter Collins",
        "timestamp": 1769515265
    },
    {
        "content": "<p>By loogling for Rat, \"abs\", I found <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Rat.abs_def#doc\">docs#Rat.abs_def</a> and clicking on the notation takes you to the origin of that definition.</p>",
        "id": 570404475,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1769541809
    },
    {
        "content": "<p>there's no <code>LinearOrder</code> instance for <code>Dyadic</code> in mathlib (which is why you can't use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=abs#doc\">docs#abs</a> with it). In fact, there's no mention of <code>Dyadic</code> in mathlib at all.</p>",
        "id": 570404824,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769541932
    },
    {
        "content": "<p>For <code>add_right_cancel</code>, this seems to be another case where there is a polymorphic method that can handle these: <code>#check @add_right_cancel Int</code>. <code>neg_add</code> appears to be another instance of this behavior. There is a <code>Rat.neg_sub</code> so this does just seem like an oversight. I'm guessing part of the cause is that many users are downstream of mathlib so they just use the mathlib polymorphic methods and some of these oversights may just go unnoticed.</p>",
        "id": 570404942,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1769541965
    },
    {
        "content": "<p>From git history it appears that Dyadic is only 5 months old so it's still relatively new, it may be that there is some missing API</p>",
        "id": 570405257,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1769542065
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1015002\">Pieter Collins</span> <a href=\"#narrow/channel/113489-new-members/topic/Dyadic.20numbers/near/570301478\">said</a>:</p>\n<blockquote>\n<p>This is in principle nice, but there are <em>at lot</em> of typeclasses! This makes it really hard to find what is available. (Int has way more than 100!) Are there any good ways to navigate this?</p>\n</blockquote>\n<p>This is not exactly answering your question, but sometimes I can avoid searching myself by using tactics like <code>exact?</code>/<code>apply?</code>/<code>rw?</code> to help direct my search. If I know I want something in a specific shape, like neg_add for Rat for example I could write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact?</span>\n</code></pre></div>\n<p>to help show me if it's already available in some form.</p>",
        "id": 570410363,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1769543786
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1015002\">Pieter Collins</span> <a href=\"#narrow/channel/113489-new-members/topic/Dyadic.20numbers/near/570301478\">said</a>:</p>\n<blockquote>\n<p>I've also been having a hard time \"unfolding\" things, especially with all the casts and notations around. Is there any way of simplifying out all notations, derived operations from typeclasses etc?</p>\n</blockquote>\n<p>Are you looking for something like <code>set_option pp.all true</code>?</p>",
        "id": 570410683,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1769543894
    },
    {
        "content": "<p>Oh I just noticed an oversight: <code>Init.Data.Dyadic.Instances</code> actually defines some instances which are supposed to make grind work but they are all private and not exposed! Here's a fix: <a href=\"https://github.com/leanprover/lean4/pull/12199\">lean4#12199</a></p>",
        "id": 570442718,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769556931
    },
    {
        "content": "<p>oh that wasn't intentional?</p>",
        "id": 570443427,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769557375
    },
    {
        "content": "<p>is the other dyadic file with only private stuff in it also not intentional?</p>",
        "id": 570443523,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1769557450
    },
    {
        "content": "<p>There's another one?</p>",
        "id": 570444810,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769558272
    },
    {
        "content": "<p>Fixed that one too</p>",
        "id": 570444817,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1769558277
    },
    {
        "content": "<p>We use dyadic numbers in the CGT repo, so it'd be appreciated if someone added its relevant instances to Mathlib.</p>",
        "id": 570466262,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1769574286
    }
]