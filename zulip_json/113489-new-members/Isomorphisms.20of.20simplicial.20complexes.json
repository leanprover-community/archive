[
    {
        "content": "<p>Hello! I'm orienting myself with Lean 4/mathlib this summer through a project on abstract simplicial complexes. Hoping for some pointers for a canonical way to solve the following issue:</p>\n<p>I'm writing some additions to <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Convex/SimplicialComplex/Basic.html#Geometry.SimplicialComplex\">Geometry.SimplicialComplex</a>. Specifically, I'm currently trying to get a plausibly correct notion of isomorphism between two simplicial complexes. We'd like to follow the usual textbook definition: some pair of simplicial maps that are mutually inverses. Intuitively, an isomorphism should be a relabeling of vertices.</p>\n<p>It seems reasonable to want the relation to have type signature</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>This should also behave like an honest-to-God isomorphism/equivalence relation, wherein we ideally don't need to re-implement things that already exist. There are some practical reasons to want this for operations like joins. But, now we run into the issue of what structure to target:</p>\n<ul>\n<li>Equivalence is a no-go, since it requires a relation with type signature <code>‚ç∫ -&gt; ‚ç∫ -&gt; Prop</code>.<ul>\n<li>One could likely use DirectSum to make this work on the level of inclusions, which seems painful.</li>\n</ul>\n</li>\n<li>EquivLike is almost plausible, except it wants Geometry.SimplicialComplex to be a class, not a structure.<ul>\n<li>Simplicial isomorphism really only needs to satisfy the inverse conditions on the set of vertices. In general, a bijection between E and F might not exist. Take two finite abelian groups of different sizes as an artificial example.</li>\n<li>So, extending <code>E ‚ãç F</code> would seemingly require some additional axiom like <code>total : ‚àÄ x : E, {x} ‚àà faces</code> to make sense, given the above point. Attempting to write definitions of subdivisions seems difficult in this case, especially if the complex is finite.</li>\n</ul>\n</li>\n</ul>\n<p>This is where my lack of familiarity wrt mathlib4 comes in. Are there any existing features that one should target in this case? Any canonical/clever ways to (ab)use the above that I'm missing? Questions about or poking holes in the above logic is very much welcome. Thanks!</p>",
        "id": 528079622,
        "sender_full_name": "Garett Cunningham",
        "timestamp": 1752153372
    },
    {
        "content": "<p>Sorry to add to this, but would still love to hear some suggestions. Unfortunately, the whims of funding and day-to-day responsibilities demand that forward progress be made, so I've elected to circumvent mathlib for the moment, since it seems to be the path of least resistance. I'm willing to accept this as technical debt if a better solution is proposed and fix code off the clock.</p>\n<p>I've defined a structure for simplicial maps and a collection of propositions to capture the same effect:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">}</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">SimplicialMap</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">::</span>\n<span class=\"w\">    </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">F</span>\n<span class=\"w\">    </span><span class=\"n\">is_simplicial</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">faces</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">image</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"bp\">.</span><span class=\"n\">faces</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isSimplicialInverse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimplicialMap</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimplicialMap</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">vertices</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">EqOn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"bp\">.</span><span class=\"n\">vertices</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isSimpliciallyIso</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimplicialMap</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimplicialMap</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">isSimplicialInverse</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" ‚âÖ \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isSimpliciallyIso</span>\n</code></pre></div>\n<p>This gives the desired type signature</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Geometry</span><span class=\"bp\">.</span><span class=\"n\">SimplicialComplex</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n</code></pre></div>\n<p>at the cost of working somewhat independent of mathlib. It seems a shame to rely on a workaround like this, so I would still love to hear any suggestions. Thanks!</p>",
        "id": 528596725,
        "sender_full_name": "Garett Cunningham",
        "timestamp": 1752476503
    }
]