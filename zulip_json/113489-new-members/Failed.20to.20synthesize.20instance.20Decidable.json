[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">mTerm</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mTerm</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mTerm</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">vs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">vs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">vs</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">none</span>\n</code></pre></div>\n<p>The above code produces: <code>failed to synthesize instance Decidable (vs = s)</code>. What does this mean?</p>",
        "id": 467345353,
        "sender_full_name": "nrs",
        "timestamp": 1725392275
    },
    {
        "content": "<p>In order to use <code>if p then ... else ...</code> the proposition <code>p</code> needs to be decidable. In this case, you need decidable equality on <code>mTerm</code>. If you write </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">mTerm</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n</code></pre></div>\n<p>then you should be good to go</p>",
        "id": 467345935,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1725392442
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/stream/113489-new-members/topic/Failed.20to.20synthesize.20instance.20Decidable/near/467345935\">said</a>:</p>\n<blockquote>\n<p>In order to use <code>if p then ... else ...</code> the proposition <code>p</code> needs to be decidable. In this case, you need decidable equality on <code>mTerm</code>. If you write </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span><span class=\"w\"> </span><span class=\"n\">mTerm</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mTerm</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n</code></pre></div>\n<p>then you should be good to go</p>\n</blockquote>\n<p>that worked, thank you! by any chance, would you know where I could read about what <code>deriving DecidableEq</code> does?</p>",
        "id": 467346288,
        "sender_full_name": "nrs",
        "timestamp": 1725392553
    },
    {
        "content": "<p>this derives a decidable eq isntance for your type. You may be better off reading the documentation around <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DecidableEq#doc\">docs#DecidableEq</a></p>",
        "id": 467346513,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1725392627
    },
    {
        "content": "<p>if you really want to see how it's derived, you could look at the deriving handler, but getting its name would require some digging</p>",
        "id": 467346624,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1725392654
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/stream/113489-new-members/topic/Failed.20to.20synthesize.20instance.20Decidable/near/467346624\">said</a>:</p>\n<blockquote>\n<p>if you really want to see how it's derived, you could look at the deriving handler, but getting its name would require some digging</p>\n</blockquote>\n<p>noted, thanks for taking the time!</p>",
        "id": 467346716,
        "sender_full_name": "nrs",
        "timestamp": 1725392690
    },
    {
        "content": "<p>It seems that the code that derives decidable eqs can be found in this file: <a href=\"https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Elab/Deriving/DecEq.lean\">https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Elab/Deriving/DecEq.lean</a></p>",
        "id": 467347161,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1725392818
    },
    {
        "content": "<p><code>deriving</code> clauses invoke so-called deriving handlers, and these try to automatically synthesize code to implement a given typeclass, if possible.</p>\n<p><code>Decidable p</code> is a fancy <code>Bool</code> whose values contain a proof or disproof of <code>p</code>. So, just think about how you'd write a <code>Bool</code>-valued equality procedure for <code>mTerm</code>, and then to elevate it to a <code>DecidableEq mTerm</code> instance it needs to also come up with proofs for why each <code>true</code> or <code>false</code> it returns is correct. Luckily this boilerplate can be automated with <code>deriving DecidableEq</code> most of the time.</p>",
        "id": 467347249,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1725392852
    },
    {
        "content": "<p>(note that <code>DecidableEq X</code> is an abbreviation for <code>fun (x y : X) =&gt; Decidable (x = y)</code>)</p>",
        "id": 467347535,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1725392949
    },
    {
        "content": "<p>I'll be mulling over your descriptions and the definitions and reading the code, thank you very much to both for taking the time!!</p>",
        "id": 467347915,
        "sender_full_name": "nrs",
        "timestamp": 1725393074
    }
]