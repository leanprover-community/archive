[
    {
        "content": "<p>I'm working on a piece that looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PeanoAxioms</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">equiv_zero</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">zero</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv_zero</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">zero</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_apply</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">equiv_succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">apply_fun</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span>\n<span class=\"w\">    </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Q</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">equiv_succ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">apply_symm_apply</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Note I have to insert these useless <code>change</code> statements for myself to keep track of whether <code>zero</code> or <code>succ</code> in my goal view means <code>P.zero</code> or <code>Q.zero</code>, <code>P.succ</code> or <code>Q.succ</code>, etc.</p>\n<p>Of course I can now remove these <code>change</code> statements, but was there any way to make the goal view show the \"expanded\" names for <code>zero</code> and <code>succ</code>?</p>",
        "id": 526823827,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1751468741
    },
    {
        "content": "<p>Make <code>PeanoAxioms</code> not a class maybe?</p>",
        "id": 526823975,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751468781
    },
    {
        "content": "<p>Working with what I got from a book, though definitely could suggest an edit to it.</p>\n<p>What alternatives are there?</p>",
        "id": 526824276,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1751468849
    },
    {
        "content": "<p>How about a <code>structure</code>?</p>",
        "id": 526824582,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751468925
    },
    {
        "content": "<p>Oh yeah using a <code>structure</code> fixes it. Is that more idiomatic?</p>",
        "id": 526825175,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1751469063
    },
    {
        "content": "<p>Sent <a href=\"https://github.com/teorth/analysis/pull/128\">https://github.com/teorth/analysis/pull/128</a></p>",
        "id": 526828012,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1751469821
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"418569\">Dan Abramov</span> has marked this topic as resolved.</p>",
        "id": 526828026,
        "sender_full_name": "Notification Bot",
        "timestamp": 1751469825
    },
    {
        "content": "<p>There are many things in mathlib which are classes, and work great because 99% of the time there will only be one instance. However the moment you want to talk about two instances of a class on one type there is always this tension. For example there are theorems about <em>all</em> the topological space structures you can put on a type, which become slightly tedious to state because <code>TopologicalSpace</code> is a class and 99% of the time your spaces have exactly one topology. But because it is inconvenient in the 1% of the time where you have two topologies, is not a good argument for making it a structure and then losing the convenience of the typeclass system the other 99% of the time. These arguments are delicate and will have to be weighed up within the context of the book I guess, but there is no one right or wrong answer here.</p>",
        "id": 526836449,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1751472349
    },
    {
        "content": "<p>Does the fact that ‘PeanoAxioms’ is not parametrized by a type but rather carries the type internally as a property (it’s ‘class PeanoAxioms where’ not ‘class PeanoAxioms X where’) make that determination of class vs structure easier? I struggle to even think of what a type class without a type parameter gets one.</p>",
        "id": 526843274,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751474810
    },
    {
        "content": "<p>yes it definitely should be a structure here because it's not on X</p>",
        "id": 526844483,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751475311
    },
    {
        "content": "<p>I don't think it obviously shouldn't be a class. A class is for data that you want to be able to use without mentioning it — here, using a class means that all the theory can refer to Peano axioms without explicitly passing theory from theorem to theorem. Later, someone could implement the axioms with an instance, and it will all then just work. (A parameterless class is sort of like dynamic scoping or dependency injection if you want.)</p>\n<p>What gets dicey is when there's more than one instance. Lean assumes that there is at most one applicable instance, and things don't work right if you break this. In this thread we see how pretty printing obscures the fact there are multiple instances, but also Lean can choose the 'wrong' instance.</p>",
        "id": 526870627,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751486124
    },
    {
        "content": "<p>If you're not stating your lemmas or your definitions with <code>[PeanoAxioms]</code> and you also never register any instances and you also always write out the specific instance you are using then I don't see the point of it being a class</p>",
        "id": 526887023,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751494354
    },
    {
        "content": "<blockquote>\n<p>If you're not stating your lemmas or your definitions with <code>[PeanoAxioms]</code></p>\n</blockquote>\n<p>Right, my assumption is that you'd write your theory with <code>[PeanoAxioms]</code>. Then downstream someone can instantiate it with their favorite implementation. It's like having <code>axiom</code>s that can be instantiated with something concrete later.</p>\n<p>Enterprise Java software engineering calls this \"dependency injection.\"</p>",
        "id": 526889412,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1751495821
    },
    {
        "content": "<p>+1 the change <a href=\"https://github.com/teorth/analysis/pull/128\">https://github.com/teorth/analysis/pull/128</a> is right for how the rest of the file is written, while parameterless typeclasses have some good uses to do dynamic scoping / dep injection type patterns. I just realized that one can overwrite the default instance in an namespace, so namespaces can serve as dep injection containers:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">x</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- 3</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">test_default</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">x</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- 4</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- also 4, as new X instance was implicitly passed</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">test</span>\n</code></pre></div>",
        "id": 526906955,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1751510690
    }
]