[
    {
        "content": "<p>Hello! I have been learning Lean for a month already. </p>\n<p>I am wondering whether there is any way of doing algebraic simplification (as in a CAS like Sympy, Mathematica, etc) to simplify expressions. I am finding that some problems involving vectors, norms, etc... require a lot of steps just for typical algebraic manipulations/simplification. Sometimes take the majority of the code, while the formalization and key steps are much simpler in terms of code length. <br>\nI am using mathlib and real numbers mostly.</p>\n<p>Usually things like canceling inverse terms in long products or numerators with denominators is not straightforward, but functions like Sympy's simplify() usually solve them. </p>\n<p>I didn't find anything similar yet, so maybe someone here can point me to an appropiate tactic or tool?<br>\nI think this would improve a lot my experience with Lean for verifying some textbook problems solutions.</p>\n<p>Thanks!</p>",
        "id": 535030102,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755556867
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ 176 / 105 = sorry</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 535033560,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755559378
    },
    {
        "content": "<p>is <code>norm_num</code> what you're looking for?</p>",
        "id": 535033587,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755559387
    },
    {
        "content": "<p>Do you know about field_simp and ring?</p>",
        "id": 535033725,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1755559521
    },
    {
        "content": "<p>giving examples would greatly help us help you</p>",
        "id": 535033759,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755559547
    },
    {
        "content": "<p>Sure! Sorry I should have started with an example.</p>\n<p>Consider the following example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span>\n<span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">]</span>\n<span class=\"n\">huv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟪</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">⟫</span><span class=\"w\"> </span><span class=\"c1\">-- implies aligned</span>\n<span class=\"n\">huv'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span>\n<span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"bp\">‖-</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I would like for the <code>x</code> and <code>x⁻¹</code> to cancel automatically, but <code>x * y * x⁻¹</code> is not simplified with <code>field_simp</code> or <code>ring_nf</code>. Moreover, I would be happy for it to automatically factor <code>c * y</code> and get something like <br>\n<code>‖(c * y) • ((‖v‖⁻¹ ^ 3) • v - (‖u‖⁻¹ ^ 3) • u)‖</code><br>\nor <br>\n<code>|c * y| * ‖(‖v‖⁻¹ ^ 3) • v - (‖u‖⁻¹ ^ 3) • u‖</code><br>\n in the left hand side. Most computer algebra systems, like Sympy, can get to this point, so I was wondering if there is any algorithm implemented with similar capabilities.</p>",
        "id": 535090593,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755596408
    },
    {
        "content": "<p>You did call it as <code>field_simp [hx]</code>, right? The cancelling seems like it could be workable, but might not work yet</p>",
        "id": 535120587,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755607542
    },
    {
        "content": "<p>The docstring for <code>field_simp</code> says</p>\n<blockquote>\n<p>If you have objects with an <code>IsUnit x</code> instance like <code>(x : R) (hx : IsUnit x)</code>, you should lift them with <code>lift x to Rˣ using id hx; rw [IsUnit.unit_of_val_units] clear hx</code> before using <code>field_simp</code>.</p>\n</blockquote>\n<p>There appears to be a typo. I'm not sure what was meant. But if you can guess, you could start with <code>rw [← isUnit_iff_ne_zero] at hx hy hc h1 h2</code>, then try doing some lifts.</p>",
        "id": 535122062,
        "sender_full_name": "Richard Copley",
        "timestamp": 1755607952
    },
    {
        "content": "<p>(Please see <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>; if you had formatted your example as below, it would be easier for people to jump in and try things out, and you might get more ideas.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">RealInnerProductSpace</span>\n\n<span class=\"kn\">example</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">huv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">⟪</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">⟫</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- implies aligned</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">huv'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‖-</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 535122407,
        "sender_full_name": "Richard Copley",
        "timestamp": 1755608059
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> Yes, I have tried that</p>",
        "id": 535124171,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755608550
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400544\">@Richard Copley</span> Just read <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> and makes a lot of sense, thanks</p>",
        "id": 535124257,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755608570
    },
    {
        "content": "<p>I suspect everything you're asking about is <em>possible</em> but nothing exists right now</p>",
        "id": 535124532,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755608644
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113489-new-members/topic/Algebraic.20simplification.20.2F.20CAS/near/535124532\">said</a>:</p>\n<blockquote>\n<p>I suspect everything you're asking about is <em>possible</em> but nothing exists right now</p>\n</blockquote>\n<p>For example, as far as I could see the theorem <code>‖u‖ * ‖v‖ = ⟪u, v⟫ → ‖u+v‖ = ‖u‖ + ‖v‖</code> (which I guess has to be used at some point) is not in <code>Mathlib.Analysis.InnerProductSpace.Basic</code>. Here's a proof</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">+</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">norm_add_eq_iff_real</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">inner_eq_norm_mul_iff_real</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">huv</span>\n</code></pre></div>",
        "id": 535128006,
        "sender_full_name": "Nikolas Tapia",
        "timestamp": 1755609738
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"947360\">@Nikolas Tapia</span> Yes, thanks, I was using <code>inner_eq_norm_mul_iff_real : ⟪x, y⟫ = ‖x‖ * ‖y‖ ↔ ‖y‖ • x = ‖x‖ • y</code> for doing something similar. The problem is all the little algebraic manipulations required in between, which are not trivial to do in Lean (with my little experience).</p>",
        "id": 535129232,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755610127
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"400544\">Richard Copley</span> <a href=\"#narrow/channel/113489-new-members/topic/Algebraic.20simplification.20.2F.20CAS/near/535122062\">said</a>:</p>\n<blockquote>\n<p>The docstring for <code>field_simp</code> says</p>\n<blockquote>\n<p>If you have objects with an <code>IsUnit x</code> instance like <code>(x : R) (hx : IsUnit x)</code>, you should lift them with <code>lift x to Rˣ using id hx; rw [IsUnit.unit_of_val_units] clear hx</code> before using <code>field_simp</code>.</p>\n</blockquote>\n<p>There appears to be a typo. I'm not sure what was meant. But if you can guess, you could start with <code>rw [← isUnit_iff_ne_zero] at hx hy hc h1 h2</code>, then try doing some lifts.</p>\n</blockquote>\n<p>I have been checking this, but I didn't manage to get any improvement. I don't understand at all what is the benefit of lifting to the units of <code>ℝ</code>. I was expecting <code>field_simp [hx]</code> to act similarly, as I provided that <code>x ≠ 0</code>.</p>",
        "id": 535129914,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755610332
    },
    {
        "content": "<p>Yeah, I think the units are a red herring. This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">field_simp</span>\n</code></pre></div>",
        "id": 535131361,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755610746
    },
    {
        "content": "<p>It's getting the <code>x</code> and <code>x⁻¹</code> together that <code>field_simp</code> doesn't do</p>",
        "id": 535131522,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755610794
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> Yes, in such simple situations it works, but consider the example above that Richard shared. If we have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">‖-</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖⁻¹</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>then <code>field_simp [hx]</code> simplifies it to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">‖-</span><span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">      </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‖</span><span class=\"n\">v</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">u</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which is not super useful, since <code>x</code> could be cancelled, and some other simplifications could be devised.</p>",
        "id": 535133572,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755611318
    },
    {
        "content": "<p>I think it gets confused as soon as there are too many variables:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">field_simp</span>\n</code></pre></div>\n<p>yields</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unsolved</span><span class=\"w\"> </span><span class=\"n\">goals</span>\n<span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 535135685,
        "sender_full_name": "Nikolas Tapia",
        "timestamp": 1755611875
    },
    {
        "content": "<p>Note that <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> and co have a reimplementation of <code>field_simp</code> in the works, and I believe it solves this specific issue. I think therefore it's not particularly useful to spend time debugging <code>field_simp</code> this month <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 535135951,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755611939
    },
    {
        "content": "<p>Exactly <span class=\"user-mention\" data-user-id=\"947360\">@Nikolas Tapia</span>, that's my point, that it stops working as desired if you have a more convoluted context. Nice to know that there will be an improved version of it, thanks <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>!</p>",
        "id": 535140118,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755613070
    },
    {
        "content": "<p>But therefore I guess there is no way of using an equivalent of a CAS inside Lean or a tactic that works like it, and the main options for simplifications are tactics like ring_nf, field_simp and simp?</p>",
        "id": 535140383,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755613146
    },
    {
        "content": "<p>... and the shiny new <code>grind</code> tactic</p>",
        "id": 535140595,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1755613207
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span>  Unfortunately, grind is not powerful enough for this case :(</p>",
        "id": 535142020,
        "sender_full_name": "Izan Beltran",
        "timestamp": 1755613627
    },
    {
        "content": "<p>I'm one of the people working on the field_simp rewrite: we hope to open the real PR this week (and then, reviewing will be very welcome :-))</p>",
        "id": 535169652,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1755622432
    },
    {
        "content": "<p>Is everyone who could plausibly review it working on it? :)</p>",
        "id": 535171969,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1755623375
    },
    {
        "content": "<p>I hope not... but indeed, that tends to be the issue with meta code.</p>",
        "id": 535172541,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1755623591
    },
    {
        "content": "<p>5 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/PR.20for.20new.20field_simp.20implementation/with/535190387\">#mathlib4 &gt; PR for new field_simp implementation</a> by <span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span>.</p>",
        "id": 535190390,
        "sender_full_name": "Notification Bot",
        "timestamp": 1755631530
    }
]