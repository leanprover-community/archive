[
    {
        "content": "<p>I have been trying to figure out why this rw won't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Star</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CommMonoid</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n\n<span class=\"kn\">postfix</span><span class=\"o\">:</span><span class=\"mi\">100</span><span class=\"w\">  </span><span class=\"s2\">\"‚ãÜ\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Star</span><span class=\"bp\">.</span><span class=\"n\">star</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">InvolutionMonoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">Œ±</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">involutionmonoid</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InvolutionMonoid</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Pow</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Surjective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">invol</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">InvolutionMonoid</span><span class=\"w\"> </span><span class=\"n\">M‚ÇÇ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">star_involutive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Involutive</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">‚ãÜ‚ãÜ</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">‚ãÜ‚ãÜ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">invol</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚ü®</span><span class=\"n\">x‚Çê‚Çêinv</span><span class=\"o\">,</span><span class=\"n\">hx‚Çê</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span><span class=\"n\">xinv</span><span class=\"o\">,</span><span class=\"n\">hx</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ‚ãÜ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"bp\">‚Üê</span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">xinv</span><span class=\"o\">,</span><span class=\"n\">star_involutive</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">star_mul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">   </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">‚ãÜ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">calc</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">‚ãÜ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">invol</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star_mul</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚ü®</span><span class=\"n\">xinv</span><span class=\"o\">,</span><span class=\"n\">hx</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span><span class=\"n\">yinv</span><span class=\"o\">,</span><span class=\"n\">hy</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"bp\">‚Üê</span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"bp\">‚Üê</span><span class=\"n\">invol</span><span class=\"w\"> </span><span class=\"n\">xinv</span><span class=\"o\">,</span><span class=\"bp\">‚Üê</span><span class=\"n\">invol</span><span class=\"w\"> </span><span class=\"n\">yinv</span><span class=\"o\">]</span>\n<span class=\"w\">   </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">yinv</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xinv</span><span class=\"bp\">‚ãÜ</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">this</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Even in conv mode, isolating the term, it doesn't seem to recognise it and i can't seem to figure out why.</p>",
        "id": 542172505,
        "sender_full_name": "Yan Yablonovskiy üá∫üá¶",
        "timestamp": 1759199481
    },
    {
        "content": "<p>I don't know about the math involved here, but running into \"surely this is the same expression\" problems has been my most frustrating experience with Lean so far too, so I tried to see what's happening out of empathy for a fellow math formalizer :)</p>\n<p>Started with the definition of <code>*</code> which looks identical, but if you further click on <code>instHMul</code> you will see two different instances.</p>\n<p><a href=\"/user_uploads/3121/gZQ3oIJnr_SL7YFdS5cBor0d/Screenshot-2025-09-29-at-8.41.16PM.png\">Screenshot 2025-09-29 at 8.41.16‚ÄØPM.png</a><br>\n<a href=\"/user_uploads/3121/KEXqiJOt5mmPJJFKeDVJ9RKK/Screenshot-2025-09-29-at-8.41.23PM.png\">Screenshot 2025-09-29 at 8.41.23‚ÄØPM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/gZQ3oIJnr_SL7YFdS5cBor0d/Screenshot-2025-09-29-at-8.41.16PM.png\" title=\"Screenshot 2025-09-29 at 8.41.16‚ÄØPM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"389x116\" src=\"/user_uploads/thumbnail/3121/gZQ3oIJnr_SL7YFdS5cBor0d/Screenshot-2025-09-29-at-8.41.16PM.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/KEXqiJOt5mmPJJFKeDVJ9RKK/Screenshot-2025-09-29-at-8.41.23PM.png\" title=\"Screenshot 2025-09-29 at 8.41.23‚ÄØPM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"391x105\" src=\"/user_uploads/thumbnail/3121/KEXqiJOt5mmPJJFKeDVJ9RKK/Screenshot-2025-09-29-at-8.41.23PM.png/840x560.webp\"></a></div><p>Could this be cause of the problem? I have no idea how this happens and what to do next.</p>",
        "id": 542177785,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1759203848
    },
    {
        "content": "<p>Thank you! I couldn't find it. As to the math, it is a parallel of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Function.Surjective.monoid#doc\">docs#Function.Surjective.monoid</a> for involution monoids. As far as mathlib goes, this is like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=StarAddMonoid#doc\">docs#StarAddMonoid</a> but with multiplicative, mostly for practice. But also because the quotient space there builds up for rings and i am making a quotient space for something different.</p>",
        "id": 542178364,
        "sender_full_name": "Yan Yablonovskiy üá∫üá¶",
        "timestamp": 1759204403
    },
    {
        "content": "<p>You seem to have <code>Mul M‚ÇÇ</code> and <code>Monoid M‚ÇÇ</code> as your assumptions.  These are going to be two completely unrelated multiplications on this type.</p>",
        "id": 542178572,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759204588
    },
    {
        "content": "<p>Thank you so much, yes this was it!</p>",
        "id": 542178693,
        "sender_full_name": "Yan Yablonovskiy üá∫üá¶",
        "timestamp": 1759204709
    },
    {
        "content": "<p>I also suspect that <code>Pow</code> should not be there, as any monoid should already have a power by Nat.</p>",
        "id": 542178709,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759204731
    },
    {
        "content": "<p>Ah that makes sense, seems like simply removing <code>[Mul \\a]</code> fixes the issue. Is it possible to imagine a better error message by Lean, so that one doesn't need to go around clicking every symbol to find the diff?</p>",
        "id": 542178770,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1759204778
    },
    {
        "content": "<p>There was a discussion about improving this and I thought that Kyle had a more verbose error message.  I'm not sure what the details were and if it should apply here.</p>",
        "id": 542178875,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759204849
    },
    {
        "content": "<p>The discussion that I had in mind was <a class=\"stream-topic\" data-stream-id=\"341532\" href=\"/#narrow/channel/341532-lean4-dev/topic/Misleading.20error.20message.20on.20type.20mismatch/with/501387029\">#lean4 dev &gt; Misleading error message on type mismatch</a> and, in particular, <a href=\"https://github.com/leanprover/lean4/pull/7172\">lean4#7172</a>, which I realize now is a draft.</p>",
        "id": 542208720,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1759219686
    }
]