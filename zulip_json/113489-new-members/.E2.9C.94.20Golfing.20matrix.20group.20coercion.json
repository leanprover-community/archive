[
    {
        "content": "<p>In many situations where as a mathematician I know that A is simply a subtype of B (e.g. the special orthogonal group is simply a subset of the orthogonal group) I have found Mathilb does a fantastic job of reading my mind and the right instance of <code>Coe</code> is already implemented and I don't have to think about it.</p>\n<p>But the following is the shortest route that I seem to be able to find to get SO(n) ‚äÜ O(n):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">so_sub_o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">orthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">   </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">SetLike</span><span class=\"bp\">.</span><span class=\"n\">coe_mem</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"w\">   </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mem_specialOrthogonalGroup_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">   </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚ü©</span>\n</code></pre></div>\n<p>Am I missing something? Is there a simpler way? Is there merely a missing <code>Coe</code> instance that ought to be in mathlib? Is there some subtle reason why it wasn't added?</p>",
        "id": 527884051,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066284
    },
    {
        "content": "<p>I am not sure it would be a coercion, normally.</p>",
        "id": 527884446,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066398
    },
    {
        "content": "<p>But it does feel like that lemma should exist!</p>",
        "id": 527884477,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066406
    },
    {
        "content": "<p><code>Matrix.specialOrthogonalGroup_le_orthogonalGroup</code> is what you want.</p>",
        "id": 527884652,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066456
    },
    {
        "content": "<p>Well, I got my hopes up after</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sl_sub_gl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">SpecialLinearGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">GeneralLinearGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span>\n</code></pre></div>\n<p>does work!</p>",
        "id": 527884736,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066480
    },
    {
        "content": "<p>oh that's interesting.</p>",
        "id": 527884819,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066503
    },
    {
        "content": "<p>Huh, I wonder why <code>exact?</code> didn't find that lemma</p>",
        "id": 527884900,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066528
    },
    {
        "content": "<p>Ah, but <code>GeneralLinearGroup</code> is a type.</p>",
        "id": 527884901,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066528
    },
    {
        "content": "<p>Ohhh is this about things being standalone types vs. <code>Set (Matrix ...)</code>?</p>",
        "id": 527885005,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066558
    },
    {
        "content": "<p>Submonoid, but yes.</p>",
        "id": 527885049,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066568
    },
    {
        "content": "<p>Oh true yes good point.</p>",
        "id": 527885067,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066575
    },
    {
        "content": "<p>Anyway I think my immediate question here is completely solved, but if anyone has any other insights to communicate about why this corner of mathlib was designed the way it was I'd love to hear 'em</p>",
        "id": 527885196,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066623
    },
    {
        "content": "<p>thanks much!</p>",
        "id": 527885205,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066626
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> has marked this topic as resolved.</p>",
        "id": 527885245,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752066644
    },
    {
        "content": "<p>I guess I'm also curious how you found <code>specialOrthogonalGroup_le_orthogonalGroup</code>; my mainstays so far of<br>\n(a) write a standalone lemma and see if <code>by exact?</code> solves it<br>\n(b) <a href=\"http://leansearch.net\">leansearch.net</a><br>\n(c) just look through mathlib docs hoping I find the appropriate lemma<br>\ndid not succeed for me this time</p>",
        "id": 527885441,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066705
    },
    {
        "content": "<p>Oh to be clear</p>",
        "id": 527885464,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066713
    },
    {
        "content": "<p>It doesn't exist</p>",
        "id": 527885474,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066716
    },
    {
        "content": "<p>oh haha</p>",
        "id": 527885506,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066724
    },
    {
        "content": "<p>That is what you want as in, I think that is surely what it would be called.</p>",
        "id": 527885511,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066726
    },
    {
        "content": "<p>Understood, thanks</p>",
        "id": 527885553,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752066736
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> has marked this topic as unresolved.</p>",
        "id": 527885583,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752066747
    },
    {
        "content": "<p>It is a little odd in some ways that GeneralLinearGroup and SpecialLinearGroup are defined as types, when orthogonalGroup is not. I don't have any insight as to why that is the case though.</p>",
        "id": 527885584,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066747
    },
    {
        "content": "<p>Adding <code>specialOrthogonalGroup_le_orthogonalGroup</code> would be a sensible PR.</p>",
        "id": 527885621,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066757
    },
    {
        "content": "<p>Ah. So <code>Matrix.specialUnitaryGroup_le_unitaryGroup</code> DOES exist</p>",
        "id": 527886232,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066965
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.specialUnitaryGroup_le_unitaryGroup#doc\">docs#Matrix.specialUnitaryGroup_le_unitaryGroup</a></p>",
        "id": 527886253,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066971
    },
    {
        "content": "<p>And that is equivalent. But it seems sensible to have the orthogonal group spelling.</p>",
        "id": 527886315,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752066992
    },
    {
        "content": "<p>Oh nice ok, I had already encountered that orthogonal was an alias of unitary from the documentation</p>",
        "id": 527886413,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067022
    },
    {
        "content": "<p>I'm now wondering why my recursive grep for <code>group\\S*le\\S*group</code> didn't find that</p>",
        "id": 527886472,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067040
    },
    {
        "content": "<p>abbrev rather than alias but yes.</p>",
        "id": 527886481,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752067045
    },
    {
        "content": "<p>That would be the mysteries of regexes, beyond my ken.</p>",
        "id": 527886511,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752067056
    },
    {
        "content": "<p>Sorry, you are correct, I just meant alias in the informal english language sense</p>",
        "id": 527886520,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067061
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> has marked this topic as resolved.</p>",
        "id": 527886604,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752067087
    },
    {
        "content": "<p>I am a little baffled about the way that the general linear group is treated. But that is beyond the scope of the question. If you make a PR adding this, it'll be short and simple and I'd be happy to give it a first look over.</p>",
        "id": 527886690,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752067118
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527886472\">said</a>:</p>\n<blockquote>\n<p>I'm now wondering why my recursive grep for <code>group\\S*le\\S*group</code> didn't find that</p>\n</blockquote>\n<p>(Turned out I simply didn't realize <code>ag</code>'s default case insensitivity gets turned off if you use a nontrivial regex; nothing generalizably interesting to be learned here)</p>",
        "id": 527887045,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067235
    },
    {
        "content": "<p>Yeah, the remaining thing that's not totally clear to me is the discrepancy between</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"c1\">-- ... Submonoid (...)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialUnitaryGroup</span><span class=\"w\"> </span><span class=\"c1\">-- ... Submonoid (...)</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">SpecialLinearGroup</span><span class=\"w\"> </span><span class=\"c1\">-- ... Type (...)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">GeneralLinearGroup</span><span class=\"w\"> </span><span class=\"c1\">-- ... Type (...)</span>\n</code></pre></div>",
        "id": 527888573,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067617
    },
    {
        "content": "<p>But that sounds like that's the same thing as what you're saying baffles you</p>",
        "id": 527888707,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067643
    },
    {
        "content": "<p>I wonder if <a href=\"https://github.com/leanprover-community/mathlib4/blob/59726ffacf54edc7f615743843f3110b4de33e71/Mathlib/LinearAlgebra/UnitaryGroup.lean#L136-L139\">this TODO</a> is relevant</p>",
        "id": 527889566,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752067866
    },
    {
        "content": "<p>Is there a more idiomatic way to actually use the subset relationship between these submonoids other than:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">so_sub_o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">orthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">   </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialUnitaryGroup_le_unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">g</span>\n</code></pre></div>",
        "id": 527891980,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752068543
    },
    {
        "content": "<p>I thought just applying the &lt;=-yielding lemma as a function would work, but it didn't.</p>",
        "id": 527892124,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752068589
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527885005\">said</a>:</p>\n<blockquote>\n<p>Ohhh is this about things being standalone types vs. <code>Set (Matrix ...)</code>?</p>\n</blockquote>\n<p>We aren't doing set theory here <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527892772,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752068784
    },
    {
        "content": "<p>I'm familiar with the distinction between <a href=\"https://ncatlab.org/nlab/show/material+set+theory\">material vs. structural set theory</a>, but I'm not sure what this comment means in the context of lean <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527893094,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752068884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527891980\">said</a>:</p>\n<blockquote>\n<p>a more idiomatic way to actually use the subset relationship between these submonoids</p>\n</blockquote>\n<p>An idiomatic way to use submonoids would be to use them as submonoids... do you really need the subtype?</p>",
        "id": 527893134,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752068897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527893094\">said</a>:</p>\n<blockquote>\n<p>I'm familiar with the distinction between <a href=\"https://ncatlab.org/nlab/show/material+set+theory\">material vs. structural set theory</a>, but I'm not sure what this comment means in the context of lean <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>\n</blockquote>\n<p>It's a tongue in cheek comment saying that we're doing type theory and we like to bundle things (as submonoid, subring, submodule) than to just use the bare \"Set\" that mathematicians think they are</p>",
        "id": 527893337,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752068951
    },
    {
        "content": "<p>they aren't just subsets, they're subgroups <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 527893369,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752068961
    },
    {
        "content": "<p>Ah, okay, that helps a bit, in that we're trying to bundle as much structure as possible...</p>\n<p>so maybe I'm doing something wrong by thinking too much in terms of points. I was about to say I thought I wanted to know the simplest way of getting from  the fact that I have <code>g : Matrix.specialOrthogonalGroup n ‚Ñù</code> to the goal of some term of type <code>Matrix.orthogonalGroup n ‚Ñù</code>...</p>",
        "id": 527893591,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069036
    },
    {
        "content": "<p>Like are you saying I should think more point-free and ask for the group homomorphism that is the inclusion of the one group into the other?</p>",
        "id": 527893702,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069070
    },
    {
        "content": "<p>I'm not entirely sure the ambient proof this issue is a part of makes that easy</p>",
        "id": 527893836,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069114
    },
    {
        "content": "<p>But I don't want to let the scope of my question spiral too far here</p>",
        "id": 527893892,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069130
    },
    {
        "content": "<p>No, I'm saying that you use them as submonoids:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">so_sub_o</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">gSO</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">orthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialUnitaryGroup_le_unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">gSO</span>\n</code></pre></div>\n<p>But I acknowledge that this might not be the best way to do it, so it depends on your context, please give me more context</p>",
        "id": 527894123,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752069186
    },
    {
        "content": "<p>that's what I mean by not using the subtype</p>",
        "id": 527894191,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752069205
    },
    {
        "content": "<p>here I'm advocating for unbundling it, in contrast to my last advice</p>",
        "id": 527894272,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752069226
    },
    {
        "content": "<p>again, depends on context</p>",
        "id": 527894397,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752069255
    },
    {
        "content": "<p>Yeah, ok, I think that example helps clarify what the idiomatic way of passing from inhabitation of one structured set to another structured set ought to look like, if indeed I do want to talk about inhabitants, rather than point-free composition of structured homomorphisms or whatever</p>",
        "id": 527894519,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069294
    },
    {
        "content": "<p>Despite you feeling like you need more context to answer my question well, I think you've answered my question well, thanks :)</p>",
        "id": 527894684,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069336
    },
    {
        "content": "<p>The broader context, if you are still curious, is I'm trying to make a general definition of the Rupert property for eventual mathlib inclusion, as proposed in <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/Rupert.2Elean/near/526506861\">#general &gt; Rupert.lean @ üí¨</a></p>",
        "id": 527894988,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069427
    },
    {
        "content": "<p>And prove that it coincides with a more special definition for ‚Ñù¬≥</p>",
        "id": 527895087,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069452
    },
    {
        "content": "<p>The direction \"If a set X is super-generalized Rupert for the specific case of the affine space in question being ‚Ñù¬≥ acting on itself, then it's Rupert according to the definition found in the literature that's special-cased to ‚Ñù¬≥\" unpacks the literature definition of Rupert, which starts \"there exist some rotations in SO(3) such that...\" and so I want to show that if you're a rotation in SO(3), then you're also an affine isometry from an affine space to itself</p>",
        "id": 527895885,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069660
    },
    {
        "content": "<p>Is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialOrthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">orthogonalGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Submonoid</span><span class=\"bp\">.</span><span class=\"n\">inclusion</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">specialUnitaryGroup_le_unitaryGroup</span>\n</code></pre></div>\n<p>helpful?</p>",
        "id": 527896148,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752069729
    },
    {
        "content": "<p>Sure, <code>Submonoid.inclusion</code> seems like a good thing to know about!</p>",
        "id": 527896414,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069794
    },
    {
        "content": "<p>That seems like an answer to the question of how to keep things \"bundled\" longer</p>",
        "id": 527896820,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069911
    },
    {
        "content": "<p>well there's a time for bundling and a time for unbundling</p>",
        "id": 527896873,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752069925
    },
    {
        "content": "<p>sure, and I'm happy to know about the 'nice' way of doing both</p>",
        "id": 527896944,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069944
    },
    {
        "content": "<p>Even if I ultimately want to apply a function to a point, maintaining knowledge about, like, which category I know that function to be a morphism of as long as possible seems nice</p>",
        "id": 527897141,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752069998
    },
    {
        "content": "<p>I guess I'm still curious why <code>unitaryGroup</code> and <code>specialUnitaryGroup</code> are defined one way and <code>LinearGroup</code> and <code>SpecialLinearGroup</code> are defined another, but it's not an essential question. Just curious.</p>",
        "id": 527898229,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752070288
    },
    {
        "content": "<p>Maybe just a historical accident.</p>",
        "id": 527898311,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752070313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527898229\">said</a>:</p>\n<blockquote>\n<p>I guess I'm still curious why <code>unitaryGroup</code> and <code>specialUnitaryGroup</code> are defined one way and <code>LinearGroup</code> and <code>SpecialLinearGroup</code> are defined another, but it's not an essential question. Just curious.</p>\n</blockquote>\n<p>GL(n) actually needs to be a separate type because you need to store the inverse of the determinant</p>",
        "id": 527901619,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752071295
    },
    {
        "content": "<p>(otherwise the inverse won't be <code>computable</code>)</p>",
        "id": 527901642,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752071302
    },
    {
        "content": "<p><del>mathmatically (in AG) this corresponds to the fact that Gm isn't defined to be a subscheme of A^1</del> uh... nvm</p>",
        "id": 527901762,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752071335
    },
    {
        "content": "<p>Ah interesting</p>",
        "id": 527902003,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752071409
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527901762\">said</a>:</p>\n<blockquote>\n<p><del>mathmatically (in AG) this corresponds to the fact that Gm isn't defined to be a subscheme of A^1</del> uh... nvm</p>\n</blockquote>\n<p>I'm not 100% sure I know enough AG to appreciate this, but I am intrigued if this is a real comment and not a joke :) (I know, like, the definition of a scheme and presume I correctly recognize A^1 as the affine line)</p>",
        "id": 527903975,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752071999
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527901619\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527898229\">said</a>:</p>\n<blockquote>\n<p>I guess I'm still curious why <code>unitaryGroup</code> and <code>specialUnitaryGroup</code> are defined one way and <code>LinearGroup</code> and <code>SpecialLinearGroup</code> are defined another, but it's not an essential question. Just curious.</p>\n</blockquote>\n<p>GL(n) actually needs to be a separate type because you need to store the inverse of the determinant</p>\n</blockquote>\n<p>Could you say more about this?</p>",
        "id": 527905269,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072375
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"662452\">@Jason Reed</span> I'm just saying that the natural definition of Gm embeds into A^2 naturally as the hyperbola { (x,y) | xy = 1 } (<a href=\"https://www.desmos.com/calculator/an59wbbvev\">desmos</a>)</p>",
        "id": 527905974,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072566
    },
    {
        "content": "<p>but it's still a subscheme of A^1 ultimately, which is why I cancelled my comment</p>",
        "id": 527906040,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072582
    },
    {
        "content": "<p>(Specifically why you can't define GL(n) as a submonoid.)</p>",
        "id": 527906089,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072597
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527905269\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527901619\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527898229\">said</a>:</p>\n<blockquote>\n<p>I guess I'm still curious why <code>unitaryGroup</code> and <code>specialUnitaryGroup</code> are defined one way and <code>LinearGroup</code> and <code>SpecialLinearGroup</code> are defined another, but it's not an essential question. Just curious.</p>\n</blockquote>\n<p>GL(n) actually needs to be a separate type because you need to store the inverse of the determinant</p>\n</blockquote>\n<p>Could you say more about this?</p>\n</blockquote>\n<p>This is about the <code>computable</code> tag, which some people don't care about (and for good reasons), but if you do care about it, then an invertible element should also carry with it its inverse, not just a Prop saying that an inverse exists, because in Lean's type theory, you cannot \"eliminate out of Prop\", i.e. you cannot make data from Prop computably</p>",
        "id": 527906397,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072678
    },
    {
        "content": "<p>Oh I see, right, of course.</p>",
        "id": 527906474,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072698
    },
    {
        "content": "<p>that's why we currently have two ways to formalise invertible elements: Units and IsUnit</p>",
        "id": 527906499,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072704
    },
    {
        "content": "<p>Because things of type <code>RÀ£</code> contain their inverse with them.</p>",
        "id": 527906550,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072716
    },
    {
        "content": "<p>and classically ofc they're equivalent, but one of the functions is <code>noncomputable</code></p>",
        "id": 527906579,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072722
    },
    {
        "content": "<p>For sure, I see the issue.</p>",
        "id": 527906618,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072731
    },
    {
        "content": "<p>Presumably the SpecialLinearGroup <em>could</em> be a submonoid more easily though (because there you just need \"determinant equal to 1\").</p>",
        "id": 527906863,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072806
    },
    {
        "content": "<p>Yes, for this reason it's defined as a subtype.</p>",
        "id": 527907006,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072849
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/59726ffacf54edc7f615743843f3110b4de33e71/Mathlib/LinearAlgebra/Matrix/SpecialLinearGroup.lean#L62-L65\">https://github.com/leanprover-community/mathlib4/blob/59726ffacf54edc7f615743843f3110b4de33e71/Mathlib/LinearAlgebra/Matrix/SpecialLinearGroup.lean#L62-L65</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- `SpecialLinearGroup n R` is the group of `n` by `n` `R`-matrices with determinant equal to 1.</span>\n<span class=\"sd\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SpecialLinearGroup</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 527907041,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072859
    },
    {
        "content": "<p>Ah I see.</p>",
        "id": 527907067,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072867
    },
    {
        "content": "<p>And does this answer the question of why there isn't a <code>Coe</code> instance from the type <code>Matrix.specialUnitaryGroup</code>to <code>Matrix.unitaryGroup</code>? Or is that an <del>orthogonal</del> unrelated question?</p>",
        "id": 527907106,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752072878
    },
    {
        "content": "<p>Well the reason is is sort of \"it's unnatural to coerce here, because instead of considering terms of type <code>Matrix.specialUnitaryGroup</code> you should consider terms of type Matrix (blah) who are <em>members</em> of that submonoid\"</p>",
        "id": 527907353,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752072947
    },
    {
        "content": "<p>that's unrelated because the determinant of the inverse is still computable (I think it's the conjugate of the determinant)?</p>",
        "id": 527907356,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072947
    },
    {
        "content": "<p>(or should I be saying... the type <code>‚ÜëMatrix.specialUnitaryGroup</code>?)</p>",
        "id": 527907366,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752072949
    },
    {
        "content": "<p>and you've answered your own question here. note the capital letter vs small letter difference, very crucial</p>",
        "id": 527907452,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072969
    },
    {
        "content": "<p>SL -&gt; GL has a coercion because they are defined as types (with capital letters)</p>",
        "id": 527907508,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072983
    },
    {
        "content": "<p>SU -&gt; U doesn't because they are defined as submonoids</p>",
        "id": 527907548,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752072995
    },
    {
        "content": "<p>but indeed this is an inconsistency, that's just the unfortunate reality (until you PR a fix i guess <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span> )</p>",
        "id": 527907618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073016
    },
    {
        "content": "<p><del>wait I'm confused <code>unitaryGroup</code> is lowercase isn't it?</del> wait no everything is consistent with what you're saying...</p>\n<p>I'm just trying to ask, for the submonoid situation, I hear that I'm \"supposed to\" not think of them as types, but I'm curious what the consequences are of doing that. Does it make typeclass instantiation not performant or something? Does it just Not Work? If it is just a style thing I'm happy to absorb that in my growing understanding of good mathlib style.</p>",
        "id": 527907699,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073041
    },
    {
        "content": "<p>Yeah I can see the approximate shape of what  I'd do but don't have time right now.</p>",
        "id": 527907716,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1752073045
    },
    {
        "content": "<p>I don't think the inconsistency is a consequence of any well thought out decision, mathlib has like ~7000 files</p>",
        "id": 527908168,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073173
    },
    {
        "content": "<p>Ok, I'm happy with that answer!</p>",
        "id": 527908221,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073184
    },
    {
        "content": "<p>and 2X maintainers <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 527908245,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073189
    },
    {
        "content": "<p>Just on the lookout for more consequential things that I should know about :)</p>",
        "id": 527908282,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073199
    },
    {
        "content": "<p>that's 350 files per maintainer</p>",
        "id": 527908283,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073199
    },
    {
        "content": "<p>Much understanding and sympathy for mathlib being a precedent-breaking achievement of scope and usefulness :)</p>",
        "id": 527908409,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073231
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"662452\">@Jason Reed</span> I think that we are just basically inconsistent with our treatment of classical groups, because right now we don't have anything particular to do with them.</p>",
        "id": 527908512,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073254
    },
    {
        "content": "<p>Cool, let me be very clear this isn't a complaint, just a \"is there something for me to learn here\"</p>",
        "id": 527908668,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073293
    },
    {
        "content": "<p>I'm stoked to be someone using classical groups for real then</p>",
        "id": 527908744,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073318
    },
    {
        "content": "<p>I think that you're asking a completely reasonable question and I think that the answer is simply that we are inconsistent for nothing more than random historical reasons</p>",
        "id": 527908790,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073333
    },
    {
        "content": "<p>let's start by defining the corresponding schemes <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527908945,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073377
    },
    {
        "content": "<p>Yeah that would be a fun thing to do.</p>",
        "id": 527909010,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073396
    },
    {
        "content": "<p>(defining SU is left as an exercise to the reader)</p>",
        "id": 527909016,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752073398
    },
    {
        "content": "<p>(and we need them for FLT)</p>",
        "id": 527909040,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073405
    },
    {
        "content": "<p>tbh the question of \"how should a mathematical library handle specifically the issue of subtyping/coercion/auomatic inference of what things are what other things\" is something that mathlib convinced me</p>\n<ul>\n<li>is fantastically important</li>\n<li>is really hard to get right all the time</li>\n</ul>",
        "id": 527909047,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073406
    },
    {
        "content": "<p>(and yet mathlib has delighted me with dwim, like, 90% of the time)</p>",
        "id": 527909199,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752073447
    },
    {
        "content": "<p>Right -- type theory has types and terms, and when you're making your favourite object you have to decide whether it's going to be a type or a term, and sometimes the answer is \"definitely this one because the way you're using it, it would be pain if you chose the other one\" and sometimes the answer is \"it doesn't really matter, you will have some pain whichever one you choose\"</p>",
        "id": 527909282,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073470
    },
    {
        "content": "<p>Example: we have groups as types and then categories of groups where groups are terms. We have subgroups as terms but then we have a coercion system which coerces them into types so we can use theorems about groups on subgroups. But then a subgroup of a subgroup is not equal to a subgroup of the big group, indeed probably this wouldn't even typecheck. What is remarkable about mathlib is that we've got this far at all.</p>",
        "id": 527909661,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752073548
    },
    {
        "content": "<p>2 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/.C4.B0mran.20Tanq/with/527917658\">#new members &gt; ƒ∞mran Tanq</a> by <span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span>.</p>",
        "id": 527917995,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752076060
    },
    {
        "content": "<p>Ok, back on the topic of \"perhaps mathlib has some api gaps for classical groups?\" I was trying to figure out a way to even state </p>\n<blockquote>\n<p>every matrix in U(n) induces a linear isometry equivalence</p>\n</blockquote>\n<p>by analogy with (or, rather, as a strengthening of) <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/UnitaryGroup.html#Matrix.UnitaryGroup.toLinearEquiv\">Matrix.UnitaryGroup.toLinearEquiv</a> (the difference being that I'd also like to bundle the fact that it's an isometry)</p>\n<p>I first tried</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>where the addition of the <code>[SeminormedAddCommGroup Œ±]</code> was motivated by simple-mindedly copying what  the error message on ‚Üí‚Çó·µ¢ said was missing. <br>\nBut this yields then the an error about failing to find an instance of <code>Module Œ± (n ‚Üí Œ±)</code>.</p>\n<p>I checked that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>succeeds, and with a bit more digging, found that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\">   </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SeminormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">     </span><span class=\"bp\">@</span><span class=\"n\">LinearIsometryEquiv</span><span class=\"w\">  </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:=</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Œ±</span><span class=\"o\">:=</span><span class=\"n\">Œ±</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>yields the error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">foo</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">toCommSemiring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span><span class=\"w\"> </span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">addCommMonoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_4</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"w\"> </span><span class=\"n\">u_4</span><span class=\"o\">)</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">CommRing</span><span class=\"bp\">.</span><span class=\"n\">toCommSemiring</span><span class=\"bp\">.</span><span class=\"n\">toSemiring</span>\n<span class=\"w\">    </span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">seminormedAddCommGroup</span><span class=\"bp\">.</span><span class=\"n\">toAddCommMonoid</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u_4</span><span class=\"w\"> </span><span class=\"n\">u_3</span><span class=\"w\"> </span><span class=\"n\">u_4</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>...which I'm guessing is either<br>\n(a) <code>Pi.addCommMonoid</code> being in some sense \"the same as\" <code>Pi.seminormedAddCommGroup.toAddCommMonoid</code>but not definitionally/transparently enough to make these types equal, and/or<br>\n(b) I'm falling prey to a version of the <a href=\"https://leanprover-community.github.io/extras/pitfalls.html#parameters-for-instances-that-already-exist\">pitfall of quantifying over typeclass instances unnecessarily</a></p>\n<p>Any advice here? I'm not sure at what level of abstraction I'm doing something wrong, and very happy to ascend the XY problem stack as far as appropriate <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527931994,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752080818
    },
    {
        "content": "<p>the correct answer is that n -&gt; Œ± has the sup norm, and for the L2 norm you'll need EuclideanSpace...</p>",
        "id": 527932236,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752080912
    },
    {
        "content": "<p>Oho, that is also on the pitfalls page</p>",
        "id": 527932278,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752080929
    },
    {
        "content": "<p>the pitfall here is that when we use classes, we're making the declaration that there will only ever be one instance on one type</p>",
        "id": 527932303,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752080940
    },
    {
        "content": "<p>so we can't have both the sup norm and the L2 norm on the same type, which is why we needed to introduce type synonyms</p>",
        "id": 527932345,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752080957
    },
    {
        "content": "<p>Right, makes sense</p>",
        "id": 527932386,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752080971
    },
    {
        "content": "<p>So does</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>smell like an appropriate level of generality? That at least typechecks for me.</p>",
        "id": 527933235,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081325
    },
    {
        "content": "<p>Doesn't seem like I can get any weaker than <code>RCLike</code> for the scalars, since <code>EuclideanSpace</code> requires it...</p>",
        "id": 527933290,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081348
    },
    {
        "content": "<p>I've never heard of unitary matrix outside of complex... do you get issues if i^2 + 1^2 = 0 in Q(i)?</p>",
        "id": 527933380,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081390
    },
    {
        "content": "<p>I'm not actually challenging the appropriateness of RCLike, I'm inclined to think it is correct</p>",
        "id": 527933464,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081429
    },
    {
        "content": "<p>I'm checking my assumptions, and trying to forestall the outcome that the Generic Mathlib Maintainer looks at this and scoffs at what a special case it is, when it could be more general <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527933590,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081468
    },
    {
        "content": "<p>but it sounds like this makes sense</p>",
        "id": 527933673,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081502
    },
    {
        "content": "<p>well you can look at unitaryGroup itself, which is defined over a \"star ring\"</p>",
        "id": 527933819,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081567
    },
    {
        "content": "<p>which means that it's defined for Q(sqrt(2)) where the star takes sqrt(2) to -sqrt(2)!</p>",
        "id": 527933890,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081602
    },
    {
        "content": "<p>The complex vs. real generality isn't so much of interest to me at the moment, so I'm not worried about the star-structure... but now I am starting to wonder whether I'm missing something that I don't understand why EuclideanSpace needs RCLike, assuming RCLike excludes Q?</p>",
        "id": 527934033,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081666
    },
    {
        "content": "<p>Like, I guess I need square roots to take the norm</p>",
        "id": 527934076,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081683
    },
    {
        "content": "<p>But rotation matrices could be made to make sense over Q if they mean \"preserve squared norm\".</p>",
        "id": 527934155,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081717
    },
    {
        "content": "<p>shrug, maybe this is a niche concern and ~nobody needs such a thing</p>",
        "id": 527934197,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081730
    },
    {
        "content": "<p>you can define other rings with norms, but EuclideanSpace seems to be specialised to R and C because well they seem to have a lot of nice properties when specialised like this</p>",
        "id": 527934533,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081864
    },
    {
        "content": "<p>if you want other Lp spaces there is WithLp</p>",
        "id": 527934541,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081869
    },
    {
        "content": "<p>Right</p>",
        "id": 527934596,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081894
    },
    {
        "content": "<p>over Q(sqrt(2)), 1+sqrt(2) has norm -1, so the vector (1+sqrt(2), 1) again has norm 0...</p>",
        "id": 527934623,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081905
    },
    {
        "content": "<p>you can still write down the equation <code>A^T A = I</code> and it will still define a group which is why <code>Matrix.orthogonalGroup</code> is defined over any ring</p>",
        "id": 527934752,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081960
    },
    {
        "content": "<p>(ah, assuming your \"conjugation\" that exchanges sqrt(2) and -sqrt(2), yes)</p>",
        "id": 527934787,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752081973
    },
    {
        "content": "<p>it probably still corresponds to the \"norm-preserving\" operations</p>",
        "id": 527934825,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752081988
    },
    {
        "content": "<p>the proof is also very simple mathematically, assuming your norm is v^T v, then norm(Av) = (Av)^T (Av) = v^T A^T A v = v^T v = norm(v)</p>",
        "id": 527934949,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082042
    },
    {
        "content": "<p>ah but the other direction might not hold, lol</p>",
        "id": 527935025,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082079
    },
    {
        "content": "<p><del>i definitely don't think it's true in general that if v^T B v = v^T v for every v then B = A^T A for some A</del><br>\nedit, I should ask instead, if v^T A^T A v = v^T v for every v, then does A^T A necessarily = I?</p>",
        "id": 527935151,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082132
    },
    {
        "content": "<p>Wait so stepping back, do you think that there is a sensible way of filling in the ??? with typeclass bounds to make</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ???</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PiLp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PiLp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>make sense?</p>",
        "id": 527935719,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082336
    },
    {
        "content": "<p>i.e. something weaker than RCLike?</p>",
        "id": 527935778,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082363
    },
    {
        "content": "<p>I guess I'm taking Q with the trivial star structure as my example</p>",
        "id": 527935848,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082389
    },
    {
        "content": "<p>Or am I doomed because Q doesn't have the square roots to even implement the 2-norm</p>",
        "id": 527935931,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082413
    },
    {
        "content": "<p>before you continue,</p>",
        "id": 527936036,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082461
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Adjoint.html#unitary.norm_map\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/InnerProductSpace/Adjoint.html#unitary.norm_map</a></p>",
        "id": 527936041,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082463
    },
    {
        "content": "<p>you might be interested to give this a look</p>",
        "id": 527936057,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082469
    },
    {
        "content": "<p>this seems to contain another treatment of \"unitary\" defined on operators on inner product spaces</p>",
        "id": 527936114,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082492
    },
    {
        "content": "<p>ah heh yes that looks useful</p>",
        "id": 527936131,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082503
    },
    {
        "content": "<p>(I don't regret the exercise of trying to invent this from scratch, but neither do I mind the spoilers of the thing that already exists)</p>",
        "id": 527936228,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082541
    },
    {
        "content": "<p>How did you happen to find that?</p>",
        "id": 527936242,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082548
    },
    {
        "content": "<p><a href=\"https://leansearch.net/\">https://leansearch.net/</a> and <a href=\"https://loogle.lean-lang.org\">https://loogle.lean-lang.org</a> have been irreplaceable. I literally cannot write any code without them.</p>",
        "id": 527936311,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082578
    },
    {
        "content": "<p>I somehow thought I'd already skimmed through every occurrence of ‚âÉ‚Çó·µ¢ that looked plausible and asked <a href=\"http://leansearch.net\">leansearch.net</a> a lot of relevant questions... (I have gotten tremendous value out of leansearch/leanexplore in the past already though)</p>",
        "id": 527936345,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082592
    },
    {
        "content": "<p>I haven't practiced using loogle much yet though</p>",
        "id": 527936367,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752082598
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedField</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarRing</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PiLp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PiLp</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 527936750,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752082785
    },
    {
        "content": "<p>but then the norm and the star might not interact... in RCLike it is hardcoded that <code>‚àÄ (z : K), ‚Äñz‚Äñ ^ 2 = RCLike.re z * RCLike.re z + RCLike.im z * RCLike.im z</code></p>",
        "id": 527937500,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752083111
    },
    {
        "content": "<p>I would recommend you to do it for C first and then see what you can generalise from there on</p>",
        "id": 527937789,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752083234
    },
    {
        "content": "<p>none of the generalisations are \"obvious\"</p>",
        "id": 527937809,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752083243
    },
    {
        "content": "<p>the \"norm\" on Q(sqrt(2))^2 fails to be a norm any under normal analysis sense</p>",
        "id": 527937847,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752083261
    },
    {
        "content": "<p>The correct set-up for a unitary group to be defined is a separable quadratic extension of fields (or even more generally a degree two etale extension); this is what we'll need for FLT. Then you can talk about nondegenerate hermitian sesquilinear forms on a vector space over the big field and unitary groups preserve the form.</p>",
        "id": 527945116,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752086114
    },
    {
        "content": "<p>yeah, you'll have to use \"form\" to replace \"norm\" then</p>",
        "id": 527945240,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752086163
    },
    {
        "content": "<p>In that case, you'll definitely not want <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.unitaryGroup#doc\">docs#Matrix.unitaryGroup</a> to be an <code>abbrev</code> anymore.</p>",
        "id": 527945248,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752086165
    },
    {
        "content": "<p>(unless I'm misunderstanding)</p>",
        "id": 527945328,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752086195
    },
    {
        "content": "<p>However, if you just want the map <code>Matrix.UnitaryGroup.toLinearIsometryEquiv</code> for <code>RCLike</code>, you can build it from <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=unitary.linearIsometryEquiv#doc\">docs#unitary.linearIsometryEquiv</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.toEuclideanCLM#doc\">docs#Matrix.toEuclideanCLM</a></p>",
        "id": 527945714,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752086331
    },
    {
        "content": "<p>Ah, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.toEuclideanCLM#doc\">docs#Matrix.toEuclideanCLM</a> is another very useful piece, thanks</p>",
        "id": 527945826,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752086376
    },
    {
        "content": "<p>There's also <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=unitary.map#doc\">docs#unitary.map</a></p>",
        "id": 527945952,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752086419
    },
    {
        "content": "<p>Yup, that one I had found</p>",
        "id": 527946134,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752086485
    },
    {
        "content": "<p>In fact, if you make a version (presumably called <code>unitary.mapEquiv</code> to match <code>Units.mapEquiv</code>) of <code>unitary.map</code> that upgrades it from <code>‚Üí‚ãÜ</code> to <code>‚âÉ*</code> under the assumption of <code>MulEquivClass F R S</code>, then you can easily get <code>Matrix.unitaryGroup n k ‚âÉ* (EuclideanSpace k n ‚âÉ‚Çó·µ¢[k] EucideanSpace k n)</code> by combining these three things.</p>",
        "id": 527947339,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752086968
    },
    {
        "content": "<p>Calling this equivalence <code>Foo</code>, you should then be able to prove relatively easily that for <code>A : Matrix.unitaryGroup n k</code> and <code>x : EuclideanSpace k n</code>, that <code>Foo A x = (A : Matrix n n k) *·µ• (WithLp.ofLp x)</code></p>",
        "id": 527947766,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752087151
    },
    {
        "content": "<p>It's quite neat that they transitioned from a matrix equality to one that is statable in terms of star again (but where this time the star acts on the whole space of \"matrixes\")</p>",
        "id": 527947984,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087258
    },
    {
        "content": "<p>Note that proceeding with my suggestion above and obtaining <code>Foo : _ ‚âÉ* _</code> gives you <code>Foo (star A) = (Foo A).symm</code> almost for free.</p>",
        "id": 527948297,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752087434
    },
    {
        "content": "<p>I like the sound of your suggestion <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> but alas I'm still stuck on much lower level prior things... Am I misreading the error message in</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"c1\">-- goal state:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- construct ‚Ü•(unitary (EuclideanSpace k n ‚ÜíL[k] EuclideanSpace k n))</span>\n<span class=\"w\">  </span><span class=\"c1\">-- given A : unitaryGroup n k</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Matrix.toEuclideanCLM specialized to our situation, which takes</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Matrix n n k and yields a continuous linear map between finite-dim euclidean spaces</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">toEuclideanCLM</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">  </span><span class=\"c1\">-- I was hoping to feed this into the unitary.map, to get</span>\n<span class=\"w\">  </span><span class=\"c1\">-- unitary (Matrix n n k) ‚Üí unitary (EuclideanSpace k n ‚ÜíL[k] EuclideanSpace k n), but</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"c1\">-- yields the failure to infer</span>\n<span class=\"w\">  </span><span class=\"c1\">--  FunLike (Matrix n n k ‚Üí EuclideanSpace k n ‚ÜíL[k] EuclideanSpace k n) (Matrix n n k)</span>\n<span class=\"w\">  </span><span class=\"c1\">--  (EuclideanSpace k n ‚ÜíL[k] EuclideanSpace k n)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- I would have thought FunLike (A ‚Üí B) A B would be the most FunLike thing there is!</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 527948650,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087616
    },
    {
        "content": "<p><code>apply</code> has a very specific meaning, it isn't the same as informal maths where it means \"use this in some way\"</p>",
        "id": 527948803,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087665
    },
    {
        "content": "<p>Hm? I thought the apply tactic worked as I expected</p>",
        "id": 527948860,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087687
    },
    {
        "content": "<p>oh wait, nvm</p>",
        "id": 527948878,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087693
    },
    {
        "content": "<p>The error is with the <a href=\"http://unitary.map\">unitary.map</a></p>",
        "id": 527948883,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087694
    },
    {
        "content": "<p>my apologies</p>",
        "id": 527948910,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087706
    },
    {
        "content": "<p>no worries at all (indeed, I'm happy to say thanks a ton again for all the help upthread)</p>",
        "id": 527948956,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087723
    },
    {
        "content": "<p>Ah well</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n</code></pre></div>\n<p>Does fail to synthesize. I must have guessed wrong what FunLike is about. Back to reading documentation...</p>",
        "id": 527949293,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087867
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Matrix.toEuclideanCLM specialized to our situation, which takes</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Matrix n n k and yields a continuous linear map between finite-dim euclidean spaces</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ‚Çê</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">toEuclideanCLM</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 527949608,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087950
    },
    {
        "content": "<p>you unbundled too quickly and lost the star-alghom-ness of <code>foo</code></p>",
        "id": 527949640,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087963
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527949293\">said</a>:</p>\n<blockquote>\n<p>Ah well</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n</code></pre></div>\n<p>Does fail to synthesize. I must have guessed wrong what FunLike is about. Back to reading documentation...</p>\n</blockquote>\n<p>it seems like it's for every homomorphism apart from functions <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 527949688,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752087985
    },
    {
        "content": "<p>I see; <code>A ‚Üí B</code> isn't coercible to <code>A ‚Üí B</code>, it is <code>A ‚Üí B</code></p>",
        "id": 527949695,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752087989
    },
    {
        "content": "<p>basically it's a bad idea to lose structure</p>",
        "id": 527949788,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088025
    },
    {
        "content": "<p>in general</p>",
        "id": 527949794,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088026
    },
    {
        "content": "<p>you want every homomorphism as a homomorphism for as long as possible</p>",
        "id": 527949834,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088042
    },
    {
        "content": "<p>getting you over the hump:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ‚Çê</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">toEuclideanCLM</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 527949890,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752088064
    },
    {
        "content": "<p>or, well, I take your earlier point the the validity of 'don't lose structure' as an aphorism can still be somewhat context-dependent, but for sure in this case it is wrong to prematurely lose structure</p>",
        "id": 527949916,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088075
    },
    {
        "content": "<p>ah now I understand the real reason why it was an error</p>",
        "id": 527950024,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088122
    },
    {
        "content": "<p>the <code>[StarHomClass F R S]</code> assumption in <code>unitary.map</code> means that F is supposed to be interpreted as star homs</p>",
        "id": 527950070,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088140
    },
    {
        "content": "<p>which is why it was bad to lose that structure</p>",
        "id": 527950089,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"662452\">Jason Reed</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527949916\">said</a>:</p>\n<blockquote>\n<p>or, well, I take your earlier point the the validity of 'don't lose structure' as an aphorism can still be somewhat context-dependent, but for sure in this case it is wrong to prematurely lose structure</p>\n</blockquote>\n<p>well it's all a part of learning</p>",
        "id": 527950152,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752088171
    },
    {
        "content": "<p>I was just saying to someone on social media elsewhere that part of why learning lean specifically is so fun is it feels like I get to learn math all over again (from the viewpoint of suddenly paying more attention to formalization concerns) and also I get to learn mechanized proof all over again (because although I have plenty of experience with other proof assistants, lean is novel in presenting challenges that only arise from managing api design for large bodies of math)</p>",
        "id": 527950378,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088282
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">toLinearIsometryEquiv</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">toEuclideanCLM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 527950392,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752088289
    },
    {
        "content": "<p>Cool, I think I grok this sufficiently</p>",
        "id": 527950644,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088413
    },
    {
        "content": "<p>But like I said before, you should really make <code>unitary.mapEquiv</code> and then turn this into:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 527950717,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752088452
    },
    {
        "content": "<p>The piece that I wasn't anywhere close to guessing was the need to specify the <code>F</code> implicit, and the fact that it would be a <code>‚âÉ‚ãÜ‚Çê</code> between the matrix group and the euclidean endomorphism group</p>",
        "id": 527950724,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088456
    },
    {
        "content": "<p>Note, you don't have to specify <code>F</code>, so long as you provide Lean with enough information to infer everything (e.g., the implicit arguments to <code>Matrix.toEuclideanCLM</code>)</p>",
        "id": 527950794,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752088499
    },
    {
        "content": "<p>Oh wait what am I saying, that (<code>‚âÉ‚ãÜ‚Çê</code>) is in the type of EuclideanCLM</p>",
        "id": 527950812,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088505
    },
    {
        "content": "<p>Maybe it's just a lot of moving pieces to keep track of when they're all novel and unfamiliar</p>",
        "id": 527950906,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088550
    },
    {
        "content": "<p>Let me try to see if I can reconstruct your intent for mapEquiv now...</p>",
        "id": 527951023,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752088614
    },
    {
        "content": "<p>Just so you know what my thought process is, I see</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and I surmise that I want</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">mapEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">EquivLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulEquivClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>With <code>EquivLike</code> upgrading <code>FunLike</code>, and <code>MulEquivClass</code> upgrading <code>MonoidHomClass</code>... is that right, and is there any more principled way of checking whether that's right?</p>",
        "id": 527952430,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752089286
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527908945\">said</a>:</p>\n<blockquote>\n<p>let's start by defining the corresponding schemes <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>\n</blockquote>\n<p>I know it's a semi-joke, but just to make sure you know, we have SO(2) as a group scheme in Toric! (cf the blog post on <a href=\"http://leanprover-community.github.io/blog\">leanprover-community.github.io/blog</a>)</p>",
        "id": 527952532,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1752089353
    },
    {
        "content": "<p>To put it another way, am I correct in believing it's mistaken to have both <code>[FunLike F R S]</code> and <code>[EquivLike F R S] </code>?</p>",
        "id": 527952554,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752089365
    },
    {
        "content": "<p>well, in accordance with the philosophy of not losing structure, having equiv is better than just having the hom</p>",
        "id": 527952819,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752089498
    },
    {
        "content": "<p>But including both is incorrectly asking for two potentially unrelated such structures, right? (one of funlikeness, and one of equivlikeness) Per the \"pitfall\" I linked above somewhere.</p>",
        "id": 527952920,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752089556
    },
    {
        "content": "<p>Still stumbling around trying to implement <code>mapEquiv</code>... I am not yet sure whether it's better to simply implement the specific few fields that ‚âÉ* requires (the same way that <code>unitary.map</code> does with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">map_mem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">map_one</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>) or whether I should be trying to call <code>MulEquiv.mk'</code> or some other convenience constructor</p>",
        "id": 527954134,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090124
    },
    {
        "content": "<p>On the first approach, I got as far as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">mapEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">EquivLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulEquivClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ*</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">map_mem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 527954241,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090172
    },
    {
        "content": "<p>I hope the error about <code>left_inv</code> not being synthesizable is just because I haven't actually finished defining the inverse yet</p>",
        "id": 527954344,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090219
    },
    {
        "content": "<p>I feel like I should be able to fill in that sorry by appealing to <code>unitary.map</code> somehow, given everything I have in typeclasses</p>",
        "id": 527954440,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090271
    },
    {
        "content": "<p>However, I can't seem to infer <code>FunLike F S R</code> from <code>EquivLike F R S</code> (note the reversal of R and S). Should I be surprised?</p>",
        "id": 527954717,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090401
    },
    {
        "content": "<p>Oh sheesh I should be looking at the example of <code>Units.mapEquiv</code></p>",
        "id": 527955439,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752090706
    },
    {
        "content": "<p>The two things I know I don't know about implementing <code>unitary.mapEquiv</code> on the model of <code>Units.mapEquiv</code> are:<br>\n(1) How to avoid the spurious stub typeclass assumptions noted below<br>\n(2) Where to discover the fact that <code>unitary.map</code> is a functor, i.e. preserves composition and identities</p>\n<p>I think with those I might have it.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">mapEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">EquivLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"c1\">-- This [StarHomClass (S ‚âÉ R) S R] is a stub assumption that don't think ultimately belongs here;</span>\n<span class=\"w\">  </span><span class=\"c1\">-- I thought I might have wanted StarAlgEquivClass but that is a mere namespace</span>\n<span class=\"w\">  </span><span class=\"c1\">-- not a typeclass; what I think I want to express is</span>\n<span class=\"w\">  </span><span class=\"c1\">-- \"the type F is coercible to an equivalence R ‚âÖ S such that the forward and backward</span>\n<span class=\"w\">  </span><span class=\"c1\">-- maps are both star homomorphisms\"</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"c1\">-- This [MonoidHomClass (S ‚âÉ R) S R] is a stub assumption that don't think ultimately belongs here;</span>\n<span class=\"w\">  </span><span class=\"c1\">-- I thought MulEquivClass would cover this.</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">MulEquivClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ*</span><span class=\"w\"> </span><span class=\"bp\">‚Ü•</span><span class=\"o\">(</span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">     </span><span class=\"n\">ext</span>\n<span class=\"w\">     </span><span class=\"c1\">-- Goal: ‚Üë((map (‚Üëf).symm) ((‚Üë(map f)).toFun u)) = ‚Üëu</span>\n<span class=\"w\">     </span><span class=\"c1\">-- The next thing I want to do is exploit functoriality of map, to reduce my goal to</span>\n<span class=\"w\">     </span><span class=\"c1\">-- map (f.symm ‚àò f) u = u</span>\n<span class=\"w\">     </span><span class=\"c1\">-- and then I can use left_inv of f as an equivalence to see f.symm ‚àò f = id,</span>\n<span class=\"w\">     </span><span class=\"c1\">-- and then functoriality of map again should tell me map id = id.</span>\n<span class=\"w\">     </span><span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 527960652,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752092934
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"662452\">@Jason Reed</span> I'd recommend you not going into all the detail about <code>HomClass</code> and such if you're new to Lean <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527966221,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095185
    },
    {
        "content": "<p>write the thing for what you need first, generailse later</p>",
        "id": 527966271,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095202
    },
    {
        "content": "<p>Ok, I was just following <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span> 's breadcrumbs :) <br>\nI'm happy leaving this be for now and moving on to other parts of my proof, but also I don't mind being exposed to the more advanced abstractions in mathlib</p>",
        "id": 527966512,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095287
    },
    {
        "content": "<p>My highest priority yak to shave of just getting some version of the conjecture that all convex polyhedra are Rupert into <code>formal-conjectures</code>is nearly done anyhow. The next yak was getting Rupertness generalized to affine spaces and isometries to a vaguely plausible sounding mathlib PR.</p>",
        "id": 527966983,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095486
    },
    {
        "content": "<p>I await that with much excitement</p>",
        "id": 527967068,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095521
    },
    {
        "content": "<p>Which is to say, I'm already at a level of generality that is far beyond practical concerns, so I'm not really that distressed at a dollop more</p>",
        "id": 527967095,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095532
    },
    {
        "content": "<p>(but of course one has to draw the line somewhere)</p>",
        "id": 527967132,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095549
    },
    {
        "content": "<p>I would restate my advice: be as specific as possible first, generalise later</p>",
        "id": 527967217,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095592
    },
    {
        "content": "<p>If \"that\" is the formal-conjectures PR, that's <a href=\"https://github.com/google-deepmind/formal-conjectures/pull/284\">here</a>; if \"that\" is the mathlib rupert PR, I'm a bit farther away :)</p>",
        "id": 527967225,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095596
    },
    {
        "content": "<p>the unitary group PR</p>",
        "id": 527967261,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095610
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Golfing.20matrix.20group.20coercion/near/527967217\">said</a>:</p>\n<blockquote>\n<p>I would restate my advice: be as specific as possible first, generalise later</p>\n</blockquote>\n<p>that's agreeable advice</p>",
        "id": 527967292,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095624
    },
    {
        "content": "<p>my advice would be to prove it for U(2,C) first, that's how specific my advice is</p>",
        "id": 527967304,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095631
    },
    {
        "content": "<p>to justify my advice: proving it for U(2,C) would be way easier than proving it for U(n,general star ring); and if you have successfully produced the code, any generalisable bit would also take less work. doing it this way is actually the most energy-efficient, because you get to spend less time on each step</p>",
        "id": 527967620,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095762
    },
    {
        "content": "<p>if your approach is general enough, the step of generalising it would just be literally to change the hypothesis, and everything  else should compile fine</p>",
        "id": 527967695,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752095793
    },
    {
        "content": "<p>the general advice of do the thing in progressive steps of increasing generality is perfectly familiar and agreeable; the specific advice of taking the special case of n=2 and general star ring=C I will take a moment to digest...</p>",
        "id": 527967751,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752095824
    },
    {
        "content": "<p>I'm still not seeing the intermediate stage of generality you have in mind, sorry. I <em>have</em> already (thanks to advice above) a proof of:<br>\n<code>(*)</code> If M belongs to the unitary group of n x n matrices over an RCLike field k, then I obtain a linear isometry equivalence between k^n and itself<br>\n(and incidentally this is thoroughly sufficient for my broader project)</p>",
        "id": 527968207,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752096048
    },
    {
        "content": "<p>it was suggested above to additionally prove <code>unitary.mapEquiv</code> as a generalization of <code>unitary.map</code>, which could lead to a slicker proof of (*)</p>",
        "id": 527968278,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752096084
    },
    {
        "content": "<p>are you suggesting proving <code>unitary.mapEquiv</code> for a special case of S and R as a warmup?</p>",
        "id": 527968312,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752096104
    },
    {
        "content": "<p>I assume you want the converse of (*) as well?</p>",
        "id": 527968954,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752096426
    },
    {
        "content": "<p>(which might not hold outside RCLike)</p>",
        "id": 527968978,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752096437
    },
    {
        "content": "<p>I don't need it for my purposes, but it seems natural to strengthen (*) to a bijective relationship when possible, yeah</p>",
        "id": 527969150,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752096523
    },
    {
        "content": "<p>in any case, if you think you're on the right path, then it's fine, my advice was just for in general, I don't know that you proved (*) already</p>",
        "id": 527969217,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752096557
    },
    {
        "content": "<p>cool cool, yeah, forgive me for a very chatty thread, it's easy to lose things.  <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 527969318,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752096606
    },
    {
        "content": "<p>Okay, so this is what I was imagining, but admittedly it doesn't work as easily as I had imagined when I initially suggested it (see below)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The star group homomorphism between unitary subgroups of star monoids induced by a star monoid</span>\n<span class=\"sd\">isomorphism. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">mapEquiv</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarMul</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">unitary</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">map_mem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">map_mem</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_apply</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">apply_symm_apply</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çó·µ¢</span><span class=\"o\">[</span><span class=\"n\">k</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">mapEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">ofClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">toEuclideanCLM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">toMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">trans</span>\n<span class=\"w\">    </span><span class=\"n\">unitary</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv_apply_apply</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">linearIsometryEquiv</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*·µ•</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithLp</span><span class=\"bp\">.</span><span class=\"n\">ofLp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">UnitaryGroup</span><span class=\"bp\">.</span><span class=\"n\">linearIsometryEquiv_star</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">unitaryGroup</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">linearIsometryEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">linearIsometryEquiv</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">map_inv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>\n<p>However, note that the above doesn't work in the web editor. The reason is that we don't currently have type for \"star monoid (homo/iso)morphisms\". This is part of the reason <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=unitary.map#doc\">docs#unitary.map</a> is written in terms of the classes. It would ultimately be better if it was writtten in terms of a dedicated morphism type.</p>\n<p>So, in order to make the above work, here is the necessary API:</p>",
        "id": 528000462,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752122577
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>API for star monoid morphisms</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Star</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Morphisms of star monoids</span>\n\n<span class=\"cm\">This file defines a new type of morphism between monoids `A` and `B` where both</span>\n<span class=\"cm\">`A` and `B` are equipped with an antimultiplicative `star` operation. This morphism,</span>\n<span class=\"cm\">namely `StarMonoidHom`, is a direct extension of its non-`star`red counterpart with a</span>\n<span class=\"cm\">field `map_star` which guarantees it preserves the star operation.</span>\n\n<span class=\"cm\">## Main definitions</span>\n\n<span class=\"cm\">  * `StarMonoidHom`</span>\n<span class=\"cm\">  * `StarMulEquiv`</span>\n\n<span class=\"cm\">## Tags</span>\n\n<span class=\"cm\">monoid, star</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">! ### Star monoid homomorphisms -/</span>\n\n<span class=\"sd\">/-- A *star monoid homomorphism* is a monoid homomorphism which is `star`-preserving. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- By definition, a star monoid homomorphism preserves the `star` operation. -/</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- `Œ± ‚Üí‚ãÜ* Œ≤` denotes the type of star monoid homomorphisms from `Œ±` to `Œ≤`. -/</span>\n<span class=\"kn\">infixr</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"s2\">\" ‚Üí‚ãÜ* \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span>\n\n<span class=\"sd\">/-- Reinterpret a star monoid homomorphism as a monoid homomorphism</span>\n<span class=\"sd\">by forgetting the interaction with the star operation. -/</span>\n<span class=\"n\">add_decl_doc</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"n\">coe_injective'</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map_mul'</span>\n<span class=\"w\">  </span><span class=\"n\">map_one</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map_one'</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map_star'</span>\n\n<span class=\"sd\">/-- See Note [custom simps projection] -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"n\">initialize_simps_projections</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">coe</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Construct a `StarMonoidHom` from a morphism in some type which preserves `1`, `*` and `star`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ofClass</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MonoidHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_one</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_toMonoidHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"sd\">/-- Copy of a `StarMonoidHom` with a new `toFun` equal to the old one. Useful</span>\n<span class=\"sd\">to fix definitional equalities. -/</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">copy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f'</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">map_one</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">‚ñ∏</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_copy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">copy</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">copy_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">copy</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">ext'</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"bp\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\">  </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Id</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- The identity as a star monoid homomorphism. -/</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_cast</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_id</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"n\">StarMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Id</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Comp</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/-- The composition of star monoid homomorphisms, as a star monoid homomorphism. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">toMonoidHom</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_star</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">comp_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">comp_assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">id_comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StarMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">comp_id</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">comp</span>\n<span class=\"w\">  </span><span class=\"n\">mul_assoc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">comp_assoc</span>\n<span class=\"w\">  </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"n\">one_mul</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id_comp</span>\n<span class=\"w\">  </span><span class=\"n\">mul_one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">comp_id</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">one_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Comp</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">StarMonoidHom</span>\n\n\n<span class=\"c\">/-</span><span class=\"cm\">! ### Star monoid equivalences -/</span>\n\n<span class=\"sd\">/-- A *star monoid equivalence* is an equivalence preserving multiplication and the star</span>\n<span class=\"sd\">operation. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- By definition, a star monoid equivalence preserves the `star` operation. -/</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">inherit_doc</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"s2\">\" ‚âÉ‚ãÜ* \"</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"sd\">/-- Reinterpret a star monoid equivalence as a `MulEquiv` by forgetting the interaction with the</span>\n<span class=\"sd\">star operation. -/</span>\n<span class=\"n\">add_decl_doc</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">invFun</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">left_inv</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">right_inv</span>\n<span class=\"w\">  </span><span class=\"n\">coe_injective'</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MulEquivClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map_mul'</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">map_star'</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- The identity map as a star monoid isomorphism. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">refl</span><span class=\"kd\">]</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Inhabited</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ü®.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_refl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"sd\">/-- The inverse of a star monoid isomorphism is a star monoid isomorphism. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">symm</span><span class=\"kd\">]</span>\n<span class=\"n\">nonrec</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">apply_inv_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv_apply_apply</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span>\n<span class=\"w\">        </span><span class=\"n\">congr_arg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"sd\">/-- See Note [custom simps projection] -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n\n<span class=\"sd\">/-- See Note [custom simps projection] -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Simps</span><span class=\"bp\">.</span><span class=\"n\">symm_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"n\">initialize_simps_projections</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">symm_apply</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">invFun_eq_symm</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">symm_symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">symm_bijective</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">bijective_iff_has_inverse</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">‚ü®_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">symm_symm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">symm_symm</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"bp\">‚ü®</span><span class=\"n\">e</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"sd\">/-- Construct a `StarMulEquiv` from an equivalence in some type which preserves `*` and `star`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ofClass</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">EquivLike</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MulEquivClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">StarHomClass</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">EquivLike</span><span class=\"bp\">.</span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_toMulEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">refl_symm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"sd\">/-- Transitivity of `StarMulEquiv`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">trans</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">map_star'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">map_star'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">apply_symm_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">apply_symm_apply</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">symm_apply_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_apply</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">symm_trans_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚áë</span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">‚àò</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">trans_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">leftInverse_symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">LeftInverse</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">left_inv</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">rightInverse_symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">RightInverse</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">right_inv</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Bijective</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Star</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">]</span>\n\n<span class=\"sd\">/-- If a star monoid morphism has an inverse, it is an isomorphism of star monoids. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ofStarMonoidHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">g</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÅ</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">h‚ÇÇ</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"sd\">/-- Promote a bijective star monoid homomorphism to a star monoid equivalence. -/</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ofBijective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">MulEquiv</span><span class=\"bp\">.</span><span class=\"n\">ofBijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">    </span><span class=\"n\">map_star'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">map_star</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">coe_ofBijective</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">StarMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">ofBijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ofBijective_apply</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚ãÜ*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Bijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">StarMulEquiv</span><span class=\"bp\">.</span><span class=\"n\">ofBijective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Bijective</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">StarMulEquiv</span>\n</code></pre></div>\n</div></div>",
        "id": 528000475,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752122591
    },
    {
        "content": "<p>Awesome, thanks for thinking this through! Examples are always really helpful. </p>\n<p>Btw, is there any source of documentation for broad patterns/conventions in mathlib? I see there are various things like <a href=\"https://leanprover-community.github.io/contribute/style.html\">https://leanprover-community.github.io/contribute/style.html</a> and other sibling pages in <a href=\"https://leanprover-community.github.io/contribute/\">https://leanprover-community.github.io/contribute/</a> , but I'm curious if larger-scale design rationales for mathlib got written down somewhere, e.g. expectations of how FunLike, EquivLike, etc. are used, conventions about <code>coe</code> occurring in names.</p>\n<p>Maybe this is merely documented in doc comments distributed throughout mathlib, in which case I'm not at all upset. Just wondering if there's something else I should be reading to get oriented. :)</p>",
        "id": 528075176,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752151987
    },
    {
        "content": "<p>There are various \"library notes\" scattered throughout the library, but there is no tooling which currently displays them on <a href=\"https://leanprover-community.github.io/mathlib4_docs\">#docs</a> or anywhere else. You just have to search the source code for them.</p>\n<p>Caution: there are <code>FooHom</code> and <code>FooHomClass</code> scattered throughout the library. But there are two differences now from the original design / library note.</p>\n<ol>\n<li>It used to be that we needed a <code>FooHomClass</code> for every <code>FooHom</code>, but now we sometimes eschew the former when it is just a combination of existing classes that would otherwise cross boundaries. So in the above I didn't create a <code>StarMonoidHomClass</code> in the above and just used <code>MonoidHomClass</code> and <code>StarHomClass</code>.</li>\n<li>There are coercions from types with <code>FooHomClass</code> (or a combo of classes as in (1)) to <code>FooHom</code>. While we should definitely have the <em>constructor</em> (in my code above, this is <code>ofClass</code>), I think we will eventually shift to removing the coercions, which is why I didn't add those in my code above.</li>\n<li>After many discussions, I have become convinced that we should not have <code>def</code>s which take a <code>FooHomClass</code> argument and involve <code>ofClass</code>. Instead these should be a def which take a <code>FooHom</code> argument, and when users call this def, they can use <code>ofClass</code> if necessary.</li>\n</ol>",
        "id": 528089293,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1752155931
    }
]