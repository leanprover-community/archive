[
    {
        "content": "<p>I have been using <code>norm_num</code> tactic to deal with all equalities and inequalities that have no variables, but was surprised that it failed to prove the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>while it has no problem showing</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>minimal repro<br>\n<a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQP0CmIISc6AjAFxwA+AFFYFiEAlHAPRwCsNcAvHOXZc4lflgCecAHbQQAfSkBXEDgC0quABMIBAM5SA5PADu0ANb4iJMgCZq9Jqw7c4AHgFCAzCLGSZUeSUVdThTKDNdS2JSdE97BkoWIRd3QQ5vUTgJHDg4KGM4AG0KAF0c6VkFZSjrdAAWagSk5zcPdJ8sv0qgnCA\">https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQP0CmIISc6AjAFxwA+AFFYFiEAlHAPRwCsNcAvHOXZc4lflgCecAHbQQAfSkBXEDgC0quABMIBAM5SA5PADu0ANb4iJMgCZq9Jqw7c4AHgFCAzCLGSZUeSUVdThTKDNdS2JSdE97BkoWIRd3QQ5vUTgJHDg4KGM4AG0KAF0c6VkFZSjrdAAWagSk5zcPdJ8sv0qgnCA</a></p>",
        "id": 537034286,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1756704044
    },
    {
        "content": "<p>You can post code, instead of the link to <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">l1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n<span class=\"c1\">-- doesn't work</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">l2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n<span class=\"c1\">-- works</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">l3</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">l1</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">l4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>There's a button in the upper-right corner of the code box, that opens <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a> with that code. This is also preferred than posting a link, as this allows to view the code directly in your message without having to open the link.</p>",
        "id": 537034473,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756704222
    },
    {
        "content": "<p>Oh neat, I haven't noticed that button. In any case the repro is minimal, basically already in the post.</p>",
        "id": 537034568,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1756704305
    },
    {
        "content": "<p>I think there aren't extension to <code>norm_num</code> for abs (at least not for ℚ).</p>\n<p><code>norm_num</code> uses some parts of <code>simp</code> too, that's why it was able to solve l1. Notice that l3 and l4 can be solved by <code>norm_num1</code>, but cannot be solved by <code>simp</code>.<br>\nOn the other hand l1 can be solved by <code>simp</code>, but cannot be solved by <code>norm_num1</code>.</p>",
        "id": 537035484,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756705090
    },
    {
        "content": "<p>I'd say this is in scope for norm_num, but probably nobody's gotten around to writing the code for it</p>",
        "id": 537036605,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756705980
    },
    {
        "content": "<p>Should I file a GitHub issue somewhere? Also if someone points me in the right direction I can attempt to make a PR</p>",
        "id": 537040375,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1756708220
    },
    {
        "content": "<p>I've had a lot of help from <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> when trying to extend norm_num</p>",
        "id": 537043213,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756709774
    },
    {
        "content": "<p>I took a swing at it. Here's how far I got before getting frustrated with typeclasses and Qq: <a href=\"https://github.com/leanprover-community/mathlib4/pull/29223\">mathlib4#29223</a></p>",
        "id": 537164688,
        "sender_full_name": "David Renshaw",
        "timestamp": 1756756124
    },
    {
        "content": "<p>Please feel free to pick up where I left off.</p>",
        "id": 537164721,
        "sender_full_name": "David Renshaw",
        "timestamp": 1756756149
    },
    {
        "content": "<p>Nice, thanks for sharing! Lots of new things to learn. I do have experience writing compilers and AST transformations for JS/TS but this feels a whole different world. Sounds like a fun challenge. Any documentation on writing tactics I should start with?</p>",
        "id": 537168197,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1756758305
    },
    {
        "content": "<p>I couldn't stop myself from finishing the remaining cases: <a href=\"https://github.com/leanprover-community/mathlib4/pull/29223\">mathlib4#29223</a></p>",
        "id": 537187977,
        "sender_full_name": "David Renshaw",
        "timestamp": 1756772938
    }
]