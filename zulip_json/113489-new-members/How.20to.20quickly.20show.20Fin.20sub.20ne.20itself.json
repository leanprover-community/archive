[
    {
        "content": "<p>I have been struggling with this for a bit. I am not sure how one it supposed to quickly show or observe the fact that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>−</mo><mi>x</mi><mo mathvariant=\"normal\">≠</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a - x \\ne a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> is sum OfNat of the same <code>Fin n</code> as <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">x \\lt n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x \\ne 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>.</p>\n<p>As an example, I have this in my environment:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5000</span>\n<span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"n\">atLeastFour</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"n\">instAtLeastTwo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">AtLeastTwo</span>\n<span class=\"n\">instNeZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">m</span>\n</code></pre></div>\n<p>The <code>atLeastFour</code> and <code>instAtLeastTwo</code> I only derived in hopes that it would make this process easier.<br>\nI just need a proof that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo mathvariant=\"normal\">≠</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i - 1 \\ne i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>2</mn><mo mathvariant=\"normal\">≠</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i - 2 \\ne i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> where <code>i : Fin m</code>, in a way that is mostly automatic or at most one line.</p>",
        "id": 566161888,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767458566
    },
    {
        "content": "<p>can you provide a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 566162085,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767458806
    },
    {
        "content": "<p>Yes one second</p>",
        "id": 566162257,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767458969
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20quickly.20show.20Fin.20sub.20ne.20itself/near/566162085\">said</a>:</p>\n<blockquote>\n<p>can you provide a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>\n</blockquote>\n<p>I am not sure what properties I need to double check, so my MWE is in context to what I was trying do. Here the <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOAmApgGZzEQQ5xwAUAdgK4gDOcAXHAIJRRICecAJJ0YAZgBMASipwA3nXZxAqIQBfGbNQBGReLiATIjgLA5ESH9cAKwAGa2uobdHRiwB0zYAC9CcALxxdAKkNbRSV2X0F8ZygGBXxKagBaBLhUJAA3LxQAGUIkZhgAMQgGKEUAFjMnZlcPLzZfLAEIEEIAcyQZJJT0r2A6fM4YHLyYABUAdwhFKprPZ0Hh/Imp+rhAC/JGuGa2pEBL8hlUjLg+/IA5QgAtQigVuHOrm8MmardPMPXN7fb9mXJS1EUwGOCgA2mwZq9CABdOBxGTUdCEeBA1YFPrOCDEU4oJ4uSHHPDUaiHOrHODJbSAAyIyatGvCicxoFA+PSSYDyX44NSUQ0WUSGUy+US2RwgclRFyabz6dRGTwhZYgA\">Lean 4 Web Link</a>. Ideally, all those haves would be trivially true.</p>",
        "id": 566162739,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767459452
    },
    {
        "content": "<p>why are you using <code>Fin.ofNat</code></p>",
        "id": 566163130,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767459630
    },
    {
        "content": "<p>Do you mean just using <code>i - 1</code> in general?</p>",
        "id": 566163190,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767459706
    },
    {
        "content": "<p>no, I mean specifically the <code>let i := Fin.ofNat nums.size i</code></p>",
        "id": 566163267,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767459782
    },
    {
        "content": "<p>Ah, because in the original code I wanted to imitate wrap around indexing of arrays like you might have in some other languages</p>",
        "id": 566163369,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767459867
    },
    {
        "content": "<p>but it never wraps around?</p>",
        "id": 566163413,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767459907
    },
    {
        "content": "<p>It wraps when i = 0</p>",
        "id": 566163439,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767459932
    },
    {
        "content": "<p><code>i ∈ [:nums.size]</code></p>",
        "id": 566163452,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767459946
    },
    {
        "content": "<p>so <code>Fin.ofNat</code> never wraps</p>",
        "id": 566163464,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767459956
    },
    {
        "content": "<p>I am not sure if I understand. Does the loop not start with <code>i = 0</code>? Then <code>(0 : Fin nums.size) - 1</code> should be the last index</p>",
        "id": 566163579,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460064
    },
    {
        "content": "<p>I suppose it never wraps around in the MWE you are right, I still had the original code in mind...</p>",
        "id": 566163668,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460190
    },
    {
        "content": "<p>In the <a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQeJgCmAdnAMowAm+RpAzgMYGGVwBiwxdhMeO6hECCRwUAGUJI6MACoB3CAEkAZjjhwA3oEbgOAC44MgJ5EAvnADaAEUINglJFgEBRAI5wtAXTVwAFAA86PTgAQSgoJEN3AEpvHxEsII5SAIA6OmAAL0IY9R9UYkI3fRFAAyI4LCjfVEKANyCA8yQPOABeOAasD0rdbwAmOEATIna6FKYAV2J4Bqa9NqxDb3U5dAgAczgMeGK4AB5yuFWSQnDMDM51+MW4KDkLapcajwBuOEI/JAZ4NGBAhJE8gouNKGISVPK1YGg3zzOAQECEVZIGJXG4WQAJhCEwhFRhAJjAAPowCBiH4wLzqdRIMBgdCREnSFKUMY04AMFCEfHAZTKQkKfECfHjSYpcBXKk0umkxnMzBsmAcrk8uhjRxS8BQK6TVD41H9cz3R4owjKTiEXz0mA4rj45Wq6Sc7lREVgKBwAD8+LwFOuxtNcEAF+T+EZEi1pFkwYLwCopACMABpfKkQ1K6OHI+Unb0Ex7AJfkmugIHxxDGIC9FKYXBgUDGn2gYuptLgofhhZgSAA1grufjDjAnAIQM6Nd6xtxRC9iAWiyWXm8PvBNmXKQ3JQyW/jKFACA6eb3+4Ih1dR2aAAwTqfF0s4AC017gt9e73AAl8pH0gFRCMHARKcODESrmMQKSRhIUiyAozT6N+ZTfneMazOUCwPg+lKEHQBA3neA7CHAygQBAmhvnA75mOYAByhAAFrHARxDNHE+z6Ekf4ARR1FbuUkGiHAZQiHeCS6HMSF3uo6TgPiSDoOgfCUMaPpEOylBkTIoBobEl6BPooThJEiiTAAzL0OSEUEJHeBoqDwfo/RDKQgDkRH+gxwAArCebkmOZqD9PoGlpJkZptP0ABUf4eeoFn6UEgAARHA35Mb+vnpFkCYnk5GnmMAzQOelmVOTGJ4AHoACxhZoqBFUEADEvnJgyRJJNw8BtKQADUcDwQ5gDARHAdT6HpMCGQmvlCvAdTNaV+gaD1QT9YZcAAPTzX+JYjCN03NXAZiCXAiiUCk1akJQEBlqgSA1Ga4iSNIbC4q6+gVbZK1+VkCEwnCCJIN4p3nbFlYgVd4EET5T1JYQwEwKB0jyEDbT+m98KInm6jfWanDSGxNFBBjHGJf5CFw5E72I2WeGuqgQTfr+5i6LjWTNEdVwCPAcVtEkKQQMoZEoMtIAjKDsVLrFygbMLwO8xl97tc0LTNStGXNAAPgrPN0BLd69NLsvi7laAkFcyNnajdBkBA6BjDAwAQERw24pMKvy60jnbfM+sUmJYCwsQjbmAAQvh6Ds1A+KFIS1aEAmWAh4qwcuM03OoKo3reijogQwD0NBDZKs4ni9u5c7CxJ0nUBstwgQJ3AcjAGgItwMrCeC0Xc6fL4l1gdDKgq7Fviwe1lToWEkQJ5CIDGUX6jN/AcRp+3Cidxp3c+L3RlwAPUBD8oI/IuP1yl2hGwVVXNf+tqEzAC4YwciNCY1Am2o1IKtswHmrsGz9qD8/ogCIRO0cCABBE2daqWnqmjHgQ0nprT8I7YKTshKvzdqAMAIgrbe3gd6DE2lsQjUJMSUkcY0EUhqrghkypWwQAajwR+eIY78hIKsNA+Cd7ekwYYFIAhiD0O1EAghXh4GNV/ttHKzQj7k1QH4RuFJ5iCikGhAAhBseojsajwJuCIfUvCd4pxAJwG0JY9AEJga1dqTkf5QIAUQ0MICuBgOzpA16hcmGVQYNUBg7Z2CgMtKQ2hujCwc10VgRq+I/GTmIAUVYBDUT6lBuSJhKcfJwDav0NqPhSBwUqEMQxCTjEF1hAjT6TDV7QHXvAzAxAkBQGrqgV2UAeBjCgKQf0QiEw/BNmbC2VsX7qH9BMGpHxTqOEILIiOkQ16GBfg+JxLi3E1IUvKJSKl4R0CAA\">original code</a> it wraps on line 56.</p>",
        "id": 566163689,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460222
    },
    {
        "content": "<p>no I mean</p>",
        "id": 566163731,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460270
    },
    {
        "content": "<p>if <code>i ∈ [:nums.size]</code></p>",
        "id": 566163739,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460276
    },
    {
        "content": "<p>then <code>i &lt; nums.size</code></p>",
        "id": 566163744,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460280
    },
    {
        "content": "<p>so <code>Fin.ofNat nums.size i</code> doesn't wrap the value of <code>i</code></p>",
        "id": 566163756,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460300
    },
    {
        "content": "<p>because <code>i</code> was already less than <code>nums.size</code></p>",
        "id": 566163763,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460309
    },
    {
        "content": "<p>does that make sense?</p>",
        "id": 566163783,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460340
    },
    {
        "content": "<p>Yes, but I wanted <code>nums[i - x]</code> to wrap, if I drop that line than any natural offset requires a proof of it being part of the interval and no longer wraps automatically</p>",
        "id": 566163822,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460395
    },
    {
        "content": "<p>I did it as a coercion</p>",
        "id": 566163853,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460436
    },
    {
        "content": "<p>so what you want to do here is use <code>Fin.mk</code> instead of <code>Fin.ofNat</code></p>",
        "id": 566163945,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460530
    },
    {
        "content": "<p>because <code>Fin.ofNat</code> is for when you don't know the number is below the bound so you want to wrap it if it's too big</p>",
        "id": 566163956,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767460552
    },
    {
        "content": "<p>I might be using this wrong, but before I did indeed have <code>Fin.mk</code>, like this:<br>\n<code>let i := Fin.mk i (Membership.get_elem_helper h rfl)</code><br>\nBut it seemed more cumbersome and I didn't seem to lose any information. Now <code>i : Fin [:nums.size].stop</code> which should be the same as <code>Fin nums.size</code></p>",
        "id": 566164203,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460886
    },
    {
        "content": "<p>It doesn't seem to change how one might get <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo mathvariant=\"normal\">≠</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i - 1 \\ne i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span></p>",
        "id": 566164313,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767460995
    },
    {
        "content": "<p>well it makes it a lot easier to show <code>i.val = i✝</code></p>",
        "id": 566164551,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767461253
    },
    {
        "content": "<p>I guess yeah you're right it doesn't change how to show <code>i - 1 ≠ i</code></p>",
        "id": 566164564,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767461270
    },
    {
        "content": "<p>Is this perhaps simply a case of Mathlib not having these lemmas? Or no easy chain to leads to it? Perhaps there really isn't a \"quick\" way to show this yet</p>",
        "id": 566165035,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767461859
    },
    {
        "content": "<p>I used LeanSearch and Moogle for quite a bit but couldn't find anything</p>",
        "id": 566165090,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767461928
    },
    {
        "content": "<p>while I wouldn't call this \"quick\" it's not really long either:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5000</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"c1\">-- have atLeastFour : 4 ≤ nums.size := by omega</span>\n<span class=\"w\">  </span><span class=\"c1\">-- have instAtLeastTwo : nums.size.AtLeastTwo := ⟨by omega⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">instNeZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"bp\">.</span><span class=\"n\">get_elem_helper</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_eq_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">lia</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_eq_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"c1\">-- simp?</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">coe_ofNat_eq_mod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_mod</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_eq_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"c1\">-- simp?</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">coe_ofNat_eq_mod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_mod</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 566165158,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1767461988
    },
    {
        "content": "<p>By the way, to make your question a <em>minimal</em> working example, you'd at least trim the monad stuff:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">nums</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Int32</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5000</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- have atLeastFour : 4 ≤ nums.size := by omega</span>\n<span class=\"w\">  </span><span class=\"c1\">-- have instAtLeastTwo : nums.size.AtLeastTwo := ⟨by omega⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">instNeZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">nums</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"bp\">.</span><span class=\"n\">get_elem_helper</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">grind</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 566165662,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1767462584
    },
    {
        "content": "<p>I see, before I did get to the <code>⊢ ¬2 % nums.size = 0</code> stage, but stopped because I didn't see a quick way of closing the goal. I suppose I just needed 2 more lines. Thanks for the help!</p>",
        "id": 566165668,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767462585
    },
    {
        "content": "<p>Yes apologies, I only did the monad to get the constraints imposed by the for loop. I wasn't super sure if that would be relevant or not</p>",
        "id": 566165760,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767462714
    },
    {
        "content": "<p>I ended up making this lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">sub_ne_self</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_eq_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">val_inj</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">coe_ofNat_eq_mod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_mod</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">mod_eq_of_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">pos_of_neZero</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">ne</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hb</span>\n</code></pre></div>\n<p>For more ergonomics</p>",
        "id": 566168608,
        "sender_full_name": "Mathias Sven",
        "timestamp": 1767465727
    }
]