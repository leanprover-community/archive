[
    {
        "content": "<p>The following are two very minimal proofs using the bidirectional lemma <code>mul_eq_zero</code> to rewrite the hypothesis.</p>\n<p>For referene, here is the signature of the lemma confirming it is bidirectional:<br>\n<code>mul_eq_zero.{u_1} {M₀ : Type u_1} [MulZeroClass M₀] [NoZeroDivisors M₀] {a b : M₀} : a * b = 0 ↔ a = 0 ∨ b = 0</code></p>\n<p>The following proof works fine, pretty much replicates the signature.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_eq_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>However, in the other direction it fails. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_eq_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; ---------- fails</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>I am puzzled as I had recently learned that <code>rw</code> only works with lemmas stating equivalence, <code>=</code> or <code>⇔</code>.</p>\n<p>That suggests they work in both directions, including for <code>rw</code>.</p>\n<p>What am I misunderstanding?</p>",
        "id": 478961574,
        "sender_full_name": "rzeta0",
        "timestamp": 1729877522
    },
    {
        "content": "<p>You can use <code>rw [← mul_eq_zero] at h</code> to rewrite in the other direction</p>",
        "id": 478961681,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729877563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/113489-new-members/topic/can't.20seem.20to.20.60rw.60.20bidirectional.20lemma.20in.20both.20directions/near/478961681\">said</a>:</p>\n<blockquote>\n<p>You can use <code>rw [← mul_eq_zero] at h</code> to rewrite in the other direction</p>\n</blockquote>\n<p>aargh! this is ugly. </p>\n<p>I thought we avoided directions eg <code>mpr</code> and <code>mp</code>because <code>rw</code> insisted on only working with bidirectional relations.</p>",
        "id": 478961938,
        "sender_full_name": "rzeta0",
        "timestamp": 1729877673
    },
    {
        "content": "<p><code>←</code> is special <code>rw</code> notation for \"write in the other direction\", it's unrelated to <code>mp</code> and <code>mpr</code></p>",
        "id": 478962031,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1729877718
    },
    {
        "content": "<p>Thanks. I'm just commenting that this is ugly language design because if <code>rw</code> asserts the lemma must work in both directions (unlike <code>apply</code>) then it should try to match the pattern in both directions.</p>",
        "id": 478962401,
        "sender_full_name": "rzeta0",
        "timestamp": 1729877860
    },
    {
        "content": "<hr>\n<p>The following examples use <code>apply</code> and require <code>mpr</code> and <code>mp</code> - which is reasonable because <code>apply</code> doesn't demand the lemma is bidirectional.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_eq_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_eq_zero</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 478963037,
        "sender_full_name": "rzeta0",
        "timestamp": 1729878152
    },
    {
        "content": "<hr>\n<p>So i guess, setting aside my aesthetic concerns, is there any benefit in using <code>rw</code> over <code>apply</code> in this scenario?</p>\n<p>I'm thinking about difference between <code>apply</code> and <code>exact</code> where<code>exact</code> is stricter and the benefits include highlighting errors / misunderstandings sooner than <code>apply</code>.</p>\n<p>I'm thinking that because <code>rw</code> is stricter on the lemmas it will allow, there might be a benefit.</p>",
        "id": 478963945,
        "sender_full_name": "rzeta0",
        "timestamp": 1729878540
    },
    {
        "content": "<p>When you're using <code>rw</code>, you often want surgical control over what's being rewritten. If it tried both directions, it could make some rewrites very hard to accomplish.</p>",
        "id": 478964012,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878575
    },
    {
        "content": "<p>With <code>rw</code>, the only rule you need to know is \"left-hand sides get transformed into right-hand sides\"</p>",
        "id": 478964131,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878610
    },
    {
        "content": "<p>(plus there are a number of other limitations that everyone eventually runs into)</p>",
        "id": 478964174,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878637
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>  - so should I conclude that <code>rw</code> is almost lexical pattern matching and replacement, whereas <code>apply </code> might do other things and the replaced expressions may not be the RHS of the applied lemma?</p>\n<p>That would be a valid reason, in my beginner brain, to entertain the existence of both.</p>",
        "id": 478964583,
        "sender_full_name": "rzeta0",
        "timestamp": 1729878842
    },
    {
        "content": "<p>Lean is extensible though, so here is your version of <code>rw</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"rzeta0_rw \"</span><span class=\"w\"> </span><span class=\"s2\">\"[\"</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"s2\">\"]\"</span><span class=\"w\"> </span><span class=\"n\">loc?</span><span class=\"o\">:(</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">location</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"n\">loc?</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">t</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">[</span><span class=\"bp\">$</span><span class=\"n\">loc?</span><span class=\"o\">]</span><span class=\"bp\">?</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rzeta0_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_eq_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; ---------- succeeds</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>I only made it support a single <code>rw</code> lemma for simplicity. You can't do <code>rzeta0_rw [lem1, lem2]</code> for example.</p>\n<p><code>rzeta0_rw [mul_eq_zero] at h</code> is equivalent to <code>first | rw [mul_eq_zero] at h | rw [← mul_eq_zero] at h</code>. The <code>first</code> combinator goes with the first of its subtactics that succeed.</p>",
        "id": 478964615,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878844
    },
    {
        "content": "<p>Yes, <code>rw</code> operates using pattern matching.</p>",
        "id": 478964671,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878873
    },
    {
        "content": "<p>I'm fearing that you're thinking <code>apply</code> does something fancy. It's also using a simple rule, probably simpler.</p>",
        "id": 478964743,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729878907
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/can't.20seem.20to.20.60rw.60.20bidirectional.20lemma.20in.20both.20directions/near/478964743\">said</a>:</p>\n<blockquote>\n<p>I'm fearing that you're thinking <code>apply</code> does something fancy. It's also using a simple rule, probably simpler.</p>\n</blockquote>\n<p>So what are the relative benefits of <code>rw</code> and <code>apply</code> in this simple example? </p>\n<p>The answer might be \"none\", and that the benefits only appear in more complicated examples.</p>",
        "id": 478964904,
        "sender_full_name": "rzeta0",
        "timestamp": 1729878984
    },
    {
        "content": "<p>I'd say \"none\". There are probably second-order or third-order reasons why someone might reach for one or the other in a particular moment, but in a code review I'd accept either.</p>",
        "id": 478965183,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729879113
    },
    {
        "content": "<p>Some people like forward reasoning, some people like backward reasoning. With <code>rw</code> you can either <code>rw</code> at <code>h</code>, or <code>rw</code> the goal. With <code>apply</code>, you can only modify the goal.</p>",
        "id": 478965276,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729879167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/can't.20seem.20to.20.60rw.60.20bidirectional.20lemma.20in.20both.20directions/near/478965276\">said</a>:</p>\n<blockquote>\n<p>With <code>apply</code>, you can only modify the goal.</p>\n</blockquote>\n<p>isn't this an example of <code>apply</code> at a hypothesis, from the above fully working code?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_eq_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 478967469,
        "sender_full_name": "rzeta0",
        "timestamp": 1729880130
    },
    {
        "content": "<p><code>apply .. at</code> is a different tactic from <code>apply</code></p>",
        "id": 478967522,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880156
    },
    {
        "content": "<p>It's defined in mathlib: <a href=\"https://github.com/leanprover-community/mathlib4/blob/7f0670510ccf43e0e595357e31b7b8212cc02c45/Mathlib/Tactic/ApplyAt.lean#L19-L40\">https://github.com/leanprover-community/mathlib4/blob/7f0670510ccf43e0e595357e31b7b8212cc02c45/Mathlib/Tactic/ApplyAt.lean#L19-L40</a></p>",
        "id": 478967675,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880217
    },
    {
        "content": "<p>That is a surprise to me. </p>\n<p>So when you say different tactic, the rules they use to manipulate the goal / hypothesis are different?</p>",
        "id": 478967676,
        "sender_full_name": "rzeta0",
        "timestamp": 1729880217
    },
    {
        "content": "<p>Completely different</p>",
        "id": 478967699,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880228
    },
    {
        "content": "<p><code>apply thm at h</code> looks for an argument to <code>thm</code> for which <code>h</code> is applicable, and the remaining arguments become new goals. In the original goal, <code>h</code> is modified to the result of <code>thm</code>.</p>",
        "id": 478967930,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880313
    },
    {
        "content": "<p>Thanks - that is very useful, I will need take some time to think about this.</p>",
        "id": 478968040,
        "sender_full_name": "rzeta0",
        "timestamp": 1729880361
    },
    {
        "content": "<p><code>apply thm</code> checks that the result of <code>thm</code> proves the current goal, and all the arguments to <code>thm</code> become new goals. (That's slightly simplified, but for most cases it's true. The complexity comes from the fact it figures out how many arguments <code>thm</code> actually needs to prove the goal.)</p>",
        "id": 478968204,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880422
    },
    {
        "content": "<p>This is the extent of the smarts of <code>apply</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- two goals: ⊢ p and ⊢ q</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- one goal: ⊢ p</span>\n</code></pre></div>\n<p>Recall that <code>p → q → r</code> is the same as <code>p → (q → r)</code>.</p>\n<p>(For completeness reasons, I feel compelled to mention that it still has a couple other tricks up its sleeve, though they're not the sorts of things you'd notice unless you really understand some details about higher-order unification — I was using Lean for years before noticing, and only because I was working on internals.)</p>",
        "id": 478968514,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880561
    },
    {
        "content": "<p>So in this super-simple example, let me test my understanding:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">ne_of_lt</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<ul>\n<li>the theorem signature is <code>ne_of_lt.{u_1} {α : Type u_1} [Preorder α] {a b : α} (h : a &lt; b) : a ≠ b</code></li>\n<li>Here <code>apply</code> checks that the result of <code>ne_of_lt</code> proves the current goal.</li>\n<li>that result is <code>a ≠ b</code> which does indeed match the current goal</li>\n<li>the arguments to the theorem are <code> a &lt; b</code> and they become the current goal - which is indeed the case in infoview</li>\n</ul>\n<p>I think I'm correct here. I will try the same with <code>apply at</code> next.</p>\n<p>PS - this looks like:</p>\n<ul>\n<li>goal is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></li>\n<li>theorem is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">P \\implies Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7073em;vertical-align:-0.024em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⟹</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></li>\n<li><code>apply</code> theorem so new goal is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span></li>\n</ul>",
        "id": 478968915,
        "sender_full_name": "rzeta0",
        "timestamp": 1729880737
    },
    {
        "content": "<p>Yes, that looks right.</p>",
        "id": 478969016,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729880772
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 478986789,
        "sender_full_name": "rzeta0",
        "timestamp": 1729889327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> <a href=\"#narrow/channel/113489-new-members/topic/can't.20seem.20to.20.60rw.60.20bidirectional.20lemma.20in.20both.20directions/near/478962401\">said</a>:</p>\n<blockquote>\n<p>Thanks. I'm just commenting that this is ugly language design because if <code>rw</code> asserts the lemma must work in both directions (unlike <code>apply</code>) then it should try to match the pattern in both directions.</p>\n</blockquote>\n<p>I think you're mixing up two things.  The purpose of <code>rw</code> is to change a statement (either a hypothesis or the goal) into an <em>equivalent</em> statement.  The reason for requiring that you use a biconditional statement in <code>rw</code>, rather than just a conditional, is to ensure that the result of the rewriting will be <em>equivalent</em> to the original (and not just something that implies, or is implied by, the original).  For example, if you have <code>h : P ↔ Q</code>, then <code>P</code> and <code>Q</code> are equivalent, so replacing one with the other inside any statement will give you an equivalent statement.  The question of which way the replacement goes--whether <code>P</code> is replaced with <code>Q</code> or <code>Q</code> is replace with <code>P</code>--is an entirely different matter.  That's something the user probably wants to have control over, so there is a way to specify: <code>rw [h]</code> means that <code>P</code> should be replaced with <code>Q</code>, and <code>rw [←h]</code> means that <code>Q</code> should be replaced by <code>P</code>.  Notice that the replacement can be made inside a more complicated statement.  For example, if the goal is <code>(P ∨ R) ∧ (¬P ∨ S)</code>, then <code>rw [h]</code> will change the goal to <code>(Q ∨ R) ∧ (¬Q ∨ S)</code>.</p>\n<p>The purpose of <code>apply</code> is entirely different.  <code>apply</code> is about <em>inference</em>, not <em>equivalence</em>.  <code>apply thm</code> asks Lean to determine if <code>thm</code> can be used to infer the goal from some other statement (or perhaps several statements).  If so, Lean sets the other statement to be the new goal.  This new goal is not necessarily <em>equivalent</em> to the original goal; rather, the original goal can be <em>inferred</em> from the new goal.</p>",
        "id": 478987602,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1729889765
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453098\">@Dan Velleman</span>  thank you - \"inference vs equivalence\" is a very helpful way to see the difference.</p>",
        "id": 478989416,
        "sender_full_name": "rzeta0",
        "timestamp": 1729890895
    }
]