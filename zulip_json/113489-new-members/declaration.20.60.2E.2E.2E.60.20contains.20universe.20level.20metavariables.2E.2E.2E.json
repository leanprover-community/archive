[
    {
        "content": "<p>I'm trying to formalize realtime cellular automata with 1D neighborhood as language deciders (akin to turing machines). I got quite far, even proving some nice closure properties, until I wanted to instantiate my structures with concrete types and lean complained about universe variables. After I fixed that, hell broke loose and lean started to give me <em>\"Failed to infer universe levels\"</em> or <em>\"declaration <code>...</code> contains universe level metavariables at the expression\"</em> everywhere. </p>\n<p><a href=\"https://live.lean-lang.org/#codez=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\">I have my problematic definitions here.</a></p>\n<p>This definition does not work (but it looks nice):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Advice</span><span class=\"bp\">.</span><span class=\"n\">rt_closed_problematic</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Γ</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Alphabet</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Alphabet</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Advice</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">ℒ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CA_rt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ℒ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CA_rt</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>...whereas this definition works, but looks ugly and I hope lean doesn't force me to do that everywhere (especially since the literature on cellular automata doesn't have to restrict their statements to some universes):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Advice</span><span class=\"bp\">.</span><span class=\"n\">rt_closed</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Γ</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Alphabet</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Alphabet</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Advice</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ℒ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CA_rt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Γ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ℒ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CA_rt</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>(it states that an advice is real-time closed, if the language family recognized by real time cellular automata with access to that advice equals the language family recognized by real time cellular automata without that advice)</p>\n<p>Is there a way to avoid these universe issues?<br>\nOne practical idea I had was to describe the alphabet and state set Q of an automaton just as <code>Fin k</code>, instead of <code>Q: Type*</code> and <code>[Fintype Q]</code>,  to make everything <code>Type 0</code>. But this would make construction quite unergonomic.<br>\nIs the underlying problem that I would get a logical problem if I could talk about \"the set of languages that can be recognized by a cellular automaton in an arbitrary type universe\"? (Compared to \"of a given type universe\")</p>\n<p>Thanks for your time <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 562303599,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1765107445
    },
    {
        "content": "<p>The general problem you're running into is that in the signature of <code>LCellAutomaton</code> is <code>LCellAutomaton.{u_1, u_2} (α : Type u_1) : Type (max u_1 (u_2 + 1))</code>. The parameter <code>u_2</code> can't really be inferred from this.</p>\n<p>Letting <code>Q</code> be universe polymorphic is fine, but then you have to treat its universe level as being an \"explicit\" universe parameter, and just feel lucky in the cases that Lean decides it can infer it.</p>\n<p>To be clear, this is not a logical problem, but rather an ergonomics problem from letting things be universe polymorphic and not giving a way for Lean to figure out the universe levels automatically.</p>\n<p>One solution is to work more carefully on the orders of universe parameters. For example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LCellAutomaton</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">CellAutomaton</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">embed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span>\n<span class=\"w\">    </span><span class=\"n\">border</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span>\n</code></pre></div>\n<p>will put the uninferrable <code>u</code> <em>first</em>. The other parameter can always be inferred from the <code>α</code> argument. That way, later, you can write <code>LCellAutomaton.{u}</code>. (Notation note: you can give prefixes of the universe parameters like this. Also, you can use <code>_</code> for parameters you want Lean to infer.)</p>\n<p>Somehow this change is enough to get Lean to accept your <code>rt_closed_problematic</code>... I'm suspicious of this being robust, but <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 562307626,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765112956
    },
    {
        "content": "<p>You could also decide that <code>Q</code> must live in the same universe as <code>α</code>. That's probably not going to really restrict you — there's always <code>ULift</code> to bring types like <code>Fin n</code> up to the universe for <code>α</code>. Adding this universe restriction would make things inferrable.</p>",
        "id": 562307744,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765113127
    },
    {
        "content": "<p>Consider adding <code>@[pp_with_univ]</code> to <code>CellAutomaton</code>, given that the universe level is necessary to understand it.</p>",
        "id": 562307818,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765113229
    },
    {
        "content": "<p>it's because you bundled the type in <code>CellAutomation</code></p>",
        "id": 562308336,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765113901
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Thanks! Didn't know about ULift, will try to use it :)</p>",
        "id": 562308516,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1765114132
    },
    {
        "content": "<blockquote>\n<p>it's because you bundled the type in <code>CellAutomation</code></p>\n</blockquote>\n<p>I was wondering about that. But later I have to deal with a structure which has two alphabets and a cellular automaton over Q1 and a finite state machine over Q2. I was trying to avoid having to mention all four types every time I deal with an instance of it.</p>",
        "id": 562308602,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1765114252
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> What do you mean precisely? What is \"it\" that is because the type's bundled?</p>\n<p>There's nothing wrong in principle with bundling a type in <code>CellAutomaton</code>. There are consequences — what I mentioned about needing to treat the universe level as explicit — but it's still workable.</p>",
        "id": 562309417,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765115270
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/declaration.20.60.2E.2E.2E.60.20contains.20universe.20level.20metavariables.2E.2E.2E/near/562309417\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> What do you mean precisely? What is \"it\" that is because the type's bundled?</p>\n<p>There's nothing wrong in principle with bundling a type in <code>CellAutomaton</code>.</p>\n</blockquote>\n<p>yeah but what this means is that every time you write <code>CellAutomaton</code> you have to make sure you have a new universe level, and this doesn't happen if it's unbundled because <code>Type*</code> takes care of that</p>",
        "id": 562309509,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765115374
    },
    {
        "content": "<blockquote>\n<p>You could also decide that <code>Q</code> must live in the same universe as <code>α</code>. That's probably not going to really restrict you — there's always <code>ULift</code> to bring types like <code>Fin n</code> up to the universe for <code>α</code>. Adding this universe restriction would make things inferrable.</p>\n</blockquote>\n<p>This would be a problem though if I need an automaton where its state type Q is <code>α -&gt; α</code>, no?<br>\nFor some examples, my alphabet is e.g. Bool (which I think I shouldn't convert to <code>ULift Bool</code>)</p>",
        "id": 562309725,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1765115688
    },
    {
        "content": "<p>(Basically, I can't tell whether you're giving design advice <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>, or just expanding on why there's an uninferable universe parameter in the first place.)</p>",
        "id": 562309739,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765115711
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"234196\">@Henning Dieterichs</span> The type <code>α -&gt; α</code> lives in <code>Type u</code> still, so it shouldn't be a problem.</p>",
        "id": 562309786,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765115763
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/declaration.20.60.2E.2E.2E.60.20contains.20universe.20level.20metavariables.2E.2E.2E/near/562309739\">said</a>:</p>\n<blockquote>\n<p>(Basically, I can't tell whether you're giving design advice <span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span>, or just expanding on why there's an uninferable universe parameter in the first place.)</p>\n</blockquote>\n<p>I feel like it's a bit of both? Because this causes an uninferrable universe parameter, and also because of some other reasons, bundling types feels like a bad idea to me.</p>",
        "id": 562309863,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765115833
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"234196\">@Henning Dieterichs</span> I didn't analyze the meaning of your universe levels — I didn't even get as far as thinking about what alpha represented — so it could be bad advice!)</p>",
        "id": 562309893,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765115857
    },
    {
        "content": "<p>will I regret it if I just remove universe polymorphism and require Type 0 for states to simplify the problem?<br>\nI saw that quite some effort went into dealing with universes when regular languages were defined <a href=\"https://github.com/leanprover-community/mathlib4/blob/419be563ec4b4d865cb59bacd8648f872b1a27de/Mathlib/Computability/DFA.lean#L265-L284\">here</a> in mathlib.<br>\nThere, <a href=\"https://github.com/leanprover-community/mathlib4/blob/419be563ec4b4d865cb59bacd8648f872b1a27de/Mathlib/Computability/DFA.lean#L57\">the state type is not in the DFA</a>, but outside and can be from any universe. A DFA doesn't even come with <code>[Fintype σ]</code>, which I find quite misleading...</p>",
        "id": 562313254,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1765119435
    },
    {
        "content": "<p>I would prefer everything to be universe polymorphic</p>",
        "id": 562313851,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765119981
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"234196\">@Henning Dieterichs</span> You don't have to be universe polymorphic, but the deal is that it can be a pain if later you discover that your formalization needs a type from a higher universe. Notice that if you include the state type as a field, even if you restrict it to <code>Type 0</code>, the type of the automaton itself is in <code>Type 1</code>. What if some construction wants to use a subset of automata as the states for another automaton? (Though this is probably surmountable on a case-by-case basis) That all said, if you don't have a lot of material, you could choose to defer universe polymorphism until you need it.</p>\n<p>Re DFA not including finiteness, a mathlibism is to avoid typeclasses or hypotheses that aren't necessary for the definition itself. Since the state type is coming from outside the definition, it's up to you to provide the Fintype (or Finite) hypothesis. It can feel misleading, but definitions like Language.IsRegular just need to remember to include finiteness.</p>\n<p>BTW, the theorem you point out about DFAs is not effort for <em>dealing</em> with universes per se. It's proving the technical result that it suffices to consider only those state types in <code>Type 0</code>. (Maybe it's also worth pointing out that the type of the general <code>Language.isRegular_iff</code> has the same annoying problem you're running into; if you use it for rewriting, the <code>v</code> parameter isn't determined by the LHS, so you have to specify it.)</p>\n<p>One interesting design alternative to <code>DFA</code> is to use a universal <code>σ</code> that you'd use for multiple machines. The DFA contains a finite subset of its actual states. In practice, a construction might define an <code>inductive</code> that includes all the kinds of states you'd need. It's also possible to transfer a family of DFAs to the same state type this way.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">MyDFA</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">states</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">σ</span>\n<span class=\"w\">  </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">σ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">σ</span>\n<span class=\"w\">  </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">σ</span>\n<span class=\"w\">  </span><span class=\"n\">accept</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">σ</span>\n<span class=\"w\">  </span><span class=\"n\">states_finite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">states</span><span class=\"bp\">.</span><span class=\"n\">Finite</span>\n<span class=\"w\">  </span><span class=\"n\">accept_subset</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">accept</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">states</span>\n<span class=\"w\">  </span><span class=\"n\">step_mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">states</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">states</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- For extensionality. The `step` function is equal to `start` outside the domain. -/</span>\n<span class=\"w\">  </span><span class=\"n\">step_not_mem</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∉</span><span class=\"w\"> </span><span class=\"n\">states</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">step</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">start</span>\n</code></pre></div>",
        "id": 562319858,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1765125990
    }
]