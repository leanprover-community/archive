[
    {
        "content": "<p>I'm experimenting with modifications of ProofWidgets (adding things to the Recharts module).  I learned from <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20Still.20confused.20about.20Mathlib.20installation/near/488653799\">this post</a> that I can get in trouble if I <code>require</code> ProofWidgets separately and in addition to Mathlib, since requiring Mathlib gets ProofWidgets as well.</p>\n<p>What's a good way to use a modified version of ProofWidgets with Mathlib?  (Hopefully I don't have to have my own copy of Mathlib and everything else.)  I can either pull it from my cloned ProofWidgets repo at github, or use a local copy, if there's an easy way to do that (maybe by copying the files into the project where I'm using ProofWidgets??).  Thanks.</p>",
        "id": 490081442,
        "sender_full_name": "mars0i",
        "timestamp": 1734660553
    },
    {
        "content": "<p>I think you do want a modified version of Mathlib, but the only change that is required (hopefully) is that you update <code>Mathlib</code>'s <code>lakefile.lean</code>, and modify the version of proofwidgets it uses, to your own branch/fork. <br>\nThen in your own project, you can require your own branch/fork of Mathlib.</p>\n<p>If you're a Mathlib contributor, you have write access to branches of Mathlib, which means Github CI will automatically build Mathlib for you, so that you don't have to do this yourself.</p>",
        "id": 490158641,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1734700437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/490158641\">said</a>:</p>\n<blockquote>\n<p>I think you do want a modified version of Mathlib, but the only change that is required (hopefully) is that you update <code>Mathlib</code>'s <code>lakefile.lean</code>, and modify the version of proofwidgets it uses, to your own branch/fork.</p>\n</blockquote>\n<p>You'll want to push this to github so that you get a cache you can download</p>",
        "id": 490158965,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734700557
    },
    {
        "content": "<p>Another option would be to just make your own copy of the Recharts module in your own project, since mathlib doesn't use it anyway.</p>",
        "id": 490159075,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734700584
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> , <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>.  I'm a little bit confused. Maybe I should have said more about my goals. I'm working on a simple PR for the Recharts part of ProofWidgets.  I want to test the modified ProofWidgets before I submit the PR.  I want to test it using my own project, which also imports Mathlib.</p>\n<p>I'm not sure what your advice is.  Is it that rather than submit a PR on github to ProofWidgets, I need to choose or create a branch of Mathlib as a whole to write to it?  I don't know the process of adding theorems and such to Mathlib.  Maybe it's different from common software package contribution techniques?</p>\n<p>Note that since I'm not contributing theorems, but rather contributing code that does something when it runs, the fact that it type checks is not sufficient.  So passing CI wouldn't show that my PR is ready.</p>",
        "id": 490200816,
        "sender_full_name": "mars0i",
        "timestamp": 1734714711
    },
    {
        "content": "<p>I think the easiest approach is to make a branch of mathlib that depends on your branch of proof widgets, and then have your own project depend on that branch of mathlib</p>",
        "id": 490202124,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734715224
    },
    {
        "content": "<p>OK, thanks <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span></p>",
        "id": 490202224,
        "sender_full_name": "mars0i",
        "timestamp": 1734715269
    },
    {
        "content": "<p>It feels like a lot to require for a simple 10-line PR to what appears to be a relatively small library (ProofWidgets), though. That's a thought for long-term consideration, maybe. No need for anyone to respond.  It makes no difference now. Putting the idea into the air.</p>",
        "id": 490202811,
        "sender_full_name": "mars0i",
        "timestamp": 1734715527
    },
    {
        "content": "<p>My advice would be to write a test inside the Demos folder of ProofWidgets that doesn't rely on mathlib and your downstream project, because the next contributor to ProofWidgets is otherwise not going to be able to check if they broke anything.</p>",
        "id": 490202959,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734715583
    },
    {
        "content": "<p>Yes, that makes sense.  First I want to test it on my own project, though.</p>",
        "id": 490203072,
        "sender_full_name": "mars0i",
        "timestamp": 1734715627
    },
    {
        "content": "<p>And I want to make sure that importing ProofWidgets works with an outside project.</p>",
        "id": 490203117,
        "sender_full_name": "mars0i",
        "timestamp": 1734715648
    },
    {
        "content": "<p>I forked mathlib.  (Maybe I'll ask for write access, but I'd rather start on my own copy.)  The original source tree for mathlib doesn't include <code>ProofWidgets</code>; ProofWidgets4 is in a separate repo on github.  However, <code>ProofWidgets</code> gets pulled in by <code>lake update</code>, and then it appears in my local copy of mathlib as<code>.lake/packages/proofwidgets/ProofWidgets</code>.</p>\n<p>But that's not part of the original mathlib source tree, and a <code>git commit</code> doesn't commit packages under <code>.lake</code>, because the <code>.gitignore</code> file specifies <code>.lake</code> as a directory to be ignored.  That makes sense to me, but it doesn't seem that modifying that copy of <code>ProofWidgets</code> under <code>.lake</code>is the way to contribute to <code>ProofWidgets</code>.</p>\n<p>I read through the <a href=\"https://leanprover-community.github.io/contribute/index.html\">\"How to contribute to mathlib\" page</a>, and unless I missed something, it doesn't cover this case.  Maybe I don't understand something (quite plausible), but I'm thinking that contributing to an external repo like ProofWidgets or Batteries might involve a different procedure than contributing to the main mathlib source tree.  Not sure.</p>",
        "id": 490270360,
        "sender_full_name": "mars0i",
        "timestamp": 1734760464
    },
    {
        "content": "<p>Oh, I see.  I forgot about this comment:<br>\n<span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/490158641\">said</a>:</p>\n<blockquote>\n<p>I think you do want a modified version of Mathlib, but the only change that is required (hopefully) is that you update <code>Mathlib</code>'s <code>lakefile.lean</code>, and modify the version of proofwidgets it uses, to your own branch/fork. <br>\nThen in your own project, you can require your own branch/fork of Mathlib.</p>\n</blockquote>\n<p>Sorry about the previous post.  (I would delete it, but I can't, and it seemed better to leave the text as is, despite it illustrating some ignorance and lack of attention to Floris's earlier, helpful post.)</p>",
        "id": 490271210,
        "sender_full_name": "mars0i",
        "timestamp": 1734761177
    },
    {
        "content": "<p>I've continued to work on this, but it's frustrating. (It's a small, unimportant contribution, but I'm treating it as a test case for learning.)  Maybe there's something I don't understand, or I've made a mistake.</p>\n<p>It appears that the basic mismatch between the helpful advice above and my strategy is that I feel that if I'm going to have outside projects depend on something in ProofWidgets4, I want to test using it as a dependency in my project. I do test my changes in the <code>Demos</code> directory of ProofWidgets4, and it works, but I still think that one should test using it as a dependency from outside. That is what makes this difficult, it seems.</p>\n<p>I want my project to depend on a version of mathlib that includes my modified ProofWidgets4. I have set up my copy of mathlib, with a lakefile.lean that points to my version of ProofWidgets4.  Each have their own branches, so in theory I could ask for write access to mathlib and submit my version of mathlib for CI, as I understand it. However, that would mean that I'm asking to run a version of mathlib that points to an outside library (my ProofWidgets4 repo in github).  I don't know whether that would work, but it seems wrong.  (Is this incorrect?)  But I don't want my PR to be accepted unless I've tested it properly, so I can't wait for the PR to be accepted to do this.</p>\n<p>OK, now the problem is that I have to build mathlib on my computer. I did this once, and then accidentally made a change (that was not really a change) in ProofWidgets4, so I had to build mathlib again.  Now I have found that in order to use the new ProofWidgets4 in my own project, I am building mathlib again!</p>\n<p>I am wondering whether trying to test a modified component of mathlib as a dependency in a separate library is just not something covered by the usual procedures.</p>\n<p>I think the reason I have to build mathlib in my project might be because <code>lake exe cache get</code> wants to get executables from the main lean4 site, but my executables aren't there.  Or maybe not.  I don't understand what <code>lake exe cache get</code> does.  Here is what I tried most recently:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~/</span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">LeanProver</span><span class=\"bp\">/</span><span class=\"n\">ChaosLean</span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span><span class=\"bp\">*$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">changes</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">changes</span>\n<span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"o\">)</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">validate</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">cloud</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"bp\">~/</span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">LeanProver</span><span class=\"bp\">/</span><span class=\"n\">ChaosLean</span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span><span class=\"bp\">*$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"bp\">'././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets'</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">changes</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"bp\">~/</span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">LeanProver</span><span class=\"bp\">/</span><span class=\"n\">ChaosLean</span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span><span class=\"bp\">*$</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Rf</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">proofwidgets</span><span class=\"bp\">/</span>\n<span class=\"bp\">~/</span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">LeanProver</span><span class=\"bp\">/</span><span class=\"n\">ChaosLean</span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span><span class=\"bp\">*$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">build</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">mars0i</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">70</span><span class=\"n\">d004a66abec5814fbfe45f30f881c0cb8e17de'</span>\n<span class=\"n\">Build</span><span class=\"w\"> </span><span class=\"n\">completed</span><span class=\"w\"> </span><span class=\"n\">successfully</span><span class=\"bp\">.</span>\n<span class=\"bp\">~/</span><span class=\"n\">docs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">LeanProver</span><span class=\"bp\">/</span><span class=\"n\">ChaosLean</span><span class=\"o\">(</span><span class=\"n\">main</span><span class=\"o\">)</span><span class=\"bp\">*$</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">get</span>\n<span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"o\">)</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">cloud</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>Here is the <code>ChaosLean</code> project's lakefile.lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"s2\">\"ChaosLean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.1.0\"</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"n\">ChaosLean</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/mars0i/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"ProofWidgetsRechartAxisType\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"s2\">\"chaoslean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>\n<p>That version of mathlib's lakefile.lean includes this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- require \"leanprover-community\" / \"proofwidgets\" @ git \"v0.0.48\"</span>\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/mars0i/ProofWidgets4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"RechartsAxisType\"</span>\n</code></pre></div>\n<p>The lakefile.lean in my copy of ProofWidgets4 is unchanged from the original. (Is that what it should be?)</p>\n<p>Thanks.</p>",
        "id": 490714302,
        "sender_full_name": "mars0i",
        "timestamp": 1735074349
    },
    {
        "content": "<p>I suspect the mathlib maintainers would not object to you using the mathlib ci to test mathlib against an in-progress proof widgets pr</p>",
        "id": 490717286,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735077317
    },
    {
        "content": "<p>I think your instincts are reasonable, btw, but in practice making changes to mathlib (including in this edge case) outside of the main repo is going to make life harder than necessary</p>",
        "id": 490717668,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735077671
    },
    {
        "content": "<p>If you have <code>npm</code> installed locally, I think it should be possible to add your modified version of <code>ProofWidgets</code> as a dependency to your repository directly (without modifying <code>Mathlib</code>), and then build the JS files by going to the local copy of your repository within <code>.lake/packages/</code> and then running <code>lake build widgetJsAll</code>.</p>",
        "id": 490737020,
        "sender_full_name": "Anand Rao Tadipatri",
        "timestamp": 1735097034
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"303675\">@Anand Rao Tadipatri</span>!  That's very helpful.  I didn't know where to start with that process.</p>",
        "id": 490794222,
        "sender_full_name": "mars0i",
        "timestamp": 1735146653
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/490202959\">said</a>:</p>\n<blockquote>\n<p>My advice would be to write a test inside the Demos folder of ProofWidgets that doesn't rely on mathlib and your downstream project, because the next contributor to ProofWidgets is otherwise not going to be able to check if they broke anything.</p>\n</blockquote>\n<p>I strongly second this recommendation. </p>\n<blockquote>\n<p>I do test my changes in the <code>Demos</code> directory of ProofWidgets4, and it works, but I still think that one should test using it as a dependency from outside.</p>\n</blockquote>\n<p>You really don't have to do this if you're just adding visualization features :) The only changes that need additional testing in a downstream package are changes that impact cross-package interactions: changes to the build process, packages, pulling in additional dependencies, etc. Since your project depends on mathlib, and building mathlib is very heavy, you are making it unnecessarily difficult for yourself to test the changes by waiting on the combined PW4-mathlib-ChaosLean build.</p>",
        "id": 490894867,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1735230833
    },
    {
        "content": "<blockquote>\n<p>I think the reason I have to build mathlib in my project might be because <code>lake exe cache get</code> wants to get executables from the main lean4 site, but my executables aren't there. Or maybe not. I don't understand what <code>lake exe cache get</code> does.</p>\n</blockquote>\n<p><code>lake exe cache get</code>downloads a prebuilt version of mathlib from a cloud cache so that you don't have to build it locally. But for that prebuilt version to exist in the cloud cache, you first need to push its source code to some branch on <code>leanprover-community/mathlib4</code>. Commits there will be automatically processed by the leanprover-community CI infrastructure and uploaded to the cloud cache. That is why it's always recommended on this Zulip that you push to a branch on <code>leanprover-community/mathlib4</code>.</p>\n<blockquote>\n<p>That version of mathlib's lakefile.lean includes this:</p>\n</blockquote>\n<p>Your <code>lakefile.lean</code> looks reasonable. You need to point to a version of ProofWidgets4 available on GitHub and including your changes, and I guess <code>RechartsAxisType</code> has that.</p>",
        "id": 490895318,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1735231173
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"128280\">@Wojciech Nawrocki</span>.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/490894867\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>I do test my changes in the <code>Demos</code> directory of ProofWidgets4, and it works, but I still think that one should test using it as a dependency from outside.</p>\n</blockquote>\n<p>You really don't have to do this if you're just adding visualization features :) The only changes that need additional testing in a downstream package are changes that impact cross-package interactions: changes to the build process, packages, pulling in additional dependencies, etc. Since your project depends on mathlib, and building mathlib is very heavy, you are making it unnecessarily difficult for yourself to test the changes by waiting on the combined PW4-mathlib-ChaosLean build.</p>\n</blockquote>\n<p>Thanks--this is helpful.  Thanks also for confirming and clarifying re <code>lake exe cache get</code>.</p>\n<p>I'm not worried about breaking something--ProofWidgets4 , mathlib, or my project. It's more that I just want to verify the functionality: to see that the changes behave as expected in a different context. I do think that in this particular case, it's hard to see how things would behave differently in my project as opposed to the modified test I made in <code>Demos/Plot.lean</code>.  So testing in my project felt like overkill even from my point of view.  However, when dealing with unfamiliar code, even if I think I understand it, I try not to assume that my understanding is correct, especially when contributing to someone else's package. I'd rather err on the side of thinking that I'm ignorant.</p>",
        "id": 490909031,
        "sender_full_name": "mars0i",
        "timestamp": 1735241220
    },
    {
        "content": "<p>I accept that this isn't necessary, but I'm having trouble getting the branch that I pushed to mathlib to work correctly when I <code>require</code> it in my project.  Maybe it would be useful to understand what's going on for future work.</p>\n<p>My mathlib branch, <code>ProofWidgetsRechartAxisType</code>, differs from the <code>master</code> branch (at the time I created it) only in that <code>lakefile.lean</code> contains this replacement:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- require \"leanprover-community\" / \"proofwidgets\" @ git \"v0.0.48\"</span>\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/mars0i/ProofWidgets4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"RechartsAxisType\"</span>\n</code></pre></div>\n<p>The <code>RechartsAxisType</code> branch of ProofWidgets4 contains my changes.  My project, <code>ChaosLean</code>, has this in its lakefile.lean (which is otherwise the lakefile generated by <code>lake new</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">Â«</span><span class=\"n\">ChaosLean</span><span class=\"bp\">Â»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"ProofWidgetsRechartAxisType\"</span>\n</code></pre></div>\n<p>which I understand should get the version of mathlib generated by CI on my branch <code>ProofWidgetsRechartAxisType</code>.</p>\n<p>However, the code behaves as if it was using the unmodified ProofWidgets4.  I looked in <code>.lake/packages/proofwidgets/</code>, and the source files there don't reflect my changes in the <code>RechartsAxisType</code> branch on <a href=\"https://github.com/mars0i/ProofWidgets4\">https://github.com/mars0i/ProofWidgets4</a>.</p>",
        "id": 490943241,
        "sender_full_name": "mars0i",
        "timestamp": 1735270979
    },
    {
        "content": "<p>If I remove <code>.lake/packages/proofwidgets</code> and run <code>lake exe cache get</code>, I see:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cloning</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">ProofWidgets4</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">checking</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">revision</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"mi\">2</span><span class=\"n\">b000e02d50394af68cfb4770a291113d94801b5'</span>\n<span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">5794</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">1245</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n</code></pre></div>\n<p>So it seems that this is not getting my version of ProofWidgets4 from my git account.</p>",
        "id": 490943467,
        "sender_full_name": "mars0i",
        "timestamp": 1735271212
    },
    {
        "content": "<p>Maybe in the branch I pushed to mathlib4, I also needed to regenerate <code>lake-manifest.json</code>?  I see that that file in my <code>ProofWidgetsRechartAxisType</code> branch of mathlib4 references the standard version of ProofWidgets4 in leanprover-community.</p>",
        "id": 490943905,
        "sender_full_name": "mars0i",
        "timestamp": 1735271638
    },
    {
        "content": "<p>I tried modifying <code>lake-manifest.json</code>, replacing the line that pointed to the leanprover-community version of ProofWidgets4 with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"s2\">\"url\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/mars0i/ProofWidgets4.git\"</span><span class=\"o\">,</span>\n</code></pre></div>\n<p>and also replaced reference to the ProofWidgets4 version number with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">   </span><span class=\"s2\">\"inputRev\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RechartsAxisType\"</span><span class=\"o\">,</span>\n</code></pre></div>\n<p>These are pure experiments--no idea whether this was a good idea.  I get a CI failure at the step \"Get cache\":</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">cloud</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>Maybe this means that it can't get a compiled version from the version of the git repo on my account, which makes sense, since that isn't there.</p>\n<p>Giving up.  I'm not upset about it.  Maybe there's a way to do this, but it's not worth the trouble for this contribution, at least, to try to test my modification to ProofWidgets4 with my own project that uses ProofWidgets4.</p>",
        "id": 491118333,
        "sender_full_name": "mars0i",
        "timestamp": 1735418060
    },
    {
        "content": "<p>You should change the lakefile not the manifest</p>",
        "id": 491118657,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735418381
    },
    {
        "content": "<p>(then run <code>lake update</code>)</p>",
        "id": 491118713,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735418407
    },
    {
        "content": "<p>The cloud release may still be an issue</p>",
        "id": 491118789,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1735418500
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>-- Right--I did change the lakefile, but the result was that when I made my own project depend on this branch of mathlib, it got the original version of ProofWidgets4 from leanprover-community, rather than the version in my github account that I had referenced in lakefile.lean.  However, I saw that lake-manifest.json was still pointing to the leanprover-community version, so I thought I'd try modifying lake-manifest.json.</p>",
        "id": 491118855,
        "sender_full_name": "mars0i",
        "timestamp": 1735418553
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span>.  I've seen references to the cloud release, but I don't know what that refers to.</p>",
        "id": 491118896,
        "sender_full_name": "mars0i",
        "timestamp": 1735418616
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I didn't try running <code>lake update</code>.  Will try that now.  Thanks.</p>",
        "id": 491118967,
        "sender_full_name": "mars0i",
        "timestamp": 1735418670
    },
    {
        "content": "<p>I guess <code>lake update ProofWidgets</code> is the command you actually want</p>",
        "id": 491118980,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735418694
    },
    {
        "content": "<p>You are right to look at the manifest to determine if the right library version ended up being used</p>",
        "id": 491119005,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735418714
    },
    {
        "content": "<p><code>lake build</code> did update <code>lake-manifest.json</code> to point to my account's ProofWidgets4, but I'm getting almost the same error as from my hand-edited <code>lake-manifest.json</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">âœ–</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">GitHub</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">v'</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"o\">)</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"o\">:</span><span class=\"n\">release</span>\n<span class=\"n\">uncaught</span><span class=\"w\"> </span><span class=\"n\">exception</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">fetch</span><span class=\"w\"> </span><span class=\"n\">ProofWidgets</span><span class=\"w\"> </span><span class=\"n\">cloud</span><span class=\"w\"> </span><span class=\"n\">release</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 491119583,
        "sender_full_name": "mars0i",
        "timestamp": 1735419290
    },
    {
        "content": "<p>i.e. first I restored the old <code>lake-manifest.json</code> from before I started editing it, and then I ran <code>lake update</code>.</p>",
        "id": 491119627,
        "sender_full_name": "mars0i",
        "timestamp": 1735419333
    },
    {
        "content": "<p>I think proofwidgets might have a custom flag you have to pass to say \"don't use the github release\"</p>",
        "id": 491119643,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735419356
    },
    {
        "content": "<p>The ProofWidgets4 README.md says</p>\n<blockquote>\n<p>ProofWidgets is configured to use Lake's <a href=\"https://github.com/leanprover/lake/#cloud-releases\">cloud releases</a> feature which will automatically fetch pre-built JavaScript files <em>as long as</em> you require a release tag rather than the <code>main</code> branch.</p>\n</blockquote>\n<p>Does that a variant of the custom flag idea?  I assume the release tag is \"v0.0.48\" in </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"proofwidgets\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"v0.0.48\"</span>\n</code></pre></div>\n<p>which is what mathlib master branch's <code>lakefile.lean</code> said.  But I'm not using a release tag, I guess. My mathlib branch's <code>lakefile.lean</code> says:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/mars0i/ProofWidgets4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"RechartsAxisType\"</span>\n</code></pre></div>\n<p>(Again, this is probably not worth the trouble for this particular contribution to ProofWidgets4.  If it's worth the trouble, that would be for future use.)</p>",
        "id": 491120186,
        "sender_full_name": "mars0i",
        "timestamp": 1735419859
    },
    {
        "content": "<p>There's also a tip in the README about building ProofWidgets4 using npm, which I could do in theory, but I'd rather not figure out how to do that.</p>",
        "id": 491120303,
        "sender_full_name": "mars0i",
        "timestamp": 1735419979
    },
    {
        "content": "<blockquote>\n<p><code>lake build</code> did update <code>lake-manifest.json</code> to point to my account's ProofWidgets4</p>\n</blockquote>\n<p>Somebody please correct me if this is incorrect, but afaik after changing <code>lakefile.lean</code> you need to run <code>lake update</code> (or specifically <code>lake update proofwidgets</code> to just update the one package) for <code>lake-manifest.json</code> to change. <code>lake build</code> will not do this.</p>",
        "id": 491122634,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1735422379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"617444\">mars0i</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/491120303\">said</a>:</p>\n<blockquote>\n<p>There's also a tip in the README about building ProofWidgets4 using npm, which I could do in theory, but I'd rather not figure out how to do that.</p>\n</blockquote>\n<p>The cloud release error you are seeing means that Lake does not even try to build PW4 using <code>npm</code>. If it did try that, you should be good: you need to have <code>npm</code> installed and available, but after that everything is handled for you by the Lake build. Unfortunately I do not understand why after the cloud release fails to download, the ordinary build is not tried.</p>",
        "id": 491123736,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1735423505
    },
    {
        "content": "<p>Hm, the following works for me when I try it locally:</p>\n<ol>\n<li>Replace <code>require \"leanprover-community\" / \"proofwidgets\"</code> with <code>require proofwidgets from git \"https://github.com/mars0i/ProofWidgets4\" @ \"RechartsAxisType\"</code> in <code>lakefile.lean</code></li>\n<li>Run <code>lake update proofwidgets</code></li>\n<li>Run <code>lake build</code> - this runs <code>npm</code> as expected</li>\n</ol>",
        "id": 491123910,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1735423682
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/491122634\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p><code>lake build</code> did update <code>lake-manifest.json</code> to point to my account's ProofWidgets4</p>\n</blockquote>\n<p>Somebody please correct me if this is incorrect, but afaik after changing <code>lakefile.lean</code> you need to run <code>lake update</code> (or specifically <code>lake update proofwidgets</code> to just update the one package) for <code>lake-manifest.json</code> to change. <code>lake build</code> will not do this.</p>\n</blockquote>\n<p>Sorry, I meant that I ran <code>lake update</code>.</p>",
        "id": 491126470,
        "sender_full_name": "mars0i",
        "timestamp": 1735426580
    },
    {
        "content": "<p>I started to run <code>lake build</code> but it looked like it was going to go into the 12-hour process, so I killed it.  But I'll try it again and let it run.</p>",
        "id": 491126524,
        "sender_full_name": "mars0i",
        "timestamp": 1735426650
    },
    {
        "content": "<p>Every time you change ProofWidgets, you do indeed have to rebuild the (large) parts of mathlib downstream of it</p>",
        "id": 491126770,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735426895
    },
    {
        "content": "<p>You can get mathlib CI to do the build for you on faster machines if you create a mathlib branch first, which will be a ~1hr process</p>",
        "id": 491126826,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735426927
    },
    {
        "content": "<p>That's how I was thinking about it.  <code>lake update</code> and then push to mathlib, and wait and see what happens.  That's how I got the CI error.</p>",
        "id": 491130339,
        "sender_full_name": "mars0i",
        "timestamp": 1735430905
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20use.20my.20own.20version.20of.20ProofWidgets.20with.20Mathlib.3F/near/491123910\">said</a>:</p>\n<blockquote>\n<p>Hm, the following works for me when I try it locally:</p>\n<ol>\n<li>Replace <code>require \"leanprover-community\" / \"proofwidgets\"</code> with <code>require proofwidgets from git \"https://github.com/mars0i/ProofWidgets4\" @ \"RechartsAxisType\"</code> in <code>lakefile.lean</code></li>\n<li>Run <code>lake update proofwidgets</code></li>\n<li>Run <code>lake build</code> - this runs <code>npm</code> as expected</li>\n</ol>\n</blockquote>\n<p>That worked for me, too (although it took a long time).  But this won't allow me to <code>require</code> the modified mathlib in my other project.  Or in any event, I don't know how to do that, other than by causing <code>lake</code> to get mathlib binaries from <code>leanprover.community/mathlib</code>.  </p>\n<p>After <code>lake build</code>, I have mathlib binaries on my local machine, right?  So in theory it would make sense that there should be a way to set up my <code>ChaosLean</code> project to use those binaries in order to <code>require mathlib</code>.  (Or if I downloaded the binaries using <code>lake update</code> or <code>lake exe cache get</code>, I have them on my local machine as well, right?)  Why should it be necessary to download the mathlib binaries from <code>leanprover-community/mathlib</code> if I already have them somewhere?  But as I understand it, getting mathlib binaries from a local source isn't normally done.  Maybe it hasn't been thought necessary for most of what people have been doing with Lean, so there's not a procedure for it. I may misunderstand, though.  My lack of understanding is very great.</p>",
        "id": 491150555,
        "sender_full_name": "mars0i",
        "timestamp": 1735452341
    }
]