[
    {
        "content": "<p>I'm self-studying lean and this has me really stumped. From <a href=\"https://docs.lean-lang.org/theorem_proving_in_lean4/inductive_types.html#other-recursive-data-types\">Theorem Proving in Lean 4 / Inductive Types / Other Recursive Data Types </a>, there's an exercise (notation modified slightly from the book to avoid collisions):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">append'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\">       </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">bs</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"n\">ta</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">append'</span><span class=\"w\"> </span><span class=\"n\">ta</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">append_nil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">append'</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">append'</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">append'</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">append_nil</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>It doesn't recognize the induction base case for <code>append_nil</code> as valid:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rfl'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"w\"> </span><span class=\"n\">side</span>\n<span class=\"w\">  </span><span class=\"n\">nil</span>\n<span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">definitionally</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"w\"> </span><span class=\"n\">side</span>\n<span class=\"w\">  </span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>Now I thought that <code>[]</code> was just an alias for <code>nil</code>? I'm not sure what to tell Lean here. It seems Lean has no difficulty determining that <code>[] = nil</code> normally, for example via <code>#eval</code>. If there is a built in theorem establishing the equality, I wasn't able to find it. What is the correct way to show this?</p>",
        "id": 497761935,
        "sender_full_name": "Deidre House",
        "timestamp": 1738705313
    },
    {
        "content": "<p>Do <code>set_option autoImplicit false</code> and try again.</p>",
        "id": 497762891,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738705675
    },
    {
        "content": "<p><code>nil</code> is being parsed as a new free variable instead of <code>List.nil</code>.</p>",
        "id": 497762991,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738705703
    },
    {
        "content": "<p>Oh wow, it was that easy? Changing the top line fixed it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">append_nil</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">append'</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">append'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">append'</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">append_nil</span><span class=\"w\"> </span><span class=\"n\">bs</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 497763618,
        "sender_full_name": "Deidre House",
        "timestamp": 1738705942
    },
    {
        "content": "<p><code>set_option autoImplicit false</code> is a great option to set when you're just beginning with Lean. When you're beyond a certain level apparently it's safe to switch it to <code>true</code>, but I've never got to that level :-/ so I have it on <code>false</code> by default and it's saved me a lot of pain. Every typo I make, makes a new type, with autoImplicit set to true!</p>",
        "id": 497775049,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738711038
    },
    {
        "content": "<p>For that I look at the infoview, and it shows a list of all local declarations at the top of the goal state or expected type window. This has also saved me a lot of pain.</p>",
        "id": 497775237,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738711124
    },
    {
        "content": "<blockquote>\n<p>When you're beyond a certain level apparently it's safe to switch it off</p>\n</blockquote>\n<p>I guess that level is \"you are contributing to mathlib\", because once you're there <code>autoImplicit false</code> is the default so no switching is needed...</p>",
        "id": 497775661,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738711332
    },
    {
        "content": "<p>By \"I always have it switched to <code>false</code> \" I really mean \"I only ever contribute to projects where it's set to <code>false</code> by default\" :-)</p>",
        "id": 497775762,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738711390
    },
    {
        "content": "<p>But also \"and get tripped up by it frequently in the web editor, where it is not disabled\", I assume - since this is certainly my experience</p>",
        "id": 497775963,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738711496
    },
    {
        "content": "<p>Yeah, I only ever click on the web editor to verify that the problem with someone's code is that they didn't set it to false!</p>",
        "id": 497776242,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738711651
    },
    {
        "content": "<blockquote>\n<p>I guess that level is \"you are contributing to mathlib\", because once you're there <code>autoImplicit false</code> is the default so no switching is needed...</p>\n</blockquote>\n<p>Wait, I thought Kevin meant that it's safe to switch it <em>on</em> once you've reached a certain level. You're telling me beginners end up dealing with <code>autoImplicit true</code> and mathlib maintainers end up with <code>autoImplicit false</code>?? That seems kind of backwards...</p>",
        "id": 497779112,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738713120
    },
    {
        "content": "<p>(I mean I wouldn't want it enabled for Mathlib either... really it should only be enabled for proficient users who just want to quickly sketch out an idea)</p>",
        "id": 497779665,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738713431
    },
    {
        "content": "<p>Beginners don't know any better and start with their own repos or on the web editor</p>",
        "id": 497781709,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738714349
    },
    {
        "content": "<p>well yes, and that's a bad thing, right? and then some of them show up here and we have to tell them to turn off <code>autoImplicit</code> so they can see what the actual error is, and maybe some people don't even bother with Zulip and just give up and move on to something else</p>",
        "id": 497782026,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738714522
    },
    {
        "content": "<p>We could switch the default on the \"mathlib\" preset in the web editor?</p>",
        "id": 497783712,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738715444
    },
    {
        "content": "<p>(and leave it alone for the \"Lean nightly\" preset)</p>",
        "id": 497783748,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738715461
    },
    {
        "content": "<p>Sure, I think that could be a useful change... just my opinion, of course</p>",
        "id": 497783846,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738715522
    },
    {
        "content": "<p>Technically such a change is very easy, but to avoid needing FRO buy-in I think the web editor would need to distinguish \"stable Lean without mathlib with autoImplicit\", and \"stable Lean with Mathlib without autoImplicit\"</p>",
        "id": 497784201,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738715726
    },
    {
        "content": "<p>And then the playground link in Zulip has to decide which version to link to</p>",
        "id": 497784279,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738715764
    },
    {
        "content": "<p>eh... that seems like it would make the UI too confusing... maybe it's not worth the trouble</p>",
        "id": 497784421,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738715868
    },
    {
        "content": "<p>There's a neat new feature that will show up in the next release where autoimplicits get printed inline:</p>\n<p><a href=\"/user_uploads/3121/7_ThBEoT8vW7FxTvMRpUCBI7/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/7_ThBEoT8vW7FxTvMRpUCBI7/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"448x276\" src=\"/user_uploads/thumbnail/3121/7_ThBEoT8vW7FxTvMRpUCBI7/image.png/840x560.webp\"></a></div><p><a href=\"https://github.com/leanprover/lean4/pull/6768\">https://github.com/leanprover/lean4/pull/6768</a></p>",
        "id": 497800028,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738725153
    },
    {
        "content": "<p>ah neat! that should help a lot</p>",
        "id": 497803127,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1738727376
    },
    {
        "content": "<p>Improvements to error messages are also planned</p>",
        "id": 497817202,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738736756
    }
]