[
    {
        "content": "<p>I'm trying to formalize some work around function gradients and am confused about what the \"right way\" to do that is.</p>\n<h3>my example</h3>\n<p>I want to formalize the concept of a critical point for a function </p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>f</mi><mo>:</mo><msup><mi mathvariant=\"double-struck\">R</mi><mi>n</mi></msup><mo>‚Üí</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">f: \\mathbb{R}^n \\to \\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7144em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7144em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚Üí</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span></span></p>\n<p>(or some other field, doesn't matter to me atm); i.e. a critical point is when the gradient is zero.</p>\n<p>The code I have so far looks something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Prelude</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">RCLike</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Calculus</span><span class=\"bp\">.</span><span class=\"n\">Gradient</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">D</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CriticalPoint</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">HasGradientWithinAt</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<h3>my issues</h3>\n<ol>\n<li>I searched for \"gradient\" and found <code>HasGradientWithinAt</code>. but looking through the mathematics in lean guide, chapter 11 on differential calculus <a href=\"https://leanprover-community.github.io/mathematics_in_lean/C11_Differential_Calculus.html#differentiability\">seems to promote <code>HasFDerivWithinAt</code></a> instead (which is also referenced internally in <code>HasGradient...</code>). <strong>what's the difference between the two? why should I use one over the other?</strong></li>\n<li>I tried to use ^this definition in a simple example, specifically constructing the statement:</li>\n</ol>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>for¬†</mtext><mi>x</mi><mo>‚Ü¶</mo><msup><mi>x</mi><mn>2</mn></msup><mtext>¬†there¬†is¬†a¬†critical¬†point¬†at¬†</mtext><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\text{for }\nx \\mapsto x^2\n\\text{ there is a critical point at }\nx=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7054em;vertical-align:-0.011em;\"></span><span class=\"mord text\"><span class=\"mord\">for¬†</span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">‚Ü¶</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0585em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord text\"><span class=\"mord\">¬†there¬†is¬†a¬†critical¬†point¬†at¬†</span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span></p>\n<p><strong>but then I got stuck. ...help?</strong> code here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CriticalPoint</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CriticalPoint</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">HasGradientAt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">HasGradientAtFilter</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasFDerivAtFilter</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- this fails... why?</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 516482393,
        "sender_full_name": "Becker A.",
        "timestamp": 1746547544
    },
    {
        "content": "<p>The main difference between \"gradient\" and \"fderiv\" is that \"gradient\" takes the derivative as <code>(f' : F)</code>, (an element of the space) while \"fderiv\" takes the derivative as <code>(f' : E ‚ÜíL[ùïú] F)</code> (a continuous <code>ùïú</code>-linear map).</p>",
        "id": 516484332,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746548151
    },
    {
        "content": "<p>The \"gradient\" is a specialization of \"fderiv\" where the derivative has the form <code>fun y =&gt; ‚ü™f', y‚ü´</code> for some <code>f' : F</code>.</p>",
        "id": 516485387,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1746548458
    },
    {
        "content": "<p>...wait. for a function <code>f: E -&gt; F</code>, \"gradient\" uses <code>f': F</code>, an element of the <em>range</em>?</p>\n<p>for my function <code>f: R^n -&gt; R</code>, that would mean my gradient is in <code>R</code>, which is <em>not</em> what I want. I'm looking for a gradient as some element in <code>R^n</code>.</p>",
        "id": 516516951,
        "sender_full_name": "Becker A.",
        "timestamp": 1746558635
    },
    {
        "content": "<p>The gradient defined above is indeed the \"normal\" one, and is just a specialization of <code>FDeriv</code> for scalar valued functions over an hilbert space (so you can translate between linear forms and vectors by duality, this is what <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> was telling you, he just made a mistake copy-pasting the function types too quickly from the docs, if I had to guess). If you really need to view the gradient as a <em>vector</em>, it should suit your purposes.</p>",
        "id": 516524748,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746561695
    },
    {
        "content": "<p>I am unclear however as to why you expect the second <code>simp</code> to work though. Your goal has already hit rock bottom, there is not anything else that you can really simplify any more. Do you want to unfold the definition of <code>HasFDerivAt...</code>?</p>",
        "id": 516525131,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746561861
    },
    {
        "content": "<p>(also <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> shows <code>FDeriv</code> because using the gradient amounts to the cardinal sin of picking a basis, among other things)</p>",
        "id": 516525222,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746561909
    },
    {
        "content": "<p>yeah I was expecting it to unfold <code>HasFDerivAt</code>. I tried both <code>simp</code> and <code>unfold</code> and neither command did anything</p>",
        "id": 516529615,
        "sender_full_name": "Becker A.",
        "timestamp": 1746563690
    },
    {
        "content": "<p>unless I don't actually need to unfold it to solve this, but I'm not sure how to solve it otherwise</p>",
        "id": 516529708,
        "sender_full_name": "Becker A.",
        "timestamp": 1746563729
    },
    {
        "content": "<p>I'd be surprised if <code>apply?</code> didn't suggest something useful</p>",
        "id": 516529909,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746563803
    },
    {
        "content": "<p>...I didn't know <code>apply?</code> was a command... this is kind of magical</p>",
        "id": 516530007,
        "sender_full_name": "Becker A.",
        "timestamp": 1746563856
    },
    {
        "content": "<p>what exactly does <code>apply?</code> do though? does it just guess possible next steps that logically fit the current state?</p>",
        "id": 516530192,
        "sender_full_name": "Becker A.",
        "timestamp": 1746563920
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466290\">Luigi Massacci</span> <a href=\"#narrow/channel/113489-new-members/topic/gradients.20for.20.24.5Cmathbb.7BR.7D.5En.20.5Cto.20.5Cmathbb.7BR.7D.24/near/516529909\">said</a>:</p>\n<blockquote>\n<p>I'd be surprised if <code>apply?</code> didn't suggest something useful</p>\n</blockquote>\n<p>(In fact I wouldn't even simplify anything beyond <code>CriticalPoint</code> before doing that,  I'd be equally surprised if all the necessary translation bypassing <code>FDeriv</code>hasn't been done already in the API for <code>Gradient</code>)</p>",
        "id": 516530640,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746564097
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"885689\">Becker A.</span> <a href=\"#narrow/channel/113489-new-members/topic/gradients.20for.20.24.5Cmathbb.7BR.7D.5En.20.5Cto.20.5Cmathbb.7BR.7D.24/near/516530192\">said</a>:</p>\n<blockquote>\n<p>what exactly does <code>apply?</code> do though? does it just guess possible next steps that logically fit the current state?</p>\n</blockquote>\n<p>It tries to match your goal with the statements of theorems in the library, filling in variables as required</p>",
        "id": 516530748,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746564133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"885689\">Becker A.</span> <a href=\"#narrow/channel/113489-new-members/topic/gradients.20for.20.24.5Cmathbb.7BR.7D.5En.20.5Cto.20.5Cmathbb.7BR.7D.24/near/516530007\">said</a>:</p>\n<blockquote>\n<p>...I didn't know <code>apply?</code> was a command... this is kind of magical</p>\n</blockquote>\n<p>I'd strongly suggest working your way through <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a>, it will make your life easier. I feel for wanting to get your hands dirty immediately, but if you don't read about the basics first lean can be incredibly frustrating</p>",
        "id": 516530821,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746564170
    },
    {
        "content": "<p>yeahhhhh it's just hard to engage with tutorials. I find I don't retain things unless I'm putting stuff to use for my own means/projects</p>",
        "id": 516531735,
        "sender_full_name": "Becker A.",
        "timestamp": 1746564555
    },
    {
        "content": "<p>You can try Glimpse of Lean for a faster paced tutorial</p>",
        "id": 516532042,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1746564705
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"885689\">Becker A.</span> has marked this topic as resolved.</p>",
        "id": 516823986,
        "sender_full_name": "Notification Bot",
        "timestamp": 1746687530
    },
    {
        "content": "<p>also for posterity: using <code>apply?</code> suggested as one option the expression <code>refine hasDerivAtFilter_iff_isLittleO.mpr ?_</code>, which happened to work for one of my cases.</p>\n<p>the high-level of this expression (as I understand it) is to rephrase the derivative as a limit under little-o notation. from there <code>apply?</code> suggested some theorems from <code>Asymptotics</code> to close the proof.</p>",
        "id": 516824978,
        "sender_full_name": "Becker A.",
        "timestamp": 1746687946
    }
]