[
    {
        "content": "<p>Hi,</p>\n<p>I have to admit, I'm pretty new at lean, so my question just shows that I have a lot to learn...</p>\n<p>In Mathlib we have <code>TangentBundle I M</code> to denote the tangent bundle of M and we also have sections in vector bundles <code>s: C^n(I; F, V)</code>.<br>\nI would expect that I can describe a vector field on M as a section in the tangent bundle - but instead vector fields are always defined as <code>Œ† (x : M), TangentSpace I x</code>, but never as sections in the tangent bundle.</p>\n<p>Can someone explain this?<br>\nCan we write a vector field as <code>X: C^n(I; F, V)</code> with appropriate F and V?</p>\n<p>I'm afraid I can't get my head around it...</p>",
        "id": 513741134,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745362732
    },
    {
        "content": "<p>Hi and welcome! Differential geometry is one of the hardest areas in mathlib to learn - so don't be afraid to ask questions. :-)</p>\n<p>I find your question a bit hard to parse (but it's also late on my end). Can you explain what you mean by <code>C^n(I; F, V)</code>? I cannot easily find such notation. As far as I can tell, there is no special notation for sections. If you compare with e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Bundle.zeroSection#doc\">docs#Bundle.zeroSection</a>, you'll find that the zero section uses the same notation.</p>",
        "id": 513977557,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745449077
    },
    {
        "content": "<p>Here's a guess: do you want your notation <code>C^n(I; F, V)</code> to mean <code>C^n</code> functions <code>F \\to V</code>, read in the model <code>I</code>? If so, that's weaker than sections of a vector bundle --- because the latter also require that s(x) lie in the fibre at x (mere smoothness does not).</p>",
        "id": 513977704,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745449187
    },
    {
        "content": "<p>A general hint for making your questions easier to follow: it helps a lot if you post an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> --- i.e. give enough details that I know what e.g. F and V are. Right now, I have to guess (and either have to wait for you to clarify, or may guess wrong --- both of which is less useful to you). Make it easy to help you :-)</p>",
        "id": 513977894,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745449272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"900335\">@Jens Lindekamp</span> did you mean <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContMDiffSection#doc\">docs#ContMDiffSection</a> (<code>C‚Çõ^n‚üÆI; F, V‚üØ</code>)?</p>",
        "id": 513988613,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1745456106
    },
    {
        "content": "<p>Thank you, now I understand the question! The answer has to do with how vector fields are defined in mathlib. Let's compare with sections of vector bundles: there, you have <code>Œ† (x : B), E x</code> (to describe continuous sections of a bundle <code>E</code> over base <code>B</code>), and you have <code>ContMDiffSection</code> to describe sections of a <code>C^n</code> vector bundle which are <code>C^n</code> (w.r.t. the bundle's local trivialisations). There is no separate type for continuous bundle sections, as these are already expressed as dependent functions.</p>\n<p>For vector fields, what you wrote <code>Œ† (x : B), TangentSpace I x</code> amounts to saying \"this is a section\", but you're not expressing the differentiability yet.</p>",
        "id": 514025269,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745477231
    },
    {
        "content": "<p>Right now, there is no type \"C^n vector fields\" (as that would just be a special case of \"ContMDiffSection\"). To see some examples of how this is handled today, see e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ContMDiffWithinAt.mpullbackWithin_vectorField_inter#doc\">docs#ContMDiffWithinAt.mpullbackWithin_vectorField_inter</a> (hypothesis <code>hV</code> says \"V is a C^n vector field\") and the nearby lemmas.</p>",
        "id": 514025775,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745477418
    },
    {
        "content": "<p>I wonder if introducing an abbrev \"smooth vector field\" would make those statements easier to read and prove. <span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> You wrote the original file; would you like to elaborate on why you made that choice?</p>",
        "id": 514025878,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745477465
    },
    {
        "content": "<p>Note that the doc is misleading, it doesn't show the statement as it is in the file, like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ContMDiffWithinAt</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">tangent</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mpullbackWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">‚à©</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚Åª¬π'</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span>\n</code></pre></div>\n<p>Here it's taking advantage of the coercion from the tangent space to the tangent bundle, to see <code>mpullbackWithin I I' f V s y</code> (which is a point in <code>TangentSpace I M</code>) as an element of <code>TangentBundle I M</code>. And then it's just talking of a map from the manifold <code>M</code> to the manifold <code>TangentBundle I M</code>, and asserting that this map is smooth.</p>\n<p>We could definitely add an abbreviation for this, but since we wouldn't build an API around it (as the API around <code>ContMDiff</code> is already enormous and shouldn't be duplicated), I'm not sure if we would gain much.</p>",
        "id": 514027685,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745478108
    },
    {
        "content": "<p>Great, I'm new at lean, still learn about dependent type theory and picked \"one of the hardest areas in lean to learn\". Anyway, challenge accepted....</p>\n<p>To get into lean I naively thought about a small (or not so small) project:</p>\n<ol>\n<li>Define connections on differentiable vector bundles (work in progress, actually not so bad)</li>\n<li>Specialise the general connections on vector bundles to affine connections on the tangent bundle, i.e. interprete <code>TM</code>as a special case of a vector bundle.</li>\n<li>\"Along the lines, if missing\": describe sections as modules over the ring of diff. functions. This would be useful to formulate statements about vector fields and tensors. Having said that - can we consider covariant derivatives as derivations over rings and modules? Off-topic...</li>\n<li>Proof basic properties of connections (define the torsion of an affine connection, proof its skew symmetric, pullbacks of connection)</li>\n<li>Define tensor products of the tangent bundle as vector bundles over M. This would probably mean to define tensor products of topological vector bundles first etc.  Arggh....</li>\n</ol>\n<p>If this could be done, we could easily define a metric on M as a section in the symmetric tensor product, we could describe the curvature tensors (Riemmanian, Ricci) as sections in tensor bundles and immediately can state theorems like \"M is a symmetric space iff R is parallel, i.e. the covariant derivative of R is the zero section\"</p>\n<p>Step 2 is where my question comes from. When I make a statement about sections in general vector bundles, I want to apply it to vector fields as sections in TM.</p>\n<p>Because vector fields and tensors play a central role in differential geometry it might be a good idea to introduce structures / classes / shortcuts for these concepts. Maybe it would be just an enhancement of the ContMDiffSection API, after all, many concepts in diff. geom.are really sections in some tensor bundle.</p>\n<p>This is why I want to make statements for <code>ContMDiffVectorBundles</code> and <code>ContMDiffSection</code> and define a vector field as an appropriate <code>ContMDiffSection</code> and apply the general statements to vector fields.</p>",
        "id": 514047955,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745483229
    },
    {
        "content": "<p>One of the lessons we have learned when doing analysis in Lean is that working with spaces of functions with a property (say, the space of continuous functions, or the space of smooth functions) or whatever, is usually not the thing to do, because it doesn't localize well. Often, you want to say that a function is continuous on a given open set, and deduce something from this property -- and if you have proved results on the space of all continuous functions, this will be of no use, because the function you're working this is not continuous globally. It turns out to be much more flexible and efficient to work with predicates, like \"this function is continuous at this point\" or \"this function is continuous on this set\" or \"this function is smooth on this set\". </p>\n<p>You can have a look at the file on Lie bracket of vector fields in manifolds, say (<a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Geometry/Manifold/VectorField/LieBracket.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Geometry/Manifold/VectorField/LieBracket.lean</a>), and see that it's developed in this way, based on a similar file on vector fields in vector spaces. And you can see here why it's important to use the predicate approach here: if you have a global smooth vector field on a manifold, and look at it in a chart, then you get a vector field in a vector space which is <em>not</em> globally smooth, only in the range of the chart. So if you had set up a global theory of smooth vector fields on vector fields, it would be of no use to build the theory of vector fields on manifolds!</p>\n<p>TLDR: don't use <code>ContMDiffSection</code>, use a section and a predicate that it's continuous / smooth / whatever you need to prove the theorem you're working on.</p>",
        "id": 514056157,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745484609
    },
    {
        "content": "<p>N.B.: For 2. in your message (interpret <code>TM</code> as a special case of a vector bundle), there is nothing to do, <code>TM</code> is already a vector bundle in mathlib.</p>",
        "id": 514056527,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745484725
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/514056527\">schrieb</a>:</p>\n<blockquote>\n<p>N.B.: For 2. in your message (interpret <code>TM</code> as a special case of a vector bundle), there is nothing to do, <code>TM</code> is already a vector bundle in mathlib.</p>\n</blockquote>\n<p>I suppose then it is just me, not fully understanding type theory. Will check it out.</p>",
        "id": 514057189,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745484927
    },
    {
        "content": "<p>Concerning your comments on locality: I understand that locality is important, but still I'm probably to much influenced by the hand-waiving pen and paper approach to talk about global concepts and only localize \"under the hood\" if really necessary. <br>\nOne would mostly talk about global vector fields, global metrics etc. even though all these are local phenomenons.</p>",
        "id": 514058300,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745485211
    },
    {
        "content": "<p>Here is an illustration of the properties of the tangent bundle in current mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">ContDiff</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">tangent</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">VectorBundle</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffVectorBundle</span><span class=\"w\"> </span><span class=\"bp\">‚àû</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n</code></pre></div>",
        "id": 514060114,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745485669
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"900335\">Jens Lindekamp</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/514058300\">said</a>:</p>\n<blockquote>\n<p>One would mostly talk about global vector fields, global metrics etc. even though all these are local phenomenons.</p>\n</blockquote>\n<p>That's the impression one gets from the pen-and-paper approach, and it's very misleading. In practice, when you start formalizing, you see that most of the time you don't talk about global vector fields -- even if you have a statement about global vector fields, to prove it you will start to localize, and then all the lemmas you need should be in local form, not global.</p>",
        "id": 514060657,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745485819
    },
    {
        "content": "<p>(For Riemannian metrics, I agree that one would mostly use the global object)</p>",
        "id": 514060794,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1745485862
    },
    {
        "content": "<p>I've been trying to formalize a minimal set-up for Pseudo and Riemannian metric with a pragmatic approach for use within PhysLean and was planning to share it soon for criticisms/improvements . It is a WIP aiming to get a InnerProductspace on Riemannian Metric and it does not implement the predicate approach recommended by <span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span> (thanks!),  but I plan to change it after reading this as have been struggling to propagate dimensions automatically throughout and to implement the last bit, the final InnerProductSpace structure:<br>\n<a href=\"https://github.com/HEPLean/PhysLean/pull/501\">https://github.com/HEPLean/PhysLean/pull/501</a></p>",
        "id": 514070016,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1745487781
    },
    {
        "content": "<p>If I understood well the predicate approach, the below refinement of the definition in <a href=\"https://github.com/HEPLean/PhysLean/pull/501\">https://github.com/HEPLean/PhysLean/pull/501</a> should reflect better: smoothness defined by charts (locality) and not defined as a section type but a predicate on val</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RCLike</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span>\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">PseudoRiemannianMetric</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">inst_top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">inst_fib</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FiberBundle</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">inst_vec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">VectorBundle</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">inst_cmvb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffVectorBundle</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The metric tensor at each point `x : M`, represented as a continuous linear map</span>\n<span class=\"sd\">      `T‚ÇìM ‚ÜíL[ùïú] (T‚ÇìM ‚ÜíL[ùïú] ùïú)`. Applying it twice, `(val x v) w`, yields `g‚Çì(v, w)`. -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The metric is symmetric: `g‚Çì(v, w) = g‚Çì(w, v)`. -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The metric is non-degenerate: if `g‚Çì(v, w) = 0` for all `w`, then `v = 0`. -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">nondegenerate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The metric varies smoothly: Expressed in local coordinates via any chart `e`, the function</span>\n<span class=\"sd\">      `y ‚Ü¶ g_{e.symm y}(mfderiv I I e.symm y v, mfderiv I I e.symm y w)` is `C^n` smooth on the</span>\n<span class=\"sd\">      chart's target `e.target` for any constant vectors `v, w` in the model space `E`. -/</span>\n<span class=\"w\">  </span><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"n\">smooth_in_charts'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">extChartAt</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span>\n<span class=\"w\">    </span><span class=\"n\">ContDiffWithinAt</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mfderiv</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mfderiv</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">x‚ÇÄ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">PseudoRiemannianMetric</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">RiemannianMetric</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">PseudoRiemannianMetric</span><span class=\"w\"> </span><span class=\"n\">Bundle</span><span class=\"w\"> </span><span class=\"n\">ContinuousLinearMap</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">FiniteDimensional</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H_‚Ñù</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">H_‚Ñù</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">ext</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">RiemannianMetric</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">H_‚Ñù</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">i_man</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">inst_top</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">inst_fib</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FiberBundle</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">inst_vec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">VectorBundle</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">inst_cmvb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContMDiffVectorBundle</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">E_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M_‚Ñù</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toPseudoRiemannianMetric</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PseudoRiemannianMetric</span><span class=\"w\"> </span><span class=\"n\">I_‚Ñù</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inst_top</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inst_top</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inst_fib</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inst_fib</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inst_vec</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inst_vec</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">inst_cmvb</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inst_cmvb</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `g‚Çì(v, v) &gt; 0` for all nonzero `v`. -/</span>\n<span class=\"w\">  </span><span class=\"n\">pos_def'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">toPseudoRiemannianMetric</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 514071878,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1745488260
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"900335\">Jens Lindekamp</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/514047955\">said</a>:</p>\n<blockquote>\n<p>Great, I'm new at lean, still learn about dependent type theory and picked \"one of the hardest areas in lean to learn\". Anyway, challenge accepted....</p>\n</blockquote>\n<p>In return, if you accept this challenge, you will find a very supportive community here who are keen to get more differential geometry formalized and will always be happy to help with questions, however basic.</p>\n<p>If you really are completely new to Lean, I would recommend going through at least some of <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> before attempting to write your own code, and also coming up with concrete goals (which you seem to have done) and discussing strategies for achieving them with the community before embarking on them (which you also seem to be doing). There is an art to formalization and not all of it is taught to mathematicians; you need to know more than the underlying mathematics, there are new principles, and design decisions which in some sense are not even mathematical, and which you will pick up by working on projects. </p>\n<p>My impression is that one reason that not much differential geometry is done is that there are not many differential geometers using Lean, our community seems to skew far more algebraic for some reason. All the foundations are now there and projects such as yours will be great tests for them. You might even want to consider supplying tutorials as you work through projects, e.g. with PRs to <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a> or even as worksheets to Imperial's course <a href=\"https://github.com/b-mehta/formalising-mathematics-notes\">https://github.com/b-mehta/formalising-mathematics-notes</a> . These notes typically take the form of a few files which show undergraduates how to say basic things like \"let M be a smooth manifold and let T be its tangent bundle and let f be a smooth section of T\" in Lean, or give very basic exercises in the theory just to get people started. The goal of the course is to get undergraduates formalizing results from their course notes, and the goal of the repository is to show them the absolute basics of setting things up so that they can confidently state the question they're working on.</p>",
        "id": 514073827,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745488803
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span>  Thank you for the link; I just had a quick look, but looks promising to me. I will spend more time on it to learn....</p>\n<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> That was my impression as well - lot's of examples on algebra, number theory and others, but not so much on differential geometry. </p>\n<p>I'm actually working through <a href=\"https://leanprover-community.github.io/mathematics_in_lean/\">#mil</a>, and also the other documentation, it's quite a learning curve, but  no worries.</p>\n<p>For now, I want to create a github project and use the standard documentation tools like doc-gen4 to formalize my rough ideas. I'm not brave enough yet to explain it to others, though of course the project will be public and I will post it.</p>",
        "id": 514081954,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745490519
    },
    {
        "content": "<p>I am also working on connections - my plan is to defined the Ehresmann connection on a principal bundle and then specialise to vector bundles. That makes the geometric content of the connection a bit clearer and takes away the mystery of the non-tensor bit of the usual definition of a connection. I have got as far as defining a G-bundle but not yet made it to the heady height of a principal G-bundle. Some code here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/23426\">https://github.com/leanprover-community/mathlib4/pull/23426</a>.</p>\n<p>One thing I want to do is reproduce my article on what I call the Mercator connection (straight lines on it are the straight lines on the Mercator projection - they are not the shortest distance - so this connection must have torsion - but now we need soldering forms and forms don't yet exist in Mathlib so there's plenty to do)</p>\n<p>I always like to have examples and I am very slowly groping towards deriving the local trivialisations for the Mobius bundle (it turns out you can define a bundle in Mathlib just by specifying the coordinate transformations). This was meant to be an easy step before moving on to connections - lol.</p>\n<p><span class=\"user-mention\" data-user-id=\"779253\">@Matteo Cipollina</span> don't you need principal bundles for gauge fields? I plan to do an example of electromagnetism (U(1)).</p>",
        "id": 514370908,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1745584823
    },
    {
        "content": "<p>Cool. I shortly thought about Ehresmann &amp; principal bundles, but then decided to get linear connections under control first and rather focus on the applications to geodesics, Jacobi fields etc. </p>\n<p>Maybe we can meet in the middle - we agree on the notion of connection on vector bundles. I specialize towards linear connection on tensor fields on TM with applications on (Pseudo-) Riemannian metrics while you spezialize from principal / Ehresmann to connections on vector bundles.</p>\n<p>But given the fact that I still struggle with lean &amp; mathlib, that's a bit ambitious on my side...</p>",
        "id": 514372858,
        "sender_full_name": "Jens Lindekamp",
        "timestamp": 1745585436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/514370908\">ha scritto</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"779253\">Matteo Cipollina</span> don't you need principal bundles for gauge fields? I plan to do an example of electromagnetism (U(1)).</p>\n</blockquote>\n<p>Yes, that would be essential for gauge fields, Yang-Mills etc. will check your repo :)</p>",
        "id": 514376935,
        "sender_full_name": "Matteo Cipollina",
        "timestamp": 1745586605
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"754300\">@Dominic Steinitz</span> If you wanted to contribute your example (when done) of electromagnetism through the U(1) bundle to <a href=\"https://github.com/HEPLean/PhysLean\">PhysLean</a> that would be very much appreciated. <br>\n(see also <a class=\"stream\" data-stream-id=\"479953\" href=\"/#narrow/channel/479953-PhysLean\">#PhysLean</a> )</p>\n<p>We have the more rudiments of EM already, but would be nice to make a step towards gauge field theory.</p>",
        "id": 514970232,
        "sender_full_name": "Joseph Tooby-Smith",
        "timestamp": 1745907874
    },
    {
        "content": "<p>I would love to contribute my example but I am some way off defining a connection form so don't hold your breath.</p>",
        "id": 515120721,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1745947048
    },
    {
        "content": "<p>I am trying to define a horizontal bundle as part of my attempt at defining an Ehresmann connection and following the discussion above about vector fields I have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Bundle</span><span class=\"w\"> </span><span class=\"n\">FiberBundle</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"w\"> </span><span class=\"n\">Set</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">Manifold</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">E_base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E_base</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_base</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"n\">E_base</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">EhresmannConnection</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">H'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">H'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">E'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E'</span><span class=\"w\"> </span><span class=\"n\">H'</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">M'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H'</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">Œ†</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">}</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"bp\">‚ä§</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">LocalFrame</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ModelWithCorners</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"n\">E'</span><span class=\"w\"> </span><span class=\"n\">H'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ChartedSpace</span><span class=\"w\"> </span><span class=\"n\">H'</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsManifold</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"bp\">‚ä§</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">submodule_at</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">smooth_local</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">TangentBundle</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M'</span><span class=\"o\">),</span>\n<span class=\"w\">      </span><span class=\"n\">x‚ÇÄ</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span>\n<span class=\"w\">      </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">MDifferentiableWithinAt</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"w\"> </span><span class=\"n\">I'</span><span class=\"bp\">.</span><span class=\"n\">tangent</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">submodule_at</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Submodule</span><span class=\"bp\">.</span><span class=\"n\">span</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)))</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">EhresmannConnection</span>\n</code></pre></div>\n<p>Does that look the right way to be going about things?</p>\n<p><span class=\"user-mention\" data-user-id=\"900335\">@Jens Lindekamp</span> Did you make any progress with your approach?</p>",
        "id": 542006879,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759143998
    },
    {
        "content": "<p>Patrick and I have defined local frames as part of our Levi-Civita work: can you reuse that instead?</p>",
        "id": 542186843,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759210477
    },
    {
        "content": "<p>If you need, I could make a PR against current mathlib adding them.</p>",
        "id": 542186892,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759210515
    },
    {
        "content": "<p>(I would make, and did, make a few design decisions differently. For example,</p>\n<ul>\n<li>my local frame is a collection of sections directly</li>\n<li>the second condition is its own predicate <code>IsLocalFrameOn</code></li>\n<li>that condition is a structure with named fields</li>\n</ul>\n<p>I can write more after making a PR.)</p>",
        "id": 542187222,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759210793
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542186843\">said</a>:</p>\n<blockquote>\n<p>Patrick and I have defined local frames as part of our Levi-Civita work: can you reuse that instead?</p>\n</blockquote>\n<p>Almost certainly.</p>",
        "id": 542203655,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759218083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542186892\">said</a>:</p>\n<blockquote>\n<p>If you need, I could make a PR against current mathlib adding them.</p>\n</blockquote>\n<p>Yes please.</p>",
        "id": 542203718,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759218109
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> what do you think about making this a stand alone PR and then I can add what it means to be an Ehresmann connection?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Copied from https://github.com/leanprover-community/mathlib4/pull/26221/files#diff-5299ff7f9b0ed6c90a7e2caecbbe13bbe74307087ae1455d82c9a93bec81b28d</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">verticalSubspaceGeneral</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TotalSpace</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">‚Ñù</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mfderiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">‚Ñù</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">TotalSpace</span><span class=\"bp\">.</span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 542204074,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759218239
    },
    {
        "content": "<p>One thing that worried me about my definition is that it is finite dimensional.  For my purposes, I don't care but other folk might.</p>",
        "id": 542204272,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759218305
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542204272\">said</a>:</p>\n<blockquote>\n<p>One thing that worried me about my definition is that it is finite dimensional.  For my purposes, I don't care but other folk might.</p>\n</blockquote>\n<p>I mean for the local frame.</p>",
        "id": 542204349,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759218327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542203718\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542186892\">said</a>:</p>\n<blockquote>\n<p>If you need, I could make a PR against current mathlib adding them.</p>\n</blockquote>\n<p>Yes please.</p>\n</blockquote>\n<p>Sure, here you go: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30083\">#30083</a> is the PR. It makes use of the custom elaborators (as I'm not willing to un-use them, and it's a good testing group).</p>",
        "id": 542234013,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759226771
    },
    {
        "content": "<p>My definition is not necessarily finite-dimensional, but some of its lemmas are. Help understanding to what extend this is essential is welcome.</p>",
        "id": 542234302,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759226860
    },
    {
        "content": "<p>(The code is not maximally polished yet: some doc-strings are missing or outdated. I will polish that file once the differential geometry elaborators have been merged.)</p>",
        "id": 542234410,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759226888
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"754300\">@Dominic Steinitz</span> I'll let the PR speak for itself, for now. If you wonder about particular design questions, I can try to explain why we did things this way.</p>",
        "id": 542234533,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759226925
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> <a href=\"#narrow/channel/113489-new-members/topic/Don't.20understand.20TangentBundle.20.26.20sections/near/542204074\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> what do you think about making this a stand alone PR and then I can add what it means to be an Ehresmann connection?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Copied from https://github.com/leanprover-community/mathlib4/pull/26221/files#diff-5299ff7f9b0ed6c90a7e2caecbbe13bbe74307087ae1455d82c9a93bec81b28d</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">verticalSubspaceGeneral</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TotalSpace</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Submodule</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TangentSpace</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">‚Ñù</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mfderiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">prod</span><span class=\"w\"> </span><span class=\"n\">ùìò</span><span class=\"o\">(</span><span class=\"n\">‚Ñù</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">TotalSpace</span><span class=\"bp\">.</span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>That definition is not sorry-free yet, right? IIUC, making it sorry free amounts to completing the proof that an affine connection induces an Ehresman connection. (Patrick and I want to do this, but we can't work on this full-time, sadly.)</p>",
        "id": 542235501,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759227227
    },
    {
        "content": "<p>In general, I'm on the fence about PRs adding just a single definition without surrounding API: how do you know the definition is workable?</p>",
        "id": 542235663,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759227276
    },
    {
        "content": "<p>(If you also intend to work on Ehresman connections, we should try to not duplicate work/if you're aiming for mathlib, let's discuss the proper way to do things first. And if you just want to do this for yourself, you <em>could</em> also copy-paste other code, right?)</p>",
        "id": 542235791,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759227319
    },
    {
        "content": "<p>There's a lot to chew over in what you have posted. Yes I want to define Ehresmann connections and express these as Lie-algebra valued 1-forms. And yes I would like it to form part of mathlib.</p>\n<p>I've always thought of the picture as the other way up: an affine connection is derived from an Ehresmann connection and this explains the co-ordinate transformation behaviour of the Christoffel symbols (they are <em>not</em> tensors). I guess you could go the way round you suggest and maybe to show that an affine connection defines a connection on the frame bundle but I haven't thought this through.</p>\n<p>The problem with what I want to do is that forms is that they do not yet exist in mathlib and the last commit I can find for the work on them is 3 months ago: <a href=\"https://github.com/urkud/DeRhamCohomology/commits/main/\">https://github.com/urkud/DeRhamCohomology/commits/main/</a></p>\n<p>So the short answer is yes I would like to discuss the proper way to do things (I still count myself as a noob).</p>\n<p>So I suppose one way forward would be for me to show that an affine connection induces an Ehresmann connection using what you and Patrick have done. Alternatively I could try picking up the forms work. I am in your and Patrick's hands.</p>",
        "id": 542243494,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759229885
    },
    {
        "content": "<p>Yury has been picking up the work on differential forms again (and been making PRs with material to mathlib). So I expect the project to move again (and am very happy about this).</p>",
        "id": 542279081,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1759239563
    },
    {
        "content": "<p>I created a structure capturing what it means to be a principal fibre (fiber?) bundle: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30121\">https://github.com/leanprover-community/mathlib4/pull/30121</a></p>",
        "id": 542893767,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1759479969
    }
]