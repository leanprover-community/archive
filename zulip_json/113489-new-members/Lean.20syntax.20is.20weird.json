[
    {
        "content": "<p>The comment in the following code triggers the Lean error: \"unexpected token 'open'; expected 'lemma'\".  Why?  If I remove the <code>open ...</code> line, the error disappears but my proof breaks.  What am I supposed to do here?  I just want to add comments to my code.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- There is a gap between two successive occurrences of a predicate `p : ℕ → Prop`. -/</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">nth_succ_gap</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">setOf</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Infinite</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">h_k1</span><span class=\"w\"> </span><span class=\"n\">h_k0</span><span class=\"w\"> </span><span class=\"n\">h_p_k</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_k_ex</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">nth</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">m</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nth_count</span><span class=\"w\"> </span><span class=\"n\">h_p_k</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_n_m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_lt_nth</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_m_n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nth_lt_nth</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 545104557,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760553071
    },
    {
        "content": "<p>I found that exchanging the first two lines removes the error.  But why should the location of a comment matter at all?</p>",
        "id": 545104913,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760553208
    },
    {
        "content": "<p><code>/-- -/</code> is a doc comment so it can only be used directly above a <code>theorem</code>, <code>lemma</code>, <code>def</code> etc.</p>",
        "id": 545104927,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1760553215
    },
    {
        "content": "<p>And notably, is not in any way a comment</p>",
        "id": 545105408,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760553402
    },
    {
        "content": "<p>How would you comment?</p>",
        "id": 545105484,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760553432
    },
    {
        "content": "<p>With <code>/- -/</code> (one - instead of two)</p>",
        "id": 545105543,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1760553458
    },
    {
        "content": "<p>But I want a doc comment.</p>",
        "id": 545105616,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760553485
    },
    {
        "content": "<p>You can swap the first two lines as you said above.</p>",
        "id": 545105846,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1760553572
    },
    {
        "content": "<p>Doc comments are not \"comments\" in the usual sense of the word. Crucially, comments can go (almost) anywhere, doc comments can only go in fixed locations</p>",
        "id": 545105913,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1760553594
    },
    {
        "content": "<p>If you just want a sympathetic agreement, I also find this slightly ugly looking (and to my recollection <span class=\"user-mention\" data-user-id=\"387244\">@Yaël Dillies</span> when I noticed this and mentioned it somewhere agreed). I wish the syntax were inverted in the way you hoped for, but the answer is simply that it isn't.</p>",
        "id": 545108046,
        "sender_full_name": "Julian Berman",
        "timestamp": 1760554513
    },
    {
        "content": "<p>Not really an apples-to-apples comparison, but Rust accepts both:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"sd\">/// Moo.</span>\n<span class=\"cp\">#[inline]</span>\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">moo</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n\n<span class=\"cp\">#[inline]</span>\n<span class=\"sd\">/// Moo.</span>\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">moo2</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n</code></pre></div>",
        "id": 545108633,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1760554735
    },
    {
        "content": "<p>For the Lean equivalent, seems like declaration modifiers have to come <em>after</em> the doc comment:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- This works</span>\n<span class=\"sd\">/-- Moo. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">inline</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">moo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"c1\">-- This doesn't</span>\n<span class=\"kd\">@[</span><span class=\"n\">inline</span><span class=\"kd\">]</span>\n<span class=\"sd\">/-- Moo. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">moo2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>So if you have both an <code>open</code> and a modifier the only order that works is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">Classical</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"sd\">/-- Moo. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">inline</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">moo3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>",
        "id": 545109523,
        "sender_full_name": "Anthony Wang",
        "timestamp": 1760555114
    },
    {
        "content": "<p>Agreed, I have noticed this before and thought it a little odd, but having no experience with any other programming languages I just accepted it as probably the way things were supposed to work.</p>",
        "id": 545111058,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760555686
    },
    {
        "content": "<p>By the way, I noticed that the rule for doc comment and a decoration like <code>@[simp]</code> is exactly the opposite: you must put the doc comment first.</p>",
        "id": 545112150,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1760556165
    },
    {
        "content": "<p><code>open</code> is a command on its own so it can't go in the middle of another command<br>\n<code>in</code> is a thing that attaches two commands together, so you need to put the entire declaration (including the doc comment if there is one) <em>after</em> the <code>in</code></p>",
        "id": 545112314,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760556250
    },
    {
        "content": "<p>doc comments, and attributes like <code>@[simp]</code> and declaration modifiers like <code>partial</code> are part of the declaration syntax so they have to be directly attached to the <code>def</code> and they have to be in a certain order</p>",
        "id": 545112697,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760556429
    },
    {
        "content": "<p>so you can have <code>/-- The foo. -/ @[simp] private protected noncomputable unsafe nonrec def foo</code> but not some other order</p>",
        "id": 545113624,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760556797
    }
]