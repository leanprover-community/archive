[
    {
        "content": "<p>Hi, I'm trying to implement a Bernoulli random variable, using the geometric distribution files that are already in Lean as a guideline. I'm currently trying to prove a term of type <code>PMF Bool</code>, which I'm not sure how to continue with.</p>\n<p>Here's the relevant code for context. The comment at the bottom denotes where I'm not sure how to continue. Is there a way to convert between <code>HasSum</code> and <code>Finset.sum</code> statements?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">ProbabilityTheory</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"o\">)</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_sum_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_real</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp_lower</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp_upper</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_sum_one</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"c1\">--terms don't match, need to 'convert' beteen HasSum and Finset.sum somehow</span>\n<span class=\"w\">      </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 478148607,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729544314
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">ProbabilityTheory</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"n\">p</span><span class=\"o\">)</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_sum_one</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_real</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp_lower</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hp_upper</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bernoulli_pmf_real</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">),</span>\n<span class=\"w\">    </span><span class=\"k\">by</span>\n\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">bernoulli_pmf_sum_one</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">ofReal_sum_of_nonneg</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hasSum_fintype</span><span class=\"w\"> </span><span class=\"bp\">..</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">bernoulli_pmf_real</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 478151534,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1729545473
    },
    {
        "content": "<p>Merci! Could you tell me what the double dot notation is called on the second to last line?</p>",
        "id": 478152810,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729546006
    },
    {
        "content": "<p>Sorry I have no idea what it is called. I spotted it in a random file one day, it avoids to count the number of underscores you need when using <code>exact</code></p>",
        "id": 478154104,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1729546510
    },
    {
        "content": "<p>All good! Thanks for the pointers</p>",
        "id": 478154168,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729546537
    },
    {
        "content": "<p>The parser for <code>..</code> is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Parser.Term.ellipsis#doc\">docs#Lean.Parser.Term.ellipsis</a>, so maybe this is also its name...</p>",
        "id": 478155474,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729547073
    },
    {
        "content": "<p>Could I have found out about this somehow? It doesn't seem to be displayed in VS Code for example</p>",
        "id": 478156430,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729547510
    },
    {
        "content": "<p>I do not know of a \"polished\" way of finding out, but this is one way:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">..</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">dbg_trace</span><span class=\"w\"> </span><span class=\"n\">stx</span>\n</code></pre></div>",
        "id": 478157718,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729548047
    },
    {
        "content": "<p>The line with <code>stx</code> defines a <code>Syntax</code> node that uses <code>..</code> and <code>dbg_trace</code> shows what parsers compose the given syntax.</p>",
        "id": 478157814,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729548098
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/5794\">lean4#5794</a> adds some documentation</p>",
        "id": 478160485,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1729549276
    },
    {
        "content": "<p>You made quick work of that. Thanks!</p>",
        "id": 478224750,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729583478
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, the output of <code>dbg_trace stx</code> is this: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`term</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">CommandElabM</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"mi\">1</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>, how does that point me towards the ellipsis parser?</p>",
        "id": 478225213,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729583643
    },
    {
        "content": "<p>That's weird, on my computer it was something like <code>Teem.app NAT.hygiene (Lean.Parser.Term.ellipsis)</code> or something like that (I'm on mobile now).</p>",
        "id": 478225724,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729583806
    },
    {
        "content": "<p>Do you maybe have some options set up for yourself?</p>",
        "id": 478226567,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729584070
    },
    {
        "content": "<p>I.e. set_option</p>",
        "id": 478226609,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729584080
    },
    {
        "content": "<p>I'm pretty sure that it was on a new file with <code>import Lean.Elab.Command</code> and the code above, with nothing else.</p>",
        "id": 478227286,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729584302
    },
    {
        "content": "<p>I'll test again when I'm at a computer.</p>",
        "id": 478227323,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729584316
    },
    {
        "content": "<p>No worries!</p>",
        "id": 478227621,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729584414
    },
    {
        "content": "<p>I added that import statement to the top of my file but it didn't seem to change anything (just fyi).</p>",
        "id": 478227748,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729584459
    },
    {
        "content": "<p>Maybe you can see if the web editor agrees with you or with me (or neither!).</p>",
        "id": 478228432,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729584678
    },
    {
        "content": "<p>Would have been funny if it had a completely different output there <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> <br>\nIts output is almost the same as mine: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">TSyntax</span><span class=\"w\"> </span><span class=\"ss\">`term</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">CommandElabM</span><span class=\"w\"> </span><span class=\"n\">PUnit</span>\n</code></pre></div>",
        "id": 478229077,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729584874
    },
    {
        "content": "<p>Wait, that look like the expected type, I was looking at the output of the dbg command, on the run_cmd line.</p>",
        "id": 478229535,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729585010
    },
    {
        "content": "<p>Ahh, yes, I'm seeing the right output there! Thanks for pointing all of this out. It might come in handy if I find another piece of syntax that's new to me :)</p>",
        "id": 478230403,
        "sender_full_name": "Rick de Wolf",
        "timestamp": 1729585303
    },
    {
        "content": "<p>Ok, great!  Glad that we were both right, rather than both wrong!</p>",
        "id": 478230605,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1729585361
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"603023\">Rick de Wolf</span> has marked this topic as resolved.</p>",
        "id": 478231595,
        "sender_full_name": "Notification Bot",
        "timestamp": 1729585689
    }
]