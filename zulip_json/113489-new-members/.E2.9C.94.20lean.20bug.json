[
    {
        "content": "<p>i guess i found a bug </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">coeff_X</span>\n<span class=\"sd\">/-- Lemma stating the natural degree of polynomial p is 3. Automatically compute the degree -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p_natDegree</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">compute_degree!</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p_leadingCoeff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">leadingCoeff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_natDegree</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">compute_degree!</span>\n\n<span class=\"sd\">/-- Lemma stating the leading coefficient of polynomial p is 1. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">leadingCoeff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 523129751,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487050
    },
    {
        "content": "<p>what bug?</p>",
        "id": 523130155,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749487182
    },
    {
        "content": "<p>i see no issue here</p>",
        "id": 523130258,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749487220
    },
    {
        "content": "<p>check again</p>",
        "id": 523130364,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487256
    },
    {
        "content": "<p>i have checked, there is no issue as far as i can tell</p>",
        "id": 523130450,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749487283
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/Uxp8G8U4pAhFcN7iby176V5H/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Uxp8G8U4pAhFcN7iby176V5H/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2532x764\" src=\"/user_uploads/thumbnail/3121/Uxp8G8U4pAhFcN7iby176V5H/image.png/840x560.webp\"></a></div>",
        "id": 523130601,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487330
    },
    {
        "content": "<p>what is the behaviour you aren't expecting?</p>",
        "id": 523130682,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749487354
    },
    {
        "content": "<p>that screenshot looks normal</p>",
        "id": 523130707,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749487365
    },
    {
        "content": "<p>is the problem that you expect the second simp to close the goal the same way the first simp did?</p>",
        "id": 523130961,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1749487447
    },
    {
        "content": "<p>yes</p>",
        "id": 523131024,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487463
    },
    {
        "content": "<p>simp doesn't guarantee to work when you change the type or even the number</p>",
        "id": 523131333,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1749487554
    },
    {
        "content": "<p>what you can do is to replace the first simp with simp? and see what lemma it used, then check if there are similar lemma for the different type for p2. There might be not, or there might be but not tag for use by simp</p>",
        "id": 523131591,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1749487648
    },
    {
        "content": "<p>it happens when you change type </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Polynomial</span>\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">coeff_X</span>\n<span class=\"sd\">/-- Lemma stating the natural degree of polynomial p is 3. Automatically compute the degree -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p_natDegree</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">compute_degree!</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p_leadingCoeff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">leadingCoeff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p_natDegree</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">natDegree</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">compute_degree!</span>\n\n<span class=\"sd\">/-- Lemma stating the leading coefficient of polynomial p is 1. -/</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">p2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"bp\">.</span><span class=\"n\">leadingCoeff</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">leadingCoeff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p1</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">[</span><span class=\"n\">x_coffe</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n</code></pre></div>",
        "id": 523131593,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487650
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113489-new-members/topic/lean.20bug/near/523130450\">said</a>:</p>\n<blockquote>\n<p>i have checked, there is no issue as far as i can tell</p>\n</blockquote>\n<p>what is your version</p>",
        "id": 523132899,
        "sender_full_name": "vxctyxeha",
        "timestamp": 1749487969
    },
    {
        "content": "<p>ah, i didn't consider the \"it doesn't prove the goal\" as a bug</p>",
        "id": 523133086,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749488042
    },
    {
        "content": "<p>(it's not a bug, but i am seeing that behaviour)</p>",
        "id": 523133129,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1749488058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"897677\">vxctyxeha</span> has marked this topic as resolved.</p>",
        "id": 523207373,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749532092
    }
]