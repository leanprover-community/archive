[
    {
        "content": "<p>I have the goal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">numeric</span>\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">addpre</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"n\">xLS</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">yL</span><span class=\"w\"> </span><span class=\"n\">yR</span><span class=\"w\"> </span><span class=\"n\">yLS</span><span class=\"w\"> </span><span class=\"n\">yRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">sr</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and I need to replace <code>addpre</code> with its definition, but I get error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"ss\">`unfold</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"ss\">`addpre</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"n\">numeric</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">addpre</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"n\">xLS</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">yL</span><span class=\"w\"> </span><span class=\"n\">yR</span><span class=\"w\"> </span><span class=\"n\">yLS</span><span class=\"w\"> </span><span class=\"n\">yRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">sr</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The command right before is <code>unfold rightm</code>, and the goal before that is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">numeric</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">rightm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">addpre</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"n\">xLS</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">yL</span><span class=\"w\"> </span><span class=\"n\">yR</span><span class=\"w\"> </span><span class=\"n\">yLS</span><span class=\"w\"> </span><span class=\"n\">yRS</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">sr</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>How can I expand this using the definitions?</p>",
        "id": 535418045,
        "sender_full_name": "Op From The Start",
        "timestamp": 1755743689
    },
    {
        "content": "<p><code>simp [addpre]</code> also does nothing.</p>",
        "id": 535418391,
        "sender_full_name": "Op From The Start",
        "timestamp": 1755743951
    },
    {
        "content": "<p><code>unfold addpre</code> also doesn't work on the goal <code>numeric (rightm (addpre (PreNo.mk xL xR xLS xRS) (PreNo.mk yL yR yLS yRS)) sr)</code> with a similar error.</p>",
        "id": 535418457,
        "sender_full_name": "Op From The Start",
        "timestamp": 1755744012
    },
    {
        "content": "<p>Try <code>split</code> and then unfold it in the splitting equation</p>",
        "id": 535472902,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1755771604
    },
    {
        "content": "<p>The split fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">split</span><span class=\"bp\">.</span><span class=\"n\">failure</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"ss\">`split</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"k\">at</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">addpre</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">xL</span><span class=\"w\"> </span><span class=\"n\">xR</span><span class=\"w\"> </span><span class=\"n\">xLS</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">yL</span><span class=\"w\"> </span><span class=\"n\">yR</span><span class=\"w\"> </span><span class=\"n\">yLS</span><span class=\"w\"> </span><span class=\"n\">yRS</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">PreNo</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">xRS</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">xRS</span>\n<span class=\"w\">    </span><span class=\"n\">Internal</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"ss\">`split</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"bp\">-</span><span class=\"n\">expression</span><span class=\"w\"> </span><span class=\"n\">discriminants</span>\n\n<span class=\"w\">    </span><span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">typically</span><span class=\"w\"> </span><span class=\"n\">occurs</span><span class=\"w\"> </span><span class=\"n\">when</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"ss\">`split</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">tactic's</span><span class=\"w\"> </span><span class=\"n\">internal</span><span class=\"w\"> </span><span class=\"n\">functions</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"n\">metaprogram</span>\n</code></pre></div>",
        "id": 535543748,
        "sender_full_name": "Op From The Start",
        "timestamp": 1755795325
    },
    {
        "content": "<p>I was able to get around it by doing <code>unfold addpre</code> earlier in the proof.</p>",
        "id": 535556210,
        "sender_full_name": "Op From The Start",
        "timestamp": 1755800306
    }
]