[
    {
        "content": "<p>I used a similar line to prove a couple of exercises from <em>The Mechanics</em>.. But I feel like this is probably doable in one line. Perhaps <code>dsimp</code> could help here?</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>4 proofs from The Mechanics</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\"><pre><span></span><code>import Mathlib\nimport Lean\n\nexample {x y : ℤ} (hx : Odd x) (hy : Odd y) : Odd (x * y + 2 * y) := by\n  obtain ⟨k₁, hx_eq⟩ := hx\n  obtain ⟨k₂, hy_eq⟩ := hy\n  have h_expr : x * y + 2 * y = 2 * (2 * k₁ * k₂ + k₁ + 3 * k₂ + 1) + 1 := by rw [hx_eq, hy_eq]; ring\n  exact ⟨2 * k₁ * k₂ + k₁ + 3 * k₂ + 1, h_expr⟩\n\nexample {m n : ℤ} (hm : Odd m) (hn : Even n) : Odd (n + m) := by\n  obtain ⟨k, hk⟩ := hm\n  obtain ⟨l, hl⟩ := hn\n  have h_sum : n + m = 2 * (l + k) + 1 := by rw [hl, hk]; ring\n  exact ⟨l + k, h_sum⟩\n\nexample {x : ℤ} (hx : Odd x) : Odd (x ^ 3) := by\n  obtain ⟨k, hx_eq⟩ := hx\n  have h_expr : x ^ 3 = 2 * (4 * k ^ 3 + 6 * k ^ 2 + 3 * k) + 1 := by rw [hx_eq]; ring\n  exact ⟨4 * k ^ 3 + 6 * k ^ 2 + 3 * k, h_expr⟩\n\nexample {p : ℤ} (hp : Odd p) : Odd (p ^ 2 + 3 * p - 5) := by\n  obtain ⟨k, hp_eq⟩ := hp\n  have h_expr : p ^ 2 + 3 * p - 5 = 2 * (2 * k ^ 2 + 5 * k - 1) + 1 := by rw [hp_eq]; ring\n  exact ⟨2 * k ^ 2 + 5 * k - 1, h_expr⟩\n</code></pre></div>\n</div></div>",
        "id": 483240098,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732015415
    },
    {
        "content": "<p>Here's one:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">add_even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">even_two_mul</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 483245592,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732017380
    },
    {
        "content": "<p>So much better. Thank you <span aria-label=\"thank you\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"thank you\">:thank_you:</span> <br>\nDo you perhaps see a line that would crack all 4?</p>",
        "id": 483247028,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732017822
    },
    {
        "content": "<p>Well, the general pattern is \"don't use <code>`obtain ⟨k, hp_eq⟩ := hp</code>\"</p>",
        "id": 483247627,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732018028
    },
    {
        "content": "<p>You should look for API around <code>Even</code> and <code>Odd</code> instead</p>",
        "id": 483247650,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1732018036
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"bp\">.</span><span class=\"n\">add_odd</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"n\">hm</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Odd</span><span class=\"bp\">.</span><span class=\"n\">pow</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n</code></pre></div>\n<p>Solutions suggested by <code>apply?</code> command.</p>",
        "id": 483248087,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1732018179
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Optimization.20of.20parity.20and.20divisibility.20proofs/near/483247650\">schrieb</a>:</p>\n<blockquote>\n<p>You should look for API around <code>Even</code> and <code>Odd</code> instead</p>\n</blockquote>\n<p>Tried that but wasn't looking hard enough. Got a bunch of bugs, and then wrote this. But this is good advice for sure.</p>",
        "id": 483248716,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732018387
    },
    {
        "content": "<p>Perfect! Got it. I should've tried harder. Got those proofs to work too quickly, and didn't optimize enough.</p>",
        "id": 483249108,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732018513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"672170\">Michael Bucko</span> has marked this topic as resolved.</p>",
        "id": 483249135,
        "sender_full_name": "Notification Bot",
        "timestamp": 1732018522
    }
]