[
    {
        "content": "<p>I am working on solving the jealous mathematician riddle. I have managed to state the problem, the required properties of the solution and a solution.</p>\n<p>I can prove that individual steps of the solution to the problem are mostly correct on first sight.</p>\n<p>When I try to prove that each step in the solution does not break the contract, I run into a problem. I don't know how to proof that all elements of a generated state vector satisfy some property.</p>\n<p>The source code is here:<br>\n<a href=\"https://github.com/wvhulle/riddle-proofs/blob/main/RiddleProofs/JealousMath.lean\">https://github.com/wvhulle/riddle-proofs/blob/main/RiddleProofs/JealousMath.lean</a></p>\n<p>I am stuck with the proof </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">all_states_safe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_states</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I have tried <code>rcases</code> and <code>fin_cases</code> (from Mathlib) but it does not work out. I feel like I am doing something wrong?</p>",
        "id": 524903662,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750345159
    },
    {
        "content": "<p>Did you <code>intro i</code> first?</p>",
        "id": 524904262,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750345351
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Proving.20the.20jealous.20mathematician.20riddle/near/524904262\">zei</a>:</p>\n<blockquote>\n<p>Did you <code>intro i</code> first?</p>\n</blockquote>\n<p>Yes, I have done that</p>",
        "id": 524904332,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750345377
    },
    {
        "content": "<p>What exactly is being a problem?</p>",
        "id": 524904716,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750345501
    },
    {
        "content": "<p>I have tried many different styles of proofs. I would like to prove that the solution state at time i is always correct. (No notebooks left-behind for other mathematicians). I am struggling with the inductive step.</p>",
        "id": 524904893,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750345571
    },
    {
        "content": "<p>I have a feeling the recursive statement of the solution might be causing problems</p>",
        "id": 524905042,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750345620
    },
    {
        "content": "<p>I can prove that the first state in the problem and the last step are safe, but not the 9 intermediate states.</p>",
        "id": 524905451,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750345749
    },
    {
        "content": "<p>Sorry, I still don't quite understand. What about the nine intermediate states makes it hard to show they are safe? Did you try unfolding everything?</p>\n<p>By the way, I noticed that your <code>solution_state_at</code> function has its termination shown by well-founded recursion. This makes it irreducible, which could be a problem for automation.</p>",
        "id": 524905933,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750345915
    },
    {
        "content": "<p>So the solution to mathematician riddle looks like this </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_cross_vec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_boat</span><span class=\"w\"> </span><span class=\"n\">left</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">move_math</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"bp\">▷</span><span class=\"w\"> </span><span class=\"n\">move_notebook</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">right</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I am trying to prove by induction or <code>fin_cases</code> on the step but unfolding always get stuck I think</p>",
        "id": 524906175,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750346008
    },
    {
        "content": "<p>Solution state is computed recursively based on these \"crossings\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_state_at</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">State</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">all_left</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n_lt_9</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_or_ge</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hlt</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">hge</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">solution_cross_vec</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n_lt_9</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_state_at</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 524906398,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750346085
    },
    {
        "content": "<p>Did I do something wrong?</p>",
        "id": 524906664,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750346177
    },
    {
        "content": "<p>What goes wrong during unfolding?</p>",
        "id": 524906716,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750346200
    },
    {
        "content": "<p>When I try this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">all_states_safe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_states</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">state_i</span>\n<span class=\"w\">  </span><span class=\"n\">fin_cases</span><span class=\"w\"> </span><span class=\"n\">state_i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">solution_states</span>\n<span class=\"w\">  </span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I get these leftover cases</p>\n<div class=\"codehilite\" data-code-language=\"txt\"><pre><span></span><code>unsolved goals\ncase «0»\n⊢ safe ((Vector.ofFn solution_state_at).get 0)\n\n\ncase «1»\n⊢ safe ((Vector.ofFn solution_state_at).get 1)\n\n\ncase «2»\n⊢ safe ((Vector.ofFn solution_state_at).get 2)\n</code></pre></div>\n<p>I don't know whether I should use unfold or simp</p>",
        "id": 524907462,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750346505
    },
    {
        "content": "<p>Also, the fact my safe property expects i, j i \\neq j makes it very nested</p>",
        "id": 524907621,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750346554
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Vector.get_ofFn#doc\">docs#Vector.get_ofFn</a></p>",
        "id": 524908174,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750346763
    },
    {
        "content": "<p>I tried this </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">all_states_safe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_states</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">get_ofFn</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Also imported the module but it cant make any progress</p>",
        "id": 524908844,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750347007
    },
    {
        "content": "<p>I made a little progress with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">all_states_safe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_states</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">fin_cases</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">solution_states</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">get_ofFn</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">repeat</span>\n<span class=\"w\">      </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">solution_state_at</span>\n<span class=\"w\">      </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">solution_cros_vec</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Vector</span><span class=\"bp\">.</span><span class=\"n\">get_ofFn</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">]</span>\n\n\n<span class=\"w\">  </span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 524909420,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750347205
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">etc</span><span class=\"w\"> </span><span class=\"n\">etc</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_state_atAux</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">State</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">all_left</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n_lt_9</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_or_ge</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">hlt</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hlt</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">hge</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">solution_cross_vec</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n_lt_9</span><span class=\"bp\">⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_state_atAux</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span>\n<span class=\"c1\">-- Helper function to compute state at step i</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_state_at</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">State</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">solution_state_atAux</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">isLt</span>\n\n<span class=\"n\">etc</span><span class=\"w\"> </span><span class=\"n\">etc</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidablePred</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">safe</span>\n<span class=\"w\">  </span><span class=\"n\">infer_instance</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">all_states_safe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">safe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">solution_states</span><span class=\"bp\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n</code></pre></div>",
        "id": 524909797,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750347336
    },
    {
        "content": "<p>Thanks a lot <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  that seems to fix it. What was the main thing you changed?</p>",
        "id": 524910225,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750347489
    },
    {
        "content": "<p>Is it because you made safe decidable?</p>",
        "id": 524910287,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750347513
    },
    {
        "content": "<p>maybe?</p>",
        "id": 524910324,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750347527
    },
    {
        "content": "<p>Now I can clean it up. I probably will try to get rid of the constant numeral 11</p>",
        "id": 524910804,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750347715
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"239415\" href=\"/#narrow/channel/239415-metaprogramming-.2F-tactics/topic/Proving.20the.20jealous.20mathematician.20riddle\">#metaprogramming / tactics &gt; Proving the jealous mathematician riddle</a> by <span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span>.</p>",
        "id": 524929503,
        "sender_full_name": "Notification Bot",
        "timestamp": 1750356126
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> do you know why your solution works with aux but when I merge the two functions I get problems with decidability?</p>",
        "id": 524932052,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750357560
    },
    {
        "content": "<p>It's because when you merge the two you are now defining the function by well founded recursion which is irreducible</p>",
        "id": 524932139,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750357595
    },
    {
        "content": "<p>What exactly is breaking well founded recursion?</p>",
        "id": 524932295,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750357666
    },
    {
        "content": "<p>I don't understand what you mean by that, can you elaborate a bit?</p>",
        "id": 524932358,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750357696
    },
    {
        "content": "<p>Isn’t welfounded recursion just checking that recursive calls are only applied to a smaller part of the outer argument? When I merge both I still see n+1 and at the end n as argument so it seems to me like it is still well founded recursion?</p>",
        "id": 524932518,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1750357788
    },
    {
        "content": "<p>No, it was using structural recursion when they're separated (which is not irreducible) but when you merge them it switches to using well-founded recursion (which is irreducible)</p>",
        "id": 524932634,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750357847
    },
    {
        "content": "<p><code>decide</code> will not unfold irreducible things</p>",
        "id": 524932705,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750357872
    }
]