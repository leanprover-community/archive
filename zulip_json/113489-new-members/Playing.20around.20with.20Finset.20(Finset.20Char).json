[
    {
        "content": "<p>Hi, </p>\n<p>Trying to learn some Lean by playing around with finite automata, I've been attempting to define finite sets (of, say, Char) as subsets of other finite sets. This seemed necessary to specify the initial and final states and the transition function of a finite automaton over some fixed alphabet and set of states. </p>\n<p>Doing this involves cumbersome notation, in particular to write down small examples, because one has to prove that each element indeed belong to the enclosing finite set.</p>\n<p>Here is a short excerpt of what I've come up with :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Aabcd</span><span class=\"w\">   </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Char</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">b'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">c'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">d'</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- attempt 1 : would be ideal, but fails with</span>\n<span class=\"c1\">--   failed to synthesize Singleton Char (Finset { x // x ∈ Aabcd })</span>\n<span class=\"c1\">--   failed to synthesize Insert Char (Finset { x // x ∈ Aabcd })</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Aac1</span><span class=\"w\">   </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Aabcd</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">c'</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- attempt 2 : ok but really cumbersome</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Aac2</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Aabcd</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">⟨'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"bp\">⟩</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨'</span><span class=\"n\">c'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"bp\">⟩</span><span class=\"o\">}</span>\n\n<span class=\"c1\">-- attempt 3 : fails with</span>\n<span class=\"c1\">--   failed to synthesize Singleton Char (Multiset { x // x ∈ Aabcd })</span>\n<span class=\"c1\">--   failed to synthesize Insert Char (Multiset { x // x ∈ Aabcd })</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Aac3</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Aabcd</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">c'</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- attempt 4 : ok but possibly not very idiomatic...</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">finset_cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">attach</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Nodup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">Nodup</span><span class=\"bp\">.</span><span class=\"n\">map</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">nodup_attach</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">nodup</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">attach</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Aac4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">Aabcd</span><span class=\"w\">  </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">finset_cast</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">a'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">c'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is there an elegant / idiomatic way to omit the <code>(by decide)</code> parts in these examples? Or ideally, to make the syntax in attempt 1 above trigger some kind of automatic coercion or dependent coercion? Or is the \"Finset over a Finset\" approach a really bad idea?</p>\n<p>Thanks!</p>\n<p>(PS : I've never really introduced myself here, is it something people still do, or has this channel been converted to a noob-questions channel?)</p>",
        "id": 507342889,
        "sender_full_name": "Antoine Meyer",
        "timestamp": 1742581803
    },
    {
        "content": "<p>Instead of working with <code>Char</code> you could use <code>Fin 4</code> and then <code>Aac1</code> would be <code>({0,2} : Set (Fin 4))</code>.<br>\nOr you could define a new type T containing elements a,b,c,d and then do <code>{a,c} : Set T</code>.<br>\n<code>Char</code> is not really a thing in mathematics so if we're doing mathematics it is probably best avoided.</p>",
        "id": 507368352,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1742591523
    },
    {
        "content": "<p>Thanks Bjørn. I’ll experiment with your suggestions using Fin and Set. </p>\n<p>Still, I’d be curious to know about my original question, if only to learn about this kind of coercions. </p>\n<p>To be honest I don’t really care that much about Char, it could be any arbitrary type. It’s just convenient to be able to use letters when working with automata (whether or not that can be considered real math).</p>",
        "id": 507379503,
        "sender_full_name": "Antoine Meyer",
        "timestamp": 1742596919
    }
]