[
    {
        "content": "<p>In this simple example, I have a theorem which would immediately solve the goal, but it fails to find an occurrence of the pattern, which to my eyes is right there.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">‚àë</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- h : Continuous fun x ‚Ü¶ ‚Äñx‚Äñ ^ 2</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ‚ä¢ Continuous fun x ‚Ü¶ ‚àë i, ‚Äñx i‚Äñ ^ 2--</span>\n<span class=\"w\">  </span><span class=\"c1\">-- I imagine this would solve the goal</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">EuclideanSpace</span><span class=\"bp\">.</span><span class=\"n\">norm_sq_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- but instead I get an error</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Tactic `rewrite` failed: Did not find an occurrence of the pattern</span>\n<span class=\"w\">  </span><span class=\"c1\">--   ‚Äñ?x‚Äñ ^ 2</span>\n<span class=\"w\">  </span><span class=\"c1\">-- in the target expression</span>\n<span class=\"w\">  </span><span class=\"c1\">--   Continuous fun x ‚Ü¶ ‚Äñx‚Äñ ^ 2</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Does anyone know what am I doing wrong here?</p>",
        "id": 540295462,
        "sender_full_name": "Micha≈Ç Pacholski",
        "timestamp": 1758219371
    },
    {
        "content": "<p>It's just because <code>x</code> is a bound variable, and <code>rw</code> can't rewrite bound variables.</p>",
        "id": 540295883,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758219547
    },
    {
        "content": "<p><code>simp_rw</code> will do this for you.</p>",
        "id": 540295897,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1758219553
    },
    {
        "content": "<p>You may also want to look at the <code>conv</code> tactic in the future</p>",
        "id": 540299095,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1758220674
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span>  <code>simp_rw</code> did the trick! Thank you, I never saw this tactic.<br>\n<span class=\"user-mention\" data-user-id=\"466290\">@Luigi Massacci</span> <code>conv</code> is now my new best friend <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 540318848,
        "sender_full_name": "Micha≈Ç Pacholski",
        "timestamp": 1758228986
    },
    {
        "content": "<p>How would you use conv here? I've read the tactic docs a couple of times but it's not clicked for me yet</p>",
        "id": 540355293,
        "sender_full_name": "Ryan Smith",
        "timestamp": 1758244136
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EuclideanSpace</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">‚àë</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ_‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">EuclideanSpace</span><span class=\"bp\">.</span><span class=\"n\">norm_sq_eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">assumption</span>\n</code></pre></div>\n<p>Basically you can use <code>conv</code> to go \"inside\" the binders so you can use <code>rw</code>. I seem to recall talks of <code>rw</code> eventually being able to rewrite in binders so that this trick won't be needed as much (but <code>conv</code> is still useful for other purposes such as if you only want to apply <code>rw</code> or <code>simp</code> to a particular part of the goal)</p>",
        "id": 540355894,
        "sender_full_name": "David Ledvinka",
        "timestamp": 1758244623
    },
    {
        "content": "<p>That makes a lot of sense. I wonder why rw can't do that but I can see why we need that.</p>",
        "id": 540372075,
        "sender_full_name": "Ryan Smith",
        "timestamp": 1758257263
    },
    {
        "content": "<p>I stumbled upon another mysterious case, when <code>rw</code> failed, although the pattern is right there.</p>\n<p>My goal is<br>\n<code>‚ä¢ inversionHomeo (inversionHomeo x) = x</code><br>\nwhich I want to transform to<br>\n<code>‚ä¢ (inversionHomeo.trans inversionHomeo) x = x</code><br>\nbut the rewrite<br>\n<code>rw [‚ÜêHomeomorph.trans_apply inversionHomeo inversionHomeo x]</code><br>\nproduces an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"ss\">`rewrite</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Did</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">occurrence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">pattern</span>\n<span class=\"w\">  </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">expression</span>\n<span class=\"w\">  </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>This time <code>x</code> is not a bound variable, so I don't see why would it fail. Below I attach the full example to reproduce the error. I apologize it's so lengthy, but when I tried running the tactic in an isolated theorem it worked without a problem (which the example also shows). It only fails in the <code>cocycle</code> case.</p>\n<p>There's a couple more weird things. E.g. tactics that work well in an isolated theorem <code>inversionHomeoInvolutive'</code> fail for the same goal in <code>case cocycle</code>.</p>\n<p>Btw. I tried all of <code>simp_rw</code>, <code>rw!</code> and <code>conv</code>. I couldn't get either to work.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n<span class=\"c1\">-- First, define our building blocks as pure terms</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Closeds</span><span class=\"bp\">.</span><span class=\"n\">compl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Closeds</span><span class=\"bp\">.</span><span class=\"n\">singleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">))</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"bp\">.</span><span class=\"n\">toTopCat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span>\n<span class=\"c1\">-- Define the inversion map as a Homeomorphism (Iso in TopCat)</span>\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ‚Çú</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_ne_zero</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">‚Åª¬π</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_ne_zero</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">coe_eta</span><span class=\"o\">],</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Subtype</span><span class=\"bp\">.</span><span class=\"n\">coe_eta</span><span class=\"o\">],</span>\n<span class=\"w\">  </span><span class=\"n\">continuous_toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- As we proved before, this is a composition of continuous functions</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">subtype_mk</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">inv‚ÇÄ</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">continuous_subtype_val</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">continuous_invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">subtype_mk</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"bp\">.</span><span class=\"n\">inv‚ÇÄ</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">continuous_subtype_val</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">,</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">   </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">‚ä§</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">‚ä§</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"bp\">.</span><span class=\"n\">toTopCat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚ü∂</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">TopologicalSpace</span><span class=\"bp\">.</span><span class=\"n\">Opens</span><span class=\"bp\">.</span><span class=\"n\">toTopCat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">isoOfHomeo</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hom</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">isoOfHomeo</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hom</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">ùüô</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">inversionHomeoInvolutive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">Homeomorph</span><span class=\"bp\">.</span><span class=\"n\">trans_apply</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_inv</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">inversionHomeoInvolutive'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_inv</span><span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">circleGlueDataCore</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">GlueData</span><span class=\"bp\">.</span><span class=\"n\">MkCore</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">J</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Bool</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">TopCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">V</span>\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">V_id</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- This is now definitionally true</span>\n\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">t_id</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">t_inter</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx_in_Vik</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">puncturedLine</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n<span class=\"w\">          </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">SetLike</span><span class=\"bp\">.</span><span class=\"n\">coe_mem</span>\n\n<span class=\"w\">  </span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">cocycle</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"c1\">-- We need to prove tjk ‚àò tij = tik on the triple overlap</span>\n<span class=\"w\">    </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx_in_Vik</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">SetLike</span><span class=\"bp\">.</span><span class=\"n\">coe_eq_coe</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">{</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"n\">Homeomorph</span><span class=\"bp\">.</span><span class=\"n\">trans_apply</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"c1\">-- Tactic `rewrite` failed: Did not find an occurrence of the pattern</span>\n<span class=\"w\">      </span><span class=\"c1\">--   inversionHomeo (inversionHomeo x)</span>\n<span class=\"w\">      </span><span class=\"c1\">-- in the target expression</span>\n<span class=\"w\">      </span><span class=\"c1\">--   inversionHomeo (inversionHomeo x) = x</span>\n<span class=\"w\">      </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">inversionHomeo</span>\n<span class=\"w\">      </span><span class=\"n\">dsimp</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inv_inv</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"c1\">-- these tactics worked for inversionHomeoInvolutive', but here, they don't</span>\n<span class=\"w\">    </span><span class=\"c1\">-- {</span>\n<span class=\"w\">    </span><span class=\"c1\">--   unfold inversionHomeo</span>\n<span class=\"w\">    </span><span class=\"c1\">--   dsimp</span>\n<span class=\"w\">    </span><span class=\"c1\">--   simp only [inv_inv]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- }</span>\n<span class=\"w\">    </span><span class=\"c1\">-- {</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- ths solves the goal, but I'm still confused why does the rewrite fails:</span>\n<span class=\"w\">    </span><span class=\"c1\">--   change (inversionHomeo.trans inversionHomeo) x = x</span>\n<span class=\"w\">    </span><span class=\"c1\">--   unfold inversionHomeo</span>\n<span class=\"w\">    </span><span class=\"c1\">--   dsimp</span>\n<span class=\"w\">    </span><span class=\"c1\">--   simp only [inv_inv]</span>\n<span class=\"w\">    </span><span class=\"c1\">--   rfl</span>\n<span class=\"w\">    </span><span class=\"c1\">-- }</span>\n<span class=\"w\">    </span><span class=\"c1\">-- {</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- either of thess of course also work:</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- exact inversionHomeoInvolutive</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- exact inversionHomeoInvolutive'</span>\n<span class=\"w\">    </span><span class=\"c1\">-- }</span>\n</code></pre></div>",
        "id": 541729710,
        "sender_full_name": "Micha≈Ç Pacholski",
        "timestamp": 1758913498
    },
    {
        "content": "<p>you have <code>‚Üë((TopologicalSpace.Opens.toTopCat (TopCat.of ‚Ñù)).obj puncturedLine)</code> and you have <code>‚Ü•puncturedLine</code> and these are not reducibly defeq I think</p>",
        "id": 541729998,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758913644
    },
    {
        "content": "<p>Ah, I see. When I change type of <code>inversionHomeo</code> to <code>P ‚âÉ‚Çú P</code>, it works without any problem (of course as long as I use <code>abbrev P := ...</code> not <code>def P := ...</code>, which makes sense to me.</p>",
        "id": 541733058,
        "sender_full_name": "Micha≈Ç Pacholski",
        "timestamp": 1758915032
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 541733133,
        "sender_full_name": "Micha≈Ç Pacholski",
        "timestamp": 1758915066
    }
]