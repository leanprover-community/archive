[
    {
        "content": "<p>Hi all,</p>\n<p>I have some questions about \"running lean\" that will sound very, very wrong if I don't explain who is my target audience, so let me do that first...</p>\n<p>I work in a campus in the countryside of Brazil, and I'm trying to adapt <a href=\"http://anggtwu.net/emacsconf2024.html\">what I presented in the last EmacsConf</a> - long story short: \"Emacs and Maxima for students who have never seen a terminal in their lives\" - to Lean. I also gave a mini-workshop on Lean for just five people one year ago, and two of the students there were also in the \"have never seen a terminal in their lives\" category. My instructions for that workshop are <a href=\"http://anggtwu.net/eev-intros/find-lean4-intro.html\">here</a>, and they are currently broken due to recent changed on Lean. I am trying to fix these instructions in a way that will make them much easier to troubleshoot - I am also trying to understand some things that the lean4-mode for Emacs does out-of-the-box by reproducing them in a more low-level setting.</p>\n<p>Here is my current script. Note that we execute it line by line, by typing f8 on each line to send it to a terminal running Emacs, and people are expected to wait until each line finishes execution before sending another one.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">du</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">ch</span><span class=\"w\">  </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Rfv</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Rfv</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">install</span><span class=\"bp\">/</span>\n<span class=\"n\">mkdir</span><span class=\"w\">   </span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">install</span><span class=\"bp\">/</span>\n<span class=\"n\">cd</span><span class=\"w\">      </span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">install</span><span class=\"bp\">/</span>\n<span class=\"n\">wget</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">sh</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">empty</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"s2\">\"sh\"</span><span class=\"w\"> </span><span class=\"n\">below</span><span class=\"w\"> </span><span class=\"n\">means</span><span class=\"w\"> </span><span class=\"s2\">\"1) Proceed with installation (default)\"</span><span class=\"bp\">.</span>\n<span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init</span><span class=\"bp\">.</span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"c1\">--verbose --no-modify-path</span>\n\n<span class=\"n\">find</span><span class=\"w\">     </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lAF</span><span class=\"w\">  </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"n\">ls</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">lAF</span><span class=\"w\">  </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\">   </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/*</span>\n<span class=\"n\">du</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">chd2</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"o\">:</span>\n<span class=\"bp\">#</span><span class=\"w\">   </span><span class=\"mi\">13</span><span class=\"n\">M</span><span class=\"w\">   </span><span class=\"n\">total</span>\n\n<span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">env</span>\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"bp\">=</span><span class=\"s2\">\"$HOME/.elan/bin:$PATH\"</span>\n\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">install</span><span class=\"bp\">/</span>\n\n<span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">test1</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">&lt;&lt;'%%%'</span>\n<span class=\"w\">  </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">println</span><span class=\"w\"> </span><span class=\"s2\">\"Hello\"</span>\n<span class=\"bp\">%%%</span>\n<span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run test1.lean</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"o\">:</span>\n<span class=\"bp\">#</span><span class=\"w\">   </span><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">downloading</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">releases</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">lang</span><span class=\"bp\">.</span><span class=\"n\">org</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">v4</span><span class=\"bp\">.</span><span class=\"m\">19</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mf\">4.19</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">linux</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">zst</span>\n<span class=\"bp\">#</span><span class=\"w\">   </span><span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">installing</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">edrx</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.19.0</span>\n<span class=\"bp\">#</span><span class=\"w\">   </span><span class=\"n\">Hello</span>\n\n<span class=\"n\">du</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">chd2</span><span class=\"w\"> </span><span class=\"bp\">~/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span>\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">Output</span><span class=\"o\">:</span>\n<span class=\"bp\">#</span><span class=\"w\">   </span><span class=\"mf\">1.6</span><span class=\"n\">G</span><span class=\"w\">   </span><span class=\"n\">total</span>\n\n<span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">test2</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"bp\">&lt;&lt;'%%%'</span>\n<span class=\"w\">  </span><span class=\"kn\">def</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span>\n<span class=\"bp\">%%%</span>\n<span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run test2.lean</span>\n</code></pre></div>\n<p>Here is the first question. The \"<code>lean --run test2.lean</code>\" at the end outputs this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">β</span>\n<span class=\"o\">(</span><span class=\"n\">interpreter</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">main'</span>\n</code></pre></div>\n<p>Is there an easy way to get an output like this intead?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">test2</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">info</span><span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">lsp</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>That's what I get in Emacs in the \"<code>*Flycheck errors*</code>\" buffer - Emacs sets up a LSP server for Lean, sends some things to it, and formats its answer in that compact way. Is there a way - not too painful - to do that from a shell?</p>",
        "id": 517211900,
        "sender_full_name": "Eduardo Ochs",
        "timestamp": 1746841908
    },
    {
        "content": "<p>I think dropping the <code>--run</code> would be a good start</p>",
        "id": 517213265,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746843082
    },
    {
        "content": "<p><code>--run</code> is for <code>main</code>, not for general diagnostics</p>",
        "id": 517213282,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746843104
    },
    {
        "content": "<p>Done! Ok, this got rid of the <code>(interpreter) unknown declaration 'main'</code>...</p>",
        "id": 517214959,
        "sender_full_name": "Eduardo Ochs",
        "timestamp": 1746844701
    },
    {
        "content": "<p>The next step is to simulate talking to a LSP server, or to talk to a LSP server from a shell...</p>",
        "id": 517215085,
        "sender_full_name": "Eduardo Ochs",
        "timestamp": 1746844813
    }
]