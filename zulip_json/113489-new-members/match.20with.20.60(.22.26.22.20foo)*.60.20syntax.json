[
    {
        "content": "<p>i've defined some custom syntax, and i'd like to define an elaborator for this. however, i can't seem to find a way to match with it...</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"foo_term\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n\n<span class=\"n\">declare_syntax_cat</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"s2\">\"bar_term\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n\n<span class=\"kn\">syntax</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"&amp;\"</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">customElab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">TermElab</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `($f:foo ??????) =&gt; success -- i have no clue how to make this work</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throwUnsupportedSyntax</span>\n</code></pre></div>\n<p>looking at <a href=\"https://leanprover.github.io/functional_programming_in_lean/\">#fpil</a> and metaprogramming, the only related idea i could find is matching with syntax defined like <code>bar,*</code>, but that doesn't work here sadly. i also came across <code>$[...]</code>, but i'm not sure if it's applicable, because i haven't found a good example of what that does.</p>",
        "id": 459937604,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723406865
    },
    {
        "content": "<p>nvm i figured it out; the right way to match this is <code>`($f:foo $[&amp; $b:bar]*)</code></p>",
        "id": 459944362,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723409922
    },
    {
        "content": "<p>as a sidenote: today i realized that <code>syntax term (\"&amp;\" term)* : term</code> and similar constructions are a quick way to make the server stack overflow, because of ambiguous interpretations and non-tail recursion. (i.e. when trying to parse a <code>term</code>, it sees this new rule and thinks \"ah, maybe i need to find a <code>term</code> first\" and starts the whole search again, just to come across this rule again, etc.)</p>",
        "id": 459945832,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723411134
    }
]