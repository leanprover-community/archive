[
    {
        "content": "<p><code>positivity</code> cannot prove <code>0 ≤ x*x</code>. (I can rewrite <code>x*x</code> to <code>x^2</code> using <code>rw [← pow_two]</code>.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- failed!</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- success</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n</code></pre></div>\n<p>Can I make <code>positivity</code> work for <code>x*x</code>?</p>",
        "id": 509697853,
        "sender_full_name": "Zhang Qinchuan",
        "timestamp": 1743600413
    },
    {
        "content": "<p><code>0 * 0 = 0</code>.</p>",
        "id": 509700911,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743601185
    },
    {
        "content": "<p>Oh, what you wrote in the code is not what you said you wanted.</p>",
        "id": 509701180,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743601244
    },
    {
        "content": "<p>No, because <code>positivity</code> works on goals which are <em>structurally positive</em>. So when it sees <code>*</code>, it expects to be able to prove that both sides individually are nonnegative, which is not the case.</p>",
        "id": 509701553,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743601334
    },
    {
        "content": "<p>If we <em>do</em> want this, it might not be clear how positivity should go about this... what if positivity encounters <code>a * b * a * b</code>? how about <code>a * a * a * a * a * a</code>? in these cases, positivity would need to know about commutativity/associativity to get to a place where it could be reasonably expected that there is a simple proof</p>",
        "id": 509701833,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743601405
    },
    {
        "content": "<p>and of course what about mixed versions like <code>x ^ 3 * x</code>? positivity suddenly would need to be a <em>very</em> smart algorithm (i.e. know about very different theories) in order to solve these kinds of problems, which it is simply not designed for</p>",
        "id": 509702064,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743601457
    },
    {
        "content": "<p>I'd argue that the \"right\" approach here would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>\n<p>i.e. <code>ring</code> (or <code>ring_nf</code>) is the tactic that knows about arithmetic manipulation and it seems to be a mission-creep if <code>positivity</code> tried to do that by itself</p>",
        "id": 509709658,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1743603231
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197836\">Jireh Loreaux</span> <a href=\"#narrow/channel/113489-new-members/topic/positivity.20cannot.20prove.200.20.E2.89.A4.20x*x/near/509701180\">said</a>:</p>\n<blockquote>\n<p>Oh, what you wrote in the code is not what you said you wanted.</p>\n</blockquote>\n<p>Sorry for that. I update my title.</p>",
        "id": 509723849,
        "sender_full_name": "Zhang Qinchuan",
        "timestamp": 1743606454
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113489-new-members/topic/positivity.20cannot.20prove.200.20.E2.89.A4.20x*x/near/509702064\">said</a>:</p>\n<blockquote>\n<p>and of course what about mixed versions like <code>x ^ 3 * x</code>? positivity suddenly would need to be a <em>very</em> smart algorithm (i.e. know about very different theories) in order to solve these kinds of problems, which it is simply not designed for</p>\n</blockquote>\n<p>Is it possible that <code>positivity</code> try <code>mul_self_nonneg</code> if LHS and RHS of <code>*</code> are the same, otherwise try <code>mul_nonneg</code>?</p>",
        "id": 509726064,
        "sender_full_name": "Zhang Qinchuan",
        "timestamp": 1743606910
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385895\">Jon Eugster</span> <a href=\"#narrow/channel/113489-new-members/topic/positivity.20cannot.20prove.200.20.E2.89.A4.20x*x/near/509709658\">said</a>:</p>\n<blockquote>\n<p>I'd argue that the \"right\" approach here would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring_nf</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>\n<p>i.e. <code>ring</code> (or <code>ring_nf</code>) is the tactic that knows about arithmetic manipulation and it seems to be a mission-creep if <code>positivity</code> tried to do that by itself</p>\n</blockquote>\n<p>Sounds reasonable since <code>field_simp</code> + <code>ring</code> is such combination of tactics.</p>",
        "id": 509726812,
        "sender_full_name": "Zhang Qinchuan",
        "timestamp": 1743607085
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/113489-new-members/topic/positivity.20cannot.20prove.200.20.E2.89.A4.20x*x/near/509701833\">said</a>:</p>\n<blockquote>\n<p>If we <em>do</em> want this, it might not be clear how positivity should go about this... what if positivity encounters <code>a * b * a * b</code>? how about <code>a * a * a * a * a * a</code>? in these cases, if positivity would need to now about commutativity/associativity to get to a place where it could be reasonably expected that there is a simple proof</p>\n</blockquote>\n<p>I'm curious to hear <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> 's take on this, but I think it would still be consistent with the vision to have <code>0 &lt;= (a * a) * 2</code> but not <code>0 &lt;= a * (a * 2)</code> proved by positivity</p>",
        "id": 509739664,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1743610337
    },
    {
        "content": "<p>If that's the case, I'm guessing that similarly positivity of <code>((a * b) * a) * b</code> is out of scope, but that of <code>(a * b) * (a * b)</code> is not?</p>",
        "id": 509785904,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743625080
    },
    {
        "content": "<p>The former sounds very reasonable to me; <code>((a * b) * a) * b</code> clearly looks like feature creep. Even adding <code>mul_self_nonneg</code> runs the risk that the outcome might be that positivity can now solve slightly more goals but is much slower sometimes (e.g. because Lean takes a long time checking that two things aren't the same, i.e. trying and failing to check that they're the same).</p>",
        "id": 509786576,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743625327
    },
    {
        "content": "<p>I think <code>a * a</code> should be out-of-scope. A user only has to write <code>simp only [← sq]</code> before <code>positivity</code></p>",
        "id": 509790777,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743626845
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"757121\">@Zhang Qinchuan</span> note that <code>nlinarith</code> can close the goal on its own (unsurprisingly) if you really want a one tactic proof</p>",
        "id": 509871041,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1743667703
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"757121\">Zhang Qinchuan</span> has marked this topic as resolved.</p>",
        "id": 509907214,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743678494
    }
]