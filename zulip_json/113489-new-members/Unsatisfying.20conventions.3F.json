[
    {
        "content": "<p>According to <em>Mathematics in Lean</em>, the inverse function is defined to be an arbitrary element when an inverse doesn't exist, and the pointwise derivative of a function not differentiable at said point is defined to be 0. Are these conventions as unsatisfying as they seem? Or is there a reason why they're actually alright? Is there a good reason not to instead say e.g. that the derivative of an  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo>→</mo><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb R\\to\\mathbb R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> function is a function <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi><mo>→</mo><mi mathvariant=\"double-struck\">R</mi><mo>∪</mo><mo stretchy=\"false\">{</mo><mtext>undefined</mtext><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb R\\to\\mathbb R\\cup\\{\\text{undefined}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∪</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">undefined</span></span><span class=\"mclose\">}</span></span></span></span>?</p>",
        "id": 536674223,
        "sender_full_name": "Linus Tang",
        "timestamp": 1756410631
    },
    {
        "content": "<p>Well, working with such a definition would be rather unsatisfying in practice :-)</p>",
        "id": 536675193,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756411086
    },
    {
        "content": "<p>Yes, there's a good reason. If you make that definition, all of a sudden you can't take the derivative of the derivative, because it has the wrong type. It's similar to why we define <code>x/0 := 0</code>. It's more convenient this way. You shift the burden away from <em>writing</em> the expression to <em>using/proving</em> things about it.</p>",
        "id": 536675196,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756411088
    },
    {
        "content": "<p><a href=\"https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/\">https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/</a> has some of this spelled out in more detail.</p>",
        "id": 536675262,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756411121
    },
    {
        "content": "<p>I think of the mathlib notion for limit more as a <code>limit'</code> --- which takes the value you expect when it exists, and a \"junk value\" otherwise. Because the junk value has the same type, that makes working with it much more pleasant. For almost any reasonable theorem, your <code>limit'</code> is in fact on the well-defined domain, and you get the result you expect.</p>",
        "id": 536675470,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756411222
    },
    {
        "content": "<p>There is some thought to choosing junk values well: if done correctly, some theorems about (e.g.) <code>limit'</code> become true without e.g. convergence assumptions --- because they are true in paper mathematics, and also true in the degenerate case. In practice, that means you have one fewer assumption to check... and such well-definedness assumptions would otherwise crop up over and over and over and over, not just once.</p>",
        "id": 536675631,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756411276
    },
    {
        "content": "<p>To be clear, what I mean is this: if you define <code>def deriv (f : ℝ → ℝ) : (ℝ → Option ℝ)</code>, then you will want <em>another</em> definition <code>def actualDeriv (f : ℝ → ℝ) (hf : Differentiable f) : ℝ → ℝ</code> which extracts the value out of the <code>Option</code> so that you can still access the underlying function when <code>f</code> is differentiable (so that, for example, you can take the derivative twice). But then this amounts to passing around proofs in the same way Kevin's post describes passing around proofs of nonzeroness.</p>",
        "id": 536675715,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1756411317
    },
    {
        "content": "<blockquote>\n<p>You shift the burden away from <em>writing</em> the expression to <em>using/proving</em> things about it.</p>\n</blockquote>\n<p>This is very helpful, thank you!</p>",
        "id": 536676006,
        "sender_full_name": "Linus Tang",
        "timestamp": 1756411479
    },
    {
        "content": "<p>As an example: I formalise a lot of differential geometry, which means working with charts of a manifold. These map a subset of your space to a subset of Euclidean space (we don't need to be more precise here). In practice, proving lemmas in DG means you're spending time proving over and over \"this point lies in my subset where things are well-defined\". On paper, you don't do that (or much much less)... it changes the feeling of formalisaing in that area quite a bit.<br>\nDoing that more would be really painful.</p>",
        "id": 536676014,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1756411483
    }
]