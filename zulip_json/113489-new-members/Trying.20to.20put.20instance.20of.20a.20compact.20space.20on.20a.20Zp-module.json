[
    {
        "content": "<p>I am trying to tell Lean that a finite topolgical Z_p-module is a compact space. The following code complies perfectly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsModuleTopology</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">CompactSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>But if I try to do the same in general</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsModuleTopology</span><span class=\"w\"> </span><span class=\"n\">ℤ_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">CompactSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I get an error message<br>\ncannot find synthesization order for instance @instCompactSpaceOfFactPrimeOfFiniteOfIsModuleTopologyPadicIntOfNatNat with type<br>\n  ∀ {p : ℕ} [Fact (Nat.Prime p)] {R : Type u_1} [inst : AddCommMonoid R] [inst_1 : Module ℤ_[3] R]<br>\n    [Module.Finite ℤ_[3] R] [inst_3 : TopologicalSpace R] [IsModuleTopology ℤ_[3] R], CompactSpace R<br>\nall remaining arguments have metavariables:<br>\n  Fact (Nat.Prime ?p)</p>\n<p>What is the issue here?</p>",
        "id": 554614712,
        "sender_full_name": "Stepan Nesterov",
        "timestamp": 1762745216
    },
    {
        "content": "<p>It can never guess which exact p you mean. It can't invent the p.</p>",
        "id": 554615981,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762746289
    },
    {
        "content": "<p>Your goal only mentions R, but the hypotheses have a free p.</p>",
        "id": 554616026,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762746313
    },
    {
        "content": "<p>You can make your instance a lemma, and invoke it at your desired call site</p>",
        "id": 554616098,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1762746351
    },
    {
        "content": "<p>Ok making it a lemma works like a charm <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 554616373,
        "sender_full_name": "Stepan Nesterov",
        "timestamp": 1762746616
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"407114\">@Stepan Nesterov</span> your Lean code does not say \"R is a topological Z_p-module\" (which just means \"addition and scalar multiplication are continuous\"), it says \"R has got some magical canonical topology induced from the fact that a topological ring is acting on it\" (or in other words R has the finest topology making addition and scalar multiplication continuous, as opposed to an arbitrary such topology).</p>",
        "id": 554763642,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762798371
    }
]