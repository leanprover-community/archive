[
    {
        "content": "<p>Hi all, I'm a new user.</p>\n<p>What's the normal way to set up linter warnings in my IDE (in my case, neovim)?  <br>\nI'm coming from Haskell, where I've gotten comfortable with <code>ghc-options: -Wall</code>; is there any equivelent?</p>\n<p>I see that I'm getting some linting for free with the lean.nvim plugin, specifically <code>unused variable</code>. But I'm not getting warned about variable shadowing, which feels amazingly dangerous in the context of <a href=\"https://lean-lang.org/functional_programming_in_lean/find/?domain=Verso.Genre.Manual.section&amp;name=or-patterns\">or-patterns</a>. <br>\nSpecifically, I'd expect something in my toolchain to complain about a situation like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">999</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">⊕</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"c1\">-- 10</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"c1\">-- 999</span>\n</code></pre></div>\n<p>Am I the only one who think's it's crazy to let a variable use-site be simultaneously shadowed and not shadowed?</p>",
        "id": 563041786,
        "sender_full_name": "Mako Bates",
        "timestamp": 1765398048
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"1005250\">Mako Bates</span> <a href=\"#narrow/channel/113489-new-members/topic/Linter.20options.3B.20variable.20shadowing/near/563041786\">said</a>:</p>\n<blockquote>\n<p>which feels amazingly dangerous in the context of <a href=\"https://lean-lang.org/functional_programming_in_lean/find/?domain=Verso.Genre.Manual.section&amp;name=or-patterns\">or-patterns</a>.</p>\n</blockquote>\n<p>Lean has an infoview, you can see in the infoview exactly which variables you have in scope, and there's also hover info attached to most of the syntax (including identifiers like <code>foo</code>) that tells you what it is. And if something does go wrong and you go to prove theorems about your functions you won't be able to prove the theorems. So I think it's not as bad as Haskell.</p>",
        "id": 563042653,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1765398394
    },
    {
        "content": "<p>Thanks for the response!<br>\nI'm unconvinced that the info/hover views and theorem-proving habits make these kinds of mistakes moot. Putting together a working example was a fun introductory exercise though!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">isEven</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- example: two is even</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">two</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isEven</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">double</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Even</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">addTwo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">Even</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">double</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">addTwo</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Should say `| .addTwo e =&gt; (toNat e) + 2`</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Even</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">isEven</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toNat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">double</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">addTwo</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Here the function <code>Even.toNat</code> contains a mistake, exactly like the earlier <code>bar</code>.<br>\nBut our theorem <code>e</code> has exactly the same superposition-shadowing, so it works without ever indicating there might be a problem. </p>\n<p>(Of course first I put together the not-broken version, which was longer and more illuminating.)</p>",
        "id": 563243308,
        "sender_full_name": "Mako Bates",
        "timestamp": 1765473203
    },
    {
        "content": "<p>I'll not opine on how easy it is to make a mistake in these kinds of cases -- but just on behalf of lean.nvim, it adds very little here, instead we benefit from all the hard work of lean itself plus linters written by wonderful people like <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> and many many others; what you see is basically just output from those. It might be one could write one for these kinds of variable shadowing cases as well in which case it'd just immediately work in Neovim as well.</p>",
        "id": 563294467,
        "sender_full_name": "Julian Berman",
        "timestamp": 1765492541
    },
    {
        "content": "<p>Ah; yes that is the more important question! How does one see/configure the linter lean.nvim is using? I have seen that there are other linters I could apply to a project, but if I'm going to set one up I'd like nvim to show it.</p>",
        "id": 563309856,
        "sender_full_name": "Mako Bates",
        "timestamp": 1765502243
    },
    {
        "content": "<p><code>lean.nvim</code> is invoking Lean's build tool <code>lake</code>, so the warnings you see should match what you see from <code>lake build</code>, and configuring additional options is done in your lakefile, or by importing a linter in a file of your project. There are of course a bunch of examples of writing such a linter in Mathlib, e.g. <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Linter/EmptyLine.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Linter/EmptyLine.lean</a> is a random one</p>",
        "id": 563432448,
        "sender_full_name": "Julian Berman",
        "timestamp": 1765532896
    }
]