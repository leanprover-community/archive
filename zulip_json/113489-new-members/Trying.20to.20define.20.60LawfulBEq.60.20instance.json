[
    {
        "content": "<p>Hi all,</p>\n<p>I have this data type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n</code></pre></div>\n<p>And I am trying to fill in the <code>sorry</code>s here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instLawfulBEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LawfulBEq</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">eq_of_beq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 507406483,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742615803
    },
    {
        "content": "<p>Here's a related conversation you might find useful: <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/Problem.20deriving.20LawfulBEq/with/504319252\">#new members &gt; Problem deriving LawfulBEq</a> <br>\nIt seemed to recommend deriving <code>DecidableEq</code> instead.</p>",
        "id": 507412842,
        "sender_full_name": "Eric Paul",
        "timestamp": 1742621196
    },
    {
        "content": "<p>Thanks, very helpful -- however, now I am in a rabbit hole trying to define a <code>DecidableEq</code> instance; I'm getting the \"default handlers have not been implemented yet, class: 'DecidableEq' types: [Term]\" error when I try to derive it.</p>",
        "id": 507414438,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742622328
    },
    {
        "content": "<p>I don't think a function from <code>Nat</code> is going to have decidable equality unless the codomain is a subsingleton... we can't check all the inputs</p>",
        "id": 507415884,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1742622718
    },
    {
        "content": "<p>Let me explain better. I want to write code that evaluates (Var 3 == Var 3) for branching purposes, and I want to be able to reason about it. I'm having trouble doing that because I'm unable to convert between (Var 3 == Var 3) = true and (Var 3 = Var 3).</p>",
        "id": 507417231,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742623148
    },
    {
        "content": "<p>can you provide an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 507421587,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1742625489
    },
    {
        "content": "<p>Unless you need to do it by defining BEq first, it's probably easier to do it the other way (derive DecidableEq, then define BEq in terms of that). The derived instances are usually behind auxiliary definitions and might have slightly artificial looking definitions, but Eq is just Eq.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">beq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instLawfulBEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LawfulBEq</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">eq_of_beq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">beq_iff_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">imp_self</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implies_true</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">beq_self_eq_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">implies_true</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Term</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Var</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span>\n</code></pre></div>",
        "id": 507423129,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742626829
    },
    {
        "content": "<p>Here is a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Baz</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Baz</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Baz</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Barf</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Baz</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 507423198,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742626918
    },
    {
        "content": "<p>Idk if it's minimal, but it's as minimal as i could make it.</p>",
        "id": 507423255,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742626951
    },
    {
        "content": "<p>I'm unable to derive DecidableEq here. But if I comment out the <code>Barf</code> declaration, it all works fine.</p>",
        "id": 507423287,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742626982
    },
    {
        "content": "<p>Here it is, even more minimal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Barf</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 507423395,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627066
    },
    {
        "content": "<p>Is your actual problem with <code>Term</code> or with a mutual inductive?</p>",
        "id": 507423416,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742627096
    },
    {
        "content": "<p>Looks like it's with a mutual inductive.</p>",
        "id": 507423431,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627109
    },
    {
        "content": "<p>These are not mutual. Foo is not defined in terms of Barf.</p>",
        "id": 507423518,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742627182
    },
    {
        "content": "<p>I know. But why does that matter? If I comment out the <code>deriving</code> clauses, it works fine. Also note: I need the <code>mutual</code> declaration in my actual code, even though it's not necessary in this MWE.</p>",
        "id": 507423595,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627272
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/YbCC0M6x60CTUAfG4HXGatSk/Screenshot-2025-03-22-at-12.08.39AM.png\">Screenshot 2025-03-22 at 12.08.39‚ÄØAM.png</a><br>\n<a href=\"/user_uploads/3121/bX1P9XsRLiPsKX65IWmgV9F5/Screenshot-2025-03-22-at-12.08.55AM.png\">Screenshot 2025-03-22 at 12.08.55‚ÄØAM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YbCC0M6x60CTUAfG4HXGatSk/Screenshot-2025-03-22-at-12.08.39AM.png\" title=\"Screenshot 2025-03-22 at 12.08.39‚ÄØAM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"464x482\" src=\"/user_uploads/thumbnail/3121/YbCC0M6x60CTUAfG4HXGatSk/Screenshot-2025-03-22-at-12.08.39AM.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/bX1P9XsRLiPsKX65IWmgV9F5/Screenshot-2025-03-22-at-12.08.55AM.png\" title=\"Screenshot 2025-03-22 at 12.08.55‚ÄØAM.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1836x372\" src=\"/user_uploads/thumbnail/3121/bX1P9XsRLiPsKX65IWmgV9F5/Screenshot-2025-03-22-at-12.08.55AM.png/840x560.webp\"></a></div>",
        "id": 507423681,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627341
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515652\">Ben Selfridge</span> <a href=\"#narrow/channel/113489-new-members/topic/Trying.20to.20define.20.60LawfulBEq.60.20instance/near/507423595\">said</a>:</p>\n<blockquote>\n<p>I know. But why does that matter? If I comment out the <code>deriving</code> clauses, it works fine. Also note: I need the <code>mutual</code> declaration in my actual code, even though it's not necessary in this MWE.</p>\n</blockquote>\n<p>Then it's not really an MWE I'm afraid. It matters because not all deriving handlers work the same (or at all) for mutual inductives.</p>",
        "id": 507423801,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742627448
    },
    {
        "content": "<p>Do you have any suggestions as to how I could define <code>DecidableEq</code> inside that mutual inductive?</p>",
        "id": 507423846,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627509
    },
    {
        "content": "<p>Also, can you explain to me why I am getting the red squiggly line under <code>DecidableEq</code>?</p>",
        "id": 507423909,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627550
    },
    {
        "content": "<p>I am so confused by your responses, I have to be honest with you. :(</p>",
        "id": 507424031,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742627661
    },
    {
        "content": "<p>You'll have to write it manually. The red squiggly is because the metaprogram for <code>deriving DecidableEq</code> works for inductive types, but has not yet been extended to work for mutual or nested inductive types, hence needing to do it manually.</p>\n<p>An example of doing it manually with an actual mutual would be like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">mutual</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">B</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">mutual</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqA</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqB</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">ht'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\">  </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">ht</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht'</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqB</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqA</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">a‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">instDecidableEqB</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">b‚ÇÇ</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"n\">ht'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isTrue</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">ht'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">isFalse</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">)</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>\n<p>Or this one (which is a nested inductive, but still): <a class=\"message-link\" href=\"/#narrow/channel/270676-lean4/topic/DecidableEq.20and.20List.20in.20inductive.20type/near/449273468\">#lean4 &gt; DecidableEq and List in inductive type @ üí¨</a></p>",
        "id": 507424483,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742628088
    },
    {
        "content": "<p>Actually the <code>A/B</code> one is sort of a loaded example, hold on.</p>",
        "id": 507424705,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742628264
    },
    {
        "content": "<p>This is starting to look pretty spooky for something that seems so simple...</p>",
        "id": 507424920,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742628463
    },
    {
        "content": "<p>It's just case analysis. If you want everything to work out of the box and be simple, I would try to restate the problem without using a mutual inductive.</p>",
        "id": 507425808,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742629208
    },
    {
        "content": "<p>Or use BEq without worrying about the lawful part, in which case it literally is just case analysis as you would write in any other language that doesn't concern itself with proofs.</p>",
        "id": 507425946,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1742629327
    },
    {
        "content": "<p>I'll take a closer look at this tomorrow. Thank you very much for your responses</p>",
        "id": 507426004,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742629406
    },
    {
        "content": "<p>Ok. Finally got all the DecidableEq instances written, thanks to your suggestions. It was incredibly tedious and I am not good enough with tactic combinators yet to know how to shorten it, but at least it's done. Thanks!</p>",
        "id": 507460094,
        "sender_full_name": "Ben Selfridge",
        "timestamp": 1742656301
    }
]