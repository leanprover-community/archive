[
    {
        "content": "<p>I've been reading <em>The Hitchhiker's Guide to Logical Verification</em> and found a chapter on \"structured proofs\", but for some reason most of their code doesn't work for me. Is this something deprecated and we don't do this kind of forward proofs without entering tactic mode anymore or the things have new names now?</p>\n<p>Here's an example from the book which doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">And_swap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n</code></pre></div>\n<p>Specifically, <code>assume</code> and <code>show</code> do not work here.</p>",
        "id": 464704998,
        "sender_full_name": "jsodd",
        "timestamp": 1724434735
    },
    {
        "content": "<p><code>assume</code> doesn't exist anymore, and I'm not sure it was replaced with anything.</p>\n<p>You can instead write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">And_swap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n</code></pre></div>",
        "id": 464705545,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724434861
    },
    {
        "content": "<p>The tactic version is almost the same:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">And_swap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">    </span><span class=\"n\">And</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n</code></pre></div>\n<p>(Not sure about <code>exact show</code> as a pattern, and I probably would write <code>exact (And.intro hb ha : b ∧ a)</code> if I really wanted to include the type)</p>",
        "id": 464706163,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435012
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/qm4cYhBa-fr89VtsCqrYcuA1/image.png\">image.png</a><br>\n<code>fix</code> also doesn't seem to work</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/qm4cYhBa-fr89VtsCqrYcuA1/image.png\" title=\"image.png\"><img data-original-dimensions=\"1074x327\" src=\"/user_uploads/thumbnail/3121/qm4cYhBa-fr89VtsCqrYcuA1/image.png/840x560.webp\"></a></div>",
        "id": 464706166,
        "sender_full_name": "jsodd",
        "timestamp": 1724435013
    },
    {
        "content": "<p>What it says about <code>let</code> being <code>(fun x =&gt; ...) t</code> is incorrect by the way</p>",
        "id": 464706369,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435064
    },
    {
        "content": "<p>So, is the notion of \"structured proof\" from this book in some sense deprecated?</p>",
        "id": 464706401,
        "sender_full_name": "jsodd",
        "timestamp": 1724435071
    },
    {
        "content": "<p><code>let</code> is one of the raw proof terms</p>",
        "id": 464706444,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435086
    },
    {
        "content": "<p>I can't say, I'm not familiar with the book</p>",
        "id": 464706511,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435104
    },
    {
        "content": "<p>But <code>fix</code> and <code>assume</code> do not exist in Lean 4. Potentially this part of the book came from Lean 3.</p>",
        "id": 464706605,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435131
    },
    {
        "content": "<p>Just to be sure, I haven't read the book (yet) -- but I know there are multiple versions I believe for each semester it's taught. Are you reading the 2024 version (which casually does seem to be using Lean 4)?</p>",
        "id": 464706982,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724435225
    },
    {
        "content": "<p>It lives here I believe: <a href=\"https://github.com/blanchette/interactive_theorem_proving_2024/tree/main/lean\">https://github.com/blanchette/interactive_theorem_proving_2024/tree/main/lean</a></p>",
        "id": 464707017,
        "sender_full_name": "Julian Berman",
        "timestamp": 1724435234
    },
    {
        "content": "<p>It seems that I'm reading a 2023 version which I took from learning resources page on lean website and there already exists 2024.</p>",
        "id": 464707042,
        "sender_full_name": "jsodd",
        "timestamp": 1724435242
    },
    {
        "content": "<p>I did some poking around, and you're supposed to be using the LoVe library. These structured proof syntaxes are defined here: <a href=\"https://github.com/blanchette/logical_verification_2023/blob/main/lean/LoVe/LoVelib.lean#L30-L36\">https://github.com/blanchette/logical_verification_2023/blob/main/lean/LoVe/LoVelib.lean#L30-L36</a></p>",
        "id": 464707311,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435311
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/tQxqoNCU4hlFR1uYtW4L1GzI/image.png\">image.png</a><br>\nBut it also has <code>fix</code> on the very first page of the chapter</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/tQxqoNCU4hlFR1uYtW4L1GzI/image.png\" title=\"image.png\"><img data-original-dimensions=\"1076x466\" src=\"/user_uploads/thumbnail/3121/tQxqoNCU4hlFR1uYtW4L1GzI/image.png/840x560.webp\"></a></div>",
        "id": 464707367,
        "sender_full_name": "jsodd",
        "timestamp": 1724435326
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/stream/113489-new-members/topic/Structured.20proofs.3F/near/464707311\">said</a>:</p>\n<blockquote>\n<p>I did some poking around, and you're supposed to be using the LoVe library. These structured proof syntaxes are defined here: <a href=\"https://github.com/blanchette/logical_verification_2023/blob/main/lean/LoVe/LoVelib.lean#L30-L36\">https://github.com/blanchette/logical_verification_2023/blob/main/lean/LoVe/LoVelib.lean#L30-L36</a></p>\n</blockquote>\n<p>So it's not a feature of lean itself?</p>",
        "id": 464707517,
        "sender_full_name": "jsodd",
        "timestamp": 1724435368
    },
    {
        "content": "<p>Correct</p>",
        "id": 464707607,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435389
    },
    {
        "content": "<p>The book is expecting that you're following along with its library.</p>",
        "id": 464707754,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435416
    },
    {
        "content": "<p>(It could be helpful if this chapter mentioned that these are custom.)</p>",
        "id": 464707868,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724435449
    },
    {
        "content": "<p>Okay, it seems that I've missed this recommendation. I'm not going to invest time in learning things which are not lean mainstream (hardly makes sense for a novice), but the book itself seems quite good. Thanks for the help!</p>",
        "id": 464708553,
        "sender_full_name": "jsodd",
        "timestamp": 1724435636
    },
    {
        "content": "<p>Just out of curiosity, what is the lean way of proving this without tactics? Just the first step, not the entire proof. What should there be instead of <code>assume hall : ...</code>? I tried using <code>fun</code> as above, but it didn't do the trick.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Forall</span><span class=\"bp\">.</span><span class=\"n\">one_point</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">     </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">       </span><span class=\"k\">by</span>\n<span class=\"w\">         </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">         </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">     </span><span class=\"n\">fix</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">     </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">     </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">       </span><span class=\"k\">by</span>\n<span class=\"w\">         </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 464711518,
        "sender_full_name": "jsodd",
        "timestamp": 1724436345
    },
    {
        "content": "<p>(Submitted an issue for the book by the way <a href=\"https://github.com/blanchette/logical_verification_2023/issues/5\">here</a>)</p>",
        "id": 464711724,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724436400
    },
    {
        "content": "<p><code>fun</code> seems to work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Forall</span><span class=\"bp\">.</span><span class=\"n\">one_point</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">     </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">       </span><span class=\"k\">by</span>\n<span class=\"w\">         </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">         </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">     </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">     </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">     </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">from</span>\n<span class=\"w\">       </span><span class=\"k\">by</span>\n<span class=\"w\">         </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span>\n<span class=\"w\">         </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 464711887,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724436454
    },
    {
        "content": "<p>Is there a lazy way to avoid rewriting <code>∀x, x = t → P x</code> manually? Some <code>?h</code> trick...</p>",
        "id": 464712166,
        "sender_full_name": "jsodd",
        "timestamp": 1724436539
    },
    {
        "content": "<p>Yeah, just delete the <code>:</code> and the type</p>",
        "id": 464712535,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724436637
    },
    {
        "content": "<p>(I'm trying to better understand how to manually destruct such expressions)</p>",
        "id": 464712583,
        "sender_full_name": "jsodd",
        "timestamp": 1724436653
    },
    {
        "content": "<p>None of the type ascriptions are needed here, since they can all be derived from the expected type.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Forall</span><span class=\"bp\">.</span><span class=\"n\">one_point</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">      </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">heq</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 464712772,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724436713
    },
    {
        "content": "<p>And is it possible to avoid <code>by</code> mode altogether?</p>",
        "id": 464713261,
        "sender_full_name": "jsodd",
        "timestamp": 1724436849
    },
    {
        "content": "<p>Yeah, it's always possible. Tactics are a way to construct proof terms.</p>\n<p>One trick is using <code>by?</code>, which pretty prints what the tactic mode constructed. You might have to fiddle with the result because pretty printing doesn't always round trip.</p>",
        "id": 464713659,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724436969
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Forall</span><span class=\"bp\">.</span><span class=\"n\">one_point</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 464713799,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437017
    },
    {
        "content": "<p>The triangle line is sort of cheating, since that's <code>rw</code> for terms.</p>\n<p>One possible replacement for that is <code>cast (congr_arg P heq.symm) hp</code>. It's worth getting familiar with <code>congr_arg</code>/<code>congr_fun</code>/<code>congr</code> to some degree, to get a feel for how something like <code>simp</code> works.</p>",
        "id": 464714266,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437163
    },
    {
        "content": "<p>You can also write the triangle as <code>Eq.recOn heq.symm hp</code>, which is also sort of cheating because it calculates the <code>motive</code> argument to <code>Eq.recOn</code> automatically using the \"eliminator elaborator\".</p>",
        "id": 464714561,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437244
    },
    {
        "content": "<p>Here's the manual version: <code>Eq.recOn (motive := fun x _ =&gt; P x) heq.symm hp</code></p>",
        "id": 464714689,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437284
    },
    {
        "content": "<p>(It's nice having access to the <code>rw</code> tactic to not have to write things like that!)</p>",
        "id": 464714793,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437316
    },
    {
        "content": "<p>Wow, thank you! Understanding how patterns are built seems important. I'll read more about congruences.</p>",
        "id": 464715709,
        "sender_full_name": "jsodd",
        "timestamp": 1724437604
    },
    {
        "content": "<p>It seems that everything here including the \"structured\"/\"forward\" style of the proof can be done within tactic mode, so there's no practical need for this. Just interesting to understand</p>",
        "id": 464715967,
        "sender_full_name": "jsodd",
        "timestamp": 1724437689
    },
    {
        "content": "<p>Mathlib tends to use term proofs for simple lemmas like this, but more compressed (we call it \"golfing\", but we're not trying to shave off <em>every</em> keystroke), mostly to say \"there is nothing mathematically interesting here, no need to read this\".</p>\n<p>Here's how it would probably be written in this style:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Forall</span><span class=\"bp\">.</span><span class=\"n\">one_point</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hall</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">heq</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>It's worth knowing how basic tactics relate to basic terms so that you can \"degolf\" it if needed.</p>",
        "id": 464716932,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724437979
    },
    {
        "content": "<p>Oh, just found the mathlib version, you can confirm: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=forall_eq#doc\">docs#forall_eq</a></p>",
        "id": 464716994,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1724438011
    }
]