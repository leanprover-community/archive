[
    {
        "content": "<p>I am working on implementing Laurent series and been struggling to understand the nested function in the last line of the following, taken from Mathlib/Analysis/Analytic/Basic.lean.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">HasFPowerSeriesOnBall</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FormalMultilinearSeries</span><span class=\"w\"> </span><span class=\"n\">ğ•œ</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"bp\">â‰¥</span><span class=\"mi\">0</span><span class=\"bp\">âˆ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">Â  Â  </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n\n<span class=\"w\">Â  </span><span class=\"n\">r_le</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">â‰¤</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">radius</span>\n\n<span class=\"w\">Â  </span><span class=\"n\">r_pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">r</span>\n\n<span class=\"w\">Â  </span><span class=\"n\">hasSum</span><span class=\"w\"> </span><span class=\"o\">:</span>\n\n<span class=\"w\">Â  Â  </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">EMetric</span><span class=\"bp\">.</span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">HasSum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>We use HasSum (sum) (function)  which sums over the function index and regard the coefficients as maps from E^n to F, a formal multilinear series p.Â It seems we construct the object y^n in a power series by a map from Fin n to y.</p>\n<p>How does the line </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span>\n</code></pre></div>\n<p>make sense?</p>\n<p>It seems to be a map from N to Fin n to F, fun _ : Fin n =&gt; y is a function from Fin n to F, but do we make sense of multiplication with p n which is an object in F?</p>",
        "id": 517534874,
        "sender_full_name": "Daniel Eriksson",
        "timestamp": 1747054427
    },
    {
        "content": "<p><code>p</code> is a <code>FormalMultilinearSeries ğ•œ E F</code>.<br>\n<code>p n</code> is a <code>ContinuousMultilinearMap ğ•œ (fun (i : Fin n) =&gt; E) F</code>.<br>\n<code>DFunLike.coe (p n)</code> is a <code>(Fin n â†’ E) â†’ F</code>.<br>\n<code>(p n) fun _ : Fin n =&gt; y</code> is a <code>F</code>.<br>\n<code>fun n : â„• =&gt; (p n) fun _ : Fin n =&gt; y</code> is a <code>â„• â†’ F</code>.<br>\nDoes that make sense?</p>",
        "id": 517538571,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747055157
    },
    {
        "content": "<p>Cleared up a bit, thanks. I struggle with lines 2-4, especially 4, is fun _ : Fin n of type Fin n -&gt; E?</p>",
        "id": 517610120,
        "sender_full_name": "Daniel Eriksson",
        "timestamp": 1747069571
    },
    {
        "content": "<p><code>y</code> is of type <code>E</code>, so <code>fun (_ : Fin n) =&gt; y</code> is of type <code>Fin n â†’ E</code></p>",
        "id": 517610427,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1747069655
    }
]