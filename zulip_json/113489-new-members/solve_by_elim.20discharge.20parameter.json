[
    {
        "content": "<p>Hello! Modulo that I might have misunderstood what it's for, I would like to pass <code>nlinarith</code> as a discharger for <code>solve_by_elim</code>, but if I try this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">solve_by_elim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">discharge</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span><span class=\"o\">})</span>\n</code></pre></div>\n<p>I get: </p>\n<div class=\"codehilite\" data-code-language=\"type\"><pre><span></span><code>  nlinarith\nhas type\n  Lean.ParserDescr : Type\nbut is expected to have type\n  Lean.MVarId → Lean.MetaM (Option (List Lean.MVarId)) : Type\n</code></pre></div>\n<p>which is beyond my current comprehension I'm afraid. What can I do?</p>",
        "id": 465774926,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1724853322
    },
    {
        "content": "<p>you probably need to find the <code>MetaM</code> function that nlinarith uses and you probably need to pass the goal that remains as a metavariable</p>",
        "id": 465778906,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724854291
    },
    {
        "content": "<p>what you are instead passing is <a href=\"https://github.com/leanprover-community/mathlib4/blob/e5cd4b4f321f6b9714857cc7c3ca9297ba23f409/Mathlib/Tactic/Linarith/Frontend.lean#L430\">this</a></p>",
        "id": 465779307,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724854396
    },
    {
        "content": "<p>For example this works: (although it uses linarith the example can be extended):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">use_linarith</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">MVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">MVarId</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">none</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">solve_by_elim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">discharge</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">use_linarith</span><span class=\"o\">})</span>\n</code></pre></div>",
        "id": 465782279,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724855045
    },
    {
        "content": "<p>thank you!</p>",
        "id": 465782902,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1724855215
    },
    {
        "content": "<p>fwiw, I think <code>solve_by_elim</code> solves this goal without nlinarith. So I am not really sure that example is a good test.</p>",
        "id": 465783436,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724855380
    },
    {
        "content": "<p>See:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">show_term</span><span class=\"w\"> </span><span class=\"n\">solve_by_elim</span>\n</code></pre></div>",
        "id": 465783585,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724855411
    },
    {
        "content": "<p>oh yeah, I mean the example could have been just <code>example : True</code>, it was just to put something in the goal, since it was clearly unrelated to the error I was getting anyway</p>",
        "id": 465792347,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1724857233
    },
    {
        "content": "<p>To be honest I find this way of doing things suboptimal. Ideally the discharger should accept a tactic name, insert the metavariable as a goal and automatically try to solve it. Alternatively there should be a top level MetaM function for each tactic whose name is identical to the tactic name so that the end user doesn't have to hunt down the correct function. For example,  I read the nlinarith code and found Linarith.linarith that way. But I didn't find any function called <code>nlinarith</code></p>",
        "id": 465815644,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724864747
    },
    {
        "content": "<p>And for all I know, there is a shortcut to invoke the tactic and have it find the goals to discharge automatically.</p>",
        "id": 465815894,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724864792
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"466290\">Luigi Massacci</span> <a href=\"#narrow/stream/113489-new-members/topic/solve_by_elim.20discharge.20parameter/near/465792347\">said</a>:</p>\n<blockquote>\n<p>oh yeah, I mean the example could have been just <code>example : True</code>, it was just to put something in the goal, since it was clearly unrelated to the error I was getting anyway</p>\n</blockquote>\n<p>Got a chance to put this to a small test. It doesn't quite do what one would expect. I think the following macro would work :</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"solve_by_elim_nlin\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"o\">(</span>\n<span class=\"w\">  </span><span class=\"n\">try</span><span class=\"w\"> </span><span class=\"n\">solve_by_elim</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">nlinarith</span>\n<span class=\"o\">))</span>\n</code></pre></div>",
        "id": 465869806,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724890851
    },
    {
        "content": "<p>Isn’t <code>solve_by_elim</code> a finishing tactic? Does it work to do <code>&lt;;&gt;</code> with those?</p>",
        "id": 465967431,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1724926338
    },
    {
        "content": "<p>yeah but <code>try</code> makes is non-finishing in some sense</p>",
        "id": 465994591,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724933041
    },
    {
        "content": "<p>It backtracks</p>",
        "id": 465994670,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724933055
    },
    {
        "content": "<p>What I meant was it works better in some cases than setting linarith as a discharger because in the function I wrote above, to be useful you need to fill in the hypotheses you want linarith to use</p>",
        "id": 465995022,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1724933142
    }
]