[
    {
        "content": "<p>Hi! I am new to the Lean community, so my question might be trivial <span aria-label=\"face holding back tears\" class=\"emoji emoji-1f979\" role=\"img\" title=\"face holding back tears\">:face_holding_back_tears:</span> Why does the following Lean program compile</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">tauto</span>\n</code></pre></div>\n<p>while this one does not pass the compilation check?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">tauto</span>\n</code></pre></div>\n<p>I am curious <span aria-label=\"face with monocle\" class=\"emoji emoji-1f9d0\" role=\"img\" title=\"face with monocle\">:face_with_monocle:</span> because this looks (kind of) similar to what <a href=\"https://github.com/model-checking/kani\">kani</a> does. If Lean is able to do more in this direction, it might be meaningful to general programming languages.</p>\n<p>PS: is there a better way to do this?</p>",
        "id": 572515142,
        "sender_full_name": "Guchan Li",
        "timestamp": 1770457810
    },
    {
        "content": "<p>Interesting observation!</p>\n<p>Small comment: I would add <code>import Mathlib.Tactic.Tauto</code> to your code snippets so that people can easily replicate the behaviour.</p>",
        "id": 572521670,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1770463860
    },
    {
        "content": "<p>I’m surprised <code>tauto</code> solves either of these goals. This really isn’t what it’s meant for.</p>",
        "id": 572584280,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770519859
    },
    {
        "content": "<p><code>use 2; simp</code> should work in both cases</p>",
        "id": 572584318,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1770519895
    },
    {
        "content": "<p>Thank you for your help! Actually I'm trying to ask: can Lean find the counterexample automatically? If it can, then a lot of verification in Rust can be completed.</p>\n<p>PS: the previous example is simplified from the kani book. i.e. will the program panic! in an if-else logic?</p>",
        "id": 572585044,
        "sender_full_name": "Guchan Li",
        "timestamp": 1770520873
    },
    {
        "content": "<p>I don't know if you can get a tactic to automatically solve the proof by finding an inhabitant, but you can use <code>plausible</code> to disprove the negation.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">push_neg</span>\n<span class=\"w\">  </span><span class=\"n\">plausible</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  ===================</span>\n<span class=\"cm\">  Found a counter-example!</span>\n<span class=\"cm\">  n := 2</span>\n<span class=\"cm\">  guard: 1 &lt; 2</span>\n<span class=\"cm\">  issue: 7 ≤ 2 does not hold</span>\n<span class=\"cm\">  (0 shrinks)</span>\n<span class=\"cm\">  -------------------</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>\n<p>I think <code>plausible</code> is probabilistic and non-deterministic so it might not be the best to include in proofs, if such a thing is even possible.</p>",
        "id": 572607337,
        "sender_full_name": "Niels Voss",
        "timestamp": 1770544134
    },
    {
        "content": "<p>Perhaps <code>by_contra; grind</code> will work?<br>\nIn any case you might be interested in <a href=\"https://youtu.be/ZzDpWjeUNdI\">https://youtu.be/ZzDpWjeUNdI</a> and <a class=\"stream\" data-stream-id=\"490604\" href=\"/#narrow/channel/490604-iris-lean\">#iris-lean</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"ZzDpWjeUNdI\" href=\"https://youtu.be/ZzDpWjeUNdI\"><img src=\"https://uploads.zulipusercontent.net/e20a2ce55b541bea83406d2d68d2d422af51c184/68747470733a2f2f692e7974696d672e636f6d2f76692f5a7a4470576a65554e64492f6d7164656661756c742e6a7067\"></a></div>",
        "id": 572607362,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770544153
    },
    {
        "content": "<p><code>grind</code> always starts with <code>by_contra</code> as I understand it</p>",
        "id": 572616788,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1770553276
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/113489-new-members/topic/.60tauto.60.20works.20for.207.20but.20fails.20for.208.3F/near/572607362\">said</a>:</p>\n<blockquote>\n<p>Perhaps <code>by_contra; grind</code> will work?<br>\nIn any case you might be interested in <a href=\"https://youtu.be/ZzDpWjeUNdI\">https://youtu.be/ZzDpWjeUNdI</a> and <a class=\"stream\" data-stream-id=\"490604\" href=\"/#narrow/channel/490604-iris-lean\">#iris-lean</a></p>\n</blockquote>\n<p>Thank you! I was actually trying to verify programs that kani can check using Aeneas <span aria-label=\"smiling face with hearts\" class=\"emoji emoji-1f970\" role=\"img\" title=\"smiling face with hearts\">:smiling_face_with_hearts:</span> I've been found out! <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 572617570,
        "sender_full_name": "Guchan Li",
        "timestamp": 1770554098
    },
    {
        "content": "<p>Thanks for the <code>plausible</code> advice! Here comes another tricky phenomenon. The following example works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">push_neg</span>\n<span class=\"w\">  </span><span class=\"n\">plausible</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">===================</span>\n<span class=\"cm\">Found a counter-example!</span>\n<span class=\"cm\">n := 99</span>\n<span class=\"cm\">guard: 98 &lt; 99</span>\n<span class=\"cm\">issue: 110 ≤ 99 does not hold</span>\n<span class=\"cm\">(0 shrinks)</span>\n<span class=\"cm\">-------------------</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>But the following fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">push_neg</span>\n<span class=\"w\">  </span><span class=\"n\">plausible</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Gave up after failing to generate values that fulfill the preconditions 100 times.</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>\n<p>Is this because plausible cannot analyze large numbers, since Nat is defined as a recursive structure?</p>",
        "id": 572617764,
        "sender_full_name": "Guchan Li",
        "timestamp": 1770554324
    },
    {
        "content": "<p>You need to set <code>maxSize</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬∃</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">push_neg</span>\n<span class=\"w\">  </span><span class=\"n\">plausible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">maxSize</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>The default is 100 so it will only generate numbers between 0 and 99 per default.</p>",
        "id": 572618771,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1770555181
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113489-new-members/topic/.60tauto.60.20works.20for.207.20but.20fails.20for.208.3F/near/572616788\">said</a>:</p>\n<blockquote>\n<p><code>grind</code> always starts with <code>by_contra</code> as I understand it</p>\n</blockquote>\n<p>Oops sorry I meant <code>by_contra!</code>. The point is that <code>grind</code> will not instantiate <code>∃</code> but it will <code>intro</code> a <code>∀</code> and use <code>lia</code> to get a contradiction.</p>",
        "id": 572658410,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770593377
    },
    {
        "content": "<p>Though I've tested it now and it doesn't work sadly, probably because the <code>∀</code> actually goes inside a hypothesis so it needs to <code>specialize</code> rather than <code>intro</code></p>",
        "id": 572658534,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1770593502
    },
    {
        "content": "<p>So Lean does not have strong model-checking ability yet? This is understandable, as these tasks are often NP-hard. I am curious whether related works exists in Lean?</p>",
        "id": 572685309,
        "sender_full_name": "Guchan Li",
        "timestamp": 1770616749
    }
]