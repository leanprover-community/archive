[
    {
        "content": "<p>The following to short proofs illustrate the use of the <code>rw</code> tactic, first using a hypotheses expressing equality <code>=</code>, and the second expressing iff <code>↔︎</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- h1: doesn't need to be a = b +1</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h2</span><span class=\"o\">]</span>\n\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"c1\">-- does need direction</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n</code></pre></div>\n<p>The first example works with both <code>h1: a = b + 1</code> and <code>h1:  b + 1 = a</code>. That is, the <code>rw</code> tactic doesn't need to be told which direction the equality works. This makes sense, of course, equalities are bidirectional.</p>\n<p>The second example is what surprises me.  The <code>rw</code> tactic needs to be told which direction to apply a bidirectional implication. </p>\n<p><strong>Question:</strong> Why is this? Why can't <code>rw</code> look at both sides of the symmetrical iff and pick the one that fits, just as it does with the equality?</p>",
        "id": 482033246,
        "sender_full_name": "rzeta0",
        "timestamp": 1731443218
    },
    {
        "content": "<p>That's not what the first example is doing! The first example reduces the goal <code>a = b + 1</code> to <code>a = a</code> by rewriting <code>b+1</code> to <code>a</code> (LHS of <code>h1</code> to RHS, as always with <code>rw</code>), and then closes the goal by reflexivity (rw runs a \"cheap <code>rfl</code>\" after rewriting).</p>",
        "id": 482033719,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731443415
    },
    {
        "content": "<p>The \"rewrite\" tactic is a version of \"rw\" which doesn't run a cheap rfl. Try replacing the first <code>rw</code> by <code>rewrite</code> to see the corresponding goal state.</p>",
        "id": 482033921,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1731443503
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> <a href=\"#narrow/channel/113489-new-members/topic/directions.20for.20rw.20tactic.20needed.20for.20iff.20but.20not.20.3D/near/482033246\">said</a>:</p>\n<blockquote>\n<p><strong>Question:</strong> Why is this? Why can't <code>rw</code> look at both sides of the symmetrical iff and pick the one that fits, just as it does with the equality?</p>\n</blockquote>\n<p>Because <code>rw</code> changes the LHS to the RHS, that's its job. Sure you could write your own tactic which tries to do both, but that's not what <code>rw</code> does.</p>",
        "id": 482045399,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731448243
    },
    {
        "content": "<p>The part that may be confusing you is that, in a <code>calc</code>step, you are stating an intermediate goal that is an equality (could be something else, but in your proof it is an equality), and if rewriting with hypothesis <code>h</code> makes the two sides of your goal equal, often rewriting right-to-left with the same hypothesis <code>h</code> will also make the two sides of your goal equal; this is what makes it look like tactic <code>rw</code> doesn't need a direction, because both direction will solve your step goal.</p>\n<p>In a tactic proof (not using <code>calc</code>), very often the direction of rewriting matters, because you are changing one term in your goal into another term.</p>\n<p>So as Mauricio pointed out, in your <code>case</code> proof the <code>rw [h1]</code> tactic changes the goal from <code>a = b+1</code> to <code>a = a</code>, while <code>rw [&lt;-h1]</code> would change the goal from <code>a = b+1</code> to <code>b+1 = b+1</code>; but both new goals are trivial and automatically solved.</p>",
        "id": 482053227,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1731451729
    },
    {
        "content": "<p>it seems I've been using <code>rw</code> for months assuming it was a \"find and replace\" tactic and not a strictly LHS-&gt;RHS tactic !</p>",
        "id": 482059362,
        "sender_full_name": "rzeta0",
        "timestamp": 1731454999
    },
    {
        "content": "<p>So I'm trying to apply what;s been said above:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- a = a using h1: b + 1 = a</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- a = ?</span>\n</code></pre></div>\n<p>In the example above , if <code>a = b +1</code> is rewritten to <code>a = a</code> using <code>h1: b +1 = a</code> strictly left to right, that's fine.</p>\n<p>But the next line is <code>_ =</code> which I understood to be short for the RHS of the previous <code>calc</code> line, and so is <code>a = 9 + 1</code>. How does <code>rw [h2]</code> help if it only rewrites left to right, that is replaces <code>b</code> with <code>9</code>? There is no <code>b</code> in <code>a=a</code>.</p>\n<p>Also if I comment out the last line <code>_=9+1</code> the info view tells me I still need to prove <code>b+1 = 10</code> not <code>a= 9 + 1</code> if we are to believe the previous line rewrote to <code>a=a</code>.</p>\n<p>Yes - I'm confused ! sorry ..</p>",
        "id": 482061176,
        "sender_full_name": "rzeta0",
        "timestamp": 1731456056
    },
    {
        "content": "<p>The RHS of the previous line is <code>b + 1</code>, so <code>rw [h2]</code> is seeing <code>b + 2 = 9 + 1</code></p>",
        "id": 482062114,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731456561
    },
    {
        "content": "<p>The underscore in the second line of your <code>calc</code> stands for <code>b + 1</code>, which is the right-hand side of the previous line.  And <code>rw [h2]</code> changes the <code>b</code> to <code>9</code>, so it becomes <code>9 + 1 = 9 + 1</code>.</p>\n<p>The <em>proof</em> of the first line proceeds by changing <code>a = b + 1</code> to <code>a = a</code>, and then recognizing that the two sides are the same.  Once that proof is over, the details of how it worked are forgotten.  You have justified the first line, which says <code>a = b + 1</code>.  What that first line says is not changed by how it was proven.  Then the calculational proof continues with <code>_ = 9 + 1</code>, which means <code>b + 1 = 9 + 1</code>.</p>",
        "id": 482062241,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1731456634
    },
    {
        "content": "<p>Another way to look at it:  To understand what your calculational proof is saying, you can start by ignoring everything after each <code>:=</code>.  Your calculational proof says <code>a = b + 1 = 9 + 1</code>.  Now, each of those equal signs needs to be justified, and to give the justification you put <code>:=</code> and then give a proof.  But those proofs don't change the meanings of the equations that make up the sequence of calculational steps.</p>",
        "id": 482062839,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1731457024
    },
    {
        "content": "<p>after 24 hours of thinking I think I finally got it, including the illustrations by <span class=\"user-mention\" data-user-id=\"726077\">@Philippe Duchon</span></p>",
        "id": 482178662,
        "sender_full_name": "rzeta0",
        "timestamp": 1731506373
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> has marked this topic as resolved.</p>",
        "id": 482178679,
        "sender_full_name": "Notification Bot",
        "timestamp": 1731506378
    },
    {
        "content": "<p>after 24 hours I think I finally got it - especially the helpful examples by <span class=\"user-mention\" data-user-id=\"726077\">@Philippe Duchon</span></p>",
        "id": 482178915,
        "sender_full_name": "rzeta0",
        "timestamp": 1731506430
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> has marked this topic as resolved.</p>",
        "id": 482198692,
        "sender_full_name": "Notification Bot",
        "timestamp": 1731511674
    }
]