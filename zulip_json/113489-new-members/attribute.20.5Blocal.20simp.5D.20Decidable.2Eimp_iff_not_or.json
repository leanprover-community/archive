[
    {
        "content": "<p>Just curious, is <code>attribute [local simp]</code> documented anywhere?  I was getting an error </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">'</span><span class=\"n\">Decidable</span><span class=\"bp\">.</span><span class=\"n\">imp_iff_not_or'</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">attribute</span>\n</code></pre></div>\n<p>and Perplexity.AI suggested this workaround, which worked, but I can't find a Lean tutorial or users manual that discusses it.</p>",
        "id": 482191207,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1731509827
    },
    {
        "content": "<p>In what context did you get that error?</p>",
        "id": 482198612,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731511645
    },
    {
        "content": "<p>That error only happens if you are trying to do <code>simp [-Decidable.imp_iff_not_or]</code>. The error means \"<code>Decidable.imp_iff_not_or</code> is not a simp lemma. There is no need to remove it from the simp set.\"</p>\n<p>There's no need to do <code>attribute [local simp]</code> just to enable removing it again.</p>",
        "id": 482199211,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731511790
    },
    {
        "content": "<p>I am playing with <span class=\"user-mention\" data-user-id=\"680236\">@Alex Oltean</span> 's thesis code for hybrid logic and I needed it to make this lemma check:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"bp\">.</span><span class=\"n\">imp_iff_not_or</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">new_nom_gt</span><span class=\"w\">      </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nom_occurs</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">letter</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"bp\">.</span><span class=\"n\">letter</span><span class=\"w\">   </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">φ</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nom</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\">          </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nom_occurs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Decidable</span><span class=\"bp\">.</span><span class=\"n\">imp_iff_not_or</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_succ_self</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">letter</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">impl</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nom_occurs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">or_eq_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n<span class=\"w\">        </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n<span class=\"w\">        </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">letter</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">letter</span>\n<span class=\"w\">        </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hc</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">assumption</span>\n<span class=\"w\">        </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hc</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_lt_of_le</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">      </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hb</span>\n<span class=\"w\">        </span><span class=\"n\">clear</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"n\">hb</span>\n<span class=\"w\">        </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"w\"> </span><span class=\"n\">ψ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">letter</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">new_nom</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">letter</span>\n<span class=\"w\">        </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hc</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">lt_trans</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"n\">hc</span>\n<span class=\"w\">        </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hc</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"n\">assumption</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">box</span><span class=\"w\">      </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">assumption</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">bind</span><span class=\"w\">     </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">assumption</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nom_occurs</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>In his original code he defined a theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">implication_disjunction</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">intro</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">impl</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">byCases</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">impl</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">hnp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">hnp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">disj</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Or</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"n\">disj</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">hnp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hnp</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"w\">  </span><span class=\"o\">:</span><span class=\"w\">  </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hq</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which using <code>apply?</code> turns out to be <code>Decidable.imp_iff_not_or</code>.  The theorem is labelled with <code>[simp]</code>.  Without thinking about that I replaced all uses of <code>implication_disjunction</code> with <code>Decidable.imp_iff_not_or</code>.  Then I got the error about it not being a <code>simp</code> lemma, and then Perplexity gave me that fix.  Then I was curious about the fix and I couldn't find it in the manual.  That's the whole story!</p>",
        "id": 482201562,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1731512349
    },
    {
        "content": "<p><code>attribute [...] declName</code> is how you set attributes after the fact, rather than using the <code>@[...] declaration</code> syntax.</p>\n<p>Just like how <code>@[local simp] declaration</code> adds the <code>simp</code> attribute in only the current scope, <code>attribute [local simp] declName</code> adds the <code>simp</code> attribute in only the local scope.</p>",
        "id": 482203332,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731512792
    }
]