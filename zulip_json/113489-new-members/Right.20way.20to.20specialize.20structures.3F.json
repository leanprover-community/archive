[
    {
        "content": "<p>I want to define the general syntax of a cryptographic commitment scheme:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">CommitmentScheme</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">Commitment</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Commitment</span>\n</code></pre></div>\n<p>I also want to define specialized versions of commitment schemes, for instance where <code>Data := List Datum</code> for some type <code>Datum</code>, or where <code>Randomness := Empty</code>. I can't just define something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ListCommitmentScheme</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">CommitmentScheme</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Datum</span>\n</code></pre></div>\n<p>since it gives no guarantee that <code>Data</code> is always <code>List Datum</code>, only that <code>List Datum</code> is the default option for <code>Data</code>.</p>\n<p>One way I thought of is to add a proof of equality:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ListCommitmentScheme</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">CommitmentScheme</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Datum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">hData</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Datum</span>\n</code></pre></div>\n<p>This seems clunky to me, since I have to keep casting <code>(hData ▸ x)</code> for any <code>x : List Datum</code>. Is there a better way to do this?</p>",
        "id": 455227611,
        "sender_full_name": "Quang Dao",
        "timestamp": 1722376227
    },
    {
        "content": "<p>This is a reason to use type parameters, for example</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">CommitmentScheme</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Commitment</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Commitment</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">ListCommitmentScheme</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Datum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Commitment</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">CommitmentScheme</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Datum</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"n\">Commitment</span>\n</code></pre></div>",
        "id": 455228066,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722376450
    },
    {
        "content": "<p>It seems that it's usually better to have all your types be parameters unless you have a really good reason not to.</p>",
        "id": 455228127,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722376480
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246591\">Quang Dao</span> has marked this topic as resolved.</p>",
        "id": 455228167,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722376497
    },
    {
        "content": "<p>You can always use sigma types to package them up with the types in the occasional context where you need to.</p>",
        "id": 455228193,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722376503
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246591\">Quang Dao</span> has marked this topic as unresolved.</p>",
        "id": 455228286,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722376549
    },
    {
        "content": "<p>Is there a way out if I don't want to pass in many type parameters? For instance, if I bundle them up via a structure:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">CommitmentSpec</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">Data</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">Randomness</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"n\">Commitment</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n</code></pre></div>\n<p>then is there a reasonable definition of <code>ListCommitmentSpec</code> that extends <code>CommitmentSpec</code>?</p>",
        "id": 455229123,
        "sender_full_name": "Quang Dao",
        "timestamp": 1722376838
    },
    {
        "content": "<p>I think the only options really are the <code>hData</code> field or promoting a field to a parameter.</p>",
        "id": 455230432,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722377527
    },
    {
        "content": "<p>I suppose another way is to define <code>ListCommitmentSpec</code> (resp. <code>...Scheme</code>) separately, then define a <code>Coe</code> instance to <code>CommitmentSpec</code> (resp. <code>...Scheme</code>). This way I only need to state defs/theorems about <code>CommitmentScheme</code> once, and they also apply to <code>ListCommitmentScheme</code> via coercion.</p>\n<p>Keeping this thread open in case people find problems with my proposal, or have other thoughts.</p>",
        "id": 455231705,
        "sender_full_name": "Quang Dao",
        "timestamp": 1722378239
    },
    {
        "content": "<p>That makes sense too, though an issue you might find is the fact that the types of terms have different phrasings, like if <code>s : ListCommitmentSpec</code> and <code>x : List s.Datum</code> then you also have <code>x : (s : CommitmentSpec).Data</code>. They're defeq, but it could cause issues for things that match on syntax (typeclasses, simp, etc.)</p>",
        "id": 455232273,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1722378435
    }
]