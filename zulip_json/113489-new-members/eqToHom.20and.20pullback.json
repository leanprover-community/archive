[
    {
        "content": "<p>Hi I am stuck at the following lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.CategoryTheory.Limits.Shapes.Pullbacks</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.CategoryTheory.Limits.Preserves.Limits</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">CategoryTheory</span> <span class=\"n\">Category</span> <span class=\"n\">Functor</span> <span class=\"n\">Limits</span> <span class=\"n\">IsLimit</span>\n<span class=\"kd\">universe</span> <span class=\"n\">v</span> <span class=\"n\">u</span>\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">C</span><span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Category.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">D</span><span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Category.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">D</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">C</span><span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Category.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">HasLimits</span> <span class=\"n\">C</span><span class=\"o\">]</span>\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">D</span><span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Category.</span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"n\">D</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">HasLimits</span> <span class=\"n\">D</span><span class=\"o\">]</span>\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">Xâ‚</span> <span class=\"n\">Xâ‚‚</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">fâ‚</span><span class=\"o\">:</span> <span class=\"n\">Xâ‚</span> <span class=\"bp\">âŸ¶</span> <span class=\"n\">Y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fâ‚‚</span><span class=\"o\">:</span> <span class=\"n\">Xâ‚‚</span> <span class=\"bp\">âŸ¶</span> <span class=\"n\">Y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">:</span> <span class=\"n\">Y</span> <span class=\"bp\">âŸ¶</span> <span class=\"n\">Z</span><span class=\"o\">)</span>\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">F</span><span class=\"o\">:</span> <span class=\"n\">C</span> <span class=\"bp\">â¥¤</span> <span class=\"n\">D</span><span class=\"o\">)</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">eq1</span> <span class=\"o\">:</span>  <span class=\"n\">pullback</span> <span class=\"o\">(</span><span class=\"n\">F.map</span> <span class=\"o\">(</span><span class=\"n\">fâ‚</span> <span class=\"bp\">â‰«</span> <span class=\"n\">g</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">F.map</span> <span class=\"o\">(</span><span class=\"n\">fâ‚‚</span> <span class=\"bp\">â‰«</span> <span class=\"n\">g</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">pullback</span> <span class=\"o\">(</span><span class=\"n\">F.map</span> <span class=\"n\">fâ‚</span> <span class=\"bp\">â‰«</span> <span class=\"n\">F.map</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">F.map</span> <span class=\"n\">fâ‚‚</span> <span class=\"bp\">â‰«</span> <span class=\"n\">F.map</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">congr</span> <span class=\"mi\">1</span> <span class=\"bp\">&lt;;&gt;</span> <span class=\"n\">apply</span> <span class=\"n\">F.map_comp</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">eq2</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">eqToHom</span> <span class=\"o\">(</span><span class=\"n\">eq1</span> <span class=\"n\">fâ‚</span> <span class=\"n\">fâ‚‚</span> <span class=\"n\">g</span> <span class=\"n\">F</span><span class=\"o\">))</span> <span class=\"bp\">â‰«</span> <span class=\"n\">pullback.fst</span> <span class=\"bp\">=</span> <span class=\"n\">pullback.fst</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Is it any way to prove this? Directly rewrite <code>eqToHom</code> seems giving a harder goal</p>",
        "id": 438174251,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1715508675
    },
    {
        "content": "<p>It is possible to prove, but a better approach would be to use <code>pullback.congrHom</code>.</p>",
        "id": 438175896,
        "sender_full_name": "JoÃ«l Riou",
        "timestamp": 1715510485
    },
    {
        "content": "<p>Oh I didn't notice it before. Thank you very much for mentioning <code>pullback.congrHom</code>. Yeah I am switching to use it.</p>",
        "id": 438176357,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1715511003
    },
    {
        "content": "<p>Why is <code>congrHom</code> preferrable? Is that always the case? I have found the following lemma useful:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">pullback.map_id'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">âŸ¶</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">âŸ¶</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasPullback</span><span class=\"w\"> </span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasPullback</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">pullback.map</span><span class=\"w\"> </span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">eqToHom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"o\">])</span>\n</code></pre></div>\n<p>but maybe in some cases it is bad because it moves from 'pullback comparison map land' to '<code>eqToHom</code> land'?</p>",
        "id": 479574931,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1730240520
    },
    {
        "content": "<p>I think this is probably a bad lemma indeed. There will be no way for simp to make further progress once that lemma is used.</p>",
        "id": 479583935,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730245955
    },
    {
        "content": "<p>Whatâ€™s the context for needing this lemma?</p>",
        "id": 479583974,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730245981
    },
    {
        "content": "<p>Also, for completely unrelated reasons, I donâ€™t think expensive tactics should be used to <em>state</em> lemmas</p>",
        "id": 479584114,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730246066
    },
    {
        "content": "<p>IMO a better formulation would be</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">pullback.map_id'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">âŸ¶</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">âŸ¶</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasPullback</span><span class=\"w\"> </span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasPullback</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h''</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">pullback.map</span><span class=\"w\"> </span><span class=\"n\">fâ‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚</span><span class=\"w\"> </span><span class=\"n\">fâ‚‚</span><span class=\"w\"> </span><span class=\"n\">gâ‚‚</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">ğŸ™</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">eqToHom</span><span class=\"w\"> </span><span class=\"n\">h''</span>\n</code></pre></div>",
        "id": 479584254,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730246167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/113489-new-members/topic/eqToHom.20and.20pullback/near/479584114\">said</a>:</p>\n<blockquote>\n<p>Also, for completely unrelated reasons, I donâ€™t think expensive tactics should be used to <em>state</em> lemmas</p>\n</blockquote>\n<p>In your formulation, <code>simp</code> would have to invent <code>h''</code> when using this lemma, no? So you really couldn't use it with <code>simp</code> then.</p>",
        "id": 479586550,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1730247829
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/113489-new-members/topic/eqToHom.20and.20pullback/near/479583974\">said</a>:</p>\n<blockquote>\n<p>Whatâ€™s the context for needing this lemma?</p>\n</blockquote>\n<p>It's a little complicated to contextualize, but I have some goals of the form <code>pullback.map .. â‰« g = eqToHom .. â‰« g</code> that arise in the proof of some universal property (<a href=\"https://github.com/sinhp/Poly/blob/c6155c49a7d9257d4f615015080af93142df7454/Poly/Polynomial.lean#L323\">this one</a> specifically). What about having the opposite direction as a simp lemma, then? I.e. if an <code>eqToHom</code> happens to equate two pullbacks, then it's <code>pullback.map</code>. Then maybe simp can make further progress with <code>pullback.map</code>?</p>",
        "id": 479586715,
        "sender_full_name": "ğš ğš˜ğš“ğšŒğš’ğšğšŒğš‘ ğš—ğšŠğš ğš›ğš˜ğšŒğš”ğš’",
        "timestamp": 1730247923
    },
    {
        "content": "<p>yes, you're right, but I also don't think it should be a simp lemma :)</p>",
        "id": 479586805,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730247992
    },
    {
        "content": "<p>but essentially the only way to continue with such an <code>eqToHom h''</code> is to <code>subst h''</code> to convert it to an identity map.</p>",
        "id": 479586865,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1730248040
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"128280\">Wojciech Nawrocki</span> <a href=\"#narrow/stream/113489-new-members/topic/eqToHom.20and.20pullback/near/479574931\">said</a>:</p>\n<blockquote>\n<p>Why is <code>congrHom</code> preferrable? Is that always the case? </p>\n</blockquote>\n<p>It has been a while for me and I forgot the concrete detail. But I came across this while I am trying to use to prove the diagram <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Mathlib.CategoryTheory.Limits.pullbackDiagonalMapIdIso#doc\">docs#Mathlib.CategoryTheory.Limits.pullbackDiagonalMapIdIso</a> in the yoneda style, where it has lots of preserving limits and creating limits stuffs. In that case <code>congrHom</code> seems quite suitable. But finally I seemed getting rid of <code>congrHom</code> too for using more results from mathlib</p>",
        "id": 479592250,
        "sender_full_name": "Shanghe Chen",
        "timestamp": 1730252020
    }
]