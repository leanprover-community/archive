[
    {
        "content": "<p>Hi,</p>\n<p>I am trying to define the exponential of Lie algebra derivations. To do this, I would like to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/Nilpotent/Exp.html#IsNilpotent.exp\">IsNilpotent.exp</a> on linear endomorphisms. Since IsNilpotent.exp is defined for arbitrary ℚ-algebras, my definition works fine for Lie algebras over ℚ, but I am unable to generalize it to Lie algebras over arbitrary characteristic zero fields.</p>\n<p>Here is a code example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">Derivation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Nilpotent</span><span class=\"bp\">.</span><span class=\"n\">Exp</span>\n\n<span class=\"c1\">-- VERSION 1: Over ℚ, everything works fine.</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lMap1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D1</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">l</span>\n\n<span class=\"c1\">-- VERSION 2: I have trouble defining lMap2 over a characteristic zero field R.</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- noncomputable def lMap2 : L2 → L2 := fun l =&gt; (IsNilpotent.exp D2.toLinearMap) l</span>\n</code></pre></div>\n<p>I found some results related to scalar restrictions, such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Algebra/RestrictScalars.html#RestrictScalars\">RestrictScalars</a>, which I thought might be useful, but I couldn't get them to work. Could you please help me understand how to handle this situation?</p>",
        "id": 504427045,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741550960
    },
    {
        "content": "<p>Isn't every lie algebra over a char-zero field also a lie algebra over A?</p>",
        "id": 504429231,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741552615
    },
    {
        "content": "<p>(and so keeping <code>LieAlgebra \\Q L</code> isn't costing any generality)</p>",
        "id": 504429293,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741552658
    },
    {
        "content": "<p>I agree that it doesn’t add much generality, but I would like to merge my work into mathlib, and its Lie folder currently refers to characteristic zero fields rather than explicitly mentioning ℚ.</p>\n<p>Moreover, my interest isn’t strictly about Lie algebras—it’s equally interesting to me for any algebraic structure. I’d like to understand how to properly use the fact that ℚ ≤ R when R is characteristic zero field in Lean. I was hoping this might help me learn how to work with RestrictScalars or a similar concept.</p>",
        "id": 504430571,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741553629
    },
    {
        "content": "<p>Maybe the definition of <code>IsNilpotent.exp</code> should use <code>Ring.inverse</code> instead of taking inverses in <code>Rat</code>...</p>",
        "id": 504477306,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741585392
    },
    {
        "content": "<p>Thanks! Since I introduced <code>IsNilpotent.exp</code> in this <a href=\"https://github.com/leanprover-community/mathlib4/pull/22316\">PR</a>, I was also curious whether its definition makes it easy to use. I initially thought it did, but as you can see, I’m now struggling to apply it in a more general setting. </p>\n<p>If the conclusion is that <code>IsNilpotent.exp</code> needs improvement, I’d be happy to make the necessary fixes.</p>",
        "id": 504492711,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741591972
    },
    {
        "content": "<p>I don't know what is best... I think it will be very rare that we want to compute with <code>IsNilpotent.exp</code>. So my gut feeling is that it is fine to use the non-computable <code>Ring.inverse</code>. But of course we will want formulas that express it nicely when there is a good notion of inverse around.</p>",
        "id": 504501624,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741594743
    },
    {
        "content": "<p>For what it's worth, here's how <code>RestrictScalars</code> can be used in your original example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lMap2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">RestrictScalars</span><span class=\"bp\">.</span><span class=\"n\">lieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span>\n<span class=\"w\">  </span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D2</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"w\"> </span><span class=\"n\">l</span>\n</code></pre></div>",
        "id": 504504903,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741595643
    },
    {
        "content": "<p>This type of thing is generally not automatic, and usually the preferred solution (in a <em>definition</em>) is to add the mathematically-redundant assumption.</p>",
        "id": 504505153,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741595710
    },
    {
        "content": "<p>Thank you, <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> ! This solution is exactly what I was looking for. It’s nice to see that <code>IsNilpotent.exp</code> is indeed usable in the expected generality. </p>\n<p>Still, if you think <code>IsNilpotent.exp</code> could benefit from any refinements, please let me know—I’d be happy to make adjustments! <br>\nFinally, here’s a standalone version of the solution, including the necessary imports:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Rat</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">BaseChange</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">Derivation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Nilpotent</span><span class=\"bp\">.</span><span class=\"n\">Exp</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lMap2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">RestrictScalars</span><span class=\"bp\">.</span><span class=\"n\">lieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span>\n<span class=\"w\">  </span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D2</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"w\"> </span><span class=\"n\">l</span>\n</code></pre></div>",
        "id": 504525604,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741600571
    },
    {
        "content": "<p>And I think another solution (if I understood <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> 's comment on mathematically redundant assumptions correctly!) would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Rat</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">Derivation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Nilpotent</span><span class=\"bp\">.</span><span class=\"n\">Exp</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">]</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">D2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">lMap2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D2</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"w\"> </span><span class=\"n\">l</span>\n</code></pre></div>",
        "id": 504529346,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741601446
    },
    {
        "content": "<p>But that one will be annoying to use, right? Because the assumption <code>[LieAlgebra ℚ L2]</code> will often be missing.</p>",
        "id": 504544387,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741605051
    },
    {
        "content": "<p>It should be present for any concrete <code>L2</code></p>",
        "id": 504544511,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741605083
    },
    {
        "content": "<p>I’m not entirely sure what’s happening under the hood in the second solution, but what makes me optimistic is that without the import:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Rat</span>\n</code></pre></div>\n<p>the code doesn’t work. <br>\nThis suggests to me that Lean is recognizing something about the inclusion ℚ ≤ R in this case.</p>",
        "id": 504547831,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741605867
    },
    {
        "content": "<p>Yes, Lean knows that every char-zero field is a Q-algebra</p>",
        "id": 504547935,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741605892
    },
    {
        "content": "<p>But it is not willing to automatically compose towers of (lie) algebras</p>",
        "id": 504548051,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1741605918
    },
    {
        "content": "<p>Wait? Are you happy with <code>[Field R]</code>? I missed that part. I was assuming <code>[CommRing R]</code> implicitly...</p>",
        "id": 504556237,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741607843
    },
    {
        "content": "<p>(And <code>[Algebra Q R]</code>...)</p>",
        "id": 504556397,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1741607874
    },
    {
        "content": "<p>Let me try to summarize my understanding of this topic. My original problem was that I couldn't generalize the use of <code>IsNilpotent.exp</code> over an arbitrary field of characteristic zero.</p>\n<p>For this problem, <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  provided two solutions. Below, I present them with slightly simplified notation. I also introduce a namespace where I attempt to call these definitions. As I see it, <code>solution_1</code> is a bit easier to use than <code>solution_2</code>, which is why I currently slightly prefer it.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Rat</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">BaseChange</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">Derivation</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">Nilpotent</span><span class=\"bp\">.</span><span class=\"n\">Exp</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Solution1</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LieAlgebra</span><span class=\"bp\">.</span><span class=\"n\">RestrictScalars</span><span class=\"bp\">.</span><span class=\"n\">lieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span>\n<span class=\"w\">  </span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"w\"> </span><span class=\"n\">l</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Solution1</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Solution2</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">solution_2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">IsNilpotent</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"bp\">.</span><span class=\"n\">toLinearMap</span><span class=\"w\"> </span><span class=\"n\">l</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Solution2</span>\n\n<span class=\"kn\">section</span><span class=\"w\"> </span><span class=\"n\">Call</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CharZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">call_1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieDerivation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">solution_1</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Error message: \"failed to synthesize LieAlgebra ℚ L\"</span>\n<span class=\"cm\">noncomputable def call_2 (h : LieDerivation R L L) : L → L := by</span>\n<span class=\"cm\">  exact solution_2 R L h</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Call</span>\n</code></pre></div>\n<p>On the other hand, <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>  suggested extending IsNilpotent.exp to work for CommRing R, which could be relevant, though this extension was not originally part of my considerations.</p>",
        "id": 504599267,
        "sender_full_name": "Janos Wolosz",
        "timestamp": 1741616893
    }
]