[
    {
        "content": "<p>I'm trying to run the following code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>I get an error saying \"failed to synthesize BEq Sequence\". This is strange, because the error goes away if I replace Sequence by its definition. How can I fix this?</p>",
        "id": 488726165,
        "sender_full_name": "Benjamin",
        "timestamp": 1734040772
    },
    {
        "content": "<p>Unless you want <code>Sequence</code> to have its own typeclass instances, you can do <code>abbrev Sequence := List Int</code> to make the definition become transparent for the purpose of typeclass inference.</p>",
        "id": 488726544,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734040906
    },
    {
        "content": "<p>Thanks. And if I wanted Sequence to have its own type class instances, what would I do?</p>",
        "id": 488726811,
        "sender_full_name": "Benjamin",
        "timestamp": 1734041007
    },
    {
        "content": "<p>You would define your own type class instance for <code>BEq</code></p>",
        "id": 488730504,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1734042674
    },
    {
        "content": "<p>Option 1: \"delta deriving\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">BEq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>Option 2: manually unfolding</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstanceAs</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">BEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">is_empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sequence</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n</code></pre></div>\n<p>The first is preferable, but it can be useful to know how to do the second.</p>",
        "id": 488731247,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734043007
    }
]