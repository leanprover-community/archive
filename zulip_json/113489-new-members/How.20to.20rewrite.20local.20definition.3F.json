[
    {
        "content": "<p>How can I rewrite local definition? I know I can use <code>subst</code>, but this will remove the definition and it will replace it in all hypotheses and goal. But <code>subst</code> sometimes doesn't work, and sometimes I don't want to replace with the definition in all hypotheses and goal. How can I do that?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"c1\">-- That's what I want to get:</span>\n<span class=\"w\">    </span><span class=\"n\">replace</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 536632806,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756394834
    },
    {
        "content": "<p>You can <code>rw [rewritingTheorm] at hypothesisName</code></p>",
        "id": 536633511,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756395039
    },
    {
        "content": "<p>Yeah, but in this case, it's not a theorem of the form <code>h : a = b</code>, but a local definition <code>a := b</code>. And <code>rw [n] at h₁</code> doesn't work.</p>",
        "id": 536633990,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756395174
    },
    {
        "content": "<p>Here are two ways to do it.</p>\n<p>The first way is to have Lean automatically add a theorem that says <code>n = 1</code> and then you rewrite with it. The second is to use <code>unfold</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h₁</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h₁</span>\n</code></pre></div>",
        "id": 536634012,
        "sender_full_name": "Eric Paul",
        "timestamp": 1756395180
    },
    {
        "content": "<p>you can also write <code>set n := 1 with h</code> within the tactic block to get an equality lemma</p>",
        "id": 536634292,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1756395256
    },
    {
        "content": "<p>Or <code>simp [n] at h</code></p>",
        "id": 536634698,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1756395375
    },
    {
        "content": "<p>maybe <code>simp only [n] at h</code></p>",
        "id": 536635110,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756395496
    },
    {
        "content": "<p>non-terminal simps aren't so great though... <code>simp only [n]</code> or <code>simp_rw [n]</code> might be cleaner, though it's also a heavy hammer and might simplify too much</p>",
        "id": 536635157,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1756395514
    },
    {
        "content": "<p>better make that <code>simp (config := Lean.Meta.Simp.neutralConfig) only [n, -eq_self] at h</code> so you don't simplify too much</p>",
        "id": 536635651,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756395662
    },
    {
        "content": "<p>Thanks everyone!<br>\nIn my case I'm proving something about a function I wrote, and the value came from there, so I can't use <code>set</code> and I don't want to change to add unused equality lemma in my function.<br>\n<code>unfold</code> does exactly what I want. Haven't though about it, cause I only used it for unfolding definition of a function.</p>",
        "id": 536635882,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756395724
    },
    {
        "content": "<p>Btw, if I ever wanted to contribute to mathlib, is there some policy about using non-terminal simp?</p>",
        "id": 536636126,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756395792
    },
    {
        "content": "<p>the policy is \"don't do that\" since <code>simp</code> can change behavior if new <code>simp</code> theorems are added and break your proof which now someone else has to spend time fixing</p>",
        "id": 536636536,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756395904
    },
    {
        "content": "<p>Yeah, I'm aware. But what about <code>simp only</code>? I've noticed that <code>simp only []</code> also sometimes does something, so is it ok to use it, or not?</p>",
        "id": 536636949,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1756396030
    },
    {
        "content": "<p><code>simp only</code> is fine since adding new <code>simp</code> lemmas won't change what it does</p>",
        "id": 536637175,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1756396109
    }
]