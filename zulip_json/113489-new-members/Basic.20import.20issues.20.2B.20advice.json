[
    {
        "content": "<p>Hi everyone!  I've tried Lean on and off and something that has bugged me several times is the import system. Here's the case I just ran into today. My goal is to receive feedback/ideas on how a noobie like me should be thinking about imports.</p>\n<p>1) I created a new project following <a href=\"https://leanprover-community.github.io/install/project.html#creating-a-lean-project\">https://leanprover-community.github.io/install/project.html#creating-a-lean-project</a>, after updating everything.</p>\n<p>2) The tutorial shows as an example to test that the following works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">TopologicalSpace</span>\n</code></pre></div>\n<p>and indeed that works for me.<br>\n3) Now I wanted to do a small example of my own:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>but this fails with <code>failed to synthesize HMul Nat ℤ ?m.99</code>, which I take as roughly: I need to import the basic integer things. I try adding as first line<br>\n<code>import Mathlib.Data.Int.Basic</code> but that fails with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">file</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">././.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Int</span><span class=\"bp\">/</span><span class=\"n\">Basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">✖</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"bp\">/</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">bsuberca</span><span class=\"bp\">/</span><span class=\"n\">School</span><span class=\"bp\">/</span><span class=\"n\">mylean</span><span class=\"bp\">/</span><span class=\"n\">mylearning</span><span class=\"bp\">/</span><span class=\"n\">Mylearning</span><span class=\"bp\">/</span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">bsuberca</span><span class=\"bp\">/</span><span class=\"n\">School</span><span class=\"bp\">/</span><span class=\"n\">mylean</span><span class=\"bp\">/</span><span class=\"n\">mylearning</span><span class=\"bp\">/</span><span class=\"n\">Mylearning</span><span class=\"bp\">/</span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bad</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">Basic'</span>\n<span class=\"n\">Some</span><span class=\"w\"> </span><span class=\"n\">required</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"w\"> </span><span class=\"n\">logged</span><span class=\"w\"> </span><span class=\"n\">failures</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">bsuberca</span><span class=\"bp\">/</span><span class=\"n\">School</span><span class=\"bp\">/</span><span class=\"n\">mylean</span><span class=\"bp\">/</span><span class=\"n\">mylearning</span><span class=\"bp\">/</span><span class=\"n\">Mylearning</span><span class=\"bp\">/</span><span class=\"n\">Test</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">)</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">failed</span>\n</code></pre></div>\n<p>even though it seems to be an actual file in Mathlib (<a href=\"https://github.com/leanprover/lean4/blob/master/src/Init/Data/Int/Basic.lean\">https://github.com/leanprover/lean4/blob/master/src/Init/Data/Int/Basic.lean</a>) and I should have an up to date version of Mathlib by having followed the tutorial.</p>\n<p>Using VS Code autocomplete (not the LLM based, just the deterministic list), I see that import <code>Mathlib.Data.Int.Defs</code> exists, and importing that makes the code run.<br>\nAt this point I have no idea if that is actually what I should be importing or not… But I keep going…</p>\n<p>4) I try to write the trivial proof</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">after</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">le_add_of_nonneg_left</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">mul_nonneg</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>at which point my goal is </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>I look up the lemma guessing its name and I see that <code>sq_nonneg</code> exists in <code>Mathlib/Algebra/GroupPower/Order.lean</code>. So I try adding <code>import Mathlib.Algebra.GroupPower.Order,</code> which also fails with the same error: <code>no such file or directory (error code: 2)</code>. Based on VS Code I try <code>import Mathlib.Algebra.Algebra.Basic</code>,  but now there’s an error on the line apply <code>Int.le_add_of_nonneg_left</code>; this import has changed the goal after line <code>simp [foo]</code> to just <code>0 ≤ 3 * x ^ 2</code>. So I delete the apply <code>Int.le_add_of_nonneg_left</code> line, and now see that <code>sq_nonneg</code> doesn’t seem to be imported through <code>import Mathlib.Algebra.Algebra.Basic</code> anyway. Following another VSCode suggestion, I use <code>import Mathlib.Algebra.Order.Algebra</code>. Now actually the state after simp [foo] is directly <code>0 ≤ x ^ 2</code>, so I have to remove another line, and now finally <code>sq_nonneg</code> works <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n<p>How can I do better at imports? Is there a way see what particular things are being done by simp (or other tactics) based on my imports? How awful is it if I just start doing <code>import Mathlib</code> for my projects? Is there some reasonable middle ground?</p>",
        "id": 494222835,
        "sender_full_name": "Bernardo Anibal Subercaseaux Roa",
        "timestamp": 1737057238
    },
    {
        "content": "<p>Please fix your backticks :)</p>",
        "id": 494223381,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737057480
    },
    {
        "content": "<p>It's an option to use <code>import Mathlib</code>, and then if you like you can use <code>#min_imports</code> at the end of your file to reduce back to what you need</p>",
        "id": 494223507,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737057527
    },
    {
        "content": "<p>(Looks like <code>Mathlib.Data.Int.Basic</code> existed but was removed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/11924\">#11924</a>)</p>",
        "id": 494223775,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737057635
    },
    {
        "content": "<p>Thanks! <code>#min_imports</code> looks great! :) it also outputs what the import is, which is very helpful!</p>",
        "id": 494224374,
        "sender_full_name": "Bernardo Anibal Subercaseaux Roa",
        "timestamp": 1737057880
    },
    {
        "content": "<p>Unfortunately, it doesn't seem to be true that the output of <code>#min_imports</code> gives back something sufficient. In this case it just gives me back <code>import Mathlib.Algebra.Group.Int.Defs</code>, which is not enough for the <code>sq_nonneg</code> to work.  At the end I found that <code>import Mathlib.Algebra.Order.Algebra</code> is enough to make things work...</p>",
        "id": 494227504,
        "sender_full_name": "Bernardo Anibal Subercaseaux Roa",
        "timestamp": 1737059275
    },
    {
        "content": "<p>It's not entirely accurate, unfortunately. If you share the exact code where it has trouble, someone could check if it's a known issue. (Not me though, at least today)</p>",
        "id": 494230760,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737060834
    }
]