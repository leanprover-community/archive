[
    {
        "content": "<p>Is there any way to run the last <code>#eval</code> in this situation?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ProbabilityTheory</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">th</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">    </span><span class=\"mi\">10</span><span class=\"bp\">/</span><span class=\"mi\">1024</span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial_apply</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"n\">norm_num</span><span class=\"bp\">;</span><span class=\"n\">ring_nf</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">inv_pow</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"n\">norm_num</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">ENNReal</span><span class=\"bp\">.</span><span class=\"n\">div_eq_inv_mul</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">((</span><span class=\"n\">Fin</span><span class=\"bp\">.</span><span class=\"n\">last</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- ignore noncomputable  tag</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>I also ran <code>#reduce</code> but the output is not human readable!</p>",
        "id": 494613413,
        "sender_full_name": "Arshak Parsa",
        "timestamp": 1737269865
    },
    {
        "content": "<p>(<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PMF.binomial#doc\">docs#PMF.binomial</a>)</p>",
        "id": 494636594,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737289170
    },
    {
        "content": "<p>I know it is tagged as noncomputable. Is there any way to tell Lean to ignore the noncomputable tag?</p>",
        "id": 494637093,
        "sender_full_name": "Arshak Parsa",
        "timestamp": 1737289533
    },
    {
        "content": "<p>This is noncomputable because <code>infty * x</code> is noncomputable</p>",
        "id": 494640151,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737291962
    },
    {
        "content": "<p>Asking to ignore noncomputable is a bit like asking to ignore that a bike doesn't have a chain or that a car doesn't have an engine</p>",
        "id": 494641044,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737292687
    },
    {
        "content": "<p>Actually, in this case I think I can redefine this computably without any real consequence, so maybe I'll do so later today</p>",
        "id": 494644109,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737295321
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113489-new-members/topic/Ignoring.20noncomputable/near/494641044\">said</a>:</p>\n<blockquote>\n<p>Asking to ignore noncomputable is a bit like asking to ignore that a bike doesn't have a chain or that a car doesn't have an engine</p>\n</blockquote>\n<p>When p is a rational number, tagging binomial distribution as noncomputable is like classifying a bird as a reptile!</p>",
        "id": 494675633,
        "sender_full_name": "Arshak Parsa",
        "timestamp": 1737318788
    },
    {
        "content": "<p><code>noncomputable</code> is not a tag which was put here arbitrarily, it is a mandatory keyword. If you do not put it  Lean raises an error. It was defined with <code>p</code> an <code>ENNReal</code> because <code>ENNReal</code> is the canonical codomain for a measure. AFAIK most users do not really care about computability so this is not really an issue</p>",
        "id": 494677129,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1737319853
    },
    {
        "content": "<p>Yeah, you'd have to make a version of PMF that's rational-valued and a version of PMF.binomial that's specialized to rationals. Otherwise it's not really clear what you're wanting out of <code>#eval</code>, which compiles the expression and runs it.</p>",
        "id": 494677293,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737319948
    },
    {
        "content": "<p>This sort of works (it uses simp lemmas and a normalization routine), but <code>norm_num</code> doesn't seem to know anything about ENNReal so it gets stuck:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial_apply</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMF</span><span class=\"bp\">.</span><span class=\"n\">binomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">10</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"c1\">-- 10⁻¹ * (1 - 10⁻¹) ^ 9 * 10</span>\n</code></pre></div>",
        "id": 494677412,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737320034
    },
    {
        "content": "<p>There's a sense in which <code>PMF.binomial</code> could be computable (which is what Eric said he might do), but you have to remember that real numbers are Cauchy sequences. I think it was Eric that added a Repr instance for Real that would print the first few terms of the Cauchy sequence. So, make sure to temper your expectations with a \"computable\" <code>PMF.binomial</code> if that's not what you're looking for when you <code>#eval</code>.</p>",
        "id": 494677643,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737320174
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Ignoring.20noncomputable/near/494644109\">said</a>:</p>\n<blockquote>\n<p>Actually, in this case I think I can redefine this computably without any real consequence, so maybe I'll do so later today</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20856\">#20856</a> is the hopefully-noncontroversial part of this</p>",
        "id": 494682206,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737322933
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20858\">#20858</a> is the more dubious part</p>",
        "id": 494686598,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737325814
    }
]