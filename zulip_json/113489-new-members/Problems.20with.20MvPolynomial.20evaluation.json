[
    {
        "content": "<p>Hi everyone! I’m working with multivariable polynomials in Lean, using the <code>MvPolynomial</code> type, and I created a function that takes a string and converts it into a polynomial. However, when I try to evaluate the result, it doesn’t simplify as expected.<br>\nHere is an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MvPolynomial</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MvPolynomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">vars</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"s2\">\"+\"</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">vars</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"w\">  </span><span class=\"c1\">-- Expected to see something like `X 0 + X 1`</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b+c\"</span><span class=\"w\"> </span><span class=\"c1\">-- Expected to see `C 0`</span>\n</code></pre></div>\n<p>When I run <code>#reduce</code>, Lean returns a more complex output with <code>support</code> and other internal details of the polynomial structure... Here's a sample of the output I get:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">Decidable</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">        </span><span class=\"o\">{</span>\n<span class=\"w\">          </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">            </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Perm</span>\n<span class=\"w\">              </span><span class=\"o\">[{</span><span class=\"w\"> </span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Perm</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">nodup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">,</span>\n<span class=\"w\">                  </span><span class=\"n\">mem_support_toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">}],</span>\n<span class=\"w\">          </span><span class=\"n\">nodup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">})</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Perm</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"n\">nodup</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>Does anyone know how to make Lean simplify the expression so that <code>#reduce</code> only shows the simplified polynomial (<code>X 0 + X 1</code> or <code>C 0</code>) instead of this full internal structure? I feel like I might be missing a configuration needed to get the reduced form.</p>",
        "id": 480700518,
        "sender_full_name": "Sarah Azevedo Pereira",
        "timestamp": 1730806704
    },
    {
        "content": "<p>The problem is that <code>#reduce</code> also reduces <code>X</code> and <code>C</code>, as well as addition</p>",
        "id": 480749372,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730821176
    },
    {
        "content": "<p>Well, I thought that comparing the output using <code>#reduce ((str_poly \"a+b\") == X 0 + X 1)</code> would work out and return true. However, the output is something like <code>Decidable.rec (...)</code> <br>\nAn alternative way would be: <code>example : Eq (str_poly \"a+b\") (X 0 + X 1) := by decide</code>, but it gave the following error: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">decide'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">proposition</span>\n<span class=\"w\">  </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">since</span><span class=\"w\"> </span><span class=\"n\">its</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Decidable'</span><span class=\"w\"> </span><span class=\"kn\">instance</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">decidableEqMvPolynomial</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"n\">did</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">isTrue'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">isFalse'</span><span class=\"bp\">.</span>\n\n<span class=\"n\">After</span><span class=\"w\"> </span><span class=\"n\">unfolding</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">instances</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">decidable_of_decidable_of_iff'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">decidable_of_iff'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">instDecidableAnd'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">instDecidableEqBool'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">instDecidableEqList'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">instDecidableEqNat'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">instDecidableEqString'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Bool</span><span class=\"bp\">.</span><span class=\"n\">decEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">decidableEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">instDecidableEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">hasDecEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Multiset</span><span class=\"bp\">.</span><span class=\"n\">decidableEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">decidableEqMvPolynomial'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">decEq'</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">String</span><span class=\"bp\">.</span><span class=\"n\">decEq'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">reduction</span><span class=\"w\"> </span><span class=\"n\">got</span><span class=\"w\"> </span><span class=\"n\">stuck</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Decidable'</span><span class=\"w\"> </span><span class=\"kn\">instance</span>\n<span class=\"w\">  </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"bp\">▸</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">lift</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">indep</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">              </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">recOnSubsingleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">                </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">decidable_of_iff'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≈</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">⋯</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">snd</span>\n\n<span class=\"n\">Hint</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Reduction</span><span class=\"w\"> </span><span class=\"n\">got</span><span class=\"w\"> </span><span class=\"n\">stuck</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"bp\">'▸'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">suggests</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Decidable'</span><span class=\"w\"> </span><span class=\"n\">instances</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">tactics</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rw'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">simp'</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">To</span><span class=\"w\"> </span><span class=\"n\">avoid</span><span class=\"w\"> </span><span class=\"n\">tactics</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">make</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">functions</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">inferInstanceAs'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">decidable_of_decidable_of_iff'</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">alter</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">proposition</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>The error message suggests trying alternatives like inferInstanceAs or decidable_of_decidable_of_iff, but I’m not sure how to apply these here.</p>\n<p>Has anyone had this kind of issue with polynomials or have ideas on how to test the function? I'd appreciate any insights</p>",
        "id": 482270082,
        "sender_full_name": "Sarah Azevedo Pereira",
        "timestamp": 1731535483
    },
    {
        "content": "<p>The issue is that much of Lean (and in particular, polynomials) is (intentionally) noncomputable (to make proving easier). I think the philosophy in mathlib is that you're supposed to test your definitions by proving theorems about them, rather than checking examples! You might be better off writing a decidable version of polynomials which is optimised to your needs.</p>",
        "id": 482270463,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731535653
    },
    {
        "content": "<p>The issue seems to be with String.splitOn rather than polynomials:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"a+b\"</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"s2\">\"+\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- I need a computer scientist to do this because I don't</span>\n<span class=\"w\">    </span><span class=\"c1\">-- know the API for `String.splitOn`</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">str_poly</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 482271067,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731535915
    },
    {
        "content": "<p>shouldn't it be possible to prove <code>foo</code> just by reducing both sides?</p>",
        "id": 482271373,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1731536045
    },
    {
        "content": "<p>or is <code>splitOn</code> noncomputable too? <span aria-label=\"face with monocle\" class=\"emoji emoji-1f9d0\" role=\"img\" title=\"face with monocle\">:face_with_monocle:</span></p>",
        "id": 482271423,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1731536070
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482271067\">said</a>:</p>\n<blockquote>\n<p>The issue seems to be with String.splitOn rather than polynomials:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"a+b\"</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"s2\">\"+\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- I need a computer scientist to do this because I don't</span>\n<span class=\"w\">    </span><span class=\"c1\">-- know the API for `String.splitOn`</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">str_poly</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Well, that's weird, because when I do this: <code>#reduce (\"a+b\".splitOn \"+\").length == 2</code> it returns true</p>",
        "id": 482271533,
        "sender_full_name": "Sarah Azevedo Pereira",
        "timestamp": 1731536119
    },
    {
        "content": "<p>It's not noncomputable, it's just CS gobble-de-gook and I can't find any API for it.</p>",
        "id": 482271538,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731536121
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"743212\">Sarah Azevedo Pereira</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482271533\">said</a>:</p>\n<blockquote>\n<p>Well, that's weird, because when I do this: <code>#reduce (\"a+b\".splitOn \"+\").length == 2</code> it returns true</p>\n</blockquote>\n<p>That's surprising because <code>rfl</code> doesn't close the goal. But all this is way beyond my comfort zone, I have no idea what <code>#reduce</code> does.</p>",
        "id": 482271698,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731536193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482270463\">said</a>:</p>\n<blockquote>\n<p>The issue is that much of Lean (and in particular, polynomials) is (intentionally) noncomputable (to make proving easier). I think the philosophy in mathlib is that you're supposed to test your definitions by proving theorems about them, rather than checking examples! You might be better off writing a decidable version of polynomials which is optimised to your needs.</p>\n</blockquote>\n<p>Also, I am a bit  confused about how can we have <code>DecidableEq</code> for polynomials if they are noncomputable</p>",
        "id": 482271841,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1731536274
    },
    {
        "content": "<p>I should shut up and we should wait until someone who knows what they're talking about comes along.</p>",
        "id": 482271995,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731536344
    },
    {
        "content": "<blockquote>\n<p>Also, I am a bit confused about how can we have <code>DecidableEq</code> for polynomials if they are noncomputable</p>\n</blockquote>\n<p><code>DecidableEq</code> and <code>noncomputable</code> are somewhat independent</p>",
        "id": 482272243,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731536485
    },
    {
        "content": "<p>Oh that didn't take long</p>",
        "id": 482272273,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731536499
    },
    {
        "content": "<p>But you can computably decide whether the polynomial 0 is equal to itself</p>",
        "id": 482272333,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731536523
    },
    {
        "content": "<p><code>DecidableEq</code> just says \"I have a function that tells you if <code>x = y</code> given <code>x</code> and <code>y</code>\". If <code>x</code> or <code>y</code> are noncomputable (as all polynomials except 0 are for stupid reasons), then calling <code>f x y</code> is going to be noncomputable even if <code>f</code> is computable.</p>",
        "id": 482272460,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731536590
    },
    {
        "content": "<p><code>#reduce</code> is something different again, and is not what is meant in lean when people talk about computability.</p>",
        "id": 482272546,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1731536639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482270463\">said</a>:</p>\n<blockquote>\n<p>The issue is that much of Lean (and in particular, polynomials) is (intentionally) noncomputable (to make proving easier). I think the philosophy in mathlib is that you're supposed to test your definitions by proving theorems about them, rather than checking examples! You might be better off writing a decidable version of polynomials which is optimised to your needs.</p>\n</blockquote>\n<p>Well, at first i tried to do that, but for this project I’ll need mathlib to help prove certain theorems about the polynomials as well, so I guess defining them another way wouldn't be the best solution</p>",
        "id": 482273456,
        "sender_full_name": "Sarah Azevedo Pereira",
        "timestamp": 1731537074
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482272460\">said</a>:</p>\n<blockquote>\n<p><code>DecidableEq</code> just says \"I have a function that tells you if <code>x = y</code> given <code>x</code> and <code>y</code>\". If <code>x</code> or <code>y</code> are noncomputable (as all polynomials except 0 are for stupid reasons), then calling <code>f x y</code> is going to be noncomputable even if <code>f</code> is computable.</p>\n</blockquote>\n<p>So there is no hope to test the function <code>str_poly</code>?</p>",
        "id": 482274108,
        "sender_full_name": "Tomaz Mascarenhas",
        "timestamp": 1731537386
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Problems.20with.20MvPolynomial.20evaluation/near/482271067\">said</a>:</p>\n<blockquote>\n<p>The issue seems to be with String.splitOn rather than polynomials:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">str_poly</span><span class=\"w\"> </span><span class=\"s2\">\"a+b\"</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"a+b\"</span><span class=\"bp\">.</span><span class=\"n\">splitOn</span><span class=\"w\"> </span><span class=\"s2\">\"+\"</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"c1\">-- I need a computer scientist to do this because I don't</span>\n<span class=\"w\">    </span><span class=\"c1\">-- know the API for `String.splitOn`</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">str_poly</span><span class=\"o\">]</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p><code>with_unfolding_all rfl</code> works here, as <code>String.splitOn</code> is irreducible</p>",
        "id": 482309812,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731559961
    },
    {
        "content": "<p>Oh nice!</p>",
        "id": 482332544,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731572631
    }
]