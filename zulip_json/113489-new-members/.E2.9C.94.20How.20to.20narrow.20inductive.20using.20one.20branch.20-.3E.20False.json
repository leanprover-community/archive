[
    {
        "content": "<p>I have the following inductive type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span>\n</code></pre></div>\n<p>How do I leverage the fact that if <code>t</code> is <code>.primitive</code> would let me prove <code>False</code> into showing that that pattern is therefore impossible, and to provide me with a proof that <code>t = SimpleType.typeCtor a uniVars</code>? Or to just simplify the goal to <code>uv ∈ uniVars</code> directly?</p>\n<p>My goal is this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">uniVars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniVars</span>\n</code></pre></div>",
        "id": 510487327,
        "sender_full_name": "aron",
        "timestamp": 1743949459
    },
    {
        "content": "<p><code>cases t</code> should give the right end state?</p>",
        "id": 510487611,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743949683
    },
    {
        "content": "<p>although do note that you will be <em>asked</em> to prove false in the <code>.primitive</code> case, not <em>able</em> (as far as your snippet is concerned)</p>",
        "id": 510487724,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743949784
    },
    {
        "content": "<p>Yeah if I do <code>cases t</code> then it asks me to just prove <code>False</code>. Is there a way to do that?</p>",
        "id": 510487827,
        "sender_full_name": "aron",
        "timestamp": 1743949832
    },
    {
        "content": "<p>not if your context is consistent</p>",
        "id": 510487996,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743949986
    },
    {
        "content": "<p>Right. So in my example I know that <code>t</code> must be the <code>.typeCtor</code> variant precisely because the alternative would result in <code>False</code>. So I'm asking how do I leverage this knowledge into eliminating the <code>.primitive</code> branch so I don't have to do the impossible and prove <code>False</code>?</p>",
        "id": 510488169,
        "sender_full_name": "aron",
        "timestamp": 1743950093
    },
    {
        "content": "<p>it doesn't <em>result</em> in false though</p>",
        "id": 510488534,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743950356
    },
    {
        "content": "<p>or at least, how do you know it does?</p>",
        "id": 510488551,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743950375
    },
    {
        "content": "<p>Looks like you did a wrong turn somewhere in your proof. We will need more context</p>",
        "id": 510488633,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743950414
    },
    {
        "content": "<p>Because this is my <code>Membership</code> instance:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">uniVars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniVars</span>\n</code></pre></div>\n<p>I.e. the <code>.primitive _</code> variant cannot contain any <code>Int</code>s</p>",
        "id": 510488809,
        "sender_full_name": "aron",
        "timestamp": 1743950583
    },
    {
        "content": "<p>This still doesn't make sense. You are asking us to avoid having to prove something impossible</p>",
        "id": 510488992,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743950704
    },
    {
        "content": "<p>Exactly. If it's impossible it doesn't make sense that I have to prove it. So surely it should be possible to prove that all scenarios that lead to <code>False</code> are impossible?</p>\n<p>In other words, surely it should be possible to use <code>t = .primitive p -&gt; False</code> to prove that <code>t = .typeCtor a uniVars</code>?</p>",
        "id": 510489191,
        "sender_full_name": "aron",
        "timestamp": 1743950845
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20narrow.20inductive.20using.20one.20branch.20-.3E.20False/near/510489191\">said</a>:</p>\n<blockquote>\n<p>Exactly. If it's impossible it doesn't make sense that I have to prove it.</p>\n</blockquote>\n<p>Well, Lean isn't stopping you from writing wrong theorems <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> It will only stop you from proving them</p>",
        "id": 510489277,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743950895
    },
    {
        "content": "<p>but we don't <em>have</em> <code>t = .primitive p -&gt; False</code> (according to the context you showed us)</p>",
        "id": 510489280,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743950898
    },
    {
        "content": "<p>I can't tell what you did wrong, because you aren't providing a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> ( <span aria-label=\"point left\" class=\"emoji emoji-1f448\" role=\"img\" title=\"point left\">:point_left:</span>  this is a link, please read), but either:</p>\n<ul>\n<li>you stated your lemma wrongly</li>\n<li>you stated your lemma correctly, but took a wrong turn within the proof</li>\n</ul>",
        "id": 510489343,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743950956
    },
    {
        "content": "<p>third option</p>\n<ul>\n<li>your lemma is false</li>\n</ul>",
        "id": 510489430,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743951009
    },
    {
        "content": "<p>if <code>t = .primitive p</code> then the goal would become:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">uniVars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniVars</span>\n</code></pre></div>\n<p>which, when <code>simp</code>ed <em>would</em> make the goal be <code>False</code>.</p>\n<p>So we do know that <code>t = .primitive p -&gt; False</code>. No? What am I missing?</p>",
        "id": 510489525,
        "sender_full_name": "aron",
        "timestamp": 1743951099
    },
    {
        "content": "<p>No. That means that <em>once you have finished proving your lemma</em>, we would know <code>t = .primitive p -&gt; False</code>. In other words, <em>once you have finished proving your lemma</em>, we would know that no simple type is primitive</p>",
        "id": 510489620,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743951156
    },
    {
        "content": "<p>That's unfortunate, because there definitely are primitive simple types</p>",
        "id": 510489650,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743951181
    },
    {
        "content": "<p>Yeah but I'm not trying to prove this for <em>all</em> <code>SimpleTypes</code>, just for this specific <code>t</code>. For which, based on propositions proven earlier in my theorem, I know that:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"c1\">-- &lt;--</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"bp\">.</span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">uniVars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">uv</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniVars</span>\n</code></pre></div>",
        "id": 510489807,
        "sender_full_name": "aron",
        "timestamp": 1743951305
    },
    {
        "content": "<p>I will stop talking here until you provide us a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>. Current discussion is unproductive</p>",
        "id": 510489840,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743951345
    },
    {
        "content": "<p>I mean I can but I've got hundreds of lines of very messy code so I'm trying to keep it focused on the specific point I'm struggling with. If you prefer I dump all the code here then I can do that.</p>",
        "id": 510489985,
        "sender_full_name": "aron",
        "timestamp": 1743951438
    },
    {
        "content": "<p>You can keep your examples focused <em>and</em> working <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> eg <code>sorry</code> out all lemmas that are unrelated, remove all definitions that don't appear in the lemma you want us to see...</p>",
        "id": 510490133,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1743951520
    },
    {
        "content": "<p>but at the very least does my <code>Membership</code> instance make sense?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"n\">SimpleType</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mem</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">container</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">primitive</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">typeCtor</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">uniVars</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">uniVars</span>\n</code></pre></div>\n<p>that only <code>.typeCtors</code> can contain <code>Int</code>s, but <code>.primitive</code>s can't? I got that from a different thread where someone helped me to prove that a certain data structure terminates. So I didn't just make it up myself <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> But it feels like you disagree that this is a valid way to implement an instance</p>",
        "id": 510490310,
        "sender_full_name": "aron",
        "timestamp": 1743951644
    },
    {
        "content": "<p>indeed, this makes <code>3 ∈ t</code> only possibly true when <code>t</code> is a <code>.typeCtor</code></p>",
        "id": 510490387,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743951719
    },
    {
        "content": "<p>and it makes <code>3 ∈ t</code> <em>false</em> and <em>not provable</em> when <code>t</code> is a <code>.primitive</code></p>",
        "id": 510490462,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743951764
    },
    {
        "content": "<p>Well exactly! So if I <em>know</em> that <code>3 ∈ t</code> is false when <code>t = .primitive p</code>, shouldn't I be able to create a concrete proof of that in the form of a <code>¬(t = .primitive p)</code>?</p>",
        "id": 510490648,
        "sender_full_name": "aron",
        "timestamp": 1743951903
    },
    {
        "content": "<p>if you have <code>3 ∈ t</code> as a <em>hypothesis</em>, but not when you have it as a <em>goal</em>, and the second seemed to be the case in your non-MWE</p>",
        "id": 510491131,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743952251
    },
    {
        "content": "<p>Ok I managed to avoid having to \"prove\" <code>False</code> by slightly refactoring my code so that I was matching on the <code>.primitive</code> pattern separately from the <code>.typeCtor</code> pattern. This way, when I do my recursive call of my function on the <code>.typeCtor</code> branch (and only on that branch), I have a proof available that <code>t</code> is indeed a <code>.typeCtor</code> and I don't need to prove termination on the <code>.primitive</code> branch at all <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 510493099,
        "sender_full_name": "aron",
        "timestamp": 1743953651
    },
    {
        "content": "<p>sounds like this was a frustrating experience for all of us but I now have a slightly better handle on how to do things The Lean Way<span aria-label=\"tm\" class=\"emoji emoji-2122\" role=\"img\" title=\"tm\">:tm:</span> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> thanks for your help, guys <span aria-label=\"folded hands\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"folded hands\">:folded_hands:</span></p>",
        "id": 510493251,
        "sender_full_name": "aron",
        "timestamp": 1743953746
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> has marked this topic as resolved.</p>",
        "id": 510493734,
        "sender_full_name": "Notification Bot",
        "timestamp": 1743954065
    }
]