[
    {
        "content": "<p>I stumbled upon this <a href=\"https://news.ycombinator.com/item?id=44299680\">HN Lean story</a> some days ago and wanted to show equality of the original function and the function that also returns a proof of its correctness.<br>\nI thought showing that equality would be trivial as they are \"obviously equal\", but I really struggled a lot with the nested pattern matches.</p>\n<p><a href=\"https://live.lean-lang.org/#codez=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\">This is my brute-force proof</a> (see theorem helperMemo'_eq_helperMemo).<br>\nIs there a better way? Maybe by adjusting <code>helperMemo'</code>? I was hoping a bit <code>helperMemo'_eq_helperMemo</code> could be fully proven with just <code>by simp</code> or at least <code>by aesop</code>, but instead it turned out to be much harder than the original proof...</p>",
        "id": 525954535,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1750960225
    },
    {
        "content": "<p>Here's a \"brute-force\" proof that repeatedly does <code>split</code> and <code>simp_all</code> without any thought about what we're trying to prove. The last case, I tried the new <code>grind</code> tactic, which happens to work (I didn't look into why!).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">helperMemo'_eq_helperMemo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">memo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMap</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">strongRecOn</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"c1\">-- in the next release, no longer experimental</span>\n</code></pre></div>\n<p>The grind tactic is even faster if you switch to \"Lean nightly (without mathlib)\" on <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a></p>",
        "id": 525956682,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750961111
    },
    {
        "content": "<p>I guess <code>grind</code> can handle a number of the last <code>split</code>s</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">helperMemo'_eq_helperMemo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">memo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMap</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">strongRecOn</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 525957087,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750961216
    },
    {
        "content": "<p>ohh that is very cool! Thanks for your help! :) Is grind exploring more options than aesop?</p>",
        "id": 525957363,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1750961292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"234196\">Henning Dieterichs</span> has marked this topic as resolved.</p>",
        "id": 525957411,
        "sender_full_name": "Notification Bot",
        "timestamp": 1750961303
    },
    {
        "content": "<p>Just found <a href=\"https://proofassistants.stackexchange.com/questions/4953/what-is-the-grind-tactic-in-lean-4\">https://proofassistants.stackexchange.com/questions/4953/what-is-the-grind-tactic-in-lean-4</a> . I guess it will be my new when-in-doubt-tactic!</p>",
        "id": 525957703,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1750961391
    },
    {
        "content": "<p><code>grind</code> is sort of like an SMT solver that generates a proof, whereas <code>aesop</code> is more of a proof search system. It's hard to compare them directly.</p>",
        "id": 525957729,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750961400
    },
    {
        "content": "<p>This isn't completely accurate, but very very loosely you could think \"find a way to solve the problem and then synthesize a proof\" vs \"synthesize proofs and see if they solve the problem\"</p>",
        "id": 525958300,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750961583
    },
    {
        "content": "<p>Here's a grind-free proof by the way:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">helperMemo'_eq_helperMemo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">memo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMap</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">strongRecOn</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">rename</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">  </span><span class=\"n\">apply_fun</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">  </span><span class=\"n\">rename</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">  </span><span class=\"n\">apply_fun</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">  </span><span class=\"n\">subst_vars</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n</code></pre></div>\n<p><a href=\"https://live.lean-lang.org/#codez=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\">live lean</a></p>",
        "id": 525961051,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750962615
    },
    {
        "content": "<p>Oh wow, I didn't appreciate until now that you can do <code>apply_fun Result.r at ‹helperMemo' _ _ _ = _›</code> to avoid ever giving the hypothesis a name.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">helperMemo'_eq_helperMemo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">memo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PMap</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">correct</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">strongRecOn</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">memo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">helperMemo</span><span class=\"w\"> </span><span class=\"n\">helperMemo'</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">split</span>\n<span class=\"w\">  </span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">apply_fun</span><span class=\"w\"> </span><span class=\"n\">Result</span><span class=\"bp\">.</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">‹</span><span class=\"n\">helperMemo'</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_›</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">  </span><span class=\"n\">subst_vars</span>\n<span class=\"w\">  </span><span class=\"n\">simp_all</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">congr!</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n</code></pre></div>",
        "id": 525961374,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750962735
    },
    {
        "content": "<p>E.g. <code>simp at ‹memo[k]? = none›</code></p>",
        "id": 525961544,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1750962800
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20working.20with.20nested.20matches/near/525961544\">said</a>:</p>\n<blockquote>\n<p>E.g. <code>simp at ‹memo[k]? = none›</code></p>\n</blockquote>\n<p>That looks so bad, but it's surprisingly readable</p>",
        "id": 525961672,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1750962848
    },
    {
        "content": "<p>that are some very useful tactics! Especially that rename can bind expressions that I don't want to/can't write down</p>",
        "id": 525962264,
        "sender_full_name": "Henning Dieterichs",
        "timestamp": 1750963080
    }
]