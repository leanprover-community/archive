[
    {
        "content": "<p>Say I have formulate some hypothesis and start working on a proof. After a number of tactics applied I reach to <code>h: x</code> and <code>goal : \\not x</code>. This means the goal is not provable, but what do I know about the original hypothesis?</p>\n<p>It seems to me that it depends on the transformations I did. If I only did rw, the hypothesis was false, but there other transformations that I could have done that led me to this state while the hypothesis was still correct. Some examples are apply or left/right. </p>\n<p>Am I correct in this reasoning? Can Lean keep track of these for me automatically?</p>\n<p>For a brief second I thought that's what the <code>!</code> some tactics have is about, but now I don't know what <code>!</code> means.</p>",
        "id": 530968865,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753546869
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"488971\">Rado Kirov</span> <a href=\"#narrow/channel/113489-new-members/topic/tracking.20reversible.20vs.20non-reversible.20tactics/near/530968865\">said</a>:</p>\n<blockquote>\n<p>This means the goal is not provable</p>\n</blockquote>\n<p>That's not necessarily the case, since there still might be a contradiction among the hypotheses. If you do <code>intro h'</code> then you'll get <code>h h' : x</code> and <code>goal : False</code>. If that's <em>all</em> you have as hypotheses, then sure, it's not provable, assuming <code>x</code> itself doesn't imply false.</p>",
        "id": 530970246,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753547514
    },
    {
        "content": "<p><code>!</code> doesn't have a specific meaning. It depends on the tactic. I can't think of any tactics where the meaning has to do with reversibility.</p>",
        "id": 530970338,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753547562
    },
    {
        "content": "<blockquote>\n<p>That's not necessarily the case, since there still might be a contradiction among the hypotheses.</p>\n</blockquote>\n<p>True, but that still means that either 1) at some point in my tactics I have introduced that or 2) it was present in the original hypotheses at the beginning of the proof. Certain tactics like <code>rw</code>, <code>dsimp</code>, <code>unfold</code> can be reversed so they cannot introduce a new contradiction thus if I only use those I know I am in case 2).</p>",
        "id": 530970788,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753547777
    },
    {
        "content": "<p>I used only <code>rw</code> here, does that mean that this goal is unprovable now?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foo</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  p : Prop</span>\n<span class=\"cm\">  h : p</span>\n<span class=\"cm\">  h' : ¬p</span>\n<span class=\"cm\">  ⊢ ¬p</span>\n<span class=\"cm\">  -/</span>\n</code></pre></div>",
        "id": 530971140,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753547966
    },
    {
        "content": "<p>By the way, <code>rw</code> isn't necessarily reversible, since it allows conditional rewrites:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">weird_rfl</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Sort</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">weird_rfl</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ⊢ False</span>\n</code></pre></div>",
        "id": 530971518,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753548158
    },
    {
        "content": "<p>To your first point, that's a great example. I was wrong in saying <code>This means the goal is not provable</code>.</p>\n<p>But I think my meta-statement can be corrected as - If you use only reversible tactics and reach a contradiction between proof state and goal it implies there was a contradiction in the original hypotheses and original goal.</p>\n<p>You have shown that \"contradiction between proof state and goal\" doesn't equal \"able to proof goal\" (due to possible contradiction in hypotheses).</p>\n<p>Your second point is more indeed damning, even <code>rw</code> can be non-reversible. Maybe there are so few reversible tactics for this to be useful.</p>",
        "id": 530973794,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753549228
    },
    {
        "content": "<p>Yeah, <code>simp</code> is the actual <em>real</em> reversible one</p>",
        "id": 530973869,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753549264
    },
    {
        "content": "<p>Or is it?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">error: unsolved goals</span>\n<span class=\"sd\">α✝ : Sort u_1</span>\n<span class=\"sd\">a b : α✝</span>\n<span class=\"sd\">h' : a ≠ b</span>\n<span class=\"sd\">h : True</span>\n<span class=\"sd\">⊢ False</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 530973986,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1753549305
    },
    {
        "content": "<p>Maybe I should explain more on how this can be useful.</p>\n<p>I am doing some exercises from <a href=\"https://github.com/teorth/analysis\">https://github.com/teorth/analysis</a>. I start with a theorem statement written by Tao and proceed towards a proof by applying tactics. Sometimes I arrive at an obvious contradiction between some proved prop and the goal (obvious meaning if the goal was an assumption <code>contradiction</code> will close any goal). What could have happened (from most to least likely):</p>\n<ol>\n<li>I applied a tactic that took \"a wrong turn\" in the expected proof.</li>\n<li>\n<p>There was a typo in the original statement  (less likely but it does happen). Technically it could of two flavors<br>\n  a) the contradiction was present (but not obvious, i.e. <code>contradiction</code> tactic won't solve it) in the original hypotheses and goal combined.</p>\n<p>b) the contradiction was present purely in the hypothesis, so all my tactics are suspect. This is even less likely than a) but technically possible.</p>\n</li>\n</ol>\n<p>Since 1) is much more likely than 2), what I do next is go over each line in my proof and look for tactics like <code>apply</code>, <code>left/right</code>, which can lead me to \"take a wrong turn\". Meanwhile, <code>intro</code>, <code>simp</code>, <code>dsimp</code> and <code>rw</code> are much less likely to lead me astray (although as you show above they could). If I can't find any suspicious tactics, I start looking for typos in the original statement.</p>\n<p>This heuristic works alright for me so far, and I am wondering it could be \"meta-formalized\" and automated by Lean itself.</p>",
        "id": 530990191,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753557340
    },
    {
        "content": "<p>I'm sure someone could make something that tries to point out \"wrong turns\" with respect to a given point in a proof.</p>",
        "id": 531001220,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753562716
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"488971\">@Rado Kirov</span> I think such hints would be extremely helpful for newcomers, for whom the distinction between \"(most likely) reversible\" and \"(most likely) non-reversible\" tactic use is not obvious. I know they certainly would have helped me in the past.</p>",
        "id": 531189968,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1753641114
    }
]