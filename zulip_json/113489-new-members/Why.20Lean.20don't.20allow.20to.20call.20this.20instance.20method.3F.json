[
    {
        "content": "<p>The following code works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">   </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"bar\"</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">callBar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\">  </span><span class=\"c1\">--Works!</span>\n</code></pre></div>\n<p>Nevertheless, if I add an extra type to <code>Bar</code> class, I no longer can call <code>callBar</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"c1\">-- &lt;- Add β here</span>\n<span class=\"w\">    </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\">  </span><span class=\"c1\">-- We implement for the case of Unit</span>\n<span class=\"w\">   </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"bar\"</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">callBar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"bp\">.</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\">  </span><span class=\"c1\">--No longer works</span>\n</code></pre></div>\n<p>Nevertheless, by my understanding the compiler should know that <code>Foo</code> implements <code>Bar</code>, and <code>β</code> is implemented using <code>Unit</code>, so it should find the correct instance and let me call <code>bar</code> (?)</p>",
        "id": 453805889,
        "sender_full_name": "Luis Enrique Muñoz Martín",
        "timestamp": 1721858892
    },
    {
        "content": "<p>The reason is that typeclass inference is not willing to decide to solve for class parameters from the others unless you mark them as <code>outParam</code>. If you mark it as <code>outParam</code>, then you are promising that the rest of the non-<code>outParam</code> class parameters determine this one.</p>",
        "id": 453814755,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721863884
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">outParam</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">   </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"bar\"</span>\n</code></pre></div>",
        "id": 453814790,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721863915
    },
    {
        "content": "<p>Just to the point, thanks <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span></p>",
        "id": 453924573,
        "sender_full_name": "Luis Enrique Muñoz Martín",
        "timestamp": 1721907501
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> : Is there a discussion of outParams in any of the basic books? There are lots of these small features which could do with a tutorial but only experts and maintainers seem to know about them</p>",
        "id": 453929433,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1721909234
    },
    {
        "content": "<p>I read about this in the <strong>Functional Programming in Lean</strong> book, but I was not able to recognize the situation later when I was in front of it: <a href=\"https://lean-lang.org/functional_programming_in_lean/type-classes/out-params.html?highlight=outParam#output-parameters\">https://lean-lang.org/functional_programming_in_lean/type-classes/out-params.html?highlight=outParam#output-parameters</a></p>",
        "id": 453931976,
        "sender_full_name": "Luis Enrique Muñoz Martín",
        "timestamp": 1721910044
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"466334\">@Shreyas Srinivas</span> Not what you're asking, but the reference manual has a mention: <a href=\"https://lean-lang.org/lean4/doc/typeclass.html?highlight=outparam#output-parameters\">https://lean-lang.org/lean4/doc/typeclass.html?highlight=outparam#output-parameters</a></p>",
        "id": 454009268,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1721928672
    }
]