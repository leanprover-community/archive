[
    {
        "content": "<p>I was reading <code>Mathlib.Probability.Distributions.Gaussian</code> and found the following strange lemma <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ProbabilityTheory.gaussianPDFReal_zero_var#doc\">docs#ProbabilityTheory.gaussianPDFReal_zero_var</a>. I thought that the pdf is not well defined if <code>v = 0</code>, but here's the lemma. I started looking at how it's proved and here's what I discovered.</p>\n<p>First, I wanted to know how <code>simp</code> solves this goal, so I changed the proof to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">gaussianPDFReal_zero_var</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">gaussianPDFReal</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext1</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">gaussianPDFReal</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Lean gave the following output:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">gaussianPDFReal</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NNReal</span><span class=\"bp\">.</span><span class=\"n\">coe_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">div_zero</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">exp_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Pi</span><span class=\"bp\">.</span><span class=\"n\">zero_apply</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Looking through these lemmas, I found that <code>div_zero</code> is responsible for this result. It reads:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G₀</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">3119</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">GroupWithZero</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G₀</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>This lemma doesn't seem to be applicable here... If I remove it from the list for <code>simp only</code>, the goal state becomes</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">rexp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>This is either false (in the literal sense), or requires some limiting argument, but definitely not <code>div_zero</code> lemma.</p>",
        "id": 463212096,
        "sender_full_name": "jsodd",
        "timestamp": 1724003760
    },
    {
        "content": "<p>Read <a href=\"https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/\">Division by zero in type theory: a FAQ</a></p>",
        "id": 463212546,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1724003880
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113489-new-members/topic/Division.20by.20zero.20in.20gaussianPDFReal_zero_var/near/463212546\">said</a>:</p>\n<blockquote>\n<p>Read <a href=\"https://xenaproject.wordpress.com/2020/07/05/division-by-zero-in-type-theory-a-faq/\">Division by zero in type theory: a FAQ</a></p>\n</blockquote>\n<p>It makes sense now, thanks for the link.</p>",
        "id": 463223591,
        "sender_full_name": "jsodd",
        "timestamp": 1724007929
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"743246\">jsodd</span> has marked this topic as resolved.</p>",
        "id": 463223682,
        "sender_full_name": "Notification Bot",
        "timestamp": 1724007953
    },
    {
        "content": "<p>Nevertheless, simping with <code>div_zero, Real.exp_zero, mul_one</code> is quite roundabout, if <code>zero_mul</code> also works (-;</p>",
        "id": 463315352,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1724048288
    },
    {
        "content": "<p>I wonder how would unbounded operators work if we insist on defining functions everywhere... As far as I know, they're not yet in Mathlib, but how should they be implemented then? As partial functions or as structures?</p>",
        "id": 463391186,
        "sender_full_name": "jsodd",
        "timestamp": 1724071125
    }
]