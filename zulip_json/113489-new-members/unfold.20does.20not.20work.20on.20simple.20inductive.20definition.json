[
    {
        "content": "<p>Here is a simplified version of an inductive construction that I'm trying to do. I want to prove some simple properties about this definition, but Lean does not want to simplify certain expressions, and does not want to unfold.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Notation</span>\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">An</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"c1\">-- removing this line solves the problem</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">simple_lemma</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">        </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">A</span>\n<span class=\"w\">        </span><span class=\"c1\">-- tactic 'unfold' failed to unfold 'A' at</span>\n<span class=\"w\">        </span><span class=\"c1\">-- (A (n + 1)).snd= sorryAx (Type u_1)</span>\n</code></pre></div>\n<p>Is there a reason why Lean does not want to do this, and is there a simple solution? I cannot really use a simpler inductive construction.</p>",
        "id": 478754038,
        "sender_full_name": "Gabin Kolly",
        "timestamp": 1729786608
    },
    {
        "content": "<p>It seems to be that <code>Sigma.snd</code> making it impossible to rewrite. You can check by trying to use <code>conv</code> to navigate into that argument. Roughly speaking, if <code>conv</code> can't navigate there, neither can <code>simp</code> or <code>unfold</code>.</p>\n<p>Removing the <code>let</code> looks like it solves the problem, but all that's doing is making the definition non-recursive. That means the lemma <code>A.eq_def</code> (which <code>unfold</code> uses) is now a definitional equality. The <code>simp</code> and <code>unfold</code> tactics can rewrite the argument to <code>Sigma.snd</code> when this is a definitional equality.</p>",
        "id": 478758764,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729788245
    },
    {
        "content": "<p>Can you make a more representative mwe? There are probably ways around this, but it depends on more details.</p>",
        "id": 478758815,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729788266
    },
    {
        "content": "<p>Actually, maybe <code>rw [A]</code> is sufficient?</p>",
        "id": 478759133,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729788391
    },
    {
        "content": "<p>Yes, and that also works in the real version! Thank you!</p>",
        "id": 478759415,
        "sender_full_name": "Gabin Kolly",
        "timestamp": 1729788506
    }
]