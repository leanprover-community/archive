[
    {
        "content": "<p>Suppose I have a tactic <code>tac</code> that generates 3 subgoals, and I know the tactics that solve the 2nd and/or 3rd ones, is there an easy way to solve these goals without a verbose <code>cases</code> or needing lots of indentation? In Rocq, I can say <code>tac; [ | tac1 | tac2]</code>; this applies <code>tac1</code> to the second subgoal generated by <code>tac</code> and <code>tac2</code> to the third one. For a 2-subgoal example, see the following</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">DecidableEq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkFooDefault</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"s2\">\"0\"</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">mkFooDefault</span><span class=\"w\"> </span><span class=\"s2\">\"0\"</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">b1</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">b2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I would like to be able to give the <code>rfl</code> that closes the generated subgoal from <code>if_pos</code> without needing <code>cases</code>, nesting, etc. Is there a way to do this in general (not just for this specific example)? Thanks</p>",
        "id": 557978979,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1763482093
    },
    {
        "content": "<p>I would also like something more exact than just e.g. <code>tac &lt;;&gt; try tac1 &lt;;&gt; try tac2</code>, since these tactics might be slow to run over every subgoal.</p>",
        "id": 557979485,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1763482200
    },
    {
        "content": "<p><code>tac_that_yields_3_subgoals &lt;;&gt; [tac1; tac2; tac3]</code> is the 'tacticy' way to do it<br>\nso in your case, <code>rw [if_pos] &lt;;&gt; [skip; rfl]</code>.</p>\n<p>Of course, there's a preference for using arguments here, so for example <code>rw [if_pos (show _ by rfl)]</code>.</p>",
        "id": 557980424,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1763482399
    },
    {
        "content": "<p>Thanks, I was not aware of that syntax. To make sure I understand correctly, in <code>&lt;;&gt; [tac1; tac2; tac3]</code> <code>tac1</code> is run on the first subgoal, <code>tac2</code> on the second, and <code>tac3</code> on the third? Or only if each tactic solves the corresponding goal?</p>",
        "id": 557981264,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1763482580
    },
    {
        "content": "<p><code>tac&lt;k&gt;</code> is applied to the <code>k</code>th subgoal, there is no obligation to close the goal.</p>\n<p>I'll emphasize that this is not particularly common to see in Lean, you'll normally see people structure their proofs with using arguments, <code>\\centerdot</code>s, <code>case</code>s, <code>refine ?p</code> -&gt; <code>case p</code>s, etc.</p>\n<p>Relying on order of subgoals normally makes things less readable.</p>",
        "id": 557982244,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1763482761
    },
    {
        "content": "<p>Thank you. Is there an idiomatic Lean way to close a single auxiliary subgoal generated by a <code>rewrite</code>, <code>apply</code>, etc? Repeated use of <code>cases</code> or <code>\\centerdots</code> could end up with a proof with many layers of indentation and cases even though the \"interesting part\" might only be in one of those cases.</p>",
        "id": 557983925,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1763483070
    },
    {
        "content": "<p>I agree you normally want 'linear' proofs that focus on the interesting parts of the argument.</p>\n<p>The idiomatic way is to use arguments as alluded to above - <code>rw [if_pos h]</code> where <code>h</code> is a proof that your condition holds. Maybe you already have <code>h</code>, maybe you <code>have h : condition := ...</code>, maybe it's short and you <code>rw [if_pos (show condition from ...)]</code>; many ways to start skinning the <span aria-label=\"cat\" class=\"emoji emoji-1f408\" role=\"img\" title=\"cat\">:cat:</span> . Maybe you <code>rw [if_pos (by tac)]</code> where <code>tac</code> is some automation that can do the trick, like <code>grind</code>.</p>",
        "id": 557984641,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1763483250
    },
    {
        "content": "<p>Also, you can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span>\n<span class=\"bp\">췅</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"bp\">췅</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"n\">rest</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">argument</span>\n</code></pre></div>\n<p>or like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">h2</span>\n<span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">side</span><span class=\"w\"> </span><span class=\"n\">goal</span>\n<span class=\"n\">rest</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">argument</span>\n</code></pre></div>",
        "id": 557987957,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1763484043
    },
    {
        "content": "<p>Is there a way to select a subgoal other than the first? (If there is one, it doesn't seem to be very idiomatic, as I don't remember reading about it in the various online Lean books I've read)</p>\n<p>In Rocq, you can do something like <code>2 : &lt;tac&gt;</code> (hope I'm right about the syntax) to apply a tactic to, say, the second subgoal; something that can be used to close a simple subgoal here and there instead of waiting for the end of what could be a long first goal - as an alternative to using some form of indentation.</p>",
        "id": 558024954,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1763494014
    },
    {
        "content": "<p>You can <code>rotate_right</code> (and left) to move them around, <code>swap</code> them (that's really just rotate by one), or you can choose them with <code>case &lt;name&gt;</code>. There's also <code>case' &lt;name&gt; =&gt; tac</code> that lets you apply <code>tac</code> to the chosen goal without enforcing its closure. I am not sure there's a way to refer to them by their index in the order displayed in the infoview, but it's a trivial bit of metaprogramming. Admittedly I'd discourage this style.</p>",
        "id": 558025744,
        "sender_full_name": "Franti코ek Silv치코i 游불",
        "timestamp": 1763494285
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"726077\">Philippe Duchon</span> <a href=\"#narrow/channel/113489-new-members/topic/Succinct.20way.20to.20discharge.20subgoals/near/558024954\">said</a>:</p>\n<blockquote>\n<p>Is there a way to select a subgoal other than the first? (If there is one, it doesn't seem to be very idiomatic, as I don't remember reading about it in the various online Lean books I've read)</p>\n<p>In Rocq, you can do something like <code>2 : &lt;tac&gt;</code> (hope I'm right about the syntax) to apply a tactic to, say, the second subgoal; something that can be used to close a simple subgoal here and there instead of waiting for the end of what could be a long first goal - as an alternative to using some form of indentation.</p>\n</blockquote>\n<p>I think you can do <code>pick_goal 2</code> in lean which has a similar effect.</p>",
        "id": 558147864,
        "sender_full_name": "Wang Jingting",
        "timestamp": 1763543435
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"364929\">Franti코ek Silv치코i 游불</span> <a href=\"#narrow/channel/113489-new-members/topic/Succinct.20way.20to.20discharge.20subgoals/near/557980424\">said</a>:</p>\n<blockquote>\n<p><code>tac_that_yields_3_subgoals &lt;;&gt; [tac1; tac2; tac3]</code> is the 'tacticy' way to do it<br>\nso in your case, <code>rw [if_pos] &lt;;&gt; [skip; rfl]</code>.</p>\n</blockquote>\n<p>This syntax didn't work for me for some reason, I get error \"unexpected token '['; expected tactic\" after the <code>&lt;;&gt;</code>. And I am trying to use this in a tactic macro, so I cannot use explicit<code>case</code>s.</p>\n<p>Alternatively, is there a better way to write a tactic macro of the form:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tac1</span>\n<span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">case1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">tac2</span>\n<span class=\"n\">case</span><span class=\"w\"> </span><span class=\"n\">case2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">tac3</span>\n</code></pre></div>",
        "id": 560036491,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1764025660
    }
]