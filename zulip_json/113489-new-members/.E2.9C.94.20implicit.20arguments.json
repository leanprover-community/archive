[
    {
        "content": "<p>I would like to use the lemma <code>continuous_linear_map.has_fderiv_within_at</code> (<a href=\"https://leanprover-community.github.io/mathlib_docs/analysis/calculus/fderiv.html#continuous_linear_map.has_fderiv_within_at\">docs</a>), which takes 5 implicit arguments, 5 type annotations, and one explicit argument.  I would also like to explicitly provide one of the implicit arguments (<code>x</code> in the docs).</p>\n<p>I gather that <code>@</code> is used to make implicit arguments explicit, although I am not familiar with the syntax.  Is there a way of using it which makes explicit only the one implicit argument I need, and not all the others?</p>",
        "id": 201430351,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1592594452
    },
    {
        "content": "<p>nope...</p>",
        "id": 201430368,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592594471
    },
    {
        "content": "<p>There's <code>@@</code> which does something I've forgotten (but it will say in TPIL). It's vanishingly unlikely that it will solve your problem. I've heard that in other languages you can do things like <code>@@@f {thing_i_want_to_specify := this} ...</code> but not in Lean</p>",
        "id": 201430552,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592594552
    },
    {
        "content": "<p>Not in Lean 3, but in Lean 4 yes I believe.</p>",
        "id": 201430615,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1592594584
    },
    {
        "content": "<p>OK, so it will be messy.  What is the syntax exactly?  I cannot see how to provide the type annotations.</p>",
        "id": 201430673,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1592594623
    },
    {
        "content": "<p>Sebastien, you wrote this lemma <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span>  Is it easy to explain why <code>x</code> is implicit?</p>",
        "id": 201430752,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1592594668
    },
    {
        "content": "<p>Just underscores everywhere, and it will infer the types and instances from the <code>linear_map</code> you gave it</p>",
        "id": 201430910,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592594789
    },
    {
        "content": "<p>That's the standard style in the topology/analysis part of the library, initiated by Johannes Hölzl. The idea is that you will use it as</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">has_fderiv_at_within_at</span> <span class=\"o\">(</span><span class=\"n\">complicated</span> <span class=\"n\">expression</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">complicated</span> <span class=\"n\">expression</span> <span class=\"n\">again</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"n\">thing</span> <span class=\"n\">built</span> <span class=\"kn\">using</span> <span class=\"n\">the</span> <span class=\"n\">lemmas</span><span class=\"o\">,</span> <span class=\"n\">where</span> <span class=\"n\">x</span> <span class=\"n\">can</span> <span class=\"n\">be</span> <span class=\"n\">inferred</span> <span class=\"k\">from</span> <span class=\"n\">the</span> <span class=\"n\">goal</span>\n</code></pre></div>\n\n\n<p>95% of the time, it is super-efficient. 5% of the time, you need the <code>@</code>-version and underscores.</p>",
        "id": 201431090,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1592594896
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> thank you, that's much better than I feared!</p>",
        "id": 201431313,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1592595036
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110050\">@Sebastien Gouezel</span> I think I understand, the point is that only the definitions (eg <code>has_fderiv_within_at</code>), not the lemmas, include <code>x</code> explicitly?</p>",
        "id": 201431501,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1592595140
    },
    {
        "content": "<p>Yes, precisely.</p>",
        "id": 201432120,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1592595562
    },
    {
        "content": "<p>Oh sorry Heather! Yes, it's just lots of underscores. I thought you were asking if they could be avoided. Search mathlib for <code>_ _ _ _</code> to see plenty of examples of this :-) I think the last time I looked the record was about 8</p>",
        "id": 201432576,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592595861
    },
    {
        "content": "<p>somehow this reminds me of <a href=\"https://github.com/torvalds/linux/blob/v5.4/include/linux/rcupdate.h#L310\">https://github.com/torvalds/linux/blob/v5.4/include/linux/rcupdate.h#L310</a></p>",
        "id": 201433104,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592596152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/Implicit.20arguments/near/201432576\">said</a>:</p>\n<blockquote>\n<p>Oh sorry Heather! Yes, it's just lots of underscores. I thought you were asking if they could be avoided. Search mathlib for <code>_ _ _ _</code> to see plenty of examples of this :-) I think the last time I looked the record was about 8</p>\n</blockquote>\n<p>No, 11 :)</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">is_add_group_hom_map</span>\n  <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_add_group_hom</span> <span class=\"n\">f</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">hf</span> <span class=\"o\">:</span> <span class=\"n\">continuous</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">is_add_group_hom</span> <span class=\"o\">(</span><span class=\"n\">completion</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">is_add_group_hom_extension</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">is_add_group_hom</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">)</span>\n  <span class=\"o\">((</span><span class=\"n\">continuous_coe</span> <span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">hf</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 201433475,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1592596387
    },
    {
        "content": "<p>woohoo -- we beat Linux!</p>",
        "id": 201433614,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592596478
    },
    {
        "content": "<p>What is the difference between implicit arguments in <code>{}</code> vs implicit arguments in <code>{{}}</code> in Lean 4?</p>",
        "id": 252100405,
        "sender_full_name": "Adrian",
        "timestamp": 1630874268
    },
    {
        "content": "<p>Presumably it's the same as in Lean 3 (assuming they exist in Lean 4)? What's going on in Lean 3 is documented in section 6.5 of <a href=\"https://leanprover.github.io/theorem_proving_in_lean/\">#tpil</a> (it's to do with how eagerly they're evaluated).</p>",
        "id": 252102372,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1630876510
    },
    {
        "content": "<p>Oh I missed that, thanks.</p>",
        "id": 252102576,
        "sender_full_name": "Adrian",
        "timestamp": 1630876796
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"434566\">Adrian</span> has marked this topic as resolved.</p>",
        "id": 252102581,
        "sender_full_name": "Notification Bot",
        "timestamp": 1630876800
    },
    {
        "content": "<p>Oh -- I just remembered that TPIL got ported to Lean 4: </p>\n<p><a href=\"https://leanprover.github.io/theorem_proving_in_lean4/interacting_with_lean.html#more-on-implicit-arguments\">https://leanprover.github.io/theorem_proving_in_lean4/interacting_with_lean.html#more-on-implicit-arguments</a></p>\n<p>confirms what we expected.</p>",
        "id": 252102629,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1630876821
    },
    {
        "content": "<p>Can one ask lean to show the choices it has made for implicit arguments?</p>",
        "id": 267790093,
        "sender_full_name": "Jeremy Teitelbaum",
        "timestamp": 1642023729
    },
    {
        "content": "<p>Click on the stuff in the infoview!</p>",
        "id": 267790632,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1642023986
    },
    {
        "content": "<p>Or maybe you want to see how a goal was closed?</p>",
        "id": 267791023,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1642024182
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113489-new-members/topic/implicit.20arguments/near/267790632\">said</a>:</p>\n<blockquote>\n<p>Click on the stuff in the infoview!</p>\n</blockquote>\n<p>If you have theorem blah {implicits} (explicits) : (conclusion) := function....<br>\ncan you extract the implicit assignments?</p>",
        "id": 267791121,
        "sender_full_name": "Jeremy Teitelbaum",
        "timestamp": 1642024214
    },
    {
        "content": "<p>What do you mean \"extract\"? Just get to know them?</p>",
        "id": 267791245,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1642024301
    },
    {
        "content": "<p>You can always use <code>show_term</code></p>",
        "id": 267791295,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1642024322
    },
    {
        "content": "<p>When I want to know Lean's final decision on what's implicit and what's explicit, I use <code>#print blah</code></p>",
        "id": 267791513,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1642024436
    },
    {
        "content": "<p>Here's what I'm trying to understand.  In the proof that equality is symmetric, we have this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[elab_as_eliminator, subst]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">eq.subst</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Sort</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">P</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">P</span> <span class=\"n\">b</span> <span class=\"o\">:=</span>\n<span class=\"n\">eq.rec</span> <span class=\"n\">h₂</span> <span class=\"n\">h₁</span>\n\n<span class=\"kd\">infixr</span> <span class=\"bp\">`</span> <span class=\"bp\">▸</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">75</span> <span class=\"o\">:=</span> <span class=\"n\">eq.subst</span>\n\n<span class=\"kd\">@[trans]</span> <span class=\"kd\">lemma</span> <span class=\"n\">eq.trans</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Sort</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"n\">h₂</span> <span class=\"bp\">▸</span> <span class=\"n\">h₁</span>\n\n<span class=\"kd\">@[symm]</span> <span class=\"kd\">lemma</span> <span class=\"n\">eq.symm</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Sort</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"n\">h</span> <span class=\"bp\">▸</span> <span class=\"n\">rfl</span>\n</code></pre></div>\n<p>The predicate P is an implicit argument to the subst lemma. It's not given explicitly in the proofs of trans and symm. What, exactly,<br>\nhas it inferred for P?</p>",
        "id": 267792037,
        "sender_full_name": "Jeremy Teitelbaum",
        "timestamp": 1642024695
    },
    {
        "content": "<p>In <code>eq.trans</code> it's calling <code>eq.subst h₂ h₁</code>. So <code>h2</code> and <code>h1</code> are the explicit arguments. It gets a bit confusing because <code>h1</code> and <code>h2</code> get interchanged on that call of <code>eq.subst</code></p>",
        "id": 267792871,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1642025146
    },
    {
        "content": "<p>But to call eq.subst it needs to infer the predicate P, and that’s what is like to understand.</p>",
        "id": 267793274,
        "sender_full_name": "Jeremy Teitelbaum",
        "timestamp": 1642025354
    },
    {
        "content": "<p>You can use</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span> <span class=\"n\">pp.implicit</span> <span class=\"n\">true</span>\n<span class=\"kd\">set_option</span> <span class=\"n\">pp.notation</span> <span class=\"n\">false</span>\n<span class=\"k\">#print</span> <span class=\"n\">eq.symm</span>\n<span class=\"c1\">--- which returns</span>\n<span class=\"kd\">@[symm]</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">eq.symm'</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Sort</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">},</span> <span class=\"bp\">@</span><span class=\"n\">eq</span> <span class=\"n\">α</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"bp\">@</span><span class=\"n\">eq</span> <span class=\"n\">α</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Sort</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">@</span><span class=\"n\">eq</span> <span class=\"n\">α</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"n\">h.subst</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">rfl</span> <span class=\"n\">α</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 267793563,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1642025510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"462625\">Jeremy Teitelbaum</span> has marked this topic as resolved.</p>",
        "id": 267856235,
        "sender_full_name": "Notification Bot",
        "timestamp": 1642073576
    }
]