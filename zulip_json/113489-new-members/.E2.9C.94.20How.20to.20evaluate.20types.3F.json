[
    {
        "content": "<p>Lean lets you treat types as values, which means you can write functions that compute types. But Lean won't let me <code>#eval</code> functions that return types because <code>cannot evaluate, types are not computationally relevant</code>. But if you can compute types then I do want to be able to actually compute them. This feels like an arbitrary restriction, and makes writing type-level code really opaque and hard to debug. Is there a way to do this?</p>\n<p>Here's an example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MyListTypeCtor</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MakeContentType</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">str?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">str?</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MyList</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">MyListTypeCtor</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MakeContentType</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myListVal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyList</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"\"</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- this works because Lean knows that MyList = List String</span>\n\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">MyList</span><span class=\"w\">     </span><span class=\"c1\">-- MyList : Type</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">MyList</span><span class=\"w\">      </span><span class=\"c1\">-- Error: cannot evaluate, types are not computationally relevant</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">myListVal</span><span class=\"w\">  </span><span class=\"c1\">-- myListVal : MyList</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">MyList</span><span class=\"w\">    </span><span class=\"c1\">-- MyList</span>\n</code></pre></div>\n<p>None of these are helpful. I really want to just evaluate the type so I can see that <code>MyList = List String</code>. This particular piece of code is pretty easy to work out in your head, and if you know exactly what to expect you can write a theorem to verify it <code>theorem MyListIsListString : MyList = List String := by rfl</code> but is there no way to get <em>Lean</em> to compute the type on your behalf? Since it knows how to assign <code>[\"\"]</code> it must be computing the type somewhere, so why can't I see the result of that computation?</p>",
        "id": 493100840,
        "sender_full_name": "aron",
        "timestamp": 1736605787
    },
    {
        "content": "<p>ah looks like <code>#reduce (types := true) MyList</code> does it!!<br>\n<a href=\"/user_uploads/3121/GPZL7NinNVH9yuzliygkMmVw/Screenshot-2025-01-11-at-15.45.29.png\">Screenshot 2025-01-11 at 15.45.29.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GPZL7NinNVH9yuzliygkMmVw/Screenshot-2025-01-11-at-15.45.29.png\" title=\"Screenshot 2025-01-11 at 15.45.29.png\"><img data-original-dimensions=\"982x298\" src=\"/user_uploads/thumbnail/3121/GPZL7NinNVH9yuzliygkMmVw/Screenshot-2025-01-11-at-15.45.29.png/840x560.webp\"></a></div>",
        "id": 493106731,
        "sender_full_name": "aron",
        "timestamp": 1736611088
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> has marked this topic as resolved.</p>",
        "id": 493106758,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736611117
    }
]