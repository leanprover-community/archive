[
    {
        "content": "<p>I thought that if I did the following steps, it would not take forever for Lean to process a source file containing <code>import Mathlib</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">curl</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw</span><span class=\"bp\">.</span><span class=\"n\">githubusercontent</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"n\">toolchain</span>\n</code></pre></div>\n<p>Add</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">    </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span>\n</code></pre></div>\n<p>to lakefile.lean.</p>\n<p>Run <code>lake update</code> and then <code>lake exe cache get</code>.  </p>\n<p>However, it still takes what seems to be infinite time to process the source file.  What am I missing?  This is a new project that I created with <code>lake init</code> a few days ago.    I also tried running <code>elan update</code> followed by <code>lake update</code> and <code>lake exe cache get</code> again.</p>\n<p>I apologize if I've asked similar questions before, a while ago.  I am confused.</p>\n<p>In case it's relevant, running <code>lake exe cache get</code> again produces:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">download</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Downloaded</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">attempted</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">success</span><span class=\"o\">)</span>\n<span class=\"n\">Warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">were</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"bp\">.</span>\n<span class=\"n\">This</span><span class=\"w\"> </span><span class=\"n\">usually</span><span class=\"w\"> </span><span class=\"n\">means</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"n\">checkout</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">diverged</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">upstream</span><span class=\"bp\">.</span>\n<span class=\"n\">If</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">commits</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">mathlib4</span><span class=\"w\"> </span><span class=\"n\">repository</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CI</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">oleans</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">they</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"w\"> </span><span class=\"n\">later</span><span class=\"bp\">.</span>\n<span class=\"n\">Decompressing</span><span class=\"w\"> </span><span class=\"mi\">5726</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">Unpacked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">2044</span><span class=\"w\"> </span><span class=\"n\">ms</span>\n<span class=\"n\">Completed</span><span class=\"w\"> </span><span class=\"n\">successfully!</span>\n</code></pre></div>\n<p>What does that mean?  How has my local checkout of mathlib diverged?  Didn't I just check it out?  I'm not going to push to mathlib!  I don't contribute to it.</p>\n<p>These are not new problems, but when I encountered them earlier, I gave up after I realized that I didn't need Mathlib.  I had tied myself in knots about other issues at that point, but I have avoided those issues, I think.</p>\n<p>(Actually, first I tried importing <code>Mathlib.Logic.Function</code> or <code>Mathlib.Logic</code> or <code>Mathlib.Nat</code> to get <code>Nat.iterate</code>, but Lean complained that those files didn't exist.  If I only need a single function from Mathlib, do I have to import the whole thing?)</p>",
        "id": 488182401,
        "sender_full_name": "mars0i",
        "timestamp": 1733949038
    },
    {
        "content": "<p>That error from the cache does seem like the root issue</p>",
        "id": 488184412,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733949703
    },
    {
        "content": "<p>What does your lakefile look like?</p>",
        "id": 488184429,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733949710
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"s2\">\"ChaosLean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.1.0\"</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">ChaosLean</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">proofwidgets</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/ProofWidgets4\"</span><span class=\"bp\">@</span><span class=\"s2\">\"v0.0.46\"</span>\n<span class=\"w\">  </span><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">    </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span>\n<span class=\"w\">  </span><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">batteries</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">    </span><span class=\"s2\">\"https://github.com/leanprover-community/batteries\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"s2\">\"chaoslean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>",
        "id": 488517327,
        "sender_full_name": "mars0i",
        "timestamp": 1733957845
    },
    {
        "content": "<p>Just require mathlib, it automatically pulls in compatible versions of proofwidgets and batteries. If you require them separately, you run the risk of mismatches.</p>",
        "id": 488653799,
        "sender_full_name": "Mauricio Collares",
        "timestamp": 1734015954
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"325367\">@Mauricio Collares</span> (and <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span>)!  That fixed it.  I didn't know that requiring mathlib automatically pulled in Batteries and Proofwidgets.</p>",
        "id": 488658889,
        "sender_full_name": "mars0i",
        "timestamp": 1734017284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"617444\">mars0i</span> has marked this topic as resolved.</p>",
        "id": 488663821,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734018519
    }
]