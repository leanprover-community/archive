[
    {
        "content": "<p>The definition for <code>LawfulFunctor</code> is <code>class LawfulFunctor (f : Type u → Type v)  [Functor f] : Prop</code>. In both <em>Theorem Proving in Lean 4</em> and <em>Functional Programming in Lean</em>, I haven't seen a class declaration with a <code>: Prop</code>. Trying to understand what this could mean, I cooked up the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">addProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">mulProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"w\"> </span><span class=\"c1\">-- Stuff : Prop</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Stuff'</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">addProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">mulProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Stuff'</span><span class=\"w\"> </span><span class=\"c1\">-- Stuff' : Type</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">someStuff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">someStuff'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stuff'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Stuff'</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">someStuff</span><span class=\"w\"> </span><span class=\"c1\">-- someStuff : Stuff</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">someStuff'</span><span class=\"w\"> </span><span class=\"c1\">-- someStuff' : Stuff'</span>\n</code></pre></div>\n<p>From the info I gathered, I couldn't really figure out when one would want to define a structure or a class to be a <code>Prop</code>. Insights or pointers greatly appreciated.</p>",
        "id": 479549741,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230153
    },
    {
        "content": "<p>If each field is a proof, then the <code>structure</code> is essentially a conjunction, and generally you want it to be a <code>Prop</code>. In the next release of Lean, this will be the default.</p>",
        "id": 479550097,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230301
    },
    {
        "content": "<p>So in the next release, <code>Stuff'</code> will be automatically a <code>Prop</code>?</p>",
        "id": 479550272,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230364
    },
    {
        "content": "<p>Yes</p>",
        "id": 479550377,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230405
    },
    {
        "content": "<p>Here's what it means that it's a <code>Prop</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Stuff_iff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">ha</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hm</span><span class=\"bp\">⟩</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">ha</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hm</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 479550394,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230416
    },
    {
        "content": "<p>It \"is\" a conjunction, and you can use it wherever the conjunction would appear. It's nicer than a conjunction since each field has a nice name.</p>",
        "id": 479550496,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230456
    },
    {
        "content": "<p>With <code>Stuff'</code>, you can only use it as a proposition if you write something like <code>Nonempty Stuff'</code></p>",
        "id": 479550531,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230481
    },
    {
        "content": "<p>Now I am a bit confused. What is <code>someStuff</code> then?</p>",
        "id": 479550537,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230485
    },
    {
        "content": "<p><code>someStuff</code> is of type <code>Stuff</code>, but it itself is not a <code>Prop</code>.</p>",
        "id": 479550587,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230516
    },
    {
        "content": "<p><code>someStuff</code> is a proof of <code>Stuff</code></p>",
        "id": 479550630,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230536
    },
    {
        "content": "<p>Does that mean <code>someStuff</code> is a proof of <code>Stuff</code>?</p>",
        "id": 479550633,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230537
    },
    {
        "content": "<p>Ok. Thanks.</p>",
        "id": 479550653,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230546
    },
    {
        "content": "<p>By the way, since it's useful to be able to break up these named conjunctions inside proofs, mathlib has a <code>@[mk_iff]</code> attribute to automatically generate the <code>iff</code> theorem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">mk_iff</span><span class=\"kd\">]</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Stuff</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">addProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"n\">mulProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">stuff_iff</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">stuff_iff : Stuff ↔ 1 + 1 = 2 ∧ 2 * 3 = 6</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 479550760,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230577
    },
    {
        "content": "<p>Wow. This looks like something that needs to be added to the books.</p>",
        "id": 479550862,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230627
    },
    {
        "content": "<p>I sort of wonder if Lean should automatically generate this theorem without being asked to</p>",
        "id": 479550931,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730230663
    },
    {
        "content": "<p>I should write a blog article about this so I don't forget. Thank you very much for the help.</p>",
        "id": 479551083,
        "sender_full_name": "Kevin Cheung",
        "timestamp": 1730230711
    },
    {
        "content": "<p>What's the benefit of generating the And theorem? Things like <code>simp</code> won't attempt to destructure it otherwise?</p>",
        "id": 479561455,
        "sender_full_name": "Alex Mobius",
        "timestamp": 1730234374
    },
    {
        "content": "<p>Yes, exactly. In particular, <code>simp</code> has no way of destructuring structures without such a theorem. If <code>simp</code> had this feature, it would need to contain an implementation of <code>@[mk_iff]</code>.</p>",
        "id": 479561996,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1730234573
    }
]