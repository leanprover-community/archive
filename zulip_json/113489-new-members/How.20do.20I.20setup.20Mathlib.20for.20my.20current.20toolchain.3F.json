[
    {
        "content": "<p>I created a new project using Lean 4.15.0, and I set up mathlib dependency as so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"releases/v4.15.0\"</span>\n</code></pre></div>\n<p>However, when I try to <code>lean update</code>, I get this kind of compile error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">info: state_reduction: no previous manifest, creating one from scratch</span>\n<span class=\"go\">info: leanprover-community/mathlib: cloning https://github.com/leanprover-community/mathlib4 to '././.lake/packages/mathlib'</span>\n<span class=\"go\">trace: .&gt; git clone https://github.com/leanprover-community/mathlib4 ././.lake/packages/mathlib</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">Cloning into '././.lake/packages/mathlib'...</span>\n<span class=\"go\">Updating files: 100% (6086/6086), done.</span>\n<span class=\"go\">trace: ././.lake/packages/mathlib&gt; git checkout --detach e9ae2a61ef5c99d6edac84f0d04f6324c5d97f67 --</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">HEAD is now at e9ae2a61ef chore: disable docPrime linter (#20559)</span>\n<span class=\"go\">info: batteries: cloning https://github.com/leanprover-community/batteries to '././.lake/packages/batteries'</span>\n<span class=\"go\">trace: .&gt; git clone https://github.com/leanprover-community/batteries ././.lake/packages/batteries</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">Cloning into '././.lake/packages/batteries'...</span>\n<span class=\"go\">trace: ././.lake/packages/batteries&gt; git checkout --detach e8dc5fc16c625fc4fe08f42d625523275ddbbb4b --</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">HEAD is now at e8dc5fc1 chore: bump toolchain to v4.15.0 (#1080)</span>\n<span class=\"go\">info: Qq: cloning https://github.com/leanprover-community/quote4 to '././.lake/packages/Qq'</span>\n<span class=\"go\">trace: .&gt; git clone https://github.com/leanprover-community/quote4 ././.lake/packages/Qq</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">Cloning into '././.lake/packages/Qq'...</span>\n<span class=\"go\">trace: ././.lake/packages/Qq&gt; git checkout --detach f0c584bcb14c5adfb53079781eeea75b26ebbd32 --</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">HEAD is now at f0c584b chore: bump toolchain to v4.15.0 (#66)</span>\n<span class=\"go\">info: aesop: cloning https://github.com/leanprover-community/aesop to '././.lake/packages/aesop'</span>\n<span class=\"go\">trace: .&gt; git clone https://github.com/leanprover-community/aesop ././.lake/packages/aesop</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">Cloning into '././.lake/packages/aesop'...</span>\n<span class=\"go\">trace: ././.lake/packages/aesop&gt; git checkout --detach 2689851f387bb2cef351e6825fe94a56a304ca13 --</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">HEAD is now at 2689851 chore: bump toolchain to v4.15.0 (#187)</span>\n<span class=\"go\">info: proofwidgets: cloning https://github.com/leanprover-community/ProofWidgets4 to '././.lake/packages/proofwidgets'</span>\n<span class=\"go\">trace: .&gt; git clone https://github.com/leanprover-community/ProofWidgets4 ././.lake/packages/proofwidgets</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">Cloning into '././.lake/packages/proofwidgets'...</span>\n<span class=\"go\">trace: ././.lake/packages/proofwidgets&gt; git checkout --detach 2b000e02d50394af68cfb4770a291113d94801b5 --</span>\n<span class=\"go\">trace: stderr:</span>\n<span class=\"go\">HEAD is now at 2b000e0 update</span>\n<span class=\"go\">error: ././.lake/packages/proofwidgets/lakefile.lean:20:20: error: invalid argument name 'text' for function 'Lake.buildFileAfterDep'</span>\n<span class=\"go\">error: ././.lake/packages/proofwidgets/lakefile.lean:46:2: error: invalid field 'afterBuildCacheAsync', the environment does not contain 'Lake.Package.afterBuildCacheAsync'</span>\n<span class=\"go\">  pkg</span>\n<span class=\"go\">has type</span>\n<span class=\"go\">  Package</span>\n<span class=\"go\">error: ././.lake/packages/proofwidgets/lakefile.lean: package configuration has errors</span>\n</code></pre></div>\n<p>What should I do to fix this?</p>",
        "id": 494826896,
        "sender_full_name": "R Dong",
        "timestamp": 1737383901
    },
    {
        "content": "<p>Are you using a <code>lakefile.lean</code> or a <code>lakefile.toml</code>? In the FLT <code>lakefile.lean</code> I have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"v4.15.0\"</span>\n</code></pre></div>\n<p>(at least on the branch I'm on -- <code>main</code> is now on 4.16-rc2)</p>",
        "id": 494885009,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737395853
    },
    {
        "content": "<p><code>lakefile.lean</code>. I'll give it a try</p>",
        "id": 494887175,
        "sender_full_name": "R Dong",
        "timestamp": 1737396676
    },
    {
        "content": "<p>Same error</p>",
        "id": 494889411,
        "sender_full_name": "R Dong",
        "timestamp": 1737397558
    },
    {
        "content": "<p>I think you need to post your full lakefille.lean so that we get to see all the other things you put in it</p>",
        "id": 494916119,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737408427
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"s2\">\"test_lean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add package configuration options here</span>\n\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">TestLean</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"c1\">-- add library configuration options here</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"s2\">\"test_lean\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"v4.15.0\"</span>\n</code></pre></div>\n<p>It's straight from template, plus the mathlib</p>",
        "id": 494916283,
        "sender_full_name": "R Dong",
        "timestamp": 1737408498
    },
    {
        "content": "<p>What's in your lean-toolchain?</p>",
        "id": 494917880,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737409200
    },
    {
        "content": "<p>No such file</p>",
        "id": 494918100,
        "sender_full_name": "R Dong",
        "timestamp": 1737409298
    },
    {
        "content": "<p>Try creating one in the root of your project, containing <code>leanprover/lean4:v4.15.0</code></p>",
        "id": 494918890,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737409678
    },
    {
        "content": "<p>Same error</p>",
        "id": 494920130,
        "sender_full_name": "R Dong",
        "timestamp": 1737410244
    },
    {
        "content": "<p>How did you create this project? Which instructions did you follow? <code>lake new foobar math</code> is the way to create a project called foobar depending on mathlib. And what do you mean by <code>lean update</code> above? That's not a thing.</p>",
        "id": 494927428,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737413771
    },
    {
        "content": "<p>Looking at the differences between the lakefiles, I have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_lib</span><span class=\"w\"> </span><span class=\"bp\">«</span><span class=\"n\">Foobar</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>instead of what you have. But my understanding of lake is poor.</p>",
        "id": 494927647,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737413905
    },
    {
        "content": "<p><code>lake new &lt;&gt; math</code> gives me 4.16, which I don't have</p>",
        "id": 494930679,
        "sender_full_name": "R Dong",
        "timestamp": 1737415370
    },
    {
        "content": "<p>Also, same error. I didn't mean <code>lean update</code>, but <code>lean exe get cached</code> as instructed by Mathlib wiki</p>",
        "id": 494930743,
        "sender_full_name": "R Dong",
        "timestamp": 1737415410
    },
    {
        "content": "<p>Do you have elan? Elan should just be automatically downloading whichever version of lean you need</p>",
        "id": 494931131,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737415605
    },
    {
        "content": "<p>I do not have elan on this machine</p>",
        "id": 494936776,
        "sender_full_name": "R Dong",
        "timestamp": 1737418093
    },
    {
        "content": "<p>Oh wait, I just realized my Lean version is not 4.15, but 4.11</p>",
        "id": 494944214,
        "sender_full_name": "R Dong",
        "timestamp": 1737421749
    },
    {
        "content": "<p>That is why you should be using elan :)</p>",
        "id": 494955642,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1737427733
    },
    {
        "content": "<p>Well, I would certainly hope the dependency solver takes into account of the  current version</p>",
        "id": 494955697,
        "sender_full_name": "R Dong",
        "timestamp": 1737427763
    },
    {
        "content": "<p>That's what elan and lean-toolchain are for</p>",
        "id": 494978945,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1737442017
    }
]