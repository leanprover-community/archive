[
    {
        "content": "<p>I'm trying to formalize a group theory theorem. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">theorem_groups</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">IsConj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>When I use <code>Nat.card</code> I don't get any errors. But I want to go with <code>Fintype.card</code> as I might want to apply the orbit stabilizer theorem. How do I fix it?</p>",
        "id": 544379947,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760255698
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779183\">@Janitha</span> looking at the error message is usually helpful.</p>",
        "id": 544380148,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760255919
    },
    {
        "content": "<p>in this case it is probably complaining about a lack of the needed Fintype instances</p>",
        "id": 544380168,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760255937
    },
    {
        "content": "<p>if the instances you need are for the statement, then you should add those instances to the assumption</p>",
        "id": 544380196,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760255968
    },
    {
        "content": "<p>if it's in the proof, then you provide those instances using <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Fintype/Sets.html#Subtype.fintype\">Subtype.fintype</a> and the <code>classical</code> tactic</p>",
        "id": 544380242,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256017
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>  The error message is for the statement of the theorem. When I replace Fintype.card with Nat.card, Lean doesn't complain.</p>\n<p>Error:</p>\n<p>failed to synthesize<br>\n  Fintype { y // IsConj x y }</p>",
        "id": 544380654,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760256464
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"779183\">Janitha</span> <a href=\"#narrow/channel/113489-new-members/topic/Fintype.2Ecard/near/544380654\">said</a>:</p>\n<blockquote>\n<p>When I replace Fintype.card with Nat.card, Lean doesn't complain.</p>\n</blockquote>\n<p>yes, <code>Nat.card</code> can be applied to any type, but <code>Fintype.card</code> requires a fintype instance</p>",
        "id": 544380735,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256492
    },
    {
        "content": "<p>so add <code>[\\forall x, Fintype { y // IsConj x y }]</code> to your instance if you want to use <code>Fintype.card</code> in the statement</p>",
        "id": 544380763,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256514
    },
    {
        "content": "<p>people might not realise this, but getting the <em>statements</em> right can be very difficult at first, it's much easier to start with a correctly formulated statement provided by someone else, and work out the proof yourself</p>",
        "id": 544380860,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256627
    },
    {
        "content": "<p>I would advise you to actually not use the Fintype stuff in the statement</p>",
        "id": 544380899,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256660
    },
    {
        "content": "<p>use <code>Nat.card</code> and replace the <code>Fintype G</code> assumption with <code>Finite G</code>.</p>",
        "id": 544380925,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256681
    },
    {
        "content": "<p>With <code>Nat.card</code> and <code>Finite</code> in the statement, you can then start the proof with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">classical</span>\n<span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">ofFinite</span><span class=\"w\"> </span><span class=\"n\">G</span>\n<span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">card_eq_fintype_card</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>to get it back to how you had it before</p>",
        "id": 544380994,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760256753
    },
    {
        "content": "<p>Thanks! That fixed it. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">theorem_groups</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">IsConj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Subgroup</span><span class=\"bp\">.</span><span class=\"n\">center</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">IsConj</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>If I use <code>Nat.card</code> and replaced the <code>Fintype G</code> assumption with <code>Finite G</code>,  how would I use a theorem that uses <code>Fintype.card</code> in its statement?</p>",
        "id": 544381033,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760256789
    },
    {
        "content": "<p>read the message above you</p>",
        "id": 544381046,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256805
    },
    {
        "content": "<p>basically, Lean needs to be guided in every way (as you probably know), and one of the things that is obvious to mathematicians but not to Lean is when things are finite</p>",
        "id": 544381132,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256875
    },
    {
        "content": "<p>you need to tell Lean why certain things are finite</p>",
        "id": 544381141,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256886
    },
    {
        "content": "<p>as you'll discover very soon</p>",
        "id": 544381145,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760256891
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> and <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> I completed the proof. Thank you!</p>",
        "id": 544382504,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760258319
    },
    {
        "content": "<p>well done!</p>",
        "id": 544382517,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760258333
    },
    {
        "content": "<p>Oh, does <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subtype.fintype#doc\">docs#Subtype.fintype</a> not fire because of the decidability argument?</p>",
        "id": 544382902,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760258686
    },
    {
        "content": "<p>yeah, nothing works automatically there</p>",
        "id": 544382942,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760258717
    },
    {
        "content": "<p>Right, if you add <code>[DecidableEq G]</code>, everything works</p>",
        "id": 544383095,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760258924
    },
    {
        "content": "<p>well, you shouldn't add it to the statement</p>",
        "id": 544383108,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760258938
    },
    {
        "content": "<p>Sure, yours is more general</p>",
        "id": 544383232,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760259043
    },
    {
        "content": "<p>Anyway, this is why I use Nat.card</p>",
        "id": 544383245,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760259053
    },
    {
        "content": "<p>indeed, but the orbit stabiliser theorem is stated with Fintype.card, which should be updated</p>",
        "id": 544383265,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760259073
    },
    {
        "content": "<p>I'll review your PR to do so (if I don't forget or get distracted) :)</p>",
        "id": 544383293,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1760259108
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779183\">@Janitha</span> do you want to try this?</p>",
        "id": 544383298,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760259114
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> please tell me what you want me to try?</p>",
        "id": 544383871,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760259669
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"779183\">@Janitha</span> state and prove a version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/GroupTheory/GroupAction/Quotient.html#MulAction.card_orbit_mul_card_stabilizer_eq_card_group\">MulAction.card_orbit_mul_card_stabilizer_eq_card_group</a> using <code>Nat.card</code> and PR that to mathlib</p>",
        "id": 544383939,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760259726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> sure, I can try that.</p>",
        "id": 544383988,
        "sender_full_name": "Janitha Aswedige",
        "timestamp": 1760259770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Fintype.2Ecard/near/544383265\">said</a>:</p>\n<blockquote>\n<p>indeed, but the orbit stabiliser theorem is stated with Fintype.card, which should be updated</p>\n</blockquote>\n<p>why? Is the statement <em>wrong</em>?</p>",
        "id": 544387310,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760263377
    },
    {
        "content": "<p>well Nat.card is more general</p>",
        "id": 544387363,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263426
    },
    {
        "content": "<p>not really?</p>",
        "id": 544387609,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760263654
    },
    {
        "content": "<p>it's the same thing but with junk values</p>",
        "id": 544387628,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760263671
    },
    {
        "content": "<p>it requires less instances to state, is the main point</p>",
        "id": 544387735,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263751
    },
    {
        "content": "<p>e.g. see <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/Finite/Basic.html#FiniteField.orderOf_frobeniusAlgHom\">FiniteField.orderOf_frobeniusAlgHom</a></p>",
        "id": 544387799,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263799
    },
    {
        "content": "<p>K is fintype and L is finite, because the statement talks about frobenius, which requires K to be fintype</p>",
        "id": 544387827,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263817
    },
    {
        "content": "<p>but L doesn't need to be fintype, so it should just be finite</p>",
        "id": 544387847,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263829
    },
    {
        "content": "<p>now i think frobenius should be updated to only require finite, but that's another PR</p>",
        "id": 544387882,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263859
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> would you review a PR to change <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/FieldTheory/Finite/Basic.html#FiniteField.frobeniusAlgHom\">FiniteField.frobeniusAlgHom</a> to finite?</p>",
        "id": 544387903,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263884
    },
    {
        "content": "<p>hmm, ok maybe that needs to be considered first, because using Nat.card does make it noncomputable</p>",
        "id": 544387957,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760263934
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Fintype.2Ecard/near/544387847\">said</a>:</p>\n<blockquote>\n<p>but L doesn't need to be fintype, so it should just be finite</p>\n</blockquote>\n<p>That's different, since we aren't computing its card or anything</p>",
        "id": 544388914,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760264746
    },
    {
        "content": "<p>it just needs to be finite</p>",
        "id": 544388942,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760264763
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/LinearAlgebra/Dimension/Finrank.html#Module.finrank\">Module.finrank</a> K L is computing its card tho</p>",
        "id": 544388977,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760264792
    },
    {
        "content": "<p>that has always been noncomputable</p>",
        "id": 544389035,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760264840
    },
    {
        "content": "<p>and it's not really possible to make it computable either</p>",
        "id": 544389108,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760264911
    },
    {
        "content": "<p>since it needs to work with infinite modules over infinite rings</p>",
        "id": 544389127,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760264930
    },
    {
        "content": "<p>well, <code>MulAction.orbit</code> likewise never has a computable cardinality</p>",
        "id": 544389174,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760264985
    }
]