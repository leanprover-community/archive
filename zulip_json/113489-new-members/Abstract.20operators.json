[
    {
        "content": "<p>I've got another question. I'm trying to define some custom operators but I don't think I'm doing this right.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">quotPrecheck</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n\n<span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"w\"> </span><span class=\"s2\">\" ≥_l \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ge</span>\n\n<span class=\"c1\">-- so far so good</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">gt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ge</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"bp\">≥_</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">cd</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"o\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">≥_</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"c1\">-- ERROR HERE</span>\n\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"s2\">\" &gt;_l \"</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">gt</span><span class=\"w\"> </span><span class=\"n\">ge</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"n\">rhs</span>\n\n<span class=\"c1\">-- MFE.lean:18:16</span>\n<span class=\"c1\">-- unknown identifier 'ge✝'</span>\n</code></pre></div>\n<p>In Agda, I'd make the whole module parameterised by <code>ge</code>, and then refer to that. (Well, in Agda, I'd just name it <code>_≥_</code> directly but that's not the point.) Since Lean is parameterised on a per-definition basis, there is no \"global\" <code>ge</code> so I disabled <code>quotPrecheck</code> and was trying to make <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>≥</mo><mi>l</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\ge_l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mrel\"><span class=\"mrel\">≥</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> to refer to whatever <code>ge</code> is in scope instead. But that's probably not a good idea because I'm getting an error.</p>\n<p>I could add <code>variable (ge : Rel n)</code> but then I lose control over that parameter, as all references to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>≥</mo><mi>l</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\ge_l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mrel\"><span class=\"mrel\">≥</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> start referring to <code>ge✝</code> instead and I can't control where that parameter appears, whether it's implicit or explicit or so, and that's causing a whole set of problems of its own further down the line, so I've mostly stopped using section variables in my code.</p>\n<p>How can I properly say \"my development refers to an abstract greater-than-or-equal relation, written <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mo>≥</mo><mi>l</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\ge_l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mrel\"><span class=\"mrel\">≥</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>\", and then derive further operators from that?</p>",
        "id": 532425470,
        "sender_full_name": "ziman",
        "timestamp": 1754118040
    },
    {
        "content": "<p>Alright, it seems that adding <code>set_option quotPrecheck.allowSectionVars true</code> and <code>variable (ge : Rel n)</code>, but no other unnecessary <code>variable</code>s, does what I want. It seems to create <code>ge✝</code> and refer to it just where I need it.</p>\n<p>It seems I misunderstood the <code>variable</code> declaration. I thought it was just \"please auto-quantify these names for me\" but it seems to do more than that, creating the dagger variables and all that.</p>",
        "id": 532426340,
        "sender_full_name": "ziman",
        "timestamp": 1754118725
    },
    {
        "content": "<p>I'd delete my question but it seems it's not possible anymore.</p>",
        "id": 532426371,
        "sender_full_name": "ziman",
        "timestamp": 1754118754
    },
    {
        "content": "<p>You need</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">hygiene</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">infix</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"w\"> </span><span class=\"s2\">\" ≥_l \"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ge</span>\n</code></pre></div>\n<p>to make sure it doesn't refer to some <code>ge._@.external:file:///MathlibDemo/MathlibDemo.lean._hyg.53</code></p>",
        "id": 532427971,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1754120167
    },
    {
        "content": "<p>Ah, thank you! :)</p>",
        "id": 532443477,
        "sender_full_name": "ziman",
        "timestamp": 1754133054
    }
]