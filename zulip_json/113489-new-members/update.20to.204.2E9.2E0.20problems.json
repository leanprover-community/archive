[
    {
        "content": "<p>so I saw the announcement that Lean 4.9.0 is out.</p>\n<p>I asked on social media all I had to do was update the lean-toolchain file from<br>\n<code>leanprover/lean4:v4.9.0-rc1</code></p>\n<p>to<br>\n<code>leanprover/lean4:v4.9.0</code></p>\n<p>I was advised as follows:</p>\n<blockquote>\n<p>1.for the default active lean toolchain <code>elan update</code>.</p>\n<ol start=\"2\">\n<li>To update a project managed by lake, cd into it, run <code>lake update</code>.</li>\n</ol>\n</blockquote>\n<p><code>elan update</code> worked by <code>lake update</code> didn't</p>\n<p>So the further advice was:</p>\n<blockquote>\n<p>Troubleshooting tips:</p>\n<ol>\n<li>If lake complains about something (usually manifests or syntax changes in lake's configuration files), delete the file lake-manifest.json and the build folder named .lake</li>\n<li>If that fails, ask for help* on the very active <a href=\"http://leanprover.zulipchat.com\">leanprover.zulipchat.com</a></li>\n</ol>\n</blockquote>\n<p>However this didn't work. So I deleted the entire folder and restored it from my GitHub backup which only brings down the lean-toolchain file (now updated to 4.9.0) and the lakefile.lean file.</p>\n<p>Trying to open a lean file gives the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>`/Users/tariq/.elan/toolchains/leanprover--lean4---v4.9.0/bin/lake setup-file /Users/tariq/Desktop/Lean-First-Steps/04_algebra.lean Init Mathlib.Tactic --no-build` failed:\n\nstderr:\ninfo: leantest: no previous manifest, creating one from scratch\ninfo: mathlib: cloning https://github.com/leanprover-community/mathlib4.git to '././.lake/packages/mathlib'\ntrace: .&gt; git clone https://github.com/leanprover-community/mathlib4.git ././.lake/packages/mathlib\ntrace: stderr:\nCloning into '././.lake/packages/mathlib'...\nerror: ././.lake/packages/mathlib/lakefile.lean:21:7: error: unexpected token; expected identifier\nerror: ././.lake/packages/mathlib/lakefile.lean:22:7: error: unexpected token; expected identifier\nerror: ././.lake/packages/mathlib/lakefile.lean:23:7: error: unexpected token; expected identifier\nerror: ././.lake/packages/mathlib/lakefile.lean:24:7: error: unexpected token; expected identifier\nerror: ././.lake/packages/mathlib/lakefile.lean:25:7: error: unexpected token; expected identifier\nerror: ././.lake/packages/mathlib/lakefile.lean: package configuration has errors\nInvalid Lake configuration.  Please restart the server after fixing the Lake configuration file.\n</code></pre></div>\n<p>Any tips?</p>",
        "id": 448713686,
        "sender_full_name": "rzeta0",
        "timestamp": 1719959020
    },
    {
        "content": "<p>I should say I use Visual Studio Code and the Lean extension on macOS, all of which are auto updated as far as I can tell.</p>",
        "id": 448713764,
        "sender_full_name": "rzeta0",
        "timestamp": 1719959054
    },
    {
        "content": "<p>you are trying to use 4.9.0 to compile latest mathlib, which is on 4.10.0-rc1. You should either use the <code>stable</code> branch of mathlib in your lakefile, or update your lean-toolchain to 4.10.0-rc1</p>",
        "id": 448714871,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719959685
    },
    {
        "content": "<p>(Note that mathlib usually bumps to the first RC of the upcoming version immediately after a stable release)</p>",
        "id": 448714921,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719959716
    },
    {
        "content": "<p>concretely, you should edit your lakefile to contain:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"v4.9.0\"</span>\n</code></pre></div>",
        "id": 448715111,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719959852
    },
    {
        "content": "<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">mathlib</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span>\n<span class=\"w\">  </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"s2\">\"stable\"</span>\n</code></pre></div>",
        "id": 448715196,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1719959893
    },
    {
        "content": "<p>hi Mario - I appreciate your help, thanks.</p>\n<p>This <code>lakefile.lean</code> is automatically recreated by the lean4 VSC extension? Is that correct?</p>\n<p>Pointing to the next RC seems like the wrong default behaviour.  Surely most users would want a stable/latest release install - and only the developers or experts would want to be working on an RC?</p>\n<p><strong>The important question for me i</strong>s that if I want other beginners to clone my GitHub repo of lean example files do I need to ensure the <code>@ \"4.9.0\"</code> in the lakefile.lean file so that their experience is as smooth as possible?</p>\n<p><strong>Question for the developers</strong> - if <code>lean-toolchain</code> points to 4.9.0 surely we shouldn't have <code>lakefile.lean</code> try to pull down an RC?</p>",
        "id": 448715761,
        "sender_full_name": "rzeta0",
        "timestamp": 1719960202
    },
    {
        "content": "<p>Given how fast the lean ecosystem continues to move, there are a lot of good reasons to continue with RC being the default. There is a tradeoff between having a smooth experience and keeping up with great changes and sometimes breaking ones. For example, with 4.9.0 there is incremental compilation, some nice changes to the omega tactic, and a breaking change with type inference in <code>have</code> statements among others.</p>",
        "id": 448721026,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719962911
    },
    {
        "content": "<p>A reasonable trade off it to use the \"stable\" branch option Mario mentioned above</p>",
        "id": 448721182,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719962962
    },
    {
        "content": "<p>Roughly you have a new stable release every month</p>",
        "id": 448721230,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719962981
    },
    {
        "content": "<p>If I'm creating a set of resources for people to use in the coming months and even years - is the advice to pin to a specific version eg 4.9.0 or can I depend on \"stable\" being backwards compatible?</p>",
        "id": 448721694,
        "sender_full_name": "rzeta0",
        "timestamp": 1719963153
    },
    {
        "content": "<p>Although the language is most likely not going to change substantially, one shouldn't expect backward compatibility as a given, particularly for tactic mode and library Def/theorem names. Sometimes the changes are additive so nothing breaks with updates.  When there are breaking changes, the release notes specify how to handle them. Of course, one option is to simply pin your project's lean version for a longer time and have a slower update cycle for your resource, at the risk of having bigger breakages with each such update.</p>\n<p>A slight aside: If you provide a gitpod/codespaces setup in your project, then users will be able to spin up your GitHub repo</p>",
        "id": 448729810,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719967507
    },
    {
        "content": "<p>So they won't have to deal with any of these breakages and updates</p>",
        "id": 448729898,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719967573
    },
    {
        "content": "<p>Users don't have to deal with updates anyway unless they decide they want to update your package for you</p>",
        "id": 448730094,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1719967713
    },
    {
        "content": "<p>\"stable\" has two different meanings in this context:</p>\n<ol>\n<li>As far as the lean toolchain is concerned (i.e. language + lake +Std) it means the release is more bug free than the release candidates where issues get ironed out</li>\n<li>For mathlib and batteries, stable just means that they were built with the corresponding stable lean toolchain version</li>\n</ol>",
        "id": 448730147,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719967767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/113489-new-members/topic/update.20to.204.2E9.2E0.20problems/near/448730094\">said</a>:</p>\n<blockquote>\n<p>Users don't have to deal with updates anyway unless they decide they want to update your package for you</p>\n</blockquote>\n<p>Then it could become rapidly out of date as a learning resource.</p>",
        "id": 448730331,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1719967909
    }
]