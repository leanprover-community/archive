[
    {
        "content": "<p>Loogle has entries which are equations for definitions:</p>\n<p>@loogle eq_1</p>\n<p>but I noticed a few are missing. For example, I can't find-</p>\n<p>@loogle Sym2.eq_1<br>\n@loogle Sym2.fromRel.eq_1<br>\n@loogle SimpleGraph.ConnectedComponent.eq_1</p>\n<p>even though I can find-</p>\n<p>@loogle Magma.AssocQuotient.eq_1<br>\n@loogle AddMagma.FreeAddSemigroup.eq_1</p>\n<p>What makes certain definitions appear and not others? (for example, maybe different universe levels?)</p>\n<p>Can you point me towards a way to debug this, for example by pointing to the part of <a href=\"https://github.com/nomeata/loogle\">Loogle's code</a> that extracts definitions from the current env, or a MWE of Lean code that extracts definitions from the current env and finds <code>Magma.AssocQuotient.eq_1</code> but not <code>Sym2.eq_1</code>?</p>",
        "id": 544439818,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760316600
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 544439840,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760316625
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 544439850,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760316638
    },
    {
        "content": "<p>these equations are generated on first use</p>",
        "id": 544439907,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760316724
    },
    {
        "content": "<p>if loogle can't find it, that means it wasn't used (so it wasn't generated)</p>",
        "id": 544439912,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760316737
    },
    {
        "content": "<p>So using it as defeq doesn't count? e.g. when <code>Quot.lift</code> is applied to a <code>Sym2</code> term it uses the equation of <code>Sym2</code> to typecheck.</p>\n<p>Mathlib's docs contain more equations than Loogle, is there a way to list unused equations like the docs do?</p>",
        "id": 544440120,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760317027
    },
    {
        "content": "<p>the unfolding equation is different from just unfolding</p>",
        "id": 544440189,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317114
    },
    {
        "content": "<p>it's used when, for example, you <code>rw [Sym2]</code>, that will use <code>Sym2.eq_1</code></p>",
        "id": 544440226,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317157
    },
    {
        "content": "<p>but when you're in a typechecking problem that's not using the unfolding equation</p>",
        "id": 544440236,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317178
    },
    {
        "content": "<p>and sometimes this unfolding equation is a lot more complicated than <code>Eq.refl _</code></p>",
        "id": 544440270,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317204
    },
    {
        "content": "<p>and sometimes it can unexpectedly fail, so you get an error generating the equational lemma</p>",
        "id": 544440308,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317223
    },
    {
        "content": "<p>So it's when \"casting\" a defeq into a term of <code>Eq</code>?</p>",
        "id": 544440322,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760317232
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/113489-new-members/topic/Loogle.20missing.20equations/near/544440322\">said</a>:</p>\n<blockquote>\n<p>So it's when \"casting\" a defeq into a term of <code>Eq</code>?</p>\n</blockquote>\n<p>not sure what you mean by this</p>",
        "id": 544440370,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317288
    },
    {
        "content": "<p>can you provide some context</p>",
        "id": 544440371,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/113489-new-members/topic/Loogle.20missing.20equations/near/544440120\">said</a>:</p>\n<blockquote>\n<p>Mathlib's docs contain more equations than Loogle, is there a way to list unused equations like the docs do?</p>\n</blockquote>\n<p>what docs does is it just generates all the equational lemmas in contrast to loogle which only looks at existing ones</p>",
        "id": 544440484,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317414
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Loogle.20missing.20equations/near/544440370\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/113489-new-members/topic/Loogle.20missing.20equations/near/544440322\">said</a>:</p>\n<blockquote>\n<p>So it's when \"casting\" a defeq into a term of <code>Eq</code>?</p>\n</blockquote>\n<p>not sure what you mean by this</p>\n</blockquote>\n<p>You said that the equation is generated when trying to <code>rw [Sym2]</code>, so what I understood from that is that the name <code>Sym2</code> refers to a definition and not a term of type <code>Eq Type</code>, and the <code>rw</code> tactic generates this <code>eq_1</code> using <code>rfl</code> which uses the defeq of the definition.</p>",
        "id": 544440586,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760317518
    },
    {
        "content": "<p>well it's not <code>rw</code> that's doing the generating</p>",
        "id": 544440666,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317597
    },
    {
        "content": "<p><code>rw</code> triggers the generating but the generating is done by something else</p>",
        "id": 544440679,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317618
    },
    {
        "content": "<p>do you know how the mathlib docs are able to get all the equations, even unused (maybe they trigger the generation)?</p>",
        "id": 544440739,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760317670
    },
    {
        "content": "<p>specifically, <code>rw</code> calls <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.getEqnsFor%3F#doc\">docs#Lean.Meta.getEqnsFor?</a> which does all the logic to figure out if it needs to generate some lemmas</p>",
        "id": 544440803,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317732
    },
    {
        "content": "<p>maybe docs does something similar?</p>",
        "id": 544440809,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317743
    },
    {
        "content": "<p>found it <a href=\"https://github.com/leanprover/doc-gen4/blob/31cc380418e01263dad34aff8c7ae7980c14f427/DocGen4/Process/DefinitionInfo.lean#L30-L39\">https://github.com/leanprover/doc-gen4/blob/31cc380418e01263dad34aff8c7ae7980c14f427/DocGen4/Process/DefinitionInfo.lean#L30-L39</a></p>",
        "id": 544440976,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760317952
    },
    {
        "content": "<p>Nice! If I understand correctly, <a href=\"https://github.com/nomeata/loogle/blob/ee8c0388917eb6b594f24e1865d5b83230229252/Loogle/Cache.lean#L35\">Loogle uses Batteries</a> to get a list of all the theorems, specifically <a href=\"https://github.com/leanprover-community/batteries/blob/9c1ad6d93126e346c859d4a17d71b010e7951f92/Batteries/Util/Cache.lean#L115-L118\"><code>DeclCache.mk</code></a></p>",
        "id": 544441649,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760318690
    },
    {
        "content": "<p>so now the question becomes how to give both these pieces of code the PPAP treatment</p>",
        "id": 544441792,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760318837
    },
    {
        "content": "<p><a href=\"#narrow/channel/348111-batteries/topic/Generating.20equations.20in.20.60DeclCache.60\">#batteries &gt; Generating equations in &#96;DeclCache&#96;</a></p>",
        "id": 544443617,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1760320790
    }
]