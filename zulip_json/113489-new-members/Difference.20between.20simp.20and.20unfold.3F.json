[
    {
        "content": "<p>I'm not clear on the difference between <code>simp</code> and <code>unfold</code>. I only found out about the <code>unfold</code> tactic yesterday and now I'm confused because I thought <code>simp</code> would already unfold all definitions marked with the <code>@[simp]</code> attribute?</p>",
        "id": 523055391,
        "sender_full_name": "aron",
        "timestamp": 1749461124
    },
    {
        "content": "<p>Or is the difference that <code>simp</code> only unfolds a function definition when it knows the concrete values of all parameters, whereas <code>unfold</code> forces the specified definitions to be unfolded even when not all their params' definite values are known?</p>",
        "id": 523055596,
        "sender_full_name": "aron",
        "timestamp": 1749461217
    },
    {
        "content": "<p>Generally, <code>simp</code> won't unfold unless you \"ask it to\".<br>\n(Intuitively, too much unfolding is almost the opposite of simplifying!)<br>\nExample:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">;</span><span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- doesn't work</span>\n</code></pre></div>",
        "id": 523168577,
        "sender_full_name": "Bjørn Kjos-Hanssen",
        "timestamp": 1749503689
    },
    {
        "content": "<p><code>simp</code>  applies all relevant simp lemmas to the target.  <code>unfold</code> just replaces a term with its definition. yes <code>simp</code> does indeed unfold all definitions that do have a <code>@[simp]</code> attribute, but not all definitions have a <code>@[simp]</code> attribute, and simp lemmas are not just definitions.</p>",
        "id": 523177807,
        "sender_full_name": "Tanner Duve",
        "timestamp": 1749507702
    },
    {
        "content": "<p><code>unfold a b c</code> is similar to <code>simp only [a]; simp only [b]; simp only [c]</code>.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/Difference.20between.20simp.20and.20unfold.3F/near/523055596\">said</a>:</p>\n<blockquote>\n<p>Or is the difference that <code>simp</code> only unfolds a function definition when it knows the concrete values of all parameters</p>\n</blockquote>\n<p><code>simp</code> uses the equation lemmas. This means it's not about concrete vs non-concrete, but whether the patterns in the arguments correspond to the patterns that appear in the definition. (E.g., <code>Nat.add m (n + 1)</code> can be unfolded with <code>simp</code> since  there's a pattern in the definition of <code>Nat.add</code> this, namely <code>| a, b + 1 =&gt; ...</code>)</p>\n<p>The <code>unfold c</code> tactic uses the <code>c.eq_def</code> lemma for definition <code>c</code>. This doesn't use equation lemmas, but instead unfolds the definition itself (it's not restricted to applications that correspond to the patterns). However, since it uses <code>c.eq_def</code> and not the <code>c.eq_unfold</code> lemma, it only unfolds if the function is given enough arguments.</p>",
        "id": 523185088,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1749512494
    }
]