[
    {
        "content": "<p>I am trying to solve the exercises from \"Types and Programming Languages\" by B. Pierce in Lean and  am currently stuck on the proof of exercise 3.5.14. </p>\n<p>The objective is to prove that given a type: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n</code></pre></div>\n<p>and defining evaluation as: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- ite true t₂ t₃ → t₂</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToTrue</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₃</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t₂</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- ite false t₂ t₃ → t₃</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToFalse</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">False</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₃</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t₃</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (c → c') → (ite c l r → ite c' l r)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c'</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (succ t₁ → succ t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- pred 0 = 0</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- pred (succ nv) → nv</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToPredSucc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">t₁</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (pred t₁ → pred t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- iszero 0 → true</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZeroZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- iszero (succ nv) → false</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZeroSucc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">False</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (iszero t₁ → iszero t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>the following theorem holds: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">OneStepDeterminacy'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I am proving this by induction on <code>a</code> and keep getting stuck in the case where <code>a</code> is of the form <code>pred s</code>: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span>\n</code></pre></div>\n<p>in particular, I've tried doing various <code>cases</code>, induction on <code>s</code> and on the evaluation rules, but I don't see how to lay out the overall proof strategy for this case.</p>",
        "id": 515713394,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746192273
    },
    {
        "content": "<p>Hi, it would be much easier for us to help you if you gave us an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 515722366,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1746194799
    },
    {
        "content": "<p>I think the theorem is false?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">))</span>\n\n<span class=\"c1\">-- different one step evaluation!</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ev₁</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">EvaluatesToPredSucc</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ev₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">EvaluatesToZero</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>In general (if the relation is fixed), you want to induct on the <code>EvaluatesTo</code> relation with <code>generalizing c</code>. This gives us an induction hypothesis with variable <code>c</code>, which we can use to match the shape of the terms in each branch. In each branch, <code>cases hac</code> will eliminate most cases thanks to Lean's dependent pattern matching, but you'll need a few manual analysis to eliminate the remaining cases.</p>",
        "id": 515722484,
        "sender_full_name": "pandaman",
        "timestamp": 1746194826
    },
    {
        "content": "<p>oh I see, I had not realized that. I guess I need to reconsider the encodings. Thank you very much!<br>\n(mwe <a href=\"https://live.lean-lang.org/#codez=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\">here</a> with the <code>sorry</code>s where I gost stuck)</p>",
        "id": 515723105,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746194975
    },
    {
        "content": "<p>thanks for the catch @pandaman, I've asked a more precise question <a href=\"https://cstheory.stackexchange.com/questions/55364/prove-determinacy-of-untyped-expression-language-with-naturals-and-booleans-tap\">here</a> with all the references to the book :)<br>\ndo you think I've missed something in the encoding? Or is the exercise just wrong?<br>\nEDIT: turns out encoding nats and bools in the same type was the problem.</p>",
        "id": 516163715,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746442512
    },
    {
        "content": "<p>An option is to define an <code>IsNumericValue : t' -&gt; Prop</code> inductive predicate  and use it as a precondition of the evaluation relation.</p>",
        "id": 516213311,
        "sender_full_name": "pandaman",
        "timestamp": 1746455231
    },
    {
        "content": "<p>I think I fixed the definitions now, but I still get stuck in the same proof. A mwe is <a href=\"https://live.lean-lang.org/#codez=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\">here</a>, could anyone help me out with the sorrys? In particular, I get stuck with the cases on the hypothesis and tried <code>induction b</code> with no success</p>",
        "id": 516979568,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746737971
    },
    {
        "content": "<p>Here is my attempt to prove the theorem</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- ite true t₂ t₃ → t₂</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToTrue</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">True</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t₁</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- ite false t₂ t₃ → t₃</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToFalse</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">False</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">t₁'</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (c → c') → (ite c l r → ite c' l r)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">c'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c'</span><span class=\"bp\">.</span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (succ t₁ → succ t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- pred 0 = 0</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- pred (succ nv) → nv</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToPredSucc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">))</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">v₁</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (pred t₁ → pred t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">pred</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- iszero 0 → true</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZeroZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- iszero (succ nv) → false</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZeroSucc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">False</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"c1\">-- (t₁ → t₁') → (iszero t₁ → iszero t₂)</span>\n<span class=\"w\">  </span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">iszero</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">It's helpful to prove so-called \"inversion\" lemmas for the inductive rules first.</span>\n\n<span class=\"cm\">In general, inversion lemmas state that \"if an evaluation of this form holds, then there must be something</span>\n<span class=\"cm\">that makes the evaluation hold\". In this case, we only need inversion lemmas that state \"there cannot be</span>\n<span class=\"cm\">an evaluation of this form\", like evaluating from `True` or `False`.</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">true_no_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Lean detects that no `EvaluatesTo` rule can apply for `True`.</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">false_no_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Lean detects that no `EvaluatesTo` rule can apply for `False`.</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Lean detects that no `EvaluatesTo` rule can apply for `zero`.</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"c1\">-- A numeric value is a value (i.e., no evaluation from it)</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">nv_no_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"n\">h''</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- exercise 3.5.14: show that theorem 3.5.4 also holds for t' -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">OneStepDeterminacy'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">EvaluatesTo</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToTrue</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToTrue</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"c1\">-- A hole (`_`) lets Lean find the appropriate argument for `true_no_step`. We can use a hole here</span>\n<span class=\"w\">    </span><span class=\"c1\">-- since the necessary information (the term after one step) is already present in `h`.</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToFalse</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToFalse</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">false_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- `@` allows us to match on the implicit arguments</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"n\">cond₁</span><span class=\"w\"> </span><span class=\"n\">cond₁'</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToTrue</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToFalse</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">false_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIf</span><span class=\"w\"> </span><span class=\"n\">cond₂</span><span class=\"w\"> </span><span class=\"n\">cond₂'</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">cond₁'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">cond₂'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">cond₂'</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToSucc</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToPredSucc</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"w\"> </span><span class=\"n\">n₁</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToPredSucc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"w\"> </span><span class=\"n\">n₁</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nv_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">n₁'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToPredSucc</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nv_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToPred</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIsZeroZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIsZeroZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZeroSucc</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"w\"> </span><span class=\"n\">n₁</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIsZeroSucc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n₁'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₁</span><span class=\"w\"> </span><span class=\"n\">n₁</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nv_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">n₁'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"n\">t₁</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">EvaluatesToIsZeroZero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZeroSucc</span><span class=\"w\"> </span><span class=\"n\">v₂</span><span class=\"w\"> </span><span class=\"n\">n₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n₂'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t'</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">nv</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">v₂</span><span class=\"w\"> </span><span class=\"n\">n₂</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">absurd</span><span class=\"w\"> </span><span class=\"n\">h₁</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nv_no_step</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">n₂'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">EvaluatesToIsZero</span><span class=\"w\"> </span><span class=\"n\">t₂</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t₁'</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">t₂'</span><span class=\"w\"> </span><span class=\"n\">h₂</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 517329190,
        "sender_full_name": "pandaman",
        "timestamp": 1746943319
    },
    {
        "content": "<p>Since we are interested in the evaluation, it's generally more easier to perform induction on the <code>EvaluatesTo</code> inductive predicate(i.e., the induction over the structure of how an <code>EvaluatesTo</code> derivation is constructed). Induction over the inductive predicate gives you more context about how the evaluation should behave.</p>",
        "id": 517329450,
        "sender_full_name": "pandaman",
        "timestamp": 1746943528
    },
    {
        "content": "<p>thank you very much <span class=\"user-mention\" data-user-id=\"395416\">@pandaman</span>! That makes a lot of sense. I guess I was trying to follow the on-paper proof strategy the book suggests, but it's clearly very different than doing it in Lean.</p>",
        "id": 517336576,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746949966
    },
    {
        "content": "<p>I think TAPL also suggests using induction over the derivation when proving (3.5.4), the original version without additional rules. Anyway, what's missing in your version is probably the lemma that states a numeric value cannot be evaluated further (<code>nv_no_step</code> in my example).</p>",
        "id": 517348046,
        "sender_full_name": "pandaman",
        "timestamp": 1746959588
    },
    {
        "content": "<p>Otherwise, I think your version is very close to the final proof. Good luck!</p>",
        "id": 517348083,
        "sender_full_name": "pandaman",
        "timestamp": 1746959624
    },
    {
        "content": "<p>Thanks again!! That is all very helpful :)</p>",
        "id": 517352103,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1746963120
    },
    {
        "content": "<p>It all <a href=\"https://github.com/luisacicolini/TaPLean/blob/main/chapter3.lean\">worked</a> and is now much clearer to me how the proof strategy works :)</p>",
        "id": 517462018,
        "sender_full_name": "Luisa Cicolini",
        "timestamp": 1747037610
    }
]