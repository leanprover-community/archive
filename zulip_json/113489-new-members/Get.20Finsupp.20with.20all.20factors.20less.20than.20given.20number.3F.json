[
    {
        "content": "<p>Hello!</p>\n<p>There's this beautiful thing <code>Nat.factorization</code>. How can I make the function that filters out all divisors bigger than given number and make new <code>ℕ →₀ ℕ</code>?</p>\n<p>Smth like this unfinished effort:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">divisors_under_i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→₀</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorization</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 490227318,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734727131
    },
    {
        "content": "<p>Thanks in advance!</p>",
        "id": 490227329,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734727139
    },
    {
        "content": "<p>firstly, since you're defining data, using tactics is a bad idea. secondly, <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finsupp/Basic.html#Finsupp.filter\">Finsupp.filter</a> should allow you to get basically what you want.</p>",
        "id": 490227652,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734727302
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finsupp.filter#doc\">docs#Finsupp.filter</a></p>",
        "id": 490227657,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734727307
    },
    {
        "content": "<p>Edward beat me to it, but I guessed the same name and it seems appropriate</p>",
        "id": 490227756,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734727345
    },
    {
        "content": "<p>Why are tactics bad idea (in this case)?</p>\n<p>I'm sure that what the tactics have made in this case, is <code>fun n =&gt; Finsupp.mk _ (fun x =&gt; blabla) _</code>.</p>",
        "id": 490228422,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734727653
    },
    {
        "content": "<p><code>#print divisors_under_i</code> confirmed this</p>",
        "id": 490228452,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734727679
    },
    {
        "content": "<p>If that's really necessary, I can avoid tactics, sure.</p>",
        "id": 490228608,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734727753
    },
    {
        "content": "<p>Yeah, <code>intro</code>, <code>refine</code>, <code>exact</code> are all fine</p>",
        "id": 490229993,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734728445
    },
    {
        "content": "<p>It's just a bit of an orange flag, because using more complex tactics in the definition makes it harder to prove things about it</p>",
        "id": 490230095,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734728509
    },
    {
        "content": "<p>Ok, it seems I have finished it. Thank you!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">divisors_under_i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→₀</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Finsupp</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n<span class=\"w\">   </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorization</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span>\n<span class=\"w\">   </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorization</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">   </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">       </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">H2</span><span class=\"w\"> </span><span class=\"n\">H3</span><span class=\"w\"> </span><span class=\"n\">H4</span>\n<span class=\"w\">         </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">H4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">H5</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">?_⟩</span>\n<span class=\"w\">         </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">dvd_iff_one_le_factorization</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">H3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H5</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">         </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">not_succ_le_zero</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">       </span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">         </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">factorization_eq_zero_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">         </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">H2</span>\n<span class=\"w\">         </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">H2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">H1</span><span class=\"bp\">⟩</span>\n<span class=\"w\">   </span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 490230654,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734728820
    },
    {
        "content": "<p>how about</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">divisors_under_i</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→₀</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">factorization</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 490231077,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734729049
    },
    {
        "content": "<p><span aria-label=\"snail\" class=\"emoji emoji-1f40c\" role=\"img\" title=\"snail\">:snail:</span></p>",
        "id": 490231124,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1734729083
    },
    {
        "content": "<p>i suspect this will give better api</p>",
        "id": 490231169,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734729121
    },
    {
        "content": "<p>Yes, this looks like 100 times more reasonable</p>",
        "id": 490231530,
        "sender_full_name": "Ilmārs Cīrulis",
        "timestamp": 1734729328
    }
]