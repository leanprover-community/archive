[
    {
        "content": "<p>I am confused about the various notions of finiteness (or is it by coercions?).</p>\n<p>In the following example, hovering over the proof state tells me that <code>fixedPoints f</code> is indeed a <code>Set α</code> as I expected, so I don't understand why rewriting fails (there is a long error message but I don't understand it)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Function</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hcfp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fixedPoints</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∅</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixedPoints</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>In my original code <code>f</code> had type <code>Equiv.Perm α</code> so that there was an additional coercion to <code>α → α</code>, but this doesn't seem to be the source of the problem.</p>\n<p>(Also, I notice there are two different symbols for coercions, <code>↑</code> and <code>⇑</code>; I don't think I understand the difference between the two.)</p>",
        "id": 554132828,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1762445675
    },
    {
        "content": "<blockquote>\n<p>(there is a long error message but I don't understand it)</p>\n</blockquote>\n<p>Post it anyway! Plenty of people here will understand it!</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Tactic `rewrite` failed: motive is not type correct:\n  fun _a =&gt; Fintype.card ↑_a = 0\n</code></pre></div>\n<p>The answer is that you're in constructivist hell. If you're not a constructivist then you can use <code>Nat.card</code> instead of <code>Fintype.card</code> and then the rewrite works fine and you can solve the resulting goal with <code>simp</code>. Or are you specifically interested in a constructivist solution?</p>",
        "id": 554134866,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762446176
    },
    {
        "content": "<p><code>⇑</code> is speficially for coercion to functions (e.g. from a monoid homomorphism to a function), and <code>↑</code> is a generic coercion.</p>",
        "id": 554135102,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762446230
    },
    {
        "content": "<p><code>rw! (castMode := .all) [h]</code> works</p>",
        "id": 554135575,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762446353
    },
    {
        "content": "<p>as does <code>simp [h]</code></p>",
        "id": 554135697,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1762446379
    },
    {
        "content": "<p>Thanks!</p>\n<p>I would certainly not define myself as a constructivist, but I was on the way to using <code>Equiv.Perm.card_fixedPoints</code>, which uses <code>Fintype.card</code>, so that was what I tried to use.</p>\n<p>Good to know that <code>simp [h]</code> works - but it still looks a little like black magic to me.</p>",
        "id": 554139389,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1762447310
    },
    {
        "content": "<p>Lean doesn't do magic and there's certainly an explanation, but it's technical. I believe that there is some extension of <code>rw</code> in the works that will simply work and not give you this obscure error.</p>",
        "id": 554204831,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1762470269
    },
    {
        "content": "<p>I just remembered there's a better way to do this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Function</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">hcfp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fixedPoints</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∅</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fixedPoints</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card_congr'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Elem</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 554205643,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762470667
    },
    {
        "content": "<p>In what sense is it better?</p>",
        "id": 554206613,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1762471225
    },
    {
        "content": "<p>I don't know</p>",
        "id": 554206863,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762471323
    },
    {
        "content": "<p>it just seemed like using the dedicated lemma would be better</p>",
        "id": 554206898,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762471338
    }
]