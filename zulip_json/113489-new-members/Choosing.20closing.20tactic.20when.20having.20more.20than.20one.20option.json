[
    {
        "content": "<p>Suppose you have a goal that several tactics below could close. What practical rules of thumb or heuristics help you decide which terminal tactic to apply?</p>\n<p>For example:</p>\n<ul>\n<li>If both <code>simp</code> and <code>aesop</code> would close the goal, prefer <code>simp</code> (it’s usually faster).</li>\n<li>If both <code>apply […]</code> and <code>exact […]</code> would close the goal, prefer <code>exact […]</code>.</li>\n<li>And so on.</li>\n</ul>\n<p>Here is a preliminary list of tactics to consider:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">abel</span>\n<span class=\"n\">aesop</span>\n<span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">congr</span>\n<span class=\"n\">contradiction</span>\n<span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">decide</span>\n<span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">field_simp</span>\n<span class=\"n\">grind</span>\n<span class=\"n\">infer_instance</span>\n<span class=\"n\">linarith</span>\n<span class=\"n\">linear_combination</span>\n<span class=\"n\">norm_num</span>\n<span class=\"n\">norm_num1</span>\n<span class=\"n\">omega</span>\n<span class=\"n\">positivity</span>\n<span class=\"n\">rfl</span>\n<span class=\"n\">ring</span>\n<span class=\"n\">ring_nf</span>\n<span class=\"n\">ring1</span>\n<span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">simp</span>\n<span class=\"n\">simp_all</span>\n<span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n<span class=\"n\">simpa</span>\n<span class=\"n\">tauto</span>\n<span class=\"n\">use</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">…</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 528036689,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752139474
    },
    {
        "content": "<p>I never use apply, as a rule of thumb (refine/exact instead)</p>",
        "id": 528042706,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752141336
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Is that the recommendation for Mathlib as well?</p>",
        "id": 528393523,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752260808
    },
    {
        "content": "<p>Would it be possible be to establish a simple, rule‐of‐thumb ranking of tactics so that whenever two or more will solve a goal, we generally pick the one that appears earlier on the list?</p>\n<p>For example, one might imagine something like this (hypothetically):</p>\n<p>1. <code>exact […]</code> (cheapest?, requires no extra tactic import)<br>\n  2. <code>simp</code> (usually cheap, requires no extra tactic import)<br>\n  3. <code>grind</code> (usually cheap, requires no extra tactic import)<br>\n  …<br>\n  10. <code>aesop</code> (somewhat costly, requires tactic import)<br>\n  …</p>\n<p>Of course, it won’t be perfectly accurate in every case, but it can serve as a useful first-order heuristic.</p>\n<p>Would the list above serve as a reasonable initial ordering? What additional tactics might we include?</p>",
        "id": 528394745,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752261487
    },
    {
        "content": "<ol>\n<li>cheapest: exact, refine</li>\n<li>very cheap: rintro, cases, induction, subst, rcases, by_cases, generalize</li>\n<li>cheap: rw, conv</li>\n<li>moderate: simp (beware of \"non-terminal simp\")</li>\n<li>heavy: ring, omega, aesop, norm_num, grind, linarith</li>\n</ol>",
        "id": 528395298,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752261764
    },
    {
        "content": "<p>something like this <span class=\"user-mention\" data-user-id=\"683979\">@Isak Colboubrani</span></p>",
        "id": 528395313,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752261770
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> That’s an excellent foundation. Thanks a lot! Which buckets would you assign <code>tauto</code> and <code>abel</code> to, respectively? I assume <code>rfl</code> also belongs to the most cost-effective bucket (though it does carry the caveat \"beware of defeq abuse\"), right?</p>",
        "id": 528396422,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752262374
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"683979\">@Isak Colboubrani</span> I've made full statistics in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Tactic.20uses.20in.20mathlib/with/528397427\">#mathlib4 &gt; Tactic uses in mathlib</a></p>",
        "id": 528397482,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752263028
    },
    {
        "content": "<p>Honestly, I don't think that such a linear ranking will always yield something desirable.</p>",
        "id": 528402086,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1752265625
    },
    {
        "content": "<p>Kenny, <code>apply</code> improved a lot since the mathlib3 days.  I still have a little bit of a prejudice against it, but I actually like it much more than I used to.</p>",
        "id": 528402226,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1752265702
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20closing.20tactic.20when.20having.20more.20than.20one.20option/near/528395298\">said</a>:</p>\n<blockquote>\n<ol>\n<li>heavy: ring, omega, aesop, norm_num, grind, linarith</li>\n</ol>\n</blockquote>\n<p>I'll note that tactics like <code>ring</code> and <code>norm_num</code> and <code>linarith</code> are more readable to a human than <code>grind</code> or <code>aesop</code>, so if performance is similar, should be chosen instead</p>",
        "id": 528402239,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1752265711
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20closing.20tactic.20when.20having.20more.20than.20one.20option/near/528397482\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"683979\">Isak Colboubrani</span> I've made full statistics in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Tactic.20uses.20in.20mathlib/with/528406973\">#mathlib4 &gt; Tactic uses in mathlib</a></p>\n</blockquote>\n<p>Do you mean performance statistics? I'm afraid I couldn't find any performance statistics in that thread.</p>",
        "id": 528414755,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752274153
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20closing.20tactic.20when.20having.20more.20than.20one.20option/near/528402086\">said</a>:</p>\n<blockquote>\n<p>Honestly, I don't think that such a linear ranking will always yield something desirable.</p>\n</blockquote>\n<p>Great point! Since it’s meant just as a first-pass guideline, I know it won’t <em>always</em> pick the best tactic. Do you have any examples where a simple linear ranking leads to less-than-ideal results? I understand such examples do exist and I’d appreciate learning from them.</p>",
        "id": 528416499,
        "sender_full_name": "Louis Cabarion",
        "timestamp": 1752275808
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20closing.20tactic.20when.20having.20more.20than.20one.20option/near/528402226\">said</a>:</p>\n<blockquote>\n<p>Kenny, <code>apply</code> improved a lot since the mathlib3 days.  I still have a little bit of a prejudice against it, but I actually like it much more than I used to.</p>\n</blockquote>\n<p>Out of curiosity, what were the downsides of apply that have been since ameliorated? Performance? Maintainability in the face of library changes? Something else?</p>",
        "id": 528469699,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752337751
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"662452\">@Jason Reed</span> the main reason why I avoided <code>apply</code> is because it wouldn't know actually how many holes to leave us with</p>",
        "id": 528473483,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341735
    },
    {
        "content": "<p>theoretically if i have f : A -&gt; B -&gt; C -&gt; D and goal is C -&gt; D and i do <code>apply f</code> then I should end up with two goals, which are A and B</p>",
        "id": 528473531,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341773
    },
    {
        "content": "<p>but sometimes it gets stuck trying to unify D (output of f) with C -&gt; D (goal)</p>",
        "id": 528473548,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341790
    },
    {
        "content": "<p>Ah, I see, makes sense, thanks for explaining. I think in practice so far in my use of it it's been such that it <em>usually</em> leaves me with one hole. I can see how that would be undesirable to leave in the final proof. I do find myself using <code>apply</code> and then <code>show_term</code> to get out the <code>refine</code> that I actually leave as the final proof.</p>",
        "id": 528473606,
        "sender_full_name": "Jason Reed",
        "timestamp": 1752341854
    },
    {
        "content": "<p>so instead of <code>apply f</code> i just manually specify the correct number of holes as <code>refine f ?_ ?_</code></p>",
        "id": 528473661,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752341904
    },
    {
        "content": "<p>Yeah, once I understood how refine works I really can't not use it. Truly a hidden champion tactic</p>",
        "id": 528489300,
        "sender_full_name": "metakuntyyy",
        "timestamp": 1752361582
    }
]