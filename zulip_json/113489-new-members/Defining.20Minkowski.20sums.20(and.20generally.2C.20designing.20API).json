[
    {
        "content": "<p>This is probably more a question on defining the \"right\" API for a new definition than it is about a specific definition.</p>\n<p><code>#synth Add (Set ℝ)</code> does not find anything, so I assume Mathlib does not know about the general Minkowski sum of two sets. So, I tried writing a definition in Lean - and in the process, maybe learn a bit more on defining things \"right\".</p>\n<p>My first definition went like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Msum</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">v</span>\n</code></pre></div>\n<p>But here, I am using the \"sets are predicates\" definition, so I should probably use the existing API for the image of a set by a mapping. So, my second definition was:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Msum2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s1</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"w\">  </span><span class=\"n\">s1</span><span class=\"w\"> </span><span class=\"bp\">×ˢ</span><span class=\"w\"> </span><span class=\"n\">s2</span>\n</code></pre></div>\n<p>(Is there a way to use the image without uncurrying the function?)</p>\n<p>From there, I proceeded to prove associativity, and define instances of semigroup or monoid structures on <code>Set M</code> from the corresponding assumptions on <code>M</code>. But my proofs seem very clumsy - probably, partly due to lack of familiarity on my part, but also because I did not define a proper API around my definitions.</p>\n<p>So - how does one decide what the \"right\" API would be for a new notion?</p>\n<p>Also, defining an additive monoid structure on <code>Set M</code> requires defining a scalar multiplication by naturals, meaning  <code>3 • ({2, 3}: Set ℕ)</code> would denote the set <code>{6,7,8,9}</code> and not the set <code>{6,9}</code> of images under the \"times three\" mapping which would be a natural choice in other contexts. Again, I'm not sure what the best thing to do would be (or even if there is a right one).</p>\n<p>I've been reading resources such as <strong>Mathematics in Lean</strong>, which explains (not always in full detail) <em>why</em> some things are set up the way they are, but it does not tell me how to decide <em>how</em> things should be set up.</p>",
        "id": 516445091,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1746538042
    },
    {
        "content": "<p>Mathlib does know about the Minkowski sum, but it's not available without opening a scope.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Pointwise</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 516446099,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1746538283
    },
    {
        "content": "<p>It's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.add#doc\">docs#Set.add</a><br>\nYou can look around in this file to see how this is implemented, and how the API is designed.</p>",
        "id": 516446422,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1746538352
    },
    {
        "content": "<p>To find out whether something is already defined in Mathlib, there are several ways. The thing you did (checking #synth) is a good one, but here it failed because it's hidden behind a scope. Other ways are: </p>\n<ul>\n<li>grepping to see if \"Minkowski sum\" is mentioned somewhere (it's not)</li>\n<li>Ask loogle (<a href=\"https://loogle.lean-lang.org\">https://loogle.lean-lang.org</a>) about <code>(_ : Set _) + (_ : Set _)</code> (it works)</li>\n<li>Ask leansearch (<a href=\"https://leansearch.net/\">https://leansearch.net/</a>) about the Minkowski sum (it gives some good answers)</li>\n</ul>",
        "id": 516448019,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1746538767
    },
    {
        "content": "<p>Thanks! I also tried looking for Minkowski in the general documentation, but failed to try loogle because I'm not familiar enough with the patterns to search for.</p>\n<p>And as I suspected, there is a lot of API in the existing files.</p>",
        "id": 516449036,
        "sender_full_name": "Philippe Duchon",
        "timestamp": 1746539012
    },
    {
        "content": "<p>Arguably <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.add#doc\">docs#Set.add</a> should mention \"Minkowski sum\".</p>",
        "id": 516621860,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746609915
    }
]