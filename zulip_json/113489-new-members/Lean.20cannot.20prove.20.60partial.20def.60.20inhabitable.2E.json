[
    {
        "content": "<p>Lean is giving me the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">partial'</span><span class=\"w\"> </span><span class=\"n\">definition</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">least_until'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">prove</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">nonempty</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Despite me seemingly inhabiting the type myself!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">    Parses the least amount of the original term until the specified end.</span>\n<span class=\"sd\">    Will only provide the error of the expected end.</span>\n<span class=\"sd\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">my</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;&amp;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">([],</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;?&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"bp\">?&gt;</span><span class=\"w\"> </span><span class=\"n\">err</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I am really unsure where I am supposed to go from here, from what I can tell the type signature is perfectly sensible for <code>partial</code> parser combinator code, notably <code>Parser.most</code> does not give this error.</p>\n<p>The file is hosted at <a href=\"https://github.com/Vi-Kitten/Bloom/blob/00baa16/Bloom/Parser.lean\">https://github.com/Vi-Kitten/Bloom/blob/00baa16/Bloom/Parser.lean</a> and should work without context!</p>",
        "id": 538047983,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215424
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538047983\">said</a>:</p>\n<blockquote>\n<p>Despite me seemingly inhabiting the type myself!</p>\n</blockquote>\n<p>if you mean that the body of the <code>partial</code> is supposed to serve as evidence for the type being inhabited, then that's a circular argument since it references itself</p>",
        "id": 538048077,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215572
    },
    {
        "content": "<p>you should try writing an <code>Inhabited</code> instance for <code>Parser t e m a</code></p>",
        "id": 538048118,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215624
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048077\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538047983\">said</a>:</p>\n<blockquote>\n<p>Despite me seemingly inhabiting the type myself!</p>\n</blockquote>\n<p>if you mean that the body of the <code>partial</code> is supposed to serve as evidence for the type being inhabited, then that's a circular argument since it references itself</p>\n</blockquote>\n<p>Well yes, it does reference itself, that is why I am working within the <code>partial</code> system so I can write general recursive functions!</p>",
        "id": 538048125,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215626
    },
    {
        "content": "<p>consider this <code>partial</code> definition which is clearly unsound</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">failed to compile 'partial' definition 'notgood', could not prove that the type</span>\n<span class=\"cm\">  Nat → Empty</span>\n<span class=\"cm\">is nonempty.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">notgood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">notgood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 538048187,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215707
    },
    {
        "content": "<p>would you consider the body of this definition as \"evidence\" that the type is inhabited</p>",
        "id": 538048202,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215726
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048187\">said</a>:</p>\n<blockquote>\n<p>consider this <code>partial</code> definition which is clearly unsound</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">failed to compile 'partial' definition 'notgood', could not prove that the type</span>\n<span class=\"cm\">  Nat → Empty</span>\n<span class=\"cm\">is nonempty.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">notgood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Empty</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">notgood</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>In a partial system I would consider it inhabited with the bottom instance.</p>",
        "id": 538048224,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215769
    },
    {
        "content": "<p>but Lean is not a partial system!</p>",
        "id": 538048225,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215778
    },
    {
        "content": "<p>what <code>partial</code> does is it makes an <code>opaque</code> definition, and then it overrides the implementation in the compiler</p>",
        "id": 538048244,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215805
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048225\">said</a>:</p>\n<blockquote>\n<p>but Lean is not a partial system!</p>\n</blockquote>\n<p>Is <code>partial</code> not a true subsystem?</p>",
        "id": 538048245,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215807
    },
    {
        "content": "<p>and it needs a value to inhabit the <code>opaque</code> with</p>",
        "id": 538048253,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215817
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048245\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048225\">said</a>:</p>\n<blockquote>\n<p>but Lean is not a partial system!</p>\n</blockquote>\n<p>Is <code>partial</code> not a true subsystem?</p>\n</blockquote>\n<p>the thing with <code>partial def</code> is that you use them in your theorems</p>",
        "id": 538048309,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215885
    },
    {
        "content": "<p>so if Lean allowed me to write <code>partial def notgood</code> then I could use it in a theorem</p>",
        "id": 538048328,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215916
    },
    {
        "content": "<p><a href=\"https://lean-lang.org/doc/reference/latest/Definitions/Recursive-Definitions/#partial-functions\">Here's some explanation</a> in the reference that you might find helpful</p>",
        "id": 538048333,
        "sender_full_name": "Eric Paul",
        "timestamp": 1757215920
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048309\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048245\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048225\">said</a>:</p>\n<blockquote>\n<p>but Lean is not a partial system!</p>\n</blockquote>\n<p>Is <code>partial</code> not a true subsystem?</p>\n</blockquote>\n<p>the thing with <code>partial def</code> is that you use them in your theorems</p>\n</blockquote>\n<p>Is that a typo, or are they actually valid in theorems?</p>",
        "id": 538048341,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215930
    },
    {
        "content": "<p>oh god they are!?</p>",
        "id": 538048352,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215937
    },
    {
        "content": "<p>and it's a theorem that there are no functions <code>Nat → Empty</code>, but I've just constructed one here with the <code>partial</code> system</p>",
        "id": 538048366,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215973
    },
    {
        "content": "<p>and that would be really bad</p>",
        "id": 538048372,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215979
    },
    {
        "content": "<p>which is why it rejects this</p>",
        "id": 538048379,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757215985
    },
    {
        "content": "<p>This is quite the headache! Does lean have a partial subsystem then with fun things like y combintors and whatnot?</p>",
        "id": 538048380,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757215986
    },
    {
        "content": "<p>well you can do <code>unsafe</code></p>",
        "id": 538048405,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216005
    },
    {
        "content": "<p>which doesn't require proofs that your types are nonempty</p>",
        "id": 538048418,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216021
    },
    {
        "content": "<p>but you can't use those in proofs</p>",
        "id": 538048425,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216032
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048405\">said</a>:</p>\n<blockquote>\n<p>well you can do <code>unsafe</code></p>\n</blockquote>\n<p>that sounds so much dirtier then it is, if you don't mind specifying, how would you go about solving this issue, because I honestly have no clue!</p>",
        "id": 538048456,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216082
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048352\">said</a>:</p>\n<blockquote>\n<p>oh god they are!?</p>\n</blockquote>\n<p>you can use them in theorems, but you can't replace them with their definition</p>",
        "id": 538048467,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216100
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048456\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048405\">said</a>:</p>\n<blockquote>\n<p>well you can do <code>unsafe</code></p>\n</blockquote>\n<p>that sounds so much dirtier then it is, if you don't mind specifying, how would you go about solving this issue, because I honestly have no clue!</p>\n</blockquote>\n<p>I recommend just writing the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Inhabited#doc\">docs#Inhabited</a> instance</p>",
        "id": 538048491,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216137
    },
    {
        "content": "<p>this is what they do in Core for monads like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.MetaM#doc\">docs#Lean.Meta.MetaM</a></p>",
        "id": 538048501,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216149
    },
    {
        "content": "<p>Just before I go to sleep, am I supposed to instance something like <code>Inhabited</code> inductively on a bunch of families of things like parsers and functions between parsers? Because in the general case a parser <em>isn't</em> inhabited, only functions between parsers are!</p>",
        "id": 538048607,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216279
    },
    {
        "content": "<p>wait parsers aren't generally inhabited?</p>",
        "id": 538048618,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216298
    },
    {
        "content": "<p>there's not some error value you can always return?</p>",
        "id": 538048621,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216310
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048621\">said</a>:</p>\n<blockquote>\n<p>there's not some error value you can always return?</p>\n</blockquote>\n<p>I am polymorphic over error types, and don't want to make assumptions about said types!</p>",
        "id": 538048641,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216339
    },
    {
        "content": "<p>I have <code>DefaultErr</code> but thats for when its actually needed, not it situations like this where, intuitively, its sound (in a partial system) but just not garunteed to halt.</p>",
        "id": 538048660,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216374
    },
    {
        "content": "<p>make an instance assuming certain types are inhabited</p>",
        "id": 538048664,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216385
    },
    {
        "content": "<p>see for example <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=EStateM.instInhabited#doc\">docs#EStateM.instInhabited</a></p>",
        "id": 538048685,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216411
    },
    {
        "content": "<p>I could only assume the erorr was inhabited or the instance, not both, both would be too restricting</p>",
        "id": 538048718,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216461
    },
    {
        "content": "<p>I also worry that such constraints would be viral</p>",
        "id": 538048736,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216477
    },
    {
        "content": "<p>then this might be a bit difficult</p>",
        "id": 538048753,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216506
    },
    {
        "content": "<p>What confuses me most is that:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">    Repeaedly parses until failure.</span>\n<span class=\"sd\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">most</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mx</span>\n<span class=\"w\">        </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">most</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;?&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">    Parses the least amount of the original term until the specified end.</span>\n<span class=\"sd\">    Will only provide the error of the expected end.</span>\n<span class=\"sd\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">my</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;&amp;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">([],</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;?&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"bp\">?&gt;</span><span class=\"w\"> </span><span class=\"n\">err</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><code>Parser.most</code> is fine and <code>Parser.least_until</code> is angry!</p>",
        "id": 538048776,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216546
    },
    {
        "content": "<p>well <code>Parser.most</code> doesn't call itself recursively it looks like</p>",
        "id": 538048790,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216576
    },
    {
        "content": "<p>no it does how did I miss that</p>",
        "id": 538048796,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216591
    },
    {
        "content": "<p>oh it does! <code>&gt;&gt;= (fun x =&gt; List.cons x &lt;$&gt; mx.most)</code></p>",
        "id": 538048797,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216595
    },
    {
        "content": "<p>well I wouldn't know why unless you provide something I can run on my end</p>",
        "id": 538048823,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216636
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538047983\">said</a>:</p>\n<blockquote>\n<p>Lean is giving me the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">partial'</span><span class=\"w\"> </span><span class=\"n\">definition</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">least_until'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">prove</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">...</span>\n<span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">nonempty</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Despite me seemingly inhabiting the type myself!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">    Parses the least amount of the original term until the specified end.</span>\n<span class=\"sd\">    Will only provide the error of the expected end.</span>\n<span class=\"sd\">-/</span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monad</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">mx</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">my</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Parser</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">e'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;&amp;&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">([],</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"bp\">&lt;?&gt;</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"w\"> </span><span class=\"bp\">?&gt;</span><span class=\"w\"> </span><span class=\"n\">err</span>\n<span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I am really unsure where I am supposed to go from here, from what I can tell the type signature is perfectly sensible for <code>partial</code> parser combinator code, notably <code>Parser.most</code> does not give this error.</p>\n<p>The file is hosted at <a href=\"https://github.com/Vi-Kitten/Bloom/blob/00baa16/Bloom/Parser.lean\">https://github.com/Vi-Kitten/Bloom/blob/00baa16/Bloom/Parser.lean</a> and should work without context!</p>\n</blockquote>\n<p>I provided the code in the post on github, the file should work with no context, just a copy paste!</p>",
        "id": 538048845,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216668
    },
    {
        "content": "<p>My guess is that lean knows something about combinatros like <code>&gt;&gt;=</code> and <code>&lt;$&gt;</code> that it doesn't know / I haven't told it for my error recovery combinator <code>&lt;?&gt;</code>.</p>",
        "id": 538048885,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216732
    },
    {
        "content": "<p>ok it sees that <code>Parser t e' m</code> is a monad and <code>List a</code> is nonempty</p>",
        "id": 538048968,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216835
    },
    {
        "content": "<p>Alternatively, it might be that the value <code>y</code> in the inductive step:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Isn't pushed arbitrarily deep like in </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">        </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">most</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 538048979,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216853
    },
    {
        "content": "<p>so monads applied to nonempty types are always nonempty, because of <code>pure</code></p>",
        "id": 538049004,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757216868
    },
    {
        "content": "<p>I am struggling to follow in all honesty, none of this maps to something concrete I can understand in terms of leans analysis of my logic.</p>",
        "id": 538049094,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216980
    },
    {
        "content": "<p>At least, I don't see how it maps <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 538049103,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757216997
    },
    {
        "content": "<p>so in particular <code>Parser t e' m (List a)</code> is nonempty because it is a monad (<code>Parser t e' m</code>) applied to a nonempty type (<code>List a</code>) and this is all done automatically by typeclass</p>",
        "id": 538049110,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217009
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538049110\">said</a>:</p>\n<blockquote>\n<p>so in particular <code>Parser t e' m (List a)</code> is nonempty because it is a monad (<code>Parser t e' m</code>) applied to a nonempty type (<code>List a</code>) and this is all done automatically by typeclass</p>\n</blockquote>\n<p>I was hoping the reason would be something that could help me in the genreal case :(</p>",
        "id": 538049271,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217219
    },
    {
        "content": "<p>I have a feeling I can solve this by making an <code>inductive ListEndingWith a b</code> I am hoping these semantics map cleanly onto the potential issue I saw here:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538048979\">said</a>:</p>\n<blockquote>\n<p>Alternatively, it might be that the value <code>y</code> in the inductive step:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">            </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">least_until</span><span class=\"w\"> </span><span class=\"n\">my</span>\n<span class=\"w\">            </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">xs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Isn't pushed arbitrarily deep like in </p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">        </span><span class=\"bp\">&gt;&gt;=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;$&gt;</span><span class=\"w\"> </span><span class=\"n\">mx</span><span class=\"bp\">.</span><span class=\"n\">most</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Althogh I am unsure.</p>",
        "id": 538049300,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217265
    },
    {
        "content": "<p>I don't think it matters to the <code>partial</code> compiler what the contents of your definition are</p>",
        "id": 538049335,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217321
    },
    {
        "content": "<p>how does the type being inhabitable with some default value even matter when your not using that default value for your least fixed point?</p>",
        "id": 538049378,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217397
    },
    {
        "content": "<p>Sorry for only asking now, it just kind occured to me that that doesn't make sense</p>",
        "id": 538049403,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217430
    },
    {
        "content": "<p>if the type is not inhabitable and I have a proof that it's not inhabitable then I can combine it with the <code>partial</code> definition (which is an inhabitant) to get a contradiction</p>",
        "id": 538049418,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217461
    },
    {
        "content": "<p>which is really bad</p>",
        "id": 538049423,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217475
    },
    {
        "content": "<p>so all I have to do is show that you can't disprove it then? <code>(MyType -&gt; Empty) -&gt; Empty</code></p>",
        "id": 538049466,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217517
    },
    {
        "content": "<p>if you can get a <code>(MyType -&gt; Empty) -&gt; Empty</code> then you can use classical logic to prove <code>Nonempty MyType</code></p>",
        "id": 538049489,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217556
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538049418\">said</a>:</p>\n<blockquote>\n<p>if the type is not inhabitable and I have a proof that it's not inhabitable then I can combine it with the <code>partial</code> definition (which is an inhabitant) to get a contradiction</p>\n</blockquote>\n<p>Does this mean that <code>partial</code> is essentially saying:<br>\nThose code runs and you <strong>can't</strong> tell me it <strong>isn't</strong> valid.</p>",
        "id": 538049507,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217592
    },
    {
        "content": "<p>see <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nonempty#doc\">docs#Nonempty</a> for a description for how it's different from <code>Inhabited</code> (but <code>partial</code> can use either <code>Nonempty</code> or <code>Inhabited</code>)</p>",
        "id": 538049508,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217593
    },
    {
        "content": "<p>all of this is well and good but how do I handle the fact that I am only going to be able to instantiate this for functions of parsers and not parsers themselves?</p>",
        "id": 538049658,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217737
    },
    {
        "content": "<p>After learning more about this I can say that this is rather cool, although a bit unintuitive at first, its nice to know that the functions get to be consistent.</p>",
        "id": 538049781,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757217882
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"954123\">Kitsune-Violet</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538049507\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538049418\">said</a>:</p>\n<blockquote>\n<p>if the type is not inhabitable and I have a proof that it's not inhabitable then I can combine it with the <code>partial</code> definition (which is an inhabitant) to get a contradiction</p>\n</blockquote>\n<p>Does this mean that <code>partial</code> is essentially saying:<br>\nThose code runs and you <strong>can't</strong> tell me it <strong>isn't</strong> valid.</p>\n</blockquote>\n<p>iirc what <code>partial</code> does is, it adds an <code>opaque</code> constant to the environment (containing a dummy inhabitant), and it adds an <code>unsafe</code> constant to the environment (containing the actual implementation), and it tells the compiler \"this constant is <code>implemented_by</code> that constant\" and this lets the compiler use the actual implementation instead of the dummy value when running your code</p>",
        "id": 538049810,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757217924
    },
    {
        "content": "<p>The <code>opaque</code> constant is what gets the name of the <code>partial def</code></p>",
        "id": 538049875,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757218006
    },
    {
        "content": "<p>As a side note, I have recently been torn up about if I should weaken strong normalisation or not in my language and this knowledge came along right in time, thank you!</p>",
        "id": 538049880,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757218011
    },
    {
        "content": "<p>Thank you for all the help!</p>",
        "id": 538050066,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757218294
    },
    {
        "content": "<p>Oh hey, fancy seeing you here.</p>\n<p>To my understanding, <code>partial def</code> is really just a shortcut to let you say \"trust me this thing has the properties I claim it does, now let me write proofs about it assuming I'm right\"; it's at most half a step above <code>unsafe</code>. If you really want to reason strictly about partial functions, you probably want to be using either <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Part#doc\">docs#Part</a> and docs$PFun, or <code>partial_fixpoint</code></p>",
        "id": 538215390,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1757335396
    },
    {
        "content": "<p>actually, since you have to prove your type is inhabited, <code>partial</code> is actually completely safe</p>",
        "id": 538216005,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757335565
    },
    {
        "content": "<p>It's safe, but it's also completely opaque and only interacts with the rest of Lean in a minimal way, through its type signature; the only proofs you can do with a <code>partial</code> def are proofs that only use its type</p>",
        "id": 538277579,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1757350770
    },
    {
        "content": "<p>I suppose that makes it a bit more then half a step above <code>unsafe</code>, but</p>",
        "id": 538278095,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1757350955
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"359992\">Robert Maxton</span> <a href=\"#narrow/channel/113489-new-members/topic/Lean.20cannot.20prove.20.60partial.20def.60.20inhabitable.2E/near/538215390\">said</a>:</p>\n<blockquote>\n<p>Oh hey, fancy seeing you here.</p>\n<p>To my understanding, <code>partial def</code> is really just a shortcut to let you say \"trust me this thing has the properties I claim it does, now let me write proofs about it assuming I'm right\"; it's at most half a step above <code>unsafe</code>. If you really want to reason strictly about partial functions, you probably want to be using either <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Part#doc\">docs#Part</a> and docs$PFun, or <code>partial_fixpoint</code></p>\n</blockquote>\n<p>My intention is to use lean as a FP lang with the added upside that I can prove things about my programs later, but the keyword there is <strong>later</strong>, I was hoping that leans own ability to detect strong normalisation or partial signatures would be a bit stronger so I wouldn't have to resort to <code>unsafe</code> this quickly but that seems like what I have to do to maintain velocity (accounting for the time it would take me to learn)</p>\n<p>I think <code>partial</code> will probably be where I leave a lot of things eventually because lean doesn't seem to be set up for tracking monad state for recursion (I am not even sure how much research tehre is on this), with that being said thank you for the advice adn I will see if I can apply that after I have an MVP working!</p>",
        "id": 538278408,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757351095
    },
    {
        "content": "<p>If anyone has any research into a generalisation of monads using some dependent parameters that can help to prove things like halting I would be very interested as I think this is relevent to doing this erganomically!</p>",
        "id": 538278862,
        "sender_full_name": "Kitsune-Violet",
        "timestamp": 1757351293
    }
]