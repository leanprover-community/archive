[
    {
        "content": "<p>Is it possible to have such an instance in Mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">ZMod</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n</code></pre></div>\n<p>IIUC this causes a diamond in the <code>NeZero n</code> case using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.fintype#doc\">docs#ZMod.fintype</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=instFintypeUnitsOfDecidableEq#doc\">docs#instFintypeUnitsOfDecidableEq</a>, though I'm not sure about the following:</p>\n<ul>\n<li>Is this the diamond that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.card_units_eq_totient#doc\">docs#ZMod.card_units_eq_totient</a> refers to?</li>\n<li>Why is a <code>Fintype</code> diamond bad? It looks like this gives 2 ways to conclude that <code>(ZMod 5)Ë£</code> is <code>Fintype</code>, but why is more ways bad? Is this because <code>Fintype</code> \"carries data\"? Aren't all <code>Fintype</code> instances on the same type identical?</li>\n<li>Is the current situation the best possible, or is there some refactor that'll make this instance possible? I tried only having <code>instance : Fintype (ZMod 0)Ë£</code>, but Lean doesn't seem to be able to <code>by_cases NeZero n</code> when trying to resolve  type classes.</li>\n</ul>\n<p>Thanks!</p>",
        "id": 561778807,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764811120
    },
    {
        "content": "<p>Why do you want this <code>Fintype</code> at all? <code>Finite</code> avoids all data-carrying issues and if you need <code>Fintype</code> in a proof you can just create it locally from <code>Finite</code> if the system can't find it. It's only if you need this instance to make another definition that you have to solve this problem at all.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>",
        "id": 561818462,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764836999
    },
    {
        "content": "<p>It's true that all <code>Fintype</code> instances on a finite type are equal, but it's not always true that the proof that two are equal is <code>rfl</code> and that's what creates the diamond.</p>",
        "id": 561818694,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764837076
    },
    {
        "content": "<p>This is the Achilles heel of the typeclass system but in this situation it's not at all clear to me yet that you need to solve this problem.</p>\n<p>Prior discussions here <a class=\"message-link\" href=\"/#narrow/channel/113488-general/topic/fintype.20.28units.20.28zmod.20n.29.29/near/252776463\">#general &gt; fintype (units (zmod n)) @ ðŸ’¬</a>  and here <a class=\"message-link\" href=\"/#narrow/channel/144837-PR-reviews/topic/.238449.20Bounds.20for.20Dirichlet.20character.20values/near/402866446\">#PR reviews &gt; #8449 Bounds for Dirichlet character values @ ðŸ’¬</a></p>",
        "id": 561819285,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764837267
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/.60Fintype.20.28ZMod.20n.29.CB.A3.60.20diamond/near/561818462\">said</a>:</p>\n<blockquote>\n<p>Why do you want this <code>Fintype</code> at all?</p>\n</blockquote>\n<p>Is there another way to fix this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">ZMod</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">infer_instance</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Carmichael</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ArithmeticFunction</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">âŸ¨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">âŸ¨</span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">âŸ©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">âŸ©</span>\n</code></pre></div>\n<p><code>Finite</code> doesn't work even if we avoid <code>Fintype.card</code> using <code>Nat.totient</code>, because it can't synth <code>DecidablePred</code> for the <code>âˆ€ a : (ZMod n)Ë£, ...</code>.<br>\nI can't add <code>[Fintype (ZMod n)Ë£]</code> because I have to provide <code>â„• â†’ â„•</code> to <code>ArithmeticFunction â„•</code>.<br>\nI can add <code>[âˆ€ n, Fintype (ZMod n)Ë£]</code> to the <code>def</code> but that means that you have to have the same <code>instance</code> to use the function.</p>",
        "id": 561932926,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764867992
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> the way to think about Fintype is that it contains a <em>specific realisation</em> of your type as a Finset.</p>",
        "id": 561933616,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868196
    },
    {
        "content": "<p>It is true that all such finsets are equal, but they will not, as Kevin says, be definitionally equal.</p>",
        "id": 561933823,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868253
    },
    {
        "content": "<p>You might therefore want to think about what you want this realisation to be.</p>",
        "id": 561933945,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868284
    },
    {
        "content": "<p>The only workaround I found was to <code>match n</code> and only use <code>Nat.find</code> in the non-zero case.<br>\nI like this workaround (and used it in <a href=\"https://github.com/leanprover-community/mathlib4/pull/32414\">#32414</a>), but I still find it strange that this instance doesn't exist.</p>",
        "id": 561934638,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868470
    },
    {
        "content": "<p>That does feel like the right choice, but I do see your point.</p>",
        "id": 561934781,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868506
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>\n<p>To be clear I assume this works?</p>",
        "id": 561934911,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868546
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/113489-new-members/topic/.60Fintype.20.28ZMod.20n.29.CB.A3.60.20diamond/near/561934911\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">inferInstance</span>\n</code></pre></div>\n<p>To be clear I assume this works?</p>\n</blockquote>\n<p>Yes, that'sÂ <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.fintype#doc\">docs#ZMod.fintype</a>Â andÂ <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=instFintypeUnitsOfDecidableEq#doc\">docs#instFintypeUnitsOfDecidableEq</a></p>",
        "id": 561935126,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868605
    },
    {
        "content": "<p>I didn't read the backlog but</p>\n<blockquote>\n<p><code>Finite</code> doesn't work even if we avoid <code>Fintype.card</code> using <code>Nat.totient</code>, because it can't synth <code>DecidablePred</code> for the <code>âˆ€ a : (ZMod n)Ë£, ...</code>.</p>\n</blockquote>\n<p>Is it ok to <code>open Classical in</code> and accept that this will be noncomputable?</p>",
        "id": 561935172,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1764868622
    },
    {
        "content": "<p>My instinct is that <code>instFintypeUnitsOfDecidableEq</code> is the problematic of those two here in a sense - arguably that is somewhat an issue.</p>",
        "id": 561935373,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868672
    },
    {
        "content": "<p>I understand the fundamental problem, but isn't it possible to overcome it somehow?<br>\nEither with a specific solution to <code>ZMod</code>, or perhaps changing the type class system to search for <code>Subsingleton</code> instances to resolve such diamonds that aren't equal by definition (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fintype.subsingleton#doc\">docs#Fintype.subsingleton</a>).</p>",
        "id": 561935470,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868704
    },
    {
        "content": "<p>Because it is providing a very generic instance for Fintype on units, and one might reasonably say \"actually I do not want that\".</p>",
        "id": 561935493,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868711
    },
    {
        "content": "<p>The latter would be quite a large undertaking and undesirable for other reasons I <em>think</em>.</p>",
        "id": 561935584,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868742
    },
    {
        "content": "<p>I don't know enough about how instance priority works to know if the former is viable.</p>",
        "id": 561935657,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868764
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/113489-new-members/topic/.60Fintype.20.28ZMod.20n.29.CB.A3.60.20diamond/near/561935172\">said</a>:</p>\n<blockquote>\n<p>I didn't read the backlog but</p>\n<blockquote>\n<p><code>Finite</code> doesn't work even if we avoid <code>Fintype.card</code> using <code>Nat.totient</code>, because it can't synth <code>DecidablePred</code> for the <code>âˆ€ a : (ZMod n)Ë£, ...</code>.</p>\n</blockquote>\n<p>Is it ok to <code>open Classical in</code> and accept that this will be noncomputable?</p>\n</blockquote>\n<p>I really want it to be computable though</p>",
        "id": 561935682,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868771
    },
    {
        "content": "<p>I will say that I don't think your instance is a good one.</p>",
        "id": 561935719,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868782
    },
    {
        "content": "<p>I think you should fundamentally start by constructing the appropriate finset.</p>",
        "id": 561935799,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868807
    },
    {
        "content": "<p>And I wonder if you can do that without the case split.</p>",
        "id": 561935837,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868818
    },
    {
        "content": "<p>You can <code>Finset.range n</code> and <code>filter</code> on coprimes (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ZMod.unitsEquivCoprime#doc\">docs#ZMod.unitsEquivCoprime</a>)</p>",
        "id": 561935930,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868845
    },
    {
        "content": "<p>Actually that still requires the case split</p>",
        "id": 561936079,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1764868889
    },
    {
        "content": "<p>Does it?</p>",
        "id": 561936260,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868942
    },
    {
        "content": "<p>Oh because of the <code>range</code> thing.</p>",
        "id": 561936332,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764868968
    },
    {
        "content": "<p>Right yes because <code>totient 0</code> is <code>0</code>.</p>",
        "id": 561936907,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764869145
    },
    {
        "content": "<p>Yeah it sort of feels like possibly it can't be done except with the case split.</p>",
        "id": 561937557,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764869329
    },
    {
        "content": "<blockquote>\n<p>I really want it to be computable though</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">DecidablePred</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"bp\">â–¸</span><span class=\"w\"> </span><span class=\"n\">UnitsInt</span><span class=\"bp\">.</span><span class=\"n\">fintype</span>\n<span class=\"w\">    </span><span class=\"n\">inferInstance</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"n\">haveI</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">NeZero</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">hn</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">    </span><span class=\"n\">inferInstance</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Carmichael</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ArithmeticFunction</span><span class=\"w\"> </span><span class=\"n\">â„•</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">âŸ¨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">âˆ¨</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">âˆ§</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"bp\">âŸ¨</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ZMod</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">Ë£</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"bp\">.</span><span class=\"n\">ofFinite</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">card_eq_fintype_card</span><span class=\"o\">]</span><span class=\"bp\">âŸ©</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">âŸ©</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">Carmichael</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"w\"> </span><span class=\"c1\">-- 20</span>\n</code></pre></div>",
        "id": 561959663,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764876591
    },
    {
        "content": "<p>Now you have an instance diamond for the and instance too</p>",
        "id": 562002567,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1764896554
    },
    {
        "content": "<p>I don't understand that last comment, but at the end of the day I don't really see the point in making this function computable anyway -- there's a formula for it and  working it out by brute force is far more inefficient.</p>",
        "id": 562033572,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764918741
    }
]