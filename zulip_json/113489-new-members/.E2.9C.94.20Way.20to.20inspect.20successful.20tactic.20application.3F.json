[
    {
        "content": "<p>Hello, hopefully this is something simple that I missed in the docs / tutorials, but I was curious if it is at all possible to inspect some of the steps a tactic takes when it is successful in reaching a goal?  I'm curious because I suspect it will help me build better intuitions for how specific tactics solve goals, which tactics do what, and why an existing theorem employed one tactic as opposed to a similar set of other ones.</p>",
        "id": 497190508,
        "sender_full_name": "Zach Collins",
        "timestamp": 1738437433
    },
    {
        "content": "<p>Tactics often have tracing options such as <code>set_option trace.Meta.Tactic.simp.rewrite</code> that you can use (and find via the auto completion in <code>set_option</code> or grepping through the code base). That being said I don't necessarily think looking at these is helpful to figure out what a tactic can solve, the technical details of how a tactic solves something are often much scarier than the documentation that describes what they can solve</p>",
        "id": 497190668,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1738437577
    },
    {
        "content": "<p>I completely agree with what Henrik said.  However, I also remember being curious about this.</p>",
        "id": 497190819,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738437680
    },
    {
        "content": "<p>You can use <code>show_term</code> before a tactic (or tactic sequence) to get Lean to show you what term it produced.  This should satisfy your curiosity pretty quickly!</p>",
        "id": 497190820,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738437681
    },
    {
        "content": "<p>I'll play with the tracing, I appreciate!  Some tactics are straightforward and the documentation is easy enough.  I think other tactics feel more confusing, especially when they can be overloaded.  <code>linarith</code> was an example where I was trying to really wrap my mind around the strategies it does and does not employ.  But I guess that's what you mean by \"details are scarier than the documentation\".</p>",
        "id": 497190833,
        "sender_full_name": "Zach Collins",
        "timestamp": 1738437689
    },
    {
        "content": "<p>Oh, show_term looks helpful, thank you!</p>",
        "id": 497190850,
        "sender_full_name": "Zach Collins",
        "timestamp": 1738437708
    },
    {
        "content": "<p>It <em>looks</em> helpful, but most tactics do not generate human-readable proofs.</p>",
        "id": 497190911,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738437731
    },
    {
        "content": "<p>That's fair, and I don't need to see the proof.  Anything that helps me build an intuition when I have a moment of, \"wait, why did this tactic work or not work?\"</p>",
        "id": 497190941,
        "sender_full_name": "Zach Collins",
        "timestamp": 1738437763
    },
    {
        "content": "<p>Often, you can scan the output of <code>show_term</code> and see whether you find some specific lemma that was used.  However, the tactics that do have some form of tracing enabled will give you a better understanding, generally speaking.</p>",
        "id": 497191023,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1738437831
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"812775\">Zach Collins</span> has marked this topic as resolved.</p>",
        "id": 497204580,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738449361
    },
    {
        "content": "<p>I am not at all convinced that <code>show_term</code> will give any intuition whatsoever about <code>linarith</code>. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">show_term</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"c1\">-- aaaargh</span>\n</code></pre></div>",
        "id": 497209217,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738454051
    },
    {
        "content": "<p>This has given me some (not a lot) of intuition about how <code>linarith</code> works including:<br>\nIt reasons by contradiction (but I knew this already)<br>\nIt uses <code>ring</code> internally<br>\n<del>It</del> <code>ring</code> uses <code>norm_num</code> internally<br>\nIt takes simple linear combinations of hypotheses<br>\nIt uses <code>lt_irrefl</code> to make contradictions</p>",
        "id": 497209937,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738454650
    },
    {
        "content": "<p>Actually, most of the aaaargh is just <code>ring</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">le_of_not_gt</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">lt_irrefl</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">congrArg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">add_neg</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">add_lt_of_neg_of_le</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">add_lt_of_neg_of_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">neg_neg_of_pos</span><span class=\"w\"> </span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">zero_lt_one</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">sub_nonpos_of_le</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">))</span>\n<span class=\"w\">          </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">sub_nonpos_of_le</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">))</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Linarith</span><span class=\"bp\">.</span><span class=\"n\">sub_neg_of_lt</span><span class=\"w\"> </span><span class=\"n\">a_1</span><span class=\"o\">)))</span>\n</code></pre></div>",
        "id": 497209950,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738454676
    },
    {
        "content": "<p>I definitely did learn some of those  things you just mentioned, from examining show_term output in all fairness.  Yes I had to filter noise but it did help me understand the organization of various lemmas and what a strategy is doing.  But I'm new to lean and I see a lot of tactics and I'm still piecing very naive ideas together about what it actually does.</p>",
        "id": 497214919,
        "sender_full_name": "Zach Collins",
        "timestamp": 1738459954
    }
]