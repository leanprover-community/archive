[
    {
        "content": "<p>Is it possible to access declaration with private modifier? In particular I want to use <code>Lean.Elab.Term.declValToTerm</code> in implementation of my macro. I've tried with <code>open private</code> from mathlib:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">declValToTerm</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Term</span>\n</code></pre></div>\n<p>but it doesn't work.</p>",
        "id": 502462984,
        "sender_full_name": "MrQubo",
        "timestamp": 1740700188
    },
    {
        "content": "<p>Probably a better question is \"why was it marked private and what am I supposed to be using instead\" :-) (disclaimer: I don't have a clue about this part of the code base)</p>",
        "id": 502463314,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1740700390
    },
    {
        "content": "<p>I agree. But in this case I went though the code, and I'm afraid there's no answer to the second question. :( I would prefer to import that function instead of copy-pasting.</p>",
        "id": 502465234,
        "sender_full_name": "MrQubo",
        "timestamp": 1740701467
    },
    {
        "content": "<p>I would say don't but this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">run_cmd</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"ss\">`_private.Lean.Elab.MutualDef</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"ss\">`Lean.Elab.Term.declValToTerm</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">OpenDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"ss\">`declValToTerm</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">modifyScope</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">openDecls</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">decl</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">scope</span><span class=\"bp\">.</span><span class=\"n\">openDecls</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>Also, <code>open private declValToTerm from Lean.Elab.MutualDef</code> would work.</p>",
        "id": 502618097,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1740760290
    },
    {
        "content": "<p>Yeah, the syntax is <code>open private $name from $module</code>, rather than <code>... from $namespace</code>. It's a bit unexpected, but it's mentioned in the docstring for <code>open private</code>.</p>\n<p>There's also <code>open private $name in $declName</code>, which searches for any private names in the declaration <code>$declName</code> that match <code>$name</code>. It's odd, but it's one of the ways you can semi-reliably refer to a private declaration.</p>",
        "id": 502622546,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740761586
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">MrQubo</span> <a href=\"#narrow/channel/113489-new-members/topic/Accessing.20private.20declarations/near/502465234\">said</a>:</p>\n<blockquote>\n<p>I'm afraid there's no answer to the second question</p>\n</blockquote>\n<p>The answer might be \"don't do this expansion, and instead rely on the <code>def</code>/<code>example</code>/... elaborator to do it for you\". It's possible that you need to expand <code>declVal</code> yourself, but it also might possibly be avoidable.</p>",
        "id": 502622888,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1740761689
    },
    {
        "content": "<p>It's for a macro mentioned in that topic: <a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/Syntactically.20separate.20goals.20from.20code/near/502457804\">#new members &gt; Syntactically separate goals from code @ ðŸ’¬</a> </p>\n<p>I cannot elaborate declVal there, it would fail. And the way the macro is implemented requires me to get rid of declaration syntax sugar and get a single term.</p>",
        "id": 502698845,
        "sender_full_name": "MrQubo",
        "timestamp": 1740795164
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"873547\">@Robin Arnez</span> and <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> !</p>",
        "id": 502742164,
        "sender_full_name": "MrQubo",
        "timestamp": 1740832526
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"870257\">MrQubo</span> has marked this topic as resolved.</p>",
        "id": 502742168,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740832532
    }
]