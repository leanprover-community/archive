[
    {
        "content": "<p>I am trying to construct a macro that takes a term <code>tm</code> and a type <code>ty</code>, then constructs the term `( ($tm:$ty)).  I can get the individual steps to work, but not the whole thing:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"tycheck2\"</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">tycheck2</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"c1\">-- OK: pass in just the term</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"tycheck3\"</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ty</span><span class=\"o\">))</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">tycheck3</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"c1\">-- OK: pass in just the type</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"tycheck4\"</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">tycheck4</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\">  </span><span class=\"c1\">-- FAIL with error message \"unexpected end of input\"</span>\n</code></pre></div>\n<p>What's the best way to construct a type assertion from two terms?</p>\n<p>-mark</p>",
        "id": 494409447,
        "sender_full_name": "Mark Aagaard",
        "timestamp": 1737135911
    },
    {
        "content": "<p>The problem here isn't in the construction, but in the syntax definition. There's an ambiguity: <code>4 Nat</code> is a valid term, so <code>tm</code> matches that.</p>",
        "id": 494409644,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737135980
    },
    {
        "content": "<p>Try doing <code>tm:term:arg</code> and <code>ty:term:arg</code> to set the ambient precedences of those terms to be at the argument level</p>",
        "id": 494409708,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737136011
    },
    {
        "content": "<p><code>arg</code> level can't match <code>4 Nat</code>, just <code>4</code>.</p>",
        "id": 494409751,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1737136027
    },
    {
        "content": "<p>Kyle-<br>\nThanks, that makes sense.  <br>\n-mark</p>",
        "id": 494413666,
        "sender_full_name": "Mark Aagaard",
        "timestamp": 1737137466
    }
]