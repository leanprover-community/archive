[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span><span class=\"w\"> </span><span class=\"n\">Diamond</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dia</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span>\n\n<span class=\"kd\">notation</span><span class=\"w\"> </span><span class=\"s2\">\"⋄\"</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Diamond.dia</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"n\">instDiaZero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Diamond</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dia</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"n\">instDiaOne</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Diamond</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dia</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- there are two instances</span>\n<span class=\"c1\">-- but latter is used</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⋄</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">default_instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">instDiaZero</span>\n\n<span class=\"c1\">-- [default_instance] attribute does nothing</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⋄</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"kd\">end</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">priority</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">high</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">instDiaZero'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Diamond</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dia</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kd\">instance</span><span class=\"w\"> </span><span class=\"n\">instDiaOne'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Diamond</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">dia</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"c1\">-- priority works</span>\n<span class=\"bp\">#</span><span class=\"n\">guard</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⋄</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 472061050,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1727023548
    },
    {
        "content": "<p>I do not understand why this behaviour occurs. Please tell me what is the difference between giving the <code>[default_instance]</code> attribute and setting the priority of the instance high.</p>",
        "id": 472061208,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1727023617
    },
    {
        "content": "<p><code>default_instance</code> is orthogonal to priority. Priority adjusts the order in which instances are considered. When all instance problems are stuck, then Lean looks for a <code>default_instance</code> that can apply.</p>\n<p>Default instances are how number literals eventually become <code>Nat</code> literals if there is no other type information.</p>",
        "id": 472068154,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727027882
    },
    {
        "content": "<p>If I remember correctly, the algorithm is</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Start:\n  try to synthesize all instance problems\n  catch stuck instance problems error\n    for each stuck problem\n      if there is a default instance that applies\n        apply it\n        goto Start\n    throw the stuck instance problems error\n</code></pre></div>",
        "id": 472068372,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1727028044
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Thank you. <del><code>[default_instance]</code> is for <code>OfNat</code> only?</del> no.</p>",
        "id": 472111132,
        "sender_full_name": "Asei Inoue",
        "timestamp": 1727057144
    }
]