[
    {
        "content": "<p>Hello,</p>\n<p>In my current context, I have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">my_theorem</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hR_rin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_grp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_sim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>where from within I want to define some <code>R</code>-linear map <code>def φ : M →ₗ[R] M where</code>.<br>\nHowever, Lean complains that it fails to synthesize <code>Semiring R</code> and <code>NonAssocSemiring R</code>.<br>\nWhy does this happen and what can I do to make it do the natural synthesis?</p>",
        "id": 459750064,
        "sender_full_name": "hwy",
        "timestamp": 1723318819
    },
    {
        "content": "<p>Can you include the bit of code that produces that error message, to make it a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> ?</p>",
        "id": 459754895,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723320696
    },
    {
        "content": "<p>(What you have so far looks like it ought to be ok)</p>",
        "id": 459754922,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723320714
    },
    {
        "content": "<p>I've attempted making a new file with a nonsensical theorem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">End</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">RingTheory</span><span class=\"bp\">.</span><span class=\"n\">SimpleModule</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">LinearAlgebra</span><span class=\"bp\">.</span><span class=\"n\">LinearIndependent</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">my_theorem</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hR_rin</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_grp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_mod</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">hM_sim</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsSimpleModule</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">exfalso</span>\n<span class=\"w\">  </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">&phi;</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">&rarr;ₗ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>The infoview panel is as follows:<br>\n<a href=\"/user_uploads/3121/7a_UCFcN3Z6KSX84McZVXsB6/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/7a_UCFcN3Z6KSX84McZVXsB6/image.png\" title=\"image.png\"><img data-original-dimensions=\"668x680\" src=\"/user_uploads/thumbnail/3121/7a_UCFcN3Z6KSX84McZVXsB6/image.png/840x560.webp\"></a></div>",
        "id": 459755606,
        "sender_full_name": "hwy",
        "timestamp": 1723321063
    },
    {
        "content": "<p>I've included all imports from my original file into the example above in case there's some odd interaction going on there</p>",
        "id": 459755733,
        "sender_full_name": "hwy",
        "timestamp": 1723321128
    },
    {
        "content": "<p>You can't put a <code>def</code> within a <code>theorem</code></p>",
        "id": 459756218,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723321360
    },
    {
        "content": "<p>So that's being parsed as a new top-level <code>def</code> with none of the same assumptions</p>",
        "id": 459756247,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723321375
    },
    {
        "content": "<p>Ahh, I see</p>",
        "id": 459756408,
        "sender_full_name": "hwy",
        "timestamp": 1723321447
    },
    {
        "content": "<p>How should I go about introducing a linear map locally then?</p>",
        "id": 459756430,
        "sender_full_name": "hwy",
        "timestamp": 1723321469
    },
    {
        "content": "<p><code>let</code> should work</p>",
        "id": 459756540,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723321525
    },
    {
        "content": "<p>Would let work with where, so that I can fill in the fields of a LinearMap here <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/LinearMap/Defs.html#LinearMap\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Module/LinearMap/Defs.html#LinearMap</a>?</p>",
        "id": 459756724,
        "sender_full_name": "hwy",
        "timestamp": 1723321600
    },
    {
        "content": "<p>No, you have to use <code>{ toFun := fun x := _ }</code> notation instead of <code>where</code> I'm afraid.</p>",
        "id": 459757574,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1723321940
    },
    {
        "content": "<p>I see, I was unaware that notation existed at all</p>",
        "id": 459757641,
        "sender_full_name": "hwy",
        "timestamp": 1723322026
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 459757644,
        "sender_full_name": "hwy",
        "timestamp": 1723322031
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"740340\">hwy</span> has marked this topic as resolved.</p>",
        "id": 459757647,
        "sender_full_name": "Notification Bot",
        "timestamp": 1723322035
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"217875\" href=\"/#narrow/stream/217875-Is-there-code-for-X.3F/topic/.E2.9C.94.20Synthesizing.20Semiring.20and.20NonAssocSemiring.20from.20Ring\">#Is there code for X? &gt; ✔ Synthesizing Semiring and NonAssocSemiring from Ring</a> by <span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span>.</p>",
        "id": 459757832,
        "sender_full_name": "Notification Bot",
        "timestamp": 1723322187
    }
]