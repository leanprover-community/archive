[
    {
        "content": "<p>Say a <code>Monad</code> <code>M</code> is a <code>MonoidalMonad</code> if there are instances of <code>LaxMonoidal M.tofunctor</code>, <code>IsMonoidal M.η</code> and <code>IsMonoidal M.μ</code>. I am trying to define this as a class abbreviation</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">MonoidalMonad</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LaxMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">toFunctor</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">η</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">μ</span>\n</code></pre></div>\n<p>which, as I understand it, is roughly equivalent to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">MonoidalMonad</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">LaxMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">toFunctor</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">η</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n</code></pre></div>\n<p>but in both cases Lean 4 complains that the last class is a <code>duplicate parent structure 'IsMonoidal', skipping</code>. Is there any way to work around that?</p>",
        "id": 504897892,
        "sender_full_name": "Naïm Camille Favier",
        "timestamp": 1741711241
    },
    {
        "content": "<p>This isn't allowed, since the way <code>extends</code> works is it takes the union of all the fields of the parents to create a new structure.</p>\n<p>The direct workaround is to do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">MonoidalMonad</span><span class=\"w\"> </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">LaxMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">toFunctor</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">etaIsMonoidal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">η</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">muIsMonoidal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsMonoidal</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">.</span><span class=\"n\">μ</span><span class=\"o\">]</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">MonoidalMonad</span><span class=\"bp\">.</span><span class=\"n\">etaIsMonoidal</span><span class=\"w\"> </span><span class=\"n\">MonoidalMonad</span><span class=\"bp\">.</span><span class=\"n\">mulIsMonoidal</span>\n</code></pre></div>\n<p>This embeds each of the parents as fields.</p>\n<p>To get the full <code>class abbrev</code> behavior, I think the last thing is to do <code>attribute [instance] MonoidalMonad.mk</code>, so that it can be auto-constructed if all the instances in sight are available.</p>",
        "id": 504898958,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1741711532
    },
    {
        "content": "<p>Cool, thanks</p>",
        "id": 504899542,
        "sender_full_name": "Naïm Camille Favier",
        "timestamp": 1741711671
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385845\">Naïm Camille Favier</span> has marked this topic as resolved.</p>",
        "id": 504899835,
        "sender_full_name": "Notification Bot",
        "timestamp": 1741711729
    }
]