[
    {
        "content": "<p>Lean won't let me eval this code</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">inferTypeFromPatterns</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">patterns</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Pattern</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MonadEval</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">monadEval</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"bp\">.</span><span class=\"n\">ofExcept</span><span class=\"w\"> </span><span class=\"n\">m</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">inferTypeFromPatterns</span><span class=\"w\"> </span><span class=\"n\">patternsListOfList</span>\n</code></pre></div>\n<p>because of error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">MonadEval'</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">adapt</span>\n<span class=\"w\">  </span><span class=\"n\">Except</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"w\"> </span><span class=\"n\">Universe</span>\n<span class=\"n\">to</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">IO'</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Command</span><span class=\"bp\">.</span><span class=\"n\">CommandElabM'</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>even though I have explicitly implemented a <code>MonadEval</code> instance for <code>Except IncompatibleTypes</code>? What's the problem here?</p>\n<p><a href=\"/user_uploads/3121/5l4SdYmN6egxi_bXdNBROMJ_/Screenshot-2025-01-15-at-00.36.39.png\">Screenshot 2025-01-15 at 00.36.39.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5l4SdYmN6egxi_bXdNBROMJ_/Screenshot-2025-01-15-at-00.36.39.png\" title=\"Screenshot 2025-01-15 at 00.36.39.png\"><img data-original-dimensions=\"863x291\" src=\"/user_uploads/thumbnail/3121/5l4SdYmN6egxi_bXdNBROMJ_/Screenshot-2025-01-15-at-00.36.39.png/840x560.webp\"></a></div>",
        "id": 493695342,
        "sender_full_name": "aron",
        "timestamp": 1736901648
    },
    {
        "content": "<p>Do you have a <code>ToString IncompatibleTypes</code> instance?</p>",
        "id": 493710793,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736911193
    },
    {
        "content": "<p>Yes I do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Universe</span>\n<span class=\"w\">  </span><span class=\"n\">t2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Universe</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"()\"</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"bp\">.</span><span class=\"n\">option</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"Option \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"bp\">.</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"Result \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">ok</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\" \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">err</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"bp\">.</span><span class=\"n\">list</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"List \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"bp\">.</span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">Universe</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"n\">IncompatibleTypes</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"s2\">\"Incompatible types: \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">t1</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\" and \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">t2</span>\n</code></pre></div>",
        "id": 493821705,
        "sender_full_name": "aron",
        "timestamp": 1736934759
    },
    {
        "content": "<p><code>instance [ToString Universe] : ToString Universe</code> doesn't work as a way to define that instance. You should be able to check that <code>#synth ToString Universe</code> fails, or you should observe that if you apply <code>toString</code> to a term of <code>Universe</code> there will be an error.</p>\n<p>Instead, you should define a recursive function first that creates that string, and then you can define the instance with it, without this <code>[ToString Universe]</code> argument.</p>\n<p>If you posted a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>, I might have had a moment to write it and test that it worked.</p>",
        "id": 493984499,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736963475
    },
    {
        "content": "<p>Ah ok that makes sense, yes. I did <code>instance [ToString Universe] : ToString Universe</code> because it it insisted that <code>Universe</code> needed to be an instance of <code>ToString</code>, otherwise it didn't let me call <code>toString</code> on it recursively</p>\n<p>But this now works!</p>",
        "id": 494050118,
        "sender_full_name": "aron",
        "timestamp": 1736991850
    }
]