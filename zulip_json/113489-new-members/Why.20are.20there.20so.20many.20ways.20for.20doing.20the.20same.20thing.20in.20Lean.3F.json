[
    {
        "content": "<p>One thing I noticed in Lean was just how many ways there are for doing the same thing. For example, let's say I want to define a Point structure with x &amp; y coordinates and define element-wise addition. I could do</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">deriving</span><span class=\"w\"> </span><span class=\"n\">Repr</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">⟨</span><span class=\"n\">a.x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a.y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.y</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">OrderedPair.mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a.x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a.y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.y</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a.x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.x</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a.y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b.y</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"o\">⟩,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add5</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">OrderedPair.mk</span><span class=\"w\"> </span><span class=\"n\">x₁</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">OrderedPair.mk</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">OrderedPair.mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">add6</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"o\">⟩,</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">⟩</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">⟨</span><span class=\"n\">x₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">⟩</span>\n</code></pre></div>\n<p>My question is - why does Lean offer so many ways of doing the same thing? As a newbie, I find it challenging to figure out which way is better in certain cases or how they all compare. At first glance, I would think it far easier for the language designers to establish just 1 or 2 ways of doing something in order to establish uniformity and consistency.</p>",
        "id": 449085340,
        "sender_full_name": "Noah Stebbins",
        "timestamp": 1720099031
    },
    {
        "content": "<p>Even Python has many ways to do the same thing; I think what you are asking is which ways are <em>idiomatic</em>.</p>",
        "id": 449088196,
        "sender_full_name": "Bbbbbbbbba",
        "timestamp": 1720099723
    },
    {
        "content": "<p>But you cant really establish 1 or 2 ways. Pattern matching is something we definitely need. The .mk way must be there because that's how the type theory works. The .x syntax is just too convenient not to have etc. You won't find a majority (or technical possibility) to remove any of the features here.</p>",
        "id": 449088223,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1720099733
    },
    {
        "content": "<p>Also <code>add</code> is obviously syntactic sugar for <code>add2</code>, and presumably <code>add3</code> is syntactic sugar for <code>add2</code> too, etc., so in those cases I believe there shouldn't be any lasting effects to worry about, and the only criteria is immediate readability.</p>",
        "id": 449089396,
        "sender_full_name": "Bbbbbbbbba",
        "timestamp": 1720100110
    },
    {
        "content": "<p>So I would use <code>add</code> by default, but <code>add2</code> or <code>add3</code> if I feel that the reader may be confused about the expected type and/or the order of the constructor parameters (and in context it is worth it to clarify).</p>",
        "id": 449090138,
        "sender_full_name": "Bbbbbbbbba",
        "timestamp": 1720100335
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"726649\">Bbbbbbbbba</span> <a href=\"#narrow/stream/113489-new-members/topic/Why.20are.20there.20so.20many.20ways.20for.20doing.20the.20same.20thing.20in.20Lean.3F/near/449089396\">said</a>:</p>\n<blockquote>\n<p>Also <code>add</code> is obviously syntactic sugar for <code>add2</code>, and presumably <code>add3</code> is syntactic sugar for <code>add2</code> too, etc., so in those cases I believe there shouldn't be any lasting effects to worry about, and the only criteria is immediate readability.</p>\n</blockquote>\n<p>You are technically correct, but I'm not sure the \"obviously\" is obviously correct.</p>",
        "id": 449095399,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1720101770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"697788\">Noah Stebbins</span> <a href=\"#narrow/stream/113489-new-members/topic/Why.20are.20there.20so.20many.20ways.20for.20doing.20the.20same.20thing.20in.20Lean.3F/near/449085340\">said</a>:</p>\n<blockquote>\n<p>far easier for the language designers to establish [...]</p>\n</blockquote>\n<p>Even pretty basic syntax like <code>=</code> being an infix operator for <code>Eq.refl</code> isn't built-in to the language, but rather defined somewhere in the prelude. Part of Lean's core design is extremely powerful extensibility (meta-programming) facilities. This means Lean's users have a lot of power to, say, design 1,000 ways to do the same thing without any input/consent from the language designers. The good news is that generally, it's the good stuff that gets adopted by the wider community. </p>\n<p>That said, you could certainly imagine some code bases becoming extremely hard to onboard even seasoned Lean users into due to be filled to the brim with bespoke domain specific symbols that baffle non-domain-experts. Understanding the trade-offs for such choices is part of the design space for a project rather than resting solely on the shoulders of language designers.</p>",
        "id": 449095504,
        "sender_full_name": "Mark Fischer",
        "timestamp": 1720101805
    },
    {
        "content": "<p>Thank you guys for the different perspectives!</p>\n<p>To provide additional context to my original question - since I'm relatively new to Lean all of the different ways of doing the same thing feel arbitrary to me since I don't yet fully understand the raison d'etre for each way yet. I've been reading through the Lean tutorials and they are like \"you could do it this way, and this way, and this way\".</p>\n<p>Obviously there are many ways of doing the same thing in Python too but I wasn't given all the keys to the kingdom right away. For example, I didn't stumble upon Python metaclasses until way after I did my first Python tutorials.</p>\n<p>This is absolutely not to say \"Python is better than Lean\" haha. On the contrary, I love Lean. But I've noticed that some concepts in Lean's tutorials have been harder for me to grok at first pass and this was one of them.</p>",
        "id": 449128664,
        "sender_full_name": "Noah Stebbins",
        "timestamp": 1720111138
    },
    {
        "content": "<p>Using <code>OrderedPair.mk</code> directly is not encouraged. It's an implementation detail for structures. Instead, you can use \"structure instance notation\":</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>The <code>where</code> example (<code>add3</code>) is syntax sugar for this. It's basically a macro, where <code>where ...</code> becomes <code>:= { ... }</code>.</p>",
        "id": 449130124,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720111832
    },
    {
        "content": "<p><code>add4</code>, <code>add5</code>, and <code>add6</code> are the exact same as each other, except that only <code>add6</code> supports named arguments with <code>add6 (x := val1) (y := val2)</code>, since in the other two the arguments aren't given any names.</p>\n<p>These are different from <code>add</code>, <code>add2</code>, and <code>add3</code> because they do pattern matching on the arguments, and, while they do turn out to be definitionally equal (making use of \"eta for structures\" I believe), the equation lemmas you get for <code>add4</code>, <code>add5</code>, <code>add6</code> are more complicated. You can check this with </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"bp\">.</span><span class=\"n\">eq_1</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">add4</span><span class=\"bp\">.</span><span class=\"n\">eq_1</span>\n</code></pre></div>",
        "id": 449130808,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720112077
    },
    {
        "content": "<p>You can use structure instance notation for pattern matching. Here's something that is exactly the same as <code>add4</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add4</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">y₁</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y₂</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 449131213,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720112210
    },
    {
        "content": "<p>That said, the OrderedPair type is called <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prod#doc\">docs#Prod</a>, and mathlib already has element-wise addition defined for it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n</code></pre></div>\n<p>See <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Prod.instAdd#doc\">docs#Prod.instAdd</a></p>",
        "id": 449131525,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720112341
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"697788\">@Noah Stebbins</span> I think part of it is that we want two basic features of the languge:</p>\n<ul>\n<li>it should be very easy to check that proofs are correct</li>\n<li>it should be very easy to express complex mathematical ideas using notation familiar to mathematicians and computer scientists</li>\n</ul>\n<p>In order to get the first property, you want a very simple core language. You haven't even gotten down to the lowest levels here... try typing <code>#reduce add5</code>to see what you're actually dealing with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n_ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_ih</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n_ih</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"bp\">⟩⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">n_ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n_ih</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n_ih</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">PUnit</span><span class=\"bp\">.</span><span class=\"n\">unit</span><span class=\"bp\">⟩⟩</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x_1</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>!!</p>\n<p>In order to get the second property, you want to do a lot of aliasing and syntactic sugar, and just giving names to things for human readability...</p>\n<p>There's no right way to use the language, but as more people use it (and want to be able to read and use each other's code), certain idioms and patterns become more common, like the naming conventions in Mathlib, etc...</p>",
        "id": 449133603,
        "sender_full_name": "Michal Wallace (tangentstorm)",
        "timestamp": 1720113003
    },
    {
        "content": "<p>I'm not sure <code>#reduce add5</code> is very informative (and it's a bit misleading) — that's unfolding <em>all</em> definitions, including natural number addition. It's also simplifying away the <code>match</code> beyond what you might expect due to eta for structures.</p>",
        "id": 449134352,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113270
    },
    {
        "content": "<p>Here's <code>add5</code> at essentially the lowest levels:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add5'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">    </span><span class=\"n\">OrderedPair</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">px</span><span class=\"w\"> </span><span class=\"n\">py</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">qx</span><span class=\"w\"> </span><span class=\"n\">qy</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">      </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">px</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">qx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">py</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">qy</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 449134964,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113491
    },
    {
        "content": "<p>If you object to notation, then here's the interpretation of that notation:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add5'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">    </span><span class=\"n\">OrderedPair</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">px</span><span class=\"w\"> </span><span class=\"n\">py</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">OrderedPair</span><span class=\"bp\">.</span><span class=\"n\">casesOn</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">qx</span><span class=\"w\"> </span><span class=\"n\">qy</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">      </span><span class=\"n\">OrderedPair</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HAdd</span><span class=\"bp\">.</span><span class=\"n\">hAdd</span><span class=\"w\"> </span><span class=\"n\">px</span><span class=\"w\"> </span><span class=\"n\">qx</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">HAdd</span><span class=\"bp\">.</span><span class=\"n\">hAdd</span><span class=\"w\"> </span><span class=\"n\">py</span><span class=\"w\"> </span><span class=\"n\">qy</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 449135139,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113553
    },
    {
        "content": "<p>Right. It's not informative at all... But that's the level you want the core verifier to work at to make it as likely as possible that you can trust it.</p>",
        "id": 449135243,
        "sender_full_name": "Michal Wallace (tangentstorm)",
        "timestamp": 1720113595
    },
    {
        "content": "<p>No, I mean it's misleading to say that this is what you're \"actually\" dealing with. (Modified my message)</p>",
        "id": 449135383,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113622
    },
    {
        "content": "<p>The problem is that <code>#reduce</code> is causing a large number of rules for definitional equality to be applied, giving a term that defeq but not very related anymore. What I wrote for <code>add5'</code> is the actual interpretation of <code>add5</code> after unfolding an auxiliary definition created during elaboration.</p>",
        "id": 449135732,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113720
    },
    {
        "content": "<p>One reason I'm pushing back on this because <code>#reduce</code> makes the terms that give a \"!!\" impression, but it's not hard to imagine writing this <code>casesOn</code> expression by hand. You can even see the correspondence that pattern matching is being turned into these <code>casesOn</code> expressions.</p>",
        "id": 449136222,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1720113833
    }
]