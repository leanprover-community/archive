[
    {
        "content": "<p>I have a proof <code>h:¬†‚Üë(f ‚ü®‚Üëz1, ‚ãØ‚ü©) = ‚Üë(nat_equiv n)</code>, I want to do some rewritings that begin with <code>have ¬†:=¬†(f ‚ü®‚Üëz1, ‚ãØ‚ü©).property</code> but of course I can't write <code>...</code> or <code>_</code> because there is nowhere to infer from. But also I don't want to spell out the subtype proof. How to extract the term into a <code>def term = ...</code>that I can use in my new haves and existing proofs.</p>",
        "id": 530690724,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753418431
    },
    {
        "content": "<p>I'm not completely sure what you're asking but do you know about the <code>generalize_proofs</code> tactic?</p>",
        "id": 530693277,
        "sender_full_name": "Niels Voss",
        "timestamp": 1753419936
    },
    {
        "content": "<p>good point, yes I think that should work. I was hoping there is something like <code>conv</code> mode, but at the end instead of applying a tactic I extract the term into a variable.</p>",
        "id": 530693507,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753420046
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚Üë</span><span class=\"n\">z1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚ãØ‚ü©</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">nat_equiv</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"bp\">&lt;...</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">magic</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">generates</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚Üë</span><span class=\"n\">z1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚ãØ‚ü©</span><span class=\"w\"> </span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">now</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‚Üë</span><span class=\"o\">(</span><span class=\"n\">nat_equiv</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span>\n<span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">prop</span>\n</code></pre></div>",
        "id": 530693691,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753420161
    },
    {
        "content": "<p>btw, <code>generalize_proofs</code> did unblock me, but it is quite a blunt tool as I have no control over which proofs it extracts.</p>",
        "id": 530695687,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1753421443
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"488971\">@Rado Kirov</span> you may find this short thread useful:</p>\n<p><a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/rewriting.20an.20expression.20without.20writing.20it.20again/with/491702094\">#new members &gt; rewriting an expression without writing it again</a></p>",
        "id": 530880835,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1753498054
    },
    {
        "content": "<p>(though apparently the <code>change ?x = c</code> trick results in an unused tactic linter error)</p>",
        "id": 530881076,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1753498231
    },
    {
        "content": "<p>also <span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> came up with a neat trick here:</p>\n<p><a class=\"message-link\" href=\"/#narrow/channel/113489-new-members/topic/Extracting.20left-hand.20side.20from.20an.20equality/near/417154472\">#new members &gt; Extracting left-hand side from an equality @ üí¨</a></p>",
        "id": 530881614,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1753498629
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> did we ever come up with a better way of doing this?</p>",
        "id": 530881659,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1753498669
    },
    {
        "content": "<p>I don't think so.</p>\n<p>I guess there's this new technique available in 4.22:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">foo_eq</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">foo_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"c\">/-</span>\n<span class=\"cm\">  a b c d e : ‚Ñï</span>\n<span class=\"cm\">  foo : ‚Ñï := a + b + c + d + e</span>\n<span class=\"cm\">  h : foo = 0</span>\n<span class=\"cm\">  foo_eq : foo = a + b + c + d + e</span>\n<span class=\"cm\">  ‚ä¢ False</span>\n<span class=\"cm\">  -/</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 530882098,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753498972
    }
]