[
    {
        "content": "<p>I was looking at <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/type_classes.html#numerals\">this example</a> from Theorem Proving in Lean 4 about using the <code>OfNat</code> type class. It gives this example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Rational</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span>\n<span class=\"w\">  </span><span class=\"n\">den</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">den</span><span class=\"w\"> </span><span class=\"bp\">â‰ </span><span class=\"w\"> </span><span class=\"mi\">0</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"w\"> </span><span class=\"n\">Rational</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">den</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>but when I run that I get an error <code>unknown identifier 'n'</code>.</p>\n<p>If I instead do this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">OfNat</span><span class=\"w\"> </span><span class=\"n\">Rational</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">den</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>it works fine. </p>\n<p>The latter makes much more sense to me but I wonder why it isn't written that way in the book. </p>\n<p>This also leads me to a follow up of if there is any difference between using <code>{n : Nat}</code> and <code>[n : Nat]</code> in this case since we wouldn't reference this instance explicitly.</p>",
        "id": 489107408,
        "sender_full_name": "Daniel James",
        "timestamp": 1734289622
    },
    {
        "content": "<p>Depending on what project you're in, there are different settings for the <code>autoImplicit</code> option. The book might be assuming it's enabled, but projects like mathlib have <code>autoImplicit</code> off.</p>\n<p>The option (when true) causes 'unknown identifier' errors to instead add in new implicit arguments. You could put in <code>set_option autoImplicit true</code> to see it work.</p>",
        "id": 489107974,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734290211
    },
    {
        "content": "<p><code>[n : Nat]</code> is not allowed since <code>[...]</code> is for instances of typeclasses, and <code>Nat</code> is not a typeclass.</p>",
        "id": 489107988,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734290233
    },
    {
        "content": "<p>Ah, that makes perfect sense. Thank you!</p>\n<p>For the follow up: sorry. I meant to say <code>{n : Nat}</code> and <code>(n : Nat)</code></p>",
        "id": 489108288,
        "sender_full_name": "Daniel James",
        "timestamp": 1734290529
    },
    {
        "content": "<p>For typeclass inference, there's not really a difference between the two.</p>\n<p>There's a very subtle difference between them when it comes to definitional equality of instances, but it has no impact on an OfNat instance. (If it's an implicit argument, the definitional equality algoirthm is more willing to unfold things to try to show things are definitionally equal. But, for the <code>n</code> argument of an OfNat instance, it'll always be a <code>nat_lit</code>, so it has no impact. I'm not sure I've noticed anyone thinking about this subtlety when writing general instances, rather than for a typeclass that is <em>specifically</em> to make use of this feature, so it's probably safe to just treat this as a factoid.)</p>",
        "id": 489108915,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1734291208
    },
    {
        "content": "<p>Perfect. tysm</p>",
        "id": 489109359,
        "sender_full_name": "Daniel James",
        "timestamp": 1734291683
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"607797\">Daniel James</span> has marked this topic as resolved.</p>",
        "id": 489109366,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734291690
    },
    {
        "content": "<p>For instances I am leaning towards always having things explicit, because 99% of the time nobody cares, and when someone does care they're usually doing something a bit wacky and would like to have more control than one might expect.</p>",
        "id": 489122653,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734303917
    }
]