[
    {
        "content": "<p>Hi, I'm frustrated when trying to make the following thing work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Ring</span>\n\n<span class=\"c1\">-- good</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n\n<span class=\"c1\">-- good</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span>\n\n<span class=\"c1\">-- good</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_add</span>\n\n<span class=\"c1\">-- failed</span>\n<span class=\"c1\">-- vscode error message:</span>\n<span class=\"c1\">-- unsolved goals</span>\n<span class=\"c1\">-- R : Type</span>\n<span class=\"c1\">-- inst✝ : Ring R</span>\n<span class=\"c1\">-- a b c : R</span>\n<span class=\"c1\">-- ⊢ a * (b + c) = a * b + a * cLean 4</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ring</span>\n</code></pre></div>\n<p>All but the last one work. It says unsolved goal for the last one.</p>\n<p>Did I miss an import or something?</p>",
        "id": 486365363,
        "sender_full_name": "Xiyu Zhai",
        "timestamp": 1733421810
    },
    {
        "content": "<p>the <code>noncomm_ring</code> tactic works here</p>",
        "id": 486365702,
        "sender_full_name": "David Renshaw",
        "timestamp": 1733421922
    },
    {
        "content": "<p>and <code>ring</code> works if you have <code>[CommRing R]</code> instead of <code>[Ring R]</code>.</p>",
        "id": 486365771,
        "sender_full_name": "David Renshaw",
        "timestamp": 1733421953
    },
    {
        "content": "<p>thanks. But may I ask why? Is it a current limitation of the ring tactics? Or rather, ring tactics is for comm rings. But Ring is for general ring.</p>",
        "id": 486365938,
        "sender_full_name": "Xiyu Zhai",
        "timestamp": 1733422001
    },
    {
        "content": "<p>some previous discussion: <a href=\"#narrow/channel/113488-general/topic/Behaviour.20of.20ring.20tactic/near/436205094\">https://leanprover.zulipchat.com/#narrow/channel/113488-general/topic/Behaviour.20of.20ring.20tactic/near/436205094</a></p>",
        "id": 486366104,
        "sender_full_name": "David Renshaw",
        "timestamp": 1733422063
    },
    {
        "content": "<p>That's extremely helpful!!!</p>",
        "id": 486366232,
        "sender_full_name": "Xiyu Zhai",
        "timestamp": 1733422097
    },
    {
        "content": "<p>If we updated the <code>try_this</code> tactic to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Produces the text `Try this: &lt;tac&gt;` with the given tactic, and then executes it. -/</span>\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"n\">tk</span><span class=\"o\">:</span><span class=\"s2\">\"try_this\"</span><span class=\"w\"> </span><span class=\"n\">tac</span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"o\">:(</span><span class=\"n\">str</span><span class=\"o\">)</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"n\">tac</span>\n<span class=\"w\">  </span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">TryThis</span><span class=\"bp\">.</span><span class=\"n\">addSuggestion</span><span class=\"w\"> </span><span class=\"n\">tk</span><span class=\"w\"> </span><span class=\"n\">tac</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">origSpan?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">logInfoAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getRef</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{info}\"</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>Then when it's used in a macro like <code>ring</code> that macro can provide a custom message to go with the suggestion. Here would could include common pitfalls. Something like:<br>\n\"<code>ring</code> failed to close the goal. If you're working in a noncommutative ring, abelian group or module, try <code>noncomm_ring</code>, <code>abel</code> or <code>module</code>, respectively.\"</p>",
        "id": 486385886,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733429632
    },
    {
        "content": "<p>Also, what is the better way to write that match. I know it must be something easy.</p>",
        "id": 486386389,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733429846
    },
    {
        "content": "<p><code>if let .some info := info then</code></p>",
        "id": 486386419,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733429860
    },
    {
        "content": "<p>But I think the message should be handled as part of <code>addSuggestion</code>, which already lets you specify pre / post text</p>",
        "id": 486386548,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733429906
    },
    {
        "content": "<p><del>I thought it only let you specify pre text?</del> I was thinking of the <code>header</code> that can be changed, which is different from the <code>preinfo</code> or <code>postinfo</code>.</p>",
        "id": 486396607,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733434224
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19763\">#19763</a></p>",
        "id": 486539776,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733499325
    },
    {
        "content": "<p>In case we're going to meet: <a href=\"https://siue.zoom.us/j/91006322517?pwd=cI31tlyKTehpABaRRstBi8c48RmAf6.1\">https://siue.zoom.us/j/91006322517?pwd=cI31tlyKTehpABaRRstBi8c48RmAf6.1</a></p>",
        "id": 486556259,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733504060
    }
]