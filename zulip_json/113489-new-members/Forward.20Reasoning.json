[
    {
        "content": "<p>Is there a way to easily apply implications in hypotheses? e.g. I have hypotheses <code>H: P -&gt; Q</code> and <code>H1: P</code> and I want a hypothesis <code>Q</code>. In Rocq, this would be <code>apply H in H1</code> but something similar does not appear to exist in Lean. I know I can do <code>have H2 := H H1</code> but this gets very verbose with long definition names and many arguments. Is there some tactic that does this that I am missing? Thanks</p>",
        "id": 548173955,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761921531
    },
    {
        "content": "<ul>\n<li><code>specialize H H1</code></li>\n<li><code>apply H at H1</code></li>\n<li><code>replace H := H H1</code></li>\n</ul>",
        "id": 548174089,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921564
    },
    {
        "content": "<p>The second option (<code>apply...at...</code>) gives me an error, Lean seems to ignore the <code>at</code> entirely and attempt to apply <code>H</code> to the goal</p>",
        "id": 548176116,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761922015
    },
    {
        "content": "<p>It's a mathlib tactic, you probably need to import it.</p>",
        "id": 548176433,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761922088
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">ApplyAt</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">H1</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">H1</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> you need to <code>import Mathlib.Tactic.ApplyAt</code></p>",
        "id": 548176566,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922121
    },
    {
        "content": "<p>Is it possible to put this tactic in vanilla Lean? It seems useful enough to be used in non-mathlib contexts</p>",
        "id": 548176640,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761922141
    },
    {
        "content": "<p>(also for future purposes, it would be more helpful to include <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> like I just did)</p>",
        "id": 548176705,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922155
    },
    {
        "content": "<p>For context, I am working on a project where I cannot add a mathlib dependency, so it is somewhat frustrating when useful Lean capabilities are found only in mathlib.</p>",
        "id": 548177211,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761922270
    },
    {
        "content": "<p>but you can still use <code>specialize</code></p>",
        "id": 548177710,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922382
    },
    {
        "content": "<p>and also you can just copy the code of apply_at to your project</p>",
        "id": 548177778,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922397
    },
    {
        "content": "<p>You can open an issue, but honestly it seems unlikely, there is already <code>specialize</code>.</p>",
        "id": 548177885,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761922424
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> is there any reason why you prefer apply_at over specialize?</p>",
        "id": 548177991,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922449
    },
    {
        "content": "<p>In fact most of the time one can write <code>H H1</code> directly, without even using <code>specialize</code>.</p>",
        "id": 548178255,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1761922502
    },
    {
        "content": "<p>presumably they want it to be reusable</p>\n<blockquote>\n<p>but this gets very verbose with long definition names and many arguments</p>\n</blockquote>",
        "id": 548178563,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761922547
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Forward.20Reasoning/near/548177991\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"952838\">Josh Cohen</span> is there any reason why you prefer apply_at over specialize?</p>\n</blockquote>\n<p>Experimenting a bit more, I think <code>specialize</code> should suffice, thank you both for your help. However, I am now wondering what <code>apply...at</code> does that is different than <code>specialize</code> (as in, why was it created separately?)</p>",
        "id": 548182592,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761923431
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> they change different things</p>",
        "id": 548182816,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761923487
    },
    {
        "content": "<p><code>specialize H H1</code> modifies <code>H</code>, while <code>apply H at H1</code> modifies <code>H1</code></p>",
        "id": 548182887,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761923502
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"952838\">@Josh Cohen</span> in general you will find it useful to read the docstrings of tactics, which you can access by hovering your mouse over said tactics in a working code</p>",
        "id": 548183585,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761923656
    },
    {
        "content": "<p>In Rocq, if I had a quantified hypothesis <code>H: \\forall (x: A) (y: B), P x y -&gt; Q x y</code> and hypothesis <code>H1: P a b</code>, <code>apply H in H1</code> would produce <code>H1: Q a b</code>, whereas I would need to use <code>specialize (H _ _ H1)</code> (or else instantiate <code>x</code> and <code>y</code> explicitly). In other words, <code>apply</code> will infer parameters. This was my original motivation for preferring <code>apply</code>. But maybe this is not similar in Lean.</p>",
        "id": 548183757,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761923686
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Forward.20Reasoning/near/548183585\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"952838\">Josh Cohen</span> in general you will find it useful to read the docstrings of tactics, which you can access by hovering your mouse over said tactics in a working code</p>\n</blockquote>\n<p>Yes, I have found that useful. I think my primary problem has been discovering tactics; the Lean Tactic Reference is useful but it is sometimes difficult to know what to look for.</p>",
        "id": 548184090,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761923734
    },
    {
        "content": "<p>that's why <a class=\"stream\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members\">#new members</a> exists!</p>",
        "id": 548184618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761923832
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952838\">Josh Cohen</span> <a href=\"#narrow/channel/113489-new-members/topic/Forward.20Reasoning/near/548183757\">said</a>:</p>\n<blockquote>\n<p>In Rocq, if I had a quantified hypothesis <code>H: \\forall (x: A) (y: B), P x y -&gt; Q x y</code> and hypothesis <code>H1: P a b</code>, <code>apply H in H1</code> would produce <code>H1: Q a b</code>, whereas I would need to use <code>specialize (H _ _ H1)</code> (or else instantiate <code>x</code> and <code>y</code> explicitly). In other words, <code>apply</code> will infer parameters. This was my original motivation for preferring <code>apply</code>. But maybe this is not similar in Lean.</p>\n</blockquote>\n<p>according to the docstrings, apply_at does exactly that</p>",
        "id": 548184719,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761923863
    },
    {
        "content": "<p>The other advantage of <code>apply</code> is that it works even if I do not have the implication in the context. Given a separate theorem <code>foo: P -&gt; Q</code> and hypothesis <code>H: P</code>, I would like to be able to say <code>apply foo in H</code>. Unless I am mistaken, with <code>specialize</code>, I would need to first add <code>foo</code> to the context (which is annoying if <code>foo</code> has a long name or lots of implicit arguments). Is this correct?</p>",
        "id": 548189366,
        "sender_full_name": "Josh Cohen",
        "timestamp": 1761925023
    },
    {
        "content": "<p>You could also just <code>have := foo H</code></p>",
        "id": 548190038,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761925194
    }
]