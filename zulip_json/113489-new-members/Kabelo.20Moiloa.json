[
    {
        "content": "<p>Hey everyone! I'm a pure maths undergraduate in my final year (so called \"Honours,\" in South Africa) with a long term interest in type-theoretic foundations for maths from the SICP book and the HoTT Book.</p>",
        "id": 450547462,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720640334
    },
    {
        "content": "<p>I'm having trouble using <code>mathlib4</code> as a dependency on any new projects. I use <code>nix</code> to get <code>lean4</code> from the <a href=\"https://github.com/leanprover-community/mathlib4\"><code>nixpkgs-unstable</code></a> channel. I'm able to run <code>nix-shell -p lean</code> and within this shell to run <code>lake new foo &amp;&amp; cd foo &amp;&amp; lake build</code>. The binary <code>foo</code> is produced successfully and the command <code>.lake/build/bin/foo</code> runs and gives me the output \"Hello World\" as desired.</p>",
        "id": 450548281,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720640721
    },
    {
        "content": "<p>It will likely be easier if you install elan as suggested on our website: <a href=\"https://leanprover-community.github.io/get_started.html\">https://leanprover-community.github.io/get_started.html</a><br>\nand then follow the instructions on the wiki: <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency\">https://github.com/leanprover-community/mathlib4/wiki/Using-mathlib4-as-a-dependency</a></p>",
        "id": 450548866,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720640924
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span>, I doubt it but I shall try. I use Guix System, which doesn't comply with the FHS standard.</p>",
        "id": 450549424,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720641096
    },
    {
        "content": "<p>Just to warn you -- if you are using an unsupported set-up then you might find it much harder to get help here; it's hard enough trying to support people who are using the supported (<code>elan</code>) set-up! Another thing you should probably be warned about -- if you're not using elan then you will probably have to compile mathlib4 yourself because the cache will not be valid for your set-up, and this takes hours.</p>",
        "id": 450550761,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720641517
    },
    {
        "content": "<p>Got it, thanks <span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> and <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>. So now,  I'm following the standard <code>elan</code> setup but I now can't run any lake commands at all. I get the following error: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lake'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">caused</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">os</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"bp\">```.</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">itself</span><span class=\"w\"> </span><span class=\"n\">works</span><span class=\"w\"> </span><span class=\"n\">though</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"ss\">`test.lean</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"bp\">`#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"mi\">2</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"mi\">4</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">infoview</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 450554156,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720642406
    },
    {
        "content": "<p>Is this a path issue?</p>",
        "id": 450554758,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720642522
    },
    {
        "content": "<p>Lake is in <code>~/.elan/bin</code> for me on Ubuntu. Is it a case of \"log out and log in again so that your <code>.profile</code>, which was updated by <code>elan</code>, actually gets run\"?</p>",
        "id": 450554979,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720642566
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/Kabelo.20Moiloa/near/450554979\">said</a>:</p>\n<blockquote>\n<p>Lake is in <code>~/.elan/bin</code> for me on Ubuntu. Is it a case of \"log out and log in again so that your <code>.profile</code>, which was updated by <code>elan</code>, actually gets run\"?</p>\n</blockquote>\n<p>Nope it is a relatively obscure (i.e. definitely obscure for mathematicians, but not at all for sysadmins) issue that affects NixOS and the quite similar Guix System. Thanks for the help everyone, but I think the best way for me to proceed is to build everything from source. Probably will try to do this over the weekend or similar.</p>",
        "id": 450562386,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720644713
    },
    {
        "content": "<p>There definitely are existing users who are on nixOS -- what is <code>type -a lean</code>?</p>",
        "id": 450564314,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720645531
    },
    {
        "content": "<p>And in whatever directory that returns, there's no <code>lake</code> in it?</p>",
        "id": 450564359,
        "sender_full_name": "Julian Berman",
        "timestamp": 1720645545
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321696\">Julian Berman</span> <a href=\"#narrow/stream/113489-new-members/topic/Kabelo.20Moiloa/near/450564314\">said</a>:</p>\n<blockquote>\n<p>There definitely are existing users who are on nixOS -- what is <code>type -a lean</code>?</p>\n</blockquote>\n<p>Alright, I think I'm making progress. I'm using <code>nix-shell -p elan</code> to get <code>elan</code> -- the <code>curl | sh</code> method doesn't work because the usual build of <code>elan</code> assumes that your distro is FHS compliant (so that e.g. binaries can be found in <code>/usr/bin</code>, etc.). I can build the <a href=\"https://github.com/leanprover-community/mathematics_in_lean.git\">Mathematics in Lean</a> repo simply by cloning it and running <code>cd mathematics_in_lean</code> followed by <code>lake build</code>. Everything builds successfully. </p>\n<p>However, when I open emacs with <code>lean4-mode</code> installed, I then get something like this when I open <code>MIL/C02_Basics/S01_Calculating.lean</code> I get the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">store</span><span class=\"bp\">/</span><span class=\"n\">syfqdchrnlrfq44svbjmfld1zfhzmqcc</span><span class=\"bp\">-</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"mf\">4.2</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"bp\">-</span><span class=\"n\">paths</span><span class=\"w\"> </span><span class=\"n\">Init</span><span class=\"w\"> </span><span class=\"n\">MIL</span><span class=\"bp\">.</span><span class=\"n\">Common</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">5</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">leanOptions'</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Lake</span><span class=\"bp\">.</span><span class=\"n\">PackageConfig'</span>\n<span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">./</span><span class=\"n\">lakefile</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">configuration</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">errors</span>\n</code></pre></div>",
        "id": 450571897,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720647688
    },
    {
        "content": "<p>That looks like a lean version mismatch somewhere. Is your <code>lean-toolchain</code> file compatible with the version of lean which the version of mathlib used by MIL is using?</p>",
        "id": 450577104,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1720649915
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/Kabelo.20Moiloa/near/450577104\">said</a>:</p>\n<blockquote>\n<p>That looks like a lean version mismatch somewhere. Is your <code>lean-toolchain</code> file compatible with the version of lean which the version of mathlib used by MIL is using?</p>\n</blockquote>\n<p>The <code>lean-toolchain</code> file that is at the root of MIL and the one in <code>.lake/packages/mathlib</code> (EDIT: removed the erroneous <code>.lean</code> file extension for the <code>mathlib</code> directory)  have the same contents.</p>",
        "id": 450578080,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720650145
    },
    {
        "content": "<p>Hooorah! I have a working environment, <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> your last tip was particularly helpful. Effectively, I had to clear a variable in my editor to get the lean plugin to use the correct version of lean. Thanks all much appreciated.</p>",
        "id": 450579675,
        "sender_full_name": "Kabelo Moiloa",
        "timestamp": 1720650578
    },
    {
        "content": "<p>my take is to not use <code>nix-shell -p lean</code>, but use <code>nix-shell -p elan</code></p>",
        "id": 456012597,
        "sender_full_name": "Quinn",
        "timestamp": 1722624903
    },
    {
        "content": "<blockquote>\n<p>my take is to not use <code>nix-shell -p lean</code>, but use <code>nix-shell -p elan</code></p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"693606\">@Quinn</span> </p>\n<p>Ty!! ur comment saved my life &lt;3</p>",
        "id": 515183476,
        "sender_full_name": "lor√£",
        "timestamp": 1745974858
    }
]