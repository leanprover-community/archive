[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">100</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n</code></pre></div>",
        "id": 538818501,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757585485
    },
    {
        "content": "<p>this works and I don't know how</p>",
        "id": 538818522,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757585488
    },
    {
        "content": "<p>The termination measure is <code>n - m</code> here. This is the same kind of termination as in:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">    </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">else</span>\n<span class=\"w\">    </span><span class=\"mi\">100</span>\n</code></pre></div>",
        "id": 538820429,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757586031
    },
    {
        "content": "<p>but how does 1. Lean know to use n-m and 2. Lean see it even though it's not a dependent if?</p>",
        "id": 538820525,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757586059
    },
    {
        "content": "<p>since it isn't a dependent if it shouldn't even make sense</p>",
        "id": 538820617,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757586091
    },
    {
        "content": "<p>in the preprocessing step nondependent ifs are converted into dependent ifs</p>",
        "id": 538822117,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1757586596
    },
    {
        "content": "<p>It turns it into a dependent <code>if</code> in the recursion compiler. Also, the module that is responsible for this is <a href=\"https://leanprover-community.github.io/mathlib4_docs//Lean/Elab/PreDefinition/WF/GuessLex.html\">Lean.Elab.PreDefinition.WF.GuessLex</a></p>",
        "id": 538822224,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757586627
    },
    {
        "content": "<blockquote>\n<p>Starting with basic measures (<code>sizeOf xᵢ</code> for all parameters <code>xᵢ</code>), and complex measures (e.g. <code>e₂ - e₁</code> if <code>e₁ &lt; e₂</code> is found in the context of a recursive call) it tries all combinations until it finds one where all proof obligations go through with the given tactic (<code>decerasing_by</code>), if given, or the default <code>decreasing_tactic</code>.</p>\n</blockquote>",
        "id": 538822240,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1757586631
    },
    {
        "content": "<p>ok on my end i did <code>#print foo</code> and found out the shenanigans involved</p>",
        "id": 538822478,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757586720
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"mi\">100</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">@[irreducible] def foo : Nat → Nat → Int :=</span>\n<span class=\"cm\">fun m n =&gt; foo._unary n m</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"bp\">._</span><span class=\"n\">unary</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">def foo._unary : Nat → Nat → Int :=</span>\n<span class=\"cm\">fun n =&gt; ⋯.fix fun m a =&gt; if h : m &lt; n then a (m + 1) ⋯ else 100</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 538822536,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757586739
    },
    {
        "content": "<p>it's always interesting when the <code>#print</code> output isn't at all similar to what I wrote in the code</p>",
        "id": 538822630,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757586770
    }
]