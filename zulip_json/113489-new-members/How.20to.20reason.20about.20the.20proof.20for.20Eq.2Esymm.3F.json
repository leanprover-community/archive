[
    {
        "content": "<p>I guess this is a valid proof for the symmetry of equality:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>I don't understand the operator ▸ yet, so I thought I try something that's easier to understand for me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>This in turn should be more or less the same as this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>Now comes my question: how can I understand how and why exactly this type-checks?</p>\n<p>The input type is <code>a = b</code>, I'm matching with something that expects type <code>a = a</code> and the return type is <code>b = a</code>. Of course, ultimately, all those are the same type, but how does the compiler know?</p>\n<p>It's not as easy as all those are equivalent, because if I replace <code>Eq.refl a</code> with <code>Eq.refl b</code> in either position (or both), this ceases to be accepted by Lean.</p>\n<p>The reason why I'm asking is that I tried to create my own <code>Eq</code> type (as a learning exercise):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">match_pattern</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">my_rfl</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>With this, I can re-write the proof, and this type-checks:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>However, this doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MyEq</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">my_rfl</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">my_rfl</span>\n</code></pre></div>\n<p>I tried it with an without <code>@[match_pattern]</code>, which causes two different errors:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Type mismatch\n  my_rfl\nhas type\n  ?m.7 = ?m.7\nbut is expected to have type\n  MyEq a b\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Type mismatch\n  my_rfl\nhas type\n  MyEq a b\nbut is expected to have type\n  MyEq b a\n</code></pre></div>\n<p>Did I make a mistake in my <code>MyEq</code> type?<br>\nOr is there something else going on that I'm not aware of?</p>",
        "id": 544008342,
        "sender_full_name": "Matthias Geier",
        "timestamp": 1760028597
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"906912\">Matthias Geier</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20reason.20about.20the.20proof.20for.20Eq.2Esymm.3F/near/544008342\">said</a>:</p>\n<blockquote>\n<p>how can I understand how and why exactly this type-checks</p>\n</blockquote>\n<p>you can always <code>#print</code> out the proof:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"c1\">-- set_option pp.all true</span>\n<span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n</code></pre></div>",
        "id": 544008670,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760028705
    },
    {
        "content": "<p>Lean is not magic, every notation is required to unfold via 100 layers to an actual Lean expression that the kernel typechecks</p>",
        "id": 544008753,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760028731
    },
    {
        "content": "<blockquote>\n<p>However, this doesn't work:</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">-@[match_pattern] def my_rfl {a : α} : Eq a a := Eq.refl a</span>\n<span class=\"gi\">+@[match_pattern] def my_rfl {a : α} : MyEq a a := MyEq.refl a</span>\n</code></pre></div>",
        "id": 544008820,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760028762
    },
    {
        "content": "<p>Thanks for the hint with <code>#print</code>, that's very helpful!</p>\n<p>Any yes, silly me, I should have used <code>MyEq</code> instead of <code>Eq</code>! with this (and with <code>@[match_pattern]</code>) now it works!</p>\n<p>However this still leaves my original question: how does the compiler resolve the types <code>a = b</code>, <code>a = a</code> and <code>b = a</code>?</p>",
        "id": 544009546,
        "sender_full_name": "Matthias Geier",
        "timestamp": 1760029021
    },
    {
        "content": "<p>you're asking a very broad question here, there are many steps and i don't know which step you're referring to</p>",
        "id": 544009671,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029065
    },
    {
        "content": "<p>Fair enough. I guess I can narrow it down to 2 questions:</p>\n<ul>\n<li>why does the pattern <code>Eq.refl a</code> accept a term of type <code>a = b</code> (even though it should be <code>a = a</code>)?</li>\n<li>why is it OK that the <code>match</code> statement returns a term of type <code>a = a</code>, but the return type of the function is supposed to be <code>b = a</code>?</li>\n</ul>\n<p>(and I know that those all mean the same thing, but how does the compiler know?)</p>",
        "id": 544010446,
        "sender_full_name": "Matthias Geier",
        "timestamp": 1760029332
    },
    {
        "content": "<p>the concept here is inductive types</p>",
        "id": 544010818,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029424
    },
    {
        "content": "<p><a href=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html\">https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html</a></p>",
        "id": 544010849,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029434
    },
    {
        "content": "<p>Eq has one constructor, so it comes with the \"axiom\" that the only way to ever make Eq is by calling the constructor</p>",
        "id": 544010934,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029463
    },
    {
        "content": "<p>the compiler or whatever part of lean, it sees that <code>a</code> and <code>b</code> are both free variables</p>",
        "id": 544011010,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029482
    },
    {
        "content": "<p>so when you do <code>match</code>ing it says ok these are free variables so let's specialise their values to <code>c</code> because of the constructor <code>Eq.refl c</code></p>",
        "id": 544011201,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029535
    },
    {
        "content": "<p>by the philosophy that propositions are types, consider instead the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">emphasiseZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n</code></pre></div>",
        "id": 544011430,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029601
    },
    {
        "content": "<p>Nat is similarly an inductive type, with two constructors</p>",
        "id": 544011459,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029611
    },
    {
        "content": "<p>so the compiler sees that <code>n</code> is a free variable and it freely assumes that it is formed from either one of the two constructors</p>",
        "id": 544011516,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029630
    },
    {
        "content": "<p>for a more concrete answer, have a look at the following outputs:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n</code></pre></div>",
        "id": 544011616,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029667
    },
    {
        "content": "<p>convince yourself that <code>Nat.rec</code> is the \"recursion\" that everyone knows</p>",
        "id": 544011646,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029678
    },
    {
        "content": "<p>try to connect it to the definition of <code>Nat</code> as an inductive type with two constructors</p>",
        "id": 544011718,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029697
    },
    {
        "content": "<p>and then convince yourself that <code>Eq.rec</code> follows the exact same logic</p>",
        "id": 544011741,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760029703
    },
    {
        "content": "<p>I was hoping I could understand this without having to understand <code>Eq.rec</code>. This is something that's too much for my abilities right now ...</p>\n<p>But coming back to your mention of <code>MyEq c</code>: I realized that I was probably re-using the name <code>a</code> for two different things ... but then I saw that this doesn't compile:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">c</span>\n</code></pre></div>\n<p>It says \"Unknown identifier <code>c</code>\".</p>",
        "id": 544012575,
        "sender_full_name": "Matthias Geier",
        "timestamp": 1760029958
    },
    {
        "content": "<p>I see, it seems like the first argument is actually anchored in the matching principle</p>",
        "id": 544014023,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030405
    },
    {
        "content": "<p>as in, only b is free there, and the matcher substitutes it with the value of the left hand side</p>",
        "id": 544014109,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030428
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 544014300,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030505
    },
    {
        "content": "<p>for more context, compare these two examples, and try to put stuff in the underscores, and you'll find out that only <code>(4+b)</code> works for the first example and only <code>a</code> works for the second example, which means that it anchors the LHS and destructs the RHS</p>",
        "id": 544014320,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030511
    },
    {
        "content": "<p>If you print out the <code>match</code>, you'll see that it has pulled in <code>b</code> into the <code>match</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>In other words, <code>Eq.refl a</code> type-checks in this place because it has also match <code>b</code> to be <code>a</code></p>",
        "id": 544014540,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760030598
    },
    {
        "content": "<p>You can also do this the other way around yourself, although Lean seems to always pull in the second one by default:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>",
        "id": 544014656,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760030637
    },
    {
        "content": "<p>also ignore the \"free\" stuff i said, that has basically nothing to do with it</p>",
        "id": 544014752,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030674
    },
    {
        "content": "<p>You can also introduce a new variable by matching on all variables:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Eq</span><span class=\"bp\">.</span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"n\">c</span>\n</code></pre></div>",
        "id": 544014942,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760030756
    },
    {
        "content": "<p>what is <code>.()</code>?</p>",
        "id": 544015387,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760030899
    },
    {
        "content": "<p>That's a so-called inaccessible pattern, which is used when the value within the <code>.()</code> is determined by typing</p>",
        "id": 544015714,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760031014
    },
    {
        "content": "<p>Wow, thanks! That's a lot to wrap my head around ... I'll play around with this to see if it clarifies the situation for me.</p>",
        "id": 544015780,
        "sender_full_name": "Matthias Geier",
        "timestamp": 1760031039
    },
    {
        "content": "<p>e.g. the <code>.(c)</code> is forced by the typing of <code>Eq.refl c</code></p>",
        "id": 544015852,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1760031067
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20reason.20about.20the.20proof.20for.20Eq.2Esymm.3F/near/544014023\">said</a>:</p>\n<blockquote>\n<p>I see, it seems like the first argument is actually anchored in the matching principle</p>\n</blockquote>\n<p>The first argument is a parameter and the second argument is an index</p>\n<p>Example of a parameter: the <code>n</code> in <code>Fin n</code><br>\nExample of an index: the <code>n</code> in <code>Fin2 n</code></p>",
        "id": 544015925,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760031090
    }
]