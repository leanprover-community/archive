[
    {
        "content": "<p>Hello,</p>\n<p>I am getting a error message that I have never seen, and I cannot find any information online. Does anyone happen to understand it?<br>\n<a href=\"/user_uploads/3121/y1Xo_UiK9ZWTZGsrrfW3cLNw/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/y1Xo_UiK9ZWTZGsrrfW3cLNw/image.png\" title=\"image.png\"><img data-original-dimensions=\"1768x137\" src=\"/user_uploads/thumbnail/3121/y1Xo_UiK9ZWTZGsrrfW3cLNw/image.png/840x560.webp\"></a></div><p>This is the minimal recreation</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">Ring</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsLocalRing</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsNoetherianRing</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CommAlgCat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Under</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CommRingCat</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CommAlgCat</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">CommRingCat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">right</span>\n<span class=\"w\">  </span><span class=\"c1\">-- what is this error?</span>\n</code></pre></div>",
        "id": 483645604,
        "sender_full_name": "Javier Lopez-Contreras",
        "timestamp": 1732179837
    },
    {
        "content": "<p>Short version: replace <code>Coe</code> by <code>CoeOut</code> and it will work.</p>\n<p>Long version: the first argument (i.e. domain) of <code>Coe</code> is marked in a special way (<code>semiOutParam</code>) which means that the first argument has to be deducible from the second argument. The reason is that <code>Coe</code>-instances can be chained multiple times right-to-left. <br>\nIn your instance that is not the case, but you can mark it as <code>CoeOut</code>, which means that it will chain this coercion left-to-right. This is the class to use if the domain depends on a variable that does not occur in the codomain.</p>",
        "id": 483710427,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732199212
    },
    {
        "content": "<p>You can find more information about this by jumping to the definition of the <code>Coe</code> class and reading the module doc &amp; docstrings there.</p>",
        "id": 483710610,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732199261
    },
    {
        "content": "<p>Makes total sense and your solutions works. Thanks! Extra question just for my general knowledge: when you say the first argument needs to <em>be deducible</em> from the second argument, where can I read about what it formally means for a Type to be deducible from another type?</p>",
        "id": 483712014,
        "sender_full_name": "Javier Lopez-Contreras",
        "timestamp": 1732199640
    },
    {
        "content": "<p>it just means that all the variables occurring in the first argument should also occur in the second argument.<br>\nFor <code>CoeOut</code> it's the other way around.</p>",
        "id": 483718581,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1732201306
    }
]