[
    {
        "content": "<p>Could lean support </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/-- Infinite lists -/</span>\n<span class=\"kd\">coinductive</span><span class=\"w\"> </span><span class=\"n\">Stream</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Stream</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Stream</span><span class=\"w\"> </span><span class=\"n\">α</span>\n</code></pre></div>\n<p>(as <a href=\"https://github.com/alexkeizer/QpfTypes\">https://github.com/alexkeizer/QpfTypes</a> does it) in a lean natively?</p>\n<p>Does it make sense?</p>",
        "id": 522716056,
        "sender_full_name": "Serhii Khoma (srghma)",
        "timestamp": 1749193063
    },
    {
        "content": "<p>Could? Potentially. But it's more likely that it will be implemented on top of the kernel instead of a kernel extension. Take a look at previous discussions, e.g. <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/Coinduction.3F/with/274618996\">#lean4 &gt; Coinduction?</a>  and the QPF paper.</p>",
        "id": 522732897,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1749199735
    },
    {
        "content": "<p>So, special optimizations for types generated by Qpf. Would be good too</p>",
        "id": 522756324,
        "sender_full_name": "Serhii Khoma (srghma)",
        "timestamp": 1749208946
    },
    {
        "content": "<p>You might be interested in this thread, which describes why the current representation of conductive types is inefficient, and how it might be improved: <a href=\"#narrow/stream/217875-Is-there-code-for-X.3F/topic/Divergence.20monad\">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there-code-for-X.3F/topic/Divergence.20monad</a></p>",
        "id": 522813644,
        "sender_full_name": "Niels Voss",
        "timestamp": 1749228232
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"521331\">Niels Voss</span> </p>\n<p>Tnx, <a href=\"https://chatgpt.com/share/68458552-c0f0-8010-be8f-9218742034c9\">here is a summary</a> </p>\n<p>I have a question. Why not use church encoding everywhere for coinductive datatypes instead of QPF?  Like I use for <a href=\"https://github.com/srhhma/lean-pipes/blob/572169a5bc29475f0e4a9f5045334d8c7088372f/Pipes/FreeMonad.lean#L22\">FreeMonad</a> and <a href=\"https://github.com/srhhma/lean-pipes/blob/572169a5bc29475f0e4a9f5045334d8c7088372f/Pipes/Internal.lean#L17\">Proxy</a></p>",
        "id": 522976600,
        "sender_full_name": "Serhii Khoma (srghma)",
        "timestamp": 1749388091
    },
    {
        "content": "<p>Church encoding doesn't allow for coinductive data types?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">coinductive CoStream (α : Type u) where</span>\n<span class=\"cm\">  | cons (x : α) (l : CoStream α) : CoStream α</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CoStream</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"c1\">-- cons</span>\n<span class=\"w\">    </span><span class=\"n\">β</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">costream_empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoStream</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">PEmpty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n</code></pre></div>",
        "id": 523030442,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1749449787
    },
    {
        "content": "<p>3 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"113489\" href=\"/#narrow/channel/113489-new-members/topic/power_in_kernel_of_finite_image/with/523042763\">#new members &gt; power_in_kernel_of_finite_image</a> by <span class=\"user-mention silent\" data-user-id=\"380294\">Matt Diamond</span>.</p>",
        "id": 523180183,
        "sender_full_name": "Notification Bot",
        "timestamp": 1749509227
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/113489-new-members/topic/native.20support.20of.20coinductive.20types.20.2F.20codata/near/523030442\">said</a>:</p>\n<blockquote>\n<p>Church encoding doesn't allow for coinductive data types?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">coinductive CoStream (α : Type u) where</span>\n<span class=\"cm\">  | cons (x : α) (l : CoStream α) : CoStream α</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CoStream</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"c1\">-- cons</span>\n<span class=\"w\">    </span><span class=\"n\">β</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">costream_empty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">CoStream</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">False</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">PEmpty</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">elim</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I think you have to reverse it</p>",
        "id": 523180651,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749509528
    },
    {
        "content": "<p>def CoStream (α : Type u) :=<br>\n  ∀ β, (α → β → β) → β<br>\nThat’s inductive: it consumes αs by folding them into β.</p>\n<p>def CoStream (α : Type u) :=<br>\n  ∀ β, (Unit → α × β) → β<br>\nwe now produce αs on demand, not consume them.</p>",
        "id": 523659507,
        "sender_full_name": "Serhii Khoma (srghma)",
        "timestamp": 1749688292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"813382\">Serhii Khoma (srghma)</span> <a href=\"#narrow/channel/113489-new-members/topic/native.20support.20of.20coinductive.20types.20.2F.20codata/near/523659507\">said</a>:</p>\n<blockquote>\n<p>def CoStream (α : Type u) :=<br>\n  ∀ β, (Unit → α × β) → β<br>\nwe now produce αs on demand, not consume them.</p>\n</blockquote>\n<p>This also doesn't seem quite right, since it would mean that <code>CoStream Empty</code> is inhabited</p>",
        "id": 523659936,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1749688583
    },
    {
        "content": "<p>Well, let's just say in general: The church encoding isn't really an option because:</p>\n<ol>\n<li>You have universe bump (I mean <code>inductive</code> also exists to avoid a universe bump! (among other things))</li>\n<li>You have lots of invalid values (e.g. values that depend on the types given)</li>\n<li>You have to decide which universe to eliminate into (you can only choose one per type!)</li>\n</ol>",
        "id": 523689982,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1749712184
    }
]