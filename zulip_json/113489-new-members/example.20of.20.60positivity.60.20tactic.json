[
    {
        "content": "<p>I can't seem to find an educational example of the <code>positivity</code> tactic online aside from these: <a href=\"https://leanprover-community.github.io/mathlib_docs/tactics.html\">https://leanprover-community.github.io/mathlib_docs/tactics.html</a></p>\n<p>Here is a simple example I'm trying to construct:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span><span class=\"w\"> </span><span class=\"c1\">-- error here</span>\n</code></pre></div>\n<p>the error is </p>\n<div class=\"codehilite\" data-code-language=\"plaintext\"><pre><span></span><code>not a positivity goal\n</code></pre></div>\n<p>From the docs,  goals of the form <code>0 ≤ x</code> are valid.</p>\n<p>help?!</p>",
        "id": 450665894,
        "sender_full_name": "rzeta0",
        "timestamp": 1720691538
    },
    {
        "content": "<p>Well, it's not</p>",
        "id": 450666368,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720691695
    },
    {
        "content": "<p>You're asking <code>positivity</code> to prove <code>c^2 - a^2 - b^2 ≤ c^2 - a^2</code>, which isn't in its scope</p>",
        "id": 450666497,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720691738
    },
    {
        "content": "<p>My first thought was <code>gcongr</code>, but that goes off the rails, possibly because of the natural number subtraction (which is not well behaved). Maybe it could be made to work with some help, but it turns out <code>omega</code> handles it</p>",
        "id": 450667228,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720691986
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/stream/113489-new-members/topic/example.20of.20.60positivity.60.20tactic/near/450666497\">said</a>:</p>\n<blockquote>\n<p>You're asking <code>positivity</code> to prove <code>c^2 - a^2 - b^2 ≤ c^2 - a^2</code>, which isn't in its scope</p>\n</blockquote>\n<p>I'm a beginner so apologies for the errors. Isn't <code>0 ≤ c^2 - a^2</code> of the correct form <code>0 ≤ x</code> ?</p>",
        "id": 450669958,
        "sender_full_name": "rzeta0",
        "timestamp": 1720692667
    },
    {
        "content": "<p>It is, and <code>positivity</code> works to prove it directly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n</code></pre></div>\n<p>However, that's probably not what you want - it sees that <code>c^2 - a^2</code> is a natural number, and any natural number is nonnegative</p>",
        "id": 450675557,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1720694502
    },
    {
        "content": "<p>It can't prove</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n</code></pre></div>\n<p>which is probably closer to what you want, but that's because it just doesn't manage to</p>",
        "id": 450676030,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1720694675
    },
    {
        "content": "<p>You may be misunderstanding how <code>calc</code> works - each line is a specific substep, and the proof at the end of the line applies to that substep, and the underscore at the start of the line stands in for the right hand side of the previous line</p>",
        "id": 450676599,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720694881
    },
    {
        "content": "<p>So in your second step, you're asked to prove the goal I mentioned before, which doesn't have a zero anymore</p>",
        "id": 450676728,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1720694915
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113489-new-members/topic/example.20of.20.60positivity.60.20tactic/near/450675557\">said</a>:</p>\n<blockquote>\n<p>It is, and <code>positivity</code> works to prove it directly:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">positivity</span>\n</code></pre></div>\n<p>However, that's probably not what you want - it sees that <code>c^2 - a^2</code> is a natural number, and any natural number is nonnegative</p>\n</blockquote>\n<p>You're right it should be ℤ not ℕ - ive edited the question to reflect this.</p>",
        "id": 450686043,
        "sender_full_name": "rzeta0",
        "timestamp": 1720698113
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/stream/113489-new-members/topic/example.20of.20.60positivity.60.20tactic/near/450676030\">said</a>:</p>\n<blockquote>\n<p>which is probably closer to what you want, but that's because it just doesn't manage to</p>\n</blockquote>\n<p>I want to check I understand. Are you saying the theorem is correct but the tactic as it is currently doesn't manage to prove it, and this is merely a function of the state of its development.</p>",
        "id": 450686460,
        "sender_full_name": "rzeta0",
        "timestamp": 1720698207
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> - you are correct, I didn't fully understand <code>calc</code> so I will go away and think about how to make this work.</p>\n<p>I'm keen on producing a simple educational example of <code>positivity</code> and if I can fit it into the framework of <code>calc</code> that would be great.</p>",
        "id": 450687038,
        "sender_full_name": "rzeta0",
        "timestamp": 1720698348
    }
]