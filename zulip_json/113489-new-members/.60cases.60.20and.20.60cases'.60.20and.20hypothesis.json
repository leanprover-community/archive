[
    {
        "content": "<p>In Lean 3, the <code>cases</code> tactic would have rewritten the occurrences of the term in hypothesis, not just the goal. This seems to be no longer the case in Lean 4, requiring instead to introduce the equality hypothesis and rewrite manually. Can I get a similar behavior in Lean 4?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Order.WithBot</span>\n<span class=\"kn\">import</span> <span class=\"n\">Mathlib.Tactic.Cases</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">Unit</span> <span class=\"bp\">→</span> <span class=\"n\">Option</span> <span class=\"o\">(</span><span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WithBot.lt.lt</span> <span class=\"o\">((</span><span class=\"n\">f</span> <span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"o\">(</span><span class=\"bp\">·</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">some</span> <span class=\"mi\">2</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n     <span class=\"n\">WithBot.lt.lt</span> <span class=\"o\">((</span><span class=\"n\">f</span> <span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"o\">(</span><span class=\"bp\">·</span> <span class=\"bp\">*</span> <span class=\"mi\">2</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">some</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">cases</span> <span class=\"n\">f</span> <span class=\"o\">()</span>\n  <span class=\"bp\">·</span> <span class=\"n\">exact</span> <span class=\"n\">WithBot.bot_lt_coe</span> <span class=\"n\">_</span>\n  <span class=\"bp\">·</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Option.map_some'</span><span class=\"o\">]</span>\n    <span class=\"c1\">-- Fails because h did not get rewritten</span>\n    <span class=\"c1\">-- rw [Option.map_some'] at h</span>\n    <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">Unit</span> <span class=\"bp\">→</span> <span class=\"n\">Option</span> <span class=\"o\">(</span><span class=\"n\">Fin</span> <span class=\"mi\">3</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WithBot.lt.lt</span> <span class=\"o\">((</span><span class=\"n\">f</span> <span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"o\">(</span><span class=\"bp\">·</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">some</span> <span class=\"mi\">2</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n     <span class=\"n\">WithBot.lt.lt</span> <span class=\"o\">((</span><span class=\"n\">f</span> <span class=\"o\">())</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"o\">(</span><span class=\"bp\">·</span> <span class=\"bp\">*</span> <span class=\"mi\">2</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">some</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n  <span class=\"n\">cases'</span> <span class=\"n\">f</span> <span class=\"o\">()</span>\n  <span class=\"bp\">·</span> <span class=\"n\">exact</span> <span class=\"n\">WithBot.bot_lt_coe</span> <span class=\"n\">_</span>\n  <span class=\"bp\">·</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Option.map_some'</span><span class=\"o\">]</span>\n    <span class=\"c1\">-- Fails because h did not get rewritten</span>\n    <span class=\"c1\">-- rw [Option.map_some'] at h</span>\n    <span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I also found <a href=\"#narrow/stream/113488-general/topic/Behavior.20of.20cases.20and.20cases'\">this possibly related thread</a>.</p>",
        "id": 399669983,
        "sender_full_name": "Naruyoko",
        "timestamp": 1698822325
    }
]