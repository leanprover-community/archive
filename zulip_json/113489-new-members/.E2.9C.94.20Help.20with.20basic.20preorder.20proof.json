[
    {
        "content": "<p>Hi everyone, </p>\n<p>I'm working on formalizing a simple statement based on a problem from \"Seven Sketches on Compositionality.\" I'm working up to an analogue for the Yoneda Lemma on preorders, but I'm running into some issues establishing that a certain map is antitone. Here's my code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"c1\">-- set_option diagnostics true</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Upper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsUpperSet</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Upper</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsUpperSet</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"n\">aUp</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Upper</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"bp\">.</span><span class=\"n\">le_trans</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">aUp</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">ab</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Upper</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">OpToUp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Upper</span><span class=\"w\"> </span><span class=\"n\">p</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"n\">le</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"w\">  </span><span class=\"n\">le_refl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Subset</span><span class=\"bp\">.</span><span class=\"n\">refl</span>\n<span class=\"w\">  </span><span class=\"n\">le_trans</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"n\">bc</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Subset</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">ab</span><span class=\"w\"> </span><span class=\"n\">bc</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Antitone</span><span class=\"w\"> </span><span class=\"n\">OpToUp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">YonedaPreorder</span>\n</code></pre></div>\n<p>For that last  example, I'm getting the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">typeclass</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">stuck</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">often</span><span class=\"w\"> </span><span class=\"n\">due</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">metavariables</span>\n<span class=\"w\">  </span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">563</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Any pointers? I've been fiddling around but I haven't really gotten anywhere.</p>",
        "id": 490923506,
        "sender_full_name": "Brad S",
        "timestamp": 1735253331
    },
    {
        "content": "<p>try replacing <code>Antitone OpToUp</code> with <code>Antitone OpToUp (α := α)</code></p>",
        "id": 490924754,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735254506
    },
    {
        "content": "<p>That worked perfectly- thank you so much!</p>",
        "id": 490924891,
        "sender_full_name": "Brad S",
        "timestamp": 1735254637
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"666390\">Brad S</span> has marked this topic as resolved.</p>",
        "id": 490924895,
        "sender_full_name": "Notification Bot",
        "timestamp": 1735254641
    },
    {
        "content": "<p>btw you don't need to write your own instance for <code>Preorder (Set α)</code></p>",
        "id": 490924926,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735254673
    },
    {
        "content": "<p>if you write <code>#synth Preorder (Set α)</code> you can see that one already exists, and I assume it's the subset relation</p>",
        "id": 490925043,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735254758
    },
    {
        "content": "<p>Yes, so in fact it's a little dangerous to put a second one on although hopefully here it's syntactically equal to the already-established one</p>",
        "id": 490925247,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735254922
    },
    {
        "content": "<p>I didn't even know that the #synth command was a thing, thanks for pointing that out as well. Also, this is an additional question- why does the \"(α := α)\" line make everything work? I'm kind of bewildered.</p>",
        "id": 490925250,
        "sender_full_name": "Brad S",
        "timestamp": 1735254930
    },
    {
        "content": "<p>OpToUp by itself doesn't have a clue which type you're applying it to, so it just uses a metavariable <code>?m.563</code> hoping that it will become clearer later, but your code does not make it clearer and eventually it has to use the metavariable elsewhere and then it gives an error.</p>",
        "id": 490925400,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735255056
    },
    {
        "content": "<p>You wrote <code>variable {alpha : Type*}</code> (so OpToUp is supposed to solve for alpha by unification) and then never have any input at all to OpToUp so it can't solve for alpha</p>",
        "id": 490925497,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1735255131
    },
    {
        "content": "<p>What you're really trying to prove is <code>∀ {α} [Preorder α], Antitone (OpToUp α)</code>... adding <code>(α := α)</code> just specifies which <code>α</code> you're talking about</p>",
        "id": 490925609,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735255229
    },
    {
        "content": "<p>you're allowed to write it as <code>Antitone OpToUp</code> without the <code>α</code> because <code>α</code> is an implicit variable, but that means Lean has to make sense of which <code>α</code> you meant, and it needs some help</p>",
        "id": 490925682,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735255312
    },
    {
        "content": "<p>That makes sense. Originally I had <code>OpToUp α</code> which gave a different error, but I can sort of see why that also wouldn't be right. Metavariables often trip me up but this is really helpful.</p>",
        "id": 490925803,
        "sender_full_name": "Brad S",
        "timestamp": 1735255405
    },
    {
        "content": "<p>also, in case it isn't clear, the <code>(x := y)</code> syntax is a way of manually supplying specific variables to a function even when the variables are implicit</p>",
        "id": 490925820,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735255423
    },
    {
        "content": "<p>yes, <code>OpToUp α</code> would give an error since you declared that <code>α</code> was an implicit variable, not an explicit one</p>",
        "id": 490925906,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735255471
    },
    {
        "content": "<p>alternatively, you could have written <code>(@OpToUp α _)</code>... the <code>@</code> symbol basically means \"treat all of the parameters as explicit\"</p>",
        "id": 490925956,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1735255544
    }
]