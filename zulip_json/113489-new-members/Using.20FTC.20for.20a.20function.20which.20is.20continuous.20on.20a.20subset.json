[
    {
        "content": "<p>I work with a function defined on an interval and also continuous there, since I will also want to work with derivatives of this function, as I understood it, in lean you should define it on the entire real line (with meaningless values outside the interval), because an interval is not a normed-space so the derivative definition doesn't work for it.  Now I want use the first part of the Fundamental Theorem of Calculus on the integral of this function over a closed interval which is a subset of the interval that the function is continuous on. In the Math in Lean text they show how to do this when the function is continuous on all the real line. I tried to find similar theorems for ContinuousOn, but they didn't work. I don't know much Measure theory, so I don't know exactly which modification I need to make. I would appreciate if you could explain me what I should do.</p>",
        "id": 560908476,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764416660
    },
    {
        "content": "<p>can you write down the theorem statement you want?</p>",
        "id": 560908894,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764417112
    },
    {
        "content": "<p>I can, but there will probably be a bit too much irrelevant details to the general problem. Do you still want me to send it?</p>",
        "id": 560909194,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764417422
    },
    {
        "content": "<p>From your message, it's not clear what exactly your problem is --- what statement are you looking, which ones did you look at, why did they \"not work\". I cannot help you this abstractly; please give us something to work on.</p>",
        "id": 560909948,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764418089
    },
    {
        "content": "<p>Of course, if you can abstract the lemma you want to apply from your application, that is also nice. But even saying \"this is my motivating application, this lemma would solve it, here's where I'm stuck trying to prove it\" would make it possible to help you.</p>",
        "id": 560910018,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764418155
    },
    {
        "content": "<p>In general, there should be a version of FTC on a subset, and I'd be surprised if mathlib doesn't have it already.</p>",
        "id": 560910112,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1764418231
    },
    {
        "content": "<p>So I've written the idea of what I want to do in a more general settings, the problem is in the last line, where I don't really use the correct theorems: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_idea</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">cont_on_subinterval</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">uIcc</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">uIcc</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">ordConnected_iff_uIcc_subset_left</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">.</span><span class=\"n\">mem</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">mem</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mono</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n<span class=\"w\">  </span><span class=\"n\">integral_hasStrictDerivAt_right</span><span class=\"w\"> </span><span class=\"n\">cont_on_subinterval</span><span class=\"bp\">.</span><span class=\"n\">intervalIntegrable</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">cont_on_subinterval</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter_nhdsWithin</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"bp\">.</span><span class=\"n\">hasDerivAt</span><span class=\"bp\">.</span><span class=\"n\">deriv</span>\n<span class=\"w\">   </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 560911516,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764419554
    },
    {
        "content": "<p>This code doesn't compile (at least on the web editor). If your question is \"how do I prove x\" then it's probably better to post code with a <code>sorry</code> rather than with errors (code with errors is always confusing, at least for me). (but I confess I am not really following the thread caefully)</p>",
        "id": 560911655,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764419679
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560911655\">said</a>:</p>\n<blockquote>\n<p>This code doesn't compile (at least on the web editor). If your question is \"how do I prove x\" then it's probably better to post code with a <code>sorry</code> rather than with errors (code with errors is always confusing, at least for me). (but I confess I am not really following the thread caefully)</p>\n</blockquote>\n<p>Is it o.k how I added the sorry now? The reason I added the work in progress proof is that I wanted to show what I tried to do so far.</p>",
        "id": 560911879,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764419874
    },
    {
        "content": "<p>there's errors before the <code>sorry</code></p>",
        "id": 560911947,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764419945
    },
    {
        "content": "<p>I don't know anything about this part of the library but I do understand the errors in the code you're posting:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Application type mismatch: The argument\n  ContinuousOn.stronglyMeasurableAtFilter_nhdsWithin cont_on_subinterval ?m.56 ?m.57\nhas type\n  StronglyMeasurableAtFilter f (nhdsWithin ?m.57 (Set.uIcc ↑x₀ ↑x)) ?m.55\nbut is expected to have type\n  StronglyMeasurableAtFilter f (nhds ↑x) volume\n</code></pre></div>\n<p>means \"you made a term of type <code>StronglyMeasurableAtFilter (the wrong filter)</code>\" and</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Invalid field `hasDerivAt`: The environment does not contain `Function.hasDerivAt`\n  ContinuousOn.continuousAt h\nhas type\n  I ∈ nhds ?m.64 → ContinuousAt f ?m.64\n</code></pre></div>\n<p>means \"you wrote <code>(something which is a function).hasDerivAt</code> and that makes no sense\".</p>\n<p>If you're stuck then post code with no errors. That's much better than posting code with errors.</p>",
        "id": 560912009,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764419967
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560912009\">said</a>:</p>\n<blockquote>\n<p>I don't know anything about this part of the library but I do understand the errors in the code you're posting:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Application type mismatch: The argument\n  ContinuousOn.stronglyMeasurableAtFilter_nhdsWithin cont_on_subinterval ?m.56 ?m.57\nhas type\n  StronglyMeasurableAtFilter f (nhdsWithin ?m.57 (Set.uIcc ↑x₀ ↑x)) ?m.55\nbut is expected to have type\n  StronglyMeasurableAtFilter f (nhds ↑x) volume\n</code></pre></div>\n<p>means \"you gave <code>StronglyMeasurableAtFilter</code> the wrong filter\" and</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Invalid field `hasDerivAt`: The environment does not contain `Function.hasDerivAt`\n  ContinuousOn.continuousAt h\nhas type\n  I ∈ nhds ?m.64 → ContinuousAt f ?m.64\n</code></pre></div>\n<p>means \"you wrote <code>something.hasDerivAt</code> and that makes no sense\"</p>\n</blockquote>\n<p>I honestly don't know how to use this theorem, because I didn't learn measure theory yet. I just tried to do something analogous to how this was used in the Math in Lean text. So, my question in a nutshell is how to use this theorem in my case? What are the correct parameters?</p>",
        "id": 560912221,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764420160
    },
    {
        "content": "<p>If it's more helpful to just send the theorem statement without anything I tried, then here it is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_idea</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 560912419,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764420347
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560912221\">said</a>:</p>\n<blockquote>\n<p>So, my question in a nutshell is how to use this theorem in my case?</p>\n</blockquote>\n<p>Again let me stress that I don't know this part of the library at all. But my understanding of your question in a nutshell is that it is: \"I have a goal of the form <code>A = B</code>. How do I apply a theorem whose conclusion is <code>HasStrictDerivAt (something)</code> to close this goal?\" and so my answer is \"you can't do that, because the conclusion of the theorem you want to use to close the goal is not of the form <code>A = B</code>\".</p>",
        "id": 560912585,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764420527
    },
    {
        "content": "<p>I think you wrote it wrong</p>",
        "id": 560912639,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764420576
    },
    {
        "content": "<p>you put <code>∫ τ in x₀..t, f t</code> but it should be <code>∫ τ in x₀..t, f τ</code></p>",
        "id": 560912662,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764420603
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560912662\">said</a>:</p>\n<blockquote>\n<p>you put <code>∫ τ in x₀..t, f t</code> but it should be <code>∫ τ in x₀..t, f τ</code></p>\n</blockquote>\n<p>Yes, you are right, thank you. Although it doesn't solve the problem.</p>",
        "id": 560912842,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764420720
    },
    {
        "content": "<p>Just in case it will be useful for someone, here is how they do it in the Math in Lean text for a function which is continuous on the entire real line:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">..</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">integral_hasStrictDerivAt_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">intervalIntegrable</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">hasDerivAt</span><span class=\"bp\">.</span><span class=\"n\">deriv</span>\n</code></pre></div>",
        "id": 560913035,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764420861
    },
    {
        "content": "<p>so you don't have enough assumptions</p>",
        "id": 560913087,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764420892
    },
    {
        "content": "<p>to conclude the conclusion</p>",
        "id": 560913094,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764420897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913087\">said</a>:</p>\n<blockquote>\n<p>so you don't have enough assumptions</p>\n</blockquote>\n<p>Could you explain what do you mean in more detail?</p>",
        "id": 560913267,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764420997
    },
    {
        "content": "<p>And also the brackets are different in the MIL version, which makes all the difference. In the MIL version they use the theorem to get <code>HasStrictDerivAt (something)</code> , and <em>then</em> they apply <code>HasStrictDerivAt.hasDerivAt</code> etc. So one of your problems is that you haven't correctly parsed what's going on in MIL and so have failed to replicate it. Do you understand dot notation?</p>",
        "id": 560913325,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764421052
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913325\">said</a>:</p>\n<blockquote>\n<p>And also the brackets are different in the MIL version, which makes all the difference. In the MIL version they use the theorem to get <code>HasStrictDerivAt (something)</code> , and <em>then</em> they apply <code>HasStrictDerivAt.hasDerivAt</code> etc. So one of your problems is that you haven't correctly parsed what's going on in MIL and so have failed to replicate it. Do you understand dot notation?</p>\n</blockquote>\n<p>Yes, you are absolutely right, Thank you!. I only noticed this now. I'll try to see if this solve the issue.</p>",
        "id": 560913422,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764421146
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913267\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913087\">said</a>:</p>\n<blockquote>\n<p>so you don't have enough assumptions</p>\n</blockquote>\n<p>Could you explain what do you mean in more detail?</p>\n</blockquote>\n<p>I have a function <code>f := fun τ =&gt; if τ &gt; 0 then 1 else -1</code> (= a step function) and an interval <code>I := Set.Iic 0</code> (= the nonpositive reals) that <code>f</code> is continuous on the interval and a points <code>x₀ = x = 0</code> in the interval but the derivative of the integral is not consistent with the theorem statement</p>",
        "id": 560913464,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421186
    },
    {
        "content": "<p>since we're not differentiable at zero the <code>deriv</code> gives a junk value of <code>0</code></p>",
        "id": 560913519,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421239
    },
    {
        "content": "<p>but <code>f x = -1</code></p>",
        "id": 560913534,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421256
    },
    {
        "content": "<p>Here is another way of writing the MIL proof, where I unravel some of the dot notation.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Continuous</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">..</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">HasDerivAt</span><span class=\"bp\">.</span><span class=\"n\">deriv</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">HasStrictDerivAt</span><span class=\"bp\">.</span><span class=\"n\">hasDerivAt</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integral_hasStrictDerivAt_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">intervalIntegrable</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">continuousAt</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Let <code>X</code> be <code>(integral_hasStrictDerivAt_right (hf.intervalIntegrable _ _) (hf.stronglyMeasurableAtFilter _ _) hf.continuousAt)</code>. The point is that the type of <code>X</code> is <code>HasStrictDerivAt (something)</code> so <code>X.hasDerivAt</code> means <code>HasStrictDerivAt.hasDerivAt X</code>, which has type <code>HasDerivAt (something)</code> etc etc.</p>",
        "id": 560913563,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764421278
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913464\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"952635\">Michael Novak</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913267\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560913087\">said</a>:</p>\n<blockquote>\n<p>so you don't have enough assumptions</p>\n</blockquote>\n<p>Could you explain what do you mean in more detail?</p>\n</blockquote>\n<p>I have a function <code>f := if x &gt; 0 then 1 else -1</code> (= a step function) and an interval <code>Set.Iic 0</code> (= the nonpositive reals) that <code>f</code> is continuous on the interval and a points <code>x₀ = x = 0</code> in the interval but the derivative of the integral is not consistent with the theorem statement</p>\n</blockquote>\n<p>I see what you are saying. If I know that the function is continuously differentiable on the interval will it help? And in general how do we solve this issue? Because it seems like this only happens because we can't just define differentiable functions on subsets (or even just intervals) and we have to define the function on the entire real line. It seems like more of an issue of how we try to represent the function in lean, isn't it?</p>",
        "id": 560913975,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764421675
    },
    {
        "content": "<p>but this function <code>f</code> is continuously differentiable on the interval</p>",
        "id": 560914003,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421700
    },
    {
        "content": "<p>so the problem is you're trying to take properties of the function on the interval into a derivative that can reach off the interval</p>",
        "id": 560914050,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421743
    },
    {
        "content": "<p>so how about saying you have a derivative on the interval instead with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=HasDerivWithinAt#doc\">docs#HasDerivWithinAt</a></p>",
        "id": 560914066,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421761
    },
    {
        "content": "<p>Yes, if you're working with functions and you only care about their values on a subset then you need to restrict your entire application of calculus to the subset (and there are tools to do this).</p>",
        "id": 560914197,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764421890
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560914003\">said</a>:</p>\n<blockquote>\n<p>but this function <code>f</code> is continuously differentiable on the interval</p>\n</blockquote>\n<p>It's probably not an important point, but why is it continuously differentiable? We only assumed it is continuous</p>",
        "id": 560914251,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764421933
    },
    {
        "content": "<p>the counterexample I gave</p>",
        "id": 560914267,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421943
    },
    {
        "content": "<p>it's constant (=&gt; continuously differentiable) on the interval</p>",
        "id": 560914284,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764421962
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560914267\">said</a>:</p>\n<blockquote>\n<p>the counterexample I gave</p>\n</blockquote>\n<p>Oh, got you</p>",
        "id": 560914295,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764421971
    },
    {
        "content": "<p>This error from above</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Application</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">argument</span>\n<span class=\"w\">  </span><span class=\"n\">ContinuousOn</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter_nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">cont_on_subinterval</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">56</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">57</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">StronglyMeasurableAtFilter</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">57</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">uIcc</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">55</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">StronglyMeasurableAtFilter</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">volume</span>\n</code></pre></div>\n<p>means \"you're asking questions about neighbourhoods of x which might not be fully contained within the subset and these questions cannot be sensible in your context\" (for example neighbourhoods of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mo>−</mo><mi>ϵ</mi><mo separator=\"true\">,</mo><mi>ϵ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(-\\epsilon,\\epsilon)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">−</span><span class=\"mord mathnormal\">ϵ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϵ</span><span class=\"mclose\">)</span></span></span></span> in Aaron's example).</p>",
        "id": 560914349,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764422014
    },
    {
        "content": "<p>I think I understand the issue, but I'm just too unfamiliar with the jargon of of measure theory, so it might take me a bit of a long time to understand exactly how to use derivative within a subset here. If by chance it's already clear to you what to do, I would really appreciate if you could tell me, but if not, it's totally fine, I'll try to work a bit and see if I can figure it out.</p>",
        "id": 560914822,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764422504
    },
    {
        "content": "<p>basically don't do theorem statements that look like <code>deriv f x = f' x</code></p>",
        "id": 560915632,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764423394
    },
    {
        "content": "<p>instead you want to write stuff that looks like <code>HasDerivWithinAt f (f' x) I x</code></p>",
        "id": 560915670,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764423429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560915670\">said</a>:</p>\n<blockquote>\n<p>instead you want to write stuff that looks like <code>HasDerivWithinAt f f' I x</code></p>\n</blockquote>\n<p>Oh really? That seems quite annoying. Is that normal in Mathlib? Is there a plan to make it possible to work with differentiable functions on subsets of normed spaces, so we don't have to dill with this? And also thank you very much for the help, I'm obviously not angry at you that this has to work like that.</p>",
        "id": 560915913,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764423638
    },
    {
        "content": "<p>I feel like this is normal in mathlib</p>",
        "id": 560916036,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764423764
    },
    {
        "content": "<p>why do you say it is annoying</p>",
        "id": 560916038,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764423769
    },
    {
        "content": "<p>Ideally I would like to be able to just define my function on the interval and just use normal deriv, like in a textbook.</p>",
        "id": 560916130,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764423893
    },
    {
        "content": "<p>in textbook we say a function has a derivative if it satisfies ...<br>\nand by abuse of language we can say the derivative of a function is equal to a value if it has that derivative (since derivatives are unique)</p>",
        "id": 560916321,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764424107
    },
    {
        "content": "<p>But it's <em>not</em> normal deriv. Normal deriv means (f(x+h)-f(x))/h where h tends to zero and is allowed to take positive and negative values when doing so. That's what normal derivative <em>means</em>. So if you have a function on [0,1] and you want to talk about it being differentiable at 1 then you really are <em>not</em> using the normal derivative. Formalisation cares about these details, even if your textbook doesn't.</p>",
        "id": 560919390,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764427112
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560919390\">said</a>:</p>\n<blockquote>\n<p>But it's <em>not</em> normal deriv. Normal deriv means (f(x+h)-f(x))/h where h tends to zero and is allowed to take positive and negative values when doing so. That's what normal derivative <em>means</em>. So if you have a function on [0,1] and you want to talk about it being differentiable at 1 then you really are <em>not</em> using the normal derivative. Formalisation cares about these details, even if your textbook doesn't.</p>\n</blockquote>\n<p>But in the textbook definition (at least how I learned it)  you also have the demand that <code>x+h</code> is in the interval. Just like (0.5, 1] is not an open ball with center 1 in the real line, but it is an open ball with center 1 inside [0, 1].</p>",
        "id": 560923500,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764430240
    },
    {
        "content": "<p>Right, and that's called <code>HasDerivWithin</code> because you are demanding that you are within the interval, so it's not the same as <code>HasDeriv</code> (which doesn't)</p>",
        "id": 560924902,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1764431424
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560924902\">said</a>:</p>\n<blockquote>\n<p>Right, and that's called <code>HasDerivWithin</code></p>\n</blockquote>\n<p>Not quite, we have <code>HasDerivWithinAt</code> but I didn't find <code>HasDerivWithin</code> or <code>HasDerivOn</code></p>",
        "id": 560927127,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764433273
    },
    {
        "content": "<p>The new version of the theorem I'm trying to prove is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_idea</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">HasDerivWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\">  </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I'm trying to use <code>integral_hasDerivWithinAt_right</code>, but I struggle a bit to find the right parameters. If you have some hints, I would greatly appreciate it.</p>",
        "id": 560931657,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764437583
    },
    {
        "content": "<p>oh I think I can do this one now</p>",
        "id": 560932092,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764437973
    },
    {
        "content": "<p>everything's a bit more complicated because you have a convex set</p>",
        "id": 560932585,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764438413
    },
    {
        "content": "<p>instead of just an interval</p>",
        "id": 560932586,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764438419
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/Using.20FTC.20for.20a.20function.20which.20is.20continuous.20on.20a.20subset/near/560932585\">said</a>:</p>\n<blockquote>\n<p>everything's a bit more complicated because you have a convex set</p>\n</blockquote>\n<p>I proved already that the function is continuous on the subinterval. Maybe it could be helpful:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">cont_on_subinterval</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">uIcc</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">uIcc</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">ordConnected_iff_uIcc_subset_left</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">.</span><span class=\"n\">mem</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">assumption</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">mem</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mono</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n</code></pre></div>",
        "id": 560932723,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764438547
    },
    {
        "content": "<p>I did it!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">the_idea</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">I</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ContinuousOn</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x₀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">HasDerivWithinAt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">∫</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">..</span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">τ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">FTCFilter</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">FTCFilter</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨?_⟩</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">tendsto_smallSets_iff</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_nhdsWithin_iff_exists_mem_nhds_inter</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hut</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ht</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">haxb</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">habx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">habu</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_Icc_mem_subset_of_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">hu</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">inter_comm</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">inter_mem_nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">habx</span>\n<span class=\"w\">      </span><span class=\"n\">filter_upwards</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">prod_mem_prod</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"w\"> </span><span class=\"n\">hab</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hi</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">subset_trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_inter</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hut</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">subset_trans</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">habu</span>\n<span class=\"w\">        </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">hk</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">hi</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">⟩</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">hk</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Icc_subset</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">hj</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc_subset_Icc_self</span><span class=\"w\"> </span><span class=\"n\">hk</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">pure_le_nhdsWithin</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin_le_nhds</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">inf_isMeasurablyGenerated</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">measurableSet</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">principal_isMeasurablyGenerated</span>\n<span class=\"w\">  </span><span class=\"n\">intervalIntegral</span><span class=\"bp\">.</span><span class=\"n\">integral_hasDerivWithinAt_right</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mono</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">uIcc_subset</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"w\"> </span><span class=\"n\">x₀</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">intervalIntegrable</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">stronglyMeasurableAtFilter_nhdsWithin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">OrdConnected</span><span class=\"bp\">.</span><span class=\"n\">measurableSet</span><span class=\"w\"> </span><span class=\"bp\">‹_›</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">continuousWithinAt</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 560933815,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764439625
    },
    {
        "content": "<p>Wow! Thank you so much! I didn't expect that something which looks like should be almost immediate will take so much work. If I was working on a normal closed interval would it be shorter? Could this theorem get into Mathlib? It seems quite useful.</p>",
        "id": 560936155,
        "sender_full_name": "Michael Novak",
        "timestamp": 1764441807
    },
    {
        "content": "<p>if you were doing a closed interval</p>",
        "id": 560936219,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764441871
    },
    {
        "content": "<p>I think it would probably be just the last two lines</p>",
        "id": 560936229,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1764441879
    }
]