[
    {
        "content": "<p>I have an application of <code>Nat.xgcd</code>, a recursive function over some constant inputs but <code>simp</code> doesn't seem to do the trick because it's recursive? How would I prove the following theorem?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">width</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">256</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"bp\">^</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">width</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">xgcd_res</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"bp\">.</span><span class=\"n\">xgcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>(My theorem is larger but I think I could use this then as a simp lemma or apply the general approach)</p>",
        "id": 479383780,
        "sender_full_name": "Philogy",
        "timestamp": 1730163793
    },
    {
        "content": "<p>Weirdly <code>unfold Nat.xgcd</code> causes <code>(kernel) deep recursion detected</code> there</p>",
        "id": 479420634,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730189077
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">xgcd_add_three_add_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">xgcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">xgcd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xgcdAux</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_eq_add_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mod_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat_ediv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cast_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cast_ofNat</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">cast_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mod_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_add_iff_pos_left</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">add_pos_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ofNat_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_div_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_neg_eq_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_add_rev</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">reduceNeg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mod_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xgcd_zero_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_right_eq_self</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_eq_zero</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_eq_zero_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_eq_zero_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">xgcd_res</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"bp\">.</span><span class=\"n\">xgcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">xgcd_add_three_add_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>this should work</p>",
        "id": 479421567,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730189419
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20simplify.20proof.20by.20evaluating.20function/near/479421567\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">xgcd_add_three_add_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">xgcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">xgcd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xgcdAux</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_eq_add_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mod_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">ofNat_ediv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cast_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cast_ofNat</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">cast_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_sub</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mod_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mod</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_add_iff_pos_left</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">add_pos_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ofNat_pos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">or_true</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_div_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_neg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">sub_neg_eq_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_add_rev</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">Int</span><span class=\"bp\">.</span><span class=\"n\">reduceNeg</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mod_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">xgcd_zero_left</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">injEq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_right_eq_self</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"n\">root_</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">neg_eq_zero</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">right</span>\n<span class=\"w\">    </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_eq_zero_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">norm_cast</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">div_eq_zero_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">omega</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">xgcd_res</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"bp\">.</span><span class=\"n\">xgcd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">xgcd_add_three_add_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">UInt256</span><span class=\"bp\">.</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>this should work</p>\n</blockquote>\n<p>Isn't there a simpler way? Seems like an awfully large lemma for what is just expand and simplify?</p>",
        "id": 479460946,
        "sender_full_name": "Philogy",
        "timestamp": 1730202890
    },
    {
        "content": "<p><code>native_decide</code> will probably work, but that introduces an axiom (trusting the compiler)</p>",
        "id": 479463788,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730203671
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"690858\">Daniel Weber</span> <a href=\"#narrow/channel/113489-new-members/topic/How.20to.20simplify.20proof.20by.20evaluating.20function/near/479463788\">said</a>:</p>\n<blockquote>\n<p><code>native_decide</code> will probably work, but that introduces an axiom (trusting the compiler)</p>\n</blockquote>\n<p>Hmm, is there maybe a way to apply <code>simp</code> or <code>rw</code> but non recursively? Like this I can unfold the recursive definition one step at a time?</p>",
        "id": 479464116,
        "sender_full_name": "Philogy",
        "timestamp": 1730203773
    },
    {
        "content": "<p>Yes, but <code>unfold Nat.xgcd</code> causes a kernel error here — that might be a Lean bug</p>",
        "id": 479464281,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1730203816
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739332\">Philogy</span> has marked this topic as resolved.</p>",
        "id": 479504548,
        "sender_full_name": "Notification Bot",
        "timestamp": 1730214721
    }
]