[
    {
        "content": "<p>Can <code>constructor &lt;;&gt; linarith</code> and similar be applied recursively? If I understand correctly, <code>constructor</code> is in this case applied to the current goal and then <code>linarith</code> to all the subgoals. <br>\nIf those subgoals needed a <code>constructor</code>, I'd love to execute something like <code>constructor &lt;;&gt; linarith -r</code>, i.e. add <code>-r</code>to the command (perhaps a different syntax).</p>",
        "id": 484688096,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732703649
    },
    {
        "content": "<p>Does something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">repeat</span>\n<span class=\"w\">  </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n</code></pre></div>\n<p>(untested) work?</p>",
        "id": 484693387,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732705273
    },
    {
        "content": "<p>I tried that on one of <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> 's proofs. </p>\n<p>Here's the original one (from <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> ):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">sqrt_mul_le_add_div_two</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt_le_iff</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n</code></pre></div>\n<p>Here's the one using this new construct (does not work, ends up with 3 remaining goals):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">sqrt_mul_le_add_div_two2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">sqrt_le_iff</span><span class=\"bp\">.</span><span class=\"m\">2</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">positivity</span>\n<span class=\"w\">  </span><span class=\"n\">repeat</span>\n<span class=\"w\">    </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">linarith</span>\n</code></pre></div>\n<p>The construct should:</p>\n<ul>\n<li>solve all the cases that <code>constructor &lt;;&gt; linarith</code> solves</li>\n<li>solve all the cases that can be solved by reapplying the <code>constructor / linarith</code> line to the subgoals</li>\n</ul>",
        "id": 484698715,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732707062
    },
    {
        "content": "<p>This case worked, though, right?  If you have a case in mind that can serve as a test, maybe you can try</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"n\">repeat</span>\n<span class=\"w\">    </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">constructor</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span><span class=\"w\"> </span><span class=\"n\">linarith</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">constructor</span>\n</code></pre></div>\n<p>instead.</p>",
        "id": 484700993,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732707844
    },
    {
        "content": "<p>(Or play around adapting the script: the parentheses make those combination of tactics behave as a \"single block\", and the combination exploits that <code>linarith</code> <em>fails</em> on goals that it cannot solve, otherwise you could also sprinkle some <code>done</code>s somewhere to force a tactic to be finishing.)</p>",
        "id": 484701246,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732707937
    },
    {
        "content": "<p>Works perfectly! I'm just wondering how recursive <code>repeat</code> really is. But this was already very helpful! Thank you Damiano!</p>",
        "id": 484703429,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732708662
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"672170\">Michael Bucko</span> has marked this topic as resolved.</p>",
        "id": 484703447,
        "sender_full_name": "Notification Bot",
        "timestamp": 1732708669
    },
    {
        "content": "<p><code>repeat</code> should continue until whatever follows it does not produce an error.</p>",
        "id": 484704083,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732708860
    },
    {
        "content": "<p>Note that it will \"jump\" goals, unless you wrap it inside a <code>focus</code> or in a focusing dot (<code>\\.</code>).</p>",
        "id": 484704276,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732708918
    },
    {
        "content": "<p>A follow up question. Assuming a big enough problem where subgoals keep requiring, say, <code>constructor</code> - <code>repeat</code>, proof execution time (assuming that the proof can be found) would be a function of compute? i.e it could be that evaluation could take 2 hours, or 2 days, before the proof is found (assuming that the proof can be found).</p>",
        "id": 484705621,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732709334
    },
    {
        "content": "<p>There is a default time limit (in the form of heartbeats) that would prevent Lean from computing forever.</p>",
        "id": 484706347,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709566
    },
    {
        "content": "<p>This can be disabled via <code>set_option maxHeartbeats 0</code>, though the exact syntax may be different (if you reach the time limit, the error message will tell you how to modify the limit).</p>",
        "id": 484706463,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709614
    },
    {
        "content": "<p>Thank you! That was very helpful!</p>",
        "id": 484707043,
        "sender_full_name": "Michael Bucko",
        "timestamp": 1732709802
    },
    {
        "content": "<p>If you plan to modify the default time limit, it is probably safer to use <code>set_option ... in</code>: the <code>in</code> limits the effect of resetting the option to just the following command, so that later commands still get the \"usual\" limit.</p>",
        "id": 484707660,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709987
    }
]