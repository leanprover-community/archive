[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"The answer is \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">toString</span><span class=\"w\"> </span><span class=\"n\">n</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"The answer is \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">toString</span>\n<span class=\"c\">/-</span><span class=\"cm\"> invalid field 'toString', the environment does not contain 'Nat.toString' -/</span>\n</code></pre></div>\n<p>Why doesn't this work? Is there a way to add <code>Nat.toString</code> to the environment? I'm mostly curious about the error itself, not necessarily \"how to embed numbers into strings\".</p>",
        "id": 537018544,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1756686919
    },
    {
        "content": "<p>toString comes from a class, and thus toString n works because toString is able to synthesize an instance of ToString Nat. Dot notation, however, looks (to first principle) by namespaces. And there is no toString in the Nat namespace.</p>",
        "id": 537018801,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756687314
    },
    {
        "content": "<p>Is looking by namespace more restrictive? Does the difference exist intentionally so one is stricter than the other, or is it due to some other design reason?</p>",
        "id": 537018848,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1756687370
    },
    {
        "content": "<p>Namespace lookup is very syntactic, in my understanding. Either the declaration exists in the environment by that explicit name, or it doesn't. On the other hand, application of a function that has a typeclass instance argument relies on a typeclass search, that might be computationally intensive or not. It relies on more than just available declaration _names_, but also values: instances.</p>\n<p>So I wouldn't call one stricter than the other. The dot notation is syntactic sugar for namespaced declarations, with some special support for situations where the underlying type is a subtype of some other type (so it can look in both namespaces).</p>",
        "id": 537019170,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756687887
    },
    {
        "content": "<p>Said otherwise, if Nat.toString existed and then was renamed (typo) to Natt.toString, then n.toString for n : Nat would stop working outright with the same error as you saw above. On the other hand, if somehow you didn't have an instance of ToString Nat in your environment, and you invoked <code>toString n</code>, you'd see a instance can't be synthesized error.</p>",
        "id": 537019247,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756688010
    },
    {
        "content": "<p>Oh, one more thing. Something to notice here is that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=toString#doc\">docs#toString</a> is actually <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ToString.toString#doc\">docs#ToString.toString</a></p>",
        "id": 537019345,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756688168
    },
    {
        "content": "<p>That is, it is (actually) in the ToString namespace. There happens to also be a global <code>open ToString</code> which basically makes <code>toString</code> invokable globally without having to refer to the ToString namespace.</p>",
        "id": 537019418,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756688255
    },
    {
        "content": "<p>Imagine that there was some other function Foo.toString. And I opened that namespace as well. When the syntax of <code>toString n</code> gets elaborated, both are tried, and if both functions can be invoked with a Nat argument, you get an error about conflicting names. But (iirc) if only one of them works for Nat, then you get the one you meant to use. And there's no clash.</p>",
        "id": 537019505,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1756688374
    },
    {
        "content": "<p>There's another important factor: dot notation looks for a parameter of the value's type. If <code>n.toString</code> could resolve to the global <code>toString</code>, there's no <code>Nat</code> parameter.</p>",
        "id": 537022300,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756691422
    },
    {
        "content": "<p>It's possible to create an alias to <code>ToString.toString</code> in the <code>Nat</code> namespace, which gets dot notation to resolve, but you can see the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">42</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">ToString</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toString</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">s'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"The answer is \"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">toString</span>\n<span class=\"c\">/-</span>\n<span class=\"cm\">Invalid field notation: Function `toString` does not have</span>\n<span class=\"cm\">a usable parameter of type `Nat` for which to substitute `n`</span>\n\n<span class=\"cm\">Note: Such a parameter must be explicit, or implicit with</span>\n<span class=\"cm\">a unique name, to be used by field notation</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 537023567,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1756692865
    },
    {
        "content": "<p>btw the dot-notation feature you're attempting to use in <code>s'</code> is referred to in the manual as \"Generalized Field Notation\"... there's a section that lays out exactly how it gets parsed, if you need any more clarification:</p>\n<p><a href=\"https://lean-lang.org/doc/reference/latest/Terms/Function-Application/#generalized-field-notation\">https://lean-lang.org/doc/reference/latest/Terms/Function-Application/#generalized-field-notation</a></p>",
        "id": 537033474,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1756703265
    },
    {
        "content": "<p>I'll just add that you might be looking for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.repr#doc\">docs#Nat.repr</a> for which dot notation <em>does</em> work</p>",
        "id": 537042353,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1756709331
    }
]