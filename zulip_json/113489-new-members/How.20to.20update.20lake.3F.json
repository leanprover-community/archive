[
    {
        "content": "<p>I've been updating Lean and Mathlib for a custom project every once in a while (at least 20 times total now) and it has never worked the first time. Every time there's a different error that needs fixing. </p>\n<p>What's the correct process for updating? So-far I've been doing:</p>\n<ul>\n<li><code>rm -rf .lake</code></li>\n<li><code>lake update Mathlib  -- will fail</code></li>\n<li>&lt;manually copy toolchain file from mathlib folder to my project&gt;</li>\n<li><code>rm -rf .lake</code></li>\n<li>lake update Mathlib</li>\n</ul>\n<p>(In previous versions, <code>lake update</code> without <code>Mathlib</code> never worked and I've seen people here saying one should never use it. Is that still so? It's really unfortunate...)</p>\n<p>This time, I'm getting (uppon changing the toolchain file and running <code>lake</code>)</p>\n<blockquote>\n<p>error: toolchain 'leanprover/lean4:v4.10.0' is not installed</p>\n</blockquote>\n<p>I tried using <code>elan</code> to update as described <a href=\"https://lean-lang.org/lean4/doc/setup.html\">here</a> but it didn't help. (tried <code>elan self update</code> and <code>elan update</code>) What should I do? Reinstall lean? Is this information written up somewhere?</p>",
        "id": 456124231,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722674174
    },
    {
        "content": "<p>What I do, and it has never failed so far, is to copy-paste the <code>lean-toolchain</code> file from mathlib to my project, <em>then</em> only run <code>lake update</code></p>",
        "id": 456125099,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722674869
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113489-new-members/topic/How.20to.20update.20lake.3F/near/456125099\">said</a>:</p>\n<blockquote>\n<p>What I do, and it has never failed so far, is to copy-paste the <code>lean-toolchain</code> file from mathlib to my project, <em>then</em> only run <code>lake update</code></p>\n</blockquote>\n<p>You mean go on GitHub and copy the file manually from there?</p>",
        "id": 456125222,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722674914
    },
    {
        "content": "<p>Well in fact I have <a href=\"https://github.com/YaelDillies/LeanAPAP/blob/master/scripts/update_mathlib.sh\">a script</a> to do that for me, but basically yes <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 456125282,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722674975
    },
    {
        "content": "<p>I really wonder why it's not possible to have <code>lake update</code> just work... <br>\nIn any case, doing what you suggested, I unfortunately get the same error: toolchain not installed<br>\n(I now also did <code>elan toolchain install v4.10.0</code> in addition, but <code>lake update Mathlib</code> still gives the same error)</p>",
        "id": 456125518,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722675164
    },
    {
        "content": "<p>Are you on Windows?</p>",
        "id": 456126321,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722675525
    },
    {
        "content": "<p>Ubuntu.</p>\n<p>I now looked at </p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>&gt;<span class=\"w\"> </span>elan<span class=\"w\"> </span>show<span class=\"w\">                                                                                                                        </span>main<span class=\"w\"> </span><span class=\"o\">[</span>abfe43f<span class=\"o\">]</span><span class=\"w\"> </span>deleted<span class=\"w\"> </span>modified<span class=\"w\"> </span>untracked\ninstalled<span class=\"w\"> </span>toolchains\n--------------------\n\nnightly\nleanprover/lean4:4.10.0\nleanprover/lean4:nightly-2023-07-12\nleanprover/lean4:nightly-2023-08-23\nleanprover/lean4:stable<span class=\"w\"> </span><span class=\"o\">(</span>default<span class=\"o\">)</span>\nleanprover/lean4:v4.10.0-rc1\nleanprover/lean4:v4.10.0-rc2\nleanprover/lean4:v4.5.0\nleanprover/lean4:v4.6.0-rc1\nleanprover/lean4:v4.7.0-rc2\nleanprover/lean4:v4.8.0-rc1\nleanprover/lean4:v4.8.0-rc2\nleanprover/lean4:v4.9.0-rc3\nv4.10.0\n\nactive<span class=\"w\"> </span>toolchain\n----------------\n\nleanprover/lean4:v4.10.0<span class=\"w\"> </span><span class=\"o\">(</span>overridden<span class=\"w\"> </span>by<span class=\"w\"> </span><span class=\"s1\">'/mnt/data/git/LEAN/formal-qkd/lean-toolchain'</span><span class=\"o\">)</span>\n<span class=\"o\">(</span>toolchain<span class=\"w\"> </span>not<span class=\"w\"> </span>installed<span class=\"o\">)</span>\n</code></pre></div>\n<p>which really confuses me. The toolchain that's active is \"not installed\" but also in the list above (actually twice with different names?)...</p>",
        "id": 456126387,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722675592
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/stream/113489-new-members/topic/How.20to.20update.20lake.3F/near/456125099\">said</a>:</p>\n<blockquote>\n<p>What I do, and it has never failed so far, is to copy-paste the <code>lean-toolchain</code> file from mathlib to my project, <em>then</em> only run <code>lake update</code></p>\n</blockquote>\n<p>Just to make sure, you run literally <code>lake update</code>, not <code>lake update Mathlib</code> or something like that? Or does one need the <code>lake -R -Kenv=dev update</code> from your script?</p>",
        "id": 456126636,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722675749
    },
    {
        "content": "<p>This shouldn't happen but try <code>elan toolchain install leanprover/lean4:v4.10.0</code></p>",
        "id": 456126925,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722675972
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>&gt;<span class=\"w\"> </span>elan<span class=\"w\"> </span>toolchain<span class=\"w\"> </span>install<span class=\"w\"> </span>leanprover/lean4:v4.10.0\n\n<span class=\"w\">  </span>leanprover/lean4:v4.10.0<span class=\"w\"> </span>unchanged<span class=\"w\"> </span>-<span class=\"w\"> </span><span class=\"o\">(</span>toolchain<span class=\"w\"> </span>not<span class=\"w\"> </span>installed<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 456126967,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722676033
    },
    {
        "content": "<p>I run <code>lake -R -Kenv=dev update</code> because of a specificity of my project using doc-gen but only in CI</p>",
        "id": 456127248,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722676250
    },
    {
        "content": "<p>Is it weird that there's three different lines that contain 4.10.0 in the elan show output?</p>",
        "id": 456128889,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722677430
    },
    {
        "content": "<p>It's definitely weird to me...</p>",
        "id": 456128930,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722677458
    },
    {
        "content": "<p>Well, each release candidate is a different toolchain, right?</p>",
        "id": 456129231,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722677711
    },
    {
        "content": "<p>They have literally the same version. These are not release candidates, right? <code>leanprover/lean4:4.10.0</code> and <code>v4.10.0</code> are \"different\" installed things, <code>leanprover/lean4:v4.10.0</code> is \"not installed\" (despite being named identically to something installed)</p>",
        "id": 456129342,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722677812
    },
    {
        "content": "<p>Oh I see</p>",
        "id": 456129397,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1722677879
    },
    {
        "content": "<p>I might move all of <code>~/.elan</code> out of the way and see what happens</p>",
        "id": 456135494,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722681071
    },
    {
        "content": "<p>By \"move out of the way\" you mean delete it?</p>",
        "id": 456135522,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722681099
    },
    {
        "content": "<p>Either that or <code>mv ~/.elan ~/old-.elan</code> in case you want to look at what happened in there afterward</p>",
        "id": 456135674,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722681167
    },
    {
        "content": "<p>I guess after renaming it I have to reinstall <code>elan</code>? It's no longer there. </p>\n<p>So I \"carefully look at what it downloads and then\" run <code>curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh</code> ?</p>",
        "id": 456135867,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722681268
    },
    {
        "content": "<p>Oh, I forgot that elan itself also lives there. Yeah, try that</p>",
        "id": 456136208,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1722681466
    },
    {
        "content": "<p>Ok, that seems to have worked. I guess my new workflow for \"updating dependencies for my project is\"</p>\n<ul>\n<li>copy-paste toolchain file from Mathlib (<code>curl -L https://raw.githubusercontent.com/leanprover-community/mathlib4/master/lean-toolchain -o lean-toolchain</code>)</li>\n<li><code>rm -rf .lake</code></li>\n<li><code>lake -R update</code></li>\n<li>&lt;if the above fails&gt;:  delete or rename <code>~/.elan</code></li>\n<li>reinstall elan (\"carefully look at what it downloads and then\" run <code>curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh</code>)</li>\n<li>try from the top</li>\n</ul>",
        "id": 456139346,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722683962
    },
    {
        "content": "<p>This duplication of toolchains, which presumably caused the final error, will be solved in the next version of elan</p>",
        "id": 456140318,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1722684638
    },
    {
        "content": "<p>Thanks a lot for the help to everyone!!</p>\n<p>So I guess you already know the issue. Does anyone nevertheless want to debug this and is interested in the contents of my <code>.elan</code> folder which I renamed? Otherwise I'm deleting it.</p>",
        "id": 456140523,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1722684840
    }
]