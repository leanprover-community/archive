[
    {
        "content": "<p>What is the equivalent letter combination for <code>ùïú</code> in Lean, similar to how <code>‚Ñù</code> corresponds to <code>Real</code> and <code>ùìù</code> corresponds to <code>nhds</code>?</p>",
        "id": 513754793,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745371462
    },
    {
        "content": "<p>You can do <code>\\bbk</code></p>",
        "id": 513755556,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745371972
    },
    {
        "content": "<p>These are listed in <a href=\"https://github.com/leanprover/vscode-lean4/blob/master/lean4-unicode-input/src/abbreviations.json\">https://github.com/leanprover/vscode-lean4/blob/master/lean4-unicode-input/src/abbreviations.json</a></p>",
        "id": 513755611,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745372017
    },
    {
        "content": "<p>\\bbkÊòØthe way to input <code>ùïú</code>,  but I want something like Real not \\R, because I am using lean-repl, which can't process <code>ùïú</code>.</p>",
        "id": 513755979,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745372244
    },
    {
        "content": "<p><code>ùïú</code> is an arbitrary character though, it doesn't mean anything (as far as I know)</p>",
        "id": 513756126,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1745372347
    },
    {
        "content": "<p><code>Real</code> is the name of a definition, but <code>ùïú</code> is just an identifier. I could rename all occurrences of <code>ùïú</code> to <code>‚úÇ</code> and everything would still work fine.</p>",
        "id": 513761498,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745375660
    },
    {
        "content": "<p><code>_= inner (ùïú := ‚Ñù) block Ae1 := by rfl</code> but here we must use <code>ùïú </code>, because of <code>Inner.inner.{u_4, u_5} {ùïú : Type u_4} {E : Type u_5} [self : Inner ùïú E] : E ‚Üí E ‚Üí ùïú</code>.</p>",
        "id": 513761660,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745375771
    },
    {
        "content": "<p>And I want to find a way to replace <code>ùïú</code> with other equal identifiers.</p>",
        "id": 513761743,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745375851
    },
    {
        "content": "<p>hmm, manual parameter assignment...</p>\n<p>maybe you could use <code>@inner</code> instead and just add <code>_</code> where appropriate?</p>",
        "id": 513761886,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1745375932
    },
    {
        "content": "<p>You could also use a type ascription</p>",
        "id": 513761938,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745375982
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span>  What is it?</p>",
        "id": 513762002,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745376005
    },
    {
        "content": "<p><code>(inner block Ae1inner : ‚Ñù)</code></p>",
        "id": 513762268,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745376165
    },
    {
        "content": "<p>You can also open the <code>RealInnerProductSpace</code> namespace to get some notation that's specifically for real inner products.</p>",
        "id": 513762434,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1745376244
    },
    {
        "content": "<p>Ok, I will try.</p>",
        "id": 513762481,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745376269
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> <a href=\"#narrow/stream/113489-new-members/topic/equivalent.20letter.20combination.20for.20.60.F0.9D.95.9C.60/near/513755979\">said</a>:</p>\n<blockquote>\n<p>I am using lean-repl, which can't process <code>ùïú</code>.</p>\n</blockquote>\n<p>What do you mean by this?</p>",
        "id": 513805573,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745396239
    },
    {
        "content": "<p>@if there is a <code>ùïú</code> in lean file, it returns error.</p>",
        "id": 513820358,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745400403
    },
    {
        "content": "<p>Not for me when reading files in VS Code.</p>",
        "id": 513821812,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745400784
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> <a href=\"#narrow/stream/113489-new-members/topic/equivalent.20letter.20combination.20for.20.60.F0.9D.95.9C.60/near/513820358\">said</a>:</p>\n<blockquote>\n<p>@if there is a <code>ùïú</code> in lean file, it returns error.</p>\n</blockquote>\n<p>Can you give an example of the error, and how you produced it?</p>",
        "id": 513839824,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745406197
    },
    {
        "content": "<p>Personally, I'd keep all \"weird\" letters for constants (or rather notations that stand for them). I'd rather use only \"normal\" letters (latin, greek) for variables.</p>",
        "id": 513840253,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1745406326
    },
    {
        "content": "<p>But your personal opinions are almost certainly not going to change the conventions which the analysts have been using for years in mathlib.</p>",
        "id": 513840502,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745406391
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">utils</span><span class=\"bp\">.</span><span class=\"n\">commands</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">os</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">re</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Get</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">script</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">located</span>\n<span class=\"n\">current_dir</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">dirname</span><span class=\"o\">(</span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">abspath</span><span class=\"o\">(</span><span class=\"bp\">__</span><span class=\"n\">file__</span><span class=\"o\">))</span>\n\n<span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">Create</span><span class=\"w\"> </span><span class=\"n\">paths</span><span class=\"w\"> </span><span class=\"n\">relative</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"n\">script's</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n<span class=\"n\">math_dir</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">current_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">optlib'</span><span class=\"o\">)</span>\n<span class=\"n\">repl_dir</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">current_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">repl'</span><span class=\"o\">)</span>\n<span class=\"n\">log_file</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">current_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">log'</span><span class=\"o\">)</span>\n\n<span class=\"n\">source_file</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">current_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">optlib</span><span class=\"bp\">/</span><span class=\"n\">Optlib</span><span class=\"bp\">/</span><span class=\"n\">tmp</span><span class=\"bp\">.</span><span class=\"n\">lean'</span><span class=\"o\">)</span>\n\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">process_lean_file</span><span class=\"o\">(</span><span class=\"n\">source_file</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">lake_dir</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">math_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'.</span><span class=\"n\">lake'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">isdir</span><span class=\"o\">(</span><span class=\"n\">lake_dir</span><span class=\"o\">)):</span>\n<span class=\"w\">        </span><span class=\"n\">run_lake_build</span><span class=\"o\">(</span><span class=\"n\">math_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">mathlib'</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">run_lake_build</span><span class=\"o\">(</span><span class=\"n\">math_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">''</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">lake_dir</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">repl_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'.</span><span class=\"n\">lake'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"bp\">.</span><span class=\"n\">path</span><span class=\"bp\">.</span><span class=\"n\">isdir</span><span class=\"o\">(</span><span class=\"n\">lake_dir</span><span class=\"o\">)):</span>\n<span class=\"w\">        </span><span class=\"n\">run_lake_build</span><span class=\"o\">(</span><span class=\"n\">repl_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">repl'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">run_env_build</span><span class=\"o\">(</span><span class=\"n\">math_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">repl_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">log_file</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">cmds</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">    </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"n\">source_file</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"r\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">encoding</span><span class=\"bp\">=</span><span class=\"s2\">\"utf-8\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">statements</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">readlines</span><span class=\"o\">()</span>\n\n<span class=\"w\">    </span><span class=\"n\">all_cmds</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"cmd\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"bp\">.</span><span class=\"n\">join</span><span class=\"o\">(</span><span class=\"n\">statements</span><span class=\"o\">)}</span>\n<span class=\"w\">    </span><span class=\"n\">write_to_process</span><span class=\"o\">(</span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">stdin</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">all_cmds</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">read_from_process</span><span class=\"o\">(</span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"o\">)</span>\n\n<span class=\"w\">    </span><span class=\"n\">idx</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">goals</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"s2\">\"messages\"</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">messages'</span><span class=\"o\">]:</span>\n<span class=\"w\">            </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">msg</span><span class=\"o\">)</span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">msg</span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">severity'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"o\">:</span>\n<span class=\"w\">                </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">msg</span><span class=\"o\">)</span>\n<span class=\"w\">                </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span>\n\n\n\n<span class=\"n\">print</span><span class=\"o\">(</span><span class=\"s2\">\"start processing\"</span><span class=\"o\">)</span>\n<span class=\"n\">process_lean_file</span><span class=\"o\">(</span><span class=\"n\">source_file</span><span class=\"o\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"n\">processing</span>\n<span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">severity'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">error'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">pos'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">line'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">column'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">},</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">endPos'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">data'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">token'</span><span class=\"o\">}</span>\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>  Here are the .py file, tmp.lean and the error messages.</p>",
        "id": 513993345,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745459517
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">typing</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Union</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Tuple</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Dict</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">subprocess</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">json</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">run_lake_build</span><span class=\"o\">(</span><span class=\"n\">directory</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">target_name</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">f'</span><span class=\"o\">{</span><span class=\"s2\">\"-\"</span><span class=\"bp\">*</span><span class=\"mi\">20</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">target_name</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"s2\">\"-\"</span><span class=\"bp\">*</span><span class=\"mi\">20</span><span class=\"o\">}</span><span class=\"bp\">'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"o\">(</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">lake'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">build'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">target_name</span><span class=\"o\">],</span>\n<span class=\"w\">        </span><span class=\"n\">cwd</span><span class=\"bp\">=</span><span class=\"n\">directory</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">text</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">capture_output</span><span class=\"bp\">=</span><span class=\"n\">True</span>\n<span class=\"w\">    </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">strip</span><span class=\"o\">())</span>\n<span class=\"w\">    </span><span class=\"n\">return</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">run_version_query</span><span class=\"o\">():</span>\n<span class=\"w\">    </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"o\">(</span>\n<span class=\"w\">        </span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">lean'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"c1\">--version'],</span>\n<span class=\"w\">        </span><span class=\"n\">text</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">capture_output</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">check</span><span class=\"bp\">=</span><span class=\"n\">True</span>\n<span class=\"w\">    </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">strip</span><span class=\"o\">()</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">run_env_build</span><span class=\"o\">(</span><span class=\"n\">math_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">repl_dir</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">log_file</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">'</span><span class=\"n\">stdbuf'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">i0'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">o0'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'-</span><span class=\"n\">e0'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lake'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">env'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"o\">{</span><span class=\"n\">repl_dir</span><span class=\"o\">}</span><span class=\"bp\">/.</span><span class=\"n\">lake</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">repl'</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">log_file</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">None</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"n\">log_file</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">w'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">DEVNULL</span>\n<span class=\"w\">    </span><span class=\"n\">process</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">Popen</span><span class=\"o\">(</span>\n<span class=\"w\">        </span><span class=\"n\">command</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">stdout</span><span class=\"bp\">=</span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">PIPE</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">stdin</span><span class=\"bp\">=</span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">PIPE</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">stderr</span><span class=\"bp\">=</span><span class=\"n\">f</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">encoding</span><span class=\"bp\">='</span><span class=\"n\">utf</span><span class=\"bp\">-</span><span class=\"mi\">8</span><span class=\"bp\">'</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">cwd</span><span class=\"bp\">=</span><span class=\"n\">math_dir</span>\n<span class=\"w\">    </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">process</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">read_from_process</span><span class=\"o\">(</span><span class=\"n\">stdin</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">dict</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">range</span><span class=\"o\">(</span><span class=\"mi\">100000000</span><span class=\"o\">):</span>\n<span class=\"w\">        </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">stdin</span><span class=\"bp\">.</span><span class=\"n\">readline</span><span class=\"o\">()</span>\n<span class=\"w\">        </span><span class=\"n\">try</span><span class=\"o\">:</span>\n<span class=\"w\">            </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">json</span><span class=\"bp\">.</span><span class=\"n\">loads</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">except</span><span class=\"w\"> </span><span class=\"n\">json</span><span class=\"bp\">.</span><span class=\"n\">JSONDecodeError</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">:</span>\n<span class=\"w\">            </span><span class=\"n\">continue</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">res</span>\n<span class=\"w\">    </span><span class=\"n\">raise</span><span class=\"w\"> </span><span class=\"n\">json</span><span class=\"bp\">.</span><span class=\"n\">JSONDecodeError</span><span class=\"o\">(</span><span class=\"s2\">\"The JSON object must be read in 10000 lines\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">write_to_process</span><span class=\"o\">(</span><span class=\"n\">stdout</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">obj</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">write</span><span class=\"o\">(</span><span class=\"n\">json</span><span class=\"bp\">.</span><span class=\"n\">dumps</span><span class=\"o\">(</span><span class=\"n\">obj</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">'\\</span><span class=\"n\">n</span><span class=\"bp\">\\</span><span class=\"n\">n'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">stdout</span><span class=\"bp\">.</span><span class=\"n\">flush</span><span class=\"o\">()</span>\n\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">send_input_to_process</span><span class=\"o\">(</span><span class=\"n\">process</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">input_data</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">write_to_process</span><span class=\"o\">(</span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">stdin</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">input_data</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">output_data</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">read_from_process</span><span class=\"o\">(</span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">stdout</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"s2\">\"output_data: {}\"</span><span class=\"bp\">.</span><span class=\"n\">format</span><span class=\"o\">(</span><span class=\"n\">output_data</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">output_data</span>\n</code></pre></div>\n<p>and here is the util.commands.py</p>",
        "id": 513993658,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745459755
    },
    {
        "content": "<p>How are you dealing with json dumps and utf-8??</p>",
        "id": 513994693,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745460373
    },
    {
        "content": "<p>I bet you are sending escaped unicode to the process as \\uxxxx strings.</p>",
        "id": 513994780,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745460443
    },
    {
        "content": "<p>So what is the right way to process?</p>",
        "id": 513995209,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745460682
    },
    {
        "content": "<p>You likely want <code>ensure_ascii=False</code> in your dumps call</p>",
        "id": 513995308,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745460747
    },
    {
        "content": "<p>But also reconsider writing str into your pipe, you could write bytes. That's a separate thing, ensure ascii will be a necessary ingredient regardless.</p>",
        "id": 513995392,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745460818
    },
    {
        "content": "<p>Can you verify my hypothesis through some sort of print statement, or debug run echoing what's getting sent down the pipe, please?</p>",
        "id": 513995474,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745460856
    },
    {
        "content": "<p>I am trying</p>",
        "id": 513995501,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745460874
    },
    {
        "content": "<p>There is no error now, thank you!</p>",
        "id": 513995646,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745460984
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> has marked this topic as resolved.</p>",
        "id": 513995698,
        "sender_full_name": "Notification Bot",
        "timestamp": 1745461032
    },
    {
        "content": "<p>Maybe lean-repl should handle \\uxxxx encoded unicode inputs in its json string values. <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 513995778,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745461084
    },
    {
        "content": "<p>I agree with you. <span aria-label=\"panda\" class=\"emoji emoji-1f43c\" role=\"img\" title=\"panda\">:panda:</span></p>",
        "id": 513995863,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1745461149
    },
    {
        "content": "<p>However, there's nothing wrong about json having unicode, so it's really an awareness of how the python stdlib json library operates</p>",
        "id": 513996073,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1745461281
    },
    {
        "content": "<p>I think it's worse than that, the syntax of unicode escapes in json itself only make sense in UTF-16, but I don't think the semantics are ever specified</p>",
        "id": 514002769,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745465421
    },
    {
        "content": "<p>Oh nevermind, this is in the extended <a href=\"https://www.ietf.org/rfc/rfc4627.txt\">spec</a>:</p>\n<blockquote>\n<p>To escape an extended character that is not in the Basic Multilingual<br>\n   Plane, the character is represented as a twelve-character sequence,<br>\n   encoding the UTF-16 surrogate pair.  So, for example, a string<br>\n   containing only the G clef character (U+1D11E) may be represented as<br>\n   \"\\uD834\\uDD1E\".</p>\n</blockquote>",
        "id": 514002990,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745465550
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/113489-new-members/topic/.E2.9C.94.20equivalent.20letter.20combination.20for.20.60.F0.9D.95.9C.60/near/513995778\">said</a>:</p>\n<blockquote>\n<p>Maybe lean-repl should handle \\uxxxx encoded unicode inputs in its json string values. <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>\n</blockquote>\n<p>You mean <code>Lean.Json.parse</code>?</p>",
        "id": 514003210,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745465693
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/5445\">lean4#5445</a></p>",
        "id": 514003308,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1745465761
    }
]