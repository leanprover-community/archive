[
    {
        "content": "<p>I'm on <a href=\"https://adam.math.hhu.de/#/g/leanprover-community/nng4/world/Power/level/9\">Level 9</a> of the Power world and this is my code so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_two</span><span class=\"o\">]</span>\n<span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">]</span>\n<span class=\"n\">repeat</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">two_eq_succ_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">succ_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_assoc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"o\">)]</span>\n</code></pre></div>\n<p>my current goal is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>I'm trying to reorder stuff:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_left_comm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"o\">)]</span>\n</code></pre></div>\n<p>But for some reason I'm not able to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">rewrite'</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">equality</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">iff</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"w\"> </span><span class=\"n\">expected</span>\n<span class=\"w\">  </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">424</span>\n<span class=\"n\">ab</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Any idea what I'm doing wrong? In particular <code>a * a + (b * b + (a * b + a * b))</code> looks like matching a general <code>x + (y + z)</code> structure to me so I'd expect <code>add_left_comm</code> (which is defined as <code>(a b c : ℕ) : a + (b + c) = b + (a + c)</code>) to work on it.</p>\n<p>Thanks!</p>",
        "id": 497060022,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1738346487
    },
    {
        "content": "<p>For me, it it looks like <code>add_left_comm</code> is locked, and you get this error if the lemma is not available. (I compared the output to trying <code>rw [lemma_does_not_exist (a*a) (b*b) (a*b + a*b)]</code>) </p>\n<p>In a normal editor, you would definitely get an error about an unknown theorem.</p>",
        "id": 497061373,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738346978
    },
    {
        "content": "<p>Yeah I agree with Kyle. This absolutely should work. Hovering over e.g. rw [add_assoc ...] on the line before gives a popup talking about <code>MyNat.add_assoc (a b c : ℕ) : a + b + c = a + (b + c)</code> but hovering over <code>add_left_comm</code> gives no such popup. </p>\n<p>Oh! I see the problem. <code>add_left_comm</code> is proved as level 1 of Algorithm World and this is not a prerequisite for power world (there is no line in the overworld map between the two worlds) so it will literally be the case that the relevant theorem is not imported and there is nothing that the end user can do about this. I would blame the amateur developer ;-) Sorry! You'll have to do it without add_left_comm!</p>",
        "id": 497062112,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738347292
    },
    {
        "content": "<p>There seems to be a bug in the Lean game engine here too, since it's dropping the \"unknown identifier '<code>add_left_comm</code>'\" error.</p>\n<p>There's also a bug in Lean 4 itself, since it shouldn't be giving the \"tactic 'rewrite' failed, equality or iff proof expected\" error if there's an elaboration error.</p>\n<p>Three bugs in one :-)</p>",
        "id": 497062889,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738347579
    },
    {
        "content": "<p>The second one is normal I think.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">error: unknown identifier 'notatheorem'</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">error: tactic 'rewrite' failed, equality or iff proof expected</span>\n<span class=\"sd\">  ?m.5</span>\n<span class=\"sd\">⊢ True</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">notatheorem</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 497063378,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738347742
    },
    {
        "content": "<p>Yes, that's the behavior, but I'm suggesting that it should not print the second error.</p>",
        "id": 497065428,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738348456
    },
    {
        "content": "<p>Usually the rule is if there are elaboration failures, tactics should not continue with further steps.</p>",
        "id": 497065531,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738348500
    },
    {
        "content": "<p>Proposed lean fix: <a href=\"https://github.com/leanprover/lean4/pull/6891\">lean4#6891</a></p>",
        "id": 497068593,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738349668
    },
    {
        "content": "<p>Ah that makes sense, thanks for explaining.</p>\n<p>Would it be helpful if I explored fixing the bug in the tutorial app (unless someone got there first)? I haven't looked at the source code yet but I presume there would be some way to limit the \"available\" functions to the subset of the completed Worlds that are reachable as transitive dependencies. Seems like could be a fun onboarding issue.</p>",
        "id": 497080919,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1738354430
    },
    {
        "content": "<p>Just to make one thing clear: whilst you're welcome to goof around at <a href=\"https://github.com/leanprover-community/NNG4\">https://github.com/leanprover-community/NNG4</a> (the game code) and <a href=\"https://github.com/leanprover-community/lean4game\">https://github.com/leanprover-community/lean4game</a> (the game engine code), I'm a mathematician and all I did was design the levels, I don't have a clue how any of the actual functionality works. I think it's pretty clear what's going on here though, I decided not to let people have access to <code>add_left_comm</code> but I have put it in a pretty weird place. The disadvantage of just loading e.g. addition world with loads of API like <code>add_left_comm</code> is that after a while the levels get boring to prove, you get good at addition and then it's just more of the same when all you want to do is to start on multiplication or something else. But perhaps this event is evidence that <code>add_left_comm</code> should be moved.</p>",
        "id": 497090621,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738358516
    },
    {
        "content": "<p>To clarify, what I'm proposing is to tweak the game logic (assuming it's possible — I can have a look!) to mark <code>add_left_comm</code> and such as \"locked\" in any worlds that aren't directly \"descended\" (i.e. reachable by following arrows) from the Algorithm World. I think this would keep your intended sequencing.</p>",
        "id": 497103636,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1738364555
    },
    {
        "content": "<p>I think this gets done automatically if you toggle the \"rules\" switch on the overworld page to \"regular\". <br>\n<a href=\"/user_uploads/3121/YCsG_Dm3xhWuzZ2fgGsNxwfI/Screenshot-from-2025-02-01-00-31-19.png\">Screenshot from 2025-02-01 00-31-19.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YCsG_Dm3xhWuzZ2fgGsNxwfI/Screenshot-from-2025-02-01-00-31-19.png\" title=\"Screenshot from 2025-02-01 00-31-19.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"247x242\" src=\"/user_uploads/thumbnail/3121/YCsG_Dm3xhWuzZ2fgGsNxwfI/Screenshot-from-2025-02-01-00-31-19.png/840x560.webp\"></a></div>",
        "id": 497111852,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738369886
    },
    {
        "content": "<p>Hmm, I'm definitely on \"regular\" rules. I think it might be this:</p>\n<blockquote>\n<p>Note: \"Unlocked\" tactics (or theorems) are determined by two things: The set of minimal tactics needed to solve a level, plus any tactics you unlocked in another level. That means if you unlock <code>simp</code> in a level, you can use it henceforth in any level.</p>\n</blockquote>\n<p>Would it make sense to change it so that you can use any tactics you unlocked in levels above that are reachable by arrows? Which I think is already what's being enforced in terms of importing — the problem is just that the UI doesn't faithfully reflect what's available.</p>",
        "id": 497112925,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1738370644
    },
    {
        "content": "<p>Aah -- so you finished algorithm world before power world and then you're like \"where is my <code>add_left_comm</code> that I proved?\". That seems like a totally reasonable question to me. The answer is \"erm it's not imported\".</p>",
        "id": 497113606,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738371149
    },
    {
        "content": "<p>Right, or rather — the UI is misleading because it offers me to use it.</p>\n<p><a href=\"/user_uploads/3121/GuBVDXvvJQWQXiRze4gAUMTx/Screenshot-2025-02-01-at-01.04.08.png\">Screenshot 2025-02-01 at 01.04.08.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/GuBVDXvvJQWQXiRze4gAUMTx/Screenshot-2025-02-01-at-01.04.08.png\" title=\"Screenshot 2025-02-01 at 01.04.08.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2298x1524\" src=\"/user_uploads/thumbnail/3121/GuBVDXvvJQWQXiRze4gAUMTx/Screenshot-2025-02-01-at-01.04.08.png/840x560.webp\"></a></div><p>If it isn't imported at this point, I'd expect it to show up locked in the right pane.</p>",
        "id": 497114568,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1738371886
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"418569\">Dan Abramov</span> has marked this topic as resolved.</p>",
        "id": 497121742,
        "sender_full_name": "Notification Bot",
        "timestamp": 1738377956
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/6891\">lean4#6891</a> for a fix for the confusing \"tactic 'rewrite' failed, equality or iff proof expected\" error.</p>",
        "id": 497895693,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738762955
    }
]