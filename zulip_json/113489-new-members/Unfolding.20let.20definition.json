[
    {
        "content": "<p>Hi everyone! Is it possible to unfold a <code>let</code> definition in Lean4? Here is a simple example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">test</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span> <span class=\"n\">Nat</span><span class=\"o\">):</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span>\n  <span class=\"k\">let</span> <span class=\"n\">zero</span><span class=\"o\">:</span> <span class=\"n\">Nat</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span>\n  <span class=\"k\">let</span> <span class=\"n\">one</span><span class=\"o\">:</span> <span class=\"n\">Nat</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span>\n  <span class=\"kd\">by</span>\n    <span class=\"k\">have</span> <span class=\"n\">h1</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rfl</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h1</span><span class=\"o\">]</span>\n    <span class=\"k\">have</span> <span class=\"n\">h2</span><span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"n\">one</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">rfl</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h2</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>I would like to somehow be able to change my current goal from <code>zero = one</code> to <code>0=one</code>, by doing some kind of <code>unfold zero</code>. </p>\n<p>I am aware of the existence of dsimp, but that would transform the goal into <code>0=1</code></p>",
        "id": 355887969,
        "sender_full_name": "Roberto Pettinau",
        "timestamp": 1683235499
    },
    {
        "content": "<p>What about <code>dsimp only [zero]</code> or if that doesn't work, I can't quite remember the syntax but something like  <code>dsimp (config := {zeta := false}) only [zero]</code>?</p>",
        "id": 355903227,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1683242959
    },
    {
        "content": "<p>As a follow up to this question, how can you unfold definitions which come from pattern matching on a <code>let</code> definition?</p>\n<p>As an example, consider <a href=\"https://live.lean-lang.org/#codez=KYDwhgtgDgNsAEAuAvAKHvOAXeAKEANAJ4CUSyeAjAfAEwnqbA4BOwAzufAMyMAWYAG7BE8Npwoh4AanhEuAIyKMM7AJbQA+gHcAZivjsA9ixbKMuEkA\">the following code</a>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>With the <code>simp_wf</code>, Lean4 is able to substitute <code>res</code> with <code>3</code>, but I'm not able to deduce anything from <code>x</code> or <code>y</code>. In the InfoView I also don't get any information about <code>x</code> or <code>y</code>. Is this a current limitation?</p>\n<p>I would expect to have something like <code>x: Nat := (1,2).fst</code> and <code>y: Nat := (1,2).snd</code> in the InfoView.</p>",
        "id": 496651743,
        "sender_full_name": "Ayhon",
        "timestamp": 1738188460
    },
    {
        "content": "<p>Yeah, this isn't possible at the moment, since <code>let (x, y) := (1, 2); ...</code> is short for <code>match (1, 2) with | (x, y) =&gt; ...</code></p>\n<p>This means that it loses the connection to the original value.</p>\n<p>One of the workarounds is to manually write <code>match h : (1, 2) with | (x, y) =&gt; ...</code>, since that gives you this <code>h</code> in the local context that you can make use of.</p>",
        "id": 496694620,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738213724
    },
    {
        "content": "<p>This also seems to be the case for definitions in the <code>where</code> clause (<a href=\"https://live.lean-lang.org/#codez=KYDwhgtgDgNsAEAuAvAKHvOAXeAnYAzksvAMzrwAWYAbsInofCSPANTwCex8ARpxQwEAltAD6AdwBmg+AQD2uXAIwAKAJSoJlYPnisU8AIyyM3QwCYgA\">example</a>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"o\">()</span>\n<span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">      </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n</code></pre></div>\n<p>Are <code>where</code> clauses also syntactic sugar for some other construct? If so, do we know if these plan to be supported?</p>",
        "id": 496763044,
        "sender_full_name": "Ayhon",
        "timestamp": 1738239811
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rec</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">simp_wf</span>\n<span class=\"w\">    </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>This modifies the environment in the same way, so maybe <code>where</code> is syntax sugar for <code>let rec</code>?</p>",
        "id": 496767442,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1738241096
    },
    {
        "content": "<p>Yeah, it's sugar for let rec</p>",
        "id": 496822598,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738255562
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/113489-new-members/topic/Unfolding.20let.20definition/near/496822598\">said</a>:</p>\n<blockquote>\n<p>Yeah, it's sugar for let rec</p>\n</blockquote>\n<p>And why is <code>let rec</code> not able to be unfolded? Just a current limitation?</p>",
        "id": 496837072,
        "sender_full_name": "Ayhon",
        "timestamp": 1738260141
    },
    {
        "content": "<p>It's because let rec defers creating the auxiliary definitions until everything is elaborated. It's a limitation that I don't expect to see change.</p>",
        "id": 496839133,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738260780
    },
    {
        "content": "<p>You can at least use <code>let</code> instead</p>",
        "id": 496839267,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738260827
    }
]