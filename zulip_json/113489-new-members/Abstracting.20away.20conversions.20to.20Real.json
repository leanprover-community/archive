[
    {
        "content": "<p>Sorry for this very open question, that might be a bit style-based. I hope someone might still have some ideas. It's about about writing Lean code that is as close as possible to LaTeX-style real-number equations (which do not specify types) and make statements about the definitions \"when the types are such-and-such\" while keeping everything as simple and readable as possible.</p>\n<p>Concretely, I have a function which inputs a bunch of (Natural and Rational) numbers and outputs a Natural number. This function is a rather long and cumbersome composition of standard functions such as <code>+, *, /, ^, Real.sqrt, Real.log</code> that work with real numbers. Furthermore, since there are quite many inputs, I group them in (actually two) structures. A toy example might look like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Real</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">Param</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\">  </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span>\n\n<span class=\"kd\">noncomputable</span><span class=\"w\"> </span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Param</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⌊</span><span class=\"n\">Real.log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p.x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">p.y</span><span class=\"o\">)</span><span class=\"bp\">⌋₊</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">Domf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Param</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p.x</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">p.y</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span>\n</code></pre></div>\n<p>Imagine that (just for readability) <code>f</code> is defined in terms of  a bunch of other functions, which are defined above and fill several pages (all of them in the end reduce to \"standard functions\").</p>\n<p>I would like to state some lemmas about <code>f</code> which effectively (i.e., the code should be as short and easy to understand as possible) convince a reader that <code>f</code> is \"well-behaved\" on the domain <code>Domf</code>. For example, I might want to say something like</p>\n<blockquote>\n<p>if all inputs were Reals (instead of Naturals or Rationals) then <code>f</code> would be continuous/differentiable/etc. on the real-number version of <code>Domf</code>.</p>\n</blockquote>\n<p>I hope this would also mostly convince a reader that the domain <code>Domf</code> is actually \"mathematically valid\" (i.e., no junk values are used).</p>\n<p>The issue with what I've tried so-far is that the formalization of such statements involves a lot of coercions, which makes the function I'm proving something about quite far away from <code>f</code>. </p>\n<p>For example, an approach I've considered would be defining <code>f_Real : ℝ × ℝ  → ℝ </code>, prove things about that, and then define <code>f</code> in terms of <code>f_Real</code>. The downside is that I don't see a <em>nice</em> way to relate them (I would basically have to say in a comment \"clearly it's the same function with different types\") and it makes me have huge tuples everywhere (and also it makes me define duplicates of lots of other auxiliary definitions in terms of real numbers). The definition of <code>f</code>is written to be easy as possible for people to check that I did in fact just type out the exact equations from a certain LaTeX document and all my ideas make this really cumbersome and ugly.</p>\n<p>How would you approach this? Thanks in advance for any suggestions!</p>",
        "id": 479371261,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1730155082
    },
    {
        "content": "<p>You can write a proof that these are the same functions pointwise (i.e. that f_Real takes the same values on all natural points as f_Nat). Then you don't have to define <code>f</code> in terms of <code>fReal</code>, but you still have to write the formula twice.</p>",
        "id": 479372033,
        "sender_full_name": "Alex Mobius",
        "timestamp": 1730155409
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"767265\">Alex Mobius</span> <a href=\"#narrow/channel/113489-new-members/topic/Abstracting.20away.20conversions.20to.20Real/near/479372033\">said</a>:</p>\n<blockquote>\n<p>You can write a proof that these are the same functions pointwise (i.e. that f_Real takes the same values on all natural points as f_Nat). Then you don't have to define <code>f</code> in terms of <code>fReal</code>, but you still have to write the formula twice.</p>\n</blockquote>\n<p>Right, I have to write <em>all</em> the formulas of almost all of the auxilliary functions twice. (Which might be somewhat OK because a reader who trusts me not to be deceptive on purpose might not have to read those duplicates at all). Also, it still gives me huge tuples everywhere, or I have to define my own product topology for the structures? But maybe there's something better?</p>",
        "id": 479372365,
        "sender_full_name": "Adomas Baliuka",
        "timestamp": 1730155568
    },
    {
        "content": "<p>Another approach you might find amusing would be to define your function on \"natural-valued reals\" <code>{x \\in R // \\exists n: \\N, x = n}</code>, which is about the same as carrying a tuple, but at least it coerces better; and you can prove facts about aux functions a bit easier.</p>",
        "id": 479372894,
        "sender_full_name": "Alex Mobius",
        "timestamp": 1730155884
    }
]