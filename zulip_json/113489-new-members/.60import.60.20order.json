[
    {
        "content": "<p>Does the order of <code>import</code> matter at all in Lean?  If I have a Lean project that uses mathlib, should <code>import Mathlib</code> come before or after <code>import</code>s of the project's own files?</p>",
        "id": 529950346,
        "sender_full_name": "Ching-Tsun Chou",
        "timestamp": 1753124441
    },
    {
        "content": "<p>In theory, it doesn't</p>",
        "id": 529951867,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753125186
    },
    {
        "content": "<p>I think it affects the order that environment extensions are activated. For example, if Mathlib defines a pretty printer in some module, and one of your own modules imports only a subset of Mathlib (<em>not</em> the module that defines the pretty printer) but implements a pretty printer for the same expression, then which pretty printer is activated depends on which order you import Mathlib and your own modules.</p>\n<p>Another environment extension is all the simp lemmas. Depending on the import order, some simp lemmas might be tried before others. That shouldn't matter if your simp lemmas are confluent...</p>",
        "id": 529951927,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753125215
    },
    {
        "content": "<p>I think we tried sorting all the imports in mathlib, and either stuff broke or performance changed significantly</p>",
        "id": 529963296,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1753130976
    },
    {
        "content": "<p>Here is one of the attempts at sorting imports: <a href=\"https://github.com/leanprover-community/mathlib4/pull/6763\">#6763</a>.</p>",
        "id": 529964886,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1753131727
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/wCFzfUi6T03a0zEcbmX-YgcW/Screenshot-2025-07-21-at-23.49.45.png\">Screenshot 2025-07-21 at 23.49.45.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/wCFzfUi6T03a0zEcbmX-YgcW/Screenshot-2025-07-21-at-23.49.45.png\" title=\"Screenshot 2025-07-21 at 23.49.45.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1928x592\" src=\"/user_uploads/thumbnail/3121/wCFzfUi6T03a0zEcbmX-YgcW/Screenshot-2025-07-21-at-23.49.45.png/840x560.webp\"></a></div><p><span aria-label=\"confusion\" class=\"emoji emoji-1fae4\" role=\"img\" title=\"confusion\">:confusion:</span></p>",
        "id": 529976127,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753138213
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/113489-new-members/topic/.60import.60.20order/near/529951867\">said</a>:</p>\n<blockquote>\n<p>In theory, it doesn't</p>\n</blockquote>\n<p>In practice, it can apparently make files 14 times slower</p>",
        "id": 529976168,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1753138257
    },
    {
        "content": "<p>In theory, there's no difference between theory and practice, right</p>",
        "id": 529977700,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1753139486
    },
    {
        "content": "<p>If it can really impact performance so much ... have we tried simulated annealing on randomized import orders to make the performance as fast as possible? <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 529984729,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1753145502
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"282271\">Bolton Bailey</span> <a href=\"#narrow/channel/113489-new-members/topic/.60import.60.20order/near/529984729\">said</a>:</p>\n<blockquote>\n<p>If it can really impact performance so much ... have we tried simulated annealing on randomized import orders to make the performance as fast as possible? <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>\n</blockquote>\n<p>While we are at it, also randomize variable names to get better results <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 529990254,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1753150628
    },
    {
        "content": "<p>The imports that seem to matter the most are tactic imports. If you sort imports to <em>tactic test files</em> only, so that the relevant <code>Mathlib.Tactic</code> imports are towards the end, then some of the tests time out</p>",
        "id": 529995717,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753155908
    }
]