[
    {
        "content": "<p>Hi, I'm using Lean4 through VS Code, and I'm finding that the InfoView is too \"eager\" to hide the goal/hypotheses when I have an error. Trivial example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>If I remove the final <code>l</code> of <code>rfl</code>,  I get this:<br>\n<a href=\"/user_uploads/3121/_0fYRSFEPqbHngJn7tVnsgtp/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/_0fYRSFEPqbHngJn7tVnsgtp/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"436x282\" src=\"/user_uploads/thumbnail/3121/_0fYRSFEPqbHngJn7tVnsgtp/image.png/840x560.webp\"></a></div><p>Note that it considers there to be \"no goal\".</p>\n<p>Strangely, this only occurs for some categories of error: an unknown tactic <em>won't</em> hide the goal/hypothesis. </p>\n<p>For a more complicated proof state this is quite unhelpful since it usually manifests when I'm trying to remember the name of a hypothesis or variable to type.</p>\n<p>I'm aware that I can pause the InfoView, but this is a bit annoying to have to do manually. Are there any knobs I can use to change this behaviour?</p>",
        "id": 565586656,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951449
    },
    {
        "content": "<p>you can pause the infoview</p>",
        "id": 565592486,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951668
    },
    {
        "content": "<p>Yup, I've tried this (mentioned in the original message), but it's quite annoying to have to do this ~continuously.</p>",
        "id": 565592513,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951719
    },
    {
        "content": "<p>I'm not sure why Lean considers there to be no goal when I have a \"broken\" instance of a tactic?</p>",
        "id": 565592524,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951753
    },
    {
        "content": "<p>the reason there is no goal</p>",
        "id": 565592530,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951761
    },
    {
        "content": "<p>is that the tactic <del>elaborates</del> parses successfully</p>",
        "id": 565592539,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951769
    },
    {
        "content": "<p>and the error handling inserts a synthetic <code>sorry</code></p>",
        "id": 565592544,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951785
    },
    {
        "content": "<p>and <code>apply</code> uses this to close the goal</p>",
        "id": 565592551,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951791
    },
    {
        "content": "<p>even though there is an error</p>",
        "id": 565592559,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951801
    },
    {
        "content": "<p>you can try looking at the expected type window instead maybe?</p>",
        "id": 565592571,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951813
    },
    {
        "content": "<blockquote>\n<p>and the error handling inserts a synthetic <code>sorry</code></p>\n</blockquote>\n<p>Ah I see, thanks</p>",
        "id": 565592595,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951838
    },
    {
        "content": "<blockquote>\n<p>you can try looking at the expected type window instead maybe?</p>\n</blockquote>\n<p>I think this helps for the goal, but not the hypotheses.</p>",
        "id": 565592609,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951857
    },
    {
        "content": "<p>it should show the entire context</p>",
        "id": 565592620,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766951870
    },
    {
        "content": "<p>Checking</p>",
        "id": 565592629,
        "sender_full_name": "James Pollard",
        "timestamp": 1766951883
    },
    {
        "content": "<p>Ah yes I see. Unfortunately it disappears when the error appears :/</p>",
        "id": 565592788,
        "sender_full_name": "James Pollard",
        "timestamp": 1766952011
    },
    {
        "content": "<p>Ok, I guess I can get used to the pause approach</p>",
        "id": 565592881,
        "sender_full_name": "James Pollard",
        "timestamp": 1766952060
    },
    {
        "content": "<p>From memory Proof General + Roqc was \"better\" at this, but I haven't touched it for a while.</p>",
        "id": 565592914,
        "sender_full_name": "James Pollard",
        "timestamp": 1766952086
    },
    {
        "content": "<p>Possibly because it required you to manually advance to a particular part of the proof-script rather than following the cursor?</p>",
        "id": 565592953,
        "sender_full_name": "James Pollard",
        "timestamp": 1766952137
    },
    {
        "content": "<p>This is <a href=\"https://github.com/leanprover/lean4/pull/4181\">lean4#4181</a> (or more specifically, <a href=\"https://github.com/leanprover/lean4/pull/7136\">lean4#7136</a>). I've added your example to the issue.</p>",
        "id": 567715682,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1768295809
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"783409\">James Pollard</span> <a href=\"#narrow/channel/113489-new-members/topic/InfoView.20hides.20goal.2Fhypotheses.20when.20tactic.20incomplete/near/565592953\">said</a>:</p>\n<blockquote>\n<p>Possibly because it required you to manually advance to a particular part of the proof-script rather than following the cursor?</p>\n</blockquote>\n<p>Absolutely! Despite all other Rocq's inconveniences, the proof state is so much more under control there.</p>",
        "id": 567869735,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768343041
    },
    {
        "content": "<p>Actually, could Lean do the same as Rocq? That is</p>\n<ul>\n<li>Obvious syntax highlight of where the current proofstate is (iirc, it slightly changes the background color of the entire document before proofstate).</li>\n<li>Shortcuts for user-controlled moving of this point, independent of the cursor (move one tactic forward, one tactic backward, jump to the cursor).</li>\n</ul>",
        "id": 567871744,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768344080
    },
    {
        "content": "<p>It should be just a matter of keeping two cursors in VS Code, with a specific display of one, and jumping with it according to the tactic goal data already stored along the document. No?</p>",
        "id": 567873059,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768344851
    },
    {
        "content": "<p>The pinned view is actually kind of a cursor / marker, so all we need is just display nicely the position of the pin in the editor, and move it conveniently. I can try to hack the VS Code extension with some AI :-).</p>",
        "id": 568019855,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768405877
    },
    {
        "content": "<p>I would really prefer to see whether we can make some progress on <a href=\"https://github.com/leanprover/lean4/pull/4181\">lean4#4181</a> before we add another mode of interaction to the Lean VS Code extension.</p>",
        "id": 568020427,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1768406025
    },
    {
        "content": "<p>In the end, I don't think it is another mode, just a better pin :-).</p>",
        "id": 568020639,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768406070
    },
    {
        "content": "<p>Visible &amp; movable -- reasonable expectations I would say.</p>",
        "id": 568020753,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768406095
    },
    {
        "content": "<p>I see the effort of stabilizing tactic output less principled than giving user more control over which state to see. When a user is typing a tactic, he is not expecting the tactic being executed in the middle of writing, and seeing the outcome -- most of the time, this is undesired (with interactive tactics being exceptions).</p>",
        "id": 568024405,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768407003
    },
    {
        "content": "<p>In an ideal world, the partial text is not even sent to Lean but I understand this is not really possible with the \"watching compiler\" setup.</p>",
        "id": 568046893,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768413049
    },
    {
        "content": "<p>I agree with you on the desired outcome - but let me disagree that having two kinds of cursors (with one behaving intuitively, and the other being never shown and implicitly updated) is intuitive :-)</p>",
        "id": 568097303,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1768432711
    },
    {
        "content": "<p>I am not sure if we understand each other, we already have two cursors like that when you click \"pin\". My proposal is</p>\n<ul>\n<li>Make the pin clearly visible (Rocq would highlight the full document before the pin meaning that that part was processed). Of course, this means that the \"pin\" would align with the end of a tactic rather than arbitrary position in the document.</li>\n<li>Make it easy to move the pin one tactic forward / backward.</li>\n<li>Experiment with sometimes automatically moving the pin, for example pressing enter.<br>\nI am not yet certain how I will feel about it, and I understand Lean has this \"red / green\" highlight which doesn't fit very well into this pin workflow but I would be curious to try. It feels like a task that could be simple enough to be vibe-coded (because I know currently nothing about how the VS Code extension works).</li>\n</ul>",
        "id": 568274474,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768498118
    },
    {
        "content": "<p>I started <a href=\"https://github.com/mirefek/vscode-lean4\">playing with moving the pin</a> between tactics but detecting the tactic boundaries might be tricky. I kind of understand the behavior of <code>rw</code> but this goal change in the middle of a comment was a bit too much <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Move your curso!r around this exclamation mark</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 568485696,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768584212
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133339\">Mirek Olšák</span> <a href=\"#narrow/channel/113489-new-members/topic/InfoView.20hides.20goal.2Fhypotheses.20when.20tactic.20incomplete/near/568485696\">said</a>:</p>\n<blockquote>\n<p>I started <a href=\"https://github.com/mirefek/vscode-lean4\">playing with moving the pin</a> between tactics but detecting the tactic boundaries might be tricky. I kind of understand the behavior of <code>rw</code> but this goal change in the middle of a comment was a bit too much <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Move your curso!r around this exclamation mark</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I think it's because it enters this second nested <code>by</code>. And because it's past <code>rfl</code> it's \"No goals\".</p>",
        "id": 568495196,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768587183
    },
    {
        "content": "<p>It would be useful if Lean highlighted inside which <code>by</code> you're currently in.</p>",
        "id": 568496044,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1768587449
    },
    {
        "content": "<p>I tried but it seems too challenging to do it only on editor side with pins:</p>\n<ul>\n<li>The editor doesn't get from Lean cleanly the position of a next tactic. There are some way of searching for it but many exchanges with Lean server about different positions take time.</li>\n<li>Nested goals are tricky. Consider</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lem1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">tac1</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lem2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">tac2</span>\n</code></pre></div>\n<p>The natural proofstate after these steps depend on whether <code>tac2</code> solves <code>lem2</code>, or not. If it does, we should be inside the proofstate for <code>lem1</code>, if it doesn't, we should be inside the proofstate for <code>lem2</code>. However, the cursor position for <code>lem1</code> (after <code>have lem2</code>) doesn't even have to have any position in the document.</p>",
        "id": 569003736,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768909641
    },
    {
        "content": "<p>I still think that visible &amp; controlable pin would improve user's control significantly but given it would require editing not only the vscode extension but also Lean server, and given the reluctance of the community, I am not very motivated to do that...</p>",
        "id": 569004312,
        "sender_full_name": "Mirek Olšák",
        "timestamp": 1768909810
    }
]