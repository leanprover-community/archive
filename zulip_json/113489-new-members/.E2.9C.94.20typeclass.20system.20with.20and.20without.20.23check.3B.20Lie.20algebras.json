[
    {
        "content": "<p>Hi all! I'm currently scratching my head in confusion. I am trying to work with the derived subalgebra of a Lie algebra. I took a look at how this works e.g. in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Lie/Nilpotent.html\">Mathlib.Algebra.Lie.Nilpotent</a>: one can take the bracket of an ideal with a submodule to obtain another submodule, as there is an instance for the <code>Bracket</code> class in this case. In particular, one should be able to take the bracket of <code>⊤ : LieIdeal K L</code> with itself.</p>\n<p>Writing it down after the <code>#check</code> command works just fine - but as soon as I try to <em>do something</em> with it, I run into trouble. Here is my MWE:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">IdealOperations</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">LieSubmodule</span><span class=\"bp\">.</span><span class=\"n\">hasBracket</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"c1\">-- Bracket (LieIdeal K L) (LieSubmodule K L L)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">⁅⊤</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">--no problems</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⁅⊤</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span><span class=\"w\"> </span><span class=\"c1\">--typeclass instance problem is stuck; Bracket ?m.800 (LieSubalgebra K L)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span><span class=\"w\"> </span><span class=\"c1\">--failed to synthesize Bracket (LieIdeal K L) (LieSubalgebra K L)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubmodule</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span><span class=\"w\"> </span><span class=\"c1\">-- this works; but how can I make a LieSubalgebra from it?</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L''''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">L'''</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"n\">lie_mem'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"o\">}</span><span class=\"w\"> </span><span class=\"c1\">-- this cannot be the way to do it</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"c1\">-- no problems</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'''</span><span class=\"w\"> </span><span class=\"c1\">--no problems</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">--typeclass instance problem is stuck; Module K ↥L'</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'''</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">--typeclass instance problem is stuck; Module K ↥L'''</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'''</span><span class=\"bp\">.</span><span class=\"n\">toSubmodule</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">--typeclass instance problem is stuck; Module K ↥↑L'''</span>\n</code></pre></div>\n<p>Is it true that <code>#check</code> is more powerful than the regular typeclass inference system in some way? Or what is the reason that my <code>def</code>s and <code>example</code>s don't work? In any case, how do I fix it? All I want is to define the derived subalgebra of <code>L</code> as a term of <code>LieSubalgebra K L</code>, and then be able to take its <code>Module.finrank</code>.</p>",
        "id": 489873416,
        "sender_full_name": "Paul Schwahn",
        "timestamp": 1734573945
    },
    {
        "content": "<p>If you click at the result in <code>#check (⁅⊤, ⊤⁆ : LieSubalgebra K L)</code> and <code>#check Module.finrank K L'</code> you'll see it has metavariables - it doesn't finish resolving the term. I don't know the correct way to do this</p>",
        "id": 489886161,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1734583654
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"692116\">@Paul Schwahn</span> Welcome! I'm glad to see your interest in Lie theory in Lean.</p>\n<ol>\n<li><code>#check (⁅⊤, ⊤⁆ : LieSubalgebra K L) --no problems</code> -- this one is maybe a bit misleading. It looks like everything is working, but if you hover over the bracket in the infoview, you'll notice that it contains metavariables</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">Bracket</span><span class=\"bp\">.</span><span class=\"n\">bracket</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">334</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">313</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span>\n<span class=\"c1\">--</span>\n<span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">313</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Bracket</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">334</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- so it didn't figure out why `Bracket` makes sense in this context</span>\n</code></pre></div>\n<p>The lesson is that <code>#check</code> doesn't force typeclass synthesis, and is happy with \"open\" expressions that still contain metavariables.</p>\n<ol start=\"2\">\n<li>In the next lines, you are running into the issue that Lean can not find the instance of brackets for Lie subalgebras.</li>\n<li>You were almost there. This works</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'''''</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L'''''</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span>\n</code></pre></div>\n<ol start=\"4\">\n<li>You will probably be interested in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LieAlgebra.derivedSeries#doc\">docs#LieAlgebra.derivedSeries</a>.</li>\n</ol>",
        "id": 489888427,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1734585335
    },
    {
        "content": "<p>Great, thanks for the help! So I need to be wary about metavariables when using <code>#check</code>. With your help I found that the definition I want can be shortened to:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lieIdealSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span>\n</code></pre></div>\n<p>Next problem: I want to take a <code>Module.finrank</code> of <code>L' </code>. When I try this, it apparently fails to synthesize a <code>Module K ↥L'</code> instance. Check this out:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">IdealOperations</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lieIdealSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">--typeclass instance problem is stuck; Module K ↥L'</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"c1\">-- LieSubalgebra K L, as it should.</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"bp\">.</span><span class=\"n\">toSubmodule</span><span class=\"w\"> </span><span class=\"c1\">-- L'.toSubmodule : Submodule ?m.2795 ?m.2796 - where did K L go?</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"bp\">.</span><span class=\"n\">toSubmodule</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- Submodule K L, as it should.</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L'</span><span class=\"bp\">.</span><span class=\"n\">toSubmodule</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c1\">--this works</span>\n</code></pre></div>\n<p>Why is Lean unable to infer the data <code>(R := K) (L := L)</code> from <code>L' : LieSubalgebra K L</code> in the function call of <code>LieSubalgebra.toSubmodule</code>? Is there a way to shorten the last example?</p>",
        "id": 490054505,
        "sender_full_name": "Paul Schwahn",
        "timestamp": 1734644812
    },
    {
        "content": "<p>I'm guessing that your mental model of <code>variable</code> is wrong. I would not expect this to work.</p>\n<p>Your <code>variable</code> line does not mean \"Fix a field K and a Lie algebra L\". In fact, in some sense, it does nothing, however it primes Lean to do something in the future. </p>\n<p>Then your <code>def L' :...</code> line mentions <code>K</code> and <code>L</code>, and now the actual variable mechanism kicks in, which is that Lean inserts \"for all fields K and K-Lie algebras L,...\" in the actual definition of <code>L'</code>. </p>\n<p>The upshot is that <code>L'</code> is now a <em>function</em> which eats a field K and a Lie algebra L, and returns the subalgebra <code>[L,L]</code> of <code>L</code>. However K and L are implicit because of the {} brackets, so you can't just give the function <code>L'</code> these inputs by feeding in K and L. </p>\n<p>But you could instead tell Lean the type of <code>L'</code>, and then unification will be able to figure out <code>K</code> and <code>L</code> and then <code>L'</code> will behave as expected. For example, this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">finrank</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>In short then, your definition of <code>L'</code> means that to make it run properly you'll have to either use the <code>(K := K) (L := L)</code> trick or give the type of <code>L'</code> (or be in a situation where Lean can work out the type of <code>L'</code> and hence figure out the inputs <code>K</code> and <code>L</code>).</p>",
        "id": 490057932,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734646531
    },
    {
        "content": "<p>To give an example of what <code>L'</code> actually is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">IdealOperations</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Lie</span><span class=\"bp\">.</span><span class=\"n\">Free</span><span class=\"w\"> </span><span class=\"c1\">-- extra import</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"w\"> </span><span class=\"c1\">-- extra import</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieRing</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LieAlgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">lieIdealSubalgebra</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">⁅</span><span class=\"o\">(</span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieIdeal</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">⊤⁆</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FreeLieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"w\"> </span><span class=\"n\">Bool</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- L' : LieSubalgebra ℚ (FreeLieAlgebra ℚ Bool)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">L'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LieSubalgebra</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">FreeLieAlgebra</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"c1\">-- L' : LieSubalgebra ℂ (FreeLieAlgebra ℂ ℕ)</span>\n</code></pre></div>",
        "id": 490058900,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734647059
    },
    {
        "content": "<p>I see! Yes, I suppose I forgot that  <code>def L' : ...</code> creates a function whose inputs are <code>K</code> and <code>L</code>. Thanks a lot!</p>",
        "id": 490111702,
        "sender_full_name": "Paul Schwahn",
        "timestamp": 1734681869
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"692116\">Paul Schwahn</span> has marked this topic as resolved.</p>",
        "id": 490111720,
        "sender_full_name": "Notification Bot",
        "timestamp": 1734681878
    }
]