[
    {
        "content": "<p>I expected that \"sampling\" from a normal random variable would be non computable but it seems that Lean tries to unroll the definition. I am assuming that increasing <code>maxHeartbeats</code> would just take longer to give me an error. </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hY</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">ν</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">gaussianReal</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mf\">0.5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"bp\">⟩⟩</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"c1\">-- Y</span>\n<span class=\"c1\">--   ⟨{</span>\n<span class=\"c1\">--       cauchy :=</span>\n<span class=\"c1\">--         Quot.mk (fun f g ↦ (f - g).LimZero) ⟨fun x ↦ { num := Int.ofNat 1, den := 2, den_nz := ⋯, reduced := ⋯ }, ⋯⟩ },</span>\n<span class=\"c1\">--     x.proof_1⟩</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">proofs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"c1\">-- (deterministic) timeout at `whnf`, maximum number of heartbeats (200000) has been reached</span>\n<span class=\"c1\">-- Use `set_option maxHeartbeats &lt;num&gt;` to set the limit.</span>\n</code></pre></div>",
        "id": 476959834,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1728989271
    },
    {
        "content": "<p>It seems that a problem is with 0.5 as <code>#eval x</code> gives</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Real</span><span class=\"bp\">.</span><span class=\"n\">ofCauchy</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"c\">/-</span><span class=\"cm\"> (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, (1 : Rat)/2, ... -/</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 476961921,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1728990045
    },
    {
        "content": "<p>Lean is only unrolling the definition because <code>#reduce</code> tells Lean to do exactly that</p>",
        "id": 476962887,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728990397
    },
    {
        "content": "<p>And you can't <code>#eval Y x</code> because <code>Y</code> is a variable</p>",
        "id": 476962985,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728990443
    },
    {
        "content": "<p>All you're seeing is that it's unfolding the definition of <code>x</code>. Notice the output is <code>Y</code> followed by something that looks like the Cauchy sequence definition of 0.5.</p>\n<p>This reduction isn't aware of the <code>hY</code> variable. With <code>#reduce</code> think \"unfold definitions, apply <code>fun</code>s\"</p>",
        "id": 477007680,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729003876
    }
]