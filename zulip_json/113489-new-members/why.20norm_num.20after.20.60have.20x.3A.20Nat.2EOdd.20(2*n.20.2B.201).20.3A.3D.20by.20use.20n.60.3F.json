[
    {
        "content": "<p>What does the <code>norm_num</code> do in the following, and why is it needed?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>Here is a simpler example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>In my mind, the <code>use</code> should be sufficient to instantiate the \"there exists\" definition of <code>Odd</code>. </p>\n<p>In the second example, the result would be <code>2*6 + 1</code> and I can maybe see the <code>norm_num</code> is required to resolve this to <code>13</code>.</p>\n<p>But in the first example, <code>use n</code> instantiate the existence definition to <code>2*n+1</code> and it can't be resolved numerically any further. The comparison for equality is lexical in my inexpert opinion. So I can't see what <code>norm_num</code> does.</p>\n<p>(the goal state already has <code>n: ℕ</code>)</p>",
        "id": 486701888,
        "sender_full_name": "rzeta0",
        "timestamp": 1733603363
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"c1\">-- silly proof because this goal is not remotely appropriate for `norm_num`...</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"c1\">-- ...but `norm_num` tries simp...</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- ...and `simp` tries a weak `rfl`.</span>\n</code></pre></div>",
        "id": 486704077,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733605284
    },
    {
        "content": "<p>So I interpret your examples as illustrating that <code>norm_num</code>is actually being too clever in an invisible way by doing algebraic simplification.</p>\n<p>Is that right?</p>\n<p>(I seem to be getting caught by tactics being over-clever recently...)</p>",
        "id": 486716495,
        "sender_full_name": "rzeta0",
        "timestamp": 1733616080
    },
    {
        "content": "<p>If you ctrl-click on <code>norm_num</code> then you jump to its definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">normNum</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"s2\">\"norm_num\"</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"o\">:</span><span class=\"n\">optConfig</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"o\">:</span><span class=\"bp\">&amp;</span><span class=\"s2\">\" only\"</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"o\">:(</span><span class=\"n\">simpArgs</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">loc</span><span class=\"o\">:(</span><span class=\"n\">location</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">  </span><span class=\"n\">elabNormNum</span><span class=\"w\"> </span><span class=\"n\">cfg</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"n\">loc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">simpOnly</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"bp\">.</span><span class=\"n\">isSome</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">useSimp</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>and whilst this is meta gobble-de-gook to me, you can see that at the very end of the definition it says <code>useSimp := true</code> which is an indication that <code>norm_num</code> will be using <code>simp</code> at some point. The point is that in practice people want to prove theorems as quickly as possible and so tactics are written with this in mind (for example <code>rw</code> tries <code>rfl</code> etc). Just because a tactic closes the goal doesn't mean that it's the best tactic to close the goal. An extreme example would be <code>aesop</code>, an often-slow tactic capable of doing a huge amount of heavy lifting and which will close goals which many other tactics will solve, simply because it tries a ton of them!</p>",
        "id": 486716879,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733616384
    },
    {
        "content": "<p>In particular, I think Kevin is saying that <code>norm_num</code> works because in the end it's trying <code>rfl</code>, and <code>rfl</code> works. Just because a tactic works (like <code>norm_num</code>) doesn't mean that it's necessary for the job.</p>\n<p><code>norm_num</code> is not appropriate for tasks that involve variables. It's for normalizing numbers. If it happens to work in other cases, then usually another tactic would have been more appropriate.</p>",
        "id": 486717464,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733616956
    },
    {
        "content": "<p>Kyle - agreed, it isn't appropriate when there is a variable.</p>\n<p>What would be a better way to close:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>(note I haven't learned <code>rfl</code> in MoP yet, perhaps I should)</p>",
        "id": 486720432,
        "sender_full_name": "rzeta0",
        "timestamp": 1733619739
    },
    {
        "content": "<p><code>use n; rfl</code>?</p>",
        "id": 486720582,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733619886
    },
    {
        "content": "<p>I guess I better learn about <code>rfl</code>. </p>\n<p>I've just reached the end of Chapter 4 of MoP (including all the exercises) and we haven't come across <code>rfl</code> yet.</p>",
        "id": 486720844,
        "sender_full_name": "rzeta0",
        "timestamp": 1733620128
    },
    {
        "content": "<p>(It's a lot better to include an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> in your questions than a non-working snippet even with the goal state)</p>\n<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> <a href=\"#narrow/channel/113489-new-members/topic/why.20norm_num.20after.20.60have.20x.3A.20Nat.2EOdd.20.282*n.20.2B.201.29.20.3A.3D.20by.20use.20n.60.3F/near/486701888\">said</a>:</p>\n<blockquote>\n<p>The comparison for equality is lexical in my inexpert opinion.</p>\n</blockquote>\n<p>This is a pretty decent first approximation for what <code>rfl</code> means, so you already kind of know it, just now you know it's name!</p>",
        "id": 486723263,
        "sender_full_name": "Julian Berman",
        "timestamp": 1733622486
    },
    {
        "content": "<p>I don't know what <code>Nat.Odd</code> is, but I encourage using <code>norm_num</code> rather than <code>rfl</code> for evaluating numeric expressions</p>",
        "id": 486769054,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733663643
    }
]