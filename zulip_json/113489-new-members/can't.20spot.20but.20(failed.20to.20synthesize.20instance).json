[
    {
        "content": "<p>I'm doing the final exercise of MoP 6.3. This question isn't about the exercise lesson. </p>\n<p>There is a bug in a <code>calc</code> section which I can't identify:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"k\">calc</span>\n<span class=\"w\">        </span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; -- error</span>\n<span class=\"w\">        </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\">  </span><span class=\"mf\">0.6</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)):=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; -- error</span>\n<span class=\"w\">        </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\">  </span><span class=\"mf\">0.96</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">0.4</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"mf\">1.6</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">):=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">ring</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; -- error</span>\n<span class=\"w\">        </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)):</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mf\">0.96</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">):</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rel</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih2a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih1a</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)):</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">):</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">extra</span>\n<span class=\"w\">        </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)):</span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">F</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>The error is the same for the 3 highighted lines:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>failed to synthesize instance\n  HPow Float ℕ Float\n</code></pre></div>\n<p>I can't find any information online about what this could be. I'd welcome guidance.</p>\n<p>It isn't a short proof which is why I haven't replicated it all here. I also can't produce an MWE sadly.</p>",
        "id": 492607679,
        "sender_full_name": "rzeta0",
        "timestamp": 1736382887
    },
    {
        "content": "<p>That error says \"I don't know how to raise a float to a natural number power and get a resulting float out of that\".</p>",
        "id": 492609456,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736384049
    },
    {
        "content": "<p>Glancing at <a href=\"https://hrmacbeth.github.io/math2001/06_Induction.html#id21\">https://hrmacbeth.github.io/math2001/06_Induction.html#id21</a>, note that in the exercise, there's <code>(0.4 : \\Q)</code>, not just 0.4 -- so there we have a rational number rather than a float, and likely Lean will be happy. Add that explicit type and see if things work.</p>",
        "id": 492609671,
        "sender_full_name": "Julian Berman",
        "timestamp": 1736384175
    },
    {
        "content": "<p>Thanks Julian - I'll have a go.</p>",
        "id": 492610616,
        "sender_full_name": "rzeta0",
        "timestamp": 1736384843
    },
    {
        "content": "<p>Sadly, a limitation of <code>calc</code> is that you need to manually insert type hints. It's not able to get types out of the goal.</p>\n<p>(I got very far along the way toward adding this functionality once, only to come across a test file that showed exactly why this limitation is unavoidable.)</p>",
        "id": 492611047,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736385143
    },
    {
        "content": "<p>Do you happen to recall which test file it was? I'm curious</p>",
        "id": 492634295,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1736399677
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span> <a href=\"https://github.com/leanprover/lean4/blob/827c6676fd339b147258c05fda75b3cf6dc0fd31/src/Lean/Elab/Calc.lean#L151-L161\">https://github.com/leanprover/lean4/blob/827c6676fd339b147258c05fda75b3cf6dc0fd31/src/Lean/Elab/Calc.lean#L151-L161</a></p>",
        "id": 492635210,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1736400213
    }
]