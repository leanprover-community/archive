[
    {
        "content": "<p>When working with a summation in a proof, is there a way to explicitly choose a name for the variable indexing the sum?</p>\n<p>The context here is that some tactics, i.e. <code>simp_rw</code>, will helpfully rewrite terms inside sums and products, but as a side effect seems to change the name of the index variable. In the example below, the outer sum has <code>σ</code> vary over all permutations, but after using <code>simp_rw</code> the <code>σ</code> is replaced with <code>x</code>. The inner product index <code>i</code> is replaced with <code>x_1</code>. </p>\n<p>The choice of name of the dummy variable is in a sense non-essential, but having a way to enforce conventions like <code>σ</code> for permutations would help with readability in the infoview.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">det_mul'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">↪</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"n\">submatrix</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">det</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"n\">submatrix</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- expand determinant in matrix entries as sum over permutations, on LHS</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">det_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"c1\">-- uses σ for summing permutations</span>\n<span class=\"w\">  </span><span class=\"c1\">-- expand entries of matrix product A*B</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_apply</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- uses x for summing permutations :(</span>\n\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 518492888,
        "sender_full_name": "Harry Richman",
        "timestamp": 1747386646
    },
    {
        "content": "<p>This should work: <code>change ∑ f, Equiv.Perm.sign f • ∏ x_1, ∑ j, A (f x_1) j * B j x_1 = _ </code></p>",
        "id": 518494884,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1747387259
    },
    {
        "content": "<p>replace <code>f</code> with whatever you want</p>",
        "id": 518494975,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1747387286
    },
    {
        "content": "<p>I don't know if it's the best solution though</p>",
        "id": 518495183,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1747387357
    },
    {
        "content": "<p>This probably makes sense as a<code>conv</code> tactic</p>",
        "id": 518510326,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747391932
    },
    {
        "content": "<p>I had thought of using <code>conv</code>, but this was the best I could do:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">conv</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">rename</span><span class=\"w\"> </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">Perm</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">t</span>\n</code></pre></div>\n<p>which is uglier, even if <code>rename</code> was a <code>conv</code> tactic (which it probably should be, or <code>change</code> as you said. Assuming I understand what a <code>conv</code> tactic is ; ) I can still image it might be useful for bigger terms</p>",
        "id": 518525675,
        "sender_full_name": "Luigi Massacci",
        "timestamp": 1747396768
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"500002\">Harry Richman</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20dummy.20variable.20inside.20summation/near/518492888\">schrieb</a>:</p>\n<blockquote>\n<p>but as a side effect seems to change the name of the index variable</p>\n</blockquote>\n<p>For this reason <code>binderNameHint</code> exists. But mathlib doesn't seem to use it...</p>",
        "id": 518532681,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747398705
    },
    {
        "content": "<p>It looks like the use of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum_congr#doc\">docs#Finset.sum_congr</a> is to blame</p>",
        "id": 518533129,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747398838
    },
    {
        "content": "<p>Yeah right it should use <code>binderNameHint</code> there probably</p>",
        "id": 518533553,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747398951
    },
    {
        "content": "<p>although I'm not certain it even <em>works</em> for congruence theorems</p>",
        "id": 518533649,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747398964
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- replaces `Finset.sum_congr</span>\n<span class=\"kd\">@[</span><span class=\"n\">congr</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr_binder</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">s₁</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>is not legal</p>",
        "id": 518535070,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747399306
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"470149\">@Joachim Breitner</span></p>",
        "id": 518535392,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747399398
    },
    {
        "content": "<p>I’d have expected</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">congr</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr_binder</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">s₁</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>i.e. the <code>binderNameHint</code> should take the binder from <code>f</code>, not <code>g</code>.  If this doesn't work, a MWE might help.</p>\n<p>The hint should work in congruence assumptions since <a href=\"https://github.com/leanprover/lean4/pull/7053\">https://github.com/leanprover/lean4/pull/7053</a></p>",
        "id": 518537414,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747400024
    },
    {
        "content": "<p>Hmm no apparently <code>simp</code> can't use that?<br>\nIt just says: <code>[Meta.Tactic.simp.congr] Finset.sum_congr_binder not modified</code></p>",
        "id": 518539214,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747400527
    },
    {
        "content": "<p>What about</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">congr</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr_binder</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s₁</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"n\">s₁</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">sum_congr</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>(that's the form I used in the test case for the PR)</p>",
        "id": 518539531,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747400620
    },
    {
        "content": "<p>That works!</p>",
        "id": 518539678,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747400657
    },
    {
        "content": "<p>I guess this should probably be the form present in mathlib then</p>",
        "id": 518539843,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747400707
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24957\">#24957</a></p>",
        "id": 518540186,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747400796
    },
    {
        "content": "<p>Well the only complaint I have about <code>binderNameHint</code> is that it makes theorem statements a bit annoying to read</p>",
        "id": 518540494,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747400882
    },
    {
        "content": "<p>maybe it's fine to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">app_unexpander</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unexpandBinderNameHint</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">PrettyPrinter</span><span class=\"bp\">.</span><span class=\"n\">Unexpander</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"bp\">$_</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">pure</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">throw</span><span class=\"w\"> </span><span class=\"o\">()</span>\n</code></pre></div>\n<p>but that might hide too much..?</p>",
        "id": 518540644,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747400916
    },
    {
        "content": "<p>I fully agree. And that it’s a game of whack-a-mole to adjust all the tactics that should heed the hint. </p>\n<p>It’s a hack that I’m not proud of (but still prefer to not having that hack at all).</p>",
        "id": 518540841,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747400972
    },
    {
        "content": "<p>Hmm would it be fine to make it an <code>abbrev</code>? It seems like that could be part of why <a href=\"https://github.com/leanprover-community/mathlib4/pull/24957\">#24957</a> failed to build</p>",
        "id": 518541240,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747401084
    },
    {
        "content": "<p>Yes it would be great to fix this. Thanks for the work above! It's especially annoying when <code>simp_rw</code> or whatever replaces the variable being summed over with <code>i</code> when you already have an <code>i</code>, because then you randomly get an <code>i_1</code> which you almost never want.</p>",
        "id": 518541284,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747401098
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20dummy.20variable.20inside.20summation/near/518541240\">said</a>:</p>\n<blockquote>\n<p>Hmm would it be fine to make it an <code>abbrev</code>? It seems like that could be part of why <a href=\"https://github.com/leanprover-community/mathlib4/pull/24957\">#24957</a> failed to build</p>\n</blockquote>\n<p>Probably; do you want to try that and  make a PR for that to find out?</p>",
        "id": 518541483,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747401158
    },
    {
        "content": "<p>Should I then also add an unexpander? Although again it's probably not best to hide details...</p>",
        "id": 518541783,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747401266
    },
    {
        "content": "<p>I forget why we didn't make it an <code>Expr.mdata</code>; could you remind me?</p>",
        "id": 518541802,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401271
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873547\">Robin Arnez</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20dummy.20variable.20inside.20summation/near/518541783\">said</a>:</p>\n<blockquote>\n<p>Should I then also add an unexpander? Although again it's probably not best to hide details...</p>\n</blockquote>\n<p>I’d be hesitant, it may cause confusion</p>",
        "id": 518541859,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747401289
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20dummy.20variable.20inside.20summation/near/518541802\">said</a>:</p>\n<blockquote>\n<p>I forget why we didn't make it an <code>Expr.mdata</code>; could you remind me?</p>\n</blockquote>\n<p>Because the value of <code>.mdata</code> cannot refer to expressions, can it?</p>",
        "id": 518541989,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1747401332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Choosing.20dummy.20variable.20inside.20summation/near/518541802\">schrieb</a>:</p>\n<blockquote>\n<p>I forget why we didn't make it an <code>Expr.mdata</code>; could you remind me?</p>\n</blockquote>\n<p>I think the problem is that <code>mdata</code> can't refer to variables like <code>f</code> and <code>x</code></p>",
        "id": 518542009,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747401339
    },
    {
        "content": "<p>Are things any better if the syntax instead becomes:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 518542580,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401501
    },
    {
        "content": "<p>Or maybe even</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">binderNameHint</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 518543027,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401633
    },
    {
        "content": "<p>That last one is far more likely to be unfolded before it causes trouble, since <code>intro</code> is enough to do it</p>",
        "id": 518543102,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401653
    },
    {
        "content": "<p>We probably also want to allow <code>∃ x, p x</code> to have a binder name hint so the last one doesn't work too well I don't think (because the <code>x</code> is nested in the <code>Exists</code>)</p>",
        "id": 518543734,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747401827
    },
    {
        "content": "<p>I guess that becomes <code>Exists (binderNameHint p fun x =&gt; p x)</code></p>",
        "id": 518543922,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401875
    },
    {
        "content": "<p>You could envisage a custom delaborator along the lines of <code>∃ x%$p, p x</code> that expands to this, sort of matching <code>%$tk</code> in syntax antiquotations</p>",
        "id": 518544128,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747401940
    },
    {
        "content": "<p><code>∃ x, binderNameHint _ _ (p x)</code> doesn't need support like that though</p>",
        "id": 518544872,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1747402112
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"466290\">@Luigi Massacci</span> for the quick fix and everyone else for working on sorting out the underlying problem!</p>",
        "id": 518838270,
        "sender_full_name": "Harry Richman",
        "timestamp": 1747503411
    }
]