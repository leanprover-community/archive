[
    {
        "content": "<p>I was abusing <code>get!</code> and ended up with several panics. It would be good to have a fancy debugger, but just knowing (1) where the panic happened, (2) call stack, and (3) the local environment (values) at the time panic has happened would be sufficient for me. Is there a way to get these informations?</p>\n<p>For (1), <code>#eval ((none: Option Nat).get!)</code> currently prints the position of the \"definition\" of <code>get!</code> (i.e., <code>Init.Data.Option.BasicAux:16:14</code>), not the callsite. I have been using my own macro that behaves like <code>get!</code> but prints the callsite in case of none - but it feels like there should be better and more official way to do this.</p>",
        "id": 491668045,
        "sender_full_name": "Youngju Song",
        "timestamp": 1735853179
    },
    {
        "content": "<p>Run your program with <code>export LEAN_ABORT_ON_PANIC=1</code>, then you'll get the option to dump a stacktrace etc</p>",
        "id": 491669159,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1735853857
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> Thank you! Can you elaborate on how to dump a stacktrace?<br>\nI have set <code>LEAN_ABORT_ON_PANIC</code>, built again with <code>lake build</code>, and ran binary in <code>.lake/build/bin/</code>, but the output seems unchanged.</p>",
        "id": 491798367,
        "sender_full_name": "Youngju Song",
        "timestamp": 1735930854
    },
    {
        "content": "<p>It should just work</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">panic!</span><span class=\"w\"> </span><span class=\"s2\">\"ahhh\"</span>\n<span class=\"n\">florence</span><span class=\"o\">:</span><span class=\"bp\">~|</span>\n<span class=\"bp\">λ</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run foo.lean</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ahhh</span>\n<span class=\"n\">backtrace</span><span class=\"o\">:</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(lean_panic_fn+0x6d) [0x7ff0db9c9e6d]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbbd84) [0x7ff0db9bbd84]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4db9fe0) [0x7ff0db9b9fe0]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbc0c2) [0x7ff0db9bc0c2]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4db9fe0) [0x7ff0db9b9fe0]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbdc03) [0x7ff0db9bdc03]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbd887) [0x7ff0db9bd887]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbd42f) [0x7ff0db9bd42f]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(lean_apply_1+0x175) [0x7ff0db9d4eb5]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4db740a) [0x7ff0db9b740a]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4dbe0a9) [0x7ff0db9be0a9]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(+0x4db6b91) [0x7ff0db9b6b91]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(_ZN4lean2ir8run_mainERKNS_11environmentERKNS_7optionsEiPPc+0x87) [0x7ff0db9b5fc7]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/../lib/lean/libleanshared.so(lean_main+0x274b) [0x7ff0d7a40d1b]</span>\n<span class=\"bp\">/</span><span class=\"n\">lib64</span><span class=\"bp\">/</span><span class=\"n\">libc</span><span class=\"bp\">.</span><span class=\"n\">so</span><span class=\"bp\">.</span><span class=\"m\">6</span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"mi\">0</span><span class=\"n\">x3248</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"n\">x7ff0d6906248</span><span class=\"o\">]</span>\n<span class=\"bp\">/</span><span class=\"n\">lib64</span><span class=\"bp\">/</span><span class=\"n\">libc</span><span class=\"bp\">.</span><span class=\"n\">so</span><span class=\"bp\">.</span><span class=\"m\">6</span><span class=\"o\">(</span><span class=\"bp\">__</span><span class=\"n\">libc_start_main</span><span class=\"bp\">+</span><span class=\"mi\">0</span><span class=\"n\">x8b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"n\">x7ff0d690630b</span><span class=\"o\">]</span>\n<span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---v4.12.0-rc1/bin/lean(_start+0x25) [0x55da84e64785]</span>\n<span class=\"n\">zsh</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IOT</span><span class=\"w\"> </span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">core</span><span class=\"w\"> </span><span class=\"n\">dumped</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run foo.lean</span>\n</code></pre></div>",
        "id": 491798691,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1735931027
    },
    {
        "content": "<p>On Linux, that is. I don't think there's an issue for cross-platform support yet.</p>",
        "id": 491800098,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1735931720
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span> Mine shows this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Unit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">panic!</span><span class=\"w\"> </span><span class=\"s2\">\"ahhh\"</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"kn\">export</span><span class=\"w\"> </span><span class=\"n\">LEAN_ABORT_ON_PANIC</span><span class=\"bp\">=</span><span class=\"mi\">1</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">LEAN_ABORT_ON_PANIC</span>\n<span class=\"mi\">1</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run foo.lean</span>\n<span class=\"n\">PANIC</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ahhh</span>\n<span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\">    </span><span class=\"mi\">40956</span><span class=\"w\"> </span><span class=\"n\">abort</span><span class=\"w\">      </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--run foo.lean</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--version</span>\n<span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">4.16</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2024</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">04</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">arm64</span><span class=\"bp\">-</span><span class=\"n\">apple</span><span class=\"bp\">-</span><span class=\"n\">darwin23</span><span class=\"bp\">.</span><span class=\"m\">6</span><span class=\"bp\">.</span><span class=\"m\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">commit</span><span class=\"w\"> </span><span class=\"n\">c5181569f959</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Release</span><span class=\"o\">)</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"mi\">0</span>\n<span class=\"bp\">-</span><span class=\"n\">zsh</span>\n<span class=\"bp\">~$</span><span class=\"w\"> </span><span class=\"n\">sw_vers</span>\n<span class=\"n\">ProductName</span><span class=\"o\">:</span><span class=\"w\">        </span><span class=\"n\">macOS</span>\n<span class=\"n\">ProductVersion</span><span class=\"o\">:</span><span class=\"w\">     </span><span class=\"mf\">14.7</span><span class=\"bp\">.</span><span class=\"m\">1</span>\n<span class=\"n\">BuildVersion</span><span class=\"o\">:</span><span class=\"w\">       </span><span class=\"mi\">23</span><span class=\"n\">H222</span>\n</code></pre></div>",
        "id": 491800390,
        "sender_full_name": "Youngju Song",
        "timestamp": 1735931872
    },
    {
        "content": "<p>Tried the latest version (<code>Lean (version 4.16.0-nightly-2025-01-03, arm64-apple-darwin23.6.0, commit 19078655bcfd, Release)</code>) but the same result.<br>\n<span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> (just to be clear) do you mean that Lean does not support this feature for operating systems other than Linux?</p>",
        "id": 491801994,
        "sender_full_name": "Youngju Song",
        "timestamp": 1735932644
    },
    {
        "content": "<p>It does not currently</p>",
        "id": 491802103,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1735932695
    }
]