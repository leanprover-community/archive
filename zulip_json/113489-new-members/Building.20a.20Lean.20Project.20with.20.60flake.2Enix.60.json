[
    {
        "content": "<p>First, I will confess that I do not really understand the nix toolchain very well.</p>\n<p>I was wondering if it is possible to produce a <code>flake.nix</code> which can do the following.</p>\n<ol>\n<li>I should be able to pin the version of the Lean to a specific version I want.</li>\n<li>When I run <code>nix develop</code>, it should spawn a shell which has the appropriate lean tools available along with the plugin for VSCode.</li>\n<li>When I run <code>nix build</code>, it should run something which is equivalent to <code>lake build</code>-- checking the proofs, in effect.</li>\n</ol>\n<p>I have seen some <code>flake.nix</code> based Lean projects, but they seem to be doing something different. For example, <a href=\"https://github.com/ezhuchko/RLTL-derivatives/blob/main/flake.nix\">this</a> one does not seem to be running <code>lake build</code></p>",
        "id": 493514173,
        "sender_full_name": "Agnishom Chattopadhyay",
        "timestamp": 1736833167
    },
    {
        "content": "<p>Does anyone have any thoughts on this?</p>\n<p>I also have the analogous question for <a href=\"https://proofassistants.stackexchange.com/questions/4659/how-do-i-set-up-a-flake-nix-for-the-development-and-building-of-my-coq-project\">Coq</a></p>",
        "id": 496486034,
        "sender_full_name": "Agnishom Chattopadhyay",
        "timestamp": 1738136168
    },
    {
        "content": "<p>Step 3 would have to always start from scratch instead of reusing previous results, do you really want that?</p>",
        "id": 496492352,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1738138885
    },
    {
        "content": "<p>Using the tooling of Lean in the context of <code>nix build</code> is tricky, because (as far as I understand) there isn't still good support for installing the packages in locations other than <code>.lake/</code>. I also would love to hear if someone finds a solution for having the packages in the Nix store.</p>\n<p>I'm using a <code>flake.nix</code> that allows me to spawn a <code>nix develop</code> environment with all the tooling ready, but I don't do <code>nix build</code>. My example is at <a href=\"https://github.com/provables/special-numbers\">https://github.com/provables/special-numbers</a>.</p>",
        "id": 496627186,
        "sender_full_name": "Walter Moreira",
        "timestamp": 1738178502
    },
    {
        "content": "<p>Thanks for sharing the example!</p>",
        "id": 496710356,
        "sender_full_name": "Agnishom Chattopadhyay",
        "timestamp": 1738222810
    },
    {
        "content": "<p>I am not sure I understand why Step 3 should require starting from scratch. However, it is not important that it runs <code>lake build</code> exactly. I just want the <code>nix build</code> command to check the proofs (i.e, run the typechecker and do the compilation)</p>",
        "id": 496710508,
        "sender_full_name": "Agnishom Chattopadhyay",
        "timestamp": 1738222895
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269975\">Walter Moreira</span> <a href=\"#narrow/channel/113489-new-members/topic/Building.20a.20Lean.20Project.20with.20.60flake.2Enix.60/near/496627186\">said</a>:</p>\n<blockquote>\n<p>Using the tooling of Lean in the context of <code>nix build</code> is tricky, because (as far as I understand) there isn't still good support for installing the packages in locations other than <code>.lake/</code>. I also would love to hear if someone finds a solution for having the packages in the Nix store.</p>\n<p>I'm using a <code>flake.nix</code> that allows me to spawn a <code>nix develop</code> environment with all the tooling ready, but I don't do <code>nix build</code>. My example is at <a href=\"https://github.com/provables/special-numbers\">https://github.com/provables/special-numbers</a>.</p>\n</blockquote>\n<p>sorry for necrobumping. this is what <a href=\"https://github.com/lenianiva/lean4-nix\">lean4-nix</a> is for.</p>",
        "id": 534536747,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755195442
    }
]