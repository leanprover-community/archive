[
    {
        "content": "<p><strong>Cross-package <code>#eval</code>/<code>#guard</code> failures: \"IR of declaration not available\"</strong></p>\n<p>I'm extracting a set of type definitions from package A (Designer) into a new package B (Schema). Package A depends on package B via a local path dependency. The definitions keep the same Lean namespaces — only the Lake package changed.</p>\n<p>After the move, all proofs and non-<code>#eval</code> code works fine. But any <code>#eval</code> or <code>#guard</code> in package A that transitively calls a function now defined in package B fails with:</p>\n<p>plaintext<br>\n<code>(interpreter) IR of declaration 'Designer.Language.Signature.empty' not available;this may point to a missing `meta` check in a metaprogram</code></p>\n<p>or:</p>\n<p>plaintext<br>\n<code>Could not find native implementation of external declaration 'Designer.Language.UUID.freshUUID'(symbols 'lp_Schema_Designer_Language_UUID_freshUUID___boxed' or'lp_Schema_Designer_Language_UUID_freshUUID')</code></p>\n<p>The natural fix would be <code>precompileModules = true</code> on package B's <code>lean_lib</code>, but package B depends on Mathlib, and <code>precompileModules</code> cascades to dependencies. Linking all of Mathlib into a shared library fails (command line too long / clang error on macOS).<br>\n<strong>Question</strong>: Is there a way to make a library's IR available for cross-package interpretation without <code>precompileModules</code>, or a way to scope <code>precompileModules</code> to only the library's own modules (not its dependencies)?<br>\n<strong>Environment</strong>: Lean 4.27.0, macOS, Lake with <code>moduleSystem = true</code></p>",
        "id": 573976555,
        "sender_full_name": "Kevin Sullivan",
        "timestamp": 1771162036
    },
    {
        "content": "<p>You should be using <code>meta import</code> in the files using <code>#eval</code></p>",
        "id": 573986565,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1771171290
    },
    {
        "content": "<p>I did manage to get this resolved. R's suggestion to have interpretation as well as precompilation enabled. That works. But now I'll go look at this approach, too. Thank you.</p>",
        "id": 574034080,
        "sender_full_name": "Kevin Sullivan",
        "timestamp": 1771216375
    }
]