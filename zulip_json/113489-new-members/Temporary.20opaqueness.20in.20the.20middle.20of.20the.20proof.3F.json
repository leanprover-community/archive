[
    {
        "content": "<p>In the middle of the proof, I would like to temporarily make some definition as opaque/irreducible. Would it be possible?<br>\nContext: I am applying tactics like <code>simp_all</code> but it is unfolding a bit more than I wanted. Thus, I want to mark some definitions as opaque, apply <code>simp_all</code>, and rollback those definitions to be transparent again.</p>",
        "id": 492210924,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736207766
    },
    {
        "content": "<p>A <code>seal foo in _</code> term elaborator would indeed be a nice feature, though I don't know enough to be sure it actually makes sense</p>",
        "id": 492211826,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736208130
    },
    {
        "content": "<p>Could you <code>simp_all [-bad_theorem]</code>?</p>",
        "id": 492245194,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1736226981
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"690858\">@Daniel Weber</span> Thank you for the suggestion! Unfortunately, it didn't make a change, but I was able to find another proof.</p>",
        "id": 492372389,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736277889
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> That would be quite nice and compositional. In Coq, I used to do a lot of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Local</span><span class=\"w\"> </span><span class=\"n\">Opaque</span><span class=\"w\"> </span><span class=\"n\">mydef</span><span class=\"bp\">.</span>\n<span class=\"n\">some_reduction_tactic</span><span class=\"bp\">.</span>\n<span class=\"n\">Local</span><span class=\"w\"> </span><span class=\"n\">Transparent</span><span class=\"w\"> </span><span class=\"n\">mydef</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>but your syntax looks much nicer!</p>",
        "id": 492372583,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736277974
    },
    {
        "content": "<p>Perhaps I should mention that <code>seal foo in</code> already exists at the <code>command</code> level, just not the <code>term</code> or <code>tactic</code> level</p>",
        "id": 492373452,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736278323
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> , Thanks, that could be useful. I tried to use it in the middle of the proof in tactic mode (like <code>seal foo; some_tactic; unseal foo</code>) but (as you said) it doesn't seem to work at the moment.<br>\nIt seems like the top-level commands are in general not working in tactic mode, but it would be very useful to allow some at least commands to be executable in the tactic mode. Few such commands in Coq that I miss are: <code>Set Printing Notations</code> (<code>set_option pp.notation true</code> in Lean), <code>Set Printing All</code> (<code>set_option pp.explicit true</code> in Lean), <code>Search</code> and <code>SearchAbout</code> (not sure what they are in Lean), and <code>Print Instances</code> (not sure what they are in Lean).</p>",
        "id": 492559698,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736359905
    },
    {
        "content": "<p><code>set_option _ in _</code> works fine in tactic mode</p>",
        "id": 492561438,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736360610
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> That is interesting. In my environment, the following code shows <code>@LE.le Nat instLENat ...</code> instead of <code>≤</code> during the proof as expected</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"c1\">-- having \"in\" at the end also works</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">skip</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>but the following does not - it always shows <code>≤</code> and never shows <code>@LE.le ...</code> no matter where I place my cursor:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"kn\">notation</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">explicit</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"c1\">-- without \"in\" it is a syntax error</span>\n<span class=\"w\">  </span><span class=\"n\">skip</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Is this the same for you?</p>",
        "id": 492568541,
        "sender_full_name": "Youngju Song",
        "timestamp": 1736363584
    },
    {
        "content": "<p>I think this is because the cursor doesn't look at options in this resolution - you can see the effect if you use the <code>trace_state</code> tactic, for example</p>",
        "id": 492568786,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1736363694
    },
    {
        "content": "<p>Arguably this is a bug; I'd encourage you to report it</p>",
        "id": 492578950,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736367839
    },
    {
        "content": "<p>(it's probably very low priority, but it's worth having something to refer to)</p>",
        "id": 492579024,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1736367860
    }
]