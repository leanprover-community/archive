[
    {
        "content": "<p>Hi, so I'm pretty new to Lean and I've made my way through most of the introductory material (i.e., Theorem Proving in Lean and Mathematics in Lean). I'm trying to encode the relational model (<a href=\"https://en.wikipedia.org/wiki/Relational_model\">https://en.wikipedia.org/wiki/Relational_model</a>) into Lean, and I'm running into some issues:</p>\n<p>So let's say I have a database schema (you can think of this like a structured excel table where columns are given names):</p>\n<ul>\n<li><code>Movie [ title, director, actor, rating ]</code></li>\n<li><code>Location [ theater, address, phone ]</code><br>\nA possible entry into the <code>Movie</code> relation could be:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">title</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">director</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">actor</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rating</span><span class=\"w\"> </span><span class=\"bp\">|</span>\n<span class=\"bp\">|</span><span class=\"c1\">-------|----------|-------|--------|</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"s2\">\"Foo\"</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"s2\">\"Bar\"</span><span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"s2\">\"Baz\"</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\">      </span><span class=\"bp\">|</span>\n</code></pre></div>\n<p>Formally, the way this is usually defined (c.f., <a href=\"http://Foundations%20of%20Databases\">http://webdam.inria.fr/Alice/pdfs/all.pdf</a>, page 34) is by defining some infinite sets <code>Rel</code>, <code>Att</code> and <code>Dom</code> which are disjoint from one another. The first set defines names of relations, the second attributes, and the third \"constants\" (i.e., types of values are 'erased'). A relation in <code>Rel</code> is associated with a (partial) function <code>sort : Rel -&gt; finite_powerset(Att)</code>, which maps  a relation to a finite set of attributes. Typically <code>sort(R)</code> for some relation name <code>R</code> is referred to as the relation schema. A record (or tuple) over some relation schema U is a total function from U to Dom. </p>\n<p>I modeled this into Lean as follows:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">movie</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">location</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">title</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">director</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">actor</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">rating</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">theater</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">address</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">phone</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">title</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">director</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">actor</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">rating</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">theater</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">address</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">phone</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">String</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">movie</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">title</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">director</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">actor</span><span class=\"w\">  </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">rating</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">location</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">theater</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">address</span><span class=\"w\"> </span><span class=\"bp\">∨</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Att</span><span class=\"bp\">.</span><span class=\"n\">phone</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">MovieRecord</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">att</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">movie</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">att</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">LocationRecord</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">att</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">Rel</span><span class=\"bp\">.</span><span class=\"n\">location</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">att</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n</code></pre></div>\n<p>The main difference here is that I still care about types, i.e., I do not throw all values into a single type/set called \"Dom\". </p>\n<p>The issue I have here is that the subtypes as the output of the function <code>sort</code> are kind of a pain to work with; and I do not really see how I can create concrete \"records\" that are of the type <code>MovieRecord</code> or <code>LocationRecord</code>. Ideally, I want some sort of \"partial function\" that takes in a subset of the attributes in <code>Att</code> and assigns them to concrete values of type <code>type att</code> for that specific <code>att</code>. </p>\n<p>I can see like, one way in which I could model this but it is super annoying to write proofs with: I can model records as <code>(att : Att) -&gt; Option (type att)</code> or <code>(att : Att) -&gt; Part (type att)</code> but then I do not have the ability to \"statically\" check whether a tuple has all the right attributes defined. Also the \"easy\" way would be to model a schema by a single inductive type and have each \"relation schema\" be a single variant in the type, but then I do not have the ability to actually express properties over just attributes or the type of a specific attribute, and I do need the ability to express proofs using that as a notion. </p>\n<p>How do you usually deal with these types of issues in Lean? Is there like a \"type theory\"-ish way to deal with finite-ness? I have seen some things like <code>Fin</code> or the typeclass <code>Finite</code> in Mathlib but this has not really clicked for me.</p>",
        "id": 477745674,
        "sender_full_name": "Tim Baccaert",
        "timestamp": 1729292513
    }
]