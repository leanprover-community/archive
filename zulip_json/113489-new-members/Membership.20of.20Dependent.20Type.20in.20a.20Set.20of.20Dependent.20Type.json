[
    {
        "content": "<p>I have a type for functions from \"first <code>n</code> Natural Numbers\", parameterized by the size of the domain, i.e., <code>n</code>. Further, I have another type for sets of such functions where the size parameter may not be homogenous. I do this by defining it in the following way:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Func</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FuncSet</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">Σ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Func</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>To make it easy to work with these objects, I want to define Membership of <code>Func n</code> in <code>FuncSet</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Func</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">FuncSet</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n<p>But I get the following errors:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>invalid constructor ⟨...⟩, expected type must be an inductive type\n  ?m.47\n\nfailed to synthesize\n  Membership ?m.47 (Func n)\n\ninstance does not provide concrete values for (semi-)out-params\n  Membership (Func ?n) FuncSet\n</code></pre></div>\n<p>I thought that an alternative would be to define coercion from <code>Func n</code> to <code>Σ n, Func n</code>, but that gave the \"instance does not provide concrete values for (semi-)out-params\" error. Any guidance on whether this is a bad way of doing things, or on a way to fix this error, would be super helpful! Thanks!</p>\n<p><a href=\"https://live.lean-lang.org/#codez=JYWwDg9gTgLgBAWQIYwBYBtgCMBQOAmApgGZwBiArgHYDGcAFFQFxyCohAJRwsAqAnmIS4BecsCpxxgJMI2BEuWo0AyoXg9+gpiOXx6gYuAJAGnm0J7PGIDOMJLUEBvZmwC+XRIRBZCUC6mBgGlCZUnIFKKsJwgBfkxNRwpIpwQgB8UVRGxICX5HCAEERwihk4QA\">Link to live code</a>.</p>",
        "id": 506651670,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742368982
    },
    {
        "content": "<p>It sounds like lean can't figure out the types in your code. Try adding some type annotations</p>",
        "id": 506670899,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1742374959
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> I tried adding type annotations, and even tried <code>instance {n: ℕ} : Membership (Fin n → ℕ) (Set (Σ n, Func n)) := ...</code> but neither worked.</p>",
        "id": 506674218,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742375960
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Membership#doc\">docs#Membership</a></p>",
        "id": 506675914,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742376482
    },
    {
        "content": "<p>The first input for <code>Membership</code> is an <code>Outparam</code> and there's already <code>Membership X (Set X)</code> so this setup will be intrinsically problematic I think.</p>",
        "id": 506676079,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742376535
    },
    {
        "content": "<p>You're the second person to try this this week.</p>\n<p>Oh  you've made <code>FuncSet</code> a <code>def</code> so this should get around the <code>Set X</code> issue, but there's still the issue that you have infinitely many n :-/</p>",
        "id": 506676208,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742376579
    },
    {
        "content": "<p>Is this not the recommended way to create such sets?</p>",
        "id": 506676619,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742376701
    },
    {
        "content": "<p>This is your problem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">warning: declaration uses 'sorry'</span>\n<span class=\"sd\">---</span>\n<span class=\"sd\">error: instance does not provide concrete values for (semi-)out-params</span>\n<span class=\"sd\">  Membership (Func ?n) FuncSet</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Membership</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Func</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">FuncSet</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I think that error says \"I want <em>exactly one choice</em> of X for <code>Membership X FuncSet</code> so what the heck is that variable doing there?\" You also seem to have made a syntax error but this is the pertinent issue.</p>",
        "id": 506677065,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742376828
    },
    {
        "content": "<p>I see... I understand somewhat. Does that mean I have to do something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Func</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n<span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FuncSet</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Func</span>\n</code></pre></div>\n<p>which makes things a bit clunky</p>",
        "id": 506677836,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742377053
    },
    {
        "content": "<p>It means \"you can't ever have <code>instance {n: ℕ} : Membership (Func n) FuncSet</code> whatever your definitions, so give up on the idea of using <code>Membership</code> to express what you want if you want n unbundled\"</p>",
        "id": 506678281,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742377170
    },
    {
        "content": "<p>Thanks for the response. I previously had to use an existential quantifier over n to say something like \"f is <code>Func n</code> for some <code>n</code>\" and thought maybe I could simplify things.</p>",
        "id": 506679064,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742377382
    },
    {
        "content": "<p>But also I really wanted to have another function, say <code>foobar</code> which returned a set of <code>Func</code>s.</p>",
        "id": 506679393,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742377461
    },
    {
        "content": "<p>You could always experiment with just using your own notation -- perhaps you'll find out why <code>Membership</code> uses an outparam, or perhaps you'll find out that it shouldn't be using an outparam</p>",
        "id": 506815966,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742413890
    },
    {
        "content": "<p>Thanks so much for your time! Your advice and help on this Zulip server is amazing!</p>",
        "id": 506834183,
        "sender_full_name": "Mrigank Pawagi",
        "timestamp": 1742420887
    }
]