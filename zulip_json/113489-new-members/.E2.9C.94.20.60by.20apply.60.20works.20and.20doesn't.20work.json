[
    {
        "content": "<p>The following is my work-in-progress solution to an MoP exercise.</p>\n<p>The final <code>by apply</code> works, but the previous one doesn't.</p>\n<p>I'd welcome guidance on why.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Function</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Surjective</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hg</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Surjective</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Surjective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"bp\">∘</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Surjective</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">*</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">hff</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n<span class=\"w\">  </span><span class=\"n\">choose</span><span class=\"w\"> </span><span class=\"n\">gg</span><span class=\"w\"> </span><span class=\"n\">hgg</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hg</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gg</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">--</span>\n<span class=\"w\">  </span><span class=\"k\">calc</span>\n<span class=\"w\">    </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">gg</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"w\"> </span><span class=\"n\">gg</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hff</span><span class=\"w\"> </span><span class=\"c1\">-- &lt; --- error</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">hgg</span><span class=\"w\">   </span><span class=\"c1\">--- &lt; --- works ok</span>\n</code></pre></div>\n<p>For convenience here is the state at that point in the proof:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>X : Sort ?u.11825\nY : Sort ?u.11826\nZ : Sort ?u.11839\nf : X → Y\ng : Y → Z\nff : Y → X\nhff : ∀ (b : Y), f (ff b) = b\ngg : Z → Y\nhgg : ∀ (b : Z), g (gg b) = b\nz : Z\n⊢ g (f (ff (gg z))) = z\n</code></pre></div>",
        "id": 501006459,
        "sender_full_name": "rzeta0",
        "timestamp": 1740103652
    },
    {
        "content": "<p>apply operates with these equalities on the outermost layer. hff is about expressions of the form <code>f _</code> while the first calc line looks like <code>g _</code>. But you could have a tactic proof of <code>rw [hff]</code>.</p>",
        "id": 501010711,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740106482
    },
    {
        "content": "<p>apply doesn't mean \"utilize this rule\", <code>apply hff</code> is basically shorthand for <code>refine hff ?_</code> with as many underscores as necessary</p>",
        "id": 501010844,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1740106584
    },
    {
        "content": "<p>thanks - this is helpful,</p>",
        "id": 501013580,
        "sender_full_name": "rzeta0",
        "timestamp": 1740108384
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"724904\">rzeta0</span> has marked this topic as resolved.</p>",
        "id": 501013585,
        "sender_full_name": "Notification Bot",
        "timestamp": 1740108387
    },
    {
        "content": "<p>A minor suggestion:  While there's nothing wrong with what you've done, it seems to me you've made things unnecessarily complicated by doing <code>choose</code> before <code>intro z</code>.  Consider, for example, your second <code>choose</code> step, which gave you a function <code>gg : Z → Y</code> with the property <code>hgg</code>, which says that for <em>every</em> <code>b : Z</code>, <code>g (gg b) = b</code>.  You didn't really need this for <em>every</em> <code>b : Z</code>, you just needed it for the one <code>z : Z</code> that is introduced in your <code>intro z</code> line.  But you hadn't introduced that <code>z</code> yet, so you had to introduce a function that handled all <code>b : Z</code>.<br>\nI would do <code>intro z</code> right after the <code>dsimp</code> step.  Then <code>hg z</code> would be a proof of <code>∃ a, g a = z</code>, and you could use that to introduce the one object of type <code>Y</code> that you really need.  For example, you could use <code>obtain ⟨y, hy⟩ := hg z</code> to introduce <code>y : Y</code> and <code>hy : g y = z</code>.<br>\nBut maybe you just wanted to try out <code>choose</code>.</p>",
        "id": 501132713,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1740152479
    },
    {
        "content": "<p>Thanks I will explore your ideas. </p>\n<p>The exercise is about \"choose\" hence my over-enthusiasm for it but your reply makes a lot of sense.</p>",
        "id": 501149460,
        "sender_full_name": "rzeta0",
        "timestamp": 1740157731
    },
    {
        "content": "<p>I took a look at MoP.  It uses <code>choose</code> in Example 8.3.7, but notice that in that case the goal was to come up with a <em>function</em>, so <code>choose</code> was needed.  In this exercise, you don't need the whole function, you just need one value.  So I don't think the intended solution was to use <code>choose</code>.  However, you will need <code>choose</code> for Exercise 5.</p>",
        "id": 501191774,
        "sender_full_name": "Dan Velleman",
        "timestamp": 1740174185
    },
    {
        "content": "<p>Thanks for clarifying. I've now progressed to 8.4 which looks interesting too.</p>\n<p>(I've done every exercise in MoP so far except the last two in 8.2  which I'll go back to )</p>",
        "id": 501199993,
        "sender_full_name": "rzeta0",
        "timestamp": 1740178569
    }
]