[
    {
        "content": "<p>Why after exacuting this tactic, there are no goals while the logInfo shows there are goals in fact?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n\n\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"my_tool\"</span><span class=\"w\">  </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainGoal</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"bp\">.</span><span class=\"n\">getType</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">MetavarKind</span><span class=\"bp\">.</span><span class=\"n\">syntheticOpaque</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getGoals</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">goal3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MVarId</span><span class=\"bp\">.</span><span class=\"n\">intro1P</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">goal3</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">getGoals</span>\n<span class=\"w\">  </span><span class=\"n\">goals1</span><span class=\"bp\">.</span><span class=\"n\">forM</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"w\"> </span><span class=\"s2\">\"{goal}\"</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">tmp_2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">:</span><span class=\"n\">Bool</span><span class=\"o\">}(</span><span class=\"n\">h1</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"bp\">=</span><span class=\"n\">true</span><span class=\"o\">)(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"n\">q</span><span class=\"bp\">=</span><span class=\"n\">true</span><span class=\"o\">):</span><span class=\"n\">p</span><span class=\"bp\">∧</span><span class=\"n\">q</span><span class=\"o\">:=</span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">my_tool</span><span class=\"w\"> </span><span class=\"n\">constructor</span>\n</code></pre></div>\n<p><a href=\"/user_uploads/3121/uwatOgpVBzeoiVaf0EeWBDpv/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/uwatOgpVBzeoiVaf0EeWBDpv/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"939x1139\" src=\"/user_uploads/thumbnail/3121/uwatOgpVBzeoiVaf0EeWBDpv/image.png/840x560.webp\"></a></div>",
        "id": 512953803,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744942354
    },
    {
        "content": "<p><code>getGoals</code> gets the goal list, but it might contain solved goals. <code>getUnsolvedGoals</code> gets the subset of those that are unsolved.</p>",
        "id": 512956518,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744943615
    },
    {
        "content": "<p>Notice that when you <code>return goal3</code> you are throwing the data away with <code>let _</code>. It's up to you to collect the goals and update the goal list.</p>",
        "id": 512956622,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744943647
    },
    {
        "content": "<p>But these lines of code check that there are still goals—so why does the tactic state show that there are none?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">getGoals</span>\n<span class=\"w\">  </span><span class=\"n\">goals1</span><span class=\"bp\">.</span><span class=\"n\">forM</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"w\"> </span><span class=\"s2\">\"{goal}\"</span>\n</code></pre></div>",
        "id": 512957063,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744943831
    },
    {
        "content": "<p>I seemed understand, these goals are \"solved\"</p>",
        "id": 512957620,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744944000
    },
    {
        "content": "<p>Strange enough, why they were changed into solved?</p>",
        "id": 512957732,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744944036
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getGoals</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">newGoals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">goal3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MVarId</span><span class=\"bp\">.</span><span class=\"n\">intro1P</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">goal3</span>\n</code></pre></div>\n<p>I want to keep the <code>goals</code> unsolved while generating <code>newGoals</code>. Is that possible?</p>",
        "id": 512958752,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744944666
    },
    {
        "content": "<p>Here are some things you need to be familiar with here:</p>\n<ul>\n<li>that goals are the same thing as metavariables</li>\n<li>that a \"solved goal\" is an \"assigned metavariable\"</li>\n<li>that <code>MVarId.intro1P</code> is a \"meta tactic\" that assigns the metavariable given to it and produces a new metavariable</li>\n<li>that when you work with goals you have to make sure they are not already assigned (hence, don't loop over the result of <code>getGoals</code>, but instead over <code>getUnsolvedGoals</code>, since there is no guarantee that the raw goal list doesn't contain solved goals)</li>\n<li>that for \"meta tactics\" you have to maintain the unsolved goals yourself</li>\n<li>that in the <code>TacticM</code> monad, when you descend to the meta tactics you have to maintain the goal list yourself (e.g. <code>setGoals</code>)</li>\n<li>that all the metaprogramming monads have a good amount of state (I know you've asked a number of questions about \"how do I do this from <code>IO</code>\"; generally you shouldn't do that because IO doesn't have any of this state. For example, from <code>TacticM</code>, there's a metacontext, a local context, some information for elaboration, and a goal list.)</li>\n</ul>\n<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> <a href=\"#narrow/channel/113489-new-members/topic/a.20question.20about.20writing.20tactic/near/512958752\">said</a>:</p>\n<blockquote>\n<p>I want to keep the <code>goals</code> unsolved while generating <code>newGoals</code>. Is that possible?</p>\n</blockquote>\n<p>Since all the state is encapsulated in monads, and there is an interface to save and restore state (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.MonadBacktrack#doc\">docs#Lean.MonadBacktrack</a> with <code>saveState</code> and <code>restoreState</code>), yes, it's possible to temporarily solve goals and then restore things when you are done.</p>",
        "id": 512961911,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744946310
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> You taught me a lot!I solved it with <code>withoutModifyingState</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">IO</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n\n\n\n<span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"my_tool\"</span><span class=\"w\">  </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainGoal</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"bp\">.</span><span class=\"n\">getType</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">MetavarKind</span><span class=\"bp\">.</span><span class=\"n\">syntheticOpaque</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">withoutModifyingState</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getGoals</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">goal3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MVarId</span><span class=\"bp\">.</span><span class=\"n\">intro1P</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">goal3</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">getGoals</span>\n<span class=\"w\">    </span><span class=\"n\">goals1</span><span class=\"bp\">.</span><span class=\"n\">forM</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"w\"> </span><span class=\"s2\">\"{goal}\"</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">tmp_2</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">:</span><span class=\"n\">Bool</span><span class=\"o\">}(</span><span class=\"n\">h1</span><span class=\"o\">:</span><span class=\"n\">p</span><span class=\"bp\">=</span><span class=\"n\">true</span><span class=\"o\">)(</span><span class=\"n\">h2</span><span class=\"o\">:</span><span class=\"n\">q</span><span class=\"bp\">=</span><span class=\"n\">true</span><span class=\"o\">):</span><span class=\"n\">p</span><span class=\"bp\">∧</span><span class=\"n\">q</span><span class=\"o\">:=</span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">my_tool</span><span class=\"w\"> </span><span class=\"n\">constructor</span>\n</code></pre></div>",
        "id": 512962979,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744947067
    },
    {
        "content": "<p>That's still not solving it though, since your <code>goals.mapM</code> loop isn't collecting the new goals; you're discarding them. It's also still using <code>getGoals</code>.</p>\n<p>Closer:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"my_tool\"</span><span class=\"w\">  </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getMainGoal</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal1</span><span class=\"bp\">.</span><span class=\"n\">getType</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshExprMVar</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">MetavarKind</span><span class=\"bp\">.</span><span class=\"n\">syntheticOpaque</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">withoutModifyingState</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">getUnsolvedGoals</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">goals'</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goals</span><span class=\"bp\">.</span><span class=\"n\">mapM</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">withContext</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">goal3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">MVarId</span><span class=\"bp\">.</span><span class=\"n\">intro1P</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">goal2</span><span class=\"bp\">.</span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"ss\">`h_1</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">p</span>\n<span class=\"w\">        </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">goal3</span>\n<span class=\"w\">    </span><span class=\"n\">goals'</span><span class=\"bp\">.</span><span class=\"n\">forM</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">goal</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"w\"> </span><span class=\"s2\">\"{goal}\"</span>\n</code></pre></div>",
        "id": 512963199,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744947195
    },
    {
        "content": "<p>@Yes, I now understand the fact that there may be solved goals in all the goals,  so <code>getUnsolvedGoals</code> is a correct choice.</p>",
        "id": 512963408,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744947351
    },
    {
        "content": "<p>Yes, that's important, but the more important change is collecting the results.</p>",
        "id": 512963506,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1744947399
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 512963863,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744947654
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> There seems to be a strange phenomenon: in the <code>withoutModifyingState do</code> block, the logInfo and extract_goal's results can't show in the Lean Infoview. I found the cause,  I should return them outside the <code>withoutModifyingState do</code> block.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"my_tool\"</span><span class=\"w\">  </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">withoutModifyingState</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"n\">logInfo</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"w\"> </span><span class=\"s2\">\"hello\"</span>\n<span class=\"w\">    </span><span class=\"n\">evalTactic</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">extract_goal</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 512965195,
        "sender_full_name": "Zihao Zhang",
        "timestamp": 1744948624
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"753034\">Zihao Zhang</span> has marked this topic as resolved.</p>",
        "id": 512994583,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744965179
    }
]