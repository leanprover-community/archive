[
    {
        "content": "<p>I'm working with finite sequences as below and want to prove (trivial) things about their product. I have seen proofs by induction for finite sums, but these sums were defined in terms of ranges. I naively tried to apply the same results in my context, but did not have any luck (there really was no reason that it works, I just desperately tried).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">oneSeq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)):</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">induction'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod_range_succ</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>How would you deal with finite products of this form?</p>",
        "id": 544351106,
        "sender_full_name": "Thomas Preu",
        "timestamp": 1760217298
    },
    {
        "content": "<p>oh you can't prove this</p>",
        "id": 544351286,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760217447
    },
    {
        "content": "<p>there's no constraints on what <code>oneSeq</code> could be</p>",
        "id": 544351301,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760217463
    },
    {
        "content": "<p>the statement you've written says that every finite product of reals is one, which is false</p>",
        "id": 544351360,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760217505
    },
    {
        "content": "<p>the version for structure fields is on the common pitfalls page <a href=\"https://leanprover-community.github.io/extras/pitfalls.html#default-values-in-structure-fields\">here</a></p>",
        "id": 544351552,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760217672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"680252\">@Thomas Preu</span> you need to define <code>oneSeq</code> on its own before the <code>example</code></p>",
        "id": 544351631,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760217791
    },
    {
        "content": "<p>you can't define new things in the middle of stating a theorem</p>",
        "id": 544351638,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760217799
    },
    {
        "content": "<p>If I instead write </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}:</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">induction'</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod_range_succ</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>then I get type mismatch errors and an error about what looks to me something along the lines that the naturals are not finite (which is clearly correct).<br>\nWhat other ways are there to set up such a statement, conditioned on not using range but <code>Fin n</code>?</p>",
        "id": 544352162,
        "sender_full_name": "Thomas Preu",
        "timestamp": 1760218383
    },
    {
        "content": "<p>that's not the error i get, you might be using an old version of mathlib</p>",
        "id": 544352216,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218439
    },
    {
        "content": "<p>anyway after doing the translation</p>",
        "id": 544352233,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218458
    },
    {
        "content": "<p>this is one of the common pitfalls</p>",
        "id": 544352241,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218464
    },
    {
        "content": "<p>when you do <code>variable (m : Nat)</code>, since you used round brackets, it's now an explicit argument, meaning that you have to input the value of <code>m</code> every time you call <code>oneSeq</code></p>",
        "id": 544352268,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218498
    },
    {
        "content": "<p>there's a way to see this from the error message</p>",
        "id": 544352308,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218535
    },
    {
        "content": "<p>the error message says:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Type mismatch\n  oneSeq i\nhas type\n  Fin i → ℝ\nbut is expected to have type\n  ℕ\n</code></pre></div>",
        "id": 544352314,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218546
    },
    {
        "content": "<p>see how you're expecting <code>i</code> to take the place of the <code>Fin m</code> argument, but somehow it still shows up, meaning that the <code>Fin m</code> argument has not been provided, meaning that the <code>i</code> is actually providing the argument before that, which is <code>m</code></p>",
        "id": 544352374,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218589
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"680252\">@Thomas Preu</span> let me be clearer, you expect <code>oneSeq</code> to only take one input, but it actually takes two inputs, because <code>m</code> is the first argument it needs</p>",
        "id": 544352487,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218726
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/finite.20product.20of.201s.20is.201.20-.20without.20range/near/544352241\">said</a>:</p>\n<blockquote>\n<p>the common pitfalls</p>\n</blockquote>\n<p>the pitfall here is to think that \"variable\" means a commonly assumed thing that always sit in the background, whereas what it actually does is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> is equivalent to: -/</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 544352545,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218803
    },
    {
        "content": "<p>it never sits in the background, variable is just a way so that you don't have to type the common assumptions every time you type a new theorem, but it's still part of every new theorem/definition you type afterwards</p>",
        "id": 544352575,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760218837
    },
    {
        "content": "<p>Thanks for explaining, makes more sense now.<br>\nSo if I try this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}:</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">induction'</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"o\">[</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">prod_range_succ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">oneSeq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>is it more reasonable?<br>\nAnd if so, what is the right way to argue about products defined using Fin instead of ranges?</p>",
        "id": 544352725,
        "sender_full_name": "Thomas Preu",
        "timestamp": 1760219053
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"680252\">Thomas Preu</span> <a href=\"#narrow/channel/113489-new-members/topic/finite.20product.20of.201s.20is.201.20-.20without.20range/near/544352725\">said</a>:</p>\n<blockquote>\n<p>Fin instead of ranges</p>\n</blockquote>\n<p>the reason <code>range</code> is commonly used is that dependent types are bad...</p>",
        "id": 544353017,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219463
    },
    {
        "content": "<p>using <code>range</code> allows you to focus on <strong>one</strong> function <code>Nat -&gt; A</code></p>",
        "id": 544353030,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219475
    },
    {
        "content": "<p>imagine what the induction lemma  would have to look like if you use Fin n</p>",
        "id": 544353039,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219488
    },
    {
        "content": "<p>you need to write a product over <code>Fin (m+1)</code> in terms of a product over <code>Fin m</code></p>",
        "id": 544353048,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219503
    },
    {
        "content": "<p>which means that the statement itself will already involve <strong>two</strong> functions, one with type <code>Fin (m+1) -&gt; A</code> and one with type <code>Fin m -&gt; A</code></p>",
        "id": 544353068,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219526
    },
    {
        "content": "<p>in any case, the lemma exists and is called <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Fin.html#Fin.prod_univ_succ\">Fin.prod_univ_succ</a></p>",
        "id": 544353098,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219561
    },
    {
        "content": "<p>and <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Fin.html#Fin.prod_univ_castSucc\">Fin.prod_univ_castSucc</a></p>",
        "id": 544353140,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219614
    },
    {
        "content": "<p>these two variants exist for the two different ways you can extract a function <code>Fin m -&gt; A</code> out of a function <code>Fin (m+1) -&gt; A</code></p>",
        "id": 544353167,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219642
    },
    {
        "content": "<p>i.e. you either remove the first element in the vector, or the last element in the vector</p>",
        "id": 544353179,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219655
    },
    {
        "content": "<p><code>![1,2,3,4,5]</code> becomes either <code>![1,2,3,4]</code> or <code>![2,3,4,5]</code></p>",
        "id": 544353191,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219670
    },
    {
        "content": "<p>you'll notice that the function you get will particularly <strong>not</strong> be <code>oneSeq m</code>.</p>",
        "id": 544353221,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219705
    },
    {
        "content": "<p>instead it will be some modification of <code>oneSeq (m+1)</code></p>",
        "id": 544353246,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219720
    },
    {
        "content": "<p>I hope this alone demonstrates to you the point of working with <code>range</code> instead of <code>Fin</code>.</p>",
        "id": 544353254,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760219729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/finite.20product.20of.201s.20is.201.20-.20without.20range/near/544353221\">said</a>:</p>\n<blockquote>\n<p>you'll notice that the function you get will particularly <strong>not</strong> be <code>oneSeq m</code>.</p>\n</blockquote>\n<p>It's a constant function so it will be defeq</p>",
        "id": 544354113,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760220752
    }
]