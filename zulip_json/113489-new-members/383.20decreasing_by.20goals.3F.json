[
    {
        "content": "<p>I have a fairly complicated recursive function. It calls itself 11 times. However I have designed my function such that there is always a clear decreasing measure. </p>\n<p>However despite this Lean completely grinds to a halt while type checking this function. When it does finish it asks me to prove that some of the function's recursive calls do indeed have a decreasing measure. This is fine, but even when I do provide these proofs in hypotheses Lean doesn't register that these prove termination.</p>\n<p>E.g. the termination_by clause looks like this: <code>termination_by (deptha, depthb, sizeOf a, sizeOf b)</code></p>\n<p>and on one of the recursive calls the proof state looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"n\">hdepths</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hdepthseq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hsizeslt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">fstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n</code></pre></div>\n<p>I have made these hypotheses specifically to nudge Lean to understanding that the <code>deptha</code> param does not decrease here so it should go for the next one, <code>sizeof a</code>. But Lean doesn't seem to understand this.</p>\n<p>I believe that the idiomatic way to prove that this decreases would be in the <code>decreasing_by</code> block, but that leads me to the next problem: that for some reason there are 383(!!) goals there for me to prove. This makes zero sense to me. There are 11 recursive calls, and I provide all required parameters upfront on every call (i.e. I don't leave any <code>?_</code>s to fill in later by case matching on anything).</p>\n<p>Could someone give me some pointers on why there might be such a ludicrous number of goals and how to reduce them?</p>",
        "id": 553619540,
        "sender_full_name": "aron",
        "timestamp": 1762264549
    },
    {
        "content": "<p>Before anyone asks me for a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>, this is taken from a 9000+ line file and I have no idea how to reproduce this exponential number of <code>decreasing_by</code> goals in a smaller example – especially without understanding why this happens in the first place <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 553620019,
        "sender_full_name": "aron",
        "timestamp": 1762264666
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/KUHoGbIBsuFQqX632VhCrblD/Screenshot-2025-11-04-at-13.44.49.png\">(Proof that I'm not making up the insane number of <code>decreasing_by</code> goals)</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/KUHoGbIBsuFQqX632VhCrblD/Screenshot-2025-11-04-at-13.44.49.png\" title=\"(Proof that I'm not making up the insane number of \"><img data-original-content-type=\"image/png\" data-original-dimensions=\"705x305\" src=\"/user_uploads/thumbnail/3121/KUHoGbIBsuFQqX632VhCrblD/Screenshot-2025-11-04-at-13.44.49.png/840x560.webp\"></a></div>",
        "id": 553620497,
        "sender_full_name": "aron",
        "timestamp": 1762264764
    },
    {
        "content": "<p>try <code>have</code>ing a proof of decreasing before every recursive call, so that the default termination prover may pick it up from the context</p>",
        "id": 553620554,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762264781
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553620497\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/KUHoGbIBsuFQqX632VhCrblD/Screenshot-2025-11-04-at-13.44.49.png\">(Proof that I'm not making up the insane number of <code>decreasing_by</code> goals)</a></p>\n</blockquote>\n<p>a screenshot of a piece of the function definition might be more useful, I can't see anything here</p>",
        "id": 553620909,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762264851
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553620554\">said</a>:</p>\n<blockquote>\n<p>try <code>have</code>ing a proof of decreasing before every recursive call, so that the default termination prover may pick it up from the context</p>\n</blockquote>\n<p>Yup that's where the <code>hdepthseq</code> and <code>hsizeslt</code> hypotheses come in. But as you can see it doesn't help:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"n\">hdepths</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hdepthseq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hsizeslt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">fstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n</code></pre></div>",
        "id": 553621644,
        "sender_full_name": "aron",
        "timestamp": 1762264994
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553620909\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553620497\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/3121/KUHoGbIBsuFQqX632VhCrblD/Screenshot-2025-11-04-at-13.44.49.png\">(Proof that I'm not making up the insane number of <code>decreasing_by</code> goals)</a></p>\n</blockquote>\n<p>a screenshot of a piece of the function definition might be more useful, I can't see anything here</p>\n</blockquote>\n<p>The function itself is &gt;500 lines long. Which is why I don't expect to get specific help to fix this issue (unless you're happy to look at the entire thing) but some tips for where to begin debugging</p>",
        "id": 553622035,
        "sender_full_name": "aron",
        "timestamp": 1762265081
    },
    {
        "content": "<p>I think maybe a possible cause of all the goals is that you're proving things about the recursive calls</p>",
        "id": 553622290,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265135
    },
    {
        "content": "<p>What do you mean?</p>",
        "id": 553622477,
        "sender_full_name": "aron",
        "timestamp": 1762265170
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553621644\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553620554\">said</a>:</p>\n<blockquote>\n<p>try <code>have</code>ing a proof of decreasing before every recursive call, so that the default termination prover may pick it up from the context</p>\n</blockquote>\n<p>Yup that's where the <code>hdepthseq</code> and <code>hsizeslt</code> hypotheses come in. But as you can see it doesn't help:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"n\">hdepths</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hdepthseq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n<span class=\"n\">hsizeslt</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">fstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">sizeOf</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"bp\">⊢</span><span class=\"w\"> </span><span class=\"n\">depthFstA</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">deptha</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Looking at your screenshot, the goal looks like <code>Prod.Lex ...</code>, maybe <code>have : Prod.Lex ...</code> will help?</p>",
        "id": 553622547,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553622477\">said</a>:</p>\n<blockquote>\n<p>What do you mean?</p>\n</blockquote>\n<p>like this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"bp\">⟨</span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">property</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">property</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">property</span><span class=\"o\">]</span><span class=\"bp\">⟩</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">k</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- six goals</span>\n<span class=\"w\">  </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"n\">decreasing_tactic</span>\n</code></pre></div>",
        "id": 553623482,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265384
    },
    {
        "content": "<p>maybe that's not a very good example</p>",
        "id": 553623825,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265473
    },
    {
        "content": "<p>mm but in that example <code>foobar</code> indeed calls itself 6 times. I don't, my function only calls itself 11 times and I still get 383 goals</p>",
        "id": 553623919,
        "sender_full_name": "aron",
        "timestamp": 1762265493
    },
    {
        "content": "<p>I remember this being more complicated</p>",
        "id": 553624227,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265567
    },
    {
        "content": "<p>maybe they fixed it</p>",
        "id": 553624258,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265573
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"814082\">aron</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553623919\">said</a>:</p>\n<blockquote>\n<p>mm but in that example <code>foobar</code> indeed calls itself 6 times. I don't, my function only calls itself 11 times and I still get 383 goals</p>\n</blockquote>\n<p>once again, it would really be great if you showed a snippet of one spot where the function calls itself</p>",
        "id": 553624475,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265618
    },
    {
        "content": "<p>otherwise I don't really have anything to go off of</p>",
        "id": 553624503,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762265624
    },
    {
        "content": "<p>I can provide a gist of the whole thing if that helps? sorry but I don't really know what else would be helpful. I don't see how a context-less snippet of a recursive call would help</p>",
        "id": 553627966,
        "sender_full_name": "aron",
        "timestamp": 1762266365
    },
    {
        "content": "<p>The <code>decreasing_by</code> with 383 goals is on this line:<br>\n<a href=\"https://gist.github.com/Arrow7000/9ebb0c1302b48930bbf139cd1b70caab#file-typesystem-lean-L10020\">https://gist.github.com/Arrow7000/9ebb0c1302b48930bbf139cd1b70caab#file-typesystem-lean-L10020</a></p>",
        "id": 553628166,
        "sender_full_name": "aron",
        "timestamp": 1762266409
    },
    {
        "content": "<p>(it's technically two mutually recursive functions btw but I wanted to keep the explanation simple and since the 2nd function only calls the 1st one once and the 1st one only calls the 2nd one once I figured that's not where the explosion in # of goals comes from)</p>",
        "id": 553628630,
        "sender_full_name": "aron",
        "timestamp": 1762266468
    },
    {
        "content": "<p>I'm pretty confident that it's correctly implemented and the decreasing measures are correct. If it didn't give me 383 goals to prove termination I am pretty sure I can do it easily</p>",
        "id": 553629504,
        "sender_full_name": "aron",
        "timestamp": 1762266661
    },
    {
        "content": "<p>also the fact Lean slows to an absolute crawl here makes everything so much more painful <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span></p>",
        "id": 553629618,
        "sender_full_name": "aron",
        "timestamp": 1762266688
    },
    {
        "content": "<p>(fyi since you asked about this before, <code>unifyConcs</code> is a function that returns a <code>Decidable</code>-esque proof that either two types in my type system can unify or the proof that they can't)</p>",
        "id": 553630012,
        "sender_full_name": "aron",
        "timestamp": 1762266774
    },
    {
        "content": "<p>I see</p>",
        "id": 553632976,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762267408
    },
    {
        "content": "<p>I just found one clue to the puzzle: I just converted a <code>let</code> to a <code>have</code> and it cut down the number of goals from 383 to 39!</p>",
        "id": 553634163,
        "sender_full_name": "aron",
        "timestamp": 1762267643
    },
    {
        "content": "<p>I tried this because I saw that the definition of <code>fstUnif</code>looked like this, which made me wonder whether each let binding carries with it a ton of stuff about inner recursive calls?</p>\n<p><a href=\"/user_uploads/3121/2DMjQeh2yQQ4eMyz5c2J3FsX/Screenshot-2025-11-04-at-14.49.56.png\">Screenshot 2025-11-04 at 14.49.56.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/2DMjQeh2yQQ4eMyz5c2J3FsX/Screenshot-2025-11-04-at-14.49.56.png\" title=\"Screenshot 2025-11-04 at 14.49.56.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"767x888\" src=\"/user_uploads/thumbnail/3121/2DMjQeh2yQQ4eMyz5c2J3FsX/Screenshot-2025-11-04-at-14.49.56.png/840x560.webp\"></a></div>",
        "id": 553634881,
        "sender_full_name": "aron",
        "timestamp": 1762267819
    },
    {
        "content": "<p>that's what I was saying</p>",
        "id": 553635088,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762267870
    },
    {
        "content": "<p>but my example I came up with was kind of bad</p>",
        "id": 553635122,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762267879
    },
    {
        "content": "<p>I know you're not supposed to use <code>have</code> for data, but I'm hoping that once I switch the implementation away from using tactics, <code>let</code> will just behave like a normal variable binding instead of the <code>let</code> tactic?</p>",
        "id": 553635181,
        "sender_full_name": "aron",
        "timestamp": 1762267893
    },
    {
        "content": "<p>Do you know about the difference between <code>let</code> and <code>letI</code>? Inside a definition (i.e., building data), you probably want to prefer the latter.</p>",
        "id": 553635756,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1762268026
    },
    {
        "content": "<p>oh my god just 11 goals!!<br>\n<a href=\"/user_uploads/3121/ezOL-5zvVi9-8xRanL7wCDww/Screenshot-2025-11-04-at-14.54.04.png\">Screenshot 2025-11-04 at 14.54.04.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ezOL-5zvVi9-8xRanL7wCDww/Screenshot-2025-11-04-at-14.54.04.png\" title=\"Screenshot 2025-11-04 at 14.54.04.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"452x245\" src=\"/user_uploads/thumbnail/3121/ezOL-5zvVi9-8xRanL7wCDww/Screenshot-2025-11-04-at-14.54.04.png/840x560.webp\"></a></div>",
        "id": 553635949,
        "sender_full_name": "aron",
        "timestamp": 1762268069
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553635756\">said</a>:</p>\n<blockquote>\n<p>Do you know about the difference between <code>let</code> and <code>letI</code>? Inside a definition (i.e., building data), you probably want to prefer the latter.</p>\n</blockquote>\n<p>No, although I did just look at it just before in case there were different kinds of <code>let</code>s that behaved differently, but its description didn't tell me much:</p>\n<p><code>letI</code> behaves like <code>let</code>, but inlines the value instead of producing a <code>let</code> term.</p>\n<p>But I don't know what a <code>let</code> term is? I thought it was just variable binding basically?</p>",
        "id": 553636386,
        "sender_full_name": "aron",
        "timestamp": 1762268178
    },
    {
        "content": "<p>I think this is what a let term is. But <code>letI</code> is different. For instance</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>is evaluated to <code>f 4</code>, while</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>is evaluated to itself.</p>",
        "id": 553637268,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1762268316
    },
    {
        "content": "<p>noooooo <span aria-label=\"sob\" class=\"emoji emoji-1f62d\" role=\"img\" title=\"sob\">:sob:</span> we're back to 383 goals even with <code>letI</code>s<br>\n<a href=\"/user_uploads/3121/NWzsdWIM8-33UeCYIfDF5cNf/Screenshot-2025-11-04-at-15.00.44.png\">Screenshot 2025-11-04 at 15.00.44.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/NWzsdWIM8-33UeCYIfDF5cNf/Screenshot-2025-11-04-at-15.00.44.png\" title=\"Screenshot 2025-11-04 at 15.00.44.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"568x477\" src=\"/user_uploads/thumbnail/3121/NWzsdWIM8-33UeCYIfDF5cNf/Screenshot-2025-11-04-at-15.00.44.png/840x560.webp\"></a></div>",
        "id": 553638042,
        "sender_full_name": "aron",
        "timestamp": 1762268481
    },
    {
        "content": "<p>it seems like the <code>let</code> is what was creating all those goals</p>",
        "id": 553638468,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762268569
    },
    {
        "content": "<p>so if you switch back to <code>letI</code> you will have lots of goals</p>",
        "id": 553638518,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762268580
    },
    {
        "content": "<p>Right, but I thought <code>letI</code> would let me bind data without causing a goal explosion</p>",
        "id": 553639212,
        "sender_full_name": "aron",
        "timestamp": 1762268737
    },
    {
        "content": "<p>What's the idiomatic thing to do here then? you're not supposed to use <code>have</code> for data but <code>let</code> produces an insane number of goals – for reasons which I still don't fully understand. Will this be different if I use <code>let</code> or <code>letI</code> outside of tactic mode?</p>",
        "id": 553639701,
        "sender_full_name": "aron",
        "timestamp": 1762268861
    },
    {
        "content": "<p>no I think it will be the same</p>",
        "id": 553640412,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269041
    },
    {
        "content": "<p>so here's what I think is happening</p>",
        "id": 553640452,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269049
    },
    {
        "content": "<p>let's say you do</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">recursive_call</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"n\">k</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">barfoo</span><span class=\"w\"> </span><span class=\"n\">k</span>\n</code></pre></div>\n<p>so the recursive call is done once here obviously</p>\n<p>but when Lean is doing postprocessing to get ready to prove termination, it inlines the <code>let</code> into</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"n\">recursive_call</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">barfoo</span><span class=\"w\"> </span><span class=\"n\">recursive_call</span>\n</code></pre></div>\n<p>so now there's two recursive calls</p>",
        "id": 553640905,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269151
    },
    {
        "content": "<p>so this isn't just limited to two, you can get 383 as well</p>",
        "id": 553641063,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269189
    },
    {
        "content": "<p>so what's the right thing to do here?</p>",
        "id": 553641117,
        "sender_full_name": "aron",
        "timestamp": 1762269200
    },
    {
        "content": "<p>(also why is <code>have</code> bad to use for data?)</p>",
        "id": 553641389,
        "sender_full_name": "aron",
        "timestamp": 1762269241
    },
    {
        "content": "<p>so the correct thing to do here is to use <code>have</code></p>",
        "id": 553641653,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269281
    },
    {
        "content": "<p>and it's not necessarily bad for data</p>",
        "id": 553641689,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762269293
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/113489-new-members/topic/383.20decreasing_by.20goals.3F/near/553640905\">said</a>:</p>\n<blockquote>\n<p>but when Lean is doing postprocessing to get ready to prove termination, it inlines the <code>let</code> into</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">foobar</span><span class=\"w\"> </span><span class=\"n\">recursive_call</span>\n<span class=\"w\">  </span><span class=\"c1\">-- ...</span>\n<span class=\"w\">  </span><span class=\"n\">barfoo</span><span class=\"w\"> </span><span class=\"n\">recursive_call</span>\n</code></pre></div>\n<p>so now there's two recursive calls</p>\n</blockquote>\n<p>Are you sure about that? This looks like a very bad way of dealing with an expression with a <code>let</code> term.</p>",
        "id": 553643575,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1762269794
    },
    {
        "content": "<p>this is my best guess</p>",
        "id": 553645180,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762270129
    }
]