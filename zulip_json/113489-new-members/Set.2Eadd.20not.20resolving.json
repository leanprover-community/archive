[
    {
        "content": "<p>Hello!</p>\n<p>I got an error that I cornered into this very minimal code. Why is Set.add not being used to infer Add (Set M)?</p>\n<p>Thanks!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommMonoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"n\">M</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 489214518,
        "sender_full_name": "Javier Lopez-Contreras",
        "timestamp": 1734349586
    },
    {
        "content": "<p>You don't have <code>open scoped Pointwise</code></p>",
        "id": 489214593,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734349611
    },
    {
        "content": "<p>That was quick :)</p>",
        "id": 489214662,
        "sender_full_name": "Javier Lopez-Contreras",
        "timestamp": 1734349638
    },
    {
        "content": "<p>Thanks Yaël &lt;3</p>",
        "id": 489214683,
        "sender_full_name": "Javier Lopez-Contreras",
        "timestamp": 1734349647
    },
    {
        "content": "<p>The clue is in the source code (jump to definition with <code>Set.add</code>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The pointwise multiplication of sets `s * t` and `t` is defined as `{x * y | x ∈ s, y ∈ t}` in</span>\n<span class=\"sd\">locale `Pointwise`. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span>\n<span class=\"w\">      </span><span class=\"s2\">\"The pointwise addition of sets `s + t` is defined as `{x + y | x ∈ s, y ∈ t}` in locale</span>\n<span class=\"s2\">      `Pointwise`.\"</span><span class=\"kd\">]</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mul</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">image2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">scoped</span><span class=\"o\">[</span><span class=\"n\">Pointwise</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">add</span>\n</code></pre></div>\n<p>the last line means \"don't make this a global instance, only make it an instance when <code>open scoped Pointwise</code> is typed\"</p>",
        "id": 489224707,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734352601
    },
    {
        "content": "<p>i don't think you need <code>scoped</code> for this though?</p>",
        "id": 489250226,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734359051
    },
    {
        "content": "<p>as in, <code>open Pointwise</code> works fine too</p>",
        "id": 489250310,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734359082
    },
    {
        "content": "<p>Yes but it's good practice to differentiate between scopes and namespaces</p>",
        "id": 489251635,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1734359403
    },
    {
        "content": "<p>could you elaborate? i'm not sure what you mean by that...</p>",
        "id": 489253708,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1734359953
    },
    {
        "content": "<p>I think <code>open Pointwise</code> opens both the scope (i.e. notation) and the namespace. I am usually careful to only open the scope if I don't need the namespace but probably others don't worry so much about this.</p>",
        "id": 489359895,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1734388909
    }
]