[
    {
        "content": "<p>Hi folks, can anyone tell me if there is some standard/existing tactic for prolog-like  proof search in lean4. As a concrete example, suppose I give you definitions like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">peano</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">peano</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">peano</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">peano</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">peano</span>\n\n<span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">peano</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">evenZ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"n\">Z</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">evenSS</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">))</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">even</span>\n</code></pre></div>\n<p>now suppose I want to prove that</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">even_4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">prolog_like_search</span>\n</code></pre></div>\n<p>is there some <code>prolog_like_search</code> tactic I can use that would generate the proof term? By \"prolog-like-search\" I mean if you write the above in Prolog as (something like)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">even</span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">even</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>and then ask query</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">even</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"o\">(</span><span class=\"n\">Z</span><span class=\"o\">))))</span>\n</code></pre></div>\n<p>I think prolog will say \"yes\" or such... (having implicitly \"synthesized\" the proof from the rules/definition of <code>even</code>).</p>\n<p>Any pointers will be greatly appreciated!</p>",
        "id": 477540875,
        "sender_full_name": "Ranjit Jhala",
        "timestamp": 1729208971
    },
    {
        "content": "<p>Yeah, <code>simp</code> is basically that:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">even_4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">evenZ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">evenSS</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 477546068,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729212601
    },
    {
        "content": "<p>You likely need to increase the \"maximum discharge depth\". By default it's 2, and that's <em>just</em> enough for this example.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">maxDischargeDepth</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">evenZ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">evenSS</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 477546193,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729212665
    },
    {
        "content": "<p>Another is the <code>apply_rules</code> tactic, which searches for some sequence of <code>apply</code>s that work, which is closer to Prolog:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">even_4</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">Z</span><span class=\"o\">))))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply_rules</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">evenZ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">evenSS</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 477546369,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729212738
    },
    {
        "content": "<p>I take that back, it should be <code>solve_by_elim</code>, not <code>apply_rules</code>. The <code>apply_rules</code> tactic doesn't do backtracking.</p>",
        "id": 477546445,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1729212805
    },
    {
        "content": "<p>Thanks very much, I didn't know about <code>apply_rules</code> or <code>solve_by_elim</code>! (Elsewhere someone also pointed me to this <code>aesop</code> system which seems very relevant: <a href=\"https://github.com/leanprover-community/aesop\">https://github.com/leanprover-community/aesop</a>)</p>",
        "id": 477562775,
        "sender_full_name": "Ranjit Jhala",
        "timestamp": 1729222303
    }
]