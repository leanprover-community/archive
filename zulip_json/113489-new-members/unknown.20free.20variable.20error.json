[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Sym2</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">z'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">z</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">z'</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h'</span>\n</code></pre></div>\n<p>results in this error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">free</span><span class=\"w\"> </span><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"ss\">`_fvar</span><span class=\"bp\">.</span><span class=\"m\">61</span><span class=\"bp\">`</span>\n</code></pre></div>\n<p>There are <a href=\"https://github.com/leanprover/lean4/issues?q=is%3Aissue%20state%3Aopen%20%22unknown%20free%20variable%22\">a few bug reports about this error message</a>, but none of them seem like the same scenario to me.<br>\nIs this one of the known issues? Is it a new bug? Or am I doing something wrong?</p>",
        "id": 553216844,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762062841
    },
    {
        "content": "<p>You should use obtain instead of let in your last line.</p>",
        "id": 553220737,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1762066092
    },
    {
        "content": "<p>You probably should, but this still looks like a bug.</p>",
        "id": 553222206,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1762067406
    },
    {
        "content": "<p><a href=\"#narrow/channel/270676-lean4/topic/unknown.20free.20variable.20on.20.60obtain.60\">https://leanprover.zulipchat.com/#narrow/channel/270676-lean4/topic/unknown.20free.20variable.20on.20.60obtain.60</a></p>",
        "id": 553237203,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762081387
    },
    {
        "content": "<p>this could be the same thing?</p>",
        "id": 553237223,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1762081409
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"669043\">Yongxi Lin (Aaron)</span> <a href=\"#narrow/channel/113489-new-members/topic/unknown.20free.20variable.20error/near/553220737\">said</a>:</p>\n<blockquote>\n<p>You should use obtain instead of let in your last line.</p>\n</blockquote>\n<p>Inlining any of the 3 definitions also gets rid of the error, but I think all of these (admittedly weird since it's a <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>) operations are legitimate</p>",
        "id": 553237514,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1762081728
    },
    {
        "content": "<p>Reported as <a href=\"https://github.com/leanprover/lean4/pull/11626\">lean4#11626</a></p>",
        "id": 563315730,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765507394
    },
    {
        "content": "<p>Somehow ran into another <code>unknown free variable</code> for unrelated reasons: <a href=\"https://github.com/leanprover/lean4/pull/11692\">lean4#11692</a></p>",
        "id": 563970685,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1765865305
    }
]