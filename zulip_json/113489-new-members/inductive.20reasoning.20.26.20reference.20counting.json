[
    {
        "content": "<p>Good day, unfortunately don't have an #nwe since this is an advance worry, but bsically, I'm designing an algorithm (based on DFS) nad based on what I've read in the libs, I came up with the following structure:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">TLState</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Raw</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"c1\">-- a bunch of vectors</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">SmallStepWF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">state</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Raw</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"c1\">-- a bunch of invariants</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">small_step_raw</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">..</span><span class=\"n\">params</span><span class=\"bp\">..</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">StateM</span><span class=\"w\"> </span><span class=\"n\">Raw</span><span class=\"w\"> </span><span class=\"n\">VLabel</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">SmallStepState</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">state</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Raw</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">SmallStepWF</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">small_step</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">..</span><span class=\"n\">params</span><span class=\"bp\">..</span><span class=\"o\">):</span><span class=\"w\"> </span><span class=\"n\">StateM</span><span class=\"w\"> </span><span class=\"n\">SmallStepState</span><span class=\"w\"> </span><span class=\"n\">VLabel</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">wf</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">small_step_raw</span><span class=\"w\"> </span><span class=\"n\">params</span><span class=\"bp\">..</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">wf1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...;</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">state1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">wf1</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">TLState</span>\n</code></pre></div>\n<p>I'm worrying that this introduces additional references to my state, and therefore the access stops being linear and there's a bunch of copying going on. Am I correct in my assumptions? How would I proceed to avoid that?</p>",
        "id": 479487280,
        "sender_full_name": "Alex Mobius",
        "timestamp": 1730209910
    }
]