[
    {
        "content": "<p>There's a tactic that I want to write, and I'm starting off with basically zero knowledge of tactics, and I've been following the following algorithm:</p>\n<ol>\n<li>Find an existing tactic with similar behaviour</li>\n<li>Copy the source file to Lean 4 Web</li>\n<li>Try to follow every step of the tactic (putting it in the web editor helps me to click around)</li>\n</ol>\n<p>Is there a more efficient algorithm that I can follow? (I suppose I could open it in VSCode as well, but beyond that?)</p>",
        "id": 533276684,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754567341
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/lean4-metaprogramming-book/\">https://leanprover-community.github.io/lean4-metaprogramming-book/</a> would improve your skills to read and understand existing tactics</p>",
        "id": 533279942,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1754568587
    },
    {
        "content": "<p>&lt;deleted&gt;</p>",
        "id": 533280003,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1754568612
    },
    {
        "content": "<p>You can leverage your social connections here and get someone who knows more about writing tactics to help.</p>",
        "id": 533294335,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1754573630
    },
    {
        "content": "<p>Heather's course <a href=\"https://github.com/hrmacbeth/metaprogramming\">https://github.com/hrmacbeth/metaprogramming</a> was interesting but it wasn't designed for remote learning, \"you had to be there\" basically.</p>",
        "id": 533481648,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754665690
    },
    {
        "content": "<p>did she give lectures about this stuff at Simons and are they videoed?</p>",
        "id": 533481709,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1754665715
    },
    {
        "content": "<p>Kenny, see also <a href=\"https://github.com/mirefek/lean-tactic-programming-guide\">https://github.com/mirefek/lean-tactic-programming-guide</a></p>",
        "id": 533534946,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1754691527
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 533534984,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754691568
    },
    {
        "content": "<p>I would like to announce that I successfully wrote my first tactic in <a href=\"https://github.com/leanprover-community/mathlib4/pull/28072\">#28072</a> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 533535015,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754691604
    },
    {
        "content": "<p>(golfing/general advice is very welcome)</p>",
        "id": 533535032,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754691621
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"n\">initialize</span><span class=\"w\"> </span><span class=\"n\">registerTraceClass</span><span class=\"w\"> </span><span class=\"ss\">`rw_equiv_tac</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">rw_equiv_tac</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"c1\">-- unknown option 'trace.rw_equiv_tac'</span>\n</code></pre></div>",
        "id": 533559756,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754722294
    },
    {
        "content": "<p>Does register only work in the <em>next</em> file?</p>",
        "id": 533559764,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754722303
    },
    {
        "content": "<p>so i've been told that Qq is very hard to debug</p>",
        "id": 533588203,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756470
    },
    {
        "content": "<p>it's complaining about a type mismatch and i don't know how to fix it</p>",
        "id": 533588217,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756485
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a>?</p>",
        "id": 533588265,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754756545
    },
    {
        "content": "<p>also, the expected type window doesn't work very well for me, it seems to be always stuck on the previous state</p>",
        "id": 533588293,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756570
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Simp</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"n\">simproc</span><span class=\"w\"> </span><span class=\"n\">matrix_diagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">diagonal</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofQ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">M?</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k?</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k?</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">diagonal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k?</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">dF</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">zR</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">M?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n</code></pre></div>",
        "id": 533588296,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756579
    },
    {
        "content": "<p>yeah Qq is sort of broken sometimes</p>",
        "id": 533588303,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754756583
    },
    {
        "content": "<p>error:<br>\ntype mismatch<br>\n  Matrix.diagonal ?m✝<br>\nhas type<br>\n  Matrix (Fin (OfNat.ofNat ?m✝)) (Fin (OfNat.ofNat ?m✝)) ?m✝¹ : Type u<br>\nbut is expected to have type<br>\n  «$α» : Type u</p>",
        "id": 533588307,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756586
    },
    {
        "content": "<p>oh I fixed it</p>",
        "id": 533588592,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754756910
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Simp</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"n\">simproc</span><span class=\"w\"> </span><span class=\"n\">matrix_diagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">diagonal</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofQ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">M?</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k?</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k?</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">diagonal</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">dF</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">zR</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">M?</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n</code></pre></div>",
        "id": 533588602,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754756919
    },
    {
        "content": "<p>do you know how to read the correct expected type?</p>",
        "id": 533588640,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754756967
    },
    {
        "content": "<p>oh... i have to do the french quotes? lol</p>",
        "id": 533588734,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754757069
    },
    {
        "content": "<p>probably not?</p>",
        "id": 533588745,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754757084
    },
    {
        "content": "<p>I was just trying things until it worked</p>",
        "id": 533588748,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754757091
    },
    {
        "content": "<p>i just compared your code with mine and only saw the french quote as the difference</p>",
        "id": 533588758,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754757115
    },
    {
        "content": "<p>yeah it works without them too (edited)</p>",
        "id": 533588765,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754757122
    },
    {
        "content": "<p>well, ok, so it works with <code>_</code> or with french quotes  <code>«$k?»</code>, just not with <code>$k?</code></p>",
        "id": 533588808,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754757180
    },
    {
        "content": "<p>yeah</p>",
        "id": 533588896,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754757267
    },
    {
        "content": "<p>I think it's because just <code>$k?</code> will make it a pattern variable</p>",
        "id": 533588914,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754757291
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Lean/Meta/Basic.html#Lean.Meta.mkForallFVars\">Lean.Meta.mkForallFVars</a></p>",
        "id": 533599700,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754771045
    },
    {
        "content": "<p>Is there a Qq version of taking the \"forall closure\"?</p>",
        "id": 533599708,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754771053
    },
    {
        "content": "<p>I don't think you can use Qq to do that</p>",
        "id": 533599734,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771092
    },
    {
        "content": "<p>since it doesn't store the context your <code>Expr</code>s are supposed to be typed in</p>",
        "id": 533599751,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771112
    },
    {
        "content": "<p>maybe you can</p>",
        "id": 533599767,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771135
    },
    {
        "content": "<p>actually probably not</p>",
        "id": 533599784,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771149
    },
    {
        "content": "<p>since what would the type be?</p>",
        "id": 533599788,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771157
    },
    {
        "content": "<p>maybe just stick to the non-Qq stuff</p>",
        "id": 533599811,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754771190
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unapp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mH</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">)}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">trace</span><span class=\"o\">[</span><span class=\"n\">debug</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{f}, {y}\"</span>\n<span class=\"w\">  </span><span class=\"c1\">-- let ~q($f $x) := y | return .none</span>\n<span class=\"w\">  </span><span class=\"c1\">-- return .some y</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">fx</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">getAppFnArgs</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fx</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">)[</span><span class=\"mi\">5</span><span class=\"o\">]</span><span class=\"bp\">?</span>\n\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">gG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span>\n<span class=\"kd\">@[</span><span class=\"n\">instance</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">gH</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"kn\">axiom</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">unapp</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 533953884,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754995772
    },
    {
        "content": "<p>so I tried to use Qq to match <code>f x</code> where <code>f</code> is a group hom, and it doesn't work</p>",
        "id": 533953945,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754995798
    },
    {
        "content": "<p>the code above correctly extracts <code>x</code> from <code>f x</code>, without using Qq</p>",
        "id": 533954000,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754995819
    },
    {
        "content": "<p>the two commented lines are my Qq attempt, which has error (comment out the two lines below that)</p>",
        "id": 533954060,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754995841
    },
    {
        "content": "<p>how do I fix this?</p>",
        "id": 533954099,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754995855
    },
    {
        "content": "<p>Not sure if this is how you're supposed to do it</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">unapp</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mG</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">mH</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">)}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">→*</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">H</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">G</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">DFunLike</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"bp\">«$</span><span class=\"n\">f</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 533954786,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754996181
    },
    {
        "content": "<p>aha, we're back to the french quotes</p>",
        "id": 533954927,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754996236
    },
    {
        "content": "<p>aha, you don't even need coe</p>",
        "id": 533954975,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754996252
    },
    {
        "content": "<p>thanks!</p>",
        "id": 533955034,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754996272
    },
    {
        "content": "<p>The generated code just checks if it's reducibly defeq to <code>f ?x</code> where <code>?x</code> is a fresh metavariable, without assigning any other metavariables</p>",
        "id": 533955195,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754996332
    }
]