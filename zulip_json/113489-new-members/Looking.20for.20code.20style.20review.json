[
    {
        "content": "<p>Hi! I got interested in Lean recently and decided to practice formalizing <a href=\"https://en.wikipedia.org/wiki/Star-free_language\">Schützenberger theorem</a>, since formal language theory is in scarce in mathlib. Currently, having fun working towards it, but here are my concerns:</p>\n<ol>\n<li>Is it even a good idea to contribute it to mathlib if I succeed at proving?</li>\n<li>Is it okay to ask here for a quick code reviews? I want it to be as idiomatic as possible, and I feel myself always misnaming various things :)</li>\n</ol>",
        "id": 486929674,
        "sender_full_name": "Igor Shimanogov",
        "timestamp": 1733732090
    },
    {
        "content": "<p>Welcome! Contributing it to Mathlib would be great, and feel free to ask here for code review</p>",
        "id": 486932758,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1733732948
    },
    {
        "content": "<p>So, I started with defining syntactic monoid of a language:<br>\n<a href=\"https://gist.github.com/MrSumato/a2d726198d67d26e1fee4264e85f5793\">https://gist.github.com/MrSumato/a2d726198d67d26e1fee4264e85f5793</a></p>\n<p>Is there anything incorrect about this code?  Any comments on improvements? Also, it seems kinda strange that there is no anything like <code>setOf_eq_iff</code> in mathlib.</p>",
        "id": 487122664,
        "sender_full_name": "Igor Shimanogov",
        "timestamp": 1733787613
    },
    {
        "content": "<p>That's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.ext_iff#doc\">docs#Set.ext_iff</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">setOf_eq_iff</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span>\n</code></pre></div>\n<p>though I'm slightly misusing definitions. This is better:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">setOf_eq_iff</span><span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>The <code>simp?</code> tactic shows it's finishing it off by rewriting with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Set.mem_setOf_eq#doc\">docs#Set.mem_setOf_eq</a></p>",
        "id": 487124382,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733788452
    },
    {
        "content": "<p>Oh, thx, I see! Fixed it in the gist. What about remaining part? Are namings correct?</p>",
        "id": 487183588,
        "sender_full_name": "Igor Shimanogov",
        "timestamp": 1733817766
    },
    {
        "content": "<p>This is mostly stylistic, but <code>syn_eq_is_eq</code> can be shortened to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">syn_eq_is_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Equivalence</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">SynEquiv</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">refl</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"w\">  </span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n</code></pre></div>\n<p>something like <code>equivalence_synEquiv</code> might be a more descriptive name (or, as it's an instance, you could also forgo giving it any name)</p>",
        "id": 487202499,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1733823823
    }
]