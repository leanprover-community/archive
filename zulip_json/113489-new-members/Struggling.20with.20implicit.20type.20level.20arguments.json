[
    {
        "content": "<p>I'm trying to define custom Subobject akin to what's in <code>Mathlib.CategoryTheory.Subobject.Basic</code> but parameterised by a <code>MorphismProperty</code> and I'm constantly hitting issues with implicit arguments of type levels.</p>\n<p>In particular, if I start with the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Subobject</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span>\n\n<span class=\"kn\">universe</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"w\"> </span><span class=\"n\">u_2</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"n\">u_2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Δ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">MorphismProperty</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">StgOver</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ObjectProperty</span><span class=\"bp\">.</span><span class=\"n\">FullSubcategory</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Over</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Δ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- replacing original line in Mathlib.CategoryTheory.Subobject.Basic:</span>\n<span class=\"w\">  </span><span class=\"c1\">--   ObjectProperty.FullSubcategory (fun f : Over X =&gt; Mono f.hom)</span>\n</code></pre></div>\n<p>and then I would like to define the variant of <code>Subobject</code> for which I need the <code>Category</code> instance. However, both of these fail if I just use the same formulas as for the original definition of <code>Subobject</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StgOver</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ObjectProperty</span><span class=\"bp\">.</span><span class=\"n\">FullSubcategory</span><span class=\"bp\">.</span><span class=\"n\">category</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"c1\">-- error: don't know how to synthesize implicit argument 'Δ' ...</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">StgSub</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ThinSkeleton</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StgOver</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"c1\">-- error: failed to synthesize Category.{?u.982, max u_2 u_1} (StgOver X)</span>\n</code></pre></div>\n<p>What is really strange is that I get errors without even invoking<code>ThinSkeleton</code>. Namely, already this fails</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">JustRename</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">StgOver</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"c1\">-- error: don't know how to synthesize implicit argument 'Δ' ...</span>\n</code></pre></div>\n<p>It's probably something trivial but I'm a bit lost with this. Any pointers highly appreciated!</p>",
        "id": 531593163,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753791350
    },
    {
        "content": "<p><code>StgOver X (Δ := Δ)</code></p>",
        "id": 531601825,
        "sender_full_name": "Vlad",
        "timestamp": 1753793734
    },
    {
        "content": "<p>Wow, magic! Thanks so much!</p>",
        "id": 531609257,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753795556
    },
    {
        "content": "<p>Given that <code>X</code> doesn't determine <code>Δ</code>, maybe <code>Δ</code> should be an explicit argument to <code>StgOver</code> as well?</p>",
        "id": 531693639,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753821022
    },
    {
        "content": "<p>If I have to always write <code>(Δ := Δ)</code> then I'd consider it. I'll see how things go as I encode more maths. It would be nice to guide it somehow...</p>",
        "id": 531697813,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753822674
    },
    {
        "content": "<p>Maybe the <code>Δ</code> in the type of <code>StgOver</code> will be enough, but you'll likely need to use <code>(Δ := Δ)</code> frequently.</p>\n<p>At least as an explicit argument you can write <code>StgOver _ X</code>, so it's not that onerous.</p>\n<p>Anyway, no need to worry about it now, since you'll find out soon enough which is more convenient!</p>",
        "id": 531698523,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753822932
    },
    {
        "content": "<p>Good advice, I'll keep it in mind. Thanks!</p>",
        "id": 531698726,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753823005
    },
    {
        "content": "<p>Actually, just tried to do as you say and it still fails to synthesize the argument for <code>_</code>...</p>",
        "id": 531699724,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753823389
    },
    {
        "content": "<p>Right, in that case you need to write <code>StgOver Δ X</code></p>",
        "id": 531699821,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753823426
    },
    {
        "content": "<p>The point is that you can write <code>_</code> when it can figure it out from the expected type, but <code>_</code> has the same failures as if it were an implicit argument.</p>",
        "id": 531699940,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753823474
    },
    {
        "content": "<p>Writing this in every application would still be too annoying (it's one of the main operations I plan to use). I guess that the solution to this is to define a custom class which would extend <code>Category</code> with extra data for <code>Δ</code>.</p>",
        "id": 531700297,
        "sender_full_name": "Tomáš Jakl",
        "timestamp": 1753823616
    }
]