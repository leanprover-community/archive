[
    {
        "content": "<p>Example usage:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">compose</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:)</span>\n</code></pre></div>\n<p>IIUC this is an empty type annotation.</p>\n<p>Searching for <code>:)</code> in Mathlib yields over 500 results (<a href=\"https://github.com/leanprover-community/mathlib4/blob/50c7f343a1511ab740acf1ee41757affaa8ba24c/Mathlib/Algebra/Category/Ring/Instances.lean#L36\">example</a>), but I couldn't find any examples where it is necessary to have the colon with nothing after it.</p>\n<p>Is this on purpose? Or a relic of some cleanup? When would I need to use an empty type annotation?</p>",
        "id": 546913997,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761316747
    },
    {
        "content": "<p>See <a href=\"https://github.com/leanprover-community/mathlib4/pull/20436\">#20436</a> :)</p>",
        "id": 546914278,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761316823
    },
    {
        "content": "<p>Thanks :)<br>\nDoes that mean there are more places to clean up? Or are most of the remaining smileys necessary?<br>\n(I couldn't find one that was)</p>",
        "id": 546915104,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761317063
    },
    {
        "content": "<p>Do you mean that you have tried removing them and things still work?</p>",
        "id": 546915344,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1761317117
    },
    {
        "content": "<p>And, if it elaborates, does performance suffer?</p>",
        "id": 546915506,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1761317159
    },
    {
        "content": "<blockquote>\n<p>Do you mean that you have tried removing them and things still work?</p>\n</blockquote>\n<p>Yes, tried 5 different ocurrences</p>",
        "id": 546915520,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761317162
    },
    {
        "content": "<p>idk how to measure performance, but even if they're redundant and don't degrade performance there might be <a href=\"https://github.com/leanprover-community/mathlib4/blob/50c7f343a1511ab740acf1ee41757affaa8ba24c/Mathlib/Algebra/GradedMonoid.lean#L401-L402\">other reasons to have them</a></p>",
        "id": 546915924,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761317256
    },
    {
        "content": "<p>Github PR comment <code>!bench</code> and wait</p>",
        "id": 546916095,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1761317301
    },
    {
        "content": "<p>PR for what? <code>s/:)/)/g</code> in the entire codebase?</p>",
        "id": 546916190,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1761317328
    },
    {
        "content": "<p>Oh thanks! I just learned about <code>:)</code></p>",
        "id": 546916989,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1761317547
    },
    {
        "content": "<p>To measure performance locally, use <code>set_option trace.profiler true</code></p>",
        "id": 547068633,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761410037
    },
    {
        "content": "<p>I am still struggling to grasp the need for either (... : _) and (... :) (and their subtle difference is definitely lost on me). I get why a manual type annotation (... : X) is needed sometimes, but (: _) feels like just swapping one type of implicit with another? Does anyone have a minimal example where (... :) (or (...: _)  is useful)?</p>",
        "id": 547077162,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1761419631
    },
    {
        "content": "<p>As an example of the difference, <code>def foo : Int := 1 + 2</code> gives addition on integers, while <code>def foo : Int := (1 + 2:)</code> gives addition on natural numbers.</p>",
        "id": 547077314,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761419806
    },
    {
        "content": "<p>The point of <code>( ... :)</code> is that the part on the inside is elaborated without an expected type. To see this, recall that when you write <code>#check 1 + 2</code>, you also get natural number addition, so <code>(1 + 2:)</code> also gives natural number addition.</p>",
        "id": 547077436,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761419988
    },
    {
        "content": "<p>Great example, that's exactly what I needed!  Is there a similarly minimal example for when (: _) is needed? </p>\n<p>It appears that <code>def foo: Int := (1 + 2 : _)</code> works like <code>def foo: Int := 1 + 2</code> , so that shows the difference with <code>(:)</code>.</p>",
        "id": 547077921,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1761420637
    },
    {
        "content": "<p>I think there is never a reason to use <code>( ... : _)</code> (but maybe it was used before <code>( ... :)</code> existed)</p>",
        "id": 547078009,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761420720
    },
    {
        "content": "<p>(side note - as someone new to Lean, but somewhat experienced with practical PL types like TypeScript, I have no idea how is <code>elaboration</code> different from <code>type inference</code>, but so far just using them as synonyms them in my head hasn't gotten me in trouble).</p>",
        "id": 547078159,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1761420881
    },
    {
        "content": "<p>type inference means: given a term, guess the type<br>\nelaboration means: given a syntax, guess the term</p>",
        "id": 547078193,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761420933
    },
    {
        "content": "<p>in Lean is <code>type inference</code> separate from <code>elaboration</code> or part of <code>elaboration</code>, because surely at point after guessing the term, you also need to know the type to do the actual core type checking.</p>",
        "id": 547078267,
        "sender_full_name": "Rado Kirov",
        "timestamp": 1761421016
    },
    {
        "content": "<p>it's a process that's used during elaboration</p>",
        "id": 547078283,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761421033
    },
    {
        "content": "<p>but you can also use it during other times</p>",
        "id": 547078289,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761421046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479299\">Jovan Gerbscheid</span> <a href=\"#narrow/stream/113489-new-members/topic/What.20is.20the.20purpose.20of.20.60.3A.29.60.3F/near/547078009\">said</a>:</p>\n<blockquote>\n<p>I think there is never a reason to use <code>( ... : _)</code> (but maybe it was used before <code>( ... :)</code> existed)</p>\n</blockquote>\n<p>They do not always elaborate the same way</p>",
        "id": 547085255,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1761429834
    },
    {
        "content": "<p>Well yes, the example I shared shows that they elaborate in different ways.</p>",
        "id": 547085288,
        "sender_full_name": "Jovan Gerbscheid",
        "timestamp": 1761429879
    }
]