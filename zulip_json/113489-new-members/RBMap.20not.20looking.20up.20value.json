[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">RBMap</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">RBMap</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Ordering</span><span class=\"bp\">.</span><span class=\"n\">lt</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">RBMap</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"n\">find!</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>This is giving me 0, presumably the inhabited instance of nat. why isn't it giving me 2?</p>",
        "id": 452902104,
        "sender_full_name": "Quinn",
        "timestamp": 1721511623
    },
    {
        "content": "<p>oh, also: the lsp docs in my IDE for <code>find!</code> says it panics if there's no lookup, but it demands the target type is inhabited leading me to believe that it defaults if there's no lookup. am i confused or are the docs wrong? in my <a href=\"http://live.lean-lang.org\">live.lean-lang.org</a> link you can put a nonsense key in like 3 and it won't panic, it'll return zero</p>",
        "id": 452902378,
        "sender_full_name": "Quinn",
        "timestamp": 1721511776
    },
    {
        "content": "<p>update on panic: it panics when i do <code>lean exe ...</code> at terminal, but fills with inhabited instance (default) in the IDE session. is that how that works?</p>",
        "id": 452904557,
        "sender_full_name": "Quinn",
        "timestamp": 1721512585
    },
    {
        "content": "<p><code>AssocList</code> is just as bad</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">AssocList</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">AssocList</span><span class=\"bp\">.</span><span class=\"n\">empty</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Map'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">AssocList</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">map'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Map'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">AssocList</span><span class=\"bp\">.</span><span class=\"n\">empty</span><span class=\"bp\">.</span><span class=\"n\">insert</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"n\">find?</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>returns <code>none</code>. should return <code>some 2</code>.</p>",
        "id": 452905547,
        "sender_full_name": "Quinn",
        "timestamp": 1721513078
    },
    {
        "content": "<p>You are setting the ordering in a way that violates the assumptions. Use <code>Lean.RBMap Nat Nat cmpLE</code> instead and it works fine.</p>",
        "id": 452906123,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1721513392
    },
    {
        "content": "<p>Your second example refers to <code>map</code> still and not <code>map'</code></p>",
        "id": 452906207,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1721513405
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"127136\">Alex J. Best</span> <a href=\"#narrow/stream/113489-new-members/topic/RBMap.20not.20looking.20up.20value/near/452906207\">said</a>:</p>\n<blockquote>\n<p>Your second example refers to <code>map</code> still and not <code>map'</code></p>\n</blockquote>\n<p>oops! behavior is as expected when i fix that.</p>",
        "id": 452906327,
        "sender_full_name": "Quinn",
        "timestamp": 1721513507
    },
    {
        "content": "<p>so redblack trees are predicated on the ordering of keys being LE, not LT, I'm surmising. didn't know that!</p>",
        "id": 452906586,
        "sender_full_name": "Quinn",
        "timestamp": 1721513719
    },
    {
        "content": "<p>I think assoclist is more appropriate for my usecase, so i'm refactoring</p>",
        "id": 452907222,
        "sender_full_name": "Quinn",
        "timestamp": 1721514144
    },
    {
        "content": "<p>Actually using <code>cmp</code> (the lt version) is probably better than <code>cmpLE</code>. The issue with your definition wasn't the difference between lt and le, rather that the definition you gave makes <code>a &lt; b</code> true for any pair <code>a,b</code> so its not a well behaved relation at all</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">RBMap</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"n\">cmp</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Map</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">RBMap</span><span class=\"bp\">.</span><span class=\"n\">ofList</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)]</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"bp\">.</span><span class=\"n\">find!</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>also workss</p>",
        "id": 452907645,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1721514359
    },
    {
        "content": "<p>oh. <code>fun _ _ =&gt; Ordering.lt</code> is just what got it to typecheck. I didn't know how to construct an <code>Ordering</code> type out of <code>fun a b =&gt; a &lt; b</code></p>",
        "id": 452909435,
        "sender_full_name": "Quinn",
        "timestamp": 1721515566
    },
    {
        "content": "<p>but this is in a mathlib-free project</p>",
        "id": 452909453,
        "sender_full_name": "Quinn",
        "timestamp": 1721515605
    },
    {
        "content": "<p>so <code>cmp</code> or <code>cmpLE</code> didn't work in live.lean-lang, since i wasn't importing anything mathlib</p>",
        "id": 452909461,
        "sender_full_name": "Quinn",
        "timestamp": 1721515632
    },
    {
        "content": "<p>what's going on with the part about how <code>find!</code> defaults to inhabited in lsp but panics at <code>lake exe</code>?</p>",
        "id": 452909563,
        "sender_full_name": "Quinn",
        "timestamp": 1721515776
    }
]