[
    {
        "content": "<p>i am attempting to iterate through and mutate a fixed-size array. i am encountering some issues, however. the following code fails to compile with <code>failed to synthesize: Decidable (prev = pixel)</code>. i don't quite understand what this means, though. does anyone have any tips on what could be causing this?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Batteries</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Batteries</span>\n\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">UInt6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">BitVec</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"n\">abbrev</span><span class=\"w\"> </span><span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">UInt8</span>\n\n<span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">Pixel</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Byte</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">seen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Vector</span><span class=\"w\"> </span><span class=\"n\">Pixel</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pixel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Pixel</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"n\">UInt6</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"mi\">64</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"c1\">-- failed to synthesize: Inhabited Pixel</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">seen</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"bp\">!</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">pixel</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">  </span><span class=\"n\">failure</span>\n</code></pre></div>\n<p>also, the <code>[]!</code> probably shouldn't be necessary, given that <code>[0:64]</code> is exclusive on the <code>64</code> and <code>Vector</code> has a fixed size <code>64</code>. it appears to be though. what is the cause of this? </p>\n<p>my guess would be that <code>Range</code> is not appropriately treating its elements as <code>Fin n</code>, but i am not quite sure. i have also tried to manually apply the <code>Membership.mem.upper</code> theorem, but it does not appear to prove what i was hoping it to. (i have yet to learn the theorem proving parts of lean, though.)</p>",
        "id": 465880769,
        "sender_full_name": "JJ",
        "timestamp": 1724898913
    },
    {
        "content": "<p>What is the definition of <code>Pixel</code>?</p>",
        "id": 465881104,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1724899134
    },
    {
        "content": "<p>whoops, sorry, updated</p>",
        "id": 465881279,
        "sender_full_name": "JJ",
        "timestamp": 1724899220
    },
    {
        "content": "<p>There is a <code>def finRange (n : â„•) : List (Fin n)</code> in <code>Mathlib.Data.List.Range</code>.<br>\nMaybe you can use that to get rid of <code>[]!</code>.</p>",
        "id": 465885102,
        "sender_full_name": "Alexander Hilbert",
        "timestamp": 1724901140
    },
    {
        "content": "<p>You should derive BEq and DecidableEq for Pixel</p>",
        "id": 465895273,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1724904399
    },
    {
        "content": "<p>thanks, that was it!</p>",
        "id": 465898714,
        "sender_full_name": "JJ",
        "timestamp": 1724905193
    },
    {
        "content": "<p>the <code>[]!</code> thing still confuses me a bit. i did play around some, and found <code>[]</code> works fine for a <code>Fin 64</code> (which makes sense). so, i guess lean's iterators on ranges are not treating their elements as being <code>Fin n</code>, despite them being evidently so?</p>",
        "id": 465899205,
        "sender_full_name": "JJ",
        "timestamp": 1724905300
    },
    {
        "content": "<p>re: derivations, i also had to derive <code>Inhabited</code>. that's a cool little tidbit for why it's needed on the documentation page. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Inhabited#doc\">docs#Inhabited</a></p>",
        "id": 465901694,
        "sender_full_name": "JJ",
        "timestamp": 1724905854
    }
]