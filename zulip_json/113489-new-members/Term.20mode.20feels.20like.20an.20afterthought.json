[
    {
        "content": "<p>I know I'm probably thinking about it wrong (because in a way, terms are <em>more</em> fundamental) but whenever I'm in term mode, I feel like I'm fighting with the tool.</p>\n<p>For example, say I got this:</p>\n<p><a href=\"/user_uploads/3121/L0OZyee4P9JHQ5vFTQo05E77/Screenshot-2025-07-23-at-02.08.16.png\">Screenshot 2025-07-23 at 02.08.16.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/L0OZyee4P9JHQ5vFTQo05E77/Screenshot-2025-07-23-at-02.08.16.png\" title=\"Screenshot 2025-07-23 at 02.08.16.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2120x458\" src=\"/user_uploads/thumbnail/3121/L0OZyee4P9JHQ5vFTQo05E77/Screenshot-2025-07-23-at-02.08.16.png/840x560.webp\"></a></div><p>I need to unfold <code>FunctionalRels</code> at <code>F</code> to see \"what it is\" (what I'm given as its properties). But I can't <code>unfold</code> because <code>unfold</code> is a tactic mode thing.</p>\n<p>Okay, I switch to tactic mode temporarily so that I can use <code>unfold</code> and peek at the definition in my InfoView:</p>\n<p><a href=\"/user_uploads/3121/iqWasXPyP7iUGq7sggnXvxCv/Screenshot-2025-07-23-at-02.09.22.png\">Screenshot 2025-07-23 at 02.09.22.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/iqWasXPyP7iUGq7sggnXvxCv/Screenshot-2025-07-23-at-02.09.22.png\" title=\"Screenshot 2025-07-23 at 02.09.22.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2744x418\" src=\"/user_uploads/thumbnail/3121/iqWasXPyP7iUGq7sggnXvxCv/Screenshot-2025-07-23-at-02.09.22.png/840x560.webp\"></a></div><p>Ah, okay, that gives me an idea, I can unpack <code>F</code>:</p>\n<p><a href=\"/user_uploads/3121/aZgYIYpUnNE8lxeO-tOsAygF/Screenshot-2025-07-23-at-02.10.32.png\">Screenshot 2025-07-23 at 02.10.32.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/aZgYIYpUnNE8lxeO-tOsAygF/Screenshot-2025-07-23-at-02.10.32.png\" title=\"Screenshot 2025-07-23 at 02.10.32.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2746x488\" src=\"/user_uploads/thumbnail/3121/aZgYIYpUnNE8lxeO-tOsAygF/Screenshot-2025-07-23-at-02.10.32.png/840x560.webp\"></a></div><p>But wait, I wanted to write this thing in term mode, I'm not proving anything after all. Let me switch back to term mode:</p>\n<p><a href=\"/user_uploads/3121/7YLqsC2XZgGh3rpJD3XofVuZ/Screenshot-2025-07-23-at-02.11.06.png\">Screenshot 2025-07-23 at 02.11.06.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/7YLqsC2XZgGh3rpJD3XofVuZ/Screenshot-2025-07-23-at-02.11.06.png\" title=\"Screenshot 2025-07-23 at 02.11.06.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2054x318\" src=\"/user_uploads/thumbnail/3121/7YLqsC2XZgGh3rpJD3XofVuZ/Screenshot-2025-07-23-at-02.11.06.png/840x560.webp\"></a></div><p>Right, I guess <code>unfold</code> isn't a thing, and <code>obtain</code> isn't a thing either. Let me fix that.</p>\n<p><a href=\"/user_uploads/3121/MXTiBmNsEea2bXlMOhJcFVNW/Screenshot-2025-07-23-at-02.11.35.png\">Screenshot 2025-07-23 at 02.11.35.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/MXTiBmNsEea2bXlMOhJcFVNW/Screenshot-2025-07-23-at-02.11.35.png\" title=\"Screenshot 2025-07-23 at 02.11.35.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2068x288\" src=\"/user_uploads/thumbnail/3121/MXTiBmNsEea2bXlMOhJcFVNW/Screenshot-2025-07-23-at-02.11.35.png/840x560.webp\"></a></div><p>Uhhh... So where's my <code>p</code>, <code>hp1</code>, and <code>hp2</code>? They're not showing up in InfoView at all!</p>\n<p>Let me add another variable:</p>\n<p><a href=\"/user_uploads/3121/abssnIF35R_PVQdpu9d-FPNy/Screenshot-2025-07-23-at-02.12.29.png\">Screenshot 2025-07-23 at 02.12.29.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/abssnIF35R_PVQdpu9d-FPNy/Screenshot-2025-07-23-at-02.12.29.png\" title=\"Screenshot 2025-07-23 at 02.12.29.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"2346x506\" src=\"/user_uploads/thumbnail/3121/abssnIF35R_PVQdpu9d-FPNy/Screenshot-2025-07-23-at-02.12.29.png/840x560.webp\"></a></div><p>Great, <em>now</em> they're showing up. So I always have to add \"one more variable\" and put the cursor at the line below just to make InfoView work in the term mode. In other words, in term mode, InfoView just casually disregards the last <code>let</code> before the <code>sorry</code>, whatever it is.</p>\n<p>This workflow just doesn't feel very productive. Both in terms of inability to unfold, and in terms of InfoView being broken. And then you also have to remember that only a subset of tools I'm used to work there (<code>let</code> is cool, but <code>obtain</code> is not, etc).</p>\n<p>All in all this just makes me always switch to tactic mode so that I don't have to deal with limited and/or broken tooling. Is that what other people do, too? Or do people switch back and forth all the time, reformatting it in term mode at the end? Or do people tolerate the brokenness of InfoView and lack of features in term mode? Or is term mode only used for simple things where you already know what you're planning to write?</p>\n<p>I just feel like I'm using it wrong and I'm surprised that the workflow feels subpar compared to tactic mode. It feels like term mode is an afterthought but surely it can't be?</p>",
        "id": 530247033,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753233434
    },
    {
        "content": "<p>I haven't finished reading the whole thing yet, but </p>\n<blockquote>\n<p>But wait, I wanted to write this thing in term mode, I'm not proving anything after all. Let me switch back to term mode:</p>\n</blockquote>\n<p>Here are a few things good to know</p>\n<ul>\n<li>It is fine to use tactic mode for non-proof def</li>\n<li>you can insert long terms in tactic mode in various places. The most basic one is <code>exact &lt;pretend you are back to term mode here&gt;</code>.</li>\n</ul>",
        "id": 530247505,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1753233851
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"418569\">@Dan Abramov</span></p>\n<ol>\n<li>you can convert to term mode after the whole tactic definition</li>\n<li>where you put your cursor matters a lot in term mode. My trick is to always insert underscores (<code>_</code>) so that the whole thing is grammatical (and I never use <code>sorry</code>), and you always put the cursor to the left of the underscore and look at the expected type</li>\n<li>and I hope you remember to destroy the <code>let</code> after the whole definition (by using projections instead) <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></li>\n</ol>",
        "id": 530247654,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234014
    },
    {
        "content": "<p>Dan, when in term mode, have you placed holes? <code>_</code> For the final goal.</p>",
        "id": 530247685,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753234028
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"bp\">_</span>\n<span class=\"c1\">--^ put cursor before</span>\n</code></pre></div>",
        "id": 530247722,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234056
    },
    {
        "content": "<blockquote>\n<p>It is fine to use tactic mode for non-proof def</p>\n</blockquote>\n<p>Acknowledged though I do feel a bit guilty doing that. The stylistic rule of thumb I'm imagining is to use tactic mode for proofs, and term mode for \"exact\" proofs or for function definitions. Maybe I should just let go of this and embrace tactic mode for everything?</p>\n<blockquote>\n<p>where you put your cursor matters a lot in term mode. My trick is to always insert underscores (<code>_</code>) so that the whole thing is grammatical (and I never use <code>sorry</code>), and you always put the cursor to the left of the underscore and look at the expected type</p>\n</blockquote>\n<p>Ok yea I can do that. It still seems like a bug that InfoView doesn't recognize <code>let</code> until next non-whitespace token but hopefully that gets fixed eventually. What surprised me more is that it almost feels like InfoView in term mode is neglected — I struggle to imagine a similar bug in tactic mode existing without driving people up the wall every day. So I suppose term mode is just used less?</p>\n<blockquote>\n<p>and I hope you remember to destroy the <code>let</code> after the whole definition (by using projections instead) <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>\n</blockquote>\n<p>Say more! :D I don't know what this means.</p>",
        "id": 530247987,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753234280
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"418569\">@Dan Abramov</span> it's not a bug, you should always put your cursor before an <code>_</code>, in some sense that's the only correct place to put your cursor</p>",
        "id": 530248055,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234338
    },
    {
        "content": "<p>to me what the infoview says at any other place is Undocumented Behaviour</p>",
        "id": 530248082,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234363
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"418569\">Dan Abramov</span> <a href=\"#narrow/channel/113489-new-members/topic/Term.20mode.20feels.20like.20an.20afterthought/near/530247987\">said</a>:</p>\n<blockquote>\n<p>Say more! :D I don't know what this means.</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n</code></pre></div>",
        "id": 530248125,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234412
    },
    {
        "content": "<p>the second is preferred over the first</p>",
        "id": 530248132,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234420
    },
    {
        "content": "<blockquote>\n<p>to me what the infoview says at any other place is Undocumented Behaviour</p>\n</blockquote>\n<p>Hmm I find that to be a very non-user-friendly stance. I think InfoView should show the same thing for these two positions:</p>\n<p><a href=\"/user_uploads/3121/LiTSPqpIPAVZ2FlGRLhUUfU1/Screenshot-2025-07-23-at-02.33.53.png\">Screenshot 2025-07-23 at 02.33.53.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/LiTSPqpIPAVZ2FlGRLhUUfU1/Screenshot-2025-07-23-at-02.33.53.png\" title=\"Screenshot 2025-07-23 at 02.33.53.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"748x268\" src=\"/user_uploads/thumbnail/3121/LiTSPqpIPAVZ2FlGRLhUUfU1/Screenshot-2025-07-23-at-02.33.53.png/840x560.webp\"></a></div><p><a href=\"/user_uploads/3121/WP5NBxFq9xvwKx4Olg7B543t/Screenshot-2025-07-23-at-02.34.02.png\">Screenshot 2025-07-23 at 02.34.02.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/WP5NBxFq9xvwKx4Olg7B543t/Screenshot-2025-07-23-at-02.34.02.png\" title=\"Screenshot 2025-07-23 at 02.34.02.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"746x292\" src=\"/user_uploads/thumbnail/3121/WP5NBxFq9xvwKx4Olg7B543t/Screenshot-2025-07-23-at-02.34.02.png/840x560.webp\"></a></div><p>But it doesn't.</p>",
        "id": 530248178,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753234474
    },
    {
        "content": "<blockquote>\n<p>the second is preferred over the first</p>\n</blockquote>\n<p>Ah, do you mean it's preferred to <em>extract</em> common projections as top-level functions?</p>",
        "id": 530248254,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753234562
    },
    {
        "content": "<blockquote>\n<p>Maybe I should just let go of this and embrace tactic mode for everything?</p>\n</blockquote>\n<p>As someone who is also not good at term mode, I switch to tactics whenever I feel drowned in terms, and then do a clean up after I finish building the proof/def to fold tactics into terms if I feel like it.</p>\n<p>Similar to having terms in tactic mode, you can also have small tactics partially in term mode, like <code>def foo := func x y (by ...) z</code>. When you are doing early drafting, feel free to interleave them whenever you feel like it</p>",
        "id": 530248270,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1753234577
    },
    {
        "content": "<p>OK makes sense so maybe tactic mode just offers a better workflow, and then during cleanup it might make sense to collapse the result into term mode for terseness and simplicity.</p>",
        "id": 530248341,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753234639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Term.20mode.20feels.20like.20an.20afterthought/near/530248125\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"418569\">Dan Abramov</span> <a href=\"#narrow/channel/113489-new-members/topic/Term.20mode.20feels.20like.20an.20afterthought/near/530247987\">said</a>:</p>\n<blockquote>\n<p>Say more! :D I don't know what this means.</p>\n</blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I'm not sure that's true anymore. It was true in Lean3, but in Lean4, we have defeq eta expansion, and the two are the same.</p>",
        "id": 530248450,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753234729
    },
    {
        "content": "<p>there is also another suboptimal point about your workflow: you shouldn't have to unfold anything, you should be able to click \"go to the definition\" and (very crucially!) the \"API\" should just be below the definition</p>\n<p>(API means the set of definitions and lemmas that allow you to use the definition in its intended way)</p>",
        "id": 530248524,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234795
    },
    {
        "content": "<p>Although I guess <code>#print foo</code> has the naked <code>match</code> in the term.</p>",
        "id": 530248525,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753234795
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/113489-new-members/topic/Term.20mode.20feels.20like.20an.20afterthought/near/530248450\">said</a>:</p>\n<blockquote>\n<p>and the two are the same.</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foo</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">bar'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">foo'</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 530248621,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753234911
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">fst</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">foo'</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 530248907,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753235183
    },
    {
        "content": "<p>yes, but <code>rw</code> doesn't work up to <code>rfl</code> <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 530248959,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1753235217
    },
    {
        "content": "<blockquote>\n<p>there is also another suboptimal point about your workflow: you shouldn't have to unfold anything, you should be able to click \"go to the definition\" and (very crucially!) the \"API\" should just be below the definition</p>\n</blockquote>\n<p>Well, the problem is that by the time I navigate to definition, I've forgotten the context of what I was trying to do. I literally <em>rely</em> on InfoView to think. Maybe that's part of the problem but my mental faculties are limited and I try not to waste them on what tooling can do for me.</p>",
        "id": 530249280,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753235479
    },
    {
        "content": "<p>With terms, I think it's important to remember that now it's Just Programming and you need to be doing whatever you normally do to write good programs. Relying too much on unfolding types makes programming difficult to follow — maybe <code>FunctionalRels.Elem</code> is missing some helper functions?</p>",
        "id": 530253325,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753239114
    },
    {
        "content": "<p>Lean term trick: if you want to drop back into tactics to do some exploration midway through some terms, you can insert a line like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>",
        "id": 530253615,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753239322
    },
    {
        "content": "<p>Ok so maybe a good workflow is</p>\n<ul>\n<li>Use tactic mode for exploration</li>\n<li>Extract chunks of exploration into helper lemmas and projections</li>\n<li>See if the rest becomes simple enough for term mode</li>\n</ul>",
        "id": 530254351,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753239871
    },
    {
        "content": "<p>(It would be neat if the Infoview had some exploratory mode where you could unfold things and do various other reductions step-by-step!)</p>",
        "id": 530254438,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1753239938
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"418569\">@Dan Abramov</span> Fwiw, there is also the <code>show_term {more tactics go here}</code> tactic, that show you the term that a tactic constructs.</p>",
        "id": 530274042,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1753254029
    },
    {
        "content": "<p>Broadly speaking, is <code>unfold</code> an anti-pattern outside exploration phase? Should I be creating lemmas to avoid unfolding definitions?</p>",
        "id": 530360816,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753281115
    },
    {
        "content": "<p>Yes, using <code>unfold</code> is peeking at implementation details anywhere that does it, and writing lemmas is like instead declaring some public API and then using that, even if it just delegates to the same implementation details by saying the proof is <code>rfl</code> or whatever. (But then later if those change, nothing breaks as long as the public API all stayed the same)</p>",
        "id": 530364235,
        "sender_full_name": "Julian Berman",
        "timestamp": 1753281904
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"418569\">Dan Abramov</span> <a href=\"#narrow/channel/113489-new-members/topic/Term.20mode.20feels.20like.20an.20afterthought/near/530360816\">said</a>:</p>\n<blockquote>\n<p>Broadly speaking, is <code>unfold</code> an anti-pattern outside exploration phase?</p>\n</blockquote>\n<p>Think more broadly: you don't just use <code>unfold</code>, you also do some simplifications to unfolded expressions. Since you have to derive intermediate results anyway, why not move them into separate lemmas? This also would make proofs less sensitive to implementation details.</p>",
        "id": 530365293,
        "sender_full_name": "suhr",
        "timestamp": 1753282186
    },
    {
        "content": "<p>Regarding the \"Expected type is not helpful on whitespace\" issue: I think this is partly due to the fact that the expected type <code>TermInfo</code> selection is using the same logic as the one for hovers, and not much thought has been given to what should be done in whitespace. Without having looked into it too deeply, in:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">  </span><span class=\"c1\">-- &lt;cursor&gt;</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>it seems to pick the one for <code>let b := 2; sorry</code> (since that one includes the cursor in its range), which obviously doesn't have <code>b</code> in its context yet.<br>\nThe tactic goal states work very differently.</p>\n<p>This probably doesn't get noticed that much by most users because they have been trained to work with <code>_</code> since the Lean 3 days.</p>\n<p><span class=\"user-mention\" data-user-id=\"418569\">@Dan Abramov</span> could you create a bug report for this in the Lean 4 repo? I don't think this has a quick fix.</p>",
        "id": 530377582,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1753285284
    },
    {
        "content": "<p>Thanks, filed <a href=\"https://github.com/leanprover/lean4/issues/9492\">https://github.com/leanprover/lean4/issues/9492</a></p>",
        "id": 530408979,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753295361
    },
    {
        "content": "<p>Fascinating, I've started reworking a proof I was completely stuck on while trying to follow these guidelines (no <code>unfold</code>ing) and it completely changed my process. It's forced me to rethink the building pieces (and make some abstractions explicit), and the value of that was higher than I expected.</p>\n<p>In programming, extracting things is usually much lower value (I tend to avoid extracting pieces until I'm <em>sure</em> I need to reuse them). But here something is different.</p>",
        "id": 530419631,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753299325
    },
    {
        "content": "<p>I'm guessing in programming the abstraction boundaries are harder to pierce by default so you're kind of forced to deal with them anyway. Whereas Lean is more lax about it which is handy in some ways but led me to rely on it too much.</p>",
        "id": 530420181,
        "sender_full_name": "Dan Abramov",
        "timestamp": 1753299548
    }
]