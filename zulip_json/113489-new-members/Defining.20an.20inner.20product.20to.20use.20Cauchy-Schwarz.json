[
    {
        "content": "<p>I'd like to define a semi-inner product (positive semidefinite sesquilinear form) so that I can use the Cauchy-Schwarz inequality, but I can't figure out how to construct an inner product/inner product space in a way that lets me do that.</p>\n<p>I was able to define my inner product function to have type <code>A ‚Üí‚Çó‚ãÜ[‚ÑÇ] A ‚Üí‚Çó[‚ÑÇ] ‚ÑÇ</code>, so that it is conjugate-linear in the first term and linear in the second, which I thought would be what I needed based on what I saw about <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/CStarAlgebra/Module/Defs.html\">CStarModules</a>, hoping to maybe use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/CStarAlgebra/Module/Defs.html#CStarModule.norm_inner_le\">CStarModule.norm_inner_le</a>.</p>\n<p>But, I couldn't figure out how to make that work, so I tried defining a <code>PreInnerProductSpace</code>, but I still couldn't figure out how that would allow me to use <code>inner_mul_inner_self_le</code>.</p>\n<p>I think I faced the same problem with both approaches, which was that I couldn't figure out how to ensure that <code>inner</code> was the function I defined. Specifically, when I try to use <code>InnerProductSpace.Core.inner_mul_inner_self_le</code>, it seems like it can't figure out that it's a complex inner product, which implies it is not referring to the inner product I defined.</p>\n<p>Can somebody help me figure out how to use the Cauchy-Schwarz inequality on the semi-inner product I defined?</p>\n<p>Here is my code so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">CStarAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Classes</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">PositiveLinearMap</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- A ‚Üí A ‚Üí ‚ÑÇ</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"c1\">-- A ‚Üí ‚ÑÇ</span>\n<span class=\"c1\">-- parameter a should be linear</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myInnerHelper</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"c1\">-- A ‚Üí ‚ÑÇ</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myInner</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">map_add</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myInner</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">RingHom</span><span class=\"bp\">.</span><span class=\"n\">id</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInnerHelper</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"c1\">-- A ‚Üí‚Çó[‚ÑÇ] ‚ÑÇ</span>\n<span class=\"c1\">-- paramter b should be conjugate linear</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mySesquiLinear</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starRingEnd</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInnerHelper</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_add'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myInnerHelper</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">star_add</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">map_add</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_smul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">myInnerHelper</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"o\">]</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">mySesquiLinear</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"c1\">-- A ‚Üí‚Çó‚ãÜ[‚ÑÇ] A ‚Üí‚Çó[‚ÑÇ] ‚ÑÇ</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreInnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">re_inner_nonneg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">conj_inner_symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">add_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">smul_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_mul_inner_self_le</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"c1\">-- has type:</span>\n<span class=\"c1\">-- ‚Äñinner ?m.8 p q‚Äñ * ‚Äñinner ?m.8 q p‚Äñ</span>\n<span class=\"c1\">-- ‚â§ RCLike.re (inner ?m.8 p p) * RCLike.re (inner ?m.8 q q)</span>\n</code></pre></div>",
        "id": 539172429,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757716303
    },
    {
        "content": "<p>how is Lean supposed to guess what <code>f</code> is?</p>",
        "id": 539172663,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757716461
    },
    {
        "content": "<p><code>f</code> is just an arbitrary positive linear functional. I won't need to evaluate it. Ideally, I would just like to be able to <code>dsimp</code> <code>inner ‚ÑÇ b a</code> to <code>f (star b * a)</code></p>",
        "id": 539173014,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757716667
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"939215\">@Gregory Wickham</span> yes, but i'm saying that when you write <code>inner</code>, there is no way that Lean can figure out what <code>f</code> is</p>",
        "id": 539173179,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757716752
    },
    {
        "content": "<p>i.e. you have a bad instance</p>",
        "id": 539173187,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757716757
    },
    {
        "content": "<p>Why does it need to know what <code>f</code>is (beyond knowing that it's a positive linear functional)? And how can I fix that?</p>",
        "id": 539173361,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757716872
    },
    {
        "content": "<p>Maybe it helps to realize that <code>myInnerProductSpace </code> is defined for all possible <code>f</code>; hover over if and you'll see it's a function from <code>f</code></p>",
        "id": 539174173,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757717403
    },
    {
        "content": "<p>So then when I write <code>myInnerProductSpace f</code>, it has type <code>PreInnerProductSpace.Core ‚ÑÇ A</code>, which I think is what I want. So then I think my question is how do I use <code>inner_mul_inner_self_le</code> so that it knows that the <code>inner</code> I'm referring to is specifically <code>(myInnerProductSpace f).inner</code>.</p>\n<p>Because if I try to <code>#check InnerProductSpace.Core.inner_mul_inner_self_le p q</code>, it says <code>failed to synthesize  PreInnerProductSpace.Core ?m.8</code>. How can I tell it to synthesize <code>myInnerProductSpace f</code> when it looks like it can't take that as an explicit parameter?</p>",
        "id": 539175353,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757718093
    },
    {
        "content": "<p>it's a bad instance, you shouldn't use it</p>",
        "id": 539176970,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757719169
    },
    {
        "content": "<p>Can you explain how I can tell it's a \"bad instance\"? I'm still pretty new to Lean.</p>\n<p>And then how do I construct an inner product whose definition depends on some fixed linear functional? Because this isn't the only time I'll need to do that.</p>",
        "id": 539177589,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757719591
    },
    {
        "content": "<p>This works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_mul_inner_self_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span>\n</code></pre></div>",
        "id": 539178278,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757720062
    },
    {
        "content": "<p>To refine what Kenny said, it's a bad <code>instance</code>, so you should make it an <code>abbrev</code> instead</p>",
        "id": 539178304,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757720084
    },
    {
        "content": "<p>Note that Lean also doesn't know in your original whether it's looking for a real or complex inner product</p>",
        "id": 539178419,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757720156
    },
    {
        "content": "<p>For what it's worth, you can drop most of your code by using</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mySesquilinear</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó‚ãÜ</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starLinearEquiv</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó‚ãÜ</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">compr‚ÇÇ‚Çõ‚Çó</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mySesquilinear_apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mySesquilinear</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>(the <code>noncomputable</code> is a bug, fixed by <a href=\"https://github.com/leanprover-community/mathlib4/pull/29608\">#29608</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/29609\">#29609</a>)</p>",
        "id": 539179544,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757720998
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939215\">Gregory Wickham</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539177589\">said</a>:</p>\n<blockquote>\n<p>how I can tell it's a \"bad instance\"?</p>\n</blockquote>\n<p>because it depends on some <code>f</code> that cannot be inferred (i.e. Lean has no way of guessing the f)</p>",
        "id": 539179782,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757721134
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939215\">Gregory Wickham</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539177589\">said</a>:</p>\n<blockquote>\n<p>how do I construct an inner product whose definition depends on some fixed linear functional</p>\n</blockquote>\n<p>you either locally make it an instance like eric suggested (where \"locally\" really means you need to do it in every statement and every proof),<br>\nor you can define a type synonym <code>WithFunctional A f</code> of <code>A</code> so that <code>f</code> is baked into the type</p>",
        "id": 539179887,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757721197
    },
    {
        "content": "<p>that means, <code>def WithFunctional (A : ..) (f : ..) := A</code></p>",
        "id": 539179910,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757721210
    },
    {
        "content": "<p>and then make <code>instance : InnerProductSpace (WithFunctional A f)</code></p>",
        "id": 539179957,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1757721236
    },
    {
        "content": "<p>Kenny, my reading of the problem was that this was a temporary instance just to get a Cauchy-Schwarz result</p>",
        "id": 539180658,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757721683
    },
    {
        "content": "<p>So while what you describe is true for instances you plan to use across multiple theorems, it seem overkill here</p>",
        "id": 539180703,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1757721707
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939215\">Gregory Wickham</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539177589\">said</a>:</p>\n<blockquote>\n<p>Can you explain how I can tell it's a \"bad instance\"? I'm still pretty new to Lean.</p>\n</blockquote>\n<p>For what it's worth, I had to read <a href=\"https://leanprover.github.io/theorem_proving_in_lean4/\">#tpil</a> three times and do several Lean projects before I got the hang of instances (a.k.a. the square bracket system). Behind the scenes there is a computer program filling in all of the theorems of the form \"a field is an additive abelian group\" (which you need every time you e.g. use that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a+b=b+a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> for a field) and this program works in a certain way, which you pick up over time. The key thing to understand is that this program cannot do everything which is obvious to a human, it can only do what it's been programmed to do, there are certain facts that it can use and other facts that it can't use. What Kenny means is that the program that's dealing with all the square bracket stuff doesn't have access to f, but this is not at all obvious, this only becomes obvious when you have a feeling for how the program does what it does.</p>",
        "id": 539181887,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1757722379
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539178278\">said</a>:</p>\n<blockquote>\n<p>This works:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_mul_inner_self_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">q</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>How does this force the theorem to identify the correct InnerProductSpace? Is the point that it puts a PreInnerProductSpace into the context so that the theorem can infer it? Is there no more specific way to make sure it identifies the correct PreInnerProductSpace, like if there might be more than one in the context?</p>\n<p>It seems like I can use that method to get a specific statement of the theorem into the context, like here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">norm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mip</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">cs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_mul_inner_self_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>but then I can't seem to simp, dsimp, or rw <code>inner</code> to the definition I gave it when defining <code>myInnerProductSpace</code>. Is there any way to still simplify to the specific, definition of inner for a particular space?</p>",
        "id": 539362739,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757798655
    },
    {
        "content": "<p>So presumably you are trying to do GNS, right? You'll want to make a type synonym as Kenny suggested.</p>",
        "id": 539366362,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757803292
    },
    {
        "content": "<p>Yes, I'm trying to do GNS. What is a type synonym and how does it help here? Is there somewhere I can read about how those work? Because I cannot figure out how I'm supposed to use that.</p>",
        "id": 539370565,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757808996
    },
    {
        "content": "<p>Specifically because a definition like this:<br>\n<span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539179910\">said</a>:</p>\n<blockquote>\n<p>that means, <code>def WithFunctional (A : ..) (f : ..) := A</code></p>\n</blockquote>\n<p>would seem to erase information when passed to some constructor. I could understand maybe defining a new type/structure that contains a functional alongside a C*-algebra and maybe just separately referring to its components as necessary, but the approach you're suggesting seems very different from that.</p>",
        "id": 539370684,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757809131
    },
    {
        "content": "<p>No, that's <em>exactly</em> what this is doing. Now for every C‚ãÜ-algebra <code>A</code> and every functional <code>f</code>, we have a new type <code>WithFunctional A f</code> which is a copy of <code>A</code>, except this new type doesn't have an <code>instance</code>s on it. So we can equip it with new ones (e.g., a new norm).</p>",
        "id": 539370762,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809251
    },
    {
        "content": "<p>This is important because having an <code>InnerProductSpace</code> means that you must have a norm that agrees with the inner product. You can't do this on <code>A</code> itself (because it already has a norm), but you <em>can</em> do it on the type <code>WithFunctional A f</code>.</p>",
        "id": 539370828,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809328
    },
    {
        "content": "<p>(when I say \"can't\", I mean, technically you <em>can</em> but you will make Lean, and consequently yourself, misrable by doing so)</p>",
        "id": 539370861,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809385
    },
    {
        "content": "<p>You can see, for example, how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WithLp#doc\">docs#WithLp</a> defines a type synonym for a new type but equips it with the Lp norm. For example, <code>‚Ñù √ó ‚Ñù</code> has the max norm in Lean, but <code>WithLp p (‚Ñù √ó ‚Ñù)</code> has the p-norm.</p>",
        "id": 539370994,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809566
    },
    {
        "content": "<p>If we tried to put the p-norm on <code>‚Ñù √ó ‚Ñù</code> directly, then Lean would never be able to know which norm to choose for <code>‚Äñx‚Äñ</code> for <code>x : ‚Ñù √ó ‚Ñù</code> (because there's no reference to <code>p</code>; this is what Kenny said above when he mentioned your instance was a \"bad instance\"). But if you have <code>x : WithLp p (‚Ñù √ó ‚Ñù)</code>, then Lean knows that <code>‚Äñx‚Äñ</code> is p-norm (because <code>p</code> is encoded in the type, and we've equipped this type with the p-norm).</p>",
        "id": 539371116,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809745
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"477483\">@Monica Omar</span> may be working on GNS though.</p>",
        "id": 539371185,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757809850
    },
    {
        "content": "<p>So is this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)]</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreInnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">re_inner_nonneg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">conj_inner_symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">add_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">smul_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>the right set up to start using this \"type synonym\"? Because then the next thing I have to do is re-work my inner product function to have type <code>WithFunctional A f ‚Üí WithFunctional A f ‚Üí ‚ÑÇ</code>, but when I try do that, I'm told \"synthesized type class instance is not definitionally equal to expression inferred by typing rules\".</p>\n<p>I'll also try to look the examples you've shared to see if I can figure it out.</p>",
        "id": 539371577,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757810400
    },
    {
        "content": "<p>No, your <code>variable</code> line means \"put an arbitrary C‚ãÜ-algebra and partial order instance on this type\".</p>",
        "id": 539371616,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757810459
    },
    {
        "content": "<p>You don't want <code>WithFunction A f</code> to have a C‚ãÜ-algebra instance at all, ever, because it's going to be the space for the representation. So, you'll need to set up some basic things, like construct an equivalence (trivial) between <code>A</code> and <code>WithFunctional A f</code>, and then use this to pull back the vector space structure from <code>A</code> to <code>WithFunctional A f</code>. And after that you can construct your instance.</p>",
        "id": 539371717,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1757810609
    },
    {
        "content": "<p>I did my best to adapt the code you referenced to this situation, but it seems like I ended up exactly where I started. I still can't seem to make an instance of <code>PreInnerProductSpace.Core</code>, and even my definition of my inner product is quesitonable. And I definitely can't adapt Eric Wieser's definition for the inner product function.</p>\n<p>Am I even remotely on the right track? Or do I need to do something else entirely?</p>\n<p>This is my code so far:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">CStarAlgebra</span><span class=\"bp\">.</span><span class=\"n\">Classes</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Module</span><span class=\"bp\">.</span><span class=\"n\">PositiveLinearMap</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CStarAlgebra</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">A</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span>\n\n<span class=\"sd\">/-- The canonical inclusion of `A` into `WithFunctional A f`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">toFunctional</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"sd\">/-- The canonical inclusion of `WithFunctional A f` into `A`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">ofFunctional</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"sd\">/-- `WithFunctional.toFunctional` and `WithFunctional.toFunctional` as an equivalence. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">equiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ofFunctional</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">invFun</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">toFunctional</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">left_inv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">right_inv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instAddCommGroup</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äπ</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">‚Ä∫</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instNonUnitalNonAssocSemiring</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NonUnitalNonAssocSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">NonUnitalNonAssocSemiring</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äπ</span><span class=\"n\">NonUnitalNonAssocSemiring</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">‚Ä∫</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">instModule</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">‚Äπ</span><span class=\"n\">Module</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">‚Ä∫</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">-- Some other properties I could specify:</span>\n<span class=\"cm\">instance instStarAddMonoid [StarAddMonoid A] : StarAddMonoid (WithFunctional A f) :=</span>\n<span class=\"cm\"> ‚ÄπStarAddMonoid A‚Ä∫</span>\n<span class=\"cm\">instance instAddCommMonoid [AddCommMonoid (StarAddMonoid A)] :</span>\n<span class=\"cm\">  AddCommMonoid (StarAddMonoid (WithFunctional A f)) :=</span>\n<span class=\"cm\"> ‚ÄπAddCommMonoid (StarAddMonoid A)‚Ä∫</span>\n<span class=\"cm\"> variable [PartialOrder (WithFunctional A f)]</span>\n<span class=\"cm\">instance instStarAddMonoidFunctional [StarAddMonoid (A ‚Üí‚Çó‚ãÜ[‚ÑÇ] A)] :</span>\n<span class=\"cm\">  StarAddMonoid (WithFunctional A f ‚Üí‚Çó‚ãÜ[‚ÑÇ] WithFunctional A f) :=</span>\n<span class=\"cm\">  ‚ÄπStarAddMonoid (A ‚Üí‚Çó‚ãÜ[‚ÑÇ] A)‚Ä∫</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">star</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreInnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">myInner</span><span class=\"w\"> </span><span class=\"n\">f</span>\n<span class=\"w\">  </span><span class=\"n\">re_inner_nonneg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">conj_inner_symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">add_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">smul_left</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_self_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"c1\">-- can't find the instance</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">WithFunctional</span>\n</code></pre></div>",
        "id": 539381291,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1757825505
    },
    {
        "content": "<p>It's not that it can't find the instance, if you look at the error it says that it expected a function...<br>\n<code>inner_self_nonneg</code> is a function that takes in <code>{x : F}</code> and outputs <code>0 ‚â§ inner _ x x</code>. Changing this to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"bp\">.</span><span class=\"n\">inner_self_nonneg</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>will show you that it's working okay.</p>",
        "id": 539411585,
        "sender_full_name": "Monica Omar",
        "timestamp": 1757859610
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"939215\">Gregory Wickham</span> <a href=\"#narrow/channel/113489-new-members/topic/Defining.20an.20inner.20product.20to.20use.20Cauchy-Schwarz/near/539381291\">said</a>:</p>\n<blockquote>\n<p>And I definitely can't adapt Eric Wieser's definition for the inner product function.</p>\n</blockquote>\n<p>I think what Eric was saying is that instead of proving addition and scalar multiplication, you can get them for free by defining it as a bi-semi-linear map:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mySesquilinear</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çö</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó‚ãÜ</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">starLinearEquiv</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">‚Üí‚Çó‚ãÜ</span><span class=\"o\">[</span><span class=\"n\">‚ÑÇ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">compr‚ÇÇ‚Çõ‚Çó</span><span class=\"w\"> </span><span class=\"n\">f</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">myInnerProductSpace</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PreInnerProductSpace</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithFunctional</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mySesquilinear</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">re_inner_nonneg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">conj_inner_symm</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">add_left</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">map_add‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">smul_left</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">LinearMap</span><span class=\"bp\">.</span><span class=\"n\">map_smul‚Çõ‚Çó‚ÇÇ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 539422923,
        "sender_full_name": "Monica Omar",
        "timestamp": 1757869258
    },
    {
        "content": "<p>Thank you for your help! This will also certainly be useful for other steps of GNS. <span class=\"user-mention\" data-user-id=\"477483\">@Monica Omar</span>  are you working on GNS too? If so, and if there's any way I could help, I would love to contribute. But also, I'm clearly very new to lean, and so working on it separately would still be an important learning experience for me, and I'll probably keep working on it either way.</p>",
        "id": 540535752,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1758317437
    },
    {
        "content": "<p>I am. And, yeah, sure. There's no better way to learn than by doing. I'll let you know when I get back on working on it :)</p>",
        "id": 540589889,
        "sender_full_name": "Monica Omar",
        "timestamp": 1758379030
    },
    {
        "content": "<p>Sounds good!</p>",
        "id": 540592623,
        "sender_full_name": "Gregory Wickham",
        "timestamp": 1758381747
    }
]