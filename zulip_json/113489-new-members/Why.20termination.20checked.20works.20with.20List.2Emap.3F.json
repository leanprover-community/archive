[
    {
        "content": "<p>I though I would have to use <code>List.attach</code> to make it work, but apparently termination checker already knows that with <code>List.map</code> arguments belong to the list. Where did termination checker got this from?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">inductive</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">leaf</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">children</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tree</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">leaf</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">node</span><span class=\"w\"> </span><span class=\"n\">children</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">children</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">sum</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">sum</span>\n<span class=\"n\">termination_by</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">t</span>\n<span class=\"n\">decreasing_by</span>\n<span class=\"w\">  </span><span class=\"n\">rename_i</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">guard_hyp</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">children</span>\n</code></pre></div>",
        "id": 564887191,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766314551
    },
    {
        "content": "<p>There is a new mechanism called wf_preprocess that is basically able to heuristically insert <code>List.attach</code> and similar functions on the fly</p>",
        "id": 564887230,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1766314618
    },
    {
        "content": "<p>Can you point me where in code is this defined? I want to know how to implement wf_preprocess for my own types.</p>",
        "id": 564887257,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766314662
    },
    {
        "content": "<p>nvm, I've found it<br>\n<a href=\"https://github.com/leanprover/lean4/blob/f317e28d842bad09a6111e1f72dda8a2c0bdc3c5/src/Init/Data/List/Attach.lean#L810-L817\">https://github.com/leanprover/lean4/blob/f317e28d842bad09a6111e1f72dda8a2c0bdc3c5/src/Init/Data/List/Attach.lean#L810-L817</a></p>",
        "id": 564887443,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766314932
    },
    {
        "content": "<p>Cool feature!</p>",
        "id": 564887446,
        "sender_full_name": "Jakub Nowak",
        "timestamp": 1766314939
    }
]