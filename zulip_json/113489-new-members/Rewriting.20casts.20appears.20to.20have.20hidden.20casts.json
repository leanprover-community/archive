[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">nth_rw</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">cast_ofNat</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>This gives the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>Tactic `rewrite` failed: motive is not type correct:\n  fun _a ↦ 2 + 3 + 4 + 5 = 9\nError: Application type mismatch: The argument\n  Nat.instNeZeroSucc\nhas type\n  NeZero (0 + 1)\nbut is expected to have type\n  NeZero _a\nin the application\n  @Nat.instAtLeastTwoHAddOfNat _a Nat.instNeZeroSucc\n</code></pre></div>\n<p>To rewrite the nth number in the theorem I have to use <code>3n+1</code> in the <code>nth_rw</code>. Why is that?<br>\nIt looks like there are some hidden numbers inside, can I reveal them somehow?<br>\nThis doesn't happen for <code>ℚ</code>, so I thought maybe something in <code>ofNat</code> for reals contains more numbers, but <code>Real.ofCauchy</code> doesn't seem to have any extra numbers in its definition.</p>",
        "id": 540537027,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758318405
    },
    {
        "content": "<p>we have <a href=\"https://tqft.net/mathlib4files/Tactic/DepRewrite\">file#Tactic/DepRewrite</a> now</p>",
        "id": 540537277,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758318602
    },
    {
        "content": "<p>though <code>rw!</code> is a bit broken so I would stick to <code>rewrite!</code></p>",
        "id": 540537317,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758318625
    },
    {
        "content": "<p>other options include <code>simp_rw</code>, <code>simp only</code>, and <code>conv</code></p>",
        "id": 540537338,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758318639
    },
    {
        "content": "<p>Wait what, <code>rw</code> isn't an alias of <code>rewrite</code>?</p>",
        "id": 540537366,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758318660
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/Rewriting.20casts.20appears.20to.20have.20hidden.20casts/near/540537027\">said</a>:</p>\n<blockquote>\n<p>To rewrite the nth number in the theorem I have to use <code>3n+1</code> in the <code>nth_rw</code>. Why is that?<br>\nIt looks like there are some hidden numbers inside, can I reveal them somehow?</p>\n</blockquote>\n<p>It's the implicit arguments, try <code>set_option pp.explicit true</code></p>",
        "id": 540537398,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758318688
    },
    {
        "content": "<p><code>rw</code> is <code>rewrite</code> + <code>try with_reducible rfl</code></p>",
        "id": 540537399,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318688
    },
    {
        "content": "<p>Yeah, compare:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"sd\">/--</span>\n<span class=\"sd\">info: @OfNat.ofNat.{0} Real (nat_lit 2)</span>\n<span class=\"sd\">  (@instOfNatAtLeastTwo.{0} Real (nat_lit 2) Real.instNatCast</span>\n<span class=\"sd\">    (@Nat.instAtLeastTwoHAddOfNat (@OfNat.ofNat.{0} Nat (nat_lit 1) (instOfNatNat (nat_lit 1)))</span>\n<span class=\"sd\">      (@Nat.instNeZeroSucc (@OfNat.ofNat.{0} Nat (nat_lit 0) (instOfNatNat (nat_lit 0)))))) : Real</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- info: @OfNat.ofNat.{0} Rat (nat_lit 2) (@Rat.instOfNat (nat_lit 2)) : Rat -/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 540537434,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318719
    },
    {
        "content": "<p><code>Rat</code> has an explicit <code>OfNat</code> instance, <code>Real</code> doesn't</p>",
        "id": 540537452,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318734
    },
    {
        "content": "<p>So it derives it through <code>AtLeastTwo</code> and <code>NeZero</code></p>",
        "id": 540537484,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318765
    },
    {
        "content": "<p>That's also where the additional <code>ofNat</code>s are hidden</p>",
        "id": 540537510,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318783
    },
    {
        "content": "<p>So every real <code>n</code> contains <code>n-1</code> and <code>n-2</code>? Weird</p>",
        "id": 540537612,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758318873
    },
    {
        "content": "<p>Yeah... I would've hoped it would at least only be <code>n - 2</code>, but it seems like the priorities are messed up here</p>",
        "id": 540537691,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758318947
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir</span> <a href=\"#narrow/channel/113489-new-members/topic/Rewriting.20casts.20appears.20to.20have.20hidden.20casts/near/540537612\">said</a>:</p>\n<blockquote>\n<p>So every real <code>n</code> contains <code>n-1</code> and <code>n-2</code>? Weird</p>\n</blockquote>\n<p>yeah but there are reasons, there have also been discussions of changing it to something not so weird</p>",
        "id": 540537695,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758318951
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.instAtLeastTwoHAddOfNat#doc\">docs#Nat.instAtLeastTwoHAddOfNat</a> should at least have lower instance priority than <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.instAtLeastTwo#doc\">docs#Nat.instAtLeastTwo</a></p>",
        "id": 540537767,
        "sender_full_name": "Robin Arnez",
        "timestamp": 1758319009
    },
    {
        "content": "<p><code>pp.all</code> clears things up, thank you!</p>",
        "id": 540537817,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758319046
    }
]