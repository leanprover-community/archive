[
    {
        "content": "<p>I found that <code>decide</code> fail to prove the following theorem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fail</span>\n</code></pre></div>\n<p>I am using v4.14.0 of Mathlib. And this version has a tactic named <code>decide!</code>, which the newest version (the version that web editor uses) doesn't have. <code>decide!</code> solves this problem successfully.</p>\n<p>So what's the difference? And why <code>decide!</code> is deleted?</p>",
        "id": 487229284,
        "sender_full_name": "Yicheng Tao",
        "timestamp": 1733831515
    },
    {
        "content": "<p>I found <code>native_decide</code>. Seem to work in the example above. But what's the difference?</p>",
        "id": 487270463,
        "sender_full_name": "Yicheng Tao",
        "timestamp": 1733842906
    },
    {
        "content": "<p>as i understand it, <code>decide</code> (and i suspect <code>decide!</code> too) uses the kernels reduction powers, while <code>native_decide</code> uses the native reduction powers of the compiler (which you may or may not trust).</p>",
        "id": 487271296,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733843106
    },
    {
        "content": "<p>It seems <code>decide</code> in 4.15.0-rc1 has changed a lot. <code>decide!</code> may be equivalent with <code>deicde +kernel</code>.</p>",
        "id": 487280443,
        "sender_full_name": "Yicheng Tao",
        "timestamp": 1733845137
    },
    {
        "content": "<p>Yes, it's become <code>decide +kernel</code>.</p>",
        "id": 487287201,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733846533
    },
    {
        "content": "<p>The idea is that it skips straight to the kernel type checker, which doesn't know anything about concepts like transparency and irreducibility.</p>",
        "id": 487287644,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733846642
    },
    {
        "content": "<p>Maybe it's like scrying tea leaves, but the error message to <code>decide</code> suggests that <code>Nat.primeFactorsList</code> could be responsible for the reduction failure. Indeed, it's defined using <code>decreasing_by</code>, meaning it's defined using well-founded recursion, and a few releases ago definitions by well-founded recursion became irreducible. To work around this on a case-by-case basis, at the same time the language provided the <code>unseal</code> command to temporarily make such definitions semireducible (the default).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactorsList</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">primeFactors</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span>\n</code></pre></div>",
        "id": 487289802,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733847219
    },
    {
        "content": "<p>Cool. I remember that prove Irrational (sqrt 2) can also use decide and needs to unseal Nat.sort.iter.</p>",
        "id": 487299967,
        "sender_full_name": "Yicheng Tao",
        "timestamp": 1733849934
    }
]