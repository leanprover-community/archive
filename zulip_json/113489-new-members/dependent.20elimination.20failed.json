[
    {
        "content": "<p>I'm defining a new function to erase all occurences of an element in a list. Why does it not work with a <code>DecidableEq</code> instance?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">::</span><span class=\"n\">as</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\">  </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">false</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>\n<p>error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">dependent</span><span class=\"w\"> </span><span class=\"n\">elimination</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">mismatch</span><span class=\"w\"> </span><span class=\"n\">when</span><span class=\"w\"> </span><span class=\"n\">solving</span><span class=\"w\"> </span><span class=\"n\">alternative</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"o\">)</span>\n<span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">expected</span>\n<span class=\"w\">  </span><span class=\"n\">motive</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">✝</span>\n</code></pre></div>",
        "id": 445511833,
        "sender_full_name": "Vivek Rajesh Joshi",
        "timestamp": 1718776205
    },
    {
        "content": "<p>Try using <code>==</code> instead of <code>=</code> (<code>=</code> is Prop-valued, while <code>==</code> is Bool-valued)</p>",
        "id": 445512324,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1718776530
    },
    {
        "content": "<p>It works, but what goes wrong with the Prop-valued <code>=</code>?</p>",
        "id": 445512496,
        "sender_full_name": "Vivek Rajesh Joshi",
        "timestamp": 1718776648
    },
    {
        "content": "<p>It's not an inductive type with two constructors 'false' and 'true'.</p>",
        "id": 445512597,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1718776700
    },
    {
        "content": "<p>Ahh okay, got it</p>",
        "id": 445512624,
        "sender_full_name": "Vivek Rajesh Joshi",
        "timestamp": 1718776725
    },
    {
        "content": "<p>You can use the DecidableEq instance in its prop form with an if-then-else:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">::</span><span class=\"n\">as</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">list_eraseAll</span><span class=\"w\"> </span><span class=\"n\">as</span><span class=\"w\"> </span><span class=\"n\">b</span>\n</code></pre></div>",
        "id": 445512935,
        "sender_full_name": "Chris Bailey",
        "timestamp": 1718776895
    },
    {
        "content": "<p>I see, thanks!</p>",
        "id": 445513049,
        "sender_full_name": "Vivek Rajesh Joshi",
        "timestamp": 1718776935
    },
    {
        "content": "<p>I'm puzzled about this example, why does the dummy above typecheck, but the actual example below not? Does it have something to do with function types being treated special?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">CategoryTheory</span><span class=\"bp\">.</span><span class=\"n\">Limits</span><span class=\"bp\">.</span><span class=\"n\">Shapes</span><span class=\"bp\">.</span><span class=\"n\">Equalizers</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">dep</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"n\">naturality</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"w\"> </span><span class=\"n\">app</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">fooEqual</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"n\">dep</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">    </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">CategoryTheory</span><span class=\"w\"> </span><span class=\"n\">Limits</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">⟶</span><span class=\"w\"> </span><span class=\"n\">Y</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">HasEqualizer</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">barEqual</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fork</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">naturality</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span>\n<span class=\"w\">    </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h0</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">    </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 529517439,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752867683
    },
    {
        "content": "<p>you have to take apart <code>w.π</code> in <code>h0</code> too</p>",
        "id": 529517683,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752867796
    },
    {
        "content": "<p>If you see \"dependent elimination failed\" it means \"the sides of the printed equation are not constructor applications, or a few other basic things I know how to reason about\".</p>\n<p>One side is a <code>fun</code>, and the other is a projection application.</p>",
        "id": 529518107,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752867982
    },
    {
        "content": "<p>I see, will think about this!  Sorry, I wanted to create a new thread, but apparently one already exists with this name.  I can't mark it as solved now.</p>",
        "id": 529518297,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752868061
    },
    {
        "content": "<p>(We never wanted anyone to ever mark threads as solved, and Zulip recently implemented an option to disable the feature. A \"got it\" or \"thanks\" is enough!)</p>",
        "id": 529518443,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868134
    },
    {
        "content": "<p>Style question: why are you mixing term <code>let</code> and <code>by</code>?</p>\n<p>Also, why do you have <code>let h1</code> in the first place? Proofs are definitionally equal, so it's not saying anything. (Another style thing: for proofs, use <code>have</code>, since the proof is irrelevant.)</p>",
        "id": 529519173,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868492
    },
    {
        "content": "<p>Here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">barEqual</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fork</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>The <code>revert</code> is a way to get <code>cases</code> to generalize the term that's in <code>h0</code> too.</p>",
        "id": 529519281,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868554
    },
    {
        "content": "<p>A way around that is to add in a proof clause to <code>cases</code> and use <code>rw</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">barEqual</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fork</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 529519421,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868626
    },
    {
        "content": "<p>Even better: use the extensionality principle for natural transformations:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">barEqual</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fork</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h0</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 529519487,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868668
    },
    {
        "content": "<p>In particular, you might not need this theorem because it's <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.NatTrans.ext#doc\">docs#CategoryTheory.NatTrans.ext</a></p>",
        "id": 529519627,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868733
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">barEqual</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fork</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fork</span><span class=\"bp\">.</span><span class=\"n\">ofι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">ι</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"bp\">.</span><span class=\"n\">condition</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">π</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">NatTrans</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">h0</span>\n</code></pre></div>",
        "id": 529519660,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752868749
    },
    {
        "content": "<p>about the mixing, i usually put the tactic to the end, if i need it, but if thats bad style, ill do it differently, if that's what you meant by mixing by and let.  thanks a lot for your answers!!</p>",
        "id": 529519859,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752868828
    },
    {
        "content": "<p>I'd say that if you are going to use tactics for a theorem, you may as well start with <code>by</code> immediately, since that saves you from ever need to think about moving the <code>by</code> around. Imagine wanting to put a tactic before the <code>let</code> during a refactor — you need to do some unnecessary edits.</p>\n<p>Or, what if you have a tactic proof and after some refactoring you notice that it now starts with a <code>let</code>/<code>have</code>. Do you then need to move the <code>by</code> to after the <code>let</code>/<code>have</code> and indent the rest to try to match that style?</p>",
        "id": 529521638,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752869781
    },
    {
        "content": "<p>good points, ill keep that in mind.  for me it was more like vice versa, i first put down some intermediate results and then in the end i see if i need a tactic to unite them, or not.  but i'm happy to do whatever is considered best style.</p>",
        "id": 529521917,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752869965
    },
    {
        "content": "<p>this is a bit offtopic, but is there a better way to generate equality between structures from equalities between fields (if there is no corresponing ext lemma)?  because im running into different errors now (result is not type correct), and im not sure if the revert/cases/intro/cases approach is the cleanest?</p>",
        "id": 529526956,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752873036
    },
    {
        "content": "<p>When you say \"there's no ext lemma\" do you mean that there can't be one, or that there's not currently one?</p>\n<p>You can add <code>@[ext]</code> to a structure to generate an ext lemma automatically.</p>",
        "id": 529528998,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752874448
    },
    {
        "content": "<p>i meant the former, i can try to add <code>@[ext]</code> (in this case to <code>Cone</code>).</p>",
        "id": 529529238,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752874616
    },
    {
        "content": "<p>You can add it after the fact with <code>attribute [ext] Cone</code> too</p>",
        "id": 529529317,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752874703
    },
    {
        "content": "<p>yes, but that's also global then, right?  i just worry to pollute the global namespace by adding <code>ext</code> to any structure i want to use it with. are there cases where the ext lemma was deliberately not added?</p>",
        "id": 529531995,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752876969
    },
    {
        "content": "<p>There's <code>attribute [local ext] Cone</code> to add it only locally.</p>",
        "id": 529532441,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752877272
    },
    {
        "content": "<p>Sometimes an <code>@[ext]</code> isn't deliberately added because there's a better one that's added in manually later. I can't think of any reason you wouldn't want an ext lemma if the type's constructor isn't private.</p>",
        "id": 529532509,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1752877328
    },
    {
        "content": "<p>thanks for the elaboration!</p>",
        "id": 529532676,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752877443
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"245772\">@Klaus Gy</span> talking about equalities of <code>Cone</code> is <a href=\"https://ncatlab.org/nlab/show/evil\">evil</a></p>",
        "id": 529568501,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752922396
    },
    {
        "content": "<p>you have <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/CategoryTheory/Limits/Cones.html#CategoryTheory.Limits.Cones.ext\">CategoryTheory.Limits.Cones.ext</a> instead, which is not evil (the result is an isomorphism)</p>",
        "id": 529568526,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1752922436
    },
    {
        "content": "<p>But what if we get equality for free?  like in <code>Fork.ofι w.ι w.condition = w</code>?</p>",
        "id": 529568576,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752922521
    },
    {
        "content": "<p>(i didnt add the <code>ext</code> lemma to <code>Cone</code>, i just used it privately for this proof.)</p>",
        "id": 529568630,
        "sender_full_name": "Klaus Gy",
        "timestamp": 1752922601
    }
]