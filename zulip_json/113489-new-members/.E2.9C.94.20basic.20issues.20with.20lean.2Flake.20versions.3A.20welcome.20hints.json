[
    {
        "content": "<p>I've done lake init Meta in a clean directory; lake build works fine until I edit the lakefile.lean to reference mathlib4.  Then I cannot build any more:     <br>\n lake build<br>\n<strong>error:</strong> missing manifest; use <code>lake update</code> to generate one<br>\nI do really have a lake-manifest.json; clearly that's missing lots of stuff now I need eg Mathlib.Tactic but ?<br>\nif I do lake update as suggested, it updates lean-toolchain with the latest lean version and that then breaks lots of other things, including lake and lean; complaining about missing binaries.  I'd much rather not upgrade now.<br>\nLake version 5.0.0-dc25334 (Lean version 4.12.0)</p>",
        "id": 475981248,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519146
    },
    {
        "content": "<p>lake-manifest.json</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span><span class=\"s2\">\"version\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1.1.0\"</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"packagesDir\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\".lake/packages\"</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"packages\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[],</span>\n<span class=\"w\"> </span><span class=\"s2\">\"name\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Meta\"</span><span class=\"o\">,</span>\n<span class=\"w\"> </span><span class=\"s2\">\"lakeDir\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\".lake\"</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 475981431,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519226
    },
    {
        "content": "<p>lakefile.lean</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lake</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lake</span><span class=\"w\"> </span><span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span><span class=\"w\"> </span><span class=\"s2\">\"Meta\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">v!</span><span class=\"s2\">\"0.1.0\"</span>\n\n<span class=\"n\">require</span><span class=\"w\"> </span><span class=\"s2\">\"leanprover-community\"</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">default_target</span><span class=\"kd\">]</span>\n<span class=\"n\">lean_exe</span><span class=\"w\"> </span><span class=\"s2\">\"meta\"</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">root</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"ss\">`Main</span>\n</code></pre></div>",
        "id": 475981975,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519390
    },
    {
        "content": "<p>If you want a new project which depends on Mathlib, use <code>lake init Meta math</code> which should set things up correctly for you.</p>",
        "id": 475982508,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728519556
    },
    {
        "content": "<p>lean-toolchain<br>\n ```<br>\nleanprover/lean4:v4.12.0</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code>\n</code></pre></div>",
        "id": 475982510,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519558
    },
    {
        "content": "<p>oh yes, and now I remember how I did it before!  Thanks Julian.</p>",
        "id": 475982737,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519620
    },
    {
        "content": "<p>ah but then it effectively does update lake and I get the following, which I didn't get before:<br>\n<strong>error:</strong> toolchain 'leanprover/lean4:v4.13.0-rc3' does not have the binary <code>/Users/.../.elan/toolchains/leanprover--lean4---v4.13.0-rc3/bin/lake</code></p>",
        "id": 475982968,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519711
    },
    {
        "content": "<p>so I guess this means adding a new version of elan but I'm nervous of breaking what is already working...</p>",
        "id": 475983206,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728519788
    },
    {
        "content": "<p>so I've reverted lean-toolchain and built and it does, tentatively, seem to be working.</p>",
        "id": 475984205,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728520207
    },
    {
        "content": "<p>That sounds strange (the error) -- but generally installing versions is safe and precisely what elan is meant to help with. I'd try <code>elan toolchain uninstall leanprover/lean4:v4.13.0-rc3</code> and then try the command again.</p>",
        "id": 475984478,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728520382
    },
    {
        "content": "<p>But if it's working then hopefully all good proceeding anyhow.</p>",
        "id": 475984494,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728520392
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"759359\">Matthew Fairtlough</span> <a href=\"#narrow/stream/113489-new-members/topic/basic.20issues.20with.20lean.2Flake.20versions.3A.20welcome.20hints/near/475982968\">said</a>:</p>\n<blockquote>\n<p>ah but then it effectively does update lake and I get the following, which I didn't get before:<br>\n<strong>error:</strong> toolchain 'leanprover/lean4:v4.13.0-rc3' does not have the binary <code>/Users/.../.elan/toolchains/leanprover--lean4---v4.13.0-rc3/bin/lake</code></p>\n</blockquote>\n<p>This error usually happens if you interrupted a Lean installation, and sometimes reinstalling elan is the simplest fix</p>",
        "id": 475984760,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1728520590
    },
    {
        "content": "<p>yes Eric think I'll have to do that.  Loads of errors on building Batteries mostly and this keeps recurring.</p>",
        "id": 475984968,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728520721
    },
    {
        "content": "<p>no dice; uninstalled v4.12.0; reinstalled; tried to buid; everything still broken.</p>",
        "id": 475986175,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728521284
    },
    {
        "content": "<p>the odd thing is that all the old directories still build just fine.  I suppose the manifest is broken.</p>",
        "id": 475986318,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728521366
    },
    {
        "content": "<p><em>4.13.0-rc3</em> sounded like the broken version from your error message, just in case that wasn't what you touched.</p>",
        "id": 475986935,
        "sender_full_name": "Julian Berman",
        "timestamp": 1728521768
    },
    {
        "content": "<p>reinstalling elan seems to have fixed it; I'll mark this resolved then.  Your help is much appreciated.</p>",
        "id": 476104445,
        "sender_full_name": "Matthew Fairtlough",
        "timestamp": 1728558232
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"759359\">Matthew Fairtlough</span> has marked this topic as resolved.</p>",
        "id": 476104488,
        "sender_full_name": "Notification Bot",
        "timestamp": 1728558241
    }
]