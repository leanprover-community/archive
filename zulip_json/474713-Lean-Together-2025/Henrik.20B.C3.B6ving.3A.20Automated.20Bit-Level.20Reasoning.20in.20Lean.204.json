[
    {
        "content": "<p>Discussion thread for this talk.</p>",
        "id": 493979997,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1736962115
    },
    {
        "content": "<p><span aria-label=\"video camera\" class=\"emoji emoji-1f4f9\" role=\"img\" title=\"video camera\">:video_camera:</span> Video recording: <a href=\"https://youtu.be/Q1LDavBJ94A\">https://youtu.be/Q1LDavBJ94A</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"Q1LDavBJ94A\" href=\"https://youtu.be/Q1LDavBJ94A\"><img src=\"https://uploads.zulipusercontent.net/5838740ea966eb94c109c38f7b68dd05ff69e07b/68747470733a2f2f692e7974696d672e636f6d2f76692f51314c446176424a3934412f64656661756c742e6a7067\"></a></div>",
        "id": 494102502,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1737020535
    },
    {
        "content": "<p>A question I asked in the chat during the talk: where did the scary 1844... constant go (you can see it at about 4 minutes in, now I've finally got the talk online (sorry for the delay))</p>",
        "id": 494102774,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737020641
    },
    {
        "content": "<p>The short answer is that one of the rewrite rule saw it was a magic value and removed it for us. Namely if you view the binary representation this is just:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">0</span><span class=\"n\">b1111111111111111111111111111111111111111111111111111111111111111</span>\n</code></pre></div>\n<p>and<br>\n<code>x - y</code> is equivalent to <code>x + ~~~y + 1</code> so the rewriter reordered this into</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">18446744073709551615</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">~~~</span><span class=\"n\">y</span>\n</code></pre></div>\n<p>and <code>18446744073709551615 + 1 = 0</code></p>",
        "id": 494103561,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737020897
    },
    {
        "content": "<p>The preprocessing is really one of the things that makes bitwuzla shine so much, you can take a look at the bitvec related rules in the comments in this file: <a href=\"https://github.com/bitwuzla/bitwuzla/blob/main/src/rewrite/rewrites_bv.cpp\">https://github.com/bitwuzla/bitwuzla/blob/main/src/rewrite/rewrites_bv.cpp</a> they have ton's of fancy rules.</p>",
        "id": 494104445,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737021177
    },
    {
        "content": "<p>In your talk you mentioned there were a bunch of rules from another system you didn’t implement yet.  What is the major barrier?  Is it translating them to Lean or is it proving them?</p>",
        "id": 494153542,
        "sender_full_name": "Jason Rute",
        "timestamp": 1737036066
    },
    {
        "content": "<p>Proving the Bitwuzla rules just takes a while as they are not trivial</p>",
        "id": 494154349,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737036300
    },
    {
        "content": "<p>Is there a ranking of which ones are most effective, e.g. reducing benchmark proving times or some other measure? Just thinking that this may be a fun thing for others to contribute to, if it's cleanly modularized and doesn't get in your way somehow</p>",
        "id": 494164462,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737038840
    },
    {
        "content": "<p>(I've spent enough time playing with bit flipping tricks that this seems like it could be fun)</p>",
        "id": 494164674,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737038884
    },
    {
        "content": "<p>Bitwuzla splits them into 3 levels iirc. I do have a google sheet laying around somewhere that I can dig out where I already tried a best effort translation of most of them to Lean statements (though not proofs) that I can post here if you want to take a look</p>",
        "id": 494165503,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737039065
    },
    {
        "content": "<p>Yeah, I'd be curious. And since I'm not familiar with where to look, a reference to where the existing translations for the tactic are would also be useful.</p>",
        "id": 494165954,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737039156
    },
    {
        "content": "<p><a href=\"https://docs.google.com/spreadsheets/d/1QFgtrqc9IXtYn0sa9gkmteUhIKTsOo-idYoeKx6nj-I/edit?gid=0#gid=0\">https://docs.google.com/spreadsheets/d/1QFgtrqc9IXtYn0sa9gkmteUhIKTsOo-idYoeKx6nj-I/edit?gid=0#gid=0</a></p>",
        "id": 494176531,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737041841
    },
    {
        "content": "<p>right so this is the list of rules in general, the middle column is filled out if we have ported them already. There's also a bit of a consideration to be had here with respect to the simp normal form of the bv_normalize simp set so this stuff is not necessarily translatable one to one to production ruels in <code>bv_decid</code> but it's at least the correct statements even though we potentially need them in a slightly different but equivalent form.</p>\n<p>The implementation currently dwells in <a href=\"https://github.com/leanprover/lean4/tree/master/src/Std/Tactic/BVDecide/Normalize\">https://github.com/leanprover/lean4/tree/master/src/Std/Tactic/BVDecide/Normalize</a> and <a href=\"https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/Tactic/BVDecide/Frontend/Normalize/Simproc.lean\">https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/Tactic/BVDecide/Frontend/Normalize/Simproc.lean</a></p>",
        "id": 494177024,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737041980
    },
    {
        "content": "<p>Is the plan to port them all? Is this the sort of task which can be given to a student?</p>",
        "id": 494258089,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1737073706
    },
    {
        "content": "<p>We definitely want to have as many as possible. Its not a task that can be given to a student just like that because there are some things to consider when porting a rule but with a bit of communication definitely.</p>",
        "id": 494306566,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737102567
    },
    {
        "content": "<p>I think some of the rules would also be nice in greater generality, e.g. there are lots of variants with unary operators ! and ~~~ applied, but probably we should try to match against all unary operators if we could. Of course, for this use case, that can be ignored, but I'm just thinking that I don't think Lean allows us to easily match against all unary operators, right?</p>",
        "id": 494336750,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737112250
    },
    {
        "content": "<p>The vast majorit of lemmas that are used don't rely on something being a unary operator but specifically being the not operator for bool/bitvec respectively.</p>",
        "id": 494337210,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1737112411
    },
    {
        "content": "<p>Yes, what I mean to say, is it that for <code>bv_decide</code> it is enough to have those rules for NOT, but given that some of these rewrite rules are actually nice to have more generally, it would be nice if we could apply them to the wider set of unary operators that you encounter elsewhere as well. But I don't think there's a way to generalize for all unary operators</p>",
        "id": 494337695,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737112586
    },
    {
        "content": "<p>Anyways, I've gone through and saved some notes about some lemmas I'd like to try to contribute. I'll give them a shot and start a thread elsewhere when I have something to report.</p>",
        "id": 494338566,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1737112908
    }
]