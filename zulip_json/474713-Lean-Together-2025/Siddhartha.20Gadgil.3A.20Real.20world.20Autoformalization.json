[
    {
        "content": "<p>It would be interesting to combine something like LeanAide (autoformalization) and <a href=\"http://leansearch.net\">leansearch.net</a> (library search).  It would be cool if you search for something in <a href=\"http://leansearch.net\">leansearch.net</a> and it doesn't just give you definitions/theorems in the library, but also gives you how you could enter this definition/theorem in yourself into Lean.  (A web interface would make this a lot easier to use.  Of course, cost is an issue.)</p>",
        "id": 493927435,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736947932
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266304\">@Siddhartha Gadgil</span> How do you think LeanAide could help out in the Lean Blueprint process.  (I guess others can say where the pain points are, and where autoformalization could help.)</p>",
        "id": 493928712,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736948318
    },
    {
        "content": "<p>Also, what are your thoughts on the feasibility of scaling something like this to formalizing a whole paper, say a paper with few definitions and all the background is standard math in Lean?  (Yes, this filters out most interesting papers.)  Say you are willing to let something run in a loop for a week.  Would there be any hope with current methods that this sort of thing could work?  Or is this still science fiction?</p>",
        "id": 493928754,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736948330
    },
    {
        "content": "<p>I don't think this is science fiction, but work is needed to make it a reality. The hope will be that a language model will do things in various stages:</p>\n<ul>\n<li>Add more details to the text if necessary (LLMs do this well).</li>\n<li>Break into small enough sections.</li>\n<li>Summarize the sections to act as context for other sections.</li>\n<li>Rewrite the section in a custom JSON/XML format, for example.</li>\n<li>Combine sentence level translation with rule-based code generation to generate Lean code, with final proofs left to some form of automation. The automation is also given information about what results the text says are used in the proof.</li>\n</ul>",
        "id": 493929762,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736948615
    },
    {
        "content": "<p>I believe the weak links are the sentence level translation, the identification of the needed results, and the final automation - the last is getting better with <code>grind</code>, <code>aesop</code>, <code>duper</code> etc.</p>",
        "id": 493930118,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736948696
    },
    {
        "content": "<p>So you think the ability of the LLM to partition the proof into structured JSON is pretty good?  That would be cool.</p>",
        "id": 493930525,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736948817
    },
    {
        "content": "<p>Generation of structured proofs seems very good, at least with GPT-4o. We have experimented a fair amount and it is generally correct.</p>",
        "id": 493930816,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736948889
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"703393\">@Anirudh Gupta</span> is the one who has experimented the most. He can confirm how good.</p>",
        "id": 493931030,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736948947
    },
    {
        "content": "<p>Ok, how expensive would it be to do this at scale, like 1000s of papers?  Also, do you have a good example of what this structured output looks like?  Does it consist of concrete mathematical steps which can be atomically formalized?</p>",
        "id": 493931331,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736949033
    },
    {
        "content": "<p>The structured output we use is based on very detailed instructions, with the current version at <a href=\"https://github.com/siddhartha-gadgil/LeanAide/blob/main/resources/JsonTemplate.md\">https://github.com/siddhartha-gadgil/LeanAide/blob/main/resources/JsonTemplate.md</a> (some experimentation was needed). LLMs largely follow this.</p>",
        "id": 493931772,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736949151
    },
    {
        "content": "<p>The result is precise enough that my Lean code handles it in a rule-based way. There are some inaccuracies though.</p>",
        "id": 493931935,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736949200
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/channel/474713-Lean-Together-2025/topic/Siddhartha.20Gadgil.3A.20Real.20world.20Autoformalization/near/493931331\">said</a>:</p>\n<blockquote>\n<p>Ok, how expensive would it be to do this at scale, like 1000s of papers?  Also, do you have a good example of what this structured output looks like?  Does it consist of concrete mathematical steps which can be atomically formalized?</p>\n</blockquote>\n<p>If it turns out (as seems plausible) that Gemini-2.0-flash can do this reasonably, I think the cost will be quite modest.</p>",
        "id": 493932167,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736949264
    },
    {
        "content": "<p>Also there are open models that are very good. But even for them there is the cost of compute.</p>",
        "id": 493932603,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736949392
    },
    {
        "content": "<p>Back to my blueprint questions, have you ever thought how you could speed up the process of creating blueprints, or filling them in?  It seems your tools are creating your own form of blueprint.</p>",
        "id": 493933347,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736949595
    },
    {
        "content": "<p>I have not experimented. Giving similar detailed instructions for blueprints may give good results (I would expect at least reasonable results).</p>\n<p>For my purposes JSON/XML are easier to post-process (LaTeX is hard). Also the models have been trained heavily for JSON output, so LaTeX may not be as good.</p>",
        "id": 493934079,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736949762
    },
    {
        "content": "<p>you can always do a pipeline.  txt to json to other json to latex?</p>",
        "id": 493935131,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736950047
    },
    {
        "content": "<p>Yes, indeed JSON to LaTeX should be straightforward. And the initial JSON instructions can be optimized for the Blueprint format if needed.</p>",
        "id": 493935559,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736950173
    },
    {
        "content": "<p>My slides are at <a href=\"https://siddhartha-gadgil.github.io/presentations/LeanTogether25.html#/\">https://siddhartha-gadgil.github.io/presentations/LeanTogether25.html#/</a></p>",
        "id": 493949487,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736953760
    },
    {
        "content": "<p><span aria-label=\"video camera\" class=\"emoji emoji-1f4f9\" role=\"img\" title=\"video camera\">:video_camera:</span> Video recording: <a href=\"https://youtu.be/bTueWi6OdSg\">https://youtu.be/bTueWi6OdSg</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"bTueWi6OdSg\" href=\"https://youtu.be/bTueWi6OdSg\"><img src=\"https://uploads.zulipusercontent.net/f023c54dff1022b9bf7e06adb53fecaf770a2e21/68747470733a2f2f692e7974696d672e636f6d2f76692f625475655769364f6453672f64656661756c742e6a7067\"></a></div>",
        "id": 494041670,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1736987244
    },
    {
        "content": "<p>Thanks</p>",
        "id": 494041703,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736987270
    },
    {
        "content": "<p>DeepSeek v3 has a good cost to performance ratio too</p>",
        "id": 494052253,
        "sender_full_name": "Alok Singh",
        "timestamp": 1736992963
    },
    {
        "content": "<p>Finally getting around to watching most of today's talks! Thanks for the great presentation. Have you all experimented much with autoformalizing <em>definitions</em> instead of theorem statements? How did it go? It seems like a much much harder task.</p>",
        "id": 494060842,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736998973
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> <a href=\"#narrow/channel/474713-Lean-Together-2025/topic/Siddhartha.20Gadgil.3A.20Real.20world.20Autoformalization/near/494060842\">said</a>:</p>\n<blockquote>\n<p>Finally getting around to watching most of today's talks! Thanks for the great presentation. Have you all experimented much with autoformalizing <em>definitions</em> instead of theorem statements? How did it go? It seems like a much much harder task.</p>\n</blockquote>\n<p>Thanks. Not tried on a large scale, but there is code in LeanAide that translates definitions (essentially the same prompt) and it works fine at least for simple definitions.</p>\n<p>The real split I see is between translating to a single command versus a block. The latter is work in progress.</p>",
        "id": 494061161,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1736999204
    },
    {
        "content": "<p>Do you have an example of a simple definition?</p>",
        "id": 494061324,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736999343
    },
    {
        "content": "<p>I'm thinking about <span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> 's talk yesterday about the difficulty of crafting the perfect definition, which rang very true, and wondering how an (eventual) full autoformalization pipeline would deal with these difficulties.</p>",
        "id": 494061493,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1736999471
    },
    {
        "content": "<p>Here is an example I tried just now: \"A natural number is said to be square-free if it is not divisible by the square of a prime number.\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">squarefree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 494062573,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737000255
    },
    {
        "content": "<p>Because <em>square-free</em> is a standard term I tried a perturbation (not in the same chat, so the previous one was not a hint): \"A natural number is said to be cube-free if it is not divisible by the cube of a prime number.\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">CubeFree</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"s2\">\"</span>\n</code></pre></div>",
        "id": 494062845,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737000406
    },
    {
        "content": "<p>Another example of a different sort: \"A group is said to be crazy if every normal subgroup is cyclic.\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsCrazyGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"bp\">.</span><span class=\"n\">Normal</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">IsCyclic</span><span class=\"w\"> </span><span class=\"n\">H</span>\n</code></pre></div>",
        "id": 494063153,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737000656
    },
    {
        "content": "<p>And a variant: \"A group is said to be sane if every proper normal subgroup is cyclic.\"</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">IsSaneGroup</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subgroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"bp\">.</span><span class=\"n\">Normal</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"bp\">⊤</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">IsCyclic</span><span class=\"w\"> </span><span class=\"bp\">↥</span><span class=\"n\">N</span>\n</code></pre></div>\n<p>In this case, I am not sure if the use of <em>top</em> is correct.</p>",
        "id": 494063344,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737000811
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> Currently I feel the best hope for handling more subtle definitions is to get a language model to rewrite them in a more verbose form, perhaps even splitting them into many definitions. Then one uses the \"simple definition\" translation to handle these.</p>",
        "id": 494064543,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1737001698
    },
    {
        "content": "<p>We have made some major changes since this talk, most notably a way to easily use LeanAide in your project (hopefully) without issues of matching toolchains, dependencies etc. There have also been many other improvements. </p>\n<p>Below is the new README, including details of the setup.</p>\n<h1>LeanAide</h1>\n<p>LeanAide or Lean<strong>AI</strong>de (accidental pun) is work in progress to build AI based tools to help development with the Lean Theorem Prover. The core technique we use is <strong>Autoformalization</strong> which is the process of translating informal mathematical statements to formal statements in a proof assistant. This is used both directly to provide tools and indirectly to generate proofs by translation from natural language proofs generated by Large Language models.</p>\n<p>We now (as of early February 2025) have a convenient way to use LeanAide in your own projects, using a <em>server-client</em> setup which we outline below.</p>\n<h2>Example usage</h2>\n<p>The most convenient way to use LeanAide is with syntax we provide that gives code-actions. We have syntax for translating theorems and definitions from natural language to Lean, and for adding documentation strings to theorems and definitions. For example, the following code in a Lean file (with correct dependencies) will give code actions:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanAideTools</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"bp\">#</span><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many odd numbers\"</span>\n\n<span class=\"bp\">#</span><span class=\"kd\">def</span><span class=\"w\"> </span><span class=\"s2\">\"A number is defined to be cube-free if it is not divisible by the cube of a prime number\"</span>\n\n<span class=\"bp\">#</span><span class=\"n\">doc</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">InfiniteOddNumbers</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\">  </span><span class=\"bp\">∣</span><span class=\"w\">  </span><span class=\"n\">Odd</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">Infinite</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>We also provide syntax for generating/completing proofs. For now this is slow and not of good quality. Experiments and feedback are welcome. The first of the examples below uses a command and the second uses a tactic.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">prove</span><span class=\"w\"> </span><span class=\"s2\">\"The product of two successive natural numbers is even\"</span>\n\n<span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">eg₁</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"bp\">∣</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"n\">prove</span>\n</code></pre></div>\n<h2>Setting up LeanAide</h2>\n<p>To either experiment directly with <code>LeanAide</code> or use it via the server-client setup as a dependency in your own project, you need to first install LeanAide.</p>\n<p>First clone the repository. Next, from the root of the repository, run the following commands to build and fetch pre-loaded embeddings:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>lake<span class=\"w\"> </span>exe<span class=\"w\"> </span>cache<span class=\"w\"> </span>get<span class=\"w\"> </span><span class=\"c1\"># download prebuilt mathlib binaries</span>\n\nlake<span class=\"w\"> </span>build<span class=\"w\"> </span>mathlib\n\nlake<span class=\"w\"> </span>build\n\nlake<span class=\"w\"> </span>exe<span class=\"w\"> </span>fetch_embeddings\n</code></pre></div>\n<p>Our translation is based on <code>GPT 4o</code> from OpenAI, but you can use alternative models (including local ones). Note that we also use embeddings from OpenAI, so you will need an OpenAI API key unless you set up an <em>example server</em> as descried below. Here, we assume you have an OpenAI API key.</p>\n<p>To get started please configure environment variables using the following bash commands or equivalent in your system at the base of the repository (the angle brackets are <strong>not</strong> to be included in the command), and then launch VS code.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">export</span><span class=\"w\"> </span><span class=\"nv\">OPENAI_API_KEY</span><span class=\"o\">=</span>&lt;your-open-ai-key&gt;\n\ncode<span class=\"w\"> </span>.\n</code></pre></div>\n<p>Alternatively, you can create a file with path <code>private/OPENAI_API_KEY</code> (relative to the root of LeanAIDE) containing your key.</p>\n<p>After this open the folder in VS code (or equivalent) with Lean 4 and go to the file <code>LeanCodePrompts/TranslateDemo.lean</code>. Any statement written using syntax</p>\n<p>similar to <code>#theorem \"There are infinitely many primes\"</code> will be translated into Lean code. You will see examples of this in the demo files. Once the translation is done, a <code>Try this</code> hyperlink and code-action will appear. Clicking on this will add the translated code to the file.</p>\n<p>Alternatively, you can translate a statement using the following command in the Lean REPL:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">translate</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many primes\"</span>\n</code></pre></div>\n<h3>Using as a dependency: server-client setup</h3>\n<p>Adding <code>LeanAide</code> as a dependency to your project is brittle and slow. In particular, toolchains need to match exactly. Further, there may be a collision of transitive dependencies.</p>\n<p>We provide a server-client setup that is more robust and faster, based on the <strong>zero-dependency</strong> project <a href=\"https://github.com/siddhartha-gadgil/LeanAideTools\">LeanAideTools</a>. This acts as a client to the server in this repository.</p>\n<p>The simplest (and we expect the most common) way to set up LeanAide to use in your project is to run a server locally. To do this, first set up LeanAide as described above. Then run the following command from the root of the repository:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>python3<span class=\"w\"> </span>leanaide_server.py\n</code></pre></div>\n<p>We assume you have Python 3 installed but we only use builtin packages. If you wish to use a different model supporting the OpenAI API, you can pass parameters as in the following example where we use the Mistral API. To use a local model, you can run with the OpenAI Chat API using, for example <code>vLLM</code> and give a local url.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"w\"> </span>python3<span class=\"w\"> </span>leanaide_server.py<span class=\"w\"> </span>--url<span class=\"w\"> </span>https://api.mistral.ai/v1/chat/completions<span class=\"w\"> </span>--auth_key<span class=\"w\"> </span>&lt;Mistral<span class=\"w\"> </span>API<span class=\"w\"> </span>key&gt;<span class=\"w\"> </span>--model<span class=\"w\">  </span><span class=\"s2\">\"mistral-small-latest\"</span>\n</code></pre></div>\n<p>Next, add <code>LeanAideTools</code> as a dependency to your project. This can be done by adding the following line to your <code>lakefile.toml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[[require]]</span>\n\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"LeanAideTools\"</span>\n\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/siddhartha-gadgil/LeanAideTools.git\"</span>\n\n<span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span>\n</code></pre></div>\n<p>If you use a <code>lakefile.lean</code> file, you can add the following line to the file:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">require</span><span class=\"w\"> </span><span class=\"n\">LeanAideTools</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/siddhartha-gadgil/LeanAideTools\"</span><span class=\"bp\">@</span><span class=\"s2\">\"main\"</span>\n</code></pre></div>\n<p>Now you can use the <code>LeanAideTools</code> package in your project. The following is an example of how to use it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanAideTools</span>\n\n<span class=\"bp\">#</span><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"s2\">\"There are infinitely many primes\"</span>\n</code></pre></div>\n<h3>Hosting a server</h3>\n<p>The server is by default launched at <code>http://localhost:7654</code>. This can be customized by setting the variables <code>HOST</code> and <code>LEANAIDE_PORT</code>. To use a shared server, simply set <code>HOST</code> to the IP of the hosting machine. In the client, i.e., the project with <code>LeanAideTools</code> as a dependency, add the configuration:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">leanaide.url</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">hosts</span><span class=\"w\"> </span><span class=\"n\">IP</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"mi\">7654</span>\n</code></pre></div>\n<p>to use the host. Further, unless you want all clients to use the hosts authentication for OpenAI or whatever is the model used, the host should not specify an authentication key (better still, start the server with <code>--auth_key \"A key that will not work\"</code>). The client should then supply the authentication key with</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">set_option</span><span class=\"w\"> </span><span class=\"n\">leanaide.authkey</span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;authentication-key&gt;\"</span>\n</code></pre></div>\n<p>There are many other configurations at the server and client end.</p>\n<h3>Using different (non OpenAI) embeddings</h3>\n<p>If you wish to use embeddings different from the OpenAI embeddings, for example for a fully open-source solution, you can run an \"examples server\" and set the parameter <code>examples_url</code> to point to it. We provide a basic implementation of this in the <code>example_server</code> directory. To start this, run the following:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">cd</span><span class=\"w\"> </span>example_server\n\npython3<span class=\"w\"> </span>prebuild_embeddings\n\nflask<span class=\"w\"> </span>run\n</code></pre></div>\n<p>The second command should be run only the first time you set up. Once you start the server, set <code>examples_url = \"localhost:5000/find_nearest\"</code> to use the embedding server.</p>\n<p>The file <code>example_server/README.md</code> sketches the configuration options and also the protocol in case you wish to make a fully customized embedding database.</p>\n<h2>Contributions and details</h2>\n<p>The principal author of this repository is <a href=\"https://math.iisc.ac.in/~gadgil/\">Siddhartha Gadgil</a>.</p>\n<p>The first phase of this work (roughly June 2022-October 2023) was done in collaboration with:</p>\n<ul>\n<li>Anand Rao Tadipatri</li>\n<li>Ayush Agrawal</li>\n<li>Ashvni Narayanan</li>\n<li>Navin Goyal</li>\n</ul>\n<p>We had a lot of help from the Lean community and from collaborators at Microsoft Research. Our server is hosted with support from research credits from Google.</p>\n<p>More recently (since about October 2024) the work has been done in collaboration with:</p>\n<ul>\n<li>Anirudh Gupta</li>\n<li>Vaishnavi Shirsath</li>\n<li>Ajay Kumar Nair</li>\n<li>Malhar Patel</li>\n<li>Sushrut Jog</li>\n</ul>\n<p>This is supported by ARCNet, ART-PARK, IISc.</p>\n<p>Our work is described in a <a href=\"https://mathai2022.github.io/papers/17.pdf\">note</a> at the <a href=\"https://mathai2022.github.io/papers/\">2nd Math AI workshop</a> and in more detail (along with related work) in a <a href=\"https://arxiv.org/abs/2211.07524\">preprint</a>.</p>",
        "id": 498105670,
        "sender_full_name": "Siddhartha Gadgil",
        "timestamp": 1738843800
    }
]