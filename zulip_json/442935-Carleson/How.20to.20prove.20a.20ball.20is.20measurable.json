[
    {
        "content": "<p>I'm trying to prove the following in <code>HardyLittlewood.lean</code> and I have come across this very hard reduced goal:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">MeasureTheory</span><span class=\"bp\">.</span><span class=\"n\">AEStronglyMeasurable</span><span class=\"bp\">.</span><span class=\"n\">maximalFunction</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">AEStronglyMeasurable</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">Î¼</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hğ“‘</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ğ“‘</span><span class=\"bp\">.</span><span class=\"n\">Countable</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">AEStronglyMeasurable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">maximalFunction</span><span class=\"w\"> </span><span class=\"n\">Î¼</span><span class=\"w\"> </span><span class=\"n\">ğ“‘</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Î¼</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">aemeasurable_biSup</span><span class=\"w\"> </span><span class=\"n\">ğ“‘</span><span class=\"w\"> </span><span class=\"n\">hğ“‘</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">mi</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">aemeasurable_const</span><span class=\"bp\">.</span><span class=\"n\">indicator</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">pow</span>\n<span class=\"w\">    </span><span class=\"n\">aemeasurable_const</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">aestronglyMeasurable</span>\n<span class=\"w\">  </span><span class=\"c1\">-- âŠ¢ MeasurableSet (ball (c i) (r i))</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>This would seem like <code>measurableSet_ball</code> solves it, but that requires <code>OpensMeasurableSpace X</code> which is not provided in the given instances for <code>X</code>, and furthermore I'm not using <code>hu</code> at all. Where am I supposed to use <code>hu</code>?</p>",
        "id": 455002668,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722308255
    },
    {
        "content": "<p>For reference:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"bp\">â‰¥</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MetricSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">Î¼</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Î¼</span><span class=\"bp\">.</span><span class=\"n\">IsDoubling</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">NormedSpace</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">MeasurableSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">BorelSpace</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ğ“‘</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"o\">}</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsFiniteMeasureOnCompacts</span><span class=\"w\"> </span><span class=\"n\">Î¼</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ProperSpace</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nonempty</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Î¼</span><span class=\"bp\">.</span><span class=\"n\">IsOpenPosMeasure</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- feel free to assume `A â‰¥ 16` or similar</span>\n\n<span class=\"sd\">/-- The Hardy-Littlewood maximal function w.r.t. a collection of balls ğ“‘.</span>\n<span class=\"sd\">M_{ğ“‘, p} in the blueprint. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">maximalFunction</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Î¼</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Measure</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“‘</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Î¹</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">â„</span><span class=\"bp\">â‰¥</span><span class=\"mi\">0</span><span class=\"bp\">âˆ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"bp\">â¨†</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“‘</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">indicator</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">â¨â»</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">ball</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">â€–</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"bp\">â€–â‚Š</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">âˆ‚</span><span class=\"n\">Î¼</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">â»Â¹</span>\n</code></pre></div>",
        "id": 455003583,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722308431
    },
    {
        "content": "<p><code>BorelSpace E</code> implies <code>OpensMeasuable E</code> via <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=BorelSpace.opensMeasurable#doc\">docs#BorelSpace.opensMeasurable</a></p>",
        "id": 455004068,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722308570
    },
    {
        "content": "<p>so you can use <code>measurableSet_ball</code></p>",
        "id": 455004095,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722308585
    },
    {
        "content": "<p>No, I have <code>ball (c i) (r i) : Set X</code>, not <code>Set E</code></p>",
        "id": 455004365,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722308656
    },
    {
        "content": "<p>oops sorry</p>",
        "id": 455004993,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722308785
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 455007458,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722309255
    },
    {
        "content": "<p>My guess: the informal proof missed this assumption.</p>",
        "id": 455026566,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1722315192
    },
    {
        "content": "<p>Or do you actually work with non-Borel Ïƒ-algebras in this project?</p>",
        "id": 455026601,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1722315211
    },
    {
        "content": "<p><code>X</code> is a so-called doubling metric measure space:<br>\n\"A doubling metric measure space <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Î¼</mi><mo separator=\"true\">,</mo><mi>Ï</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X,\\mu,\\rho,a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">Î¼</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">Ï</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span></span></span></span> is a complete and locally compact metric space equipped with a <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ïƒ</span></span></span></span>-finite non-zero Radonâ€“Borel measure <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Î¼</mi></mrow><annotation encoding=\"application/x-tex\">\\mu</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Î¼</span></span></span></span> that satisfies the doubling condition that...\"</p>",
        "id": 455031977,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722317317
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> the DMMS described above is the most general kind of space we work with in this project, see <a href=\"https://florisvandoorn.com/carleson/blueprint/sect0001.html\">blueprint</a></p>",
        "id": 455032327,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722317551
    },
    {
        "content": "<p>If the formalization is missing <code>BorelSpace</code> then this is an oversight. I will add it.</p>",
        "id": 455041848,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1722321716
    },
    {
        "content": "<p>Do we lose any significant generality by adding <code>BorelSpace X</code> though?</p>",
        "id": 455043993,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722322630
    },
    {
        "content": "<p><em>Surely</em> there must be a way to use <code>hu</code> to prove the statement <strong>without</strong> <code>BorelSpace X</code>!</p>",
        "id": 455048744,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722323888
    },
    {
        "content": "<p>No, there can't be. If you aren't in a Borel space and make <code>u</code> be a constant function, then you can get the indicator function of a non-measurable set</p>",
        "id": 455053612,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1722324990
    },
    {
        "content": "<p>I never learned point-set topology, let alone measure theory, in universityâ€¦</p>",
        "id": 455054274,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1722325105
    },
    {
        "content": "<p>It's okay <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> just pointing out that indeed you need <code>BorelSpace X</code> (or at least half of it, namely <code>OpensMeasurableSpace X</code>)</p>",
        "id": 455055586,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1722325472
    },
    {
        "content": "<p>Of course, I think the hypothesis <code>BorelSpace X</code> should just be added, but at the same time, I was having quite a hard time coming up with an example of a doubling measure, positive on open sets and finite on compact sets which is <em>not</em> Borel. I guess maybe one idea could be to start with such a Borel measure, then throw out certain measure zero sets from the Ïƒ-algebra, but still maintain that it <em>is</em> indeed a Ïƒ-algebra? Seems a rather complicated counterexample to construct.</p>",
        "id": 455065246,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1722328348
    },
    {
        "content": "<p>I've added the hypothesis <code>BorelSpace X</code> now. After we finish the proof we can see if it's easy to weaken it to <code>OpensMeasurableSpace</code>.</p>",
        "id": 455066246,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1722328526
    }
]