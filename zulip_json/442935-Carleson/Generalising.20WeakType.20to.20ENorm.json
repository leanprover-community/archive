[
    {
        "content": "<p>I'm looking at generalising <code>WeakType.lean</code> to use enorms everywhere. <code>distribution_smul_left</code> generalises fine to any <code>ENormedSpace</code> and scalar multiplication w.r.t. NNReal - but to even state <code>HasStrongType.const_smul</code> using enorms, I need to change <code>HasStrongType</code> to take an <code>ENNReal</code> parameter <code>c</code>. (For <code>HasStrongType </code>(k • T) p p' μ ν (‖k‖ₑ * c)<code>to even make sense, the last parameter must be an </code>ENNReal` - as the enorm is an ennreal. Another option could be to always prove that the product is not infinite, which seems tedious.)</p>\n<p>Any downsides to doing so?</p>",
        "id": 509978241,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1743695515
    },
    {
        "content": "<p>(I can just try that out tomorrow and report back.)</p>",
        "id": 509978316,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1743695526
    },
    {
        "content": "<p>I'm happy to make <code>c</code> an <code>ENNReal</code>. I think it indeed makes sense to make that change.<br>\nThe change would probably mean that some lemmas get a <code>c \\ne \\top</code> assumption, which is fine.</p>",
        "id": 509982995,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1743696752
    },
    {
        "content": "<p>we could even give those assumptions a default value of <code>by finiteness</code></p>",
        "id": 509983470,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1743696880
    },
    {
        "content": "<p>Current mathlib PRs generalising lemmas to enorm: <a href=\"https://github.com/leanprover-community/mathlib4/pull/24343\">#24343</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/24355\">#24355</a> (both ready for review)</p>",
        "id": 514373376,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745585573
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24352\">#24352</a> (depending on these) will cover the added lemmas in <a href=\"https://github.com/leanprover-community/Carleson/pull/313\">Carleson#313</a> which just were mathlib generalisations.</p>",
        "id": 514379273,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1745587325
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24356\">#24356</a> is now ready for review, another 50-100 lines of generalising typeclasses</p>",
        "id": 515348108,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746030042
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24481\">#24481</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/24482\">#24482</a> are two more PRs generalising. The first is <code>easy</code> (less than 10 lines), the other also 50-100 lines.</p>",
        "id": 515349925,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746030612
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24640\">#24640</a> is the next PR in the sequence</p>",
        "id": 516500538,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746553278
    },
    {
        "content": "<p>Current PRs are <a href=\"https://github.com/leanprover-community/mathlib4/pull/24820\">#24820</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/24839\">#24839</a>. (Another one was merged this morning.)</p>",
        "id": 517794003,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747132768
    },
    {
        "content": "<p>Generalising integral lemma, I wonder: in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24352\">#24352</a>, <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=integrableOn_const#doc\">docs#integrableOn_const</a> takes a hypothesis about the constant being finite. (This could be relaxed, but some condition is needed.) This means all call sites need to be adjusted for this; <a href=\"https://github.com/leanprover-community/mathlib4/pull/24352/commits/95bb3a532e33438901e90fdc7a25fba9f0cf7fc0\">this commit</a> shows there are currently 18 of them. The fix is usually very mechanical (add <code>enorm_ne_top</code>, perhaps with the implicit argument omitted). Should I try to automate this?</p>",
        "id": 517887725,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747157603
    },
    {
        "content": "<p>I could imagine</p>\n<ul>\n<li>using <code>by apply enorm_ne_top</code> as a default parameter, which would probably solve ~10 of these sites</li>\n<li>improving <code>finiteness</code> and using <code>by finiteness</code> instead. Currently, finiteness cannot solve this --- and this might have a performance cliff (because that's what aesop sometimes does)</li>\n<li>deciding that quite a few of these call sites will be generalised to enorms anyway, and just proceed.</li>\n</ul>\n<p>Thoughts?</p>",
        "id": 517887985,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747157690
    },
    {
        "content": "<p><code>enorm_ne_top</code> (actually probably its <code>lt</code> version, but I would have to check which is better) should definitely be added to the <code>finiteness</code> rule-set. There should be almost no cost to that. And using <code>by finiteness</code> is definitely preferred over applying a specific lemma. </p>\n<p>Whether we want to populate all/many non-infinity side-conditions in the measure theory library is a good question. This is broader than the current refactor: there are already plenty of such side-conditions in Mathlib, so probably that discussion should be held in <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4\">#mathlib4</a> (feel free to start this!)<br>\nI think that would be a nice change.</p>",
        "id": 518021094,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1747216511
    },
    {
        "content": "<p>Looking at the documentation, I found that <code>finiteness</code> does not run <code>simp</code> within aesop - which clarifies why this should be performance-neutral. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 518052366,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747225705
    },
    {
        "content": "<p>I added <code>enorm_lt_top</code> to the finiteness rule-set and used that as a default parameter. Overall, the PR is a (small) speed-up, and it's ready for review. (Not blocking urgent work.)</p>",
        "id": 518052475,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747225741
    },
    {
        "content": "<p>By the way: <a href=\"https://github.com/leanprover-community/mathlib4/pull/25086\">#25086</a> upstreams Carleson's finiteness tagging to mathlib. (<a href=\"https://github.com/leanprover-community/mathlib4/pull/25111\">#25111</a> on top of that uses finiteness to golf lots of mathlib proofs.)</p>",
        "id": 519988629,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1747986137
    },
    {
        "content": "<p><a href=\"https://github.com/fpvandoorn/carleson/pull/373\">fpvandoorn/carleson#373</a> makes some progress relating to Task 117 (of course this does not constitute a claim)</p>",
        "id": 522061804,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1748940581
    }
]