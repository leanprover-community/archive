[
    {
        "content": "<p>Just a heads up: the links to lean code in the blueprint (either from the dependency graph or the latex) are 404'ed for some reason: e.g., to pick something at random, the Lean link from <a href=\"https://florisvandoorn.com/carleson/blueprint/sect0003.html#Dirichlet-kernel\">https://florisvandoorn.com/carleson/blueprint/sect0003.html#Dirichlet-kernel</a> points to <a href=\"https://fpvandoorn.github.io/carleson/docs/find/#doc/dirichletKernel_eq\">https://fpvandoorn.github.io/carleson/docs/find/#doc/dirichletKernel_eq</a> and <a href=\"https://fpvandoorn.github.io/carleson/docs/find/#doc/partialFourierSum_eq_conv_dirichletKernel\">https://fpvandoorn.github.io/carleson/docs/find/#doc/partialFourierSum_eq_conv_dirichletKernel</a> which both return a 404 message (instead of resolving to (presumably) <a href=\"https://florisvandoorn.com/carleson/docs/Carleson/Classical/DirichletKernel.html#dirichletKernel_eq\">https://florisvandoorn.com/carleson/docs/Carleson/Classical/DirichletKernel.html#dirichletKernel_eq</a> and <a href=\"https://florisvandoorn.com/carleson/docs/Carleson/Classical/DirichletKernel.html#partialFourierSum_eq_conv_dirichletKernel\">https://florisvandoorn.com/carleson/docs/Carleson/Classical/DirichletKernel.html#partialFourierSum_eq_conv_dirichletKernel</a> respectively).  Presumably it's some misconfiguration of the \"find\" URL...</p>\n<p>EDIT: strangely, some links still work.  For instance <a href=\"https://florisvandoorn.com/carleson/blueprint/sect0003.html#real-Carleson\">https://florisvandoorn.com/carleson/blueprint/sect0003.html#real-Carleson</a> points to <a href=\"https://fpvandoorn.github.io/carleson/docs/find/#doc/rcarleson\">https://fpvandoorn.github.io/carleson/docs/find/#doc/rcarleson</a> which correctly resolves to <a href=\"https://florisvandoorn.com/carleson/docs/Carleson/Classical/CarlesonOnTheRealLine.html#rcarleson\">https://florisvandoorn.com/carleson/docs/Carleson/Classical/CarlesonOnTheRealLine.html#rcarleson</a> .  Not sure what is going on. Maybe some of the docs files are not being indexed?</p>",
        "id": 515926319,
        "sender_full_name": "Terence Tao",
        "timestamp": 1746291566
    },
    {
        "content": "<p>Indeed, <code>dirichletKernel_eq</code> doesn't appear in the Carleson docs. Why this is, I have no idea... Well I had several ideas, but none of them turned out to be correct</p>",
        "id": 515928355,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1746292230
    },
    {
        "content": "<ul>\n<li><code>dirichletKernel_eq</code> is in the root namespace, so it's not a namespace issue.</li>\n<li><code>dirichletKernel_eq</code> is in <code>Carleson.Classical.DirichletKernel</code> which is imported by Carleson, so it is not an import issue.</li>\n<li>The docs are invalidated whenever the lake manifest changes: <a href=\"https://github.com/fpvandoorn/carleson/blob/e39ecc926ec5159e20af1716d7bcbdda08aa9523/.github/workflows/push.yml#L63\">https://github.com/fpvandoorn/carleson/blob/e39ecc926ec5159e20af1716d7bcbdda08aa9523/.github/workflows/push.yml#L63</a>. So it is not a caching issue.</li>\n<li>Recent commits to Carleson did indeed trigger CI, so it's not a disabled CI issue.</li>\n</ul>",
        "id": 515928701,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1746292365
    },
    {
        "content": "<p>Let me try the usual thing of cleaning up the cache and rerun the latest job. <a href=\"https://github.com/fpvandoorn/carleson/actions/runs/14796902479/job/41589985214\">https://github.com/fpvandoorn/carleson/actions/runs/14796902479/job/41589985214</a></p>\n<p>Let’s wait an hour or so…</p>",
        "id": 515929079,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746292581
    },
    {
        "content": "<p>Now it's fixed. Thanks for the report and sorry for the inconvenience.</p>",
        "id": 515933731,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746295390
    },
    {
        "content": "<p>The ways of CI... <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 515942336,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1746300450
    },
    {
        "content": "<p>The cache seems to regularly break. I've also cleared the cache &amp; restarted the latest job a few times myself. If someone wants to investigate how this can be solved more robustly, that would be very helpful!</p>\n<p>(Do other projects, like FLT/LeanCamCombi have the same issue?)</p>",
        "id": 516198587,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746451948
    },
    {
        "content": "<p>I can do it later today or in the next few days. I have some idea about how to fix this.</p>",
        "id": 516217105,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746456152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/channel/442935-Carleson/topic/Blueprint.20Lean.20links.20404'ed/near/516198587\">said</a>:</p>\n<blockquote>\n<p>(Do other projects, like FLT/LeanCamCombi have the same issue?)</p>\n</blockquote>\n<p>I have found a possibly related issue with Moogle.  If I search for, say, commutative group,</p>\n<p><a href=\"https://moogle-morphlabs.vercel.app/search/raw?q=commutative%20group\">https://moogle-morphlabs.vercel.app/search/raw?q=commutative%20group</a></p>\n<p>the first hit (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html#CommGroup\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html#CommGroup</a>) resolves correctly, but the second hit (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/GroupTheory/Subgroup/Basic.html#Subgroup.IsCommutative.commGroup\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/GroupTheory/Subgroup/Basic.html#Subgroup.IsCommutative.commGroup</a>) leads to a 404.  Here though the \"find\" function is not being directly used, so this could be a more moogle-specific issue.</p>",
        "id": 516222107,
        "sender_full_name": "Terence Tao",
        "timestamp": 1746456555
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/442935-Carleson/topic/Blueprint.20Lean.20links.20404'ed/near/516198587\">said</a>:</p>\n<blockquote>\n<p>Do other projects, like FLT/LeanCamCombi have the same issue?</p>\n</blockquote>\n<p>I never noticed it breaking, but I rarely use the docs of my project (because they are not too big and I know them by heart)</p>",
        "id": 516232322,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1746459101
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"657719\">@Terence Tao</span> I think that is unrelated, and caused by the fact that Moogle uses a very old version of Mathlib, and the file where this result was has been moved. I recommend using <a href=\"https://leansearch.net/\">https://leansearch.net/</a> instead of Moogle for natural language search of Mathlib.</p>",
        "id": 516239962,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746461024
    },
    {
        "content": "<p>I believe that caching only the relevant subdirectories of <code>docbuild/.lake/build/doc</code>, rather than the entire path, combined with a cache key that accurately reflects the inputs affecting the documentation, should be sufficient to avoid this stale cache issue.</p>\n<p>I tend to believe that this issue is simply due to a combination of too broad doc caching and excessively permissive cache <code>restore-key</code>, which allows outdated artifacts to be reused.</p>\n<p>I’ll open a PR when I am back at my PC.</p>",
        "id": 516246582,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746462583
    },
    {
        "content": "<p>Maybe we should completely avoid using <code>restore-key</code>s when caching API docs because it can restore outdated or mismatched artifacts from previous builds. Since the doc output depends closely on the current <code>lean_decls</code>, a partially matching cache can easily lead to problems like missing pages or broken links without triggering a rebuild. Using an exact cache <code>key</code> ensures that the documentation is only reused when it is guaranteed to be valid for the current state of the project.</p>",
        "id": 516249147,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746463114
    },
    {
        "content": "<p>In short, I think we should cache only those files whose contents are fully determined by the key parameters.</p>",
        "id": 516249682,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746463227
    },
    {
        "content": "<p>I agree. I didn't actually realize that we were caching docs from the Carleson project. I think most of the gains from caching are from caching Mathlib docs, and I think Carleson is small enough to rebuild that from scratch each time.</p>",
        "id": 516268497,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746469406
    },
    {
        "content": "<p>Thanks for looking into this!</p>",
        "id": 516268538,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746469419
    },
    {
        "content": "<p>Done <a href=\"https://github.com/fpvandoorn/carleson/pull/328\">https://github.com/fpvandoorn/carleson/pull/328</a></p>",
        "id": 516284923,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746475185
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> I’ve just opened a <a href=\"https://github.com/PatrickMassot/leanblueprint/pull/70\">PR</a> upstreaming the fix to LeanBlueprint so it applies for all future projects using the template.</p>",
        "id": 516290830,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746477124
    },
    {
        "content": "<p>I also recommend avoiding exclusion patterns in <code>actions/cache</code> unless the excluded paths are at the same directory depth as the included ones since deeper exclusions are unreliable due to limitations in the underlying globbing behavior (see <a href=\"https://github.com/actions/toolkit/issues/713\">this issue</a> for more details).</p>",
        "id": 516293325,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746478018
    },
    {
        "content": "<p>Similarly I never really use the FLT docs; I just tried some random links and some worked and some didn't, although this might be incompetence on my part.</p>",
        "id": 516294227,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1746478355
    },
    {
        "content": "<p>Fixed in FLT too (<a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/469\">FLT#469</a>).</p>",
        "id": 516294525,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746478468
    },
    {
        "content": "<p>Thanks Pietro. <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> and <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, could you confirm this patch fixes the issue for you?</p>",
        "id": 516430910,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1746534354
    },
    {
        "content": "<p>I don't know how to test that, other than waiting for a commit changing a bunch of lemmas, and then searching for random things in the docs. All the links in Terry's original message work again, but that might be just because of the clearing of the cache + rerun.</p>",
        "id": 516481433,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1746547284
    },
    {
        "content": "<p>In theory, given how <code>actions/cache</code> is supposed to work, I believe this conservative change should resolve the issue.</p>\n<p>To “test” (narrowly enough) this in practice, I could:</p>\n<ol>\n<li>Open a dedicated PR branch which will not be merged.</li>\n<li>Introduce minor modifications to certain declaration names. </li>\n<li>Enable the website deployment for <code>pull_request</code> events as well.</li>\n<li>Check whether the resulting documentation reflects those name changes accordingly using links in the blueprint HTML.</li>\n</ol>\n<p>I could perform this “test” on both the FLT and Carleson repos, although FLT currently offers a slightly more convenient setup since it uses a single workflow file in which the event conditions can be easily commented out.</p>",
        "id": 516500376,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746553222
    },
    {
        "content": "<p>I have just run the \"test\" mentioned above on FLT, more precisely: </p>\n<ol>\n<li><a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/470\">FLT#470</a> </li>\n<li><code>GLn.IsSmooth</code> to <code>GLn.IsSmooth'</code> and <code>GLn.IsSlowlyIncreasing</code> to <code>GLn.IsSlowlyIncreasing'</code>.</li>\n<li><a href=\"https://github.com/ImperialCollegeLondon/FLT/pull/470/files#diff-4e2751aec1a84ced68388517cb6f54720d3316f73ea035b8c559d9e028af0581R130-R151\">FLT#470-diff</a></li>\n<li><code>GLn.IsSmooth'</code> (<a href=\"https://imperialcollegelondon.github.io/FLT/blueprint/sect0004.html#AutomorphicForm.GLn.IsSmooth\">https://imperialcollegelondon.github.io/FLT/blueprint/sect0004.html#AutomorphicForm.GLn.IsSmooth</a>' and <a href=\"https://imperialcollegelondon.github.io/FLT/docs/find/#doc/AutomorphicForm.GLn.IsSmooth\">https://imperialcollegelondon.github.io/FLT/docs/find/#doc/AutomorphicForm.GLn.IsSmooth</a>') and <code>GLn.IsSlowlyIncreasing'</code> (<a href=\"https://imperialcollegelondon.github.io/FLT/blueprint/sect0004.html#AutomorphicForm.GLn.IsSlowlyIncreasing\">https://imperialcollegelondon.github.io/FLT/blueprint/sect0004.html#AutomorphicForm.GLn.IsSlowlyIncreasing</a>' and <a href=\"https://imperialcollegelondon.github.io/FLT/docs/find/#doc/AutomorphicForm.GLn.IsSlowlyIncreasing\">https://imperialcollegelondon.github.io/FLT/docs/find/#doc/AutomorphicForm.GLn.IsSlowlyIncreasing</a>')</li>\n</ol>\n<p>Results: <br>\n<span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> The cache has been restored successfully (see <a href=\"https://github.com/ImperialCollegeLondon/FLT/actions/runs/14866954383/job/41746013120?pr=470#step:8:22\">here</a>).<br>\n<span aria-label=\"check\" class=\"emoji emoji-2705\" role=\"img\" title=\"check\">:check:</span> Step 4. above has worked as expected.</p>",
        "id": 516514986,
        "sender_full_name": "Pietro Monticone",
        "timestamp": 1746557837
    },
    {
        "content": "<p>Thanks as ever Pietro for keeping the show on the road!</p>",
        "id": 516524965,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1746561801
    },
    {
        "content": "<p>Ok, this is good enough to merge. Thanks!</p>",
        "id": 516527069,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1746562706
    }
]