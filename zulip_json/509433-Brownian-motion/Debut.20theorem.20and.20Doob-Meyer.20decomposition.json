[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"638899\">@Lorenzo Luccioli</span> <span class=\"user-mention\" data-user-id=\"930183\">@Alessio Rondelli</span> <span class=\"user-mention\" data-user-id=\"556875\">@Pietro Monticone</span> you added material about the Debut theorem (still in a PR) and the Doob-Meyer decomposition (that PR was merged). One proof in the Doob-Meyer part uses the Debut theorem, but actually it only uses it in a case of a hitting time indexed by a discrete set, so we could get that it's a stopping time by using the result specific to that case (which is already in Mathlib).<br>\nIs the Debut theorem also used elsewhere? I don't want to remove anything from the blueprint, I'm just asking in order to get a better understanding of how the various things you added relate to each other.</p>",
        "id": 539263891,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1757762688
    },
    {
        "content": "<p>As you said, in the material that we added the Debut theorem is only used in discrete time.<br>\nIn general, in the construction of the Stochastic Integral that we had in mind, it is used to show that the exit time of (the norm of) a process from <code>[0, n]</code> is a stopping time, but we don't have any blueprint material written about it at the time.</p>",
        "id": 539276846,
        "sender_full_name": "Lorenzo Luccioli",
        "timestamp": 1757774962
    },
    {
        "content": "<p>Another remark about the Doob-Meyer proof in the blueprint: the processes M and A that are defined for the dyadics could be obtained from the Doob decomposition theorem that is already in Mathlib (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html\">in this file</a>) in order to get some of their properties for free, but we would need to generalize the Mathlib code slightly: for now it's stated only for processes indexed by Nat, and we should generalize that type to a more general discrete (linearly ordered, etc) index.</p>\n<p>That generalization is a self-contained task without prerequisites: if someone feels like opening a PR to Mathlib, that would be great!</p>",
        "id": 539527316,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1757934824
    },
    {
        "content": "<p>The generalization could be to a <code>LinearOrder</code> which is also a <code>LocallyFiniteOrder</code> and an <code>OrderBot</code> (there is an order iso from that to a subset of Nat; <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Order/SuccPred/LinearLocallyFinite.html#orderIsoNatOfLinearSuccPredArch\">that file</a> is related).</p>",
        "id": 539532351,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1757936250
    },
    {
        "content": "<p>WIP generalization of the Doob decomposition here: <a href=\"https://github.com/leanprover-community/mathlib4/pull/31008\">#31008</a></p>",
        "id": 547501231,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1761659978
    },
    {
        "content": "<p>I see that in the DoobMeyer file we have defined martingale part and predictable part of a local submartingale indexed by a general linearly ordered set. May I assume that the martingale part of a submartingale is indeed a martingale (in order to prove <a href=\"https://remydegenne.github.io/brownian-motion/blueprint/chap-filtration_martingale.html#lem:uniformIntegrable_stoppedValue_submartingale\">https://remydegenne.github.io/brownian-motion/blueprint/chap-filtration_martingale.html#lem:uniformIntegrable_stoppedValue_submartingale</a>)?</p>",
        "id": 560712871,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1764310366
    },
    {
        "content": "<p>That lemma is about a process indexed by a discrete time, so you should use the discrete time Doob decomposition, in Mathlib: <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html#MeasureTheory.martingalePart\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html#MeasureTheory.martingalePart</a>.<br>\nIt may be used somewhere in the proof of Doob-Meyer, so don't use the Doob-Meyer decomposition.</p>",
        "id": 560713848,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764310989
    },
    {
        "content": "<p>I see the Lean statement has a generic countable index set, which does not correspond to what is used by that definition. Modify the Lean statement, probably?</p>",
        "id": 560714398,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764311360
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> you added the Lean statement. What generality do you need downstream?</p>",
        "id": 560714454,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764311399
    },
    {
        "content": "<p>It is certainly doable to use results in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html#MeasureTheory.martingalePart\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html#MeasureTheory.martingalePart</a> to prove <code>uniformIntegrable_stoppedValue_submartingale</code> for processes indexed by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{N}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">N</span></span></span></span>, but I am just not sure what I should do if I need to prove it for a general linearly ordered set.</p>",
        "id": 560714597,
        "sender_full_name": "Yongxi Lin (Aaron)",
        "timestamp": 1764311479
    },
    {
        "content": "<p>Another option, without having checked whether it has a chance to work: try to follow the same proof as the martingale result, modifying an equality to an inequality somewhere? (I don't have time right now to check if that makes sense with that proof)</p>",
        "id": 560714829,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764311659
    },
    {
        "content": "<p>I copied down the hypotheses of the discrete optional sampling for martingales, but we only have Doob decompostion for <code>Nat</code>-indexed processes. As I said <a href=\"#narrow/channel/509433-Brownian-motion/topic/Optional.20sampling.20for.20submartingales/with/554876452\">here</a> I thought of adapting the proof for the martingale case as Rémy suggests, but it was suggested to use Doob-Meyer and I did not realize at the time that we would need a general index set so I went with that. I think it's a shame that we can't easily deduce results for discrete index from results about <code>Nat</code> though, to me that would be the best way to go in the long run.</p>",
        "id": 560742545,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764322732
    },
    {
        "content": "<p>Well first we have to be careful about what we mean with \"discrete index\". For me it meant an index in which every point is isolated, basically a subset of <code>Int</code>. And my WIP refactor of the Doob decomposition mentioned above would work for those (or subsets of <code>Nat</code> perhaps). But you are talking about a countable linear order, which is more general.</p>",
        "id": 560743203,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764322951
    },
    {
        "content": "<p>Ah but I think I must have forgotten a <code>LocallyFiniteOrder</code> hypothesis then.</p>",
        "id": 560743679,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764323124
    },
    {
        "content": "<p>So my suggestion in the other thread to use the Doob decomposition was for discrete in that sense. But for countable perhaps following the martingale proof is the best way. If we really nead the result for something more general than a subset of Nat, that is.</p>",
        "id": 560743734,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764323142
    },
    {
        "content": "<p>No I think we only need this for a subset of Nat, for the case where every point is isolated. The proof I had in mind for continuous time optional sampling for submartingales was to do the same as the one for martingales, which does require optional sampling in discrete time (in the sense of a subset of Nat, <a href=\"https://remydegenne.github.io/brownian-motion/docs/Mathlib/Probability/Martingale/OptionalSampling.html#MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp\">MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp</a>). But as the proof of discrete time optional sampling was quite long I wondered if there wasn't an easier way which is why I opened <a class=\"stream-topic\" data-stream-id=\"509433\" href=\"/#narrow/channel/509433-Brownian-motion/topic/Optional.20sampling.20for.20submartingales/with/554876452\">#Brownian motion &gt; Optional sampling for submartingales</a>  in the first place. Rémy if you think that <a href=\"https://github.com/leanprover-community/mathlib4/pull/31008\">#31008</a> would allow us to do that using only Doob-Meyer for Nat processes then I think it's the way to go. Otherwise we have to copy the proof of the martingale case.</p>",
        "id": 560745003,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764323553
    },
    {
        "content": "<p>I'm tempted to use the copy and paste approach. Because it's doable without waiting for the refactor, <del>and because it gives a more general result (which we might not really need, but that's still nice)</del>.<br>\nAnd in Lean copy-paste is fast.</p>",
        "id": 560745713,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764323777
    },
    {
        "content": "<p>But I did not look at how much we would need to copy, so it might be underestimating it badly. I have to attend a seminar now so I'll come back to this discussion later.</p>",
        "id": 560746193,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764323919
    },
    {
        "content": "<p>Indeed copy paste is fast, although less nice <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span>, but it is probably the easier way indeed. Why do you think it would give a more general result? The hypotheses on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ι</mi></mrow><annotation encoding=\"application/x-tex\">\\iota</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ι</span></span></span></span> in <a href=\"https://remydegenne.github.io/brownian-motion/docs/Mathlib/Probability/Martingale/OptionalSampling.html#MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp\">MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp</a> are quite restrictive.</p>",
        "id": 560746280,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764323945
    },
    {
        "content": "<p>My bad, I got confused.</p>",
        "id": 560747784,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764324379
    },
    {
        "content": "<p>I copied the martingale proof in <a href=\"https://github.com/leanprover-community/mathlib4/pull/32204\">#32204</a>, it works like a charm!</p>",
        "id": 560773364,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764332517
    },
    {
        "content": "<p>Actually it looks like we have a problem, because if we do not assume that the index type satisfies <code>LocallyFiniteOrderBot</code> (which I think we don't want to because otherwise our approximations of stopping time must behave nicely and this should be painful) then we don't have integrability of the stopped value of a submartingale. But this can be solved if we assume that the submartingale is nonnegative. We need optional sampling of submartingales to show that nonnegative càdlàg submartingales are of class DL, so we can assume nonnegativity and things should work.</p>",
        "id": 560804722,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764341941
    },
    {
        "content": "<p>Well I can't get it to work... The proof of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/OptionalSampling.html#MeasureTheory.Martingale.stoppedValue_ae_eq_condExp_of_le_of_countable_range\">MeasureTheory.Martingale.stoppedValue_ae_eq_condExp_of_le_of_countable_range</a> does not work.</p>",
        "id": 560835318,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764352289
    },
    {
        "content": "<p>Yes, I looked at it a bit and apparently when we downgrade all equalities to inequalities at that point one of them is the wrong way. Well... back to the Doob decomposition proof then! That means I have to actually finish that refactor. I was hoping not, because it's full of boring lemmas that I am duplicating from Nat to the more general \"subset of Nat\" order assumption list.</p>\n<p>Unrelated remark: was that optional sampling file written before filter_upwards was available? (or perhaps simply before I became aware of it?) It's full of EventuallyEq.trans and other things I would never use any more.</p>",
        "id": 560847586,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1764359221
    },
    {
        "content": "<p>I had a closer look at how <span class=\"user-mention\" data-user-id=\"243312\">@Kexing Ying</span> formalized optional sampling in continuous time and I fear that the refactor might not be enough, because we don't want to assume <code>LocallyFiniteOrder</code>. I am not sure though, what do you think <span class=\"user-mention\" data-user-id=\"243312\">@Kexing Ying</span>?</p>",
        "id": 560847819,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764359355
    },
    {
        "content": "<p>Sorry, I've not followed this conversation so I'm not sure if I understand the issue. Why does <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/OptionalSampling.html#MeasureTheory.Martingale.stoppedValue_ae_eq_condExp_of_le_of_countable_range\">MeasureTheory.Martingale.stoppedValue_ae_eq_condExp_of_le_of_countable_range</a> not generalize to the submartingale case?</p>",
        "id": 560906988,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764415452
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"350992\">Rémy Degenne</span> <a href=\"#narrow/channel/509433-Brownian-motion/topic/Debut.20theorem.20and.20Doob-Meyer.20decomposition/near/560847586\">said</a>:</p>\n<blockquote>\n<p>Unrelated remark: was that optional sampling file written before filter_upwards was available? (or perhaps simply before I became aware of it?) It's full of EventuallyEq.trans and other things I would never use any more.</p>\n</blockquote>\n<p>PS. it was after <code>filter_upwards</code> as indicated <a href=\"https://github.com/leanprover-community/mathlib3/pull/14065/files#diff-7ae10a2b23679c0889e9843b7d688160975823abed4fc9eb08ff03d36d8c6754R216\">here</a></p>",
        "id": 560907056,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764415503
    },
    {
        "content": "<p>The proof uses a chain of equalities which become inequalities in the submartingale case, and those inequalities are not in the right direction.</p>",
        "id": 560907092,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764415526
    },
    {
        "content": "<p>Ah, I see... Is this the same case even for <code>Nat</code> indexed processes?</p>",
        "id": 560907151,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764415573
    },
    {
        "content": "<p>For <code>Nat</code> indexed processes we can prove the theorem directly using Doob's decomposition. In <a href=\"https://github.com/leanprover-community/mathlib4/pull/31008\">#31008</a> Rémy started a refactor to generalize this to an arbitrary index set which is a subset of <code>Nat</code> (in particular it is a locally finite order). But I am wondering if, in your proof of optional sampling in continuous time, having this hypothesis was fine. My feeling is that it's not the case since you don't want to have to check whether your approximations of stopping times have locally finite ranges?</p>",
        "id": 560907430,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764415736
    },
    {
        "content": "<p>Ah, I see. So the issue is that we can't necessarily have an order embedding from a countable set to a locally finite order.</p>",
        "id": 560907740,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764415931
    },
    {
        "content": "<p>I think so.</p>",
        "id": 560907797,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764415975
    },
    {
        "content": "<p>In that case, should we change the definition of  <code>DiscreteApproxSequence</code> so that it requires that the range of the approximating stopping times to have an order embedding into <code>Nat</code>?</p>",
        "id": 560907902,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764416058
    },
    {
        "content": "<p>I guess one solution might be to ensure that the stopping times in an <code>ApproximationSequence</code> have locally finite range. I don't know if this would make the final result weaker or not.</p>",
        "id": 560907907,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764416067
    },
    {
        "content": "<p>Yes this seems a good idea.</p>",
        "id": 560907961,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764416109
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"703970\">Etienne Marion</span> <a href=\"#narrow/channel/509433-Brownian-motion/topic/Debut.20theorem.20and.20Doob-Meyer.20decomposition/near/560907907\">said</a>:</p>\n<blockquote>\n<p>I don't know if this would make the final result weaker or not.</p>\n</blockquote>\n<p>As we need the time index to be a linear order anyway, I can't think of any candidates which are not \"approximable\" wrt the old definition but not with the new one</p>",
        "id": 560908115,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1764416277
    },
    {
        "content": "<p>Yes I think even if there is a loss of generality (which is not clear at all) it won't be a problem.</p>",
        "id": 560908189,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1764416356
    }
]