[
    {
        "content": "<p>In the blueprint there is only the optional sampling theorem for martingales, but wouldn't we need it for submartingales too? It is used to prove <a href=\"https://remydegenne.github.io/brownian-motion/blueprint/sect0004.html#lem:Submartingale.classDL\">this lemma</a> on <a href=\"https://almostsuremath.com/2009/12/22/class-d-processes/\">almostsuremath</a>. I am wondering if we could not adapt the proof for martingales (which is in mathlib in discrete time) to submartingales, then deduce it for supermartingales and then deduce it for martingales. Then we can do the same in continuous time.</p>",
        "id": 554577033,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1762707834
    },
    {
        "content": "<p>About \"deduce for martingales\": in <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/OptionalSampling.html#MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp\">MeasureTheory.Martingale.stoppedValue_min_ae_eq_condExp</a> there is no order on <code>E</code>, so you can't say that a martingale is a submartingale.</p>",
        "id": 554578328,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1762709077
    },
    {
        "content": "<p>Ah right.</p>",
        "id": 554578341,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1762709092
    },
    {
        "content": "<p>But I think we can use the Doob decomposition (<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Probability/Martingale/Centering.html</a>) to prove the submartingale discrete time result from the martingale one?</p>",
        "id": 554578801,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1762709510
    },
    {
        "content": "<p>And I asked GPT5 for a sketch of  proof (sorry if it ends up being AI slop):</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Yes</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">In</span><span class=\"w\"> </span><span class=\"n\">discrete</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">Doob</span><span class=\"w\"> </span><span class=\"n\">decomposition</span><span class=\"w\"> </span><span class=\"n\">gives</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">very</span><span class=\"w\"> </span><span class=\"n\">quick</span><span class=\"w\"> </span><span class=\"n\">proof</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Setup</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Let</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">X_n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">integrable</span><span class=\"w\"> </span><span class=\"n\">submartingale</span><span class=\"w\"> </span><span class=\"n\">adapted</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F_n</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Let</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">bounded</span><span class=\"w\"> </span><span class=\"n\">stopping</span><span class=\"w\"> </span><span class=\"n\">times</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"k\">assume</span><span class=\"w\"> </span><span class=\"n\">uniform</span><span class=\"w\"> </span><span class=\"n\">integrability</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">truncations</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Doob</span><span class=\"w\"> </span><span class=\"n\">decomposition</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Write</span><span class=\"w\"> </span><span class=\"n\">X_n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">M_n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">A_n</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M_n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">martingale</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">predictable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A_n</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">F_</span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"bp\">-</span><span class=\"n\">measurable</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">increasing</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">A_0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">0.</span>\n\n<span class=\"n\">Proof</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">By</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">OST</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">martingales</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">M_T</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">F_S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">M_S</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Since</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">increasing</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">we</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">A_T</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">A_S</span><span class=\"w\"> </span><span class=\"n\">almost</span><span class=\"w\"> </span><span class=\"n\">surely</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hence</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">A_T</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">F_S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">A_S</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Therefore</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">X_T</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">F_S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">M_T</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">F_S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">A_T</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">F_S</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">M_S</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">A_S</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">X_S</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">Taking</span><span class=\"w\"> </span><span class=\"n\">expectations</span><span class=\"w\"> </span><span class=\"n\">gives</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">X_T</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"o\">[</span><span class=\"n\">X_S</span><span class=\"o\">]</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Remarks</span><span class=\"o\">:</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">predictable</span><span class=\"w\"> </span><span class=\"n\">increasing</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">don</span><span class=\"bp\">’</span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">stopping</span><span class=\"bp\">-</span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">trick</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A_T</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"n\">A_S</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">follows</span><span class=\"w\"> </span><span class=\"n\">immediately</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">pathwise</span><span class=\"w\"> </span><span class=\"n\">monotonicity</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">.</span>\n<span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">For</span><span class=\"w\"> </span><span class=\"n\">unbounded</span><span class=\"w\"> </span><span class=\"n\">stopping</span><span class=\"w\"> </span><span class=\"n\">times</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"w\"> </span><span class=\"n\">prove</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">∧</span><span class=\"n\">n</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">∧</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">∞</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">uniform</span><span class=\"w\"> </span><span class=\"n\">integrability</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">standard</span><span class=\"w\"> </span><span class=\"n\">integrability</span><span class=\"w\"> </span><span class=\"n\">conditions</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">martingale</span><span class=\"w\"> </span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"n\">uses</span><span class=\"w\"> </span><span class=\"n\">your</span><span class=\"w\"> </span><span class=\"n\">martingale</span><span class=\"w\"> </span><span class=\"n\">OST</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"bp\">-</span><span class=\"n\">part</span><span class=\"w\"> </span><span class=\"n\">uses</span><span class=\"w\"> </span><span class=\"n\">monotone</span><span class=\"w\"> </span><span class=\"n\">convergence</span><span class=\"w\"> </span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">increasing</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 554579070,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1762709761
    },
    {
        "content": "<p>The proof looks correct to me. I will add it to the blueprint and rewrite the continuous version to use it</p>",
        "id": 554876126,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1762855370
    },
    {
        "content": "<p>Etienne is working on class D/DL and probably also on this since it's a prerequisite, so perhaps it's best to leave it to him.</p>",
        "id": 554876319,
        "sender_full_name": "Rémy Degenne",
        "timestamp": 1762855427
    },
    {
        "content": "<p>Okay</p>",
        "id": 554876452,
        "sender_full_name": "Kexing Ying",
        "timestamp": 1762855467
    }
]