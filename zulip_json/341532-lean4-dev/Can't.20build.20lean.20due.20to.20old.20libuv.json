[
    {
        "content": "<p>Currently building lean on ubuntu results in:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>cmake<span class=\"w\"> </span>--preset<span class=\"w\"> </span>release\n<span class=\"gp\">$ </span>make<span class=\"w\"> </span>-C<span class=\"w\"> </span>build/release\n<span class=\"go\">...</span>\n<span class=\"go\">/home/mario/Documents/lean/lean4/stage0/src/runtime/uv/system.cpp: In function ‘lean_object* lean::lean_uv_os_get_group(uint64_t, lean::obj_arg)’:</span>\n<span class=\"go\">/home/mario/Documents/lean/lean4/stage0/src/runtime/uv/system.cpp:197:5: error: ‘uv_group_t’ was not declared in this scope; did you mean ‘uv_loop_t’?</span>\n<span class=\"go\">  197 |     uv_group_t group;</span>\n<span class=\"go\">      |     ^~~~~~~~~~</span>\n<span class=\"go\">      |     uv_loop_t</span>\n<span class=\"go\">/home/mario/Documents/lean/lean4/stage0/src/runtime/uv/system.cpp:198:35: error: ‘group’ was not declared in this scope</span>\n<span class=\"go\">  198 |     int result = uv_os_get_group(&amp;group, gid);</span>\n<span class=\"go\">      |                                   ^~~~~</span>\n<span class=\"go\">/home/mario/Documents/lean/lean4/stage0/src/runtime/uv/system.cpp:198:18: error: ‘uv_os_get_group’ was not declared in this scope; did you mean ‘lean_uv_os_get_group’?</span>\n<span class=\"go\">  198 |     int result = uv_os_get_group(&amp;group, gid);</span>\n<span class=\"go\">      |                  ^~~~~~~~~~~~~~~</span>\n<span class=\"go\">      |                  lean_uv_os_get_group</span>\n</code></pre></div>\n<p>I traced the issue down to an <a href=\"https://github.com/libuv/libuv/commit/2f110a50dfc7cfa60b9b8345473aba7a0bba5a19\">addition to libuv</a> which is available only in v1.45.0+, while apt only has 1.43:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>sudo<span class=\"w\"> </span>apt<span class=\"w\"> </span>install<span class=\"w\"> </span>libuv1-dev\n<span class=\"go\">Reading package lists... Done</span>\n<span class=\"go\">Building dependency tree... Done</span>\n<span class=\"go\">Reading state information... Done</span>\n<span class=\"go\">libuv1-dev is already the newest version (1.43.0-1ubuntu0.1).</span>\n<span class=\"go\">0 upgraded, 0 newly installed, 0 to remove and 108 not upgraded.</span>\n</code></pre></div>",
        "id": 532030808,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753955984
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"481858\">@Sofia Rodrigues</span></p>",
        "id": 532031270,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753956113
    },
    {
        "content": "<p>When you say \"apt only has\" I assume you are using ubuntu 22.04 or older as every release after that has compatible versions yes?</p>",
        "id": 532031524,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1753956196
    },
    {
        "content": "<p>yep, it's 22.04</p>",
        "id": 532031733,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753956250
    },
    {
        "content": "<p>I guess that opens the question of what versions of popular Linux distros Lean wants to support then</p>",
        "id": 532031840,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1753956283
    },
    {
        "content": "<p>it wouldn't be that hard to just fail at runtime here in the worst case, the function in question isn't even used</p>",
        "id": 532032129,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753956356
    },
    {
        "content": "<p>We already have conditional compilation to support both libuv pre-1.45.0 and post-1.45.0 in at least one other place, so I'll prepare a fix that does the same in this case.</p>",
        "id": 532047897,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1753961251
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> The fix and the corresponding stage0 update have now landed on master, so please let me know if you're still having problems on the latest master.</p>",
        "id": 532087009,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1753971430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260921\">@Markus Himmel</span> Progress, but it still has problems. It fails at <a href=\"https://github.com/leanprover/lean4/blob/9b186297c7ba5fdf8132a27bdb465c926ad19d45/src/runtime/uv/system.cpp#L522\"><code>uv_get_available_memory()</code></a> (also added in 1.45)</p>",
        "id": 532125873,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753981342
    },
    {
        "content": "<p>I added a similar ifdef as in <a href=\"https://github.com/leanprover/lean4/pull/9644\">lean4#9644</a> and it seems to be building</p>",
        "id": 532127141,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753981698
    },
    {
        "content": "<p>Thanks for checking. I'm not at a computer right now, but happy to merge a PR that's analogous go 9644</p>",
        "id": 532128559,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1753982126
    },
    {
        "content": "<p>did you update stage0? The changes I needed to make are actually to the stage0 versions of the cpp files</p>",
        "id": 532129050,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753982281
    },
    {
        "content": "<p>Yes, I triggered a stage0 update after the PR was merged</p>",
        "id": 532130324,
        "sender_full_name": "Markus Himmel",
        "timestamp": 1753982677
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/9652\">lean4#9652</a></p>",
        "id": 532134283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1753983985
    }
]