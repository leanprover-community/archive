[
    {
        "content": "<p>I am trying to build Lean from source (commit 573d824b81). Following <a href=\"https://github.com/leanprover/lean4/blob/master/doc/make/index.md\">the build instructions</a>, I have run <code>cmake --preset release</code> and <code>make -C build/release -j 4</code> in the <code>lean4</code> directory cloned from Github. <code>make</code> exits printing <code>Error 2</code>. The <a href=\"/user_uploads/3121/gyYp2FmnFeo3OIUUi4YE96C8/makeoutput.txt\">full make output</a> has many errors similar to</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"bp\">/</span><span class=\"n\">c</span><span class=\"bp\">++/</span><span class=\"mf\">14.2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">/</span><span class=\"n\">cmath</span><span class=\"o\">:</span><span class=\"mi\">89</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">acos</span><span class=\"bp\">’</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">declared</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">‘::’</span>\n<span class=\"w\">   </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"n\">acos</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\">           </span><span class=\"bp\">^~~~</span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">optional</span><span class=\"bp\">.</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"mi\">34</span><span class=\"o\">:</span><span class=\"mi\">35</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">move</span><span class=\"bp\">’</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">member</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">lean</span><span class=\"bp\">::</span><span class=\"n\">std</span><span class=\"bp\">’;</span><span class=\"w\"> </span><span class=\"n\">did</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">std</span><span class=\"bp\">::</span><span class=\"n\">move</span><span class=\"bp\">’?</span>\n<span class=\"w\">   </span><span class=\"mi\">34</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\">             </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">&amp;</span><span class=\"n\">m_value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">(</span><span class=\"n\">std</span><span class=\"bp\">::</span><span class=\"n\">move</span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"bp\">.</span><span class=\"n\">m_value</span><span class=\"o\">))</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\">                                   </span><span class=\"bp\">^~~~</span>\n</code></pre></div>\n<p>I'd be grateful for help understanding why the compilation is failing!<br>\nI'm running up-to-date Arch Linux, and make seems to be running <code>cc</code> which is gcc 14.2.1 on my machine; I'm not sure which other information is relevant.</p>",
        "id": 514844332,
        "sender_full_name": "Simon Dima",
        "timestamp": 1745854253
    },
    {
        "content": "<p>Here is the <br>\n<a href=\"/user_uploads/3121/QkDj0vsKFdH5vEj1erIBWZv4/makeverbose.txt\">more detailed output</a><br>\n of <code>VERBOSE=1 make -C build/release -j 1 &amp;&gt; makeverbose.txt</code>.<br>\nBelow is the first error, together with the actual C++ compiler command being run.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"bp\">%</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">Building</span><span class=\"w\"> </span><span class=\"n\">CXX</span><span class=\"w\"> </span><span class=\"n\">object</span><span class=\"w\"> </span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">CMakeFiles</span><span class=\"bp\">/</span><span class=\"n\">leanrt_initial</span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"bp\">.</span><span class=\"n\">o</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"w\"> </span><span class=\"bp\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">ccache</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">c</span><span class=\"bp\">++</span><span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">I</span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">release</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/../</span><span class=\"n\">mimalloc</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">mimalloc</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">LEAN_USE_GMP</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Wall</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">Wextra</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">std</span><span class=\"bp\">=</span><span class=\"n\">c</span><span class=\"bp\">++</span><span class=\"mi\">14</span><span class=\"w\">  </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">LEAN_MMAP</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">LEAN_MULTI_THREAD</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">LEAN_AUTO_THREAD_FINALIZATION</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">DLEAN_BUILD_TYPE</span><span class=\"bp\">=</span><span class=\"s2\">\"Release\"</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">DLEAN_EXPORTING</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">fPIC</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">ftls</span><span class=\"bp\">-</span><span class=\"n\">model</span><span class=\"bp\">=</span><span class=\"n\">initial</span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">fvisibility</span><span class=\"bp\">=</span><span class=\"n\">hidden</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">fvisibility</span><span class=\"bp\">-</span><span class=\"n\">inlines</span><span class=\"bp\">-</span><span class=\"n\">hidden</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">O3</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">DNDEBUG</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">MD</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">MT</span><span class=\"w\"> </span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">CMakeFiles</span><span class=\"bp\">/</span><span class=\"n\">leanrt_initial</span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">MF</span><span class=\"w\"> </span><span class=\"n\">CMakeFiles</span><span class=\"bp\">/</span><span class=\"n\">leanrt_initial</span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">CMakeFiles</span><span class=\"bp\">/</span><span class=\"n\">leanrt_initial</span><span class=\"bp\">-</span><span class=\"n\">exec</span><span class=\"bp\">.</span><span class=\"n\">dir</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"bp\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span>\n<span class=\"n\">In</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">included</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"bp\">/</span><span class=\"n\">c</span><span class=\"bp\">++/</span><span class=\"mf\">14.2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">/</span><span class=\"n\">math</span><span class=\"bp\">.</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"o\">,</span>\n<span class=\"w\">                 </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"bp\">/</span><span class=\"n\">uv</span><span class=\"bp\">.</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"mi\">61</span><span class=\"o\">,</span>\n<span class=\"w\">                 </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">uv</span><span class=\"bp\">/</span><span class=\"n\">event_loop</span><span class=\"bp\">.</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"mi\">18</span><span class=\"o\">,</span>\n<span class=\"w\">                 </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">libuv</span><span class=\"bp\">.</span><span class=\"n\">h</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"o\">,</span>\n<span class=\"w\">                 </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">redacted</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">/</span><span class=\"n\">stage0</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">runtime</span><span class=\"bp\">/</span><span class=\"n\">init_module</span><span class=\"bp\">.</span><span class=\"n\">cpp</span><span class=\"o\">:</span><span class=\"mi\">16</span><span class=\"o\">:</span>\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"bp\">/</span><span class=\"n\">c</span><span class=\"bp\">++/</span><span class=\"mf\">14.2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">/</span><span class=\"n\">cmath</span><span class=\"o\">:</span><span class=\"mi\">89</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">acos</span><span class=\"bp\">’</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">declared</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">‘::’</span>\n<span class=\"w\">   </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"n\">acos</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\">           </span><span class=\"bp\">^~~~</span>\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">include</span><span class=\"bp\">/</span><span class=\"n\">c</span><span class=\"bp\">++/</span><span class=\"mf\">14.2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"bp\">/</span><span class=\"n\">cmath</span><span class=\"o\">:</span><span class=\"mi\">108</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‘</span><span class=\"n\">asin</span><span class=\"bp\">’</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">declared</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">‘::’</span>\n<span class=\"w\">  </span><span class=\"mi\">108</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"n\">asin</span><span class=\"bp\">;</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\">           </span><span class=\"bp\">^~~~</span>\n</code></pre></div>\n<p>I don't see anything directly suspicious here, <code>-std=c++14</code> is in there and <code>/usr/bin/c++</code> is GCC on my system, and the included paths seem reasonable.</p>\n<p>As an upper bound on the cursedness of my computer, I tried compiling two random c++ projects from GitHub (<a href=\"https://github.com/Rinzii/ccmath\">ccmath</a> and <a href=\"https://github.com/skypjack/uvw\">uvw</a>), which did succeed, so at least the predicate \"can I compile this?\" is not just universally false. This makes my failure with Lean more interesting, further research is needed to look for other codebases which fail in similar ways.</p>\n<p>Does Lean assume any specific version of CMake? I have CMake 4.0.1, which (its reference warns) breaks compatibility with CMake versions older than 3.5.</p>",
        "id": 515112294,
        "sender_full_name": "Simon Dima",
        "timestamp": 1745944801
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span>, are you perchance an appropriate person to ask for help about this? I see on GitHub that you've edited <code>CMakeLists.txt</code> and <code>doc/make/index.md</code> relatively recently</p>",
        "id": 515113679,
        "sender_full_name": "Simon Dima",
        "timestamp": 1745945209
    },
    {
        "content": "<p>I'm afraid I'm just as puzzled as you. My C++ is not strong enough to even make a guess.</p>",
        "id": 515113781,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1745945240
    },
    {
        "content": "<p>Thanks for taking a look! Is there a canonical reference person I could ask?</p>",
        "id": 515114196,
        "sender_full_name": "Simon Dima",
        "timestamp": 1745945384
    },
    {
        "content": "<p>Someone who knows more C++? I'm afraid I can't point you to a specific person</p>",
        "id": 515114412,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1745945449
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/8166\">#8166</a> and the following stage0 update solved this, marking as resolved</p>",
        "id": 515305501,
        "sender_full_name": "Simon Dima",
        "timestamp": 1746019770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"893179\">Simon Dima</span> has marked this topic as resolved.</p>",
        "id": 515305530,
        "sender_full_name": "Notification Bot",
        "timestamp": 1746019776
    }
]