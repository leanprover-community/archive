[
    {
        "content": "<p>I am trying to build Lean 4 from source to submit a small PR.  I am following the instructions <a href=\"https://lean-lang.org/lean4/doc/make/index.html\">here</a>.</p>\n<p>I've installed nix and cloned the repo but after running <code>nix develop</code> I get errors along with</p>\n<p><strong>trace: warning: The Nix-based build is deprecated</strong></p>\n<p>Is this build not supported anymore, or am I doing something wrong?</p>",
        "id": 471985601,
        "sender_full_name": "Tom",
        "timestamp": 1726962841
    },
    {
        "content": "<p>there are build instructions both with and without nix</p>",
        "id": 471988810,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726965786
    },
    {
        "content": "<p>you should use the one appropriate for your OS</p>",
        "id": 471988822,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1726965799
    },
    {
        "content": "<p>yeah, I think I can make that work but was curious if the Nix build (which is supposed to work on MacOS, Linux and Windows) is actually deprecated or if I'm doing something wrong.</p>",
        "id": 472016830,
        "sender_full_name": "Tom",
        "timestamp": 1726985461
    },
    {
        "content": "<p>Merely using the dev shell is not deprecated, the warning is just overzealous</p>",
        "id": 472018348,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1726986679
    },
    {
        "content": "<p>Thanks for confirming!</p>",
        "id": 472021343,
        "sender_full_name": "Tom",
        "timestamp": 1726989015
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"515083\">Tom</span> has marked this topic as resolved.</p>",
        "id": 472067847,
        "sender_full_name": "Notification Bot",
        "timestamp": 1727027646
    },
    {
        "content": "<p>FWIW, the nix instructions didn't \"just work\" for me on MacOS so I built Lean following the \"manual\" steps and submitted the PR that way.  Unfortunately, I don't know enough about Nix and the Nix lean setup to help fix the issue but just FYI.</p>",
        "id": 472087182,
        "sender_full_name": "Tom",
        "timestamp": 1727041480
    },
    {
        "content": "<p>I made a Lean 4 nix flake here: <a href=\"https://github.com/lenianiva/lean4-nix\">https://github.com/lenianiva/lean4-nix</a></p>",
        "id": 478812295,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1729811183
    },
    {
        "content": "<p>What is the step between running <code>nix develop</code> and getting a lean binary?</p>",
        "id": 488026166,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733899412
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> has marked this topic as unresolved.</p>",
        "id": 488026177,
        "sender_full_name": "Notification Bot",
        "timestamp": 1733899418
    },
    {
        "content": "<p>In particular, the suggested</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"c1\"># in the Lean rootdir</span>\nelan<span class=\"w\"> </span>toolchain<span class=\"w\"> </span>link<span class=\"w\"> </span>lean4<span class=\"w\"> </span>build/release/stage1\nelan<span class=\"w\"> </span>toolchain<span class=\"w\"> </span>link<span class=\"w\"> </span>lean4-stage0<span class=\"w\"> </span>build/release/stage0\n</code></pre></div>\n<p>commands don't work because <code>build/release</code> isn't actually created by <code>nix develop</code></p>",
        "id": 488026834,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733899728
    },
    {
        "content": "<p>Ah, <code>nix develop .#test</code> seems to make progress</p>",
        "id": 488027587,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733900076
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/341532-lean4-dev/topic/Lean4.20nix.20build.3F/near/488026166\">said</a>:</p>\n<blockquote>\n<p>What is the step between running <code>nix develop</code> and getting a lean binary?</p>\n</blockquote>\n<p>The generic build instructions shared with all other platforms</p>",
        "id": 488030756,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733901672
    },
    {
        "content": "<p>Oh, I read \"that's it\" as \"you can stop reading all further instructions\".</p>",
        "id": 488046182,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733907395
    },
    {
        "content": "<p><code>nix develop</code> just puts you in a shell that has all the right dependencies in PATH, but you still have to do the actual build</p>",
        "id": 488093202,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1733922222
    },
    {
        "content": "<p>I can see how the wording is not ideal :)</p>",
        "id": 488095316,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733922823
    },
    {
        "content": "<p>I guess I was hoping I could somehow use nix to get a cached build rather than having to wait for a full compile</p>",
        "id": 488162355,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1733942233
    },
    {
        "content": "<p>(I had the same question a while ago but didn't get a good answer - or at least one I could understand, given that I don't really use nix.  Also, I think I had the same misunderstanding as you <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span>)</p>\n<p>Having said that, the non-nix build instructions are pretty good.  Especially if you install ccache, the (incremental) builds are pretty quick.</p>",
        "id": 488163752,
        "sender_full_name": "Tom",
        "timestamp": 1733942722
    },
    {
        "content": "<p>haha, I didn't notice you revived my old thread!</p>",
        "id": 488164389,
        "sender_full_name": "Tom",
        "timestamp": 1733942956
    }
]