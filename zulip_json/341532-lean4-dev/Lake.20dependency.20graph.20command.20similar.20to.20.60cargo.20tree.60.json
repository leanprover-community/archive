[
    {
        "content": "<p>What do others think of a Lake command that uses the Lake workspace to generate and display a dependency tree,  similar to <a href=\"https://doc.rust-lang.org/cargo/commands/cargo-tree.html\"><code>cargo tree</code></a>?  Is something like this in the current roadmap? Or am I missing an existing alternative?</p>\n<p>This seems like it could be generally useful for troubleshooting and integration with other tools. I know of two specific places where this would be useful to have easy access to Lake dependencies:</p>\n<ul>\n<li>detecting Mathlib dependencies in lean-action (currently done brittlely by greping <code>lakefile.lean</code> and <code>lakefile.toml</code>)</li>\n<li>detecting default target for running the std linter (I am trying to do this using Lake's internal API, but there are downsides to that approach raised by <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>  <a href=\"https://github.com/leanprover-community/batteries/pull/811#issuecomment-2252813723\">here</a>)</li>\n</ul>",
        "id": 454957854,
        "sender_full_name": "Austin Letson",
        "timestamp": 1722290046
    },
    {
        "content": "<p>It's a nice feature just in general. Very useful even in moderately sized formalisation projects</p>",
        "id": 454963463,
        "sender_full_name": "Shreyas Srinivas",
        "timestamp": 1722292090
    },
    {
        "content": "<p>Currently, the best way to do this is to read the Lake manifest. Regardless, adding a command like this is definitely a reasonable feature request. I am not sure how soon it would be addressed, though.</p>",
        "id": 455173201,
        "sender_full_name": "Mac Malone",
        "timestamp": 1722359327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac Malone</span> <a href=\"#narrow/stream/341532-lean4-dev/topic/Lake.20dependency.20graph.20command.20similar.20to.20.60cargo.20tree.60/near/455173201\">said</a>:</p>\n<blockquote>\n<p>Currently, the best way to do this is to read the Lake manifest. Regardless, adding a command like this is definitely a reasonable feature request. I am not sure how soon it would be addressed, though.</p>\n</blockquote>\n<p>Ah, thanks for the tip to use the Lake manifest. I need to look into how this would work  for detecting Mathlib dependency since you want to run <code>lake exe cache get</code> before running <code>lake build</code>. I am realizing now, I can just run <code>lake update</code> to generate the manifest  before running <code>lake exe cache get</code>.</p>",
        "id": 455352624,
        "sender_full_name": "Austin Letson",
        "timestamp": 1722424564
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"699684\">@Austin Letson</span> You should only run <code>lake update</code> if the manifest does not already exist. The primary purpose of the manifest is to lock dependencies to a specific version for things like CI, which a <code>lake update</code> undoes (unless, of course, the manifest does not already exist).</p>",
        "id": 455947906,
        "sender_full_name": "Mac Malone",
        "timestamp": 1722608929
    },
    {
        "content": "<p><span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> Okay, I will create an issue to add a step in lean-action that checks to see if the manifest exists and runs <code>lake update</code> before reading the manifest. This is likely an edge case in practice, however, when testing lean-action it is common for the manifest to not exist because I will run <code>lake new test</code> or <code>lake new test math</code> and then immediately run lean-action.</p>",
        "id": 456057706,
        "sender_full_name": "Austin Letson",
        "timestamp": 1722640624
    },
    {
        "content": "<p>A manifest that's not checked into the Git repo is most likely a mistake. So imo <code>lean-action</code> should treat this as an error rather than generate the manifest.</p>",
        "id": 456535458,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1722861968
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"256311\">Jannis Limperg</span> <a href=\"#narrow/stream/341532-lean4-dev/topic/Lake.20dependency.20graph.20command.20similar.20to.20.60cargo.20tree.60/near/456535458\">said</a>:</p>\n<blockquote>\n<p>A manifest that's not checked into the Git repo is most likely a mistake. So imo <code>lean-action</code> should treat this as an error rather than generate the manifest.</p>\n</blockquote>\n<p>The lack of a manifest does seem like an edge case. My assumption here was that lean-action should work on a fresh <code>lake new</code> without generating an error. However, we could add an error that says something like \"you must run <code>lake build</code> to generate a lake manifest\". <span class=\"user-mention\" data-user-id=\"315577\">@Mac Malone</span> what do you think?</p>",
        "id": 456829155,
        "sender_full_name": "Austin Letson",
        "timestamp": 1722943640
    },
    {
        "content": "<p>I think <code>lake update</code> would be the minimal command that generates a manifest. One could maybe also adjust <code>lake new</code> to run <code>lake update</code>. Any of these solutions would be good imo.</p>",
        "id": 456843526,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1722947042
    },
    {
        "content": "<p>Sounds good. I have updated the issue on lean-action to log an error suggesting the user run <code>lake update</code> if there is no manifest.</p>",
        "id": 459469421,
        "sender_full_name": "Austin Letson",
        "timestamp": 1723208785
    }
]