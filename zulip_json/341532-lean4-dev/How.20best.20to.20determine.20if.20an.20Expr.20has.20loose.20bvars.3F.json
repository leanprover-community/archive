[
    {
        "content": "<p>While reviewing <a href=\"https://github.com/leanprover/lean4/pull/5657\">lean4#5657</a>, the question came up if <code>Expr.data</code> also caches whether an expression has loose bvars or not.</p>\n<p>A doc search came up with <code>Expr.hasLooseBVars</code> and <code>Expr.hasLooseBVar</code> (notice the lack of <code>s</code>). The former is an <code>extern</code> function, and (based on a cursory glance) the C++ code seems to traverse the expression, while the latter just checks a field from <code>Expr.data</code> and should thus be cached, correct?</p>\n<p>My question thus:</p>\n<ul>\n<li>It seems to me these functions should always return the same result, is that true?</li>\n<li>Based on the fact that <code>hasLooseBVar</code> is cached, and <code>hasLooseBVars</code> is not, is there a reason to use/prefer the latter? Should we add a docstring to the pointing out it isn't cached, and linking to the former?</li>\n</ul>",
        "id": 487015542,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1733756048
    },
    {
        "content": "<p>Hint: these two functions do not have the same signature :)</p>",
        "id": 487016160,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733756212
    },
    {
        "content": "<p>Ahhh, right, the lack of s is actually significant!</p>",
        "id": 487016425,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1733756279
    },
    {
        "content": "<p>For future reference: <code>Expr.hasLooseBVar</code> also takes in a <code>bvarIdx</code>, and presumably checks for presence of the specified bvar? Whereas <code>hasLooseBVars</code> just returns whether any loose bvars exists</p>",
        "id": 487016892,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1733756373
    },
    {
        "content": "<p>yes</p>",
        "id": 487017418,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1733756485
    },
    {
        "content": "<p>I opened a PR to add docstrings to this effect: <a href=\"https://github.com/leanprover/lean4/pull/6344\">https://github.com/leanprover/lean4/pull/6344</a></p>",
        "id": 487019045,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1733756820
    }
]