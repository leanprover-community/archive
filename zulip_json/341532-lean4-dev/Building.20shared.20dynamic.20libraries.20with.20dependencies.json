[
    {
        "content": "<p>Suppose I have two lean libraries:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>-<span class=\"w\"> </span>liba\n-<span class=\"w\"> </span>libb\n</code></pre></div>\n<p>where <code>liba</code> is standalone, and <code>libb</code> requires <code>liba</code><br>\nboth <code>liba</code> and <code>libb</code> have defaulttargets and defaultfacets setup to produce a shared library:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"libb\"</span>\n<span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"Libb\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Liba\"</span>\n<span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"../liba\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Libb\"</span>\n<span class=\"n\">defaultFacets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"shared\"</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>This works like I want, save for the fact that the <code>libb.dylib</code> shared library fails to be <code>dlopen</code>ed unless I have manually <code>dlopen</code>ed <code>liba.dylib</code>. </p>\n<p>How can I:<br>\na) somehow embed the dependency of <code>liba.dylib</code> into the dynamic library for <code>libb.dylib</code> (I have a hard constraint that <code>libb.dylib</code> must be dynamically loaded via <code>dlopen</code>, so either statically linking <code>liba</code> in, or </p>\n<p>b) providing appropriate path inside the shared library such that <code>liba.dylib</code> can be found by dlopen.</p>\n<p>Furthermore, I'd like to export <code>liba</code> as a library to external users, so they can require it. I'd like to minimise the amount of extra changes they'd have to make to their repo.</p>",
        "id": 560957016,
        "sender_full_name": "Kiran",
        "timestamp": 1764463274
    }
]