[
    {
        "content": "<p>Is there any plans to fix it? When I ran <code>nix build .#packages.x86_64-linux.cacheRoots</code>, I got</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">evaluation</span><span class=\"w\"> </span><span class=\"n\">warning</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">The</span><span class=\"w\"> </span><span class=\"n\">Nix</span><span class=\"bp\">-</span><span class=\"n\">based</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">deprecated</span>\n<span class=\"n\">error</span><span class=\"o\">:</span>\n<span class=\"w\">       </span><span class=\"bp\">…</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">calling</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">derivationStrict'</span><span class=\"w\"> </span><span class=\"n\">builtin</span>\n<span class=\"w\">         </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">derivation</span><span class=\"bp\">-</span><span class=\"n\">internal</span><span class=\"bp\">.</span><span class=\"n\">nix</span><span class=\"bp\">&gt;</span><span class=\"o\">:</span><span class=\"mi\">37</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">36</span><span class=\"bp\">|</span>\n<span class=\"w\">           </span><span class=\"mi\">37</span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"n\">strict</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">derivationStrict</span><span class=\"w\"> </span><span class=\"n\">drvAttrs</span><span class=\"bp\">;</span>\n<span class=\"w\">             </span><span class=\"bp\">|</span><span class=\"w\">            </span><span class=\"bp\">^</span>\n<span class=\"w\">           </span><span class=\"mi\">38</span><span class=\"bp\">|</span>\n\n<span class=\"w\">       </span><span class=\"bp\">…</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">evaluating</span><span class=\"w\"> </span><span class=\"n\">derivation</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">cacheRoots'</span>\n<span class=\"w\">         </span><span class=\"n\">whose</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">located</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">store</span><span class=\"bp\">/</span><span class=\"mi\">5</span><span class=\"n\">w65kvkmrdqv006ci2f5p80s0yghld1i</span><span class=\"bp\">-</span><span class=\"n\">source</span><span class=\"bp\">/</span><span class=\"n\">pkgs</span><span class=\"bp\">/</span><span class=\"n\">stdenv</span><span class=\"bp\">/</span><span class=\"n\">generic</span><span class=\"bp\">/</span><span class=\"n\">make</span><span class=\"bp\">-</span><span class=\"n\">derivation</span><span class=\"bp\">.</span><span class=\"n\">nix</span><span class=\"o\">:</span><span class=\"mi\">438</span><span class=\"o\">:</span><span class=\"mi\">13</span>\n\n<span class=\"w\">       </span><span class=\"bp\">…</span><span class=\"w\"> </span><span class=\"n\">while</span><span class=\"w\"> </span><span class=\"n\">evaluating</span><span class=\"w\"> </span><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">buildCommand'</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">derivation</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">cacheRoots'</span>\n<span class=\"w\">         </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">store</span><span class=\"bp\">/</span><span class=\"mi\">5</span><span class=\"n\">w65kvkmrdqv006ci2f5p80s0yghld1i</span><span class=\"bp\">-</span><span class=\"n\">source</span><span class=\"bp\">/</span><span class=\"n\">pkgs</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">-</span><span class=\"n\">support</span><span class=\"bp\">/</span><span class=\"n\">trivial</span><span class=\"bp\">-</span><span class=\"n\">builders</span><span class=\"bp\">/</span><span class=\"n\">default</span><span class=\"bp\">.</span><span class=\"n\">nix</span><span class=\"o\">:</span><span class=\"mi\">80</span><span class=\"o\">:</span><span class=\"mi\">17</span><span class=\"o\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">79</span><span class=\"bp\">|</span><span class=\"w\">         </span><span class=\"n\">enableParallelBuilding</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">;</span>\n<span class=\"w\">           </span><span class=\"mi\">80</span><span class=\"bp\">|</span><span class=\"w\">         </span><span class=\"n\">inherit</span><span class=\"w\"> </span><span class=\"n\">buildCommand</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"bp\">;</span>\n<span class=\"w\">             </span><span class=\"bp\">|</span><span class=\"w\">                 </span><span class=\"bp\">^</span>\n<span class=\"w\">           </span><span class=\"mi\">81</span><span class=\"bp\">|</span><span class=\"w\">         </span><span class=\"n\">passAsFile</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"s2\">\"buildCommand\"</span><span class=\"w\"> </span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">derivationArgs</span><span class=\"bp\">.</span><span class=\"n\">passAsFile</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"w\"> </span><span class=\"o\">])</span><span class=\"bp\">;</span>\n\n<span class=\"w\">       </span><span class=\"o\">(</span><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">truncated</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"c1\">--show-trace' to show the full, detailed trace)</span>\n\n<span class=\"w\">       </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">result'</span><span class=\"w\"> </span><span class=\"n\">missing</span>\n<span class=\"w\">       </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">store</span><span class=\"bp\">/</span><span class=\"n\">iq0dbcl0rzdkasrcxwbgk3gp1sr21cpq</span><span class=\"bp\">-</span><span class=\"n\">source</span><span class=\"bp\">/</span><span class=\"n\">nix</span><span class=\"bp\">/</span><span class=\"n\">buildLeanPackage</span><span class=\"bp\">.</span><span class=\"n\">nix</span><span class=\"o\">:</span><span class=\"mi\">209</span><span class=\"o\">:</span><span class=\"mi\">119</span><span class=\"o\">:</span>\n<span class=\"w\">          </span><span class=\"mi\">208</span><span class=\"bp\">|</span><span class=\"w\">     </span><span class=\"n\">startSet</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">concatMap</span><span class=\"w\"> </span><span class=\"n\">expandGlob</span><span class=\"w\"> </span><span class=\"n\">roots</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n<span class=\"w\">          </span><span class=\"mi\">209</span><span class=\"bp\">|</span><span class=\"w\">     </span><span class=\"n\">operator</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">modDepsMap</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">key</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">module</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">modCandidates</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">module</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"n\">modDepsMap</span><span class=\"bp\">.$</span><span class=\"o\">{</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">key</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">result</span><span class=\"bp\">.</span><span class=\"n\">imports</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"bp\">;</span>\n<span class=\"w\">             </span><span class=\"bp\">|</span><span class=\"w\">                                                                                                                       </span><span class=\"bp\">^</span>\n<span class=\"w\">          </span><span class=\"mi\">210</span><span class=\"bp\">|</span><span class=\"w\">   </span><span class=\"o\">}))</span><span class=\"bp\">;</span>\n</code></pre></div>",
        "id": 534330580,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755137559
    },
    {
        "content": "<p>The fix is pretty easy. it's just a one-line change</p>",
        "id": 534332113,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755138930
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/pull/9905\">https://github.com/leanprover/lean4/pull/9905</a></p>",
        "id": 534337537,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755143950
    },
    {
        "content": "<p>The entire Nix build got deleted. Now lean4-nix is on its own.</p>",
        "id": 534532116,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755193656
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/The.20Nix.20CI.20is.20broken.20for.20Lean.20v4.2E22.2E0/near/534532116\">said</a>:</p>\n<blockquote>\n<p>The entire Nix build got deleted. Now lean4-nix is on its own.</p>\n</blockquote>\n<p>I rely on <code>nix develop</code> when hacking on the Lean core, does this mean that's now gone or are you just talking about a CI build being deleted?</p>",
        "id": 534619081,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1755247291
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"481133\">Alex Keizer</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/The.20Nix.20CI.20is.20broken.20for.20Lean.20v4.2E22.2E0/near/534619081\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/The.20Nix.20CI.20is.20broken.20for.20Lean.20v4.2E22.2E0/near/534532116\">said</a>:</p>\n<blockquote>\n<p>The entire Nix build got deleted. Now lean4-nix is on its own.</p>\n</blockquote>\n<p>I rely on <code>nix develop</code> when hacking on the Lean core, does this mean that's now gone or are you just talking about a CI build being deleted?</p>\n</blockquote>\n<p>I'm just talking about the CI build. The dev shells will still work</p>",
        "id": 534619699,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755247632
    },
    {
        "content": "<p>Thanks for clarifying!</p>",
        "id": 534619950,
        "sender_full_name": "Alex Keizer",
        "timestamp": 1755247761
    },
    {
        "content": "<blockquote>\n<p>The dev shells will still work</p>\n</blockquote>\n<p>Even without <a href=\"https://github.com/leanprover/lean4/pull/9905\">lean4#9905</a>?</p>",
        "id": 534624963,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755250368
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/The.20Nix.20CI.20is.20broken.20for.20Lean.20v4.2E22.2E0/near/534624963\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>The dev shells will still work</p>\n</blockquote>\n<p>Even without <a href=\"https://github.com/leanprover/lean4/pull/9905\">lean4#9905</a>?</p>\n</blockquote>\n<p>it should be because <a href=\"https://github.com/leanprover-community/mathlib4/pull/9905\">#9905</a> is just about building Lean itself (including stage 0), which doesn't affect operations of the dev shell.</p>",
        "id": 534680732,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1755275575
    }
]