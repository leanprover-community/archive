[
    {
        "content": "<p>Is it possible to have a flag in <code>Elab.Term.Context</code>, when enabled, prevents all instances of the unsafe term elaborator from running?</p>\n<p>This way, we can prevent the execution of arbitrary code during type checking, and it doesn't seem to be very hard to implement.</p>",
        "id": 526697664,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751413540
    },
    {
        "content": "<p>e.g. <a href=\"https://github.com/lenianiva/lean4/commit/50ebee39e2a0fa09b1b1bb9e983384c6d7df124c\">https://github.com/lenianiva/lean4/commit/50ebee39e2a0fa09b1b1bb9e983384c6d7df124c</a></p>",
        "id": 526702316,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751417482
    },
    {
        "content": "<p>This will not prevent arbitrary codes in top-level declarations, but it can prevent such behaviour during type checking of proofs.</p>",
        "id": 526702345,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751417512
    },
    {
        "content": "<p>What meaning of \"unsafe\" do you intend here?</p>",
        "id": 526703184,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418141
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/Unsafe.20prohibition.20flag.20in.20.60Elab.2ETerm.2EContext.60/near/526703184\">said</a>:</p>\n<blockquote>\n<p>What meaning of \"unsafe\" do you intend here?</p>\n</blockquote>\n<p>I want to prohibit the execution of arbitrary code including the unsafe elaborator, <code>evalTerm</code>, and any other cases where a tactic author sees fit.</p>",
        "id": 526703238,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751418180
    },
    {
        "content": "<p>So <code>evalExpr</code> as well?</p>",
        "id": 526703360,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418281
    },
    {
        "content": "<p>Yes, and this would be optional. Existing code will not be affected.</p>",
        "id": 526703387,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751418302
    },
    {
        "content": "<p>Ultimately I think yo uonly need to attempt to ban <code>evalConst</code></p>",
        "id": 526703432,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418334
    },
    {
        "content": "<p>But what about a tactic that uses <code>eval</code> on a controlled type like a natural number expression?</p>",
        "id": 526703459,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418353
    },
    {
        "content": "<p>If the tactic author sees that its safe, then there would not be a check for the prohibit unsafe flag.</p>",
        "id": 526703513,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751418386
    },
    {
        "content": "<p>The trust is on the tactics and elaborators, rather than whatever thing wrote a proof.</p>",
        "id": 526703578,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751418428
    },
    {
        "content": "<p>It's not clear to me why you'd care about banning the <code>unsafe</code> keyword.</p>",
        "id": 526703592,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418443
    },
    {
        "content": "<p>It sounds like the meaning you want this flag to have is not really related to the meaning of that keyword</p>",
        "id": 526703611,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418458
    },
    {
        "content": "<p>(maybe I'm reading too much into your code example)</p>",
        "id": 526703662,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1751418496
    },
    {
        "content": "<p>I call it <code>prohibitUnsafe</code> because my starting point is <code>run_tac</code>, which uses the unsafe keyword. A better terminology is possible.</p>",
        "id": 526703686,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751418522
    },
    {
        "content": "<p>The PR is here: <a href=\"https://github.com/leanprover/lean4/pull/9148\">https://github.com/leanprover/lean4/pull/9148</a></p>",
        "id": 526707032,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751421320
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"599027\">@Leni Aniva</span>, you would need to write a much more detailed RFC to get traction here.</p>",
        "id": 526710576,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1751424180
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/341532-lean4-dev/topic/Unsafe.20prohibition.20flag.20in.20.60Elab.2ETerm.2EContext.60/near/526710576\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span>, you would need to write a much more detailed RFC to get traction here.</p>\n</blockquote>\n<p>let me discuss with amazon people on this matter...</p>",
        "id": 526715302,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751428644
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lean4/issues/9160\">https://github.com/leanprover/lean4/issues/9160</a></p>",
        "id": 526847285,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1751476438
    }
]