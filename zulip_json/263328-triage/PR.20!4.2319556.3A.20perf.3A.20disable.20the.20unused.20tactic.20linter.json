[
    {
        "content": "<p>Today I chose PR 19556 for discussion!</p>\n<p><strong><a href=\"https://github.com/leanprover-community/mathlib4/issues/19556\">perf: disable the unused tactic linter</a></strong><br>\nCreated by @<strong>None</strong> (@grunweg) on 2024-11-28<br>\nLabels: WIP, t-linter, awaiting-bench</p>\n<p>Is this PR still relevant? Any recent updates? Anyone making progress?</p>",
        "id": 491763505,
        "sender_full_name": "Random Issue Bot",
        "timestamp": 1735913510
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> Given your recent work on this linter, is this issue still relevant?</p>",
        "id": 491773604,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1735918328
    },
    {
        "content": "<p>I think that it is still relevant: most linters that I wrote that scan <code>InfoTrees</code> should be optimized.  This is something that I know and that I plan to do.</p>",
        "id": 491773686,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735918377
    },
    {
        "content": "<p>For the specifics of the unused tactic linter, I think that an optimization would be to try and merge it with the multigoal linter: that may roughly half the cost of running both, with very little thought about how to <em>actually</em> optimize them!</p>",
        "id": 491773792,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735918439
    },
    {
        "content": "<p>(And it would also mean that any future optimization only needs to be implemented once.)</p>",
        "id": 491773875,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735918475
    },
    {
        "content": "<p>Are there instructions somewhere to completely disable linters in a lib depending on Mathlib? I really don’t want my students to spend CPU power on linting.</p>",
        "id": 491776725,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735919962
    },
    {
        "content": "<p>Would your students be cloning a repository that you set up for them, or would they be creating one on their own?</p>",
        "id": 491784383,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735923792
    },
    {
        "content": "<p>A way of silencing the linters is to set their (weak) options in the lakefile to <code>false</code>: this works well if they are all cloning the same repository, since then you just plant this set up once.</p>",
        "id": 491784516,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735923862
    },
    {
        "content": "<p>A more principled approach though, would be to have an \"option to rule them all\": every linter runs only if its specific option is <code>true</code> <em>and</em> the \"all linters option\" is also <code>true</code>.</p>",
        "id": 491784682,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735923938
    },
    {
        "content": "<p>Then, in downstream projects, you only need to set the \"all linters option\" to false to achieve silencing and you do not need to worry about new linters appearing in the future.</p>",
        "id": 491784756,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735923969
    },
    {
        "content": "<p>This second alternative is not available at the moment, though.</p>",
        "id": 491784806,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735924005
    },
    {
        "content": "<p>They will use my repo. That course has no interaction with git at all.</p>",
        "id": 491795506,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735929426
    },
    {
        "content": "<p>So, an easy solution is to copy the weak options from mathlib's lakefile and set them all to false.</p>",
        "id": 491798303,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1735930815
    },
    {
        "content": "<p>Running <code>run_cmd Lean.Elab.Command.lintersRef.set #[]</code> also disables all linters including builtin ones, until you next relaunch the lean server</p>",
        "id": 491801154,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1735932233
    },
    {
        "content": "<p>Thanks for the explanation!</p>",
        "id": 491805613,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1735934490
    },
    {
        "content": "<p>I’m getting back to this because I can’t make it work. Can anyone share a <code>lakefile.toml</code> which disables all linters in a project depending on Mathlib? If this is too complicated, I would already be happy with disabling the unused tactic linter. <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span></p>",
        "id": 493957874,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736956062
    },
    {
        "content": "<p>It really really doesn’t help that lake is silently ignoring every section of <code>lakefile.toml</code> that actually doesn’t exist.</p>",
        "id": 493958031,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736956096
    },
    {
        "content": "<p>Here's one for just hte unused tactic linter; full example upcoming</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"«mathlib-tryforeachstep-test»\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[leanOptions]</span>\n<span class=\"n\">pp</span><span class=\"p\">.</span><span class=\"n\">unicode</span><span class=\"p\">.</span><span class=\"n\">fun</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">unusedTactic</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span>\n</code></pre></div>",
        "id": 493981739,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736962612
    },
    {
        "content": "<p>Updated version: you may consider if the <code>refine</code>, <code>oldObtain</code> or <code>style.multiGoal</code> linters are actually beneficial.</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"«mathlib-tryforeachstep-test»\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span><span class=\"p\">]</span>\n\n<span class=\"k\">[leanOptions]</span>\n<span class=\"n\">pp</span><span class=\"p\">.</span><span class=\"n\">unicode</span><span class=\"p\">.</span><span class=\"n\">fun</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n<span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">unusedTactic</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">hashCommand</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">oldObtain</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">cdot</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">dollarSyntax</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">lambdaSyntax</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">longLine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">missingEnd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">setOption</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"n\">linter</span><span class=\"p\">.</span><span class=\"n\">style</span><span class=\"p\">.</span><span class=\"n\">multiGoal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n\n<span class=\"k\">[[require]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"k\">[[lean_lib]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span>\n</code></pre></div>",
        "id": 493982640,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736962898
    },
    {
        "content": "<p>(This is on the current version of mathlib. I'm pretty sure it should also work on 4.15.0, but haven't tested that.)</p>",
        "id": 493982796,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736962935
    },
    {
        "content": "<p>Thanks a lot for trying to help Michael, but it simply does not work.</p>",
        "id": 493988136,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736964634
    },
    {
        "content": "<p>Patrick, does Michael's approach work for the linters whose default value is <code>false</code> in mathlib, but are then turned on within all of mathlib as <code>weak</code> options?</p>",
        "id": 494006103,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736971355
    },
    {
        "content": "<p>Alternatively, do you want to disable completely the unusedTactic linter in mathlib, or having the persistent exclusion of certain tactics be enough?</p>",
        "id": 494006159,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736971384
    },
    {
        "content": "<p>Right, I should have tested locally... does the following work? (It works for me locally, in the sense that <code>lake build</code> passes.)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"«mathlib-tryforeachstep-test»\"</span>\n<span class=\"n\">defaultTargets</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span><span class=\"o\">]</span>\n\n<span class=\"o\">[</span><span class=\"n\">leanOptions</span><span class=\"o\">]</span>\n<span class=\"n\">pp</span><span class=\"bp\">.</span><span class=\"n\">unicode</span><span class=\"bp\">.</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"n\">autoImplicit</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedTactic</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">hashCommand</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">oldObtain</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">cdot</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">dollarSyntax</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">lambdaSyntax</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">longLine</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">missingEnd</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">setOption</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"n\">weak</span><span class=\"bp\">.</span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">style</span><span class=\"bp\">.</span><span class=\"n\">multiGoal</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">false</span>\n\n<span class=\"o\">[[</span><span class=\"n\">require</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"mathlib\"</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span>\n\n<span class=\"o\">[[</span><span class=\"n\">lean_lib</span><span class=\"o\">]]</span>\n<span class=\"n\">name</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"MathlibTryforeachstepTest\"</span>\n</code></pre></div>",
        "id": 494009533,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736972659
    },
    {
        "content": "<p>lake doesn’t complain but the linter still run</p>",
        "id": 494022084,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736977284
    },
    {
        "content": "<p>I see this unused tactic linter more and more like a virus.</p>",
        "id": 494022135,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736977305
    },
    {
        "content": "<p>Do the other linters whose default option is false also run?</p>",
        "id": 494023002,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736977675
    },
    {
        "content": "<p>I’m not sure what the other ones are meant to do</p>",
        "id": 494023162,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736977745
    },
    {
        "content": "<p>What happens if you use <code>set_option pp.all true</code>?</p>",
        "id": 494023212,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736977773
    },
    {
        "content": "<p>I see the expected verbose output of pp.all</p>",
        "id": 494023391,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736977839
    },
    {
        "content": "<p>Ah, no linter warning?</p>",
        "id": 494023429,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736977859
    },
    {
        "content": "<p>no</p>",
        "id": 494023629,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736977956
    },
    {
        "content": "<p>Ok, so maybe setting of <code>weak</code> options only works when the default value of <code>false</code>.</p>",
        "id": 494023779,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978036
    },
    {
        "content": "<p>So, rather than disabling the linter for all of mathlib, we can disable it only for mathlib's dependencies and then the toml that Michael gave you should work.</p>",
        "id": 494023882,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978074
    },
    {
        "content": "<p>I’m sorry but I have no idea what this sentence means.</p>",
        "id": 494023916,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978095
    },
    {
        "content": "<p>Is this something that needs to be done in Mathlib?</p>",
        "id": 494023981,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978129
    },
    {
        "content": "<p>Right now, the default value of the unused tactic linter is <code>true</code>, since it was decided that it was a useful enough linter that is should be on by default in mathlib's dependencies.</p>",
        "id": 494023988,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978136
    },
    {
        "content": "<p>I think it means: \"A short PR to mathlib, which Damiano can quickly write and Michael can review quickly.\" (I can confirm that I'll be happy to review.)</p>",
        "id": 494023997,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736978141
    },
    {
        "content": "<p>For me Mathlib is frozen for one year.</p>",
        "id": 494024002,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978146
    },
    {
        "content": "<p>However, for your course, this decision seems to be wrong.</p>",
        "id": 494024008,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978149
    },
    {
        "content": "<p>For my teaching</p>",
        "id": 494024011,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978150
    },
    {
        "content": "<p>It’s too late the deb file went to the IT guys</p>",
        "id": 494024083,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978166
    },
    {
        "content": "<p>So, to allow you to teach, we can disable the linter for all mathlib's dependencies, but we can still have the linter on in mathlib, at least.</p>",
        "id": 494024096,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978175
    },
    {
        "content": "<p>Ok, so switching to a different branch of mathlib is not possible any more?</p>",
        "id": 494024121,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1736978188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/263328-triage/topic/PR.20!4.2319556.3A.20perf.3A.20disable.20the.20unused.20tactic.20linter/near/494024002\">said</a>:</p>\n<blockquote>\n<p>For me Mathlib is frozen for one year.</p>\n</blockquote>\n<p>Ah, I did not realize this.</p>",
        "id": 494024131,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978194
    },
    {
        "content": "<p>My course starts next Wednesday. I’m already lucky to work in a math department where I can send a random deb file one week before classes start and get it deployed.</p>",
        "id": 494024190,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978230
    },
    {
        "content": "<p>I was not expecting zombie linters.</p>",
        "id": 494024223,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978246
    },
    {
        "content": "<p>I wonder whether there is something that can be done on your project, where parsing a file implies setting the linter option to false.</p>",
        "id": 494024231,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978252
    },
    {
        "content": "<p>I will find a hack redefining the command to set the options</p>",
        "id": 494024311,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978283
    },
    {
        "content": "<p>Is there some command that you always use at the start of each file?</p>",
        "id": 494024355,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978308
    },
    {
        "content": "<p>So there is no real harm, but I think it reveals a serious issue in our setup.</p>",
        "id": 494024360,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978312
    },
    {
        "content": "<p>There is no such command, but I can make one.</p>",
        "id": 494024373,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978321
    },
    {
        "content": "<p>That command could be redefined to mean <code>set_option ...</code> plus whatever the command really does.</p>",
        "id": 494024396,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978331
    },
    {
        "content": "<p>Students already know they can ignore the import line at the top of each file.</p>",
        "id": 494024453,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978348
    },
    {
        "content": "<p>Well, the command already exists: <code>set_option linter.unusedTactic false</code>... <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 494024485,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978355
    },
    {
        "content": "<p>Thanks a lot for trying anyway.</p>",
        "id": 494024495,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978356
    },
    {
        "content": "<p>I think that from this test it emerges that the <code>weak</code> linter options only work when the default value of the linter is <code>false</code>.</p>",
        "id": 494024621,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978395
    },
    {
        "content": "<p>If the linter's default value is <code>true</code>, it looks as though there is no way for downstream projects to set their own options.</p>",
        "id": 494024709,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978421
    },
    {
        "content": "<p>For instance, the <code>setOption</code> <em>linter</em> has <code>false</code> as default value, but mathlib overrides this by setting a weak option to <code>true</code>.</p>",
        "id": 494024788,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978461
    },
    {
        "content": "<p>And this linter does not cause problems for your project.</p>",
        "id": 494024820,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978474
    },
    {
        "content": "<p>However, the unusedTactic linter has default value <code>true</code> and this seems to be the cause of the issue: downstream projects do not seem to have the opportunity to silence it, even if they set a weak option to false.</p>",
        "id": 494024921,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978520
    },
    {
        "content": "<p>Do you remember how to write a macro with values in <code>command</code> that actually runs several commands? I always need to look it up?</p>",
        "id": 494024922,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978520
    },
    {
        "content": "<p>Also, do you know which other linters are slow to run?</p>",
        "id": 494024983,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978538
    },
    {
        "content": "<p>Of the list above, the <code>multiGoal</code> linter is slow as well.</p>",
        "id": 494025041,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978572
    },
    {
        "content": "<p>(the multiGoal and unusedTactic are <em>almost</em> the same linter)</p>",
        "id": 494025076,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978592
    },
    {
        "content": "<p>I thought that macros with multiple commands \"just worked\": let me try.</p>",
        "id": 494025139,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978609
    },
    {
        "content": "<p>You’re right, I’m misremembering</p>",
        "id": 494025293,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978666
    },
    {
        "content": "<p>It must be something else that complains in this multiple lines case.</p>",
        "id": 494025325,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978686
    },
    {
        "content": "<p>Ok, here is a test anyway!</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n\n<span class=\"kn\">macro</span><span class=\"w\"> </span><span class=\"s2\">\"bonjour\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">`</span><span class=\"o\">(</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">linter</span><span class=\"bp\">.</span><span class=\"n\">unusedVariables</span><span class=\"w\"> </span><span class=\"n\">false</span>\n<span class=\"w\">  </span><span class=\"o\">)</span>\n<span class=\"c1\">-- warning here</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n\n<span class=\"n\">bonjour</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 494025433,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978730
    },
    {
        "content": "<p>I think that merging multiple <code>tactic</code>s has some funny business: there is <code>tacticSeq</code> and <code>tactic</code> and sometimes you have to be careful with the distinction.</p>",
        "id": 494025603,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978792
    },
    {
        "content": "<p>Yes, it’s definitely fiddly with tactics</p>",
        "id": 494025716,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736978847
    },
    {
        "content": "<p>Multiple commands \"should\" not be chainable, but I think that Kyle mentioned to me some time ago that there is special support for parsing multiple commands anyway.</p>",
        "id": 494025866,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978902
    },
    {
        "content": "<p>Btw, I think that the fact that <code>weak</code> options do not override a default value of <code>true</code> is at least unexpected as decision.</p>",
        "id": 494026032,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736978989
    },
    {
        "content": "<p>Is this something that Lean is doing or Mathlib? I have no idea where is the linter framework nowadays.</p>",
        "id": 494026440,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736979134
    },
    {
        "content": "<p>I’m sure I’ll learn tons of stuff by watching your talk. But as you can see I don’t have any time for LT this year <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 494026507,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1736979164
    },
    {
        "content": "<p>These are the core linters, it is not mathlib's doing.</p>",
        "id": 494026511,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736979166
    },
    {
        "content": "<p>My crazy busy period was last term, so I know how you feel!</p>",
        "id": 494026589,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736979202
    },
    {
        "content": "<p>(This specific linter is just in mathlib, but it uses the linter framework defined in core.  And <code>lake</code> is responsible for the <code>weak</code> options, I think.)</p>",
        "id": 494026782,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1736979278
    }
]