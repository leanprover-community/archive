[
    {
        "content": "<p>Is there a particular use case for wanting <code>FinFun</code> over <code>Finsupp</code>?</p>",
        "id": 534334403,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1755141000
    },
    {
        "content": "<p>Thanks for bringing this up.<br>\nOnce upon a time, in the project FinFun comes from (<a href=\"https://chords.dev\">https://chords.dev</a>), it was not so similar to Finsupp. It's a coincidence that it evolved this way, and now I'm in doubt myself about it. That's why I put an explicit 'API unstable'/not cooked comment at the beginning of FinFun.</p>\n<p>But yeah, we should remove it if Finsupp does the same thing, probably. We might need to extend it with computable functions though, like for going back and forth from/to List. In compilers we expect functions with finite support to have finite representations. Is that possible already? I see Finsupp uses noncomputable in its whole file.</p>\n<p><span class=\"user-mention\" data-user-id=\"736096\">@x.y.</span> what do you think? You're the main user of FinFun together with me, that I know of.</p>",
        "id": 534341447,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755147129
    },
    {
        "content": "<p>Right - I forgot about that. I noticed this only because I was looking at <code>Finsupp</code> earlier <a href=\"#narrow/channel/287929-mathlib4/topic/Computable.2Fdecidable.20Finsupp.3F/near/533530903\">from another thread</a>.</p>\n<p><code>FinFun</code> seems fine, though it doesn't respect extensionality the same way that <code>Finsupp</code> does.</p>",
        "id": 534341618,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1755147268
    },
    {
        "content": "<p>Side question: Would it be called <code>Finfun</code> in mathlib style?</p>",
        "id": 534350614,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755153519
    },
    {
        "content": "<p>Thanks for the pointer to the thread. That suggests we should keep and improve FinFun for now, I guess.</p>",
        "id": 534350663,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755153544
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"929508\">Fabrizio Montesi</span> <a href=\"#narrow/stream/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534341447\">said</a>:</p>\n<blockquote>\n<p>Thanks for bringing this up.<br>\nOnce upon a time, in the project FinFun comes from (<a href=\"https://chords.dev\">https://chords.dev</a>), it was not so similar to Finsupp. It's a coincidence that it evolved this way, and now I'm in doubt myself about it. That's why I put an explicit 'API unstable'/not cooked comment at the beginning of FinFun.</p>\n<p>But yeah, we should remove it if Finsupp does the same thing, probably. We might need to extend it with computable functions though, like for going back and forth from/to List. In compilers we expect functions with finite support to have finite representations. Is that possible already? I see Finsupp uses noncomputable in its whole file.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"736096\">x.y.</span> what do you think? You're the main user of FinFun together with me, that I know of.</p>\n</blockquote>\n<p>I do need something computable so I guess to me FinFun is a quite useful data type that is not exactly replaceable by Finsupp… tho I agree that we do not have enough important properties encoded for it.</p>",
        "id": 534351472,
        "sender_full_name": "Xueying Qin",
        "timestamp": 1755153975
    },
    {
        "content": "<p>(To clarify, <code>Finsupp</code>'s underlying structure <em>is</em> computable - the theory around it isn't.)</p>",
        "id": 534357587,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1755154408
    },
    {
        "content": "<p>Let's see where we can go with FinFun then. A few initial questions:</p>\n<ul>\n<li>I guess it should be renamed to <code>Finfun</code>, right? (I'd like to be consistent with mathlib's style here.)</li>\n<li>We're currently a bit inconsistent in assuming that the codomain type has a <code>Zero</code>. I think we should switch to assuming it early-on, as in Finsupp (and coincidentially my textbook on choreographic languages, which is the original reason for <code>FinFun</code> anyway). Agreed? This will make a lot of stuff easier and more useful.</li>\n<li>Given the above, should we rename it to something that signals the <code>Zero</code> assumption?</li>\n<li>What notation should we use? I dislike the current <code>⇀</code>, and like the one Finsupp uses, but alas that means the latter is already taken.</li>\n</ul>",
        "id": 534366845,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755154781
    },
    {
        "content": "<p>If you do want to reuse <code>DFinsupp</code>'s theory, perhaps you can define this structure as the non-dependently typed version of <code>DFinsupp</code> (<code>def FinFun (α : Type*) (M : Type*) [Zero M] := Π₀ (_ : α), M</code>)? </p>\n<p>(I think it's <code>FinFun</code>? Lean does use PascalCase for structures, which makes me surprised by <code>Finsupp</code>'s name)</p>",
        "id": 534371749,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1755154985
    },
    {
        "content": "<p>Maybe. In principle that'd be fine, but <code>DFinsupp</code> looks pretty complex (certainly for good reasons) to know at a glance.</p>",
        "id": 534379753,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755155312
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"929508\">Fabrizio Montesi</span> <a href=\"#narrow/stream/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534366845\">said</a>:</p>\n<blockquote>\n<p>Let's see where we can go with FinFun then. A few initial questions:</p>\n<ul>\n<li>I guess it should be renamed to <code>Finfun</code>, right? (I'd like to be consistent with mathlib's style here.)</li>\n<li>We're currently a bit inconsistent in assuming that the codomain type has a <code>Zero</code>. I think we should switch to assuming it early-on, as in Finsupp (and coincidentially my textbook on choreographic languages, which is the original reason for <code>FinFun</code> anyway). Agreed? This will make a lot of stuff easier and more useful.</li>\n<li>Given the above, should we rename it to something that signals the <code>Zero</code> assumption?</li>\n<li>What notation should we use? I dislike the current <code>⇀</code>, and like the one Finsupp uses, but alas that means the latter is already taken.</li>\n</ul>\n</blockquote>\n<p>Re 0. Agree with Finfun<br>\nRe 1. Yes I think so<br>\nRe 2. I’m not sure, I kind of like it means a function with finite domain…<br>\nRe 3. One option would be \\to_f?</p>",
        "id": 534389549,
        "sender_full_name": "Xueying Qin",
        "timestamp": 1755155693
    },
    {
        "content": "<p>Unfortunately I couldn't find subscript f in unicode :(</p>",
        "id": 534390984,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755155752
    },
    {
        "content": "<p>I have an alternative computation focused implementation for finitely supported functions (based on <code>HashMap</code>, actually <code>ExtHashMap</code>, plus a wrapper layer that ensures there are no default values stored in the map). It should be completely computable and as performant as the underlying HashMap... I'm busy with other things, but hoping to ship it as a demo of how to build APIs using grind.</p>",
        "id": 534392903,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1755155840
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534392903\">said</a>:</p>\n<blockquote>\n<p>I have an alternative computation focused implementation for finitely supported functions (based on <code>HashMap</code>, actually <code>ExtHashMap</code>, plus a wrapper layer that ensures there are no default values stored in the map). It should be completely computable and as performant as the underlying HashMap... I'm busy with other things, but hoping to ship it as a demo of how to build APIs using grind.</p>\n</blockquote>\n<p>Yes please!! :)</p>\n<p>Where do you plan on having that? Is it gonna be compatible with <code>Finset</code>?</p>",
        "id": 534397083,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755156063
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"929508\">Fabrizio Montesi</span> <a href=\"#narrow/stream/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534390984\">said</a>:</p>\n<blockquote>\n<p>Unfortunately I couldn't find subscript f in unicode :(</p>\n</blockquote>\n<p>What about \\to^f, iirc there is a superscript f?</p>",
        "id": 534401746,
        "sender_full_name": "Xueying Qin",
        "timestamp": 1755156278
    },
    {
        "content": "<p>Mmh, actually, there's a relevant difference between FinFun and Finsupp: in FinFun, we don't take the support as parameter, but rather the domain of definition. So it's perfectly fine to have <code>f x = 0</code> even if <code>x</code> is in <code>dom</code>. We're just interested in <code>f x</code> necessarily being <code>0</code> if <code>x</code> is not in dom.</p>",
        "id": 534452861,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168148
    },
    {
        "content": "<p>Isn't that still <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp#doc\">docs#DFinsupp</a> ?</p>",
        "id": 534453214,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168299
    },
    {
        "content": "<p>Could you share a link to where FinFun is defined?</p>",
        "id": 534453267,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168321
    },
    {
        "content": "<p>ah, yet another difference between <code>Finsupp</code> and <code>DFinsupp</code> :-)</p>",
        "id": 534453336,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168351
    },
    {
        "content": "<p><a href=\"https://github.com/cs-lean/cslib/blob/main/Cslib/Data/FinFun.lean\">https://github.com/cs-lean/cslib/blob/main/Cslib/Data/FinFun.lean</a></p>",
        "id": 534453419,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168376
    },
    {
        "content": "<p>Ah, <code>FinFun</code> does not have good extensionality</p>",
        "id": 534453660,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168473
    },
    {
        "content": "<p>I guess FinFun is to DFinsupp as HashMap is to ExtHashMap</p>",
        "id": 534453727,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168509
    },
    {
        "content": "<p>I think my current edits might fix that, it's currently a bit messy.</p>",
        "id": 534453778,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168529
    },
    {
        "content": "<p>In particular I'm making a new branch based on this for discussing it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- A finite function is a function `f` equipped with a domain of definition `dom`. -/</span>\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">FinFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">β</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span>\n<span class=\"w\">  </span><span class=\"n\">dom</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">α</span>\n<span class=\"w\">  </span><span class=\"n\">dom_complete</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∉</span><span class=\"w\"> </span><span class=\"n\">dom</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 534453822,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168546
    },
    {
        "content": "<p>That's better, but the function <code>{f := 0, dom:=empty}</code> is still not equal to <code>{f := 0, dom:=univ}</code></p>",
        "id": 534453958,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168599
    },
    {
        "content": "<p>And so you can't say \"two FinFun's are equal if they agree everywhere\"</p>",
        "id": 534453990,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168614
    },
    {
        "content": "<p>Ah, extensional equality! Of course, I agree.</p>",
        "id": 534454115,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168667
    },
    {
        "content": "<p>Once you fix that, you've either reinvented Finsupp (by changing the implies to an Iff) or DFinsupp (by quotienting out the dom)</p>",
        "id": 534454265,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168728
    },
    {
        "content": "<p>(strictly speaking DFinsupp uses Multiset not Finset, which in practice often avoids needing <code>[DecidableEq α]</code>)</p>",
        "id": 534454424,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755168802
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534454424\">said</a>:</p>\n<blockquote>\n<p>(strictly speaking DFinsupp uses Multiset not Finset, which in practice often avoids needing <code>[DecidableEq α]</code>)</p>\n</blockquote>\n<p>! I was actually wondering why Multiset.</p>",
        "id": 534454478,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168829
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534454265\">said</a>:</p>\n<blockquote>\n<p>Once you fix that, you've either reinvented Finsupp (by changing the implies to an Iff) or DFinsupp (by quotienting out the dom)</p>\n</blockquote>\n<p>The former.</p>\n<p><em>mathematical mumbling sounds ensue</em></p>",
        "id": 534454838,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755168968
    },
    {
        "content": "<p>The problem with using an <code>Iff</code> is that you quickly end up needing decidability of <code>(x : β) = 0</code> to know whether to remove things from <code>dom</code></p>",
        "id": 534455095,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755169066
    },
    {
        "content": "<p>Whereas for DFinsupp you can happily keep growing your <code>dom</code>/<code>support</code>, as the quotient makes it irrelevant</p>",
        "id": 534455160,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755169094
    },
    {
        "content": "<p>Exactly, which now makes me understand your comment about FinFun, HashMap and ExtHashMap. I'm not familiar with ExtHashMap but the names are telling enough, from your comments. (And I agree with you.)</p>",
        "id": 534455222,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755169126
    },
    {
        "content": "<blockquote>\n<p>In particular I'm making a new branch based on this for discussing it:</p>\n</blockquote>\n<p>The version you have in this message is a little more faithful to the HashMap : ExtHashMap comparison</p>",
        "id": 534455297,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755169157
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 534455924,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755169405
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 534456728,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755169698
    },
    {
        "content": "<p>A few 'uh, oh!' later (my deleted mesgs above), I'm starting to see how we could make it work with the iff in our project. That'd mean that we basically want Finsupp without all these noncomputable, I guess, getting back to my first messages.</p>",
        "id": 534457194,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755169888
    },
    {
        "content": "<p>I would wager that <code>DFinsupp</code> would work just as well for you, and you'd save yourself the effort of having to rewrite bits of Finsupp locally</p>",
        "id": 534458318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755170347
    },
    {
        "content": "<p>Oh, I definitely agree. As I mentioned before, I'm just worried about exposing the user to the complexity of <code>DFinsupp</code> by defining <code>FinFun</code> as a <code>DFinSupp</code> as <span class=\"user-mention\" data-user-id=\"767695\">@Tristan Figueroa-Reid</span> suggested before:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">FinFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">Π₀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">M</span>\n</code></pre></div>",
        "id": 534459165,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755170679
    },
    {
        "content": "<p>but I'll play a bit with this idea, maybe the ergonomics will actually work out</p>",
        "id": 534459297,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755170729
    },
    {
        "content": "<p>I can get very motivated by avoiding duplications. ;-)</p>",
        "id": 534459354,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755170747
    },
    {
        "content": "<p>Re that <code>Trunc</code>: will I be able to compute 'intersections' and 'unions' as I can do with Finset as support?</p>",
        "id": 534460543,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755171233
    },
    {
        "content": "<p>Ultimately you'll want to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quotient#doc\">docs#Quotient</a>.map₂, or if you're lucky the Trunc version already exists</p>",
        "id": 534461683,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755171585
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp.zipWith#doc\">docs#DFinsupp.zipWith</a> is the union</p>",
        "id": 534461842,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755171653
    },
    {
        "content": "<p>Arguably you don't need the intersection, since under the quotient they're the same anyway</p>",
        "id": 534462047,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755171736
    },
    {
        "content": "<p>Just to make sure we're on the same page: what I meant is that I wanna construct <code>f</code> from <code>g</code> and <code>h</code> (all DFinsupp) such that the support of <code>f</code> is the intersection of the supports of <code>g</code> and <code>h</code> (all the stuff not in the intersection of the supports gets mapped to 0).</p>",
        "id": 534479781,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755176823
    },
    {
        "content": "<p>maybe there's <code>⊓</code> for that somewhere?</p>",
        "id": 534480014,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755176883
    },
    {
        "content": "<p>What do you want the function to be in that case?</p>",
        "id": 534481499,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177341
    },
    {
        "content": "<p>You can of course implement that as</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">DFinsupp</span><span class=\"bp\">.</span><span class=\"n\">zipWith</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">fi</span><span class=\"w\"> </span><span class=\"n\">gi</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">fi</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">gi</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>but if your <code>sorry</code> is <code>fi * gi</code> then of course you can just drop the <code>if</code></p>",
        "id": 534481693,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177418
    },
    {
        "content": "<p>I guess point-wise application of ⊓? I.e., <code>f x = g x ⊓ h x</code> for all x in <code>g.support \\cap h.support</code> and 0 otherwise.</p>",
        "id": 534481729,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755177427
    },
    {
        "content": "<p>That's <code>f ⊓ g</code> I think</p>",
        "id": 534481783,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177445
    },
    {
        "content": "<p>Are you sure you want the <code>0</code> otherwise bit, rather than just having <code>f x = g x ⊓ h x</code> everywhere?</p>",
        "id": 534482066,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177535
    },
    {
        "content": "<p>If you have <code>0 ⊓ f x = 0</code> etc then those are the same thing anyway</p>",
        "id": 534482117,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177556
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp.support_inf#doc\">docs#DFinsupp.support_inf</a> is relevant</p>",
        "id": 534482191,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755177581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534482191\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DFinsupp.support_inf#doc\">docs#DFinsupp.support_inf</a> is relevant</p>\n</blockquote>\n<p>It is, thanks! Isn't that basically what I wrote?</p>\n<p>Re what I want: I'm not 100% sure yet, lots of stuff to double check. I apologise in advance for changing my mind. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 534484582,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755178364
    },
    {
        "content": "<p>is this supposed to capture the notion of partial functions? it seems similar to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=PFun#doc\">docs#PFun</a>, conceptually speaking (though that type does not require that the domain is finite)</p>",
        "id": 534527663,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1755191944
    },
    {
        "content": "<p>Yes, with finite domain of definition. I'd be just happy with a Finsupp implemented in the style of DFinsupp. :⁠-⁠)</p>",
        "id": 534535741,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755194983
    },
    {
        "content": "<p>just to be clear, <code>DFinsupp</code> also requires that values in the support are nonzero (it seemed like there was some confusion on that point above)</p>",
        "id": 534537084,
        "sender_full_name": "Matt Diamond",
        "timestamp": 1755195592
    },
    {
        "content": "<p>Yes, but I think that's fine (after re-checking my pen-and-paper proofs for the 3rd time..)</p>",
        "id": 534537299,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755195697
    },
    {
        "content": "<p>I would guess that just making arrow notation for <code>Π₀ (_ : α), M</code> would be sufficient for your use-case</p>",
        "id": 534545951,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755199305
    },
    {
        "content": "<p>Using <code>def FinFun</code> just forces you to reinvent all the same wheels</p>",
        "id": 534546028,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755199338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/516743-computer-science/topic/FinFun.20vs.20Finsupp/near/534545951\">said</a>:</p>\n<blockquote>\n<p>I would guess that just making arrow notation for <code>Π₀ (_ : α), M</code> would be sufficient for your use-case</p>\n</blockquote>\n<p>Yes, that's what I'm playing with now. The def FinFun approach turned out to be cumbersome, as you say.</p>",
        "id": 534594348,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1755230730
    },
    {
        "content": "<p>I've done an intermediate step towards that (<a href=\"https://github.com/leanprover/cslib/pull/118\">cslib#118</a>), as switching directly to DFinsupp broke way too much downstream code. But at least this will make downstream code go more in line with the APIs of Finsupp/DFinsupp. We'll keep working in that direction. :)</p>",
        "id": 546528713,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1761158847
    },
    {
        "content": "<p>I didn't expect grind to be able to prove this, nice work annotating stuff everyone. :-)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">scoped</span><span class=\"w\"> </span><span class=\"n\">grind</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">fromFun_inter</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Zero</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">β</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">support1</span><span class=\"w\"> </span><span class=\"n\">support2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">↾</span><span class=\"w\"> </span><span class=\"n\">support1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↾</span><span class=\"w\"> </span><span class=\"n\">support2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">↾</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">support1</span><span class=\"w\"> </span><span class=\"bp\">∩</span><span class=\"w\"> </span><span class=\"n\">support2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">grind</span>\n</code></pre></div>",
        "id": 546752161,
        "sender_full_name": "Fabrizio Montesi",
        "timestamp": 1761246667
    }
]