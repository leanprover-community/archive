[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19522\">#19522</a> adds emoji reactions to all public channels whenever a <code>bors d</code>, <code>bors r+</code> or <code>bors merge</code> comment is applied to a PR.</p>",
        "id": 484594970,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654629
    },
    {
        "content": "<p>Ideally, it also works with the <code>mathlib reviewers</code> channel, though this is less clear.</p>",
        "id": 484595003,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654651
    },
    {
        "content": "<p>out of curiosity, how does it find these messages? what does it search for?</p>",
        "id": 484595119,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732654694
    },
    {
        "content": "<p>When the comment is added, the action that is triggered passes to a python script the PR number and the script scans the Zulip chat looking for the linkified PR number.</p>",
        "id": 484595246,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654748
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19522/files#diff-f4d93db8b65ea3a55fec930b047b34935412657dedaaf2aaf91ac6162af0d1a2R14\">This</a> is where the python script receives the PR number.</p>",
        "id": 484595426,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654814
    },
    {
        "content": "<p>And <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/.github/workflows/maintainer_bors.yml#L118\">this</a> is the github action passing the PR number to the python script.</p>",
        "id": 484595544,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654866
    },
    {
        "content": "<p>Once the python script has that number, it uses the Zulip API to find the posts and apply the reactions.</p>",
        "id": 484595597,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654890
    },
    {
        "content": "<p>so if i'm reading this correctly, it only searches the number, not the <code>#</code>?</p>",
        "id": 484595600,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732654890
    },
    {
        "content": "<p>I do not know why this happens, but it first searches for the PR number only, but then it applies a second filter, where it matches the PR url.</p>",
        "id": 484595665,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654922
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19522/files#diff-f4d93db8b65ea3a55fec930b047b34935412657dedaaf2aaf91ac6162af0d1a2R66\">This</a> is matching the URL.</p>",
        "id": 484595792,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654962
    },
    {
        "content": "<p>I tried matching directly the URL and the searches were coming out empty...</p>",
        "id": 484595830,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654976
    },
    {
        "content": "<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 484595833,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732654979
    },
    {
        "content": "<p>Just to be clear, the \"I do not know why this happens\" refers to \"I do not know why matching directly on the URL does not do what I expected\".</p>",
        "id": 484596088,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732655078
    },
    {
        "content": "<p>judging from this behaviour, i guess zulips own search/filter might search the \"original\" message, while <code>message['content']</code> is the \"displayed\" message, which you're searching for the url?</p>",
        "id": 484596619,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732655299
    },
    {
        "content": "<p>Yes, this is possible: it may be that the \"linkifier\" search only happens with the second filter, but the first one scans the actual text that is typed.</p>",
        "id": 484596745,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732655354
    },
    {
        "content": "<p>basically, this seems like a technicality of the Zulip implementation to me.</p>",
        "id": 484596819,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732655396
    },
    {
        "content": "<p>That is possible, but I am not sure how to do anything different.  Besides, all of this is code written so that CI uses it, which adds several extra layers of mystery to the process.</p>",
        "id": 484597034,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732655466
    },
    {
        "content": "<p>as (to me) previously unconsidered fallout from this PR, we have the bot confirming in <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a> that the merged PRs are actually merged... should we leave this be, or do something about it?</p>",
        "id": 484687641,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732703502
    },
    {
        "content": "<p>because i think this is a bit much tbh</p>",
        "id": 484687920,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732703592
    },
    {
        "content": "<p>also, it seems it doesn't remove the <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"> reaction when a PR gets <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\">-d</p>",
        "id": 484688280,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732703717
    },
    {
        "content": "<p>Yeah, it's on our todo list to exclude <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a></p>",
        "id": 484688455,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732703768
    },
    {
        "content": "<p>Let me actually try to do that now.</p>",
        "id": 484688501,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732703784
    },
    {
        "content": "<p>I'm hoping this will do the trick</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/scripts/zulip_emoji_merge_delegate.py b/scripts/zulip_emoji_merge_delegate.py</span>\n<span class=\"gh\">index 8fa4e33e74..cbecbdf203 100644</span>\n<span class=\"gd\">--- a/scripts/zulip_emoji_merge_delegate.py</span>\n<span class=\"gi\">+++ b/scripts/zulip_emoji_merge_delegate.py</span>\n<span class=\"gu\">@@ -23,14 +23,14 @@ client = zulip.Client(</span>\n<span class=\"w\"> </span>    site=ZULIP_SITE\n<span class=\"w\"> </span>)\n\n<span class=\"gd\">-# Fetch the messages containing the PR number from the public channels.</span>\n<span class=\"gi\">+# Fetch the messages containing the PR number from the public channels (exluding #rss).</span>\n<span class=\"w\"> </span># There does not seem to be a way to search simultaneously public and private channels.\n<span class=\"w\"> </span>public_response = client.get_messages({\n<span class=\"w\"> </span>    \"anchor\": \"newest\",\n<span class=\"w\"> </span>    \"num_before\": 5000,\n<span class=\"w\"> </span>    \"num_after\": 0,\n<span class=\"w\"> </span>    \"narrow\": [\n<span class=\"gd\">-        {\"operator\": \"channels\", \"operand\": \"public\"},</span>\n<span class=\"gi\">+        {\"operator\": \"channel\", \"operand\": \"rss\", \"negated\": true},</span>\n<span class=\"w\"> </span>        {\"operator\": \"search\", \"operand\": f'#{PR_NUMBER}'},\n<span class=\"w\"> </span>    ],\n<span class=\"w\"> </span>})\n</code></pre></div>",
        "id": 484689620,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732704121
    },
    {
        "content": "<p>I'm not sure why the <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"> isn't removed...</p>",
        "id": 484689699,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732704133
    },
    {
        "content": "<p>Reaction doesn't exist: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/12048580194/job/33593506188#step:5:58\">https://github.com/leanprover-community/mathlib4/actions/runs/12048580194/job/33593506188#step:5:58</a></p>",
        "id": 484690149,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732704256
    },
    {
        "content": "<p>Pretty mysterious</p>",
        "id": 484690447,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732704343
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19533\">#19533</a> for the exlusion of <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a></p>",
        "id": 484690634,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732704393
    },
    {
        "content": "<p>I also observed the error when the bot tries to remove a reaction and I do not really understand what it is.  There might be a time limit during which the bot can remove its own reactions, since I <em>sometimes</em> observed a removal and other times I observed the error.</p>",
        "id": 484694063,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732705485
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/8Tw43pambJqqTbq7dBpRUDOF/image.png\">image.png</a><br>\noops</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/8Tw43pambJqqTbq7dBpRUDOF/image.png\" title=\"image.png\"><img data-original-dimensions=\"677x105\" src=\"/user_uploads/thumbnail/3121/8Tw43pambJqqTbq7dBpRUDOF/image.png/840x560.webp\"></a></div>",
        "id": 484694264,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705552
    },
    {
        "content": "<p>Oh, missing quotes!!</p>",
        "id": 484694353,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732705571
    },
    {
        "content": "<p>actually, according to this example it should be the boolean value, not the string<br>\n<a href=\"/user_uploads/3121/yh9l8HiZpO7shPsGKrUywpuV/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/yh9l8HiZpO7shPsGKrUywpuV/image.png\" title=\"image.png\"><img data-original-dimensions=\"378x109\" src=\"/user_uploads/thumbnail/3121/yh9l8HiZpO7shPsGKrUywpuV/image.png/840x560.webp\"></a></div>",
        "id": 484694524,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705622
    },
    {
        "content": "<p>found <a href=\"https://web.zulip.com/api/construct-narrow#construct-a-narrow\">here</a></p>",
        "id": 484694573,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705640
    },
    {
        "content": "<p>so the error's suggestion <em>is</em> correct. the example is the resulting JSON, so the python dict should contain python's <code>True</code> (bool) value</p>",
        "id": 484694852,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705736
    },
    {
        "content": "<p>at least now indeed the bot doesn't react to the <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a>  messages <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 484695189,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732705854
    },
    {
        "content": "<p>If you want to PR a fix, I'm happy to merge it!</p>",
        "id": 484695242,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732705871
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19535\">#19535</a></p>",
        "id": 484695886,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732706103
    },
    {
        "content": "<p>from <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/12049794052/job/33597297456\">this run</a>, it seems it isn't completely flawless yet, as it didn't find messages for <a href=\"https://github.com/leanprover-community/mathlib4/pull/19535\">#19535</a>...</p>",
        "id": 484706265,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732709533
    },
    {
        "content": "<p>I wonder whether we need to restore the old filter (<code>narrow</code>) that looked at all messages via <code>channels</code> and add the check for \"not in <code>rss</code>\" at the <code>match</code> stage of the script.</p>",
        "id": 484707015,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709792
    },
    {
        "content": "<p>While testing the action, it took me a while to get Zulip to search <em>all</em> history and not what it thought was the \"history of the bot\", which normally returned empty or almost empty.</p>",
        "id": 484707125,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709829
    },
    {
        "content": "<p>(A similar reason is probably behind why searching for the url directly does not work, but it works doing it in stages, first looking for the PR number and then for the url.)</p>",
        "id": 484707338,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732709885
    },
    {
        "content": "<p>I thought i could deduce from the docs that that wouldn't be necessary, as I mentioned in my comment on johans review</p>",
        "id": 484707362,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732709893
    },
    {
        "content": "<p>I suppose the docs could be wrong</p>",
        "id": 484707420,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732709911
    },
    {
        "content": "<p>There is a lot of hazy stuff going on with \"shared histories\" and <code>narrow</code>s that required a lot of testing: this may be one of those places as well.</p>",
        "id": 484707879,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732710045
    },
    {
        "content": "<p>In particular, this</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Note</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">many</span><span class=\"w\"> </span><span class=\"n\">narrows</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">including</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">lack</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">channel</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">channels</span><span class=\"w\"> </span><span class=\"n\">operator</span><span class=\"o\">,</span>\n\n<span class=\"n\">search</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"n\">user's</span><span class=\"w\"> </span><span class=\"n\">personal</span><span class=\"w\"> </span><span class=\"n\">message</span><span class=\"w\"> </span><span class=\"n\">history</span><span class=\"bp\">.</span><span class=\"w\"> </span><span class=\"n\">See</span><span class=\"w\"> </span><span class=\"n\">searching</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">history</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">details</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>So, this leaves the door open for <code>narrow</code>s that include <code>channel</code>/<code>channels</code> to still only search a fraction of the history.</p>",
        "id": 484708157,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732710135
    },
    {
        "content": "<p>Btw, a data-point to confirm that this may be the issue is that the bot <em>is</em> adding <del>labels</del>reactions to PRs in the \"private\" channel.</p>",
        "id": 484709296,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732710515
    },
    {
        "content": "<p>Ok, so let's revert, and do the matching against <code>#rss</code> after the zulip request.</p>",
        "id": 484714142,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732712131
    },
    {
        "content": "<p>Unfortunately my ISP has broken my internet. So I'm on mobile for the time being <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 484714205,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732712154
    },
    {
        "content": "<p>ISP fixed problems. I will refactor the script now.</p>",
        "id": 484716610,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732712875
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19540\">#19540</a> <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span></p>",
        "id": 484718099,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732713274
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/484718099\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19540\">#19540</a> <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span></p>\n</blockquote>\n<p>Looks good to me - maintainer merged.</p>",
        "id": 484729852,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1732716555
    },
    {
        "content": "<p>We are getting the public notifications back!</p>",
        "id": 484732811,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717365
    },
    {
        "content": "<p>And it looks like <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a> is off-limits for the bot!</p>",
        "id": 484732929,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717399
    },
    {
        "content": "<p>Thanks everyone: this looks like it is working as intended!  Do report if you notice any further strangeness with the automatic bot reactions.</p>",
        "id": 484733219,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717471
    },
    {
        "content": "<p>The next \"issue\" is whether the bot should remove a <code>delegate</code>/<code>ready-to-merge</code> reaction when a PR gets merged.  I think that this is secondary and I do not necessarily think that it would be a improvement to remove one reaction when applying another.</p>",
        "id": 484733486,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717546
    },
    {
        "content": "<p>Besides, the script seems to attempt to do that now and fails, so getting this to work would require figuring out what is wrong with the current script.</p>",
        "id": 484733634,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717576
    },
    {
        "content": "<p>I am inclined to leave this be and maybe pick it up later, in case the multiple reactions are annoying.</p>",
        "id": 484733704,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732717596
    },
    {
        "content": "<p>Having seen it in action, I do think it would be slightly better if it removed old emojis. It's slightly confusing to have to parse multiple ones to work out which is most recent.</p>",
        "id": 485003969,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732842361
    },
    {
        "content": "<p>It also leaves me wanting more! If we could have a way to reflect whether the PR is <code>awaiting-author</code> directly on Zulip that would be awesome. Maybe adding and removing the <span aria-label=\"writing\" class=\"emoji emoji-270d\" role=\"img\" title=\"writing\">:writing:</span> emoji to track this?</p>",
        "id": 485004049,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732842405
    },
    {
        "content": "<p>I am investigating this, since the script already tries to remove old reactions and fails.</p>\n<p>It seems that the script</p>\n<ul>\n<li>removes the <code>delegated</code> ( emoji: <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span>, name: <code>peace_sign</code>) reaction correctly, but</li>\n<li>fails to remove <code>ready-to-merge</code> (emoji: <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\">, name: <code>bors</code>).</li>\n</ul>\n<p>In the script they are both called by name and I suspect that the issue is that the <code>bors</code> emoji has a <em>custom</em> name and should be referred to as <code>'emoji_code': '22134'</code>, rather than <code>bors</code>.</p>",
        "id": 485025276,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732858606
    },
    {
        "content": "<p>I'll write a PR to make the change and hopefully this will make the part of the script that removes the <code>bors</code> reaction working.</p>",
        "id": 485025347,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732858652
    },
    {
        "content": "<p>If you notice situations where there is a reaction that it is not <code>bors</code> (<img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\">) that did not get removed, let me know!</p>",
        "id": 485025440,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732858703
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19597\">#19597</a></p>",
        "id": 485025910,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732859041
    },
    {
        "content": "<p>If this PR gets approved, we should see the comment above first get a <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"> reaction from the bot when it is <code>bors merge</code>d, and then, once it gets merged, the <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"> reaction will hopefully disappear and be replaced by <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\">.</p>",
        "id": 485026061,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732859154
    },
    {
        "content": "<p>The bot added the <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"> label, as expected...</p>",
        "id": 485030207,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732861868
    },
    {
        "content": "<p>... and replaced it with <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\">!</p>",
        "id": 485030319,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732861932
    },
    {
        "content": "<p>Now we just need a bot that knows when <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span>, <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span>, and <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span> are appropriate. :-)</p>",
        "id": 485035254,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1732864593
    },
    {
        "content": "<p>The difference between <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span>, <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> and <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span> is not always clear to me, so maybe I could learn from that bot!  <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 485037132,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732865568
    },
    {
        "content": "<p>Emoji reactions triggered by a GitHub label (e.g. the <code>awaiting-author</code> that you suggested) should now be relatively easy, since mathlib already has working code for the various steps.</p>",
        "id": 485037881,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732865950
    },
    {
        "content": "<p>I may not have time for this right now, but if someone else wants to try mixing the relevant actions together, I'd be happy to review!</p>",
        "id": 485037905,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732865961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485025276\">said</a>:</p>\n<blockquote>\n<p>I am investigating this, since the script already tries to remove old reactions and fails.</p>\n<p>It seems that the script</p>\n<ul>\n<li>removes the <code>delegated</code> ( emoji: <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span>, name: <code>peace_sign</code>) reaction correctly, but</li>\n<li>fails to remove <code>ready-to-merge</code> (emoji: <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\">, name: <code>bors</code>).</li>\n</ul>\n<p>In the script they are both called by name and I suspect that the issue is that the <code>bors</code> emoji has a <em>custom</em> name and should be referred to as <code>emoji_code': '22134'</code>, rather than <code>bors</code>.</p>\n</blockquote>\n<p>Since this is the case, do we want to report this as a bug to Zulip or maybe the python zulip client, whichever is to blame?</p>",
        "id": 485040229,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732866991
    },
    {
        "content": "<p>looking at <a href=\"https://zulip.com/api/remove-reaction#parameter-emoji_code\">the API</a>, it seems using the code in general should be more robust?</p>",
        "id": 485041444,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732867464
    },
    {
        "content": "<p>Edward, feel free to report this.</p>\n<p>I personally found that not always the API documentation was clear, but I also have a <em>very</em> shallow understanding of python, Zulip, GitHub CI and what to expect in general in such situations.  For this reason, I do not feel confident enough in knowing that what felt like an issue in the documentation, was not simply incompetence on my part.  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 485045964,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732869107
    },
    {
        "content": "<p>btw, im looking into making the <code>awaiting-author</code> label do stuff</p>",
        "id": 485046491,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732869282
    },
    {
        "content": "<p>that tag does get added and removed manually, right?</p>",
        "id": 485046569,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732869311
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485046569\">said</a>:</p>\n<blockquote>\n<p>that tag does get added and removed manually, right?</p>\n</blockquote>\n<p>I think that it <em>can</em> be added with a comment, but if the action is triggered when the label is applied, it should not matter what the source is... I would hope!</p>",
        "id": 485047608,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732869680
    },
    {
        "content": "<p>according to the github workflow docs, if the label is added by an action using the repo's API token, it does not trigger any new actions.</p>",
        "id": 485047793,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732869746
    },
    {
        "content": "<p>see <a href=\"https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/triggering-a-workflow#triggering-a-workflow-from-a-workflow\">here</a></p>",
        "id": 485047850,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732869775
    },
    {
        "content": "<p>i'm guessing this is the sole exception to the rule, though.</p>",
        "id": 485048095,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732869853
    },
    {
        "content": "<p>I would suggest to do one thing at a time: let's add the reactions when the label is manually added and worry about the other cases later.</p>",
        "id": 485048592,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732870020
    },
    {
        "content": "<p>Besides, I think that most people manually apply the label, rather than commenting on the PR.</p>",
        "id": 485048647,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732870037
    },
    {
        "content": "<p>that's fair, still it's good to know that <em>technically</em> this workflow might need to be triggered by another.</p>",
        "id": 485053981,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732871832
    },
    {
        "content": "<p>do we also want <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> for WIP label, perchance? or <span aria-label=\"work in progress\" class=\"emoji emoji-1f6a7\" role=\"img\" title=\"work in progress\">:work_in_progress:</span> ?</p>",
        "id": 485063894,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732874945
    },
    {
        "content": "<p><span aria-label=\"work in progress\" class=\"emoji emoji-1f6a7\" role=\"img\" title=\"work in progress\">:work_in_progress:</span> also seems suitable for something like <code>blocked-by-PR</code>or the like... or <span aria-label=\"ring buoy\" class=\"emoji emoji-1f6df\" role=\"img\" title=\"ring buoy\">:ring_buoy:</span> for <code>help-wanted</code></p>",
        "id": 485064631,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732875170
    },
    {
        "content": "<p>Personally, I would prefer to add these over time: I would start adding the one that Kim suggested, possibly with a view to making the scripts easy to adjust for other reactions, but only implementing one, with the first PR.</p>",
        "id": 485065644,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732875480
    },
    {
        "content": "<p>yea, that was my plan</p>",
        "id": 485065795,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732875518
    },
    {
        "content": "<p>Anyway, since the source of the reaction is clearly labeled as a bot, and the scripts to do not block the main build CI, not much can go wrong.  However, reacting to all <a class=\"stream\" data-stream-id=\"116290\" href=\"/#narrow/channel/116290-rss\">#rss</a> posts <em>was</em> annoying and adding automation incrementally reduces such bumps.</p>",
        "id": 485066212,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732875648
    },
    {
        "content": "<p>please do check out <a href=\"https://github.com/leanprover-community/mathlib4/pull/19599\">#19599</a> for if i did stupid things</p>",
        "id": 485066715,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732875818
    },
    {
        "content": "<p>(and ignore the weird history, i had to pull some tricks in order to be able to see what i could find in <code>github.event</code> for this CI trigger)</p>",
        "id": 485066935,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732875889
    },
    {
        "content": "<p>btw, i felt the urge to abstract the \"put the emoji on the message\" part of the workflow into its own thing, because right now we just plainly call the python script with magic constant from various places.</p>",
        "id": 485068324,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732876337
    },
    {
        "content": "<p>even though there is decent support for calling workflows in workflows.</p>",
        "id": 485068465,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732876377
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485068324\">said</a>:</p>\n<blockquote>\n<p>btw, i felt the urge to abstract the \"put the emoji on the message\" part of the workflow into its own thing, because right now we just plainly call the python script with magic constant from various places.</p>\n</blockquote>\n<p>I think that there is a lot of code duplication (or triplication!) in the check for whether a reaction is already present and adding a new one in the python script: I also would like to see this unified in a single function that we repeatedly apply.</p>",
        "id": 485068776,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732876467
    },
    {
        "content": "<p>But this should definitely be in a separate PR, so that we maintain the scope of each modification clean and we can more easily identify issues, should there be any.</p>",
        "id": 485068869,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732876498
    },
    {
        "content": "<p>(I am really wary of CI and how easy it is to mess things up.)</p>",
        "id": 485068924,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732876515
    },
    {
        "content": "<p>so am i, but that might be precisely because of how it is set up</p>",
        "id": 485068977,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732876539
    },
    {
        "content": "<p>i'm thinking... right now, for zulip emojis, we have the following be the case:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: center;\">emoji</th>\n<th>workflow</th>\n<th>script parameter</th>\n<th>relevant tag</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span></td>\n<td><code>maintainer_bors.yaml</code></td>\n<td><code>\"delegated\"</code></td>\n<td><code>delegated</code></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"></td>\n<td><code>maintainer_bors.yaml</code></td>\n<td><code>\"ready-to-merge\"</code></td>\n<td><code>ready-to-merge</code></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><span aria-label=\"writing\" class=\"emoji emoji-270d\" role=\"img\" title=\"writing\">:writing:</span></td>\n<td><code>zulip_emoji_awaiting_author.yaml </code> (if it gets merged)</td>\n<td><code>\"labeled\"</code></td>\n<td><code>awaiting-author</code></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></td>\n<td><code>zulip_emoji_merge_delegate.yaml</code></td>\n<td><code>\"[Merged by Bors]\"</code></td>\n<td>n/a</td>\n</tr>\n</tbody>\n</table>\n<p>really it feels like other than the final <code>merged</code> state, the main goal here is reflecting the status tag of the PR on zulip. This suggests refactoring it into a single workflow which manages these PR tags <em>and</em> zulip emojis, somehow</p>",
        "id": 485073102,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732877782
    },
    {
        "content": "<p>ok, it's merged now...</p>",
        "id": 485075750,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732878608
    },
    {
        "content": "<p>small test: <a href=\"https://github.com/leanprover-community/mathlib4/pull/18818\">#18818</a></p>",
        "id": 485075774,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732878617
    },
    {
        "content": "<p>it added <span aria-label=\"writing\" class=\"emoji emoji-270d\" role=\"img\" title=\"writing\">:writing:</span></p>",
        "id": 485075953,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732878688
    },
    {
        "content": "<p>Are you going to test that it removes it as well?  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 485076132,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732878739
    },
    {
        "content": "<p>and it removed it <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 485076219,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732878770
    },
    {
        "content": "<p>Great!  It seems to work as intended: thanks!</p>",
        "id": 485076276,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732878787
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485073102\">said</a>:</p>\n<blockquote>\n<p>This suggests refactoring it into a single workflow which manages these PR tags <em>and</em> zulip emojis, somehow</p>\n</blockquote>\n<p>btw, can i get your opinion on this?</p>",
        "id": 485076598,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732878898
    },
    {
        "content": "<p>Wrt to having the labels on GitHub match the reactions on Zulip, this seems reasonable.  The (very short) \"history\" of this script is that it was initially run on a cron-job, periodically updating reactions.  However, this had a delay and incurred in GitHub API quota issues.  So, the script was moved to being called by the corresponding GitHub actions to apply the <img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\">, <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span>, <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> labels.  If indeed we want to have more syncronisation, then we should definitely think about doing this systematically.</p>",
        "id": 485076864,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732878980
    },
    {
        "content": "<p>So, whatever the script becomes, it should be \"instant\" (which is ok for something triggered by applying the label) and should not burden the GitHub API quota (which I also <em>think</em> is ok, but I do not know enough about what is included and what is not included in the quota).</p>",
        "id": 485077024,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732879046
    },
    {
        "content": "<p>More generally, I would like to have a single action for all comment-triggered actions (see the unification of the various <code>maintainer_merge</code> and <code>maintainer_bors</code> workflows), and the current one in progress that you are also suggesting for reactions to applying labels.</p>",
        "id": 485077451,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732879217
    },
    {
        "content": "<p>judging from <a href=\"#narrow/channel/270676-lean4/topic/Are.20.22.E2.86.A6.22.20and.20.22.3D.3E.22.20interchangeable.3F/near/485094574\">this reaction</a>, the current workflow has issues removing <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span> when <code>bors d-</code> is used</p>",
        "id": 485096855,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732886114
    },
    {
        "content": "<p>what i think happens is that the workflow says \"ah, this is a message about delegation, let's remove our reactions and add <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span>\"</p>",
        "id": 485097179,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732886209
    },
    {
        "content": "<p>indeed: the line that is to blame for this seems to be <a href=\"https://github.com/leanprover-community/mathlib4/blob/496527772ac807ef3d1ddd4868f2048f9ea478e1/.github/workflows/maintainer_bors.yml#L37\">this one</a>:</p>\n<blockquote>\n<p><code>sed -n 's=^bors  *\\(merge\\|r+\\) *$=ready-to-merge=p; s=^bors  *d.*=delegated=p' </code></p>\n</blockquote>\n<p>it seems this matches anything which starts with <code>bors d</code>, and doesn't check if it is or isn't followed</p>",
        "id": 485132304,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732898296
    },
    {
        "content": "<p>out of curiosity, why do the the GNU docs for <code>sed</code> use <code>/</code> while our ci uses <code>=</code>? <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> do you happen to know?</p>",
        "id": 485133134,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732898534
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 485134282,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732899095
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485132304\">said</a>:</p>\n<blockquote>\n<p>indeed: the line that is to blame for this seems to be <a href=\"https://github.com/leanprover-community/mathlib4/blob/496527772ac807ef3d1ddd4868f2048f9ea478e1/.github/workflows/maintainer_bors.yml#L37\">this one</a>:</p>\n<blockquote>\n<p><code>sed -n 's=^bors  *\\(merge\\|r+\\) *$=ready-to-merge=p; s=^bors  *d.*=delegated=p' </code></p>\n</blockquote>\n<p>it seems this matches anything which starts with <code>bors d</code>, and doesn't check if it is or isn't followed</p>\n</blockquote>\n<p>Yes, the action has only been active a couple of days and it was initially meant to simply be triggered to add a reaction.  It is piggy-backing the automation that was already present around the <code>delegated</code> and <code>ready-to-merge</code> labels and has received no special attention.</p>\n<p>I think that making the action aware of removals of the labels as well would be good, just no one had the time to implement it.  Besides, it is somewhat rare that the \"negative <code>bors</code>\" commands are used.</p>",
        "id": 485139940,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732901850
    },
    {
        "content": "<p>You can use any character, but you then need to escape that character if it's in your regex</p>",
        "id": 485139979,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732901875
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485133134\">said</a>:</p>\n<blockquote>\n<p>out of curiosity, why do the the GNU docs for <code>sed</code> use <code>/</code> while our ci uses <code>=</code>? <span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> do you happen to know?</p>\n</blockquote>\n<p>I personally find <code>=</code> as a separator for the <code>sed</code> fields to be clearer to read.</p>",
        "id": 485140033,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732901886
    },
    {
        "content": "<p>So using = frees up /</p>",
        "id": 485140040,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732901888
    },
    {
        "content": "<p>Or that</p>",
        "id": 485140057,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1732901901
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"684366\">Edward van de Meent</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2319522.3A.20emoji.20reactions.20to.20all.20public.20channels/near/485096855\">said</a>:</p>\n<blockquote>\n<p>judging from <a href=\"#narrow/channel/270676-lean4/topic/Are.20.22.E2.86.A6.22.20and.20.22.3D.3E.22.20interchangeable.3F/near/485094574\">this reaction</a>, the current workflow has issues removing <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span> when <code>bors d-</code> is used</p>\n</blockquote>\n<p>Btw, this issue is also present for the <code>delegated</code>/<code>ready-to-merge</code> labels: they do not get removed on GitHub, when <code>bors d-</code> et al are used.</p>",
        "id": 485140924,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732902365
    },
    {
        "content": "<p>Note that <code>bors d-</code> is not a valid bors command.</p>\n<p>Yes, this is unfortunate</p>",
        "id": 485147859,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732906502
    },
    {
        "content": "<p>uh... what?</p>",
        "id": 485150675,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732908112
    },
    {
        "content": "<p>seems you're <a href=\"https://bors.tech/documentation/\">right</a></p>",
        "id": 485150789,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732908172
    },
    {
        "content": "<p>i guess then i'd like a suggestion for what would be a good processing of such a command?</p>",
        "id": 485151036,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732908351
    },
    {
        "content": "<p>maybe something like posting a comment on the PR saying \"invalid command\" or something?</p>",
        "id": 485151108,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732908379
    },
    {
        "content": "<p>I'm not sure whether enforcing correct <code>bors</code> syntax is really something that should be pursued here.  I am surprised myself that <code>bors d-</code> is not valid syntax, but I would leave validating this to <code>bors</code>: if they silently ignore it, then so be it.</p>",
        "id": 485166812,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732918326
    },
    {
        "content": "<p>With the understanding that these really are some edge cases, I would find it more useful to have the removal of the <code>delegated</code> and <code>ready-to-merge</code> labels when a PR is taken off the queue.  Not high priority, but probably also quite easy to achieve, given the infrastructure that is already available.</p>",
        "id": 485167030,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732918470
    },
    {
        "content": "<p>i just now invested quite some effort into figuring out how to unify the \"entrypoint\" for PR comments. check it out at <a href=\"https://github.com/leanprover-community/mathlib4/tree/blizzard_inc%2Fci_debug_delegate\">branch#blizzard_inc/ci_debug_delegate</a>, and let me know what you think!</p>",
        "id": 485168191,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732919353
    },
    {
        "content": "<p>(it's the <code>.github/workflows/on_pr_comment.yaml</code> file)</p>",
        "id": 485168294,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1732919413
    },
    {
        "content": "<p>I need to look at this more carefully, but this seems to be heading in the general direction that I also had in mind.  One thing that I would probably prefer is to outsource to non-CI scripts as soon as possible, so maybe doing all the user-validation at once and then pass all the information of CI-variables, outcomes of <code>ModdingInquisition</code>/whatever else to the script and then all the logic of what to post is handled by a script.</p>",
        "id": 485207974,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732955956
    },
    {
        "content": "<p>The main reason for this, is that I would like to get CI working <em>once</em> on a comment and, once that is tested and in mathlib, then all subsequent changes happen locally in easily testable ways.</p>",
        "id": 485208027,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732956002
    },
    {
        "content": "<p>(In CI, the action should of course print, <em>very</em> verbosely, all the inputs that it passes to the script, which seems to already be the case.)</p>",
        "id": 485208089,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732956066
    }
]