[
    {
        "content": "<p>I have a crazy refactor in the works. Currently, you can speak of <code>C^n</code> functions (for <code>n : ‚Ñï</code>) or <code>C^‚àû</code> (the exponent space is <code>‚Ñï‚àû</code>). I want to change to a model where the exponent space is <code>WithTop ‚Ñï‚àû</code>, to be able to speak in the same language of <code>C^n</code>, <code>C^‚àû</code> and <code>C^œâ</code> functions.</p>\n<p>Reason: when doing differential geometry (say, defining Lie brackets of vector fields, for instance to define the Lie algebra of a Lie group), a key point is that second derivatives are symmetric. Over reals or complexes, this is true for <code>C^2</code> functions. Over a general normed field, this is only true for analytic functions. So, when doing differential geometry, Bourbaki says: fix some <code>n</code> which is anything if you're over the real or complex, and which is <code>œâ</code> otherwise. Then the following holds... </p>\n<p>In mathlib, if we want to avoid duplicating everything, I think the way to go is to implement the refactor, and have a typeclass <code>[IsAllowedExponent ùïú n]</code> in some theorems, which holds over any field for <code>n = œâ</code>, and for any <code>n</code> over reals or complexes.</p>\n<p>The refactor is hard: one needs to change a lot of import order and add a bunch of things on analytic functions within sets. From the mathematical point of view, things are also quite nasty when one wants to avoid completeness assumptions. But in the end it looks to me it has to be done if we want to get a satisfactory theory. </p>\n<p>I'm not done yet, but here are the first PRs in the line.</p>\n<p>TLDR: if you want Lie algebras in mathlib some day, done right, can you have a look at the following PRs?</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16720\">#16720</a> splits <code>ContDiff.Defs</code> into two files. No new mathematical content, just splitting a big file into two smaller files.</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16725\">#16725</a> changes the definition of <code>AnalyticWithinAt</code> to let it match a little more closely <code>ContDiffWithinAt</code>, and expands just a little bit the API to let the files compile.</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16383\">#16383</a> introduces a new Prop-valued typeclass to discuss whether a given normed field is R or C.</p>",
        "id": 469618799,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726134324
    },
    {
        "content": "<p><span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span> Wow! That sounds like a hard nut to crack. Will definitely review those PRs right now.</p>",
        "id": 469619574,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726134525
    },
    {
        "content": "<p>Thanks a lot for the lightning fast reviews! Next two PRs are</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16752\">#16752</a>, dropping completeness assumption in the proof that the composition of analytic functions on domains is analytic there -- it's now a different proof, as the other one couldn't be extended.</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16753\">#16753</a>, on analytic functions in Pi spaces.</p>",
        "id": 469899197,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726217168
    },
    {
        "content": "<p>Both look totally fine to me. But maybe someone who uses this part of the library a bit more than me should also take a look</p>",
        "id": 469935849,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726225911
    },
    {
        "content": "<p>I left 2 comments on <a href=\"https://github.com/leanprover-community/mathlib4/pull/16753\">#16753</a>, going to bed now.</p>",
        "id": 470282503,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726379959
    },
    {
        "content": "<p>Thanks for the reviews!</p>\n<p>The next PRs in the line are:</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16842\">#16842</a>, a short one (+40 lines) adding a few missing API lemmas to files low in the hierarchy</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16843\">#16843</a>, adding API to <code>AnalyticWithinAt</code>. Long (363), but essentially trivial</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/16844\">#16844</a>, showing that a continuous linear map into continuous multilinear maps is analytic</p>",
        "id": 470472948,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726469002
    },
    {
        "content": "<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 470671744,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726505294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/Integrate.20analytic.20functions.20in.20the.20smooth.20hierarchy/near/469618799\">said</a>:</p>\n<blockquote>\n<p>a key point is that second derivatives are symmetric</p>\n</blockquote>\n<p>A stupid question: what about making this property as a typeclass?</p>",
        "id": 470676075,
        "sender_full_name": "Jz Pan",
        "timestamp": 1726506054
    },
    {
        "content": "<p>A typeclass of what? It's not just the field, it also depends on the functions you are considering. And you want this property to be stable over a whole class of functions -- for instance, take the Lie bracket of two vector fields, you want the resulting Lie bracket to also have symmetric second derivatives. And also to not depend on a given fixed universe.</p>",
        "id": 470684043,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726507546
    },
    {
        "content": "<p>Sorry, I don't know. (I haven't looked at your PR so probably what I say here is nonsense.) Maybe for functions. Just like saying a function has up to nth derivatives, you can also define a Prop says a function has symmetric second derivatives? Sorry I'm not familiar with the analytic part of API in mathlib.</p>",
        "id": 470708366,
        "sender_full_name": "Jz Pan",
        "timestamp": 1726512388
    },
    {
        "content": "<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> An easy one in <a href=\"https://github.com/leanprover-community/mathlib4/pull/16891\">#16891</a> (splitting a file to keep a manageable size, no new material at all)</p>",
        "id": 471066196,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726599354
    },
    {
        "content": "<p>Easy =&gt; <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 471066683,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726599464
    },
    {
        "content": "<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> Another easy one in <a href=\"https://github.com/leanprover-community/mathlib4/pull/16972\">#16972</a>, moving things around between files in the <code>Analytic</code> folder so that it makes more sense. No declaration added or removed, according to the declarations diff script.</p>",
        "id": 471774923,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726849646
    },
    {
        "content": "<p><span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span> merged by <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span></p>",
        "id": 471782500,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726851765
    },
    {
        "content": "<p>Next one in <a href=\"https://github.com/leanprover-community/mathlib4/pull/16985\">#16985</a> again expands the API around analytic functions. Again pretty short (+150/-36), with nothing complicated.</p>",
        "id": 471811361,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726859135
    },
    {
        "content": "<p>I've just noticed that</p>\n<ul>\n<li>the docstring of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AnalyticWithinOn#doc\">docs#AnalyticWithinOn</a> mentions <code>s</code> and <code>t</code>, while only <code>t</code> is used in the definition;</li>\n<li>we don't have this <code>*On</code>/<code>*WithinOn</code> for <code>Continuous</code> and <code>Differentiable</code></li>\n</ul>",
        "id": 471856603,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726878824
    },
    {
        "content": "<p>Do you plan to change the latter?</p>",
        "id": 471856612,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1726878831
    },
    {
        "content": "<p>I've just fixed the docstring of <code>AnalyticWithinOn</code>, thanks! For the distinction <code>AnalyticOn</code>, <code>AnalyticWithinOn</code>, I think it's mostly a historical accident: analytic functions have a canonical extension to a neighborhood (contrary to continuous or differentiable functions, say), so it seemed at first natural to require that the function coincides around each point of <code>s</code> with this canonical extension, and this leads to <code>AnalyticOn</code> -- which is indeed quite different from <code>ContinuousOn</code> or <code>DifferentiableOn</code> as it does not only depend on the values of the function on the set. Then, we realized that this definition was no good to define analytic manifolds, and so we introduced <code>AnalyticWithinOn</code>, which is the true analogue of <code>ContinuousOn</code> or <code>DifferentiableOn</code>. </p>\n<p>In retrospect, it looks to me that the really useful notion is <code>AnalyticWithinOn</code>, and I would be ready to rename it to <code>AnalyticOn</code> (for coherence with the naming of the other notions), and ditch the current <code>AnalyticOn</code> (or use a more complicated name, like <code>AnalyticOnNhds</code>). But there should be consensus for that, and I'm not going to do it in the near future anyway as I've already enough to do with the current <code>ContDiff</code> refactor :-)</p>",
        "id": 471899268,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726903994
    },
    {
        "content": "<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/17002\">#17002</a> unifies results on inversion that were proved separately in complete normed rings, and in normed fields, by introducing a typeclass <code>HasSummableGeomSeries</code>.</p>",
        "id": 471967455,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1726946213
    },
    {
        "content": "<p>This all looks very sensible to me! Thanks! <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 472404800,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727157963
    },
    {
        "content": "<p>Contrary to what I said two messages above, I decided it was a good idea to do now the renaming <code>AnalyticOn -&gt; AnalyticOnNhd</code> and <code>AnalyticWithinOn -&gt; AnalyticOn</code>, because the earlier it is done the less we have to deprecate. This is available in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17146\">#17146</a> (a little bit long, but almost purely mechanical).</p>\n<p>Of course, this is blocking all the other PRs I could make. The refactor is now building (you can have a look in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17152\">#17152</a> for fun, but it's now more than +3000 lines so it will take quite some time to get it into mathlib through manageable PRs), so I will have a few PRs to make once <a href=\"https://github.com/leanprover-community/mathlib4/pull/17146\">#17146</a> is in.</p>",
        "id": 472854764,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727343526
    },
    {
        "content": "<p>The individual commits look great! Thanks</p>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 472855951,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727343908
    },
    {
        "content": "<p>Here are the next few PRs towards the refactor (they are all referenced in the project PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/17152\">#17152</a>):</p>",
        "id": 472904709,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727359353
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/16985\">#16985</a> (+147/-32) expands a little bit the API around analytic functions</p>",
        "id": 472904858,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727359390
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17164\">#17164</a> (+22) gives a few simple lemmas on <code>WithTop (ENat)</code></p>",
        "id": 472904975,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727359425
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17169\">#17169</a> (+683) is the first half of the Faa di Bruno formula. Too long, probably, but combinatorial and repetitive and it doesn't really make sense to split it</p>",
        "id": 472905225,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727359503
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17170\">#17170</a> (+329/-137) shows that the inverse of an analytic partial homeo is analytic</p>",
        "id": 472905397,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727359552
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/Integrate.20analytic.20functions.20in.20the.20smooth.20hierarchy/near/472905225\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17169\">#17169</a> (+683) is the first half of the Faa di Bruno formula. Too long, probably, but combinatorial and repetitive and it doesn't really make sense to split it</p>\n</blockquote>\n<p>Do you already have a PR with the second half as well?</p>",
        "id": 473176925,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1727460556
    },
    {
        "content": "<p>No because it depends on something that needs <a href=\"https://github.com/leanprover-community/mathlib4/pull/16985\">#16985</a>. But you can have a look at how the full file will look like in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17152\">#17152</a>.</p>",
        "id": 473186820,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727463344
    },
    {
        "content": "<p>Thanks a lot for the quick reviews! Next two on the list are:</p>",
        "id": 473350479,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727531710
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17218\">#17218</a> (+142/-42), moving the fact that the exponential is analytic earlier in the hierarchy</p>",
        "id": 473350538,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727531751
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17221\">#17221</a> (+339/-18), showing that if a function is analytic on a set so is its derivative, without completeness assumptions</p>",
        "id": 473350679,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1727531796
    },
    {
        "content": "<p>Asked for more docs on <a href=\"https://github.com/leanprover-community/mathlib4/pull/17221\">#17221</a></p>",
        "id": 473406379,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1727579892
    },
    {
        "content": "<p>May I gently ping on <a href=\"https://github.com/leanprover-community/mathlib4/pull/17221\">#17221</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/17169\">#17169</a>? There is still quite a long way before the end of the refactor, and I'd rather get it sooner than later into mathlib because it will open the way to a lot of changes in differential geometry.</p>",
        "id": 474741145,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1728021351
    },
    {
        "content": "<p>Sorry, I just forgot to delegate <a href=\"https://github.com/leanprover-community/mathlib4/pull/17221\">#17221</a></p>",
        "id": 474744645,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728022667
    },
    {
        "content": "<p>About <a href=\"https://github.com/leanprover-community/mathlib4/pull/17169\">#17169</a>: could you please move <code>OrderedFinpartition</code>s to a file outside of <code>Analysis</code>?</p>",
        "id": 474745118,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728022833
    },
    {
        "content": "<p>Aren't <code>OrderedFinpartion</code>s equivalent to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finpartition#doc\">docs#Finpartition</a> s of <code>Fin n</code>? If yes (I may be wrong, it's past 1am here), then I think that we shouldn't create 2 separate APIs for the same object.</p>",
        "id": 474745324,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1728022911
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"387244\">@Ya√´l Dillies</span> do you have comments on these ordered finpartitions?</p>",
        "id": 474745944,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1728023125
    },
    {
        "content": "<p>I was literally writing something just now <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 474746696,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1728023391
    },
    {
        "content": "<p>I agree with Yury's diagnosis that this is mathematically the same as a <code>Finpartition (univ : Set (Fin n))</code> or <code>Finpartition (Iio n)</code>. What I'm not very clear about is how much the APIs overlap. Right now, they look mostly disjoint.</p>",
        "id": 474747690,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1728023742
    },
    {
        "content": "<p>Yes, it's definitely the same thing as <code>Finpartition</code>, but with a pretty different implementation focus: what matters are the embeddings, and the interaction with <code>Fin.cons</code>, and defeqs of all this. I tried first with <code>Finpartition</code>, but it just wasn't suited for the task of the main induction of the proof of Faa di Bruno.</p>\n<p>Let me copy part of the docstring of the file, to explain why it should remain in this file:</p>\n<hr>\n<p>Note that the implementation of <code>OrderedFinpartition</code> is very specific to the Faa di Bruno formula:<br>\nas testified by the formula above, what matters is really the embedding of the parts in <code>Fin n</code>,<br>\nand moreover the parts have to be ordered by <code>max I‚ÇÄ &lt; ... &lt; max I‚Çñ‚Çã‚ÇÅ</code> for the formula to hold<br>\nin the general case where the iterated differential might not be symmetric. The defeqs with respect<br>\nto <code>Fin.cons</code> are also important when doing the induction. For this reason, we do not expect this<br>\nclass to be useful beyond the Faa di Bruno formula, which is why it is in this file instead<br>\nof a dedicated file in the <code>Combinatorics</code> folder.</p>\n<hr>\n<p>If you want to see how it all fits together, I've just opened <a href=\"https://github.com/leanprover-community/mathlib4/pull/17400\">#17400</a> which contains the completed file.</p>",
        "id": 474761256,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1728027840
    },
    {
        "content": "<p>Now that <a href=\"https://github.com/leanprover-community/mathlib4/pull/17169\">#17169</a> has been merged (thanks for the reviews!), the next one on the path to integrating analytic functions in the smooth hierarchy is <a href=\"https://github.com/leanprover-community/mathlib4/pull/17400\">#17400</a> (+306/-10), completing the proof of the Faa di Bruno formula.</p>",
        "id": 480773449,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1730829260
    },
    {
        "content": "<p>The two next ones are:</p>",
        "id": 481103670,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1730980615
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18722\">#18722</a> (+37/-115), simplifying the proof that the composition of <code>C^n</code> functions are <code>C^n</code> using the Faa di Bruno formula.</p>",
        "id": 481103801,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1730980662
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18723\">#18723</a> (+210/-141) <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\">, a very weird PR because I make things more complicated in the definition of <code>HasFTaylorSeriesUp</code>, taking the smoothness parameter in <code>WithTop ‚Ñï‚àû</code>instead of <code>‚Ñï‚àû</code>. This forces me to ask casts at several places, for absolutely no gain, so this PR is making mathlib worse. Of course, it will be used later to integrate analytic functions in the smooth hierarchy...</p>",
        "id": 481104133,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1730980800
    },
    {
        "content": "<p>Last preparation PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/19374\">#19374</a> (+155/-80) splits a file, moving the content that depends on the <code>ContDiff</code> definition to other files (so that I can swap the import order later on).</p>",
        "id": 484661886,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732695554
    },
    {
        "content": "<p>The final PR is ready for review in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17152\">#17152</a>. Unfortunately, it's still kind of a patch bomb (+895/-630). The reason is that once you modify a basic definition (here <code>ContDiff</code>, so that <code>ContDiff ùïú œâ f</code> means that <code>f</code> is analytic), you have to fix everything downstream, and this has to be done in one single PR. I've tried my best to split what could be split in other PRs, but now this one is essentially irreducible and still too big...</p>",
        "id": 484721197,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732714163
    },
    {
        "content": "<p>Thanks a lot!</p>",
        "id": 484727509,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732715961
    },
    {
        "content": "<p>BTW, what do you think should we do about <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>C</mi><mi>r</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span></span></span></span></span></span></span> for non-integer <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>?</p>",
        "id": 484727583,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732715985
    },
    {
        "content": "<p>For now, nothing :-)<br>\nMore seriously, there are many notions of intermediate smoothness (C^m with H√∂lder <code>m</code>-th derivative, but also Sobolev smoothness, Besov smoothness, Gevrey smoothness, and so on). I would just build them as independent hierarchies, with theorems saying which implies which.</p>",
        "id": 484728241,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732716139
    },
    {
        "content": "<p>One more question:</p>\n<blockquote>\n<p>consider a function which is <code>C^2</code> over the reals or complexes, or analytic over a general field</p>\n</blockquote>\n<p>Do these theorems hold for <code>C^2</code> over a general field, if we use <a href=\"https://en.wikipedia.org/wiki/Whitney_extension_theorem\">Whitney smoothness</a>?</p>",
        "id": 484728703,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732716263
    },
    {
        "content": "<p>No idea. Isn't Whitney smoothness a finite-dimensional notion, or does it have a meaningful general extension?</p>\n<p>Anyway, everyone doing p-adics says that any notion of finite differentiability is bad there, and that one should just use analytic functions (or strengthenings like rigid analytic).</p>",
        "id": 484730163,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732716642
    },
    {
        "content": "<p>I can review your PR tonight (in 10-13h from now).</p>",
        "id": 484738733,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732719063
    },
    {
        "content": "<p>That would be great, but there is no hurry!</p>",
        "id": 484743037,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732720257
    },
    {
        "content": "<p>Delegated. Sorry for a delay. I got distracted by <a href=\"https://github.com/urkud/DeRhamCohomology/blob/main/DeRhamCohomology/DifferentialForm.lean#L44\">proving</a> <code>d (dœâ) = 0</code>.</p>",
        "id": 485146823,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732905899
    },
    {
        "content": "<p>Wow, very nice! I love it how everything is coordinate free. For instance, the exterior derivative is <code>.uncurryFin (fderiv ‚Ñù œâ x)</code>!</p>",
        "id": 485155578,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732911186
    },
    {
        "content": "<p>Note: <span class=\"user-mention\" data-user-id=\"731080\">@Sam Lindauer</span>, a student of <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>, is going to make formalization of de Rham cohomologies a part of his master's thesis, so I'm going to give him an opportunity to work on this project mostly alone, following my suggestions (I want some definitions to work in a proper generality). So, we aren't looking for outside contributions for now.</p>",
        "id": 485165650,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732917578
    },
    {
        "content": "<p>de Rham cohomologies, this is great! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span> <span aria-label=\"dancers\" class=\"emoji emoji-1f46f\" role=\"img\" title=\"dancers\">:dancers:</span></p>",
        "id": 485169082,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1732920026
    },
    {
        "content": "<p>A side note for <span class=\"user-mention\" data-user-id=\"731080\">@Sam Lindauer</span>  then: on vector spaces, it will be important to define from the start the exterior derivative within a set, show that <code>d o d = 0</code> for the exterior derivative within a set, and so on. The reason is that, even if you're just interested in the usual exterior derivative in a manifold, you need to work in domains in a chart because of manifolds with boundary. </p>\n<p>A good API example for defining a notion in vector spaces, and then pulling it to manifolds using the fact that it is invariant under diffeos, is the Lie bracket of vector fields (where the vector space version is already in mathlib, and the manifold version will soon be -- you can see the overall result in <a href=\"https://github.com/leanprover-community/mathlib4/pull/18396\">#18396</a>).</p>",
        "id": 485206722,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1732954828
    },
    {
        "content": "<p>It's <a href=\"https://github.com/urkud/DeRhamCohomology/issues/5\">https://github.com/urkud/DeRhamCohomology/issues/5</a></p>",
        "id": 485249104,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1732989341
    },
    {
        "content": "<p>I've tried to update Mathlib in a project of mine, where I have a line involving <code>contDiff_succ_iff_deriv.mp &lt;| hf.contDiff (n := 2)</code>, where <code>hf : Differentiable ‚ÑÇ f</code> (and <code>f¬†:¬†‚ÑÇ ‚Üí ‚ÑÇ</code>), which now breaks with</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>application type mismatch\n  contDiff_succ_iff_deriv.mp (Differentiable.contDiff hf)\nargument\n  Differentiable.contDiff hf\nhas type\n  ContDiff ‚ÑÇ 2 f : Prop\nbut is expected to have type\n  ContDiff ?m.41648 (?m.41796 + 1) ?m.41797 : Prop\n</code></pre></div>\n<p>I assume this has to do with the type of <code>n</code> now being <code>WithTop ‚Ñï‚àû</code>. What is the intended way to fix this? <span class=\"user-mention\" data-user-id=\"110050\">@S√©bastien Gou√´zel</span></p>",
        "id": 485607910,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1733140812
    },
    {
        "content": "<p>Here is an attempt:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">contDiff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">WithTop</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"bp\">‚àû</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">contDiff_succ_iff_deriv</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">differentiable</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n</code></pre></div>\n<p>but it runs into the next error</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>invalid field 'differentiable', the environment does not contain 'And.differentiable'\n  (contDiff_succ_iff_deriv.mp this).right\nhas type\n  (1 = ‚ä§ ‚Üí AnalyticOn ‚ÑÇ f Set.univ) ‚àß ContDiff ‚ÑÇ 1 (deriv f)\n</code></pre></div>\n<p>so I also need to replace <code>.2</code> by <code>.2.2</code>...</p>\n<p>Anyway this <code>rw [show (2 : WithTop ‚Ñï‚àû) = 1 + 1 from rfl] at this</code> business is very ugly; the unification of <code>2</code> and <code>1 + 1</code> should be automatic.</p>",
        "id": 485608739,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1733141052
    },
    {
        "content": "<p>They might not be defeq in this exotic type?</p>",
        "id": 485614918,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1733143061
    },
    {
        "content": "<p>If the proof with <code>from rfl</code> works...</p>",
        "id": 485615204,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733143158
    },
    {
        "content": "<p>Yes, it's definitely a byproduct of the refactor, and I am aware it's not optimal. I haven't found a good way around this either. </p>\n<p>It's not clear to me if you're still stuck or if you have solved the issue -- if you're still stuck, I can have a look if you give me a pointer to the project.</p>",
        "id": 485619150,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1733144386
    },
    {
        "content": "<p>Another way around, in the specific situation of your message above (but I don't know if it is oversimplified) would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">contDiff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">contDiff_succ_iff_deriv</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">differentiable</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">.</span><span class=\"n\">le</span>\n</code></pre></div>",
        "id": 485619514,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1733144502
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hf'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">contDiff_succ_iff_deriv</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">contDiff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"n\">differentiable</span><span class=\"w\"> </span><span class=\"n\">le_rfl</span>\n</code></pre></div>\n<p>works, thanks.<br>\nI was wondering whether spelling <code>2</code> as <code>1 + 1</code> is really necessary. This seems to be a relevant downside of the refactor.<br>\nSince it apparently did work with <code>‚Ñï‚àû</code>, I'm wondering why it should not be possible to also get it to work with <code>WithTop ‚Ñï‚àû</code>.</p>",
        "id": 485631640,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1733148251
    },
    {
        "content": "<p>It used to use <code>Nat</code>, not <code>ENat</code>, so it worked.</p>",
        "id": 485758310,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733203320
    },
    {
        "content": "<p>So, it's a side effect of a natural generalization of the lemma (I've noticed <code>Nat</code> instead of <code>ENat</code> during review and suggested the edit), not of the refactor.</p>",
        "id": 485758456,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733203398
    },
    {
        "content": "<p>BTW, what are you trying to prove in this line? Possibly, we should add more convenience lemmas.</p>",
        "id": 485758582,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733203466
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">S√©bastien Gou√´zel</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Integrate.20analytic.20functions.20in.20the.20smooth.20hierarchy/near/481103801\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18722\">#18722</a> (+37/-115), simplifying the proof that the composition of <code>C^n</code> functions are <code>C^n</code> using the Faa di Bruno formula.</p>\n</blockquote>\n<p>I used it to prove <code>iteratedFDerivWithin_comp</code> and <code>iteratedFDeriv_comp</code> in <a href=\"https://github.com/leanprover-community/mathlib4/tree/YK-moreira\">branch#YK-moreira</a><br>\nI'm going to move it to a separate PR later this week.</p>",
        "id": 485764925,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733206781
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Integrate.20analytic.20functions.20in.20the.20smooth.20hierarchy/near/485758582\">said</a>:</p>\n<blockquote>\n<p>BTW, what are you trying to prove in this line? Possibly, we should add more convenience lemmas.</p>\n</blockquote>\n<p>Basically this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Differentiable</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Differentiable</span><span class=\"w\"> </span><span class=\"n\">‚ÑÇ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I guess it would make sense to have this as a convenience lemma; it doesn't seem to exist:<br>\n<span class=\"user-mention\" data-user-id=\"644391\">@loogle</span> ‚ä¢ Differentiable _ (deriv ?f)</p>",
        "id": 485964541,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1733264183
    },
    {
        "content": "<p><span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span> nothing found</p>",
        "id": 485964544,
        "sender_full_name": "loogle",
        "timestamp": 1733264184
    },
    {
        "content": "<p>Should we add <code>Differentiable.deriv</code> and <code>DifferentiableOn.deriv</code>?</p>",
        "id": 485990815,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1733276289
    },
    {
        "content": "<p>These lemmas should definitely be added, I think.</p>\n<p>But a question now is if it's really a good idea to use <code>Differentiable ‚ÑÇ f</code> as a normal form, or if <code>ContDiff ‚ÑÇ œâ f</code> (which is equivalent to it) would be better suited for the task.</p>",
        "id": 486021103,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1733293690
    }
]