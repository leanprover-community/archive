[
    {
        "content": "<p>This isn't a request to review <a href=\"https://github.com/leanprover/lean4/pull/6269\">lean4#6269</a> per se, but I would appreciate if someone would review the warnings that it turns up in <a href=\"https://github.com/leanprover-community/mathlib4/tree/lean-pr-testing-6269\">branch#lean-pr-testing-6269</a> and make PRs to mathlib to resolve them (or let me know if the warnings make no sense!)</p>\n<p>Background: Issue <a href=\"https://github.com/leanprover/lean4/pull/5258\">lean4#5258</a> suggested that if a declaration exists and would conflict with an <code>export</code>, or vice versa, there ought to be a warning. This Lean PR goes most of the way there, warning at the point of a declaration or an <code>export</code> that an ambiguity is about to be created, though it doesn't go so far as to make sure that if you import two modules, one with a declaration and another with an alias for the same name, that there will be an ambiguity.</p>\n<p>Pinging <span class=\"user-mention\" data-user-id=\"197836\">@Jireh Loreaux</span></p>",
        "id": 485501051,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1733075429
    },
    {
        "content": "<p>I will take a look, but I can't for the next 36-48 hours.</p>",
        "id": 485515703,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1733088412
    },
    {
        "content": "<p>a common theme here seems to be <code>_root_.trans</code>, i.e. <code>trans</code> refers to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=trans#doc\">docs#trans</a> as alias of either <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trans.trans#doc\">docs#Trans.trans</a> or <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTrans.trans#doc\">docs#IsTrans.trans</a></p>",
        "id": 485516309,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733088992
    },
    {
        "content": "<p>deduplicating this seems to be a large part of adapting to this PR</p>",
        "id": 485516350,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733089034
    },
    {
        "content": "<p>later on (after moving <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=trans#doc\">docs#trans</a>), it seems there are some errors <code>typeclass instance problem is stuck, it is often due to metavariables Trans _ _ _</code> due to using <code>trans</code> without disambiguation.</p>",
        "id": 485516462,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733089157
    },
    {
        "content": "<p>(see for my partial attempt at finding all issues <a href=\"https://github.com/leanprover-community/mathlib4/tree/blizzard_inc%2Flean-pr-testing-6269\">branch#blizzard_inc/lean-pr-testing-6269</a> , and <a href=\"https://github.com/leanprover-community/mathlib4/compare/lean-pr-testing-6269...blizzard_inc/lean-pr-testing-6269\">here</a> for the comparison against <a href=\"https://github.com/leanprover-community/mathlib4/tree/lean-pr-testing-6269\">branch#lean-pr-testing-6269</a>)</p>",
        "id": 485516614,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1733089306
    },
    {
        "content": "<p>That's already a pain today. Can we just fix <code>trans</code>?</p>",
        "id": 485516891,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1733089589
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span>, sorry I think I'm missing some context here. What was your proposed fix for <code>trans</code>?</p>",
        "id": 494617751,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1737273507
    },
    {
        "content": "<p>Just namespace one</p>",
        "id": 494617809,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737273583
    },
    {
        "content": "<p>And then disambiguate every occurrence</p>",
        "id": 494617916,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737273648
    },
    {
        "content": "<p>Or, well, I think that's the solution? I haven't looked at this for a month</p>",
        "id": 494618080,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737273796
    },
    {
        "content": "<p>I guess I was hoping for a suggestion as to <em>which</em> one. :-)</p>",
        "id": 494626392,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1737280762
    },
    {
        "content": "<p>right...<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Trans.trans#doc\">docs#Trans.trans</a> is <code>exported</code> into the <code>_root_</code> namespace in prelude, while <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=trans#doc\">docs#trans</a> is an actual separate definition... looking at the diff of the salvage attempt i made, it looks like usually the intended value is indeed <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsTrans.trans#doc\">docs#IsTrans.trans</a> which <code>trans</code> is basically an alias of. (it's a separate declaration, but defeq up to argument binder types). </p>\n<p>Since mathlib typically will use <code>_root_.trans</code>, i'd say for mathlib it'd be ideal if <code>Trans.trans</code> does not get exported... then again, i think mathlib can also do just fine only referring to <code>IsTrans.trans</code>...</p>",
        "id": 494627223,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737281488
    },
    {
        "content": "<p>other things to consider here is that i don't think we can deprecate exports, while we can deprecate declarations.</p>",
        "id": 494627329,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737281592
    },
    {
        "content": "<p>ultimately, i'd say <code>_root_.trans</code> really should be called <code>IsTrans.trans</code><br>\nMaking this change requires <code>_root_.trans</code> to be deprecated, the current <code>IsTrans.trans</code> field to be renamed (to something like <code>trans'</code> or <code>is_trans</code>, maybe?), and the actual moving of the declaration.</p>",
        "id": 494627969,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737282143
    },
    {
        "content": "<p>(sorry for the multiple messages, i was still getting it all straight in my head)</p>",
        "id": 494627997,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1737282176
    },
    {
        "content": "<p>Okay. On the Lean side, I can consider removing the <code>export Trans (trans)</code>; this barely hurts Lean at all (<a href=\"https://github.com/leanprover/lean4/pull/6809\">lean#6809</a>). However it is a breaking change without a deprecation.</p>\n<p>What about:</p>\n<ul>\n<li>Mathlib (perhaps: <em>you</em>) deprecates <code>_root_.trans</code>.</li>\n<li>On the next release, I add <code>_root_.trans</code> in Lean as a deprecated alias for <code>Trans.trans</code>, and remove the export (and Mathlib removes its <code>_root_.trans</code></li>\n<li>On the release after that, I delete <code>_root_.trans</code> from Lean, and Mathlib (+anyone downstream) is free to use <code>_root_.trans</code> as desired.</li>\n</ul>",
        "id": 496243853,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1738029413
    },
    {
        "content": "<p>sounds like a plan</p>",
        "id": 496301314,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738059785
    },
    {
        "content": "<p>btw, i'm assuming deprecating <code>_root_.trans</code> includes replacing it as i suggested?</p>",
        "id": 496303738,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738060584
    },
    {
        "content": "<p>because deprecating without replacement is non-trivial. (deprecating with replacement is also non-trivial, but still easier)</p>",
        "id": 496304069,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1738060685
    }
]