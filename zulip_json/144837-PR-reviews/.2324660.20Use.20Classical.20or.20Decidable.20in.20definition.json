[
    {
        "content": "<p>In the divided powers project, <span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> and I introduce several definitions that assume <code>[DecidableEq A]</code> for a ring <code>A</code>. One such example is currently in Mathlib as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=dividedPowersBot#doc\">docs#dividedPowersBot</a>.<br>\n<span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> suggested that it could be good to remove these decidability hypotheses from definitions (replacing them by classical), but keep them in lemmas about these declarations.<br>\nWhat would be the preferred approach in Mathlib? Should we keep the existing version, or modify it as in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24660\">#24660</a>?</p>",
        "id": 516705644,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1746631202
    },
    {
        "content": "<p>I think unless you want to explicit compute using the kernel (which doesn't seem useful to me here), then you should remove it and use classical.<br>\nIt is easy to revert too under the unlikely circumstance that the kernel is somehow useful to you.</p>",
        "id": 516707833,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746631777
    },
    {
        "content": "<p>Is it remotely useful to be able to compute these for <code>Rat</code>?</p>",
        "id": 516711838,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746632772
    },
    {
        "content": "<p>If so, I'd be inclined to leave it with the Decidable assumption; it should be mostly harmless to keep around</p>",
        "id": 516712029,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746632823
    },
    {
        "content": "<blockquote>\n<p>it could be good to remove these decidability hypotheses from definitions (replacing them by classical), but keep them in lemmas about these declarations</p>\n</blockquote>\n<p>I don't quite understand this suggestion: removing the decidability from definitions but keeping the assumption in lemmas? The usual way we do this in mathlib is exactly the opposite: keeping Decidable as an assumption in definitions, but using <code>classical</code> in proofs where needed.</p>",
        "id": 516753067,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1746646634
    },
    {
        "content": "<p>Is there any other example that needs decidability? In this example I think the computable-ness of ideal is basically useless, and we can add <code>[DecidableEq R] : DecidablePred (· ∈ I)</code> to get this behaviour back without requiring <code>DecidableEq</code> everywhere in proofs.</p>",
        "id": 516769481,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746653606
    },
    {
        "content": "<p>I don't understand your suggestion, Andrew</p>",
        "id": 516779948,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746659191
    },
    {
        "content": "<p>Certainly you can't conclude that for all <code>I</code></p>",
        "id": 516779968,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746659206
    },
    {
        "content": "<p>I mean the <code>I</code> that they are constructing. <code>I = bot</code> in this case.</p>",
        "id": 516780243,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746659390
    },
    {
        "content": "<p>There is one case where. we are constructing <code>I = bot</code>, but many other cases, and we ended up adding a bunch of <code>DecidablePred</code> assumptions, which was a bit painful.</p>",
        "id": 516780357,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746659451
    },
    {
        "content": "<p>Can you link to one of those cases?</p>",
        "id": 516780397,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746659482
    },
    {
        "content": "<p>Is the pain just having to type the assumption (in which case maybe we should have automation like we do for autoimplicits), or does it also make the proof awkward?</p>",
        "id": 516780428,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746659513
    },
    {
        "content": "<p><a href=\"https://github.com/AntoineChambert-Loir/DividedPowers4/blob/35a6d911ab59f48d694bcf4492f790169d0e83a7/DividedPowers/DPAlgebra/Dpow2.lean#L1152\">https://github.com/AntoineChambert-Loir/DividedPowers4/blob/35a6d911ab59f48d694bcf4492f790169d0e83a7/DividedPowers/DPAlgebra/Dpow2.lean#L1152</a></p>",
        "id": 516780527,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746659554
    },
    {
        "content": "<p>The pain is to have to type the assumption, and to <code>omit</code> it every other lemma when it is not needed.</p>",
        "id": 516780592,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746659600
    },
    {
        "content": "<p>If in the end you are able to obtain a computable <code>dpow</code> then maybe it is worth the pain...</p>",
        "id": 516780739,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746659695
    },
    {
        "content": "<p>For the moment, the computability is a bit theoretical because everything depends on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=MvPolynomial#doc\">docs#MvPolynomial</a> which is <code>noncomputable</code> by design.</p>",
        "id": 516780919,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746659790
    },
    {
        "content": "<p>Where is <code>augIdeal</code> defined? Maybe the answer is to add a classical <code>DecidablePred</code> instance for that</p>",
        "id": 516781147,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746659938
    },
    {
        "content": "<p><a href=\"https://github.com/AntoineChambert-Loir/DividedPowers4/blob/35a6d911ab59f48d694bcf4492f790169d0e83a7/DividedPowers/DPAlgebra/Graded/GradeZero.lean#L138\">https://github.com/AntoineChambert-Loir/DividedPowers4/blob/35a6d911ab59f48d694bcf4492f790169d0e83a7/DividedPowers/DPAlgebra/Graded/GradeZero.lean#L138</a></p>",
        "id": 516781218,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746659993
    },
    {
        "content": "<p>Indeed, <code>augIdeal</code> is the kernel of a morphism to <code>R</code>, so that <code>DecidableEq R</code> implies the decidability of membership to <code>augIdeal</code>, which we can (should?) add as an (local ?) instance.</p>",
        "id": 516781313,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746660040
    },
    {
        "content": "<p>That should be a global instance, if you can define it successfully</p>",
        "id": 516781337,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746660057
    },
    {
        "content": "<p>We wrote something this morning, which we deleted. Should it be for <code>augIdeal</code>, or for the kernel of any ring morphism to something with decidable equality?</p>",
        "id": 516781410,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746660121
    },
    {
        "content": "<p><code>augIdeal</code> is a def, so only the former will work</p>",
        "id": 516781459,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746660133
    },
    {
        "content": "<p>But the other one sounds fine too, if you also want to add that instance</p>",
        "id": 516781485,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746660148
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/516753067\">said</a>:</p>\n<blockquote>\n<p>I don't quite understand this suggestion: removing the decidability from definitions but keeping the assumption in lemmas?</p>\n</blockquote>\n<p>I meant keeping it in lemmas when it is needed for the statement (not if it is only needed in the proof).</p>",
        "id": 516827346,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1746688881
    },
    {
        "content": "<p>We can indeed have a <code>DecidablePred</code> instance for <code>augIdeal</code>. Should we keep the <code>DecidableEq A</code> assumption then?</p>",
        "id": 516827890,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1746689091
    },
    {
        "content": "<p>I think that's sensible, yes</p>",
        "id": 516925722,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746718589
    },
    {
        "content": "<p>I have closed the PR. Thanks everyone!</p>",
        "id": 517091643,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1746791339
    },
    {
        "content": "<p>I don't understand the outcome of this thread. The change proposed in <a href=\"https://github.com/leanprover-community/mathlib4/pull/24660\">#24660</a> is clearly a win: it enables one to speak about <code>dividedPowersBot</code> without the irrelevant distraction of decidability. Also <del>if we want to cover the very unlikely possibility that someone wants to capture this notion in a computable way</del> its API will have a lemma which characterises its data-bearing <code>dpow</code> field, and this lemma can consume an <code>[DecidableEq A]</code> so that computability is available in the very unlikely event that anyone ever wants it.</p>",
        "id": 517361612,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1746970471
    },
    {
        "content": "<p>I think in this case though the \"irrelelvant distraction\" actually raised a missing instance that makes a bunch of things go through more cleanly in the intended use-case?</p>",
        "id": 517361882,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746970764
    },
    {
        "content": "<p>(admittedly you could argue that the missing instance is also a distraction, but so is having to write the lemma that you suggest)</p>",
        "id": 517361902,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746970789
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"240862\">@Oliver Nash</span> What would this lemma say? (We won't make everything computable all in a sudden, but I've said multiple times how insane it looks to me to have large parts of this expensive system pretending obviously computable things are <code>noncomputable</code>, possibly not very efficiently.)</p>",
        "id": 517362366,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746971192
    },
    {
        "content": "<p>Concretely, in our case, we will end up with one or two <code>DecidableEq</code> assumptions, on a ring, on a module, but the rest should be derived from it.</p>",
        "id": 517362425,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746971261
    },
    {
        "content": "<p>The important point is that we won't have to explicit a bunch of additional <code>DecidablePred</code> assumptions.</p>",
        "id": 517362513,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746971313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> If we implemented the following version of <a href=\"https://github.com/leanprover-community/mathlib4/pull/24660\">#24660</a></p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">- def dividedPowersBot [DecidableEq A] : DividedPowers (⊥ : Ideal A) where</span>\n<span class=\"gd\">- dpow n a :=ite (a = 0 ∧ n = 0) 1 0</span>\n<span class=\"gi\">+ noncomputable def dividedPowersBot : DividedPowers (⊥ : Ideal A) where</span>\n<span class=\"gi\">+   dpow n a := open scoped Classical in ite (a = 0 ∧ n = 0) 1 0</span>\n</code></pre></div>\n<p>then the sort of lemma I had in mind would be:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span><span class=\"w\"> </span><span class=\"n\">dividedPowersBot_dpow_eq</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">dividedPowersBot</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">dpow</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">ite</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dividedPowersBot</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 517362884,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1746971621
    },
    {
        "content": "<p>And in practice I'd expect this lemma only to be invoked inside proofs (rather than statements) and so the <code>DecidableEq A</code> assumption which it demands would be supplied by an earlier invocation of the <code>classical</code> tactic.</p>",
        "id": 517363025,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1746971727
    },
    {
        "content": "<p>I agree with Oliver that this is the right way to remove Decidable, but I am not completely convinced that removing Decidable is worth doing here.</p>",
        "id": 517368376,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746975636
    },
    {
        "content": "<p>Excellent, thanks! I'll discuss this with <span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> — since we have to pass through the whole project to sort this out anyway, we might wish to do it in this way.</p>",
        "id": 517369444,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1746976412
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> why would it not be worth doing? It's a trivial change and immediately frees us from the decidability issues?</p>",
        "id": 517373317,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1746979181
    },
    {
        "content": "<p>One person's freedom from decidability nonsense is another's curse of broken <code>#eval</code></p>",
        "id": 517374603,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746980051
    },
    {
        "content": "<p>My impression is that the nonsense is pretty lightweight here</p>",
        "id": 517374643,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746980090
    },
    {
        "content": "<p>And i don't think adding the lemmas above fix the broken eval?</p>",
        "id": 517374715,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746980152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/517374603\">said</a>:</p>\n<blockquote>\n<p>One person's freedom from decidability nonsense is another's curse of broken <code>#eval</code></p>\n</blockquote>\n<p>I was demoing some quadratic form stuff to <span class=\"user-mention silent\" data-user-id=\"901954\">Jonathan Hanke</span> a week or two ago, and it was very annoying that we couldn't even eval the matrix of the form <code>x^2</code></p>",
        "id": 517374805,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746980201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/517374643\">said</a>:</p>\n<blockquote>\n<p>My impression is that the nonsense is pretty lightweight here</p>\n</blockquote>\n<p>I don't think so: it's going to spread and spread to every lemma that refers to this definition. It is handy to be able to use <code>#eval</code> but if I'm forced to choose (as I am here) I'll let <code>#eval</code> go.</p>",
        "id": 517375019,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1746980349
    },
    {
        "content": "<p>By lightweight, I mean <code>[DecidableEq X]</code> instead of some horrible <code>[DecidablePred _]</code></p>",
        "id": 517375060,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1746980386
    },
    {
        "content": "<p>Is there a solution (by tweaking some things about <code>variable</code> etc) where one could write <code>variable [DecidableEq X]</code> at the top without ugly <code>omit</code>s all over?</p>",
        "id": 517375201,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1746980487
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/516711838\">said</a>:</p>\n<blockquote>\n<p>Is it remotely useful to be able to compute these for <code>Rat</code>?</p>\n</blockquote>\n<p>I don't think it is remotely useful for <code>Rat</code>.<br>\n<span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> <span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> are there examples of computable rings where you might want to use divided powers? My impression is that everything will be 5 noncomputable constructions removed from the computable realm.</p>",
        "id": 517493929,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1747045192
    },
    {
        "content": "<p>Even if there is some situation where computability is desired, it still available via a lemma such <code>dividedPowersBot_dpow_eq</code> which I proposed above. It's just very slightly less convenient because one needs to go via <code>dividedPowersBot_dpow_eq</code> rather than the definition itself.</p>",
        "id": 517498372,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747046279
    },
    {
        "content": "<p>If I understand things correctly, you recommend:</p>\n<ul>\n<li>\n<p>Require no hypothesis for the definition, use classical within it if necessary ;</p>\n</li>\n<li>\n<p>Whenever a decidable assumption allows to unfold the definition in a more appropriate way, write the corresponding lemma.</p>\n</li>\n</ul>\n<p>In the case of an <code>if … then… else</code>, wouldn't it be useful to have two additional lemmas, one that expands for <code>then</code>, and the other for <code>else</code>?</p>",
        "id": 517511060,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747049328
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/517498372\">said</a>:</p>\n<blockquote>\n<p>Even if there is some situation where computability is desired, it still available via a lemma such <code>dividedPowersBot_dpow_eq</code> which I proposed above. It's just very slightly less convenient because one needs to go via <code>dividedPowersBot_dpow_eq</code> rather than the definition itself.</p>\n</blockquote>\n<p>I don't understand how a lemma helps with computation. This can only work if it's eligible for <code>csimp</code>, and this is never the case for definitions where only one takes an extra <code>DecidableEq</code> argument</p>",
        "id": 517519339,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747051086
    },
    {
        "content": "<p>How about the following:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">dividedPowersBot</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">dpow</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">dividedPowersBot_dpow_eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">decide</span>\n</code></pre></div>\n<p>Or if we have a situation where this important, then we make the RHS of <code>dividedPowersBot_dpow_eq</code> a computable definition, develop all the API for the actually useful noncomputable definition and resort to the RHS for our computations.</p>",
        "id": 517527214,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747052768
    },
    {
        "content": "<p>I really think this whole discussion is a massive distraction from our real job, which I contend is developing a library suitable for formalising modern research mathematics.</p>",
        "id": 517527302,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747052793
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130609\">@Antoine Chambert-Loir</span> Yes that is the basically right design. Regarding the <code>if … then … else</code> point, I think it's fine to have additional lemmas for the true and false cases, but I'd probably only add them if I start to need them in proofs (e.g., for rewriting).</p>",
        "id": 517527939,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747052936
    },
    {
        "content": "<blockquote>\n<p>I really think this whole discussion is a massive distraction from our real job, which I contend is developing a library suitable for formalising modern research mathematics.</p>\n</blockquote>\n<p>I think in this particular case it largely depends on what the original author wants to do and I don't have an opinion, but I just want to slightly push back this point of view that computational mathematics and numerical methods are a fair portion of \"modern research mathematics\" and would benefit from working decidable definitions.</p>",
        "id": 517538822,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1747055209
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/517527214\">said</a>:</p>\n<blockquote>\n<p>How about the following:</p>\n</blockquote>\n<p>This is about <em>kernel reducibility</em>, not computability; but indeed both are useful sometimes, and this is also a nice thing to consider.</p>",
        "id": 517540050,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747055467
    },
    {
        "content": "<p>Yes I do realise this; hence my sentence beginning \"Or if we have a situation where this important ...\".</p>",
        "id": 517541773,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747055801
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> Obviously if we can have computable definitions for free I'm all in favour. However as I said above, when we are forced to make a choice between sneezing a mess of distracting decidability nonsense into our codebase or losing computability, I will always choose the latter, especially since, again as I said above, we can add computable definitions + proofs that they agree if we really want.</p>",
        "id": 517543088,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1747056055
    },
    {
        "content": "<p>Nothing will be computable with divided power structures on ideals, even over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span>, because you can't even decide if you're in<code>I : Ideal Int</code>. Computability is definitely an interesting thing, but it surely needs to be dealt with in a completely different way to \"randomly make random bits computable in algebra and hope that this helps\". We saw the disadvantages of this piecemeal approach failing with polynomials (which is why they're not computable) and it will surely also fail here. The approach to computability in algebra will be a very delicate project and involves starting from scratch, not starting with divided powers.</p>",
        "id": 517547960,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747057058
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">synth</span><span class=\"w\"> </span><span class=\"n\">Decidable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>\n<p>Isn't this just the end of the story?</p>",
        "id": 517548142,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747057090
    },
    {
        "content": "<p>I don't think that's necessarily the end of the story, since there are ideals in Z for which you can decide membership (eg <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">2\\mathbb{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord\">2</span><span class=\"mord mathbb\">Z</span></span></span></span>; <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Int.instDecidablePredEven#doc\">docs#Int.instDecidablePredEven</a>). But I do agree that for something like this, it's probably fine for things to be noncomputable until there's an explicit case where we need it to be computable, then we can reconsider</p>",
        "id": 517549362,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1747057354
    },
    {
        "content": "<p>For <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span>, the story won't be that interesting, since only <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">⊥</mi></mrow><annotation encoding=\"application/x-tex\">\\bot</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\">⊥</span></span></span></span> admits divided powers. But regarding decidability of membership,  it is decidable (although not necessarily efficiently) whether any element belongs to an ideal of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span> given by explicit generators, and more generally for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi><mo stretchy=\"false\">[</mo><msub><mi>T</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>T</mi><mi>n</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf Z[T_1,\\dots,T_n]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">Z</span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>, or <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Q</mi><mo stretchy=\"false\">[</mo><msub><mi>T</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>T</mi><mi>n</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf Q[T_1,\\dots,T_n]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">Q</span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>.</p>",
        "id": 517550359,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747057552
    },
    {
        "content": "<p>I feel that mathlib has not really decided where it want to stand with respect to computation. Of course, not everything in mathematics is computable, and even less is efficiently computable, and it is important that mathlib is able to <em>talk</em> about noncomputable things, such as “classical” real numbers, and not only computable ones. But on the other hand, having $3k machines that can't compute a gcd of two polynomials with rational coefficients, because, at some point, polynomials have been made <code>noncomputable</code> doesn't look correct neither.</p>",
        "id": 517553091,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747057948
    },
    {
        "content": "<p>What is the dividing line in mathlib between things that are left as <code>noncomputable</code> and those for which we wish computation?</p>",
        "id": 517554937,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747058166
    },
    {
        "content": "<p>But this isn't fixed by the suggestions above, this is fixed in a different way (probably with a gigantic project). You are not old enough to remember all the hell we had with computable polynomials because whilst they were better for computing they were a nightmare to prove with, there were diamonds and slowdowns. This is why we switched. But this was before you came along so you don't remember the hell. This is why things need to be fixed in a different way to making random things in the theory of divided powers computable in the hope that it helps.</p>",
        "id": 517555055,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747058182
    },
    {
        "content": "<p>So computability is left “north of the wall”?</p>",
        "id": 517555879,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747058279
    },
    {
        "content": "<p>The sad fact is that there is not one good way to make polynomials computable (as you well know), there are different implementations with different strengths. All this is dealt with in professional computer algebra systems by having a wealth of implementations and flags that the user can set saying which one they want to use, and good algorithms switching between implementations. That's what we want to implement. This is why Rocq has 5 different definitions of Nat. But we don't want 3 different definitions of polynomials and the suggestions above are just attempting to put a sticking plaster on what is really an extremely complex problem.</p>",
        "id": 517556369,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747058337
    },
    {
        "content": "<p>For the moment, Maria-Inés and I won't compute a lot of things, but I had the impression that it was useful to leave this possibility open, which is why we had this predicate in the definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=dividedPowersBot#doc\">docs#dividedPowersBot</a> . <br>\nWhatever my intimate inclinations, I feel we received conflicting opinions about what we have to do.</p>",
        "id": 517557217,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747058480
    },
    {
        "content": "<p>So yes there is definitely a complex discussion worth having, but I don't think it's relevant to <a href=\"https://github.com/leanprover-community/mathlib4/pull/24660\">#24660</a> which I think should be reopened on the basis that it makes our library easier to use for mathematicians, and trust me we're going to need mathematicians if we want to do crystalline cohomology</p>",
        "id": 517557346,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747058508
    },
    {
        "content": "<p>To me, the way forward is to have tactics do the computation for us. It can be much finer and much more efficient than <code>by decide</code>. For instance, real numbers are noncomputable in mathlib, but you can still check that <code>3 + 7 = 10</code> -- not by <code>decide</code>, but by <code>norm_num</code>.</p>",
        "id": 517559447,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1747058880
    },
    {
        "content": "<p>(<code>3</code>, <code>7</code> and <code>10</code> are integers, aren't they?)</p>",
        "id": 517567199,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747060271
    },
    {
        "content": "<p>I think this is the distinction Sébastien is trying to draw:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n</code></pre></div>",
        "id": 517567678,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1747060351
    },
    {
        "content": "<p>In any case, I have reopened the PR and pushed the <code>open Classical in</code> within the proof as requested by Eric, so that no more decidability assumptions are imposed. (Well, there are some, because we use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum#doc\">docs#Finset.sum</a> in some theorems.)</p>",
        "id": 517568217,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1747060452
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324660.20Use.20Classical.20or.20Decidable.20in.20definition/near/517567678\">said</a>:</p>\n<blockquote>\n<p>I think this is the distinction Sébastien is trying to draw:</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"c1\">-- works</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Continuing this example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">NNReal</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">10.5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">10.5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">ofScientific</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"n\">unseal</span><span class=\"w\"> </span><span class=\"n\">Rat</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℚ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">10.5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">10.5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">norm_num</span><span class=\"w\"> </span><span class=\"c1\">-- not supported</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mf\">3.5</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"bp\">≥</span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mf\">10.5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">decide</span><span class=\"w\"> </span><span class=\"c1\">-- fails, because we can't unseal `Real.add` at all</span>\n</code></pre></div>\n<p>Fixing the <code>decide</code> is a simple matter of removing the <code>irreducible_def</code>s; fixing the <code>norm_num</code> requires someone to do a huge refactor of the tactic.</p>",
        "id": 517576180,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747062033
    },
    {
        "content": "<p>But removing the <code>irreducible_defs</code> results in slowdowns and timeouts in other places in the library, right? This is the problem: we don't seem to be able to have it both ways. At least, this is what happened with polynomials. This is why it's a much bigger problem than just people vigorously discussing whether some small part of the library should or shouldn't be computable, and we should probably find a principled solution involving <code>csimp</code> rather than exposing our current implementations.</p>",
        "id": 517577703,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1747062362
    },
    {
        "content": "<blockquote>\n<p>At least, this is what happened with polynomials</p>\n</blockquote>\n<p>I though this was because of a combination of:</p>\n<ul>\n<li>People not liking writing <code>decidable_eq</code></li>\n<li>A time long past when <code>open scoped Classical</code> was considered a good idea globally, and the fallout was not understood</li>\n</ul>\n<p>rather than being performance driven</p>",
        "id": 517580111,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1747062860
    }
]