[
    {
        "content": "<p>I am working on getting to the statement and proof that a nonarchimedean normed field is locally compact iff the  field is complete, the valuation ring is a DVR, and the residue field is finite.</p>\n<p>To that, I have the first piece: <code>totallyBounded_iff_finite_residueField</code><br>\nThere is a stack of PRs that gets there, and I thought to place the PRs while I work on the compact &lt;-&gt; complete portion.<br>\nIn order of inclusion:<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/15424\">#15424</a>: the PR of the thread</p>\n<p>PRs on norms<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/14768\">#14768</a>: Norms on nonarchimedean fields (with some fixes of how it interacts with <code>Valued</code> -- there was a hidden variable <code>sorry</code> in that file)<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/15284\">#15284</a>: ciSup_mem on list/multiset/finset -- to allow relation of norm of sum vs norm of elements<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/15271\">#15271</a>: ciSup_image and other lemmas -- to make it easy to discuss the maximum norm over a set</p>\n<p>PRs on ideals<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/15425\">#15425</a>: group/addgroup/ring is finite if quotient is finite when quotiented by finite, in generality that doesn't require <code>Normal</code><br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/15426\">#15426</a>: # R/I equiv I^n/I^(n+1) for principal I</p>",
        "id": 455807607,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722567407
    },
    {
        "content": "<p>Happy to discuss strategy more, and I'm looking for feedback for how granular these PRs are or not.</p>",
        "id": 455807680,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722567429
    },
    {
        "content": "<p>I have other related PRs on nonarchimedean foos (instance for Z_p and Q_p; sufficiency conditions for an arbitrary field), but that's not along the main trunk to this general result</p>",
        "id": 455807975,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722567551
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"741361\">@Jou Glasheen</span></p>",
        "id": 455807988,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722567559
    },
    {
        "content": "<p>I see another thread mentioned cosets too, with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Subgroup.groupEquivQuotientProdSubgroup#doc\">docs#Subgroup.groupEquivQuotientProdSubgroup</a>. That might be good enough for proving finiteness, but I'd likely still need the iUnion split of cosets since in the nonarchimedean ring/ideal case, it splits the ring into disjoint balls.</p>",
        "id": 455810312,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722568211
    },
    {
        "content": "<p>For some reason, TC tests are failing in the larger PR -- is this an issue with something I merged in, or did I create at TC loop?<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10222860259/job/28288197844#step:21:16\">https://github.com/leanprover-community/mathlib4/actions/runs/10222860259/job/28288197844#step:21:16</a></p>",
        "id": 456056917,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722640213
    },
    {
        "content": "<p>In general, instances with goals of the form <code>{X} : MyClass X</code> are too generic and should get a lower priority.</p>",
        "id": 456085642,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1722654356
    },
    {
        "content": "<p>I tried setting a lower priority, but that still results in a <code>#guard_msgs</code> mismatch. However, I don't see what the practical difference is. On master, this is the error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">AddMonoidHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AddGroupSeminorm</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"n\">use</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">diagnostic</span><span class=\"w\"> </span><span class=\"n\">information</span>\n</code></pre></div>\n<p>and on my branch:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">synthesize</span>\n<span class=\"w\">  </span><span class=\"n\">AddMonoidHomClass</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">AddGroupSeminorm</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"o\">(</span><span class=\"n\">deterministic</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">timeout</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"ss\">`typeclass</span><span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">maximum</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">heartbeats</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">3000</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">reached</span>\n<span class=\"n\">use</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">synthInstance</span><span class=\"bp\">.</span><span class=\"n\">maxHeartbeats</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">num</span><span class=\"bp\">&gt;`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"n\">use</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">diagnostic</span><span class=\"w\"> </span><span class=\"n\">information</span>\n<span class=\"n\">use</span><span class=\"w\"> </span><span class=\"ss\">`set_option</span><span class=\"w\"> </span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">diagnostic</span><span class=\"w\"> </span><span class=\"n\">information</span>\n</code></pre></div>\n<p>Seems to have the same semantics to me. Not sure why <code>set_option diagnostics true</code> appears twice.</p>",
        "id": 456332197,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722781928
    },
    {
        "content": "<p>The issue here stems from the fact that I am using <code>Valued.integer</code> inside a <code>NontriviallyNormedField K</code>, and need to provide <code>Valued K Foo</code> to TC search. And <code>Foo</code> is an outparam, and one obvious choice is <code>NNReal</code>. I could instead define <code>NormedField.integer</code>, show that it is propositionally equal to <code>valuation.integer</code>(using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.integer#doc\">docs#Valuation.integer</a>), and provide a duplicate set of notation.</p>",
        "id": 456332343,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722782071
    },
    {
        "content": "<p>In general, it seems tricky to use <code>Valued.integer</code> since one might have several different <code>Valued K Γ₀</code> and <code>Valued K Γ₀'</code> around.</p>",
        "id": 456332392,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722782128
    },
    {
        "content": "<p>The semantics are very different: your error message is failing because is exceed the maximum number of heartbeats, whereas before it was successfully not finding the instance.</p>",
        "id": 456413747,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722820648
    },
    {
        "content": "<p>This is exactly why these tests exists.</p>",
        "id": 456413759,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1722820654
    },
    {
        "content": "<p>Gotcha, thanks for explaining. So since I provide an instance of Valued when NontriviallyNormedField, and the former has an outparam, it sends it down a pointless path?</p>",
        "id": 456416989,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1722823104
    },
    {
        "content": "<p>Perhaps <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.RankOne#doc\">docs#Valuation.RankOne</a> shouldn't be a class, but a plain structure or even a Prop structure?</p>",
        "id": 457093508,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723032779
    },
    {
        "content": "<p>Maybe it's a class to make <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valued.norm#doc\">docs#Valued.norm</a> easier to use?</p>",
        "id": 457120377,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1723039924
    },
    {
        "content": "<p>Nothing currently uses <code>Valued.norm</code> (not imported anywhere), and it's somewhat clunky because one could have two different <code>Valued L Γ₀</code> and <code>Valued L Γ₀'</code> that induce the same norm. I think there might be an antipattern here since the file ends up naming the instance arguments:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valued</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"n\">Γ₀</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">RankOne</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>and then refers to the named instances: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">norm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"bp\">.</span><span class=\"n\">hom</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Valued</span><span class=\"bp\">.</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I might be missing something here because I'm coming at it from the \"I'm interested in the normed field structure more\".</p>",
        "id": 457121834,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723040396
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"406490\">@María Inés de Frutos Fernández</span> <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> what do you think?</p>",
        "id": 457122863,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1723040710
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2315424.20Residue.20field.20is.20finite.20iff.20totally.20bounded.20DVR/near/457093508\">said</a>:</p>\n<blockquote>\n<p>Perhaps <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.RankOne#doc\">docs#Valuation.RankOne</a> shouldn't be a class, but a plain structure or even a Prop structure?</p>\n</blockquote>\n<p>The class <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.RankOne#doc\">docs#Valuation.RankOne</a> has the inclusion <code>Γ₀  →*₀ NNReal</code> as data; this is intentional and <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span>  use it in our local field project to have control of normalizations when translating between norms and valuations. So I am against turning it into a Prop.</p>",
        "id": 457148040,
        "sender_full_name": "María Inés de Frutos Fernández",
        "timestamp": 1723047491
    },
    {
        "content": "<p>How many different inclusions do you attach to a <code>V</code> or to a <code>Γ₀</code>? Even it is Prop, one could say <code>Nonempty (Γ₀ →*₀ NNReal)</code>. In the meantime, at use-place of <code>NormedField.toValued</code>, I've scoped the instance, so the TC-loop tests now pass.</p>",
        "id": 457155265,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1723049856
    }
]